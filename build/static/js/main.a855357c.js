/*! For license information please see main.a855357c.js.LICENSE.txt */
(()=>{var e={3803:(e,t,i)=>{"use strict";i.d(t,{A:()=>re});var n=function(){function e(e){var t=this;this._insertTag=function(e){var i;i=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,i),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var i=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{i.insertRule(e,i.cssRules.length)}catch(n){}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){var t;return null==(t=e.parentNode)?void 0:t.removeChild(e)})),this.tags=[],this.ctr=0},e}(),r=Math.abs,s=String.fromCharCode,a=Object.assign;function o(e){return e.trim()}function l(e,t,i){return e.replace(t,i)}function c(e,t){return e.indexOf(t)}function h(e,t){return 0|e.charCodeAt(t)}function d(e,t,i){return e.slice(t,i)}function u(e){return e.length}function p(e){return e.length}function f(e,t){return t.push(e),e}var m=1,g=1,v=0,y=0,b=0,A="";function x(e,t,i,n,r,s,a){return{value:e,root:t,parent:i,type:n,props:r,children:s,line:m,column:g,length:a,return:""}}function w(e,t){return a(x("",null,null,"",null,null,0),e,{length:-e.length},t)}function S(){return b=y>0?h(A,--y):0,g--,10===b&&(g=1,m--),b}function _(){return b=y<v?h(A,y++):0,g++,10===b&&(g=1,m++),b}function E(){return h(A,y)}function C(){return y}function M(e,t){return d(A,e,t)}function T(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function I(e){return m=g=1,v=u(A=e),y=0,[]}function P(e){return A="",e}function D(e){return o(M(y-1,L(91===e?e+2:40===e?e+1:e)))}function R(e){for(;(b=E())&&b<33;)_();return T(e)>2||T(b)>3?"":" "}function B(e,t){for(;--t&&_()&&!(b<48||b>102||b>57&&b<65||b>70&&b<97););return M(e,C()+(t<6&&32==E()&&32==_()))}function L(e){for(;_();)switch(b){case e:return y;case 34:case 39:34!==e&&39!==e&&L(b);break;case 40:41===e&&L(e);break;case 92:_()}return y}function O(e,t){for(;_()&&e+b!==57&&(e+b!==84||47!==E()););return"/*"+M(t,y-1)+"*"+s(47===e?e:_())}function N(e){for(;!T(E());)_();return M(e,y)}var k="-ms-",F="-moz-",U="-webkit-",z="comm",j="rule",V="decl",G="@keyframes";function H(e,t){for(var i="",n=p(e),r=0;r<n;r++)i+=t(e[r],r,e,t)||"";return i}function W(e,t,i,n){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case V:return e.return=e.return||e.value;case z:return"";case G:return e.return=e.value+"{"+H(e.children,n)+"}";case j:e.value=e.props.join(",")}return u(i=H(e.children,n))?e.return=e.value+"{"+i+"}":""}function Q(e){return P(q("",null,null,null,[""],e=I(e),0,[0],e))}function q(e,t,i,n,r,a,o,d,p){for(var m=0,g=0,v=o,y=0,b=0,A=0,x=1,w=1,M=1,T=0,I="",P=r,L=a,k=n,F=I;w;)switch(A=T,T=_()){case 40:if(108!=A&&58==h(F,v-1)){-1!=c(F+=l(D(T),"&","&\f"),"&\f")&&(M=-1);break}case 34:case 39:case 91:F+=D(T);break;case 9:case 10:case 13:case 32:F+=R(A);break;case 92:F+=B(C()-1,7);continue;case 47:switch(E()){case 42:case 47:f(Y(O(_(),C()),t,i),p);break;default:F+="/"}break;case 123*x:d[m++]=u(F)*M;case 125*x:case 59:case 0:switch(T){case 0:case 125:w=0;case 59+g:-1==M&&(F=l(F,/\f/g,"")),b>0&&u(F)-v&&f(b>32?K(F+";",n,i,v-1):K(l(F," ","")+";",n,i,v-2),p);break;case 59:F+=";";default:if(f(k=X(F,t,i,m,g,r,d,I,P=[],L=[],v),a),123===T)if(0===g)q(F,t,k,k,P,a,v,d,L);else switch(99===y&&110===h(F,3)?100:y){case 100:case 108:case 109:case 115:q(e,k,k,n&&f(X(e,k,k,0,0,r,d,I,r,P=[],v),L),r,L,v,d,n?P:L);break;default:q(F,k,k,k,[""],L,0,d,L)}}m=g=b=0,x=M=1,I=F="",v=o;break;case 58:v=1+u(F),b=A;default:if(x<1)if(123==T)--x;else if(125==T&&0==x++&&125==S())continue;switch(F+=s(T),T*x){case 38:M=g>0?1:(F+="\f",-1);break;case 44:d[m++]=(u(F)-1)*M,M=1;break;case 64:45===E()&&(F+=D(_())),y=E(),g=v=u(I=F+=N(C())),T++;break;case 45:45===A&&2==u(F)&&(x=0)}}return a}function X(e,t,i,n,s,a,c,h,u,f,m){for(var g=s-1,v=0===s?a:[""],y=p(v),b=0,A=0,w=0;b<n;++b)for(var S=0,_=d(e,g+1,g=r(A=c[b])),E=e;S<y;++S)(E=o(A>0?v[S]+" "+_:l(_,/&\f/g,v[S])))&&(u[w++]=E);return x(e,t,i,0===s?j:h,u,f,m)}function Y(e,t,i){return x(e,t,i,z,s(b),d(e,2,-2),0)}function K(e,t,i,n){return x(e,t,i,V,d(e,0,n),d(e,n+1,-1),n)}var J=function(e,t,i){for(var n=0,r=0;n=r,r=E(),38===n&&12===r&&(t[i]=1),!T(r);)_();return M(e,y)},Z=function(e,t){return P(function(e,t){var i=-1,n=44;do{switch(T(n)){case 0:38===n&&12===E()&&(t[i]=1),e[i]+=J(y-1,t,i);break;case 2:e[i]+=D(n);break;case 4:if(44===n){e[++i]=58===E()?"&\f":"",t[i]=e[i].length;break}default:e[i]+=s(n)}}while(n=_());return e}(I(e),t))},$=new WeakMap,ee=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,i=e.parent,n=e.column===i.column&&e.line===i.line;"rule"!==i.type;)if(!(i=i.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||$.get(i))&&!n){$.set(e,!0);for(var r=[],s=Z(t,r),a=i.props,o=0,l=0;o<s.length;o++)for(var c=0;c<a.length;c++,l++)e.props[l]=r[o]?s[o].replace(/&\f/g,a[c]):a[c]+" "+s[o]}}},te=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}};function ie(e,t){switch(function(e,t){return 45^h(e,0)?(((t<<2^h(e,0))<<2^h(e,1))<<2^h(e,2))<<2^h(e,3):0}(e,t)){case 5103:return U+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return U+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return U+e+F+e+k+e+e;case 6828:case 4268:return U+e+k+e+e;case 6165:return U+e+k+"flex-"+e+e;case 5187:return U+e+l(e,/(\w+).+(:[^]+)/,U+"box-$1$2"+k+"flex-$1$2")+e;case 5443:return U+e+k+"flex-item-"+l(e,/flex-|-self/,"")+e;case 4675:return U+e+k+"flex-line-pack"+l(e,/align-content|flex-|-self/,"")+e;case 5548:return U+e+k+l(e,"shrink","negative")+e;case 5292:return U+e+k+l(e,"basis","preferred-size")+e;case 6060:return U+"box-"+l(e,"-grow","")+U+e+k+l(e,"grow","positive")+e;case 4554:return U+l(e,/([^-])(transform)/g,"$1"+U+"$2")+e;case 6187:return l(l(l(e,/(zoom-|grab)/,U+"$1"),/(image-set)/,U+"$1"),e,"")+e;case 5495:case 3959:return l(e,/(image-set\([^]*)/,U+"$1$`$1");case 4968:return l(l(e,/(.+:)(flex-)?(.*)/,U+"box-pack:$3"+k+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+U+e+e;case 4095:case 3583:case 4068:case 2532:return l(e,/(.+)-inline(.+)/,U+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(u(e)-1-t>6)switch(h(e,t+1)){case 109:if(45!==h(e,t+4))break;case 102:return l(e,/(.+:)(.+)-([^]+)/,"$1"+U+"$2-$3$1"+F+(108==h(e,t+3)?"$3":"$2-$3"))+e;case 115:return~c(e,"stretch")?ie(l(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==h(e,t+1))break;case 6444:switch(h(e,u(e)-3-(~c(e,"!important")&&10))){case 107:return l(e,":",":"+U)+e;case 101:return l(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+U+(45===h(e,14)?"inline-":"")+"box$3$1"+U+"$2$3$1"+k+"$2box$3")+e}break;case 5936:switch(h(e,t+11)){case 114:return U+e+k+l(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return U+e+k+l(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return U+e+k+l(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return U+e+k+e+e}return e}var ne=[function(e,t,i,n){if(e.length>-1&&!e.return)switch(e.type){case V:e.return=ie(e.value,e.length);break;case G:return H([w(e,{value:l(e.value,"@","@"+U)})],n);case j:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return H([w(e,{props:[l(t,/:(read-\w+)/,":-moz-$1")]})],n);case"::placeholder":return H([w(e,{props:[l(t,/:(plac\w+)/,":"+U+"input-$1")]}),w(e,{props:[l(t,/:(plac\w+)/,":-moz-$1")]}),w(e,{props:[l(t,/:(plac\w+)/,k+"input-$1")]})],n)}return""}))}}],re=function(e){var t=e.key;if("css"===t){var i=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(i,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var r,s,a=e.stylisPlugins||ne,o={},l=[];r=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),i=1;i<t.length;i++)o[t[i]]=!0;l.push(e)}));var c,h,d=[W,(h=function(e){c.insert(e)},function(e){e.root||(e=e.return)&&h(e)})],u=function(e){var t=p(e);return function(i,n,r,s){for(var a="",o=0;o<t;o++)a+=e[o](i,n,r,s)||"";return a}}([ee,te].concat(a,d));s=function(e,t,i,n){c=i,H(Q(e?e+"{"+t.styles+"}":t.styles),u),n&&(f.inserted[t.name]=!0)};var f={key:t,sheet:new n({key:t,container:r,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:o,registered:{},insert:s};return f.sheet.hydrate(l),f}},918:(e,t,i)=>{"use strict";function n(e){var t=Object.create(null);return function(i){return void 0===t[i]&&(t[i]=e(i)),t[i]}}i.d(t,{A:()=>n})},4575:(e,t,i)=>{"use strict";i.d(t,{C:()=>a,T:()=>l,w:()=>o});var n=i(5043),r=i(3803),s=(i(6598),i(9436),n.createContext("undefined"!==typeof HTMLElement?(0,r.A)({key:"css"}):null)),a=s.Provider,o=function(e){return(0,n.forwardRef)((function(t,i){var r=(0,n.useContext)(s);return e(t,r,i)}))},l=n.createContext({})},3290:(e,t,i)=>{"use strict";i.d(t,{AH:()=>c,i7:()=>h,mL:()=>l});var n=i(4575),r=i(5043),s=i(1722),a=i(9436),o=i(6598),l=(i(3803),i(219),(0,n.w)((function(e,t){var i=e.styles,l=(0,o.J)([i],void 0,r.useContext(n.T)),c=r.useRef();return(0,a.i)((function(){var e=t.key+"-global",i=new t.sheet.constructor({key:e,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),n=!1,r=document.querySelector('style[data-emotion="'+e+" "+l.name+'"]');return t.sheet.tags.length&&(i.before=t.sheet.tags[0]),null!==r&&(n=!0,r.setAttribute("data-emotion",e),i.hydrate([r])),c.current=[i,n],function(){i.flush()}}),[t]),(0,a.i)((function(){var e=c.current,i=e[0];if(e[1])e[1]=!1;else{if(void 0!==l.next&&(0,s.sk)(t,l.next,!0),i.tags.length){var n=i.tags[i.tags.length-1].nextElementSibling;i.before=n,i.flush()}t.insert("",l,i,!1)}}),[t,l.name]),null})));function c(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,o.J)(t)}var h=function(){var e=c.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}},6598:(e,t,i)=>{"use strict";i.d(t,{J:()=>g});var n={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},r=i(918),s=!1,a=/[A-Z]|^ms/g,o=/_EMO_([^_]+?)_([^]*?)_EMO_/g,l=function(e){return 45===e.charCodeAt(1)},c=function(e){return null!=e&&"boolean"!==typeof e},h=(0,r.A)((function(e){return l(e)?e:e.replace(a,"-$&").toLowerCase()})),d=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(o,(function(e,t,i){return f={name:t,styles:i,next:f},t}))}return 1===n[e]||l(e)||"number"!==typeof t||0===t?t:t+"px"},u="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function p(e,t,i){if(null==i)return"";var n=i;if(void 0!==n.__emotion_styles)return n;switch(typeof i){case"boolean":return"";case"object":var r=i;if(1===r.anim)return f={name:r.name,styles:r.styles,next:f},r.name;var a=i;if(void 0!==a.styles){var o=a.next;if(void 0!==o)for(;void 0!==o;)f={name:o.name,styles:o.styles,next:f},o=o.next;return a.styles+";"}return function(e,t,i){var n="";if(Array.isArray(i))for(var r=0;r<i.length;r++)n+=p(e,t,i[r])+";";else for(var a in i){var o=i[a];if("object"!==typeof o){var l=o;null!=t&&void 0!==t[l]?n+=a+"{"+t[l]+"}":c(l)&&(n+=h(a)+":"+d(a,l)+";")}else{if("NO_COMPONENT_SELECTOR"===a&&s)throw new Error(u);if(!Array.isArray(o)||"string"!==typeof o[0]||null!=t&&void 0!==t[o[0]]){var f=p(e,t,o);switch(a){case"animation":case"animationName":n+=h(a)+":"+f+";";break;default:n+=a+"{"+f+"}"}}else for(var m=0;m<o.length;m++)c(o[m])&&(n+=h(a)+":"+d(a,o[m])+";")}}return n}(e,t,i);case"function":if(void 0!==e){var l=f,m=i(e);return f=l,p(e,t,m)}}var g=i;if(null==t)return g;var v=t[g];return void 0!==v?v:g}var f,m=/label:\s*([^\s;\n{]+)\s*(;|$)/g;function g(e,t,i){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var n=!0,r="";f=void 0;var s=e[0];null==s||void 0===s.raw?(n=!1,r+=p(i,t,s)):r+=s[0];for(var a=1;a<e.length;a++){if(r+=p(i,t,e[a]),n)r+=s[a]}m.lastIndex=0;for(var o,l="";null!==(o=m.exec(r));)l+="-"+o[1];var c=function(e){for(var t,i=0,n=0,r=e.length;r>=4;++n,r-=4)t=1540483477*(65535&(t=255&e.charCodeAt(n)|(255&e.charCodeAt(++n))<<8|(255&e.charCodeAt(++n))<<16|(255&e.charCodeAt(++n))<<24))+(59797*(t>>>16)<<16),i=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&i)+(59797*(i>>>16)<<16);switch(r){case 3:i^=(255&e.charCodeAt(n+2))<<16;case 2:i^=(255&e.charCodeAt(n+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(n)))+(59797*(i>>>16)<<16)}return(((i=1540483477*(65535&(i^=i>>>13))+(59797*(i>>>16)<<16))^i>>>15)>>>0).toString(36)}(r)+l;return{name:c,styles:r,next:f}}},9436:(e,t,i)=>{"use strict";var n;i.d(t,{i:()=>o,s:()=>a});var r=i(5043),s=!!(n||(n=i.t(r,2))).useInsertionEffect&&(n||(n=i.t(r,2))).useInsertionEffect,a=s||function(e){return e()},o=s||r.useLayoutEffect},1722:(e,t,i)=>{"use strict";i.d(t,{Rk:()=>n,SF:()=>r,sk:()=>s});function n(e,t,i){var n="";return i.split(" ").forEach((function(i){void 0!==e[i]?t.push(e[i]+";"):n+=i+" "})),n}var r=function(e,t,i){var n=e.key+"-"+t.name;!1===i&&void 0===e.registered[n]&&(e.registered[n]=t.styles)},s=function(e,t,i){r(e,t,i);var n=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var s=t;do{e.insert(t===s?"."+n:"",s,e.sheet,!0),s=s.next}while(void 0!==s)}}},5881:(e,t)=>{"use strict";var i,n=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),h=Symbol.for("react.server_context"),d=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.offscreen");function v(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case s:case o:case a:case u:case p:return e;default:switch(e=e&&e.$$typeof){case h:case c:case d:case m:case f:case l:return e;default:return t}}case r:return t}}}i=Symbol.for("react.module.reference")},805:(e,t,i)=>{"use strict";i(5881)},869:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});i(5043);var n=i(3290),r=i(579);function s(e){const{styles:t,defaultTheme:i={}}=e,s="function"===typeof t?e=>{return t(void 0===(n=e)||null===n||0===Object.keys(n).length?i:e);var n}:t;return(0,r.jsx)(n.mL,{styles:s})}},3174:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalStyles:()=>S.A,StyledEngineProvider:()=>w,ThemeContext:()=>l.T,css:()=>y.AH,default:()=>_,internal_processStyles:()=>E,keyframes:()=>y.i7});var n=i(8168),r=i(5043),s=i(918),a=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,o=(0,s.A)((function(e){return a.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),l=i(4575),c=i(1722),h=i(6598),d=i(9436),u=o,p=function(e){return"theme"!==e},f=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?u:p},m=function(e,t,i){var n;if(t){var r=t.shouldForwardProp;n=e.__emotion_forwardProp&&r?function(t){return e.__emotion_forwardProp(t)&&r(t)}:r}return"function"!==typeof n&&i&&(n=e.__emotion_forwardProp),n},g=function(e){var t=e.cache,i=e.serialized,n=e.isStringTag;return(0,c.SF)(t,i,n),(0,d.s)((function(){return(0,c.sk)(t,i,n)})),null},v=function e(t,i){var s,a,o=t.__emotion_real===t,d=o&&t.__emotion_base||t;void 0!==i&&(s=i.label,a=i.target);var u=m(t,i,o),p=u||f(d),v=!p("as");return function(){var y=arguments,b=o&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==s&&b.push("label:"+s+";"),null==y[0]||void 0===y[0].raw)b.push.apply(b,y);else{b.push(y[0][0]);for(var A=y.length,x=1;x<A;x++)b.push(y[x],y[0][x])}var w=(0,l.w)((function(e,t,i){var n=v&&e.as||d,s="",o=[],m=e;if(null==e.theme){for(var y in m={},e)m[y]=e[y];m.theme=r.useContext(l.T)}"string"===typeof e.className?s=(0,c.Rk)(t.registered,o,e.className):null!=e.className&&(s=e.className+" ");var A=(0,h.J)(b.concat(o),t.registered,m);s+=t.key+"-"+A.name,void 0!==a&&(s+=" "+a);var x=v&&void 0===u?f(n):p,w={};for(var S in e)v&&"as"===S||x(S)&&(w[S]=e[S]);return w.className=s,i&&(w.ref=i),r.createElement(r.Fragment,null,r.createElement(g,{cache:t,serialized:A,isStringTag:"string"===typeof n}),r.createElement(n,w))}));return w.displayName=void 0!==s?s:"Styled("+("string"===typeof d?d:d.displayName||d.name||"Component")+")",w.defaultProps=t.defaultProps,w.__emotion_real=w,w.__emotion_base=d,w.__emotion_styles=b,w.__emotion_forwardProp=u,Object.defineProperty(w,"toString",{value:function(){return"."+a}}),w.withComponent=function(t,r){return e(t,(0,n.A)({},i,r,{shouldForwardProp:m(w,r,!0)})).apply(void 0,b)},w}}.bind();["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){v[e]=v(e)}));var y=i(3290),b=i(3803),A=i(579);let x;function w(e){const{injectFirst:t,children:i}=e;return t&&x?(0,A.jsx)(l.C,{value:x,children:i}):i}"object"===typeof document&&(x=(0,b.A)({key:"css",prepend:!0}));var S=i(869);function _(e,t){return v(e,t)}const E=(e,t)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))}},7266:(e,t,i)=>{"use strict";var n=i(4994);t.X4=p,t.e$=f,t.eM=function(e,t){const i=u(e),n=u(t);return(Math.max(i,n)+.05)/(Math.min(i,n)+.05)},t.a=m;var r=n(i(457)),s=n(i(6531));function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,s.default)(e,t,i)}function o(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let i=e.match(t);return i&&1===i[0].length&&(i=i.map((e=>e+e))),i?`rgb${4===i.length?"a":""}(${i.map(((e,t)=>t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3)).join(", ")})`:""}function l(e){if(e.type)return e;if("#"===e.charAt(0))return l(o(e));const t=e.indexOf("("),i=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(i))throw new Error((0,r.default)(9,e));let n,s=e.substring(t+1,e.length-1);if("color"===i){if(s=s.split(" "),n=s.shift(),4===s.length&&"/"===s[3].charAt(0)&&(s[3]=s[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(n))throw new Error((0,r.default)(10,n))}else s=s.split(",");return s=s.map((e=>parseFloat(e))),{type:i,values:s,colorSpace:n}}const c=e=>{const t=l(e);return t.values.slice(0,3).map(((e,i)=>-1!==t.type.indexOf("hsl")&&0!==i?`${e}%`:e)).join(" ")};function h(e){const{type:t,colorSpace:i}=e;let{values:n}=e;return-1!==t.indexOf("rgb")?n=n.map(((e,t)=>t<3?parseInt(e,10):e)):-1!==t.indexOf("hsl")&&(n[1]=`${n[1]}%`,n[2]=`${n[2]}%`),n=-1!==t.indexOf("color")?`${i} ${n.join(" ")}`:`${n.join(", ")}`,`${t}(${n})`}function d(e){e=l(e);const{values:t}=e,i=t[0],n=t[1]/100,r=t[2]/100,s=n*Math.min(r,1-r),a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+i/30)%12;return r-s*Math.max(Math.min(t-3,9-t,1),-1)};let o="rgb";const c=[Math.round(255*a(0)),Math.round(255*a(8)),Math.round(255*a(4))];return"hsla"===e.type&&(o+="a",c.push(t[3])),h({type:o,values:c})}function u(e){let t="hsl"===(e=l(e)).type||"hsla"===e.type?l(d(e)).values:e.values;return t=t.map((t=>("color"!==e.type&&(t/=255),t<=.03928?t/12.92:((t+.055)/1.055)**2.4))),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function p(e,t){return e=l(e),t=a(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]=`/${t}`:e.values[3]=t,h(e)}function f(e,t){if(e=l(e),t=a(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(let i=0;i<3;i+=1)e.values[i]*=1-t;return h(e)}function m(e,t){if(e=l(e),t=a(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(let i=0;i<3;i+=1)e.values[i]+=(255-e.values[i])*t;else if(-1!==e.type.indexOf("color"))for(let i=0;i<3;i+=1)e.values[i]+=(1-e.values[i])*t;return h(e)}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;return u(e)>.5?f(e,t):m(e,t)}},8052:(e,t,i)=>{"use strict";var n=i(4994);t.Ay=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:i=m,rootShouldForwardProp:n=f,slotShouldForwardProp:l=f}=e,h=e=>(0,c.default)((0,r.default)({},e,{theme:v((0,r.default)({},e,{defaultTheme:i,themeId:t}))}));return h.__mui_systemSx=!0,function(e){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.internal_processStyles)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:d,slot:p,skipVariantsResolver:m,skipSx:A,overridesResolver:x=y(g(p))}=c,w=(0,s.default)(c,u),S=void 0!==m?m:p&&"Root"!==p&&"root"!==p||!1,_=A||!1;let E=f;"Root"===p||"root"===p?E=n:p?E=l:function(e){return"string"===typeof e&&e.charCodeAt(0)>96}(e)&&(E=void 0);const C=(0,a.default)(e,(0,r.default)({shouldForwardProp:E,label:undefined},w)),M=e=>"function"===typeof e&&e.__emotion_real!==e||(0,o.isPlainObject)(e)?n=>b(e,(0,r.default)({},n,{theme:v({theme:n.theme,defaultTheme:i,themeId:t})})):e,T=function(n){let s=M(n);for(var a=arguments.length,o=new Array(a>1?a-1:0),l=1;l<a;l++)o[l-1]=arguments[l];const c=o?o.map(M):[];d&&x&&c.push((e=>{const n=v((0,r.default)({},e,{defaultTheme:i,themeId:t}));if(!n.components||!n.components[d]||!n.components[d].styleOverrides)return null;const s=n.components[d].styleOverrides,a={};return Object.entries(s).forEach((t=>{let[i,s]=t;a[i]=b(s,(0,r.default)({},e,{theme:n}))})),x(e,a)})),d&&!S&&c.push((e=>{var n;const s=v((0,r.default)({},e,{defaultTheme:i,themeId:t}));return b({variants:null==s||null==(n=s.components)||null==(n=n[d])?void 0:n.variants},(0,r.default)({},e,{theme:s}))})),_||c.push(h);const u=c.length-o.length;if(Array.isArray(n)&&u>0){const e=new Array(u).fill("");s=[...n,...e],s.raw=[...n.raw,...e]}const p=C(s,...c);return e.muiName&&(p.muiName=e.muiName),p};return C.withConfig&&(T.withConfig=C.withConfig),T}};var r=n(i(4634)),s=n(i(4893)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=p(t);if(i&&i.has(e))return i.get(e);var n={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=r?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(i(3174)),o=i(9482),l=(n(i(7918)),n(i(3382)),n(i(4989))),c=n(i(3234));const h=["ownerState"],d=["variants"],u=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(p=function(e){return e?i:t})(e)}function f(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const m=(0,l.default)(),g=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function v(e){let{defaultTheme:t,theme:i,themeId:n}=e;return r=i,0===Object.keys(r).length?t:i[n]||i;var r}function y(e){return e?(t,i)=>i[e]:null}function b(e,t){let{ownerState:i}=t,n=(0,s.default)(t,h);const a="function"===typeof e?e((0,r.default)({ownerState:i},n)):e;if(Array.isArray(a))return a.flatMap((e=>b(e,(0,r.default)({ownerState:i},n))));if(a&&"object"===typeof a&&Array.isArray(a.variants)){const{variants:e=[]}=a;let t=(0,s.default)(a,d);return e.forEach((e=>{let s=!0;"function"===typeof e.props?s=e.props((0,r.default)({ownerState:i},n,i)):Object.keys(e.props).forEach((t=>{(null==i?void 0:i[t])!==e.props[t]&&n[t]!==e.props[t]&&(s=!1)})),s&&(Array.isArray(t)||(t=[t]),t.push("function"===typeof e.style?e.style((0,r.default)({ownerState:i},n,i)):e.style))})),t}return a}},9751:(e,t,i)=>{"use strict";i.d(t,{EU:()=>o,NI:()=>a,iZ:()=>c,kW:()=>h,vf:()=>l,zu:()=>r});var n=i(9172);const r={xs:0,sm:600,md:900,lg:1200,xl:1536},s={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${r[e]}px)`};function a(e,t,i){const n=e.theme||{};if(Array.isArray(t)){const e=n.breakpoints||s;return t.reduce(((n,r,s)=>(n[e.up(e.keys[s])]=i(t[s]),n)),{})}if("object"===typeof t){const e=n.breakpoints||s;return Object.keys(t).reduce(((n,s)=>{if(-1!==Object.keys(e.values||r).indexOf(s)){n[e.up(s)]=i(t[s],s)}else{const e=s;n[e]=t[e]}return n}),{})}return i(t)}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;return(null==(t=e.keys)?void 0:t.reduce(((t,i)=>(t[e.up(i)]={},t)),{}))||{}}function l(e,t){return e.reduce(((e,t)=>{const i=e[t];return(!i||0===Object.keys(i).length)&&delete e[t],e}),t)}function c(e){const t=o(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];const a=[t,...r].reduce(((e,t)=>(0,n.A)(e,t)),{});return l(Object.keys(t),a)}function h(e){let{values:t,breakpoints:i,base:n}=e;const r=n||function(e,t){if("object"!==typeof e)return{};const i={},n=Object.keys(t);return Array.isArray(e)?n.forEach(((t,n)=>{n<e.length&&(i[t]=!0)})):n.forEach((t=>{null!=e[t]&&(i[t]=!0)})),i}(t,i),s=Object.keys(r);if(0===s.length)return t;let a;return s.reduce(((e,i,n)=>(Array.isArray(t)?(e[i]=null!=t[n]?t[n]:t[a],a=n):"object"===typeof t?(e[i]=null!=t[i]?t[i]:t[a],a=i):e[i]=t,e)),{})}},9703:(e,t,i)=>{"use strict";function n(e,t){const i=this;if(i.vars&&"function"===typeof i.getColorSchemeSelector){const n=i.getColorSchemeSelector(e).replace(/(\[[^\]]+\])/,"*:where($1)");return{[n]:t}}return i.palette.mode===e?t:{}}i.d(t,{A:()=>n})},4853:(e,t,i)=>{"use strict";i.d(t,{A:()=>o});var n=i(8587),r=i(8168);const s=["values","unit","step"],a=e=>{const t=Object.keys(e).map((t=>({key:t,val:e[t]})))||[];return t.sort(((e,t)=>e.val-t.val)),t.reduce(((e,t)=>(0,r.A)({},e,{[t.key]:t.val})),{})};function o(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:i="px",step:o=5}=e,l=(0,n.A)(e,s),c=a(t),h=Object.keys(c);function d(e){return`@media (min-width:${"number"===typeof t[e]?t[e]:e}${i})`}function u(e){return`@media (max-width:${("number"===typeof t[e]?t[e]:e)-o/100}${i})`}function p(e,n){const r=h.indexOf(n);return`@media (min-width:${"number"===typeof t[e]?t[e]:e}${i}) and (max-width:${(-1!==r&&"number"===typeof t[h[r]]?t[h[r]]:n)-o/100}${i})`}return(0,r.A)({keys:h,values:c,up:d,down:u,between:p,only:function(e){return h.indexOf(e)+1<h.length?p(e,h[h.indexOf(e)+1]):d(e)},not:function(e){const t=h.indexOf(e);return 0===t?d(h[1]):t===h.length-1?u(h[t]):p(e,h[h.indexOf(e)+1]).replace("@media","@media not all and")},unit:i},l)}},8280:(e,t,i)=>{"use strict";i.d(t,{A:()=>p});var n=i(8168),r=i(8587),s=i(9172),a=i(4853);const o={borderRadius:4};var l=i(8604);var c=i(8812),h=i(7758),d=i(9703);const u=["breakpoints","palette","spacing","shape"];const p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{breakpoints:t={},palette:i={},spacing:p,shape:f={}}=e,m=(0,r.A)(e,u),g=(0,a.A)(t),v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;const t=(0,l.LX)({spacing:e}),i=function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return(0===i.length?[1]:i).map((e=>{const i=t(e);return"number"===typeof i?`${i}px`:i})).join(" ")};return i.mui=!0,i}(p);let y=(0,s.A)({breakpoints:g,direction:"ltr",components:{},palette:(0,n.A)({mode:"light"},i),spacing:v,shape:(0,n.A)({},o,f)},m);y.applyStyles=d.A;for(var b=arguments.length,A=new Array(b>1?b-1:0),x=1;x<b;x++)A[x-1]=arguments[x];return y=A.reduce(((e,t)=>(0,s.A)(e,t)),y),y.unstable_sxConfig=(0,n.A)({},h.A,null==m?void 0:m.unstable_sxConfig),y.unstable_sx=function(e){return(0,c.A)({sx:e,theme:this})},y}},4989:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n.A,private_createBreakpoints:()=>r.A,unstable_applyStyles:()=>s.A});var n=i(8280),r=i(4853),s=i(9703)},3815:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});var n=i(9172);const r=function(e,t){return t?(0,n.A)(e,t,{clone:!1}):e}},8604:(e,t,i)=>{"use strict";i.d(t,{LX:()=>f,MA:()=>p,_W:()=>m,Lc:()=>y,Ms:()=>b});var n=i(9751),r=i(7162),s=i(3815);const a={m:"margin",p:"padding"},o={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},l={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},c=function(e){const t={};return i=>(void 0===t[i]&&(t[i]=e(i)),t[i])}((e=>{if(e.length>2){if(!l[e])return[e];e=l[e]}const[t,i]=e.split(""),n=a[t],r=o[i]||"";return Array.isArray(r)?r.map((e=>n+e)):[n+r]})),h=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],d=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],u=[...h,...d];function p(e,t,i,n){var s;const a=null!=(s=(0,r.Yn)(e,t,!1))?s:i;return"number"===typeof a?e=>"string"===typeof e?e:a*e:Array.isArray(a)?e=>"string"===typeof e?e:a[e]:"function"===typeof a?a:()=>{}}function f(e){return p(e,"spacing",8)}function m(e,t){if("string"===typeof t||null==t)return t;const i=e(Math.abs(t));return t>=0?i:"number"===typeof i?-i:`-${i}`}function g(e,t,i,r){if(-1===t.indexOf(i))return null;const s=function(e,t){return i=>e.reduce(((e,n)=>(e[n]=m(t,i),e)),{})}(c(i),r),a=e[i];return(0,n.NI)(e,a,s)}function v(e,t){const i=f(e.theme);return Object.keys(e).map((n=>g(e,t,n,i))).reduce(s.A,{})}function y(e){return v(e,h)}function b(e){return v(e,d)}function A(e){return v(e,u)}y.propTypes={},y.filterProps=h,b.propTypes={},b.filterProps=d,A.propTypes={},A.filterProps=u},7162:(e,t,i)=>{"use strict";i.d(t,{Ay:()=>o,BO:()=>a,Yn:()=>s});var n=i(7598),r=i(9751);function s(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!==typeof t)return null;if(e&&e.vars&&i){const i=`vars.${t}`.split(".").reduce(((e,t)=>e&&e[t]?e[t]:null),e);if(null!=i)return i}return t.split(".").reduce(((e,t)=>e&&null!=e[t]?e[t]:null),e)}function a(e,t,i){let n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i;return n="function"===typeof e?e(i):Array.isArray(e)?e[i]||r:s(e,i)||r,t&&(n=t(n,r,e)),n}const o=function(e){const{prop:t,cssProperty:i=e.prop,themeKey:o,transform:l}=e,c=e=>{if(null==e[t])return null;const c=e[t],h=s(e.theme,o)||{};return(0,r.NI)(e,c,(e=>{let r=a(h,l,e);return e===r&&"string"===typeof e&&(r=a(h,l,`${t}${"default"===e?"":(0,n.A)(e)}`,e)),!1===i?r:{[i]:r}}))};return c.propTypes={},c.filterProps=[t],c}},7758:(e,t,i)=>{"use strict";i.d(t,{A:()=>L});var n=i(8604),r=i(7162),s=i(3815);const a=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const n=t.reduce(((e,t)=>(t.filterProps.forEach((i=>{e[i]=t})),e)),{}),r=e=>Object.keys(e).reduce(((t,i)=>n[i]?(0,s.A)(t,n[i](e)):t),{});return r.propTypes={},r.filterProps=t.reduce(((e,t)=>e.concat(t.filterProps)),[]),r};var o=i(9751);function l(e){return"number"!==typeof e?e:`${e}px solid`}function c(e,t){return(0,r.Ay)({prop:e,themeKey:"borders",transform:t})}const h=c("border",l),d=c("borderTop",l),u=c("borderRight",l),p=c("borderBottom",l),f=c("borderLeft",l),m=c("borderColor"),g=c("borderTopColor"),v=c("borderRightColor"),y=c("borderBottomColor"),b=c("borderLeftColor"),A=c("outline",l),x=c("outlineColor"),w=e=>{if(void 0!==e.borderRadius&&null!==e.borderRadius){const t=(0,n.MA)(e.theme,"shape.borderRadius",4,"borderRadius"),i=e=>({borderRadius:(0,n._W)(t,e)});return(0,o.NI)(e,e.borderRadius,i)}return null};w.propTypes={},w.filterProps=["borderRadius"];a(h,d,u,p,f,m,g,v,y,b,w,A,x);const S=e=>{if(void 0!==e.gap&&null!==e.gap){const t=(0,n.MA)(e.theme,"spacing",8,"gap"),i=e=>({gap:(0,n._W)(t,e)});return(0,o.NI)(e,e.gap,i)}return null};S.propTypes={},S.filterProps=["gap"];const _=e=>{if(void 0!==e.columnGap&&null!==e.columnGap){const t=(0,n.MA)(e.theme,"spacing",8,"columnGap"),i=e=>({columnGap:(0,n._W)(t,e)});return(0,o.NI)(e,e.columnGap,i)}return null};_.propTypes={},_.filterProps=["columnGap"];const E=e=>{if(void 0!==e.rowGap&&null!==e.rowGap){const t=(0,n.MA)(e.theme,"spacing",8,"rowGap"),i=e=>({rowGap:(0,n._W)(t,e)});return(0,o.NI)(e,e.rowGap,i)}return null};E.propTypes={},E.filterProps=["rowGap"];a(S,_,E,(0,r.Ay)({prop:"gridColumn"}),(0,r.Ay)({prop:"gridRow"}),(0,r.Ay)({prop:"gridAutoFlow"}),(0,r.Ay)({prop:"gridAutoColumns"}),(0,r.Ay)({prop:"gridAutoRows"}),(0,r.Ay)({prop:"gridTemplateColumns"}),(0,r.Ay)({prop:"gridTemplateRows"}),(0,r.Ay)({prop:"gridTemplateAreas"}),(0,r.Ay)({prop:"gridArea"}));function C(e,t){return"grey"===t?t:e}a((0,r.Ay)({prop:"color",themeKey:"palette",transform:C}),(0,r.Ay)({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:C}),(0,r.Ay)({prop:"backgroundColor",themeKey:"palette",transform:C}));function M(e){return e<=1&&0!==e?100*e+"%":e}const T=(0,r.Ay)({prop:"width",transform:M}),I=e=>{if(void 0!==e.maxWidth&&null!==e.maxWidth){const t=t=>{var i,n;const r=(null==(i=e.theme)||null==(i=i.breakpoints)||null==(i=i.values)?void 0:i[t])||o.zu[t];return r?"px"!==(null==(n=e.theme)||null==(n=n.breakpoints)?void 0:n.unit)?{maxWidth:`${r}${e.theme.breakpoints.unit}`}:{maxWidth:r}:{maxWidth:M(t)}};return(0,o.NI)(e,e.maxWidth,t)}return null};I.filterProps=["maxWidth"];const P=(0,r.Ay)({prop:"minWidth",transform:M}),D=(0,r.Ay)({prop:"height",transform:M}),R=(0,r.Ay)({prop:"maxHeight",transform:M}),B=(0,r.Ay)({prop:"minHeight",transform:M}),L=((0,r.Ay)({prop:"size",cssProperty:"width",transform:M}),(0,r.Ay)({prop:"size",cssProperty:"height",transform:M}),a(T,I,P,D,R,B,(0,r.Ay)({prop:"boxSizing"})),{border:{themeKey:"borders",transform:l},borderTop:{themeKey:"borders",transform:l},borderRight:{themeKey:"borders",transform:l},borderBottom:{themeKey:"borders",transform:l},borderLeft:{themeKey:"borders",transform:l},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:l},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:w},color:{themeKey:"palette",transform:C},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:C},backgroundColor:{themeKey:"palette",transform:C},p:{style:n.Ms},pt:{style:n.Ms},pr:{style:n.Ms},pb:{style:n.Ms},pl:{style:n.Ms},px:{style:n.Ms},py:{style:n.Ms},padding:{style:n.Ms},paddingTop:{style:n.Ms},paddingRight:{style:n.Ms},paddingBottom:{style:n.Ms},paddingLeft:{style:n.Ms},paddingX:{style:n.Ms},paddingY:{style:n.Ms},paddingInline:{style:n.Ms},paddingInlineStart:{style:n.Ms},paddingInlineEnd:{style:n.Ms},paddingBlock:{style:n.Ms},paddingBlockStart:{style:n.Ms},paddingBlockEnd:{style:n.Ms},m:{style:n.Lc},mt:{style:n.Lc},mr:{style:n.Lc},mb:{style:n.Lc},ml:{style:n.Lc},mx:{style:n.Lc},my:{style:n.Lc},margin:{style:n.Lc},marginTop:{style:n.Lc},marginRight:{style:n.Lc},marginBottom:{style:n.Lc},marginLeft:{style:n.Lc},marginX:{style:n.Lc},marginY:{style:n.Lc},marginInline:{style:n.Lc},marginInlineStart:{style:n.Lc},marginInlineEnd:{style:n.Lc},marginBlock:{style:n.Lc},marginBlockStart:{style:n.Lc},marginBlockEnd:{style:n.Lc},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:S},rowGap:{style:E},columnGap:{style:_},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:M},maxWidth:{style:I},minWidth:{transform:M},height:{transform:M},maxHeight:{transform:M},minHeight:{transform:M},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}})},8698:(e,t,i)=>{"use strict";i.d(t,{A:()=>c});var n=i(8168),r=i(8587),s=i(9172),a=i(7758);const o=["sx"],l=e=>{var t,i;const n={systemProps:{},otherProps:{}},r=null!=(t=null==e||null==(i=e.theme)?void 0:i.unstable_sxConfig)?t:a.A;return Object.keys(e).forEach((t=>{r[t]?n.systemProps[t]=e[t]:n.otherProps[t]=e[t]})),n};function c(e){const{sx:t}=e,i=(0,r.A)(e,o),{systemProps:a,otherProps:c}=l(i);let h;return h=Array.isArray(t)?[a,...t]:"function"===typeof t?function(){const e=t(...arguments);return(0,s.Q)(e)?(0,n.A)({},a,e):a}:(0,n.A)({},a,t),(0,n.A)({},c,{sx:h})}},3234:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n.A,extendSxProp:()=>r.A,unstable_createStyleFunctionSx:()=>n.k,unstable_defaultSxConfig:()=>s.A});var n=i(8812),r=i(8698),s=i(7758)},8812:(e,t,i)=>{"use strict";i.d(t,{A:()=>h,k:()=>l});var n=i(7598),r=i(3815),s=i(7162),a=i(9751),o=i(7758);function l(){function e(e,t,i,r){const o={[e]:t,theme:i},l=r[e];if(!l)return{[e]:t};const{cssProperty:c=e,themeKey:h,transform:d,style:u}=l;if(null==t)return null;if("typography"===h&&"inherit"===t)return{[e]:t};const p=(0,s.Yn)(i,h)||{};if(u)return u(o);return(0,a.NI)(o,t,(t=>{let i=(0,s.BO)(p,d,t);return t===i&&"string"===typeof t&&(i=(0,s.BO)(p,d,`${e}${"default"===t?"":(0,n.A)(t)}`,t)),!1===c?i:{[c]:i}}))}return function t(i){var n;const{sx:s,theme:l={}}=i||{};if(!s)return null;const c=null!=(n=l.unstable_sxConfig)?n:o.A;function h(i){let n=i;if("function"===typeof i)n=i(l);else if("object"!==typeof i)return i;if(!n)return null;const s=(0,a.EU)(l.breakpoints),o=Object.keys(s);let h=s;return Object.keys(n).forEach((i=>{const s=(o=n[i],d=l,"function"===typeof o?o(d):o);var o,d;if(null!==s&&void 0!==s)if("object"===typeof s)if(c[i])h=(0,r.A)(h,e(i,s,l,c));else{const e=(0,a.NI)({theme:l},s,(e=>({[i]:e})));!function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const n=t.reduce(((e,t)=>e.concat(Object.keys(t))),[]),r=new Set(n);return t.every((e=>r.size===Object.keys(e).length))}(e,s)?h=(0,r.A)(h,e):h[i]=t({sx:s,theme:l})}else h=(0,r.A)(h,e(i,s,l,c))})),(0,a.vf)(o,h)}return Array.isArray(s)?s.map(h):h(s)}}const c=l();c.filterProps=["sx"];const h=c},7598:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});var n=i(7868);function r(e){if("string"!==typeof e)throw new Error((0,n.A)(7));return e.charAt(0).toUpperCase()+e.slice(1)}},7918:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n.A});var n=i(7598)},1188:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MIN_SAFE_INTEGER,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_SAFE_INTEGER;return Math.max(t,Math.min(e,i))}},6531:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n.A});var n=i(1188)},9172:(e,t,i)=>{"use strict";i.d(t,{A:()=>a,Q:()=>r});var n=i(8168);function r(e){if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function s(e){if(!r(e))return e;const t={};return Object.keys(e).forEach((i=>{t[i]=s(e[i])})),t}function a(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0};const o=i.clone?(0,n.A)({},e):e;return r(e)&&r(t)&&Object.keys(t).forEach((n=>{r(t[n])&&Object.prototype.hasOwnProperty.call(e,n)&&r(e[n])?o[n]=a(e[n],t[n],i):i.clone?o[n]=r(t[n])?s(t[n]):t[n]:o[n]=t[n]})),o}},9482:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n.A,isPlainObject:()=>n.Q});var n=i(9172)},7868:(e,t,i)=>{"use strict";function n(e){let t="https://mui.com/production-error/?code="+e;for(let i=1;i<arguments.length;i+=1)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}i.d(t,{A:()=>n})},457:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n.A});var n=i(7868)},3382:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l,getFunctionName:()=>s});var n=i(9565);const r=/^\s*function(?:\s|\s*\/\*.*\*\/\s*)+([^(\s/]*)\s*/;function s(e){const t=`${e}`.match(r);return t&&t[1]||""}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.displayName||e.name||s(e)||t}function o(e,t,i){const n=a(t);return e.displayName||(""!==n?`${i}(${n})`:i)}function l(e){if(null!=e){if("string"===typeof e)return e;if("function"===typeof e)return a(e,"Component");if("object"===typeof e)switch(e.$$typeof){case n.ForwardRef:return o(e,e.render,"ForwardRef");case n.Memo:return o(e,e.type,"memo");default:return}}}},8609:(e,t)=>{"use strict";var i,n=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),h=Symbol.for("react.server_context"),d=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.offscreen");function v(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case s:case o:case a:case u:case p:return e;default:switch(e=e&&e.$$typeof){case h:case c:case d:case m:case f:case l:return e;default:return t}}case r:return t}}}i=Symbol.for("react.module.reference"),t.ForwardRef=d,t.Memo=f},9565:(e,t,i)=>{"use strict";e.exports=i(8609)},219:(e,t,i)=>{"use strict";var n=i(3763),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},o={};function l(e){return n.isMemo(e)?a:o[e.$$typeof]||r}o[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},o[n.Memo]=a;var c=Object.defineProperty,h=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,u=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,i,n){if("string"!==typeof i){if(f){var r=p(i);r&&r!==f&&e(t,r,n)}var a=h(i);d&&(a=a.concat(d(i)));for(var o=l(t),m=l(i),g=0;g<a.length;++g){var v=a[g];if(!s[v]&&(!n||!n[v])&&(!m||!m[v])&&(!o||!o[v])){var y=u(i,v);try{c(t,v,y)}catch(b){}}}}return t}},4983:(e,t)=>{"use strict";var i="function"===typeof Symbol&&Symbol.for,n=i?Symbol.for("react.element"):60103,r=i?Symbol.for("react.portal"):60106,s=i?Symbol.for("react.fragment"):60107,a=i?Symbol.for("react.strict_mode"):60108,o=i?Symbol.for("react.profiler"):60114,l=i?Symbol.for("react.provider"):60109,c=i?Symbol.for("react.context"):60110,h=i?Symbol.for("react.async_mode"):60111,d=i?Symbol.for("react.concurrent_mode"):60111,u=i?Symbol.for("react.forward_ref"):60112,p=i?Symbol.for("react.suspense"):60113,f=i?Symbol.for("react.suspense_list"):60120,m=i?Symbol.for("react.memo"):60115,g=i?Symbol.for("react.lazy"):60116,v=i?Symbol.for("react.block"):60121,y=i?Symbol.for("react.fundamental"):60117,b=i?Symbol.for("react.responder"):60118,A=i?Symbol.for("react.scope"):60119;function x(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case h:case d:case s:case o:case a:case p:return e;default:switch(e=e&&e.$$typeof){case c:case u:case g:case m:case l:return e;default:return t}}case r:return t}}}function w(e){return x(e)===d}t.AsyncMode=h,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=l,t.Element=n,t.ForwardRef=u,t.Fragment=s,t.Lazy=g,t.Memo=m,t.Portal=r,t.Profiler=o,t.StrictMode=a,t.Suspense=p,t.isAsyncMode=function(e){return w(e)||x(e)===h},t.isConcurrentMode=w,t.isContextConsumer=function(e){return x(e)===c},t.isContextProvider=function(e){return x(e)===l},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return x(e)===u},t.isFragment=function(e){return x(e)===s},t.isLazy=function(e){return x(e)===g},t.isMemo=function(e){return x(e)===m},t.isPortal=function(e){return x(e)===r},t.isProfiler=function(e){return x(e)===o},t.isStrictMode=function(e){return x(e)===a},t.isSuspense=function(e){return x(e)===p},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===s||e===d||e===o||e===a||e===p||e===f||"object"===typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===l||e.$$typeof===c||e.$$typeof===u||e.$$typeof===y||e.$$typeof===b||e.$$typeof===A||e.$$typeof===v)},t.typeOf=x},3763:(e,t,i)=>{"use strict";e.exports=i(4983)},446:(e,t,i)=>{var n=NaN,r="[object Symbol]",s=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,l=/^0o[0-7]+$/i,c=parseInt,h="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,d="object"==typeof self&&self&&self.Object===Object&&self,u=h||d||Function("return this")(),p=Object.prototype.toString,f=Math.max,m=Math.min,g=function(){return u.Date.now()};function v(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function y(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&p.call(e)==r}(e))return n;if(v(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=v(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var i=o.test(e);return i||l.test(e)?c(e.slice(2),i?2:8):a.test(e)?n:+e}e.exports=function(e,t,i){var n,r,s,a,o,l,c=0,h=!1,d=!1,u=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var i=n,s=r;return n=r=void 0,c=t,a=e.apply(s,i)}function b(e){var i=e-l;return void 0===l||i>=t||i<0||d&&e-c>=s}function A(){var e=g();if(b(e))return x(e);o=setTimeout(A,function(e){var i=t-(e-l);return d?m(i,s-(e-c)):i}(e))}function x(e){return o=void 0,u&&n?p(e):(n=r=void 0,a)}function w(){var e=g(),i=b(e);if(n=arguments,r=this,l=e,i){if(void 0===o)return function(e){return c=e,o=setTimeout(A,t),h?p(e):a}(l);if(d)return o=setTimeout(A,t),p(l)}return void 0===o&&(o=setTimeout(A,t)),a}return t=y(t)||0,v(i)&&(h=!!i.leading,s=(d="maxWait"in i)?f(y(i.maxWait)||0,t):s,u="trailing"in i?!!i.trailing:u),w.cancel=function(){void 0!==o&&clearTimeout(o),c=0,n=l=r=o=void 0},w.flush=function(){return void 0===o?a:x(g())},w}},1497:(e,t,i)=>{"use strict";var n=i(3218);function r(){}function s(){}s.resetWarningCache=r,e.exports=function(){function e(e,t,i,r,s,a){if(a!==n){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:s,resetWarningCache:r};return i.PropTypes=i,i}},5173:(e,t,i)=>{e.exports=i(1497)()},3218:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},2730:(e,t,i)=>{"use strict";var n=i(5043),r=i(8853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,i,n,r,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,i,n){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,i,n){if(null===t||"undefined"===typeof t||function(e,t,i,n){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,n))return!0;if(n)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,r,n)&&(i=null),n||null===r?function(e){return!!d.call(f,e)||!d.call(p,e)&&(u.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):r.mustUseProperty?e[r.propertyName]=null===i?3!==r.type&&"":i:(t=r.attributeName,n=r.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(r=r.type)||4===r&&!0===i?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var A=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),M=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var B=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}var N,k=Object.assign;function F(e){if(void 0===N)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);N=t&&t[1]||""}return"\n"+N+e}var U=!1;function z(e,t){if(!e||U)return"";U=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var n=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){n=c}e.call(t.prototype)}else{try{throw Error()}catch(c){n=c}e()}}catch(c){if(c&&n&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),s=n.stack.split("\n"),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==s[o]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{U=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?F(e):""}function j(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case E:return"Profiler";case _:return"StrictMode";case I:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case M:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case T:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case D:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return V(e(t))}catch(i){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Q(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof i&&"function"===typeof i.get&&"function"===typeof i.set){var r=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=W(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var i=t.checked;return k({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function K(e,t){var i=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;i=H(null!=t.value?t.value:i),e._wrapperState={initialChecked:n,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Z(e,t){J(e,t);var i=H(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,i):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function ee(e,t,i){"number"===t&&X(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var te=Array.isArray;function ie(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(i=""+H(i),t=null,r=0;r<e.length;r++){if(e[r].value===i)return e[r].selected=!0,void(n&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return k({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(s(92));if(te(i)){if(1<i.length)throw Error(s(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:H(i)}}function se(e,t){var i=H(t.value),n=H(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=n&&(e.defaultValue=""+n)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,he,de=(he=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,n){MSApp.execUnsafeLocalFunction((function(){return he(e,t)}))}:he);function ue(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,i){return null==t||"boolean"===typeof t||""===t?"":i||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var n=0===i.indexOf("--"),r=me(i,t[i],n);"float"===i&&(i="cssFloat"),n?e.setProperty(i,r):e[i]=r}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ve=k({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ae=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,_e=null;function Ee(e){if(e=br(e)){if("function"!==typeof we)throw Error(s(280));var t=e.stateNode;t&&(t=xr(t),we(e.stateNode,e.type,t))}}function Ce(e){Se?_e?_e.push(e):_e=[e]:Se=e}function Me(){if(Se){var e=Se,t=_e;if(_e=Se=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Te(e,t){return e(t)}function Ie(){}var Pe=!1;function De(e,t,i){if(Pe)return e(t,i);Pe=!0;try{return Te(e,t,i)}finally{Pe=!1,(null!==Se||null!==_e)&&(Ie(),Me())}}function Re(e,t){var i=e.stateNode;if(null===i)return null;var n=xr(i);if(null===n)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(i&&"function"!==typeof i)throw Error(s(231,t,typeof i));return i}var Be=!1;if(h)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Be=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(he){Be=!1}function Oe(e,t,i,n,r,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(h){this.onError(h)}}var Ne=!1,ke=null,Fe=!1,Ue=null,ze={onError:function(e){Ne=!0,ke=e}};function je(e,t,i,n,r,s,a,o,l){Ne=!1,ke=null,Oe.apply(ze,arguments)}function Ve(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ve(e)!==e)throw Error(s(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(s(188));return t!==e?null:e}for(var i=e,n=t;;){var r=i.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(n=r.return)){i=n;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===i)return He(r),e;if(a===n)return He(r),t;a=a.sibling}throw Error(s(188))}if(i.return!==n.return)i=r,n=a;else{for(var o=!1,l=r.child;l;){if(l===i){o=!0,i=r,n=a;break}if(l===n){o=!0,n=r,i=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===i){o=!0,i=a,n=r;break}if(l===n){o=!0,n=a,i=r;break}l=l.sibling}if(!o)throw Error(s(189))}}if(i.alternate!==n)throw Error(s(190))}if(3!==i.tag)throw Error(s(188));return i.stateNode.current===i?e:t}(e))?Qe(e):null}function Qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Qe(e);if(null!==t)return t;e=e.sibling}return null}var qe=r.unstable_scheduleCallback,Xe=r.unstable_cancelCallback,Ye=r.unstable_shouldYield,Ke=r.unstable_requestPaint,Je=r.unstable_now,Ze=r.unstable_getCurrentPriorityLevel,$e=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,it=r.unstable_LowPriority,nt=r.unstable_IdlePriority,rt=null,st=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ht=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ut(e,t){var i=e.pendingLanes;if(0===i)return 0;var n=0,r=e.suspendedLanes,s=e.pingedLanes,a=268435455&i;if(0!==a){var o=a&~r;0!==o?n=dt(o):0!==(s&=a)&&(n=dt(s))}else 0!==(a=i&~r)?n=dt(a):0!==s&&(n=dt(s));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&r)&&((r=n&-n)>=(s=t&-t)||16===r&&0!==(4194240&s)))return t;if(0!==(4&n)&&(n|=16&i),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)r=1<<(i=31-at(t)),n|=e[i],t&=~r;return n}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function vt(e,t,i){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=i}function yt(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-at(i),r=1<<n;r&t|e[n]&t&&(e[n]|=t),i&=~r}}var bt=0;function At(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,wt,St,_t,Et,Ct=!1,Mt=[],Tt=null,It=null,Pt=null,Dt=new Map,Rt=new Map,Bt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":Tt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":Dt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function Nt(e,t,i,n,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=br(t))&&wt(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function kt(e){var t=yr(e.target);if(null!==t){var i=Ve(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=Ge(i)))return e.blockedOn=t,void Et(e.priority,(function(){St(i)}))}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=br(i))&&wt(t),e.blockedOn=i,!1;var n=new(i=e.nativeEvent).constructor(i.type,i);Ae=n,i.target.dispatchEvent(n),Ae=null,t.shift()}return!0}function Ut(e,t,i){Ft(e)&&i.delete(t)}function zt(){Ct=!1,null!==Tt&&Ft(Tt)&&(Tt=null),null!==It&&Ft(It)&&(It=null),null!==Pt&&Ft(Pt)&&(Pt=null),Dt.forEach(Ut),Rt.forEach(Ut)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,zt)))}function Vt(e){function t(t){return jt(t,e)}if(0<Mt.length){jt(Mt[0],e);for(var i=1;i<Mt.length;i++){var n=Mt[i];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==Tt&&jt(Tt,e),null!==It&&jt(It,e),null!==Pt&&jt(Pt,e),Dt.forEach(t),Rt.forEach(t),i=0;i<Bt.length;i++)(n=Bt[i]).blockedOn===e&&(n.blockedOn=null);for(;0<Bt.length&&null===(i=Bt[0]).blockedOn;)kt(i),null===i.blockedOn&&Bt.shift()}var Gt=A.ReactCurrentBatchConfig,Ht=!0;function Wt(e,t,i,n){var r=bt,s=Gt.transition;Gt.transition=null;try{bt=1,qt(e,t,i,n)}finally{bt=r,Gt.transition=s}}function Qt(e,t,i,n){var r=bt,s=Gt.transition;Gt.transition=null;try{bt=4,qt(e,t,i,n)}finally{bt=r,Gt.transition=s}}function qt(e,t,i,n){if(Ht){var r=Yt(e,t,i,n);if(null===r)Hn(e,t,n,Xt,i),Ot(e,n);else if(function(e,t,i,n,r){switch(t){case"focusin":return Tt=Nt(Tt,e,t,i,n,r),!0;case"dragenter":return It=Nt(It,e,t,i,n,r),!0;case"mouseover":return Pt=Nt(Pt,e,t,i,n,r),!0;case"pointerover":var s=r.pointerId;return Dt.set(s,Nt(Dt.get(s)||null,e,t,i,n,r)),!0;case"gotpointercapture":return s=r.pointerId,Rt.set(s,Nt(Rt.get(s)||null,e,t,i,n,r)),!0}return!1}(r,e,t,i,n))n.stopPropagation();else if(Ot(e,n),4&t&&-1<Lt.indexOf(e)){for(;null!==r;){var s=br(r);if(null!==s&&xt(s),null===(s=Yt(e,t,i,n))&&Hn(e,t,n,Xt,i),s===r)break;r=s}null!==r&&n.stopPropagation()}else Hn(e,t,n,null,i)}}var Xt=null;function Yt(e,t,i,n){if(Xt=null,null!==(e=yr(e=xe(n))))if(null===(t=Ve(e)))e=null;else if(13===(i=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case it:return 16;case nt:return 536870912;default:return 16}default:return 16}}var Jt=null,Zt=null,$t=null;function ei(){if($t)return $t;var e,t,i=Zt,n=i.length,r="value"in Jt?Jt.value:Jt.textContent,s=r.length;for(e=0;e<n&&i[e]===r[e];e++);var a=n-e;for(t=1;t<=a&&i[n-t]===r[s-t];t++);return $t=r.slice(e,1<t?1-t:void 0)}function ti(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ii(){return!0}function ni(){return!1}function ri(e){function t(t,i,n,r,s){for(var a in this._reactName=t,this._targetInst=n,this.type=i,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?ii:ni,this.isPropagationStopped=ni,this}return k(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ii)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ii)},persist:function(){},isPersistent:ii}),t}var si,ai,oi,li={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ci=ri(li),hi=k({},li,{view:0,detail:0}),di=ri(hi),ui=k({},hi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_i,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==oi&&(oi&&"mousemove"===e.type?(si=e.screenX-oi.screenX,ai=e.screenY-oi.screenY):ai=si=0,oi=e),si)},movementY:function(e){return"movementY"in e?e.movementY:ai}}),pi=ri(ui),fi=ri(k({},ui,{dataTransfer:0})),mi=ri(k({},hi,{relatedTarget:0})),gi=ri(k({},li,{animationName:0,elapsedTime:0,pseudoElement:0})),vi=k({},li,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yi=ri(vi),bi=ri(k({},li,{data:0})),Ai={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Si(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=wi[e])&&!!t[e]}function _i(){return Si}var Ei=k({},hi,{key:function(e){if(e.key){var t=Ai[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ti(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_i,charCode:function(e){return"keypress"===e.type?ti(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ti(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Ci=ri(Ei),Mi=ri(k({},ui,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Ti=ri(k({},hi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_i})),Ii=ri(k({},li,{propertyName:0,elapsedTime:0,pseudoElement:0})),Pi=k({},ui,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Di=ri(Pi),Ri=[9,13,27,32],Bi=h&&"CompositionEvent"in window,Li=null;h&&"documentMode"in document&&(Li=document.documentMode);var Oi=h&&"TextEvent"in window&&!Li,Ni=h&&(!Bi||Li&&8<Li&&11>=Li),ki=String.fromCharCode(32),Fi=!1;function Ui(e,t){switch(e){case"keyup":return-1!==Ri.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zi(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var ji=!1;var Vi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vi[e.type]:"textarea"===t}function Hi(e,t,i,n){Ce(n),0<(t=Qn(t,"onChange")).length&&(i=new ci("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Wi=null,Qi=null;function qi(e){Fn(e,0)}function Xi(e){if(q(Ar(e)))return e}function Yi(e,t){if("change"===e)return t}var Ki=!1;if(h){var Ji;if(h){var Zi="oninput"in document;if(!Zi){var $i=document.createElement("div");$i.setAttribute("oninput","return;"),Zi="function"===typeof $i.oninput}Ji=Zi}else Ji=!1;Ki=Ji&&(!document.documentMode||9<document.documentMode)}function en(){Wi&&(Wi.detachEvent("onpropertychange",tn),Qi=Wi=null)}function tn(e){if("value"===e.propertyName&&Xi(Qi)){var t=[];Hi(t,Qi,e,xe(e)),De(qi,t)}}function nn(e,t,i){"focusin"===e?(en(),Qi=i,(Wi=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function rn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xi(Qi)}function sn(e,t){if("click"===e)return Xi(t)}function an(e,t){if("input"===e||"change"===e)return Xi(t)}var on="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ln(e,t){if(on(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!d.call(t,r)||!on(e[r],t[r]))return!1}return!0}function cn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hn(e,t){var i,n=cn(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=cn(n)}}function dn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function un(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var i="string"===typeof t.contentWindow.location.href}catch(n){i=!1}if(!i)break;t=X((e=t.contentWindow).document)}return t}function pn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fn(e){var t=un(),i=e.focusedElem,n=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&dn(i.ownerDocument.documentElement,i)){if(null!==n&&pn(i))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if((e=(t=i.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=i.textContent.length,s=Math.min(n.start,r);n=void 0===n.end?s:Math.min(n.end,r),!e.extend&&s>n&&(r=n,n=s,s=r),r=hn(i,s);var a=hn(i,n);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),s>n?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=i;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof i.focus&&i.focus(),i=0;i<t.length;i++)(e=t[i]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mn=h&&"documentMode"in document&&11>=document.documentMode,gn=null,vn=null,yn=null,bn=!1;function An(e,t,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;bn||null==gn||gn!==X(n)||("selectionStart"in(n=gn)&&pn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},yn&&ln(yn,n)||(yn=n,0<(n=Qn(vn,"onSelect")).length&&(t=new ci("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=gn)))}function xn(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var wn={animationend:xn("Animation","AnimationEnd"),animationiteration:xn("Animation","AnimationIteration"),animationstart:xn("Animation","AnimationStart"),transitionend:xn("Transition","TransitionEnd")},Sn={},_n={};function En(e){if(Sn[e])return Sn[e];if(!wn[e])return e;var t,i=wn[e];for(t in i)if(i.hasOwnProperty(t)&&t in _n)return Sn[e]=i[t];return e}h&&(_n=document.createElement("div").style,"AnimationEvent"in window||(delete wn.animationend.animation,delete wn.animationiteration.animation,delete wn.animationstart.animation),"TransitionEvent"in window||delete wn.transitionend.transition);var Cn=En("animationend"),Mn=En("animationiteration"),Tn=En("animationstart"),In=En("transitionend"),Pn=new Map,Dn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rn(e,t){Pn.set(e,t),l(t,[e])}for(var Bn=0;Bn<Dn.length;Bn++){var Ln=Dn[Bn];Rn(Ln.toLowerCase(),"on"+(Ln[0].toUpperCase()+Ln.slice(1)))}Rn(Cn,"onAnimationEnd"),Rn(Mn,"onAnimationIteration"),Rn(Tn,"onAnimationStart"),Rn("dblclick","onDoubleClick"),Rn("focusin","onFocus"),Rn("focusout","onBlur"),Rn(In,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var On="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Nn=new Set("cancel close invalid load scroll toggle".split(" ").concat(On));function kn(e,t,i){var n=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,n,r,a,o,l,c){if(je.apply(this,arguments),Ne){if(!Ne)throw Error(s(198));var h=ke;Ne=!1,ke=null,Fe||(Fe=!0,Ue=h)}}(n,t,void 0,e),e.currentTarget=null}function Fn(e,t){t=0!==(4&t);for(var i=0;i<e.length;i++){var n=e[i],r=n.event;n=n.listeners;e:{var s=void 0;if(t)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;kn(r,o,c),s=l}else for(a=0;a<n.length;a++){if(l=(o=n[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;kn(r,o,c),s=l}}}if(Fe)throw e=Ue,Fe=!1,Ue=null,e}function Un(e,t){var i=t[mr];void 0===i&&(i=t[mr]=new Set);var n=e+"__bubble";i.has(n)||(Gn(t,e,2,!1),i.add(n))}function zn(e,t,i){var n=0;t&&(n|=4),Gn(i,e,n,t)}var jn="_reactListening"+Math.random().toString(36).slice(2);function Vn(e){if(!e[jn]){e[jn]=!0,a.forEach((function(t){"selectionchange"!==t&&(Nn.has(t)||zn(t,!1,e),zn(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[jn]||(t[jn]=!0,zn("selectionchange",!1,t))}}function Gn(e,t,i,n){switch(Kt(t)){case 1:var r=Wt;break;case 4:r=Qt;break;default:r=qt}i=r.bind(null,t,i,e),r=void 0,!Be||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),n?void 0!==r?e.addEventListener(t,i,{capture:!0,passive:r}):e.addEventListener(t,i,!0):void 0!==r?e.addEventListener(t,i,{passive:r}):e.addEventListener(t,i,!1)}function Hn(e,t,i,n,r){var s=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var o=n.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=n.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=yr(o)))return;if(5===(l=a.tag)||6===l){n=s=a;continue e}o=o.parentNode}}n=n.return}De((function(){var n=s,r=xe(i),a=[];e:{var o=Pn.get(e);if(void 0!==o){var l=ci,c=e;switch(e){case"keypress":if(0===ti(i))break e;case"keydown":case"keyup":l=Ci;break;case"focusin":c="focus",l=mi;break;case"focusout":c="blur",l=mi;break;case"beforeblur":case"afterblur":l=mi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Ti;break;case Cn:case Mn:case Tn:l=gi;break;case In:l=Ii;break;case"scroll":l=di;break;case"wheel":l=Di;break;case"copy":case"cut":case"paste":l=yi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Mi}var h=0!==(4&t),d=!h&&"scroll"===e,u=h?null!==o?o+"Capture":null:o;h=[];for(var p,f=n;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==u&&(null!=(m=Re(f,u))&&h.push(Wn(f,m,p)))),d)break;f=f.return}0<h.length&&(o=new l(o,c,null,i,r),a.push({event:o,listeners:h}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||i===Ae||!(c=i.relatedTarget||i.fromElement)||!yr(c)&&!c[fr])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=n,null!==(c=(c=i.relatedTarget||i.toElement)?yr(c):null)&&(c!==(d=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(h=pi,m="onMouseLeave",u="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(h=Mi,m="onPointerLeave",u="onPointerEnter",f="pointer"),d=null==l?o:Ar(l),p=null==c?o:Ar(c),(o=new h(m,f+"leave",l,i,r)).target=d,o.relatedTarget=p,m=null,yr(r)===n&&((h=new h(u,f+"enter",c,i,r)).target=p,h.relatedTarget=d,m=h),d=m,l&&c)e:{for(u=c,f=0,p=h=l;p;p=qn(p))f++;for(p=0,m=u;m;m=qn(m))p++;for(;0<f-p;)h=qn(h),f--;for(;0<p-f;)u=qn(u),p--;for(;f--;){if(h===u||null!==u&&h===u.alternate)break e;h=qn(h),u=qn(u)}h=null}else h=null;null!==l&&Xn(a,o,l,h,!1),null!==c&&null!==d&&Xn(a,d,c,h,!0)}if("select"===(l=(o=n?Ar(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Yi;else if(Gi(o))if(Ki)g=an;else{g=rn;var v=nn}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=sn);switch(g&&(g=g(e,n))?Hi(a,g,i,r):(v&&v(e,o,n),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=n?Ar(n):window,e){case"focusin":(Gi(v)||"true"===v.contentEditable)&&(gn=v,vn=n,yn=null);break;case"focusout":yn=vn=gn=null;break;case"mousedown":bn=!0;break;case"contextmenu":case"mouseup":case"dragend":bn=!1,An(a,i,r);break;case"selectionchange":if(mn)break;case"keydown":case"keyup":An(a,i,r)}var y;if(Bi)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else ji?Ui(e,i)&&(b="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(b="onCompositionStart");b&&(Ni&&"ko"!==i.locale&&(ji||"onCompositionStart"!==b?"onCompositionEnd"===b&&ji&&(y=ei()):(Zt="value"in(Jt=r)?Jt.value:Jt.textContent,ji=!0)),0<(v=Qn(n,b)).length&&(b=new bi(b,e,null,i,r),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=zi(i))&&(b.data=y))),(y=Oi?function(e,t){switch(e){case"compositionend":return zi(t);case"keypress":return 32!==t.which?null:(Fi=!0,ki);case"textInput":return(e=t.data)===ki&&Fi?null:e;default:return null}}(e,i):function(e,t){if(ji)return"compositionend"===e||!Bi&&Ui(e,t)?(e=ei(),$t=Zt=Jt=null,ji=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ni&&"ko"!==t.locale?null:t.data}}(e,i))&&(0<(n=Qn(n,"onBeforeInput")).length&&(r=new bi("onBeforeInput","beforeinput",null,i,r),a.push({event:r,listeners:n}),r.data=y))}Fn(a,t)}))}function Wn(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Qn(e,t){for(var i=t+"Capture",n=[];null!==e;){var r=e,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=Re(e,i))&&n.unshift(Wn(e,s,r)),null!=(s=Re(e,t))&&n.push(Wn(e,s,r))),e=e.return}return n}function qn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xn(e,t,i,n,r){for(var s=t._reactName,a=[];null!==i&&i!==n;){var o=i,l=o.alternate,c=o.stateNode;if(null!==l&&l===n)break;5===o.tag&&null!==c&&(o=c,r?null!=(l=Re(i,s))&&a.unshift(Wn(i,l,o)):r||null!=(l=Re(i,s))&&a.push(Wn(i,l,o))),i=i.return}0!==a.length&&e.push({event:t,listeners:a})}var Yn=/\r\n?/g,Kn=/\u0000|\uFFFD/g;function Jn(e){return("string"===typeof e?e:""+e).replace(Yn,"\n").replace(Kn,"")}function Zn(e,t,i){if(t=Jn(t),Jn(e)!==t&&i)throw Error(s(425))}function $n(){}var er=null,tr=null;function ir(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var nr="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,sr="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sr?function(e){return sr.resolve(null).then(e).catch(or)}:nr;function or(e){setTimeout((function(){throw e}))}function lr(e,t){var i=t,n=0;do{var r=i.nextSibling;if(e.removeChild(i),r&&8===r.nodeType)if("/$"===(i=r.data)){if(0===n)return e.removeChild(r),void Vt(t);n--}else"$"!==i&&"$?"!==i&&"$!"!==i||n++;i=r}while(i);Vt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function hr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),ur="__reactFiber$"+dr,pr="__reactProps$"+dr,fr="__reactContainer$"+dr,mr="__reactEvents$"+dr,gr="__reactListeners$"+dr,vr="__reactHandles$"+dr;function yr(e){var t=e[ur];if(t)return t;for(var i=e.parentNode;i;){if(t=i[fr]||i[ur]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=hr(e);null!==e;){if(i=e[ur])return i;e=hr(e)}return t}i=(e=i).parentNode}return null}function br(e){return!(e=e[ur]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Ar(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function xr(e){return e[pr]||null}var wr=[],Sr=-1;function _r(e){return{current:e}}function Er(e){0>Sr||(e.current=wr[Sr],wr[Sr]=null,Sr--)}function Cr(e,t){Sr++,wr[Sr]=e.current,e.current=t}var Mr={},Tr=_r(Mr),Ir=_r(!1),Pr=Mr;function Dr(e,t){var i=e.type.contextTypes;if(!i)return Mr;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in i)s[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Rr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Br(){Er(Ir),Er(Tr)}function Lr(e,t,i){if(Tr.current!==Mr)throw Error(s(168));Cr(Tr,t),Cr(Ir,i)}function Or(e,t,i){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return i;for(var r in n=n.getChildContext())if(!(r in t))throw Error(s(108,G(e)||"Unknown",r));return k({},i,n)}function Nr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Mr,Pr=Tr.current,Cr(Tr,e),Cr(Ir,Ir.current),!0}function kr(e,t,i){var n=e.stateNode;if(!n)throw Error(s(169));i?(e=Or(e,t,Pr),n.__reactInternalMemoizedMergedChildContext=e,Er(Ir),Er(Tr),Cr(Tr,e)):Er(Ir),Cr(Ir,i)}var Fr=null,Ur=!1,zr=!1;function jr(e){null===Fr?Fr=[e]:Fr.push(e)}function Vr(){if(!zr&&null!==Fr){zr=!0;var e=0,t=bt;try{var i=Fr;for(bt=1;e<i.length;e++){var n=i[e];do{n=n(!0)}while(null!==n)}Fr=null,Ur=!1}catch(r){throw null!==Fr&&(Fr=Fr.slice(e+1)),qe($e,Vr),r}finally{bt=t,zr=!1}}return null}var Gr=[],Hr=0,Wr=null,Qr=0,qr=[],Xr=0,Yr=null,Kr=1,Jr="";function Zr(e,t){Gr[Hr++]=Qr,Gr[Hr++]=Wr,Wr=e,Qr=t}function $r(e,t,i){qr[Xr++]=Kr,qr[Xr++]=Jr,qr[Xr++]=Yr,Yr=e;var n=Kr;e=Jr;var r=32-at(n)-1;n&=~(1<<r),i+=1;var s=32-at(t)+r;if(30<s){var a=r-r%5;s=(n&(1<<a)-1).toString(32),n>>=a,r-=a,Kr=1<<32-at(t)+r|i<<r|n,Jr=s+e}else Kr=1<<s|i<<r|n,Jr=e}function es(e){null!==e.return&&(Zr(e,1),$r(e,1,0))}function ts(e){for(;e===Wr;)Wr=Gr[--Hr],Gr[Hr]=null,Qr=Gr[--Hr],Gr[Hr]=null;for(;e===Yr;)Yr=qr[--Xr],qr[Xr]=null,Jr=qr[--Xr],qr[Xr]=null,Kr=qr[--Xr],qr[Xr]=null}var is=null,ns=null,rs=!1,ss=null;function as(e,t){var i=Dc(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,null===(t=e.deletions)?(e.deletions=[i],e.flags|=16):t.push(i)}function os(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,is=e,ns=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,is=e,ns=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(i=null!==Yr?{id:Kr,overflow:Jr}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},(i=Dc(18,null,null,0)).stateNode=t,i.return=e,e.child=i,is=e,ns=null,!0);default:return!1}}function ls(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cs(e){if(rs){var t=ns;if(t){var i=t;if(!os(e,t)){if(ls(e))throw Error(s(418));t=cr(i.nextSibling);var n=is;t&&os(e,t)?as(n,i):(e.flags=-4097&e.flags|2,rs=!1,is=e)}}else{if(ls(e))throw Error(s(418));e.flags=-4097&e.flags|2,rs=!1,is=e}}}function hs(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;is=e}function ds(e){if(e!==is)return!1;if(!rs)return hs(e),rs=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ir(e.type,e.memoizedProps)),t&&(t=ns)){if(ls(e))throw us(),Error(s(418));for(;t;)as(e,t),t=cr(t.nextSibling)}if(hs(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){ns=cr(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}ns=null}}else ns=is?cr(e.stateNode.nextSibling):null;return!0}function us(){for(var e=ns;e;)e=cr(e.nextSibling)}function ps(){ns=is=null,rs=!1}function fs(e){null===ss?ss=[e]:ss.push(e)}var ms=A.ReactCurrentBatchConfig;function gs(e,t,i){if(null!==(e=i.ref)&&"function"!==typeof e&&"object"!==typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(s(309));var n=i.stateNode}if(!n)throw Error(s(147,e));var r=n,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(s(284));if(!i._owner)throw Error(s(290,e))}return e}function vs(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ys(e){return(0,e._init)(e._payload)}function bs(e){function t(t,i){if(e){var n=t.deletions;null===n?(t.deletions=[i],t.flags|=16):n.push(i)}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Bc(e,t)).index=0,e.sibling=null,e}function a(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<i?(t.flags|=2,i):n:(t.flags|=2,i):(t.flags|=1048576,i)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,i,n){return null===t||6!==t.tag?((t=kc(i,e.mode,n)).return=e,t):((t=r(t,i)).return=e,t)}function c(e,t,i,n){var s=i.type;return s===S?d(e,t,i.props.children,n,i.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===R&&ys(s)===t.type)?((n=r(t,i.props)).ref=gs(e,t,i),n.return=e,n):((n=Lc(i.type,i.key,i.props,null,e.mode,n)).ref=gs(e,t,i),n.return=e,n)}function h(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=Fc(i,e.mode,n)).return=e,t):((t=r(t,i.children||[])).return=e,t)}function d(e,t,i,n,s){return null===t||7!==t.tag?((t=Oc(i,e.mode,n,s)).return=e,t):((t=r(t,i)).return=e,t)}function u(e,t,i){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=kc(""+t,e.mode,i)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(i=Lc(t.type,t.key,t.props,null,e.mode,i)).ref=gs(e,null,t),i.return=e,i;case w:return(t=Fc(t,e.mode,i)).return=e,t;case R:return u(e,(0,t._init)(t._payload),i)}if(te(t)||O(t))return(t=Oc(t,e.mode,i,null)).return=e,t;vs(e,t)}return null}function p(e,t,i,n){var r=null!==t?t.key:null;if("string"===typeof i&&""!==i||"number"===typeof i)return null!==r?null:l(e,t,""+i,n);if("object"===typeof i&&null!==i){switch(i.$$typeof){case x:return i.key===r?c(e,t,i,n):null;case w:return i.key===r?h(e,t,i,n):null;case R:return p(e,t,(r=i._init)(i._payload),n)}if(te(i)||O(i))return null!==r?null:d(e,t,i,n,null);vs(e,i)}return null}function f(e,t,i,n,r){if("string"===typeof n&&""!==n||"number"===typeof n)return l(t,e=e.get(i)||null,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return c(t,e=e.get(null===n.key?i:n.key)||null,n,r);case w:return h(t,e=e.get(null===n.key?i:n.key)||null,n,r);case R:return f(e,t,i,(0,n._init)(n._payload),r)}if(te(n)||O(n))return d(t,e=e.get(i)||null,n,r,null);vs(t,n)}return null}function m(r,s,o,l){for(var c=null,h=null,d=s,m=s=0,g=null;null!==d&&m<o.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=p(r,d,o[m],l);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(r,d),s=a(v,s,m),null===h?c=v:h.sibling=v,h=v,d=g}if(m===o.length)return i(r,d),rs&&Zr(r,m),c;if(null===d){for(;m<o.length;m++)null!==(d=u(r,o[m],l))&&(s=a(d,s,m),null===h?c=d:h.sibling=d,h=d);return rs&&Zr(r,m),c}for(d=n(r,d);m<o.length;m++)null!==(g=f(d,r,m,o[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),s=a(g,s,m),null===h?c=g:h.sibling=g,h=g);return e&&d.forEach((function(e){return t(r,e)})),rs&&Zr(r,m),c}function g(r,o,l,c){var h=O(l);if("function"!==typeof h)throw Error(s(150));if(null==(l=h.call(l)))throw Error(s(151));for(var d=h=null,m=o,g=o=0,v=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var b=p(r,m,y.value,c);if(null===b){null===m&&(m=v);break}e&&m&&null===b.alternate&&t(r,m),o=a(b,o,g),null===d?h=b:d.sibling=b,d=b,m=v}if(y.done)return i(r,m),rs&&Zr(r,g),h;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=u(r,y.value,c))&&(o=a(y,o,g),null===d?h=y:d.sibling=y,d=y);return rs&&Zr(r,g),h}for(m=n(r,m);!y.done;g++,y=l.next())null!==(y=f(m,r,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),o=a(y,o,g),null===d?h=y:d.sibling=y,d=y);return e&&m.forEach((function(e){return t(r,e)})),rs&&Zr(r,g),h}return function e(n,s,a,l){if("object"===typeof a&&null!==a&&a.type===S&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case x:e:{for(var c=a.key,h=s;null!==h;){if(h.key===c){if((c=a.type)===S){if(7===h.tag){i(n,h.sibling),(s=r(h,a.props.children)).return=n,n=s;break e}}else if(h.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===R&&ys(c)===h.type){i(n,h.sibling),(s=r(h,a.props)).ref=gs(n,h,a),s.return=n,n=s;break e}i(n,h);break}t(n,h),h=h.sibling}a.type===S?((s=Oc(a.props.children,n.mode,l,a.key)).return=n,n=s):((l=Lc(a.type,a.key,a.props,null,n.mode,l)).ref=gs(n,s,a),l.return=n,n=l)}return o(n);case w:e:{for(h=a.key;null!==s;){if(s.key===h){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){i(n,s.sibling),(s=r(s,a.children||[])).return=n,n=s;break e}i(n,s);break}t(n,s),s=s.sibling}(s=Fc(a,n.mode,l)).return=n,n=s}return o(n);case R:return e(n,s,(h=a._init)(a._payload),l)}if(te(a))return m(n,s,a,l);if(O(a))return g(n,s,a,l);vs(n,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==s&&6===s.tag?(i(n,s.sibling),(s=r(s,a)).return=n,n=s):(i(n,s),(s=kc(a,n.mode,l)).return=n,n=s),o(n)):i(n,s)}}var As=bs(!0),xs=bs(!1),ws=_r(null),Ss=null,_s=null,Es=null;function Cs(){Es=_s=Ss=null}function Ms(e){var t=ws.current;Er(ws),e._currentValue=t}function Ts(e,t,i){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function Is(e,t){Ss=e,Es=_s=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function Ps(e){var t=e._currentValue;if(Es!==e)if(e={context:e,memoizedValue:t,next:null},null===_s){if(null===Ss)throw Error(s(308));_s=e,Ss.dependencies={lanes:0,firstContext:e}}else _s=_s.next=e;return t}var Ds=null;function Rs(e){null===Ds?Ds=[e]:Ds.push(e)}function Bs(e,t,i,n){var r=t.interleaved;return null===r?(i.next=i,Rs(t)):(i.next=r.next,r.next=i),t.interleaved=i,Ls(e,n)}function Ls(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}var Os=!1;function Ns(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ks(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Us(e,t,i){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&Tl)){var r=n.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),n.pending=t,Ls(e,i)}return null===(r=n.interleaved)?(t.next=t,Rs(n)):(t.next=r.next,r.next=t),n.interleaved=t,Ls(e,i)}function zs(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&i))){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,yt(e,i)}}function js(e,t){var i=e.updateQueue,n=e.alternate;if(null!==n&&i===(n=n.updateQueue)){var r=null,s=null;if(null!==(i=i.firstBaseUpdate)){do{var a={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===s?r=s=a:s=s.next=a,i=i.next}while(null!==i);null===s?r=s=t:s=s.next=t}else r=s=t;return i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,effects:n.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function Vs(e,t,i,n){var r=e.updateQueue;Os=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var h=e.alternate;null!==h&&((o=(h=h.updateQueue).lastBaseUpdate)!==a&&(null===o?h.firstBaseUpdate=c:o.next=c,h.lastBaseUpdate=l))}if(null!==s){var d=r.baseState;for(a=0,h=c=l=null,o=s;;){var u=o.lane,p=o.eventTime;if((n&u)===u){null!==h&&(h=h.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,m=o;switch(u=t,p=i,m.tag){case 1:if("function"===typeof(f=m.payload)){d=f.call(p,d,u);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(u="function"===typeof(f=m.payload)?f.call(p,d,u):f)||void 0===u)break e;d=k({},d,u);break e;case 2:Os=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(u=r.effects)?r.effects=[o]:u.push(o))}else p={eventTime:p,lane:u,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===h?(c=h=p,l=d):h=h.next=p,a|=u;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(u=o).next,u.next=null,r.lastBaseUpdate=u,r.shared.pending=null}}if(null===h&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=h,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===s&&(r.shared.lanes=0);Nl|=a,e.lanes=a,e.memoizedState=d}}function Gs(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],r=n.callback;if(null!==r){if(n.callback=null,n=i,"function"!==typeof r)throw Error(s(191,r));r.call(n)}}}var Hs={},Ws=_r(Hs),Qs=_r(Hs),qs=_r(Hs);function Xs(e){if(e===Hs)throw Error(s(174));return e}function Ys(e,t){switch(Cr(qs,t),Cr(Qs,e),Cr(Ws,Hs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Er(Ws),Cr(Ws,t)}function Ks(){Er(Ws),Er(Qs),Er(qs)}function Js(e){Xs(qs.current);var t=Xs(Ws.current),i=le(t,e.type);t!==i&&(Cr(Qs,e),Cr(Ws,i))}function Zs(e){Qs.current===e&&(Er(Ws),Er(Qs))}var $s=_r(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function ia(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var na=A.ReactCurrentDispatcher,ra=A.ReactCurrentBatchConfig,sa=0,aa=null,oa=null,la=null,ca=!1,ha=!1,da=0,ua=0;function pa(){throw Error(s(321))}function fa(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!on(e[i],t[i]))return!1;return!0}function ma(e,t,i,n,r,a){if(sa=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,na.current=null===e||null===e.memoizedState?Za:$a,e=i(n,r),ha){a=0;do{if(ha=!1,da=0,25<=a)throw Error(s(301));a+=1,la=oa=null,t.updateQueue=null,na.current=eo,e=i(n,r)}while(ha)}if(na.current=Ja,t=null!==oa&&null!==oa.next,sa=0,la=oa=aa=null,ca=!1,t)throw Error(s(300));return e}function ga(){var e=0!==da;return da=0,e}function va(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(s(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function ba(e,t){return"function"===typeof t?t(e):t}function Aa(e){var t=ya(),i=t.queue;if(null===i)throw Error(s(311));i.lastRenderedReducer=e;var n=oa,r=n.baseQueue,a=i.pending;if(null!==a){if(null!==r){var o=r.next;r.next=a.next,a.next=o}n.baseQueue=r=a,i.pending=null}if(null!==r){a=r.next,n=n.baseState;var l=o=null,c=null,h=a;do{var d=h.lane;if((sa&d)===d)null!==c&&(c=c.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),n=h.hasEagerState?h.eagerState:e(n,h.action);else{var u={lane:d,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};null===c?(l=c=u,o=n):c=c.next=u,aa.lanes|=d,Nl|=d}h=h.next}while(null!==h&&h!==a);null===c?o=n:c.next=l,on(n,t.memoizedState)||(bo=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=c,i.lastRenderedState=n}if(null!==(e=i.interleaved)){r=e;do{a=r.lane,aa.lanes|=a,Nl|=a,r=r.next}while(r!==e)}else null===r&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function xa(e){var t=ya(),i=t.queue;if(null===i)throw Error(s(311));i.lastRenderedReducer=e;var n=i.dispatch,r=i.pending,a=t.memoizedState;if(null!==r){i.pending=null;var o=r=r.next;do{a=e(a,o.action),o=o.next}while(o!==r);on(a,t.memoizedState)||(bo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),i.lastRenderedState=a}return[a,n]}function wa(){}function Sa(e,t){var i=aa,n=ya(),r=t(),a=!on(n.memoizedState,r);if(a&&(n.memoizedState=r,bo=!0),n=n.queue,Oa(Ca.bind(null,i,n,e),[e]),n.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(i.flags|=2048,Pa(9,Ea.bind(null,i,n,r,t),void 0,null),null===Il)throw Error(s(349));0!==(30&sa)||_a(i,t,r)}return r}function _a(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function Ea(e,t,i,n){t.value=i,t.getSnapshot=n,Ma(t)&&Ta(e)}function Ca(e,t,i){return i((function(){Ma(t)&&Ta(e)}))}function Ma(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!on(e,i)}catch(n){return!0}}function Ta(e){var t=Ls(e,1);null!==t&&ic(t,e,1,-1)}function Ia(e){var t=va();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:e},t.queue=e,e=e.dispatch=qa.bind(null,aa,e),[t.memoizedState,e]}function Pa(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function Da(){return ya().memoizedState}function Ra(e,t,i,n){var r=va();aa.flags|=e,r.memoizedState=Pa(1|t,i,void 0,void 0===n?null:n)}function Ba(e,t,i,n){var r=ya();n=void 0===n?null:n;var s=void 0;if(null!==oa){var a=oa.memoizedState;if(s=a.destroy,null!==n&&fa(n,a.deps))return void(r.memoizedState=Pa(t,i,s,n))}aa.flags|=e,r.memoizedState=Pa(1|t,i,s,n)}function La(e,t){return Ra(8390656,8,e,t)}function Oa(e,t){return Ba(2048,8,e,t)}function Na(e,t){return Ba(4,2,e,t)}function ka(e,t){return Ba(4,4,e,t)}function Fa(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ua(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Ba(4,4,Fa.bind(null,t,e),i)}function za(){}function ja(e,t){var i=ya();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&fa(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Va(e,t){var i=ya();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&fa(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)}function Ga(e,t,i){return 0===(21&sa)?(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=i):(on(i,t)||(i=mt(),aa.lanes|=i,Nl|=i,e.baseState=!0),t)}function Ha(e,t){var i=bt;bt=0!==i&&4>i?i:4,e(!0);var n=ra.transition;ra.transition={};try{e(!1),t()}finally{bt=i,ra.transition=n}}function Wa(){return ya().memoizedState}function Qa(e,t,i){var n=tc(e);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},Xa(e))Ya(t,i);else if(null!==(i=Bs(e,t,i,n))){ic(i,e,n,ec()),Ka(i,t,n)}}function qa(e,t,i){var n=tc(e),r={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(Xa(e))Ya(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,i);if(r.hasEagerState=!0,r.eagerState=o,on(o,a)){var l=t.interleaved;return null===l?(r.next=r,Rs(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(i=Bs(e,t,r,n))&&(ic(i,e,n,r=ec()),Ka(i,t,n))}}function Xa(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Ya(e,t){ha=ca=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Ka(e,t,i){if(0!==(4194240&i)){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,yt(e,i)}}var Ja={readContext:Ps,useCallback:pa,useContext:pa,useEffect:pa,useImperativeHandle:pa,useInsertionEffect:pa,useLayoutEffect:pa,useMemo:pa,useReducer:pa,useRef:pa,useState:pa,useDebugValue:pa,useDeferredValue:pa,useTransition:pa,useMutableSource:pa,useSyncExternalStore:pa,useId:pa,unstable_isNewReconciler:!1},Za={readContext:Ps,useCallback:function(e,t){return va().memoizedState=[e,void 0===t?null:t],e},useContext:Ps,useEffect:La,useImperativeHandle:function(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Ra(4194308,4,Fa.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Ra(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ra(4,2,e,t)},useMemo:function(e,t){var i=va();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=va();return t=void 0!==i?i(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Qa.bind(null,aa,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},va().memoizedState=e},useState:Ia,useDebugValue:za,useDeferredValue:function(e){return va().memoizedState=e},useTransition:function(){var e=Ia(!1),t=e[0];return e=Ha.bind(null,e[1]),va().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var n=aa,r=va();if(rs){if(void 0===i)throw Error(s(407));i=i()}else{if(i=t(),null===Il)throw Error(s(349));0!==(30&sa)||_a(n,t,i)}r.memoizedState=i;var a={value:i,getSnapshot:t};return r.queue=a,La(Ca.bind(null,n,a,e),[e]),n.flags|=2048,Pa(9,Ea.bind(null,n,a,i,t),void 0,null),i},useId:function(){var e=va(),t=Il.identifierPrefix;if(rs){var i=Jr;t=":"+t+"R"+(i=(Kr&~(1<<32-at(Kr)-1)).toString(32)+i),0<(i=da++)&&(t+="H"+i.toString(32)),t+=":"}else t=":"+t+"r"+(i=ua++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},$a={readContext:Ps,useCallback:ja,useContext:Ps,useEffect:Oa,useImperativeHandle:Ua,useInsertionEffect:Na,useLayoutEffect:ka,useMemo:Va,useReducer:Aa,useRef:Da,useState:function(){return Aa(ba)},useDebugValue:za,useDeferredValue:function(e){return Ga(ya(),oa.memoizedState,e)},useTransition:function(){return[Aa(ba)[0],ya().memoizedState]},useMutableSource:wa,useSyncExternalStore:Sa,useId:Wa,unstable_isNewReconciler:!1},eo={readContext:Ps,useCallback:ja,useContext:Ps,useEffect:Oa,useImperativeHandle:Ua,useInsertionEffect:Na,useLayoutEffect:ka,useMemo:Va,useReducer:xa,useRef:Da,useState:function(){return xa(ba)},useDebugValue:za,useDeferredValue:function(e){var t=ya();return null===oa?t.memoizedState=e:Ga(t,oa.memoizedState,e)},useTransition:function(){return[xa(ba)[0],ya().memoizedState]},useMutableSource:wa,useSyncExternalStore:Sa,useId:Wa,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var i in t=k({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}function io(e,t,i,n){i=null===(i=i(n,t=e.memoizedState))||void 0===i?t:k({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var no={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var n=ec(),r=tc(e),s=Fs(n,r);s.payload=t,void 0!==i&&null!==i&&(s.callback=i),null!==(t=Us(e,s,r))&&(ic(t,e,r,n),zs(t,e,r))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=ec(),r=tc(e),s=Fs(n,r);s.tag=1,s.payload=t,void 0!==i&&null!==i&&(s.callback=i),null!==(t=Us(e,s,r))&&(ic(t,e,r,n),zs(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ec(),n=tc(e),r=Fs(i,n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Us(e,r,n))&&(ic(t,e,n,i),zs(t,e,n))}};function ro(e,t,i,n,r,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!ln(i,n)||!ln(r,s))}function so(e,t,i){var n=!1,r=Mr,s=t.contextType;return"object"===typeof s&&null!==s?s=Ps(s):(r=Rr(t)?Pr:Tr.current,s=(n=null!==(n=t.contextTypes)&&void 0!==n)?Dr(e,r):Mr),t=new t(i,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=no,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function ao(e,t,i,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&no.enqueueReplaceState(t,t.state,null)}function oo(e,t,i,n){var r=e.stateNode;r.props=i,r.state=e.memoizedState,r.refs={},Ns(e);var s=t.contextType;"object"===typeof s&&null!==s?r.context=Ps(s):(s=Rr(t)?Pr:Tr.current,r.context=Dr(e,s)),r.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(io(e,t,s,i),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&no.enqueueReplaceState(r,r.state,null),Vs(e,i,r,n),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var i="",n=t;do{i+=j(n),n=n.return}while(n);var r=i}catch(s){r="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:r,digest:null}}function co(e,t,i){return{value:e,source:null,stack:null!=i?i:null,digest:null!=t?t:null}}function ho(e,t){try{console.error(t.value)}catch(i){setTimeout((function(){throw i}))}}var uo="function"===typeof WeakMap?WeakMap:Map;function po(e,t,i){(i=Fs(-1,i)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){Hl||(Hl=!0,Wl=n),ho(0,t)},i}function fo(e,t,i){(i=Fs(-1,i)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var r=t.value;i.payload=function(){return n(r)},i.callback=function(){ho(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(i.callback=function(){ho(0,t),"function"!==typeof n&&(null===Ql?Ql=new Set([this]):Ql.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),i}function mo(e,t,i){var n=e.pingCache;if(null===n){n=e.pingCache=new uo;var r=new Set;n.set(t,r)}else void 0===(r=n.get(t))&&(r=new Set,n.set(t,r));r.has(i)||(r.add(i),e=Ec.bind(null,e,t,i),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,i,n,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((t=Fs(-1,1)).tag=2,Us(i,t,1))),i.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var yo=A.ReactCurrentOwner,bo=!1;function Ao(e,t,i,n){t.child=null===e?xs(t,null,i,n):As(t,e.child,i,n)}function xo(e,t,i,n,r){i=i.render;var s=t.ref;return Is(t,r),n=ma(e,t,i,n,s,r),i=ga(),null===e||bo?(rs&&i&&es(t),t.flags|=1,Ao(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ho(e,t,r))}function wo(e,t,i,n,r){if(null===e){var s=i.type;return"function"!==typeof s||Rc(s)||void 0!==s.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=Lc(i.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,So(e,t,s,n,r))}if(s=e.child,0===(e.lanes&r)){var a=s.memoizedProps;if((i=null!==(i=i.compare)?i:ln)(a,n)&&e.ref===t.ref)return Ho(e,t,r)}return t.flags|=1,(e=Bc(s,n)).ref=t.ref,e.return=t,t.child=e}function So(e,t,i,n,r){if(null!==e){var s=e.memoizedProps;if(ln(s,n)&&e.ref===t.ref){if(bo=!1,t.pendingProps=n=s,0===(e.lanes&r))return t.lanes=e.lanes,Ho(e,t,r);0!==(131072&e.flags)&&(bo=!0)}}return Co(e,t,i,n,r)}function _o(e,t,i){var n=t.pendingProps,r=n.children,s=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cr(Bl,Rl),Rl|=i;else{if(0===(1073741824&i))return e=null!==s?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Cr(Bl,Rl),Rl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==s?s.baseLanes:i,Cr(Bl,Rl),Rl|=n}else null!==s?(n=s.baseLanes|i,t.memoizedState=null):n=i,Cr(Bl,Rl),Rl|=n;return Ao(e,t,r,i),t.child}function Eo(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,i,n,r){var s=Rr(i)?Pr:Tr.current;return s=Dr(t,s),Is(t,r),i=ma(e,t,i,n,s,r),n=ga(),null===e||bo?(rs&&n&&es(t),t.flags|=1,Ao(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ho(e,t,r))}function Mo(e,t,i,n,r){if(Rr(i)){var s=!0;Nr(t)}else s=!1;if(Is(t,r),null===t.stateNode)Go(e,t),so(t,i,n),oo(t,i,n,r),n=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=i.contextType;"object"===typeof c&&null!==c?c=Ps(c):c=Dr(t,c=Rr(i)?Pr:Tr.current);var h=i.getDerivedStateFromProps,d="function"===typeof h||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==n||l!==c)&&ao(t,a,n,c),Os=!1;var u=t.memoizedState;a.state=u,Vs(t,n,a,r),l=t.memoizedState,o!==n||u!==l||Ir.current||Os?("function"===typeof h&&(io(t,i,h,n),l=t.memoizedState),(o=Os||ro(t,i,o,n,u,l,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=c,n=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,ks(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,d=t.pendingProps,u=a.context,"object"===typeof(l=i.contextType)&&null!==l?l=Ps(l):l=Dr(t,l=Rr(i)?Pr:Tr.current);var p=i.getDerivedStateFromProps;(h="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==d||u!==l)&&ao(t,a,n,l),Os=!1,u=t.memoizedState,a.state=u,Vs(t,n,a,r);var f=t.memoizedState;o!==d||u!==f||Ir.current||Os?("function"===typeof p&&(io(t,i,p,n),f=t.memoizedState),(c=Os||ro(t,i,c,n,u,f,l)||!1)?(h||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(n,f,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,f,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=f),a.props=n,a.state=f,a.context=l,n=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),n=!1)}return To(e,t,i,n,s,r)}function To(e,t,i,n,r,s){Eo(e,t);var a=0!==(128&t.flags);if(!n&&!a)return r&&kr(t,i,!1),Ho(e,t,s);n=t.stateNode,yo.current=t;var o=a&&"function"!==typeof i.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&a?(t.child=As(t,e.child,null,s),t.child=As(t,null,o,s)):Ao(e,t,o,s),t.memoizedState=n.state,r&&kr(t,i,!0),t.child}function Io(e){var t=e.stateNode;t.pendingContext?Lr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Lr(0,t.context,!1),Ys(e,t.containerInfo)}function Po(e,t,i,n,r){return ps(),fs(r),t.flags|=256,Ao(e,t,i,n),t.child}var Do,Ro,Bo,Lo,Oo={dehydrated:null,treeContext:null,retryLane:0};function No(e){return{baseLanes:e,cachePool:null,transitions:null}}function ko(e,t,i){var n,r=t.pendingProps,a=$s.current,o=!1,l=0!==(128&t.flags);if((n=l)||(n=(null===e||null!==e.memoizedState)&&0!==(2&a)),n?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Cr($s,1&a),null===e)return cs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Nc(l,r,0,null),e=Oc(e,r,i,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=No(i),t.memoizedState=Oo,e):Fo(t,l));if(null!==(a=e.memoizedState)&&null!==(n=a.dehydrated))return function(e,t,i,n,r,a,o){if(i)return 256&t.flags?(t.flags&=-257,Uo(e,t,o,n=co(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=n.fallback,r=t.mode,n=Nc({mode:"visible",children:n.children},r,0,null),(a=Oc(a,r,o,null)).flags|=2,n.return=t,a.return=t,n.sibling=a,t.child=n,0!==(1&t.mode)&&As(t,e.child,null,o),t.child.memoizedState=No(o),t.memoizedState=Oo,a);if(0===(1&t.mode))return Uo(e,t,o,null);if("$!"===r.data){if(n=r.nextSibling&&r.nextSibling.dataset)var l=n.dgst;return n=l,Uo(e,t,o,n=co(a=Error(s(419)),n,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(n=Il)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(n.suspendedLanes|o))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Ls(e,r),ic(n,e,r,-1))}return mc(),Uo(e,t,o,n=co(Error(s(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Mc.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,ns=cr(r.nextSibling),is=t,rs=!0,ss=null,null!==e&&(qr[Xr++]=Kr,qr[Xr++]=Jr,qr[Xr++]=Yr,Kr=e.id,Jr=e.overflow,Yr=t),t=Fo(t,n.children),t.flags|=4096,t)}(e,t,l,r,n,a,i);if(o){o=r.fallback,l=t.mode,n=(a=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Bc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==n?o=Bc(n,o):(o=Oc(o,l,i,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=null===(l=e.child.memoizedState)?No(i):{baseLanes:l.baseLanes|i,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~i,t.memoizedState=Oo,r}return e=(o=e.child).sibling,r=Bc(o,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=i),r.return=t,r.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function Fo(e,t){return(t=Nc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Uo(e,t,i,n){return null!==n&&fs(n),As(t,e.child,null,i),(e=Fo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zo(e,t,i){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Ts(e.return,t,i)}function jo(e,t,i,n,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=i,s.tailMode=r)}function Vo(e,t,i){var n=t.pendingProps,r=n.revealOrder,s=n.tail;if(Ao(e,t,n.children,i),0!==(2&(n=$s.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zo(e,i,t);else if(19===e.tag)zo(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Cr($s,n),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(i=t.child,r=null;null!==i;)null!==(e=i.alternate)&&null===ea(e)&&(r=i),i=i.sibling;null===(i=r)?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),jo(t,!1,r,i,s);break;case"backwards":for(i=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ea(e)){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}jo(t,!0,i,null,s);break;case"together":jo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Go(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ho(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Nl|=t.lanes,0===(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(i=Bc(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Bc(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function Wo(e,t){if(!rs)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Qo(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,n=0;if(t)for(var r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=14680064&r.subtreeFlags,n|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function qo(e,t,i){var n=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qo(t),null;case 1:case 17:return Rr(t.type)&&Br(),Qo(t),null;case 3:return n=t.stateNode,Ks(),Er(Ir),Er(Tr),ia(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ds(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ss&&(ac(ss),ss=null))),Ro(e,t),Qo(t),null;case 5:Zs(t);var r=Xs(qs.current);if(i=t.type,null!==e&&null!=t.stateNode)Bo(e,t,i,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(s(166));return Qo(t),null}if(e=Xs(Ws.current),ds(t)){n=t.stateNode,i=t.type;var a=t.memoizedProps;switch(n[ur]=t,n[pr]=a,e=0!==(1&t.mode),i){case"dialog":Un("cancel",n),Un("close",n);break;case"iframe":case"object":case"embed":Un("load",n);break;case"video":case"audio":for(r=0;r<On.length;r++)Un(On[r],n);break;case"source":Un("error",n);break;case"img":case"image":case"link":Un("error",n),Un("load",n);break;case"details":Un("toggle",n);break;case"input":K(n,a),Un("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},Un("invalid",n);break;case"textarea":re(n,a),Un("invalid",n)}for(var l in ye(i,a),r=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?n.textContent!==c&&(!0!==a.suppressHydrationWarning&&Zn(n.textContent,c,e),r=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Zn(n.textContent,c,e),r=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Un("scroll",n)}switch(i){case"input":Q(n),$(n,a,!0);break;case"textarea":Q(n),ae(n);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(n.onclick=$n)}n=r,t.updateQueue=n,null!==n&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=l.createElement(i,{is:n.is}):(e=l.createElement(i),"select"===i&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,i),e[ur]=t,e[pr]=n,Do(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(i,n),i){case"dialog":Un("cancel",e),Un("close",e),r=n;break;case"iframe":case"object":case"embed":Un("load",e),r=n;break;case"video":case"audio":for(r=0;r<On.length;r++)Un(On[r],e);r=n;break;case"source":Un("error",e),r=n;break;case"img":case"image":case"link":Un("error",e),Un("load",e),r=n;break;case"details":Un("toggle",e),r=n;break;case"input":K(e,n),r=Y(e,n),Un("invalid",e);break;case"option":default:r=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},r=k({},n,{value:void 0}),Un("invalid",e);break;case"textarea":re(e,n),r=ne(e,n),Un("invalid",e)}for(a in ye(i,r),c=r)if(c.hasOwnProperty(a)){var h=c[a];"style"===a?ge(e,h):"dangerouslySetInnerHTML"===a?null!=(h=h?h.__html:void 0)&&de(e,h):"children"===a?"string"===typeof h?("textarea"!==i||""!==h)&&ue(e,h):"number"===typeof h&&ue(e,""+h):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=h&&"onScroll"===a&&Un("scroll",e):null!=h&&b(e,a,h,l))}switch(i){case"input":Q(e),$(e,n,!1);break;case"textarea":Q(e),ae(e);break;case"option":null!=n.value&&e.setAttribute("value",""+H(n.value));break;case"select":e.multiple=!!n.multiple,null!=(a=n.value)?ie(e,!!n.multiple,a,!1):null!=n.defaultValue&&ie(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=$n)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Qo(t),null;case 6:if(e&&null!=t.stateNode)Lo(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(s(166));if(i=Xs(qs.current),Xs(Ws.current),ds(t)){if(n=t.stateNode,i=t.memoizedProps,n[ur]=t,(a=n.nodeValue!==i)&&null!==(e=is))switch(e.tag){case 3:Zn(n.nodeValue,i,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zn(n.nodeValue,i,0!==(1&e.mode))}a&&(t.flags|=4)}else(n=(9===i.nodeType?i:i.ownerDocument).createTextNode(n))[ur]=t,t.stateNode=n}return Qo(t),null;case 13:if(Er($s),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(rs&&null!==ns&&0!==(1&t.mode)&&0===(128&t.flags))us(),ps(),t.flags|=98560,a=!1;else if(a=ds(t),null!==n&&null!==n.dehydrated){if(null===e){if(!a)throw Error(s(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(s(317));a[ur]=t}else ps(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Qo(t),a=!1}else null!==ss&&(ac(ss),ss=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=i,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$s.current)?0===Ll&&(Ll=3):mc())),null!==t.updateQueue&&(t.flags|=4),Qo(t),null);case 4:return Ks(),Ro(e,t),null===e&&Vn(t.stateNode.containerInfo),Qo(t),null;case 10:return Ms(t.type._context),Qo(t),null;case 19:if(Er($s),null===(a=t.memoizedState))return Qo(t),null;if(n=0!==(128&t.flags),null===(l=a.rendering))if(n)Wo(a,!1);else{if(0!==Ll||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,Wo(a,!1),null!==(n=l.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=i,i=t.child;null!==i;)e=n,(a=i).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Cr($s,1&$s.current|2),t.child}e=e.sibling}null!==a.tail&&Je()>Vl&&(t.flags|=128,n=!0,Wo(a,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=ea(l))){if(t.flags|=128,n=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),Wo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!rs)return Qo(t),null}else 2*Je()-a.renderingStartTime>Vl&&1073741824!==i&&(t.flags|=128,n=!0,Wo(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(i=a.last)?i.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Je(),t.sibling=null,i=$s.current,Cr($s,n?1&i|2:1&i),t):(Qo(t),null);case 22:case 23:return dc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&Rl)&&(Qo(t),6&t.subtreeFlags&&(t.flags|=8192)):Qo(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Xo(e,t){switch(ts(t),t.tag){case 1:return Rr(t.type)&&Br(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ks(),Er(Ir),Er(Tr),ia(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Zs(t),null;case 13:if(Er($s),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ps()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Er($s),null;case 4:return Ks(),null;case 10:return Ms(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Do=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Ro=function(){},Bo=function(e,t,i,n){var r=e.memoizedProps;if(r!==n){e=t.stateNode,Xs(Ws.current);var s,a=null;switch(i){case"input":r=Y(e,r),n=Y(e,n),a=[];break;case"select":r=k({},r,{value:void 0}),n=k({},n,{value:void 0}),a=[];break;case"textarea":r=ne(e,r),n=ne(e,n),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof n.onClick&&(e.onclick=$n)}for(h in ye(i,n),i=null,r)if(!n.hasOwnProperty(h)&&r.hasOwnProperty(h)&&null!=r[h])if("style"===h){var l=r[h];for(s in l)l.hasOwnProperty(s)&&(i||(i={}),i[s]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(o.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in n){var c=n[h];if(l=null!=r?r[h]:void 0,n.hasOwnProperty(h)&&c!==l&&(null!=c||null!=l))if("style"===h)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(i||(i={}),i[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(i||(i={}),i[s]=c[s])}else i||(a||(a=[]),a.push(h,i)),i=c;else"dangerouslySetInnerHTML"===h?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(h,c)):"children"===h?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(h,""+c):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(o.hasOwnProperty(h)?(null!=c&&"onScroll"===h&&Un("scroll",e),a||l===c||(a=[])):(a=a||[]).push(h,c))}i&&(a=a||[]).push("style",i);var h=a;(t.updateQueue=h)&&(t.flags|=4)}},Lo=function(e,t,i,n){i!==n&&(t.flags|=4)};var Yo=!1,Ko=!1,Jo="function"===typeof WeakSet?WeakSet:Set,Zo=null;function $o(e,t){var i=e.ref;if(null!==i)if("function"===typeof i)try{i(null)}catch(n){_c(e,t,n)}else i.current=null}function el(e,t,i){try{i()}catch(n){_c(e,t,n)}}var tl=!1;function il(e,t,i){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&el(t,i,s)}r=r.next}while(r!==n)}}function nl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var i=t=t.next;do{if((i.tag&e)===e){var n=i.create;i.destroy=n()}i=i.next}while(i!==t)}}function rl(e){var t=e.ref;if(null!==t){var i=e.stateNode;e.tag,e=i,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ur],delete t[pr],delete t[mr],delete t[gr],delete t[vr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!==(i=i._reactRootContainer)&&void 0!==i||null!==t.onclick||(t.onclick=$n));else if(4!==n&&null!==(e=e.child))for(ll(e,t,i),e=e.sibling;null!==e;)ll(e,t,i),e=e.sibling}function cl(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==n&&null!==(e=e.child))for(cl(e,t,i),e=e.sibling;null!==e;)cl(e,t,i),e=e.sibling}var hl=null,dl=!1;function ul(e,t,i){for(i=i.child;null!==i;)pl(e,t,i),i=i.sibling}function pl(e,t,i){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(rt,i)}catch(o){}switch(i.tag){case 5:Ko||$o(i,t);case 6:var n=hl,r=dl;hl=null,ul(e,t,i),dl=r,null!==(hl=n)&&(dl?(e=hl,i=i.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)):hl.removeChild(i.stateNode));break;case 18:null!==hl&&(dl?(e=hl,i=i.stateNode,8===e.nodeType?lr(e.parentNode,i):1===e.nodeType&&lr(e,i),Vt(e)):lr(hl,i.stateNode));break;case 4:n=hl,r=dl,hl=i.stateNode.containerInfo,dl=!0,ul(e,t,i),hl=n,dl=r;break;case 0:case 11:case 14:case 15:if(!Ko&&(null!==(n=i.updateQueue)&&null!==(n=n.lastEffect))){r=n=n.next;do{var s=r,a=s.destroy;s=s.tag,void 0!==a&&(0!==(2&s)||0!==(4&s))&&el(i,t,a),r=r.next}while(r!==n)}ul(e,t,i);break;case 1:if(!Ko&&($o(i,t),"function"===typeof(n=i.stateNode).componentWillUnmount))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(o){_c(i,t,o)}ul(e,t,i);break;case 21:ul(e,t,i);break;case 22:1&i.mode?(Ko=(n=Ko)||null!==i.memoizedState,ul(e,t,i),Ko=n):ul(e,t,i);break;default:ul(e,t,i)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new Jo),t.forEach((function(t){var n=Tc.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))}))}}function ml(e,t){var i=t.deletions;if(null!==i)for(var n=0;n<i.length;n++){var r=i[n];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===hl)throw Error(s(160));pl(a,o,r),hl=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(h){_c(r,t,h)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var i=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),vl(e),4&n){try{il(3,e,e.return),nl(3,e)}catch(g){_c(e,e.return,g)}try{il(5,e,e.return)}catch(g){_c(e,e.return,g)}}break;case 1:ml(t,e),vl(e),512&n&&null!==i&&$o(i,i.return);break;case 5:if(ml(t,e),vl(e),512&n&&null!==i&&$o(i,i.return),32&e.flags){var r=e.stateNode;try{ue(r,"")}catch(g){_c(e,e.return,g)}}if(4&n&&null!=(r=e.stateNode)){var a=e.memoizedProps,o=null!==i?i.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&J(r,a),be(l,o);var h=be(l,a);for(o=0;o<c.length;o+=2){var d=c[o],u=c[o+1];"style"===d?ge(r,u):"dangerouslySetInnerHTML"===d?de(r,u):"children"===d?ue(r,u):b(r,d,u,h)}switch(l){case"input":Z(r,a);break;case"textarea":se(r,a);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var f=a.value;null!=f?ie(r,!!a.multiple,f,!1):p!==!!a.multiple&&(null!=a.defaultValue?ie(r,!!a.multiple,a.defaultValue,!0):ie(r,!!a.multiple,a.multiple?[]:"",!1))}r[pr]=a}catch(g){_c(e,e.return,g)}}break;case 6:if(ml(t,e),vl(e),4&n){if(null===e.stateNode)throw Error(s(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(g){_c(e,e.return,g)}}break;case 3:if(ml(t,e),vl(e),4&n&&null!==i&&i.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){_c(e,e.return,g)}break;case 4:default:ml(t,e),vl(e);break;case 13:ml(t,e),vl(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(jl=Je())),4&n&&fl(e);break;case 22:if(d=null!==i&&null!==i.memoizedState,1&e.mode?(Ko=(h=Ko)||d,ml(t,e),Ko=h):ml(t,e),vl(e),8192&n){if(h=null!==e.memoizedState,(e.stateNode.isHidden=h)&&!d&&0!==(1&e.mode))for(Zo=e,d=e.child;null!==d;){for(u=Zo=d;null!==Zo;){switch(f=(p=Zo).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:$o(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){n=p,i=p.return;try{t=n,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){_c(n,i,g)}}break;case 5:$o(p,p.return);break;case 22:if(null!==p.memoizedState){xl(u);continue}}null!==f?(f.return=p,Zo=f):xl(u)}d=d.sibling}e:for(d=null,u=e;;){if(5===u.tag){if(null===d){d=u;try{r=u.stateNode,h?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=u.stateNode,o=void 0!==(c=u.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",o))}catch(g){_c(e,e.return,g)}}}else if(6===u.tag){if(null===d)try{u.stateNode.nodeValue=h?"":u.memoizedProps}catch(g){_c(e,e.return,g)}}else if((22!==u.tag&&23!==u.tag||null===u.memoizedState||u===e)&&null!==u.child){u.child.return=u,u=u.child;continue}if(u===e)break e;for(;null===u.sibling;){if(null===u.return||u.return===e)break e;d===u&&(d=null),u=u.return}d===u&&(d=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:ml(t,e),vl(e),4&n&&fl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var i=e.return;null!==i;){if(al(i)){var n=i;break e}i=i.return}throw Error(s(160))}switch(n.tag){case 5:var r=n.stateNode;32&n.flags&&(ue(r,""),n.flags&=-33),cl(e,ol(e),r);break;case 3:case 4:var a=n.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(s(161))}}catch(o){_c(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,i){Zo=e,bl(e,t,i)}function bl(e,t,i){for(var n=0!==(1&e.mode);null!==Zo;){var r=Zo,s=r.child;if(22===r.tag&&n){var a=null!==r.memoizedState||Yo;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||Ko;o=Yo;var c=Ko;if(Yo=a,(Ko=l)&&!c)for(Zo=r;null!==Zo;)l=(a=Zo).child,22===a.tag&&null!==a.memoizedState?wl(r):null!==l?(l.return=a,Zo=l):wl(r);for(;null!==s;)Zo=s,bl(s,t,i),s=s.sibling;Zo=r,Yo=o,Ko=c}Al(e)}else 0!==(8772&r.subtreeFlags)&&null!==s?(s.return=r,Zo=s):Al(e)}}function Al(e){for(;null!==Zo;){var t=Zo;if(0!==(8772&t.flags)){var i=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ko||nl(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!Ko)if(null===i)n.componentDidMount();else{var r=t.elementType===t.type?i.memoizedProps:to(t.type,i.memoizedProps);n.componentDidUpdate(r,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Gs(t,a,n);break;case 3:var o=t.updateQueue;if(null!==o){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}Gs(t,o,i)}break;case 5:var l=t.stateNode;if(null===i&&4&t.flags){i=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&i.focus();break;case"img":c.src&&(i.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var h=t.alternate;if(null!==h){var d=h.memoizedState;if(null!==d){var u=d.dehydrated;null!==u&&Vt(u)}}}break;default:throw Error(s(163))}Ko||512&t.flags&&rl(t)}catch(p){_c(t,t.return,p)}}if(t===e){Zo=null;break}if(null!==(i=t.sibling)){i.return=t.return,Zo=i;break}Zo=t.return}}function xl(e){for(;null!==Zo;){var t=Zo;if(t===e){Zo=null;break}var i=t.sibling;if(null!==i){i.return=t.return,Zo=i;break}Zo=t.return}}function wl(e){for(;null!==Zo;){var t=Zo;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{nl(4,t)}catch(l){_c(t,i,l)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var r=t.return;try{n.componentDidMount()}catch(l){_c(t,r,l)}}var s=t.return;try{rl(t)}catch(l){_c(t,s,l)}break;case 5:var a=t.return;try{rl(t)}catch(l){_c(t,a,l)}}}catch(l){_c(t,t.return,l)}if(t===e){Zo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Zo=o;break}Zo=t.return}}var Sl,_l=Math.ceil,El=A.ReactCurrentDispatcher,Cl=A.ReactCurrentOwner,Ml=A.ReactCurrentBatchConfig,Tl=0,Il=null,Pl=null,Dl=0,Rl=0,Bl=_r(0),Ll=0,Ol=null,Nl=0,kl=0,Fl=0,Ul=null,zl=null,jl=0,Vl=1/0,Gl=null,Hl=!1,Wl=null,Ql=null,ql=!1,Xl=null,Yl=0,Kl=0,Jl=null,Zl=-1,$l=0;function ec(){return 0!==(6&Tl)?Je():-1!==Zl?Zl:Zl=Je()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Tl)&&0!==Dl?Dl&-Dl:null!==ms.transition?(0===$l&&($l=mt()),$l):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Kt(e.type)}function ic(e,t,i,n){if(50<Kl)throw Kl=0,Jl=null,Error(s(185));vt(e,i,n),0!==(2&Tl)&&e===Il||(e===Il&&(0===(2&Tl)&&(kl|=i),4===Ll&&oc(e,Dl)),nc(e,n),1===i&&0===Tl&&0===(1&t.mode)&&(Vl=Je()+500,Ur&&Vr()))}function nc(e,t){var i=e.callbackNode;!function(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-at(s),o=1<<a,l=r[a];-1===l?0!==(o&i)&&0===(o&n)||(r[a]=pt(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var n=ut(e,e===Il?Dl:0);if(0===n)null!==i&&Xe(i),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=i&&Xe(i),1===t)0===e.tag?function(e){Ur=!0,jr(e)}(lc.bind(null,e)):jr(lc.bind(null,e)),ar((function(){0===(6&Tl)&&Vr()})),i=null;else{switch(At(n)){case 1:i=$e;break;case 4:i=et;break;case 16:default:i=tt;break;case 536870912:i=nt}i=Ic(i,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function rc(e,t){if(Zl=-1,$l=0,0!==(6&Tl))throw Error(s(327));var i=e.callbackNode;if(wc()&&e.callbackNode!==i)return null;var n=ut(e,e===Il?Dl:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=gc(e,n);else{t=n;var r=Tl;Tl|=2;var a=fc();for(Il===e&&Dl===t||(Gl=null,Vl=Je()+500,uc(e,t));;)try{yc();break}catch(l){pc(e,l)}Cs(),El.current=a,Tl=r,null!==Pl?t=0:(Il=null,Dl=0,t=Ll)}if(0!==t){if(2===t&&(0!==(r=ft(e))&&(n=r,t=sc(e,r))),1===t)throw i=Ol,uc(e,0),oc(e,n),nc(e,Je()),i;if(6===t)oc(e,n);else{if(r=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var i=t.updateQueue;if(null!==i&&null!==(i=i.stores))for(var n=0;n<i.length;n++){var r=i[n],s=r.getSnapshot;r=r.value;try{if(!on(s(),r))return!1}catch(o){return!1}}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gc(e,n))&&(0!==(a=ft(e))&&(n=a,t=sc(e,a))),1===t))throw i=Ol,uc(e,0),oc(e,n),nc(e,Je()),i;switch(e.finishedWork=r,e.finishedLanes=n,t){case 0:case 1:throw Error(s(345));case 2:case 5:xc(e,zl,Gl);break;case 3:if(oc(e,n),(130023424&n)===n&&10<(t=jl+500-Je())){if(0!==ut(e,0))break;if(((r=e.suspendedLanes)&n)!==n){ec(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=nr(xc.bind(null,e,zl,Gl),t);break}xc(e,zl,Gl);break;case 4:if(oc(e,n),(4194240&n)===n)break;for(t=e.eventTimes,r=-1;0<n;){var o=31-at(n);a=1<<o,(o=t[o])>r&&(r=o),n&=~a}if(n=r,10<(n=(120>(n=Je()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*_l(n/1960))-n)){e.timeoutHandle=nr(xc.bind(null,e,zl,Gl),n);break}xc(e,zl,Gl);break;default:throw Error(s(329))}}}return nc(e,Je()),e.callbackNode===i?rc.bind(null,e):null}function sc(e,t){var i=Ul;return e.current.memoizedState.isDehydrated&&(uc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=zl,zl=i,null!==t&&ac(t)),e}function ac(e){null===zl?zl=e:zl.push.apply(zl,e)}function oc(e,t){for(t&=~Fl,t&=~kl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-at(t),n=1<<i;e[i]=-1,t&=~n}}function lc(e){if(0!==(6&Tl))throw Error(s(327));wc();var t=ut(e,0);if(0===(1&t))return nc(e,Je()),null;var i=gc(e,t);if(0!==e.tag&&2===i){var n=ft(e);0!==n&&(t=n,i=sc(e,n))}if(1===i)throw i=Ol,uc(e,0),oc(e,t),nc(e,Je()),i;if(6===i)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e,zl,Gl),nc(e,Je()),null}function cc(e,t){var i=Tl;Tl|=1;try{return e(t)}finally{0===(Tl=i)&&(Vl=Je()+500,Ur&&Vr())}}function hc(e){null!==Xl&&0===Xl.tag&&0===(6&Tl)&&wc();var t=Tl;Tl|=1;var i=Ml.transition,n=bt;try{if(Ml.transition=null,bt=1,e)return e()}finally{bt=n,Ml.transition=i,0===(6&(Tl=t))&&Vr()}}function dc(){Rl=Bl.current,Er(Bl)}function uc(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,rr(i)),null!==Pl)for(i=Pl.return;null!==i;){var n=i;switch(ts(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&Br();break;case 3:Ks(),Er(Ir),Er(Tr),ia();break;case 5:Zs(n);break;case 4:Ks();break;case 13:case 19:Er($s);break;case 10:Ms(n.type._context);break;case 22:case 23:dc()}i=i.return}if(Il=e,Pl=e=Bc(e.current,null),Dl=Rl=t,Ll=0,Ol=null,Fl=kl=Nl=0,zl=Ul=null,null!==Ds){for(t=0;t<Ds.length;t++)if(null!==(n=(i=Ds[t]).interleaved)){i.interleaved=null;var r=n.next,s=i.pending;if(null!==s){var a=s.next;s.next=r,n.next=a}i.pending=n}Ds=null}return e}function pc(e,t){for(;;){var i=Pl;try{if(Cs(),na.current=Ja,ca){for(var n=aa.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}ca=!1}if(sa=0,la=oa=aa=null,ha=!1,da=0,Cl.current=null,null===i||null===i.return){Ll=1,Ol=t,Pl=null;break}e:{var a=e,o=i.return,l=i,c=t;if(t=Dl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var h=c,d=l,u=d.tag;if(0===(1&d.mode)&&(0===u||11===u||15===u)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=go(o);if(null!==f){f.flags&=-257,vo(f,o,l,0,t),1&f.mode&&mo(a,h,t),c=h;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){mo(a,h,t),mc();break e}c=Error(s(426))}else if(rs&&1&l.mode){var v=go(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),fs(lo(c,l));break e}}a=c=lo(c,l),4!==Ll&&(Ll=2),null===Ul?Ul=[a]:Ul.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,js(a,po(0,c,t));break e;case 1:l=c;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Ql||!Ql.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,js(a,fo(a,l,t));break e}}a=a.return}while(null!==a)}Ac(i)}catch(A){t=A,Pl===i&&null!==i&&(Pl=i=i.return);continue}break}}function fc(){var e=El.current;return El.current=Ja,null===e?Ja:e}function mc(){0!==Ll&&3!==Ll&&2!==Ll||(Ll=4),null===Il||0===(268435455&Nl)&&0===(268435455&kl)||oc(Il,Dl)}function gc(e,t){var i=Tl;Tl|=2;var n=fc();for(Il===e&&Dl===t||(Gl=null,uc(e,t));;)try{vc();break}catch(r){pc(e,r)}if(Cs(),Tl=i,El.current=n,null!==Pl)throw Error(s(261));return Il=null,Dl=0,Ll}function vc(){for(;null!==Pl;)bc(Pl)}function yc(){for(;null!==Pl&&!Ye();)bc(Pl)}function bc(e){var t=Sl(e.alternate,e,Rl);e.memoizedProps=e.pendingProps,null===t?Ac(e):Pl=t,Cl.current=null}function Ac(e){var t=e;do{var i=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(i=qo(i,t,Rl)))return void(Pl=i)}else{if(null!==(i=Xo(i,t)))return i.flags&=32767,void(Pl=i);if(null===e)return Ll=6,void(Pl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Pl=t);Pl=t=e}while(null!==t);0===Ll&&(Ll=5)}function xc(e,t,i){var n=bt,r=Ml.transition;try{Ml.transition=null,bt=1,function(e,t,i,n){do{wc()}while(null!==Xl);if(0!==(6&Tl))throw Error(s(327));i=e.finishedWork;var r=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var a=i.lanes|i.childLanes;if(function(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<i;){var r=31-at(i),s=1<<r;t[r]=0,n[r]=-1,e[r]=-1,i&=~s}}(e,a),e===Il&&(Pl=Il=null,Dl=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||ql||(ql=!0,Ic(tt,(function(){return wc(),null}))),a=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||a){a=Ml.transition,Ml.transition=null;var o=bt;bt=1;var l=Tl;Tl|=4,Cl.current=null,function(e,t){if(er=Ht,pn(e=un())){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(n&&0!==n.rangeCount){i=n.anchorNode;var r=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{i.nodeType,a.nodeType}catch(x){i=null;break e}var o=0,l=-1,c=-1,h=0,d=0,u=e,p=null;t:for(;;){for(var f;u!==i||0!==r&&3!==u.nodeType||(l=o+r),u!==a||0!==n&&3!==u.nodeType||(c=o+n),3===u.nodeType&&(o+=u.nodeValue.length),null!==(f=u.firstChild);)p=u,u=f;for(;;){if(u===e)break t;if(p===i&&++h===r&&(l=o),p===a&&++d===n&&(c=o),null!==(f=u.nextSibling))break;p=(u=p).parentNode}u=f}i=-1===l||-1===c?null:{start:l,end:c}}else i=null}i=i||{start:0,end:0}}else i=null;for(tr={focusedElem:e,selectionRange:i},Ht=!1,Zo=t;null!==Zo;)if(e=(t=Zo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Zo=e;else for(;null!==Zo;){t=Zo;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var A=t.stateNode.containerInfo;1===A.nodeType?A.textContent="":9===A.nodeType&&A.documentElement&&A.removeChild(A.documentElement);break;default:throw Error(s(163))}}catch(x){_c(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Zo=e;break}Zo=t.return}m=tl,tl=!1}(e,i),gl(i,e),fn(tr),Ht=!!er,tr=er=null,e.current=i,yl(i,e,r),Ke(),Tl=l,bt=o,Ml.transition=a}else e.current=i;if(ql&&(ql=!1,Xl=e,Yl=r),a=e.pendingLanes,0===a&&(Ql=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),nc(e,Je()),null!==t)for(n=e.onRecoverableError,i=0;i<t.length;i++)r=t[i],n(r.value,{componentStack:r.stack,digest:r.digest});if(Hl)throw Hl=!1,e=Wl,Wl=null,e;0!==(1&Yl)&&0!==e.tag&&wc(),a=e.pendingLanes,0!==(1&a)?e===Jl?Kl++:(Kl=0,Jl=e):Kl=0,Vr()}(e,t,i,n)}finally{Ml.transition=r,bt=n}return null}function wc(){if(null!==Xl){var e=At(Yl),t=Ml.transition,i=bt;try{if(Ml.transition=null,bt=16>e?16:e,null===Xl)var n=!1;else{if(e=Xl,Xl=null,Yl=0,0!==(6&Tl))throw Error(s(331));var r=Tl;for(Tl|=4,Zo=e.current;null!==Zo;){var a=Zo,o=a.child;if(0!==(16&Zo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var h=l[c];for(Zo=h;null!==Zo;){var d=Zo;switch(d.tag){case 0:case 11:case 15:il(8,d,a)}var u=d.child;if(null!==u)u.return=d,Zo=u;else for(;null!==Zo;){var p=(d=Zo).sibling,f=d.return;if(sl(d),d===h){Zo=null;break}if(null!==p){p.return=f,Zo=p;break}Zo=f}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Zo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Zo=o;else e:for(;null!==Zo;){if(0!==(2048&(a=Zo).flags))switch(a.tag){case 0:case 11:case 15:il(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Zo=y;break e}Zo=a.return}}var b=e.current;for(Zo=b;null!==Zo;){var A=(o=Zo).child;if(0!==(2064&o.subtreeFlags)&&null!==A)A.return=o,Zo=A;else e:for(o=b;null!==Zo;){if(0!==(2048&(l=Zo).flags))try{switch(l.tag){case 0:case 11:case 15:nl(9,l)}}catch(w){_c(l,l.return,w)}if(l===o){Zo=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,Zo=x;break e}Zo=l.return}}if(Tl=r,Vr(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(rt,e)}catch(w){}n=!0}return n}finally{bt=i,Ml.transition=t}}return!1}function Sc(e,t,i){e=Us(e,t=po(0,t=lo(i,t),1),1),t=ec(),null!==e&&(vt(e,1,t),nc(e,t))}function _c(e,t,i){if(3===e.tag)Sc(e,e,i);else for(;null!==t;){if(3===t.tag){Sc(t,e,i);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Ql||!Ql.has(n))){t=Us(t,e=fo(t,e=lo(i,e),1),1),e=ec(),null!==t&&(vt(t,1,e),nc(t,e));break}}t=t.return}}function Ec(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&i,Il===e&&(Dl&i)===i&&(4===Ll||3===Ll&&(130023424&Dl)===Dl&&500>Je()-jl?uc(e,0):Fl|=i),nc(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ht,0===(130023424&(ht<<=1))&&(ht=4194304)));var i=ec();null!==(e=Ls(e,t))&&(vt(e,t,i),nc(e,i))}function Mc(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),Cc(e,i)}function Tc(e,t){var i=0;switch(e.tag){case 13:var n=e.stateNode,r=e.memoizedState;null!==r&&(i=r.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(s(314))}null!==n&&n.delete(t),Cc(e,i)}function Ic(e,t){return qe(e,t)}function Pc(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dc(e,t,i,n){return new Pc(e,t,i,n)}function Rc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Bc(e,t){var i=e.alternate;return null===i?((i=Dc(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=14680064&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Lc(e,t,i,n,r,a){var o=2;if(n=e,"function"===typeof e)Rc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case S:return Oc(i.children,r,a,t);case _:o=8,r|=8;break;case E:return(e=Dc(12,i,t,2|r)).elementType=E,e.lanes=a,e;case I:return(e=Dc(13,i,t,r)).elementType=I,e.lanes=a,e;case P:return(e=Dc(19,i,t,r)).elementType=P,e.lanes=a,e;case B:return Nc(i,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:o=10;break e;case M:o=9;break e;case T:o=11;break e;case D:o=14;break e;case R:o=16,n=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Dc(o,i,t,r)).elementType=e,t.type=n,t.lanes=a,t}function Oc(e,t,i,n){return(e=Dc(7,e,n,t)).lanes=i,e}function Nc(e,t,i,n){return(e=Dc(22,e,n,t)).elementType=B,e.lanes=i,e.stateNode={isHidden:!1},e}function kc(e,t,i){return(e=Dc(6,e,null,t)).lanes=i,e}function Fc(e,t,i){return(t=Dc(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uc(e,t,i,n,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function zc(e,t,i,n,r,s,a,o,l){return e=new Uc(e,t,i,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Dc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ns(s),e}function jc(e){if(!e)return Mr;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Rr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var i=e.type;if(Rr(i))return Or(e,i,t)}return t}function Vc(e,t,i,n,r,s,a,o,l){return(e=zc(i,n,!0,e,0,s,0,o,l)).context=jc(null),i=e.current,(s=Fs(n=ec(),r=tc(i))).callback=void 0!==t&&null!==t?t:null,Us(i,s,r),e.current.lanes=r,vt(e,r,n),nc(e,n),e}function Gc(e,t,i,n){var r=t.current,s=ec(),a=tc(r);return i=jc(i),null===t.context?t.context=i:t.pendingContext=i,(t=Fs(s,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=Us(r,t,a))&&(ic(e,r,a,s),zs(e,r,a)),a}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function Qc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}Sl=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ir.current)bo=!0;else{if(0===(e.lanes&i)&&0===(128&t.flags))return bo=!1,function(e,t,i){switch(t.tag){case 3:Io(t),ps();break;case 5:Js(t);break;case 1:Rr(t.type)&&Nr(t);break;case 4:Ys(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,r=t.memoizedProps.value;Cr(ws,n._currentValue),n._currentValue=r;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Cr($s,1&$s.current),t.flags|=128,null):0!==(i&t.child.childLanes)?ko(e,t,i):(Cr($s,1&$s.current),null!==(e=Ho(e,t,i))?e.sibling:null);Cr($s,1&$s.current);break;case 19:if(n=0!==(i&t.childLanes),0!==(128&e.flags)){if(n)return Vo(e,t,i);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Cr($s,$s.current),n)break;return null;case 22:case 23:return t.lanes=0,_o(e,t,i)}return Ho(e,t,i)}(e,t,i);bo=0!==(131072&e.flags)}else bo=!1,rs&&0!==(1048576&t.flags)&&$r(t,Qr,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Go(e,t),e=t.pendingProps;var r=Dr(t,Tr.current);Is(t,i),r=ma(null,t,n,e,r,i);var a=ga();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Rr(n)?(a=!0,Nr(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ns(t),r.updater=no,t.stateNode=r,r._reactInternals=t,oo(t,n,e,i),t=To(null,t,n,!0,a,i)):(t.tag=0,rs&&a&&es(t),Ao(null,t,r,i),t=t.child),t;case 16:n=t.elementType;e:{switch(Go(e,t),e=t.pendingProps,n=(r=n._init)(n._payload),t.type=n,r=t.tag=function(e){if("function"===typeof e)return Rc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===T)return 11;if(e===D)return 14}return 2}(n),e=to(n,e),r){case 0:t=Co(null,t,n,e,i);break e;case 1:t=Mo(null,t,n,e,i);break e;case 11:t=xo(null,t,n,e,i);break e;case 14:t=wo(null,t,n,to(n.type,e),i);break e}throw Error(s(306,n,""))}return t;case 0:return n=t.type,r=t.pendingProps,Co(e,t,n,r=t.elementType===n?r:to(n,r),i);case 1:return n=t.type,r=t.pendingProps,Mo(e,t,n,r=t.elementType===n?r:to(n,r),i);case 3:e:{if(Io(t),null===e)throw Error(s(387));n=t.pendingProps,r=(a=t.memoizedState).element,ks(e,t),Vs(t,n,null,i);var o=t.memoizedState;if(n=o.element,a.isDehydrated){if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Po(e,t,n,i,r=lo(Error(s(423)),t));break e}if(n!==r){t=Po(e,t,n,i,r=lo(Error(s(424)),t));break e}for(ns=cr(t.stateNode.containerInfo.firstChild),is=t,rs=!0,ss=null,i=xs(t,null,n,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(ps(),n===r){t=Ho(e,t,i);break e}Ao(e,t,n,i)}t=t.child}return t;case 5:return Js(t),null===e&&cs(t),n=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,o=r.children,ir(n,r)?o=null:null!==a&&ir(n,a)&&(t.flags|=32),Eo(e,t),Ao(e,t,o,i),t.child;case 6:return null===e&&cs(t),null;case 13:return ko(e,t,i);case 4:return Ys(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=As(t,null,n,i):Ao(e,t,n,i),t.child;case 11:return n=t.type,r=t.pendingProps,xo(e,t,n,r=t.elementType===n?r:to(n,r),i);case 7:return Ao(e,t,t.pendingProps,i),t.child;case 8:case 12:return Ao(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(n=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value,Cr(ws,n._currentValue),n._currentValue=o,null!==a)if(on(a.value,o)){if(a.children===r.children&&!Ir.current){t=Ho(e,t,i);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===a.tag){(c=Fs(-1,i&-i)).tag=2;var h=a.updateQueue;if(null!==h){var d=(h=h.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),h.pending=c}}a.lanes|=i,null!==(c=a.alternate)&&(c.lanes|=i),Ts(a.return,i,t),l.lanes|=i;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=i,null!==(l=o.alternate)&&(l.lanes|=i),Ts(o,i,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}Ao(e,t,r.children,i),t=t.child}return t;case 9:return r=t.type,n=t.pendingProps.children,Is(t,i),n=n(r=Ps(r)),t.flags|=1,Ao(e,t,n,i),t.child;case 14:return r=to(n=t.type,t.pendingProps),wo(e,t,n,r=to(n.type,r),i);case 15:return So(e,t,t.type,t.pendingProps,i);case 17:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:to(n,r),Go(e,t),t.tag=1,Rr(n)?(e=!0,Nr(t)):e=!1,Is(t,i),so(t,n,r),oo(t,n,r,i),To(null,t,n,!0,e,i);case 19:return Vo(e,t,i);case 22:return _o(e,t,i)}throw Error(s(156,t.tag))};var qc="function"===typeof reportError?reportError:function(e){console.error(e)};function Xc(e){this._internalRoot=e}function Yc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function $c(e,t,i,n,r){var s=i._reactRootContainer;if(s){var a=s;if("function"===typeof r){var o=r;r=function(){var e=Hc(a);o.call(e)}}Gc(t,a,e,r)}else a=function(e,t,i,n,r){if(r){if("function"===typeof n){var s=n;n=function(){var e=Hc(a);s.call(e)}}var a=Vc(t,n,e,0,null,!1,0,"",Zc);return e._reactRootContainer=a,e[fr]=a.current,Vn(8===e.nodeType?e.parentNode:e),hc(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof n){var o=n;n=function(){var e=Hc(l);o.call(e)}}var l=zc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[fr]=l.current,Vn(8===e.nodeType?e.parentNode:e),hc((function(){Gc(t,l,i,n)})),l}(i,t,e,r,n);return Hc(a)}Yc.prototype.render=Xc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Gc(e,t,null,null)},Yc.prototype.unmount=Xc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc((function(){Gc(null,e,null,null)})),t[fr]=null}},Yc.prototype.unstable_scheduleHydration=function(e){if(e){var t=_t();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Bt.length&&0!==t&&t<Bt[i].priority;i++);Bt.splice(i,0,e),0===i&&kt(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=dt(t.pendingLanes);0!==i&&(yt(t,1|i),nc(t,Je()),0===(6&Tl)&&(Vl=Je()+500,Vr()))}break;case 13:hc((function(){var t=Ls(e,1);if(null!==t){var i=ec();ic(t,e,1,i)}})),Qc(e,1)}},wt=function(e){if(13===e.tag){var t=Ls(e,134217728);if(null!==t)ic(t,e,134217728,ec());Qc(e,134217728)}},St=function(e){if(13===e.tag){var t=tc(e),i=Ls(e,t);if(null!==i)ic(i,e,t,ec());Qc(e,t)}},_t=function(){return bt},Et=function(e,t){var i=bt;try{return bt=e,t()}finally{bt=i}},we=function(e,t,i){switch(t){case"input":if(Z(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var r=xr(n);if(!r)throw Error(s(90));q(n),Z(n,r)}}}break;case"textarea":se(e,i);break;case"select":null!=(t=i.value)&&ie(e,!!i.multiple,t,!1)}},Te=cc,Ie=hc;var eh={usingClientEntryPoint:!1,Events:[br,Ar,xr,Ce,Me,cc]},th={findFiberByHostInstance:yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ih={bundleType:th.bundleType,version:th.version,rendererPackageName:th.rendererPackageName,rendererConfig:th.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:A.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:th.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var nh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nh.isDisabled&&nh.supportsFiber)try{rt=nh.inject(ih),st=nh}catch(he){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eh,t.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(s(200));return function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}(e,t,null,i)},t.createRoot=function(e,t){if(!Kc(e))throw Error(s(299));var i=!1,n="",r=qc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=zc(e,1,!1,null,0,i,0,n,r),e[fr]=t.current,Vn(8===e.nodeType?e.parentNode:e),new Xc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return hc(e)},t.hydrate=function(e,t,i){if(!Jc(t))throw Error(s(200));return $c(null,e,t,!0,i)},t.hydrateRoot=function(e,t,i){if(!Kc(e))throw Error(s(405));var n=null!=i&&i.hydratedSources||null,r=!1,a="",o=qc;if(null!==i&&void 0!==i&&(!0===i.unstable_strictMode&&(r=!0),void 0!==i.identifierPrefix&&(a=i.identifierPrefix),void 0!==i.onRecoverableError&&(o=i.onRecoverableError)),t=Vc(t,null,e,1,null!=i?i:null,r,0,a,o),e[fr]=t.current,Vn(e),n)for(e=0;e<n.length;e++)r=(r=(i=n[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,r]:t.mutableSourceEagerHydrationData.push(i,r);return new Yc(t)},t.render=function(e,t,i){if(!Jc(t))throw Error(s(200));return $c(null,e,t,!1,i)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(s(40));return!!e._reactRootContainer&&(hc((function(){$c(null,null,e,!1,(function(){e._reactRootContainer=null,e[fr]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,i,n){if(!Jc(i))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return $c(e,t,i,!1,n)},t.version="18.3.1-next-f1338f8080-20240426"},4391:(e,t,i)=>{"use strict";var n=i(7950);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},7950:(e,t,i)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=i(2730)},936:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var i=a(t);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=r?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}n.default=e,i&&i.set(e,n);return n}(i(5043)),s=(n=i(6638))&&n.__esModule?n:{default:n};function a(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(a=function(e){return e?i:t})(e)}const o=Math.abs,l=parseFloat,c="min",h="max",d="any",u="vertical",p="tabindex",f="data-lower",m="data-upper",g="data-active",v="data-vertical",y="data-disabled";class b extends r.PureComponent{constructor(){super(),this.element=(0,r.createRef)(),this.input=[(0,r.createRef)(),(0,r.createRef)()],this.thumb=[(0,r.createRef)(),(0,r.createRef)()],this.range=(0,r.createRef)(),this.options={},this.firstCall=!0,this.isControlled=!1,this.externalInput=!1,this.isComponentMounted=!1,this.lastValueProp=[]}componentDidMount(){this.isComponentMounted||(this.value=this.setMinMaxProps(),this.index=this.setMinMaxProps(0,1),this.thumbWidth=this.setMinMaxProps(),this.thumbHeight=this.setMinMaxProps(),this.rangeLimits=this.setMinMaxProps(),this.sliderValue=this.setMinMaxProps(),this.maxRangeWidth=0,this.rangeWidth=0,this.isDragging=!1,this.thumbDrag=!1,this.startPos=0,this.reset(),this.addNodeEventListener(this.element.current,"pointerdown",(e=>{this.elementFocused(e)})),this.thumb.forEach(((e,t)=>{this.addNodeEventListener(e.current,"pointerdown",(i=>{this.initiateThumbDrag(i,t,e.current)})),this.addNodeEventListener(e.current,"keydown",(e=>{e.which>=37&&e.which<=40&&(e.preventDefault(),this.stepValue(t,e.which))}))})),this.addNodeEventListener(this.range.current,"pointerdown",(e=>{this.initiateRangeDrag(e)})),this.pointerMoveEvent=e=>{this.drag(e)},this.pointerUpEvent=()=>{this.isDragging&&(this.removeNodeAttribute(this.thumb[0].current,g),this.removeNodeAttribute(this.thumb[1].current,g),this.removeNodeAttribute(this.range.current,g),this.isDragging=!1,this.thumbDrag?this.options.onThumbDragEnd&&this.options.onThumbDragEnd():this.options.onRangeDragEnd&&this.options.onRangeDragEnd())},this.resizeEvent=()=>{this.syncThumbDimensions(),this.updateThumbs(),this.updateRange()},this.addNodeEventListener(document,"pointermove",this.pointerMoveEvent),this.addNodeEventListener(document,"pointerup",this.pointerUpEvent),this.addNodeEventListener(window,"resize",this.resizeEvent),this.isComponentMounted=!0)}componentDidUpdate(){this.reset()}componentWillUnmount(){this.removeNodeEventListener(document,"pointermove",this.pointerMoveEvent),this.removeNodeEventListener(document,"pointerup",this.pointerUpEvent),this.removeNodeEventListener(window,"resize",this.resizeEvent),this.isComponentMounted=!1}reset(){this.isControlled=!!this.props.value,this.isControlled&&((this.firstCall||this.props.value!==this.lastValueProp)&&(this.firstCall=!1,this.externalInput=!0),this.lastValueProp=this.props.value),this.maxRangeWidth=this.options.max-this.options.min,this.updateOrientation(),this.setValue("",!0,!1),this.updateRangeLimits(),this.updateDisabledState(),this.updateThumbsDisabledState(),this.updateTabIndexes()}isNumber(e){return!isNaN(e)&&+e+""===e+""}setMinMaxProps(){return{min:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,max:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}}iterateMinMaxProps(e){[c,h].forEach(e)}getSetProps(e,t,i){if(e)return t;i()}setNodeAttribute(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e.setAttribute(t,i)}removeNodeAttribute(e,t){e.removeAttribute(t)}addNodeEventListener(e,t,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.addEventListener(t,i,n?{passive:!1,capture:!0}:{})}removeNodeEventListener(e,t,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.removeEventListener(t,i,n?{passive:!1,capture:!0}:{})}fallbackToDefault(e,t){this.options[e]=this.props[e]?this.props[e]:t}ifVerticalElse(e,t){return this.options.orientation===u?e:t}currentIndex(e){return 1===e?this.index.max:this.index.min}safeMinMaxValues(){let e=!1;this.isNumber(this.options.min)&&this.isNumber(this.options.max)||(e=!0),this.options.min=e?1:+this.options.min,this.options.max=e?1:+this.options.max}safeThumbsDisabledValues(){this.options.thumbsDisabled instanceof Array?(1===this.options.thumbsDisabled.length&&this.options.thumbsDisabled.push(!1),1!==this.options.thumbsDisabled.length&&2!==this.options.thumbsDisabled.length&&(this.options.thumbsDisabled=[!1,!1])):this.options.thumbsDisabled=[this.options.thumbsDisabled,this.options.thumbsDisabled],this.options.thumbsDisabled[0]=!!this.options.thumbsDisabled[0],this.options.thumbsDisabled[1]=!!this.options.thumbsDisabled[1]}setValue(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=this.setMinMaxProps(this.input[0].current.value,this.input[1].current.value);e=e||n,this.input[this.index.min].current.value=e.min,this.input[this.index.max].current.value=this.thumbDrag||t?e.max:e.min+this.rangeWidth,this.syncValues(),this.value.min>this.value.max&&(this.index.min=+!this.index.min,this.index.max=+!this.index.max,this.removeNodeAttribute(this.thumb[this.index.min].current,m),this.removeNodeAttribute(this.thumb[this.index.max].current,f),this.setNodeAttribute(this.thumb[this.index.min].current,f),this.setNodeAttribute(this.thumb[this.index.max].current,m),this.thumbDrag&&(this.thumbDrag=this.thumbDrag===c?h:c),this.syncValues()),this.sliderValue=t?this.value:e;let r=!1;(n.min!==this.input[0].current.value||t)&&(r=!0),(n.max!==this.input[1].current.value||t)&&(r=!0),r&&(i&&this.options.onInput&&this.options.onInput([this.value.min,this.value.max]),this.isControlled&&!this.externalInput||(this.externalInput=!1,this.syncThumbDimensions(),this.updateThumbs(),this.updateRange(),this.updateAriaValueAttributes()))}syncValues(){this.iterateMinMaxProps((e=>{this.value[e]=+this.input[this.index[e]].current.value}))}updateThumbs(){this.iterateMinMaxProps((e=>{this.thumb[this.index[e]].current.style[this.ifVerticalElse("top","left")]="calc(".concat((this.value[e]-this.options.min)/this.maxRangeWidth*100,"% + ").concat((.5-(this.value[e]-this.options.min)/this.maxRangeWidth)*this.ifVerticalElse(this.thumbHeight,this.thumbWidth)[e],"px)")}))}updateRange(){const e=this.element.current.getBoundingClientRect(),t=(.5-(this.value.min-this.options.min)/this.maxRangeWidth)*this.ifVerticalElse(this.thumbHeight,this.thumbWidth).min/this.ifVerticalElse(e.bottom-e.top,e.right-e.left),i=(.5-(this.value.max-this.options.min)/this.maxRangeWidth)*this.ifVerticalElse(this.thumbHeight,this.thumbWidth).max/this.ifVerticalElse(e.bottom-e.top,e.right-e.left);this.range.current.style[this.ifVerticalElse("top","left")]="".concat(100*((this.value.min-this.options.min)/this.maxRangeWidth+t),"%"),this.range.current.style[this.ifVerticalElse("height","width")]="".concat(100*((this.value.max-this.options.min)/this.maxRangeWidth-(this.value.min-this.options.min)/this.maxRangeWidth-t+i),"%")}updateRangeLimits(){this.iterateMinMaxProps(((e,t)=>{this.rangeLimits[e]=this.options.thumbsDisabled[t]?this.value[e]:this.options[e]}))}updateTabIndexes(){this.iterateMinMaxProps(((e,t)=>{this.options.disabled||this.options.thumbsDisabled[t]?this.removeNodeAttribute(this.thumb[this.currentIndex(t)].current,p):this.setNodeAttribute(this.thumb[this.currentIndex(t)].current,p,0)}))}updateAriaValueAttributes(){this.iterateMinMaxProps((e=>{this.setNodeAttribute(this.thumb[this.index[e]].current,"aria-valuemin",this.options.min),this.setNodeAttribute(this.thumb[this.index[e]].current,"aria-valuemax",this.options.max),this.setNodeAttribute(this.thumb[this.index[e]].current,"aria-valuenow",this.value[e]),this.setNodeAttribute(this.thumb[this.index[e]].current,"aria-valuetext",this.value[e])}))}updateDisabledState(){this.options.disabled?this.setNodeAttribute(this.element.current,y):this.removeNodeAttribute(this.element.current,y)}updateThumbsDisabledState(){this.options.thumbsDisabled.forEach(((e,t)=>{const i=this.currentIndex(t);e?(this.setNodeAttribute(this.thumb[i].current,y),this.setNodeAttribute(this.thumb[i].current,"aria-disabled",!0)):(this.removeNodeAttribute(this.thumb[i].current,y),this.setNodeAttribute(this.thumb[i].current,"aria-disabled",!1))}))}updateLimits(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.options[e]=t,this.safeMinMaxValues(),this.iterateMinMaxProps((e=>{this.input[0].current[e]=this.options[e],this.input[1].current[e]=this.options[e]})),this.maxRangeWidth=this.options.max-this.options.min,this.setValue("",!0),this.updateRangeLimits()}updateOrientation(){this.options.orientation===u?this.setNodeAttribute(this.element.current,v):this.removeNodeAttribute(this.element.current,v),this.range.current.style[this.ifVerticalElse("left","top")]="",this.range.current.style[this.ifVerticalElse("width","height")]="",this.thumb[0].current.style[this.ifVerticalElse("left","top")]="",this.thumb[1].current.style[this.ifVerticalElse("left","top")]=""}syncThumbDimensions(){this.iterateMinMaxProps((e=>{this.thumbWidth[e]=l(window.getComputedStyle(this.thumb[this.index[e]].current).width),this.thumbHeight[e]=l(window.getComputedStyle(this.thumb[this.index[e]].current).height)}))}currentPosition(e,t){const i=this.element.current.getBoundingClientRect(),n=t.getBoundingClientRect(),r=(this.ifVerticalElse(n.top-i.top,n.left-i.left)+(e["client".concat(this.ifVerticalElse("Y","X"))]-t.getBoundingClientRect()[this.ifVerticalElse("top","left")])-(this.thumbDrag?(.5-(this.value[this.thumbDrag]-this.options.min)/this.maxRangeWidth)*this.ifVerticalElse(this.thumbHeight,this.thumbWidth)[this.thumbDrag]:0))/this.ifVerticalElse(i.bottom-i.top,i.right-i.left)*this.maxRangeWidth+this.options.min;return r<this.options.min?this.options.min:r>this.options.max?this.options.max:r}doesntHaveClassName(e,t){return!e.target.classList.contains(t)}elementFocused(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!1;if(!this.options.disabled&&(this.doesntHaveClassName(e,"range-slider__thumb")&&this.doesntHaveClassName(e,"range-slider__range")||this.options.rangeSlideDisabled&&this.doesntHaveClassName(e,"range-slider__thumb"))&&(i=!0),i&&this.options.thumbsDisabled[0]&&this.options.thumbsDisabled[1]&&(i=!1),i){const i=this.currentPosition(e,this.range.current),n=o(this.value.min-i),r=o(this.value.max-i);if(this.options.thumbsDisabled[0])i>=this.value.min&&(this.setValue(this.setMinMaxProps(this.value.min,i),!0,!t),this.initiateThumbDrag(e,this.index.max,this.thumb[this.index.max].current,!t));else if(this.options.thumbsDisabled[1])i<=this.value.max&&(this.setValue(this.setMinMaxProps(i,this.value.max),!0,!t),this.initiateThumbDrag(e,this.index.min,this.thumb[this.index.min].current,!t));else{let s=this.index.max;n===r?this.setValue(this.setMinMaxProps(this.value.min,i),!0,!t):(this.setValue(this.setMinMaxProps(n<r?i:this.value.min,r<n?i:this.value.max),!0,!t),s=n<r?this.index.min:this.index.max),this.initiateThumbDrag(e,s,this.thumb[s].current,!t)}t&&this.elementFocused(e,!1)}}initiateDrag(e,t){this.syncThumbDimensions(),this.setNodeAttribute(t,g),this.startPos=this.currentPosition(e,t),this.isDragging=!0}initiateThumbDrag(e,t,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.options.disabled||this.options.thumbsDisabled[this.currentIndex(t)]||(this.initiateDrag(e,i),this.thumbDrag=this.index.min===t?c:h,n&&this.options.onThumbDragStart&&this.options.onThumbDragStart())}initiateRangeDrag(e){this.options.disabled||this.options.rangeSlideDisabled||(this.initiateDrag(e,this.range.current),this.rangeWidth=this.value.max-this.value.min,this.thumbDrag=!1,this.options.onRangeDragStart&&this.options.onRangeDragStart())}drag(e){if(this.isDragging){const t=this.currentPosition(e,this.range.current),i=t-this.startPos;let n=this.value.min,r=this.value.max;const s=this.thumbDrag?this.rangeLimits.min:this.options.min,a=this.thumbDrag?this.rangeLimits.max:this.options.max;this.thumbDrag&&this.thumbDrag!==c||(n=this.thumbDrag?t:this.sliderValue.min+i),this.thumbDrag&&this.thumbDrag!==h||(r=this.thumbDrag?t:this.sliderValue.max+i),n>=s&&n<=a&&r>=s&&r<=a?(this.setValue({min:n,max:r}),this.startPos=t):(n>a&&this.thumbDrag&&(this.setValue(this.setMinMaxProps(a,a)),this.startPos=t),r<s&&this.thumbDrag&&(this.setValue(this.setMinMaxProps(s,s)),this.startPos=t),n<s&&(this.thumbDrag?this.setValue(this.setMinMaxProps(s,this.value.max)):this.setValue(this.setMinMaxProps(s,this.value.max-this.value.min+s)),this.startPos=t),r>a&&(this.thumbDrag?this.setValue(this.setMinMaxProps(this.value.min,a)):this.setValue(this.setMinMaxProps(this.value.min-this.value.max+a,a)),this.startPos=t)),this.thumbDrag||this.updateRangeLimits()}}actualStepValue(){const e=l(this.input[0].current.step);return this.input[0].current.step===d?d:0===e||isNaN(e)?1:e}stepValue(e,t){const i=(37===t||40===t?-1:1)*this.ifVerticalElse(-1,1);if(!this.options.disabled&&!this.options.thumbsDisabled[this.currentIndex(e)]){let t=this.actualStepValue();t=t===d?1:t;let n=this.value.min+t*(this.index.min===e?i:0),r=this.value.max+t*(this.index.max===e?i:0);n>this.rangeLimits.max&&(n=this.rangeLimits.max),r<this.rangeLimits.min&&(r=this.rangeLimits.min),this.setValue({min:n,max:r},!0)}}render(){return this.fallbackToDefault("rangeSlideDisabled",!1),this.fallbackToDefault("thumbsDisabled",[!1,!1]),this.fallbackToDefault("orientation","horizontal"),this.fallbackToDefault("defaultValue",[25,75]),this.fallbackToDefault("disabled",!1),this.fallbackToDefault("onThumbDragStart",!1),this.fallbackToDefault("onRangeDragStart",!1),this.fallbackToDefault("onThumbDragEnd",!1),this.fallbackToDefault("onRangeDragEnd",!1),this.fallbackToDefault("onInput",!1),this.fallbackToDefault("step",1),this.fallbackToDefault("min",0),this.fallbackToDefault("max",100),this.props.value&&this.fallbackToDefault("value",[25,75]),this.safeMinMaxValues(),this.safeThumbsDisabledValues(),r.default.createElement("div",{"data-testid":"element",id:this.props.id,ref:this.element,className:(0,s.default)("range-slider",this.props.className)},r.default.createElement("input",{ref:this.input[0],type:"range",min:this.options.min,max:this.options.max,step:this.options.step,value:this.props.value?this.options.value[0]:this.isComponentMounted?this.value.min:this.options.defaultValue[0],onChange:()=>{},disabled:!0}),r.default.createElement("input",{ref:this.input[1],type:"range",min:this.options.min,max:this.options.max,step:this.options.step,value:this.props.value?this.options.value[1]:this.isComponentMounted?this.value.max:this.options.defaultValue[1],onChange:()=>{},disabled:!0}),r.default.createElement("div",{ref:this.thumb[0],role:"slider",className:"range-slider__thumb","data-lower":!0}),r.default.createElement("div",{ref:this.thumb[1],role:"slider",className:"range-slider__thumb","data-upper":!0}),r.default.createElement("div",{ref:this.range,className:"range-slider__range"}))}}var A=b;t.default=A},1123:(e,t,i)=>{"use strict";var n;t.A=void 0;var r=((n=i(936))&&n.__esModule?n:{default:n}).default;t.A=r},6638:(e,t,i)=>{"use strict";function n(e){var t,i,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(i=n(e[t]))&&(r&&(r+=" "),r+=i);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}function r(){for(var e,t,i=0,r="";i<arguments.length;)(e=arguments[i++])&&(t=n(e))&&(r&&(r+=" "),r+=t);return r}i.r(t),i.d(t,{clsx:()=>r,default:()=>s});const s=r},1153:(e,t,i)=>{"use strict";var n=i(5043),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var n,s={},c=null,h=null;for(n in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(h=t.ref),t)a.call(t,n)&&!l.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===s[n]&&(s[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:h,props:s,_owner:o.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},4202:(e,t)=>{"use strict";var i=Symbol.for("react.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}function y(){}function b(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var A=b.prototype=new y;A.constructor=b,m(A,v.prototype),A.isPureReactComponent=!0;var x=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},_={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,n){var r,s={},a=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)w.call(t,r)&&!_.hasOwnProperty(r)&&(s[r]=t[r]);var l=arguments.length-2;if(1===l)s.children=n;else if(1<l){for(var c=Array(l),h=0;h<l;h++)c[h]=arguments[h+2];s.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:i,type:e,key:a,ref:o,props:s,_owner:S.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var M=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function I(e,t,r,s,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case n:l=!0}}if(l)return a=a(l=e),e=""===s?"."+T(l,0):s,x(a)?(r="",null!=e&&(r=e.replace(M,"$&/")+"/"),I(a,t,r,"",(function(e){return e}))):null!=a&&(C(a)&&(a=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(M,"$&/")+"/")+e)),t.push(a)),1;if(l=0,s=""===s?".":s+":",x(e))for(var c=0;c<e.length;c++){var h=s+T(o=e[c],c);l+=I(o,t,r,h,a)}else if(h=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof h)for(e=h.call(e),c=0;!(o=e.next()).done;)l+=I(o=o.value,t,r,h=s+T(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function P(e,t,i){if(null==e)return e;var n=[],r=0;return I(e,n,"","",(function(e){return t.call(i,e,r++)})),n}function D(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R={current:null},B={transition:null},L={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:B,ReactCurrentOwner:S};function O(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:P,forEach:function(e,t,i){P(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=a,t.PureComponent=b,t.StrictMode=s,t.Suspense=h,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.act=O,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),s=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=S.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!_.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=n;else if(1<c){l=Array(c);for(var h=0;h<c;h++)l[h]=arguments[h+2];r.children=l}return{$$typeof:i,type:e.type,key:s,ref:a,props:r,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=B.transition;B.transition={};try{e()}finally{B.transition=t}},t.unstable_act=O,t.useCallback=function(e,t){return R.current.useCallback(e,t)},t.useContext=function(e){return R.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return R.current.useDeferredValue(e)},t.useEffect=function(e,t){return R.current.useEffect(e,t)},t.useId=function(){return R.current.useId()},t.useImperativeHandle=function(e,t,i){return R.current.useImperativeHandle(e,t,i)},t.useInsertionEffect=function(e,t){return R.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return R.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return R.current.useMemo(e,t)},t.useReducer=function(e,t,i){return R.current.useReducer(e,t,i)},t.useRef=function(e){return R.current.useRef(e)},t.useState=function(e){return R.current.useState(e)},t.useSyncExternalStore=function(e,t,i){return R.current.useSyncExternalStore(e,t,i)},t.useTransition=function(){return R.current.useTransition()},t.version="18.3.1"},5043:(e,t,i)=>{"use strict";e.exports=i(4202)},579:(e,t,i)=>{"use strict";e.exports=i(1153)},7234:(e,t)=>{"use strict";function i(e,t){var i=e.length;e.push(t);e:for(;0<i;){var n=i-1>>>1,r=e[n];if(!(0<s(r,t)))break e;e[n]=t,e[i]=r,i=n}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;e:for(var n=0,r=e.length,a=r>>>1;n<a;){var o=2*(n+1)-1,l=e[o],c=o+1,h=e[c];if(0>s(l,i))c<r&&0>s(h,l)?(e[n]=h,e[c]=i,n=c):(e[n]=l,e[o]=i,n=o);else{if(!(c<r&&0>s(h,i)))break e;e[n]=h,e[c]=i,n=c}}}return t}function s(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],h=[],d=1,u=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function A(e){for(var t=n(h);null!==t;){if(null===t.callback)r(h);else{if(!(t.startTime<=e))break;r(h),t.sortIndex=t.expirationTime,i(c,t)}t=n(h)}}function x(e){if(g=!1,A(e),!m)if(null!==n(c))m=!0,B(w);else{var t=n(h);null!==t&&L(x,t.startTime-e)}}function w(e,i){m=!1,g&&(g=!1,y(C),C=-1),f=!0;var s=p;try{for(A(i),u=n(c);null!==u&&(!(u.expirationTime>i)||e&&!I());){var a=u.callback;if("function"===typeof a){u.callback=null,p=u.priorityLevel;var o=a(u.expirationTime<=i);i=t.unstable_now(),"function"===typeof o?u.callback=o:u===n(c)&&r(c),A(i)}else r(c);u=n(c)}if(null!==u)var l=!0;else{var d=n(h);null!==d&&L(x,d.startTime-i),l=!1}return l}finally{u=null,p=s,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,_=!1,E=null,C=-1,M=5,T=-1;function I(){return!(t.unstable_now()-T<M)}function P(){if(null!==E){var e=t.unstable_now();T=e;var i=!0;try{i=E(!0,e)}finally{i?S():(_=!1,E=null)}}else _=!1}if("function"===typeof b)S=function(){b(P)};else if("undefined"!==typeof MessageChannel){var D=new MessageChannel,R=D.port2;D.port1.onmessage=P,S=function(){R.postMessage(null)}}else S=function(){v(P,0)};function B(e){E=e,_||(_=!0,S())}function L(e,i){C=v((function(){e(t.unstable_now())}),i)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,B(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var i=p;p=t;try{return e()}finally{p=i}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=p;p=e;try{return t()}finally{p=i}},t.unstable_scheduleCallback=function(e,r,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,i(h,e),null===n(c)&&e===n(h)&&(g?(y(C),C=-1):g=!0,L(x,s-a))):(e.sortIndex=o,i(c,e),m||f||(m=!0,B(w))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=p;return function(){var i=p;p=t;try{return e.apply(this,arguments)}finally{p=i}}}},8853:(e,t,i)=>{"use strict";e.exports=i(7234)},4634:e=>{function t(){return e.exports=t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4994:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},4893:e=>{e.exports=function(e,t){if(null==e)return{};var i={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;i[n]=e[n]}return i},e.exports.__esModule=!0,e.exports.default=e.exports},8168:(e,t,i)=>{"use strict";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},n.apply(null,arguments)}i.d(t,{A:()=>n})},8587:(e,t,i)=>{"use strict";function n(e,t){if(null==e)return{};var i={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;i[n]=e[n]}return i}i.d(t,{A:()=>n})},1906:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>vH});var n=i(579),r=i(5043),s=Object.create,a=Object.defineProperty,o=Object.getOwnPropertyDescriptor,l=Object.getOwnPropertyNames,c=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty,d=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),u=(e,t,i)=>(i=null!=e?s(c(e)):{},((e,t,i,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of l(t))!h.call(e,r)&&r!==i&&a(e,r,{get:()=>t[r],enumerable:!(n=o(t,r))||n.enumerable});return e})(!t&&e&&e.__esModule?i:a(i,"default",{value:e,enumerable:!0}),e)),p=(e,t,i)=>(((e,t,i)=>{t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),f=d(((e,t)=>{!function(i,n){"object"==typeof e?t.exports=n():"function"==typeof define&&define.amd?define(n):i.Alea=n()}(e,(function(){return e.importState=function(t){var i=new e;return i.importState(t),i},e;function e(){return function(e){var t=0,i=0,n=0,r=1;0==e.length&&(e=[+new Date]);var s=function(){var e=4022871197,t=function(t){t=t.toString();for(var i=0;i<t.length;i++){var n=.02519603282416938*(e+=t.charCodeAt(i));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}();t=s(" "),i=s(" "),n=s(" ");for(var a=0;a<e.length;a++)(t-=s(e[a]))<0&&(t+=1),(i-=s(e[a]))<0&&(i+=1),(n-=s(e[a]))<0&&(n+=1);s=null;var o=function(){var e=2091639*t+2.3283064365386963e-10*r;return t=i,i=n,n=e-(r=0|e)};return o.next=o,o.uint32=function(){return 4294967296*o()},o.fract53=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.version="Alea 0.9",o.args=e,o.exportState=function(){return[t,i,n,r]},o.importState=function(e){t=+e[0]||0,i=+e[1]||0,n=+e[2]||0,r=+e[3]||0},o}(Array.prototype.slice.call(arguments))}}))})),m=d(((e,t)=>{!function(i,n){"object"==typeof e&&typeof t<"u"?n(e):"function"==typeof define&&define.amd?define(["exports"],n):n((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})}(e,(function(e){e.SVD=function(e,t,i,n,r){if(t=void 0===t||t,i=void 0===i||i,r=1e-64/(n=n||Math.pow(2,-52)),!e)throw new TypeError("Matrix a is not defined");var s,a,o,l,c,h,d,u,p,f,m,g,v=e[0].length,y=e.length;if(y<v)throw new TypeError("Invalid matrix: m < n");for(var b=[],A=[],x=[],w="f"===t?y:v,S=f=d=0;S<y;S++)A[S]=new Array(w).fill(0);for(S=0;S<v;S++)x[S]=new Array(v).fill(0);var _,E=new Array(v).fill(0);for(S=0;S<y;S++)for(s=0;s<v;s++)A[S][s]=e[S][s];for(S=0;S<v;S++){for(b[S]=d,p=0,o=S+1,s=S;s<y;s++)p+=Math.pow(A[s][S],2);if(p<r)d=0;else for(u=(h=A[S][S])*(d=h<0?Math.sqrt(p):-Math.sqrt(p))-p,A[S][S]=h-d,s=o;s<v;s++){for(p=0,a=S;a<y;a++)p+=A[a][S]*A[a][s];for(h=p/u,a=S;a<y;a++)A[a][s]=A[a][s]+h*A[a][S]}for(E[S]=d,p=0,s=o;s<v;s++)p+=Math.pow(A[S][s],2);if(p<r)d=0;else{for(u=(h=A[S][S+1])*(d=h<0?Math.sqrt(p):-Math.sqrt(p))-p,A[S][S+1]=h-d,s=o;s<v;s++)b[s]=A[S][s]/u;for(s=o;s<y;s++){for(p=0,a=o;a<v;a++)p+=A[s][a]*A[S][a];for(a=o;a<v;a++)A[s][a]=A[s][a]+p*b[a]}}f<(m=Math.abs(E[S])+Math.abs(b[S]))&&(f=m)}if(i)for(S=v-1;0<=S;S--){if(0!==d){for(u=A[S][S+1]*d,s=o;s<v;s++)x[s][S]=A[S][s]/u;for(s=o;s<v;s++){for(p=0,a=o;a<v;a++)p+=A[S][a]*x[a][s];for(a=o;a<v;a++)x[a][s]=x[a][s]+p*x[a][S]}}for(s=o;s<v;s++)x[S][s]=0,x[s][S]=0;x[S][S]=1,d=b[S],o=S}if(t){if("f"===t)for(S=v;S<y;S++){for(s=v;s<y;s++)A[S][s]=0;A[S][S]=1}for(S=v-1;0<=S;S--){for(o=S+1,d=E[S],s=o;s<w;s++)A[S][s]=0;if(0!==d){for(u=A[S][S]*d,s=o;s<w;s++){for(p=0,a=o;a<y;a++)p+=A[a][S]*A[a][s];for(h=p/u,a=S;a<y;a++)A[a][s]=A[a][s]+h*A[a][S]}for(s=S;s<y;s++)A[s][S]=A[s][S]/d}else for(s=S;s<y;s++)A[s][S]=0;A[S][S]=A[S][S]+1}}for(n*=f,a=v-1;0<=a;a--)for(var C=0;C<50;C++){for(_=!1,o=a;0<=o;o--){if(Math.abs(b[o])<=n){_=!0;break}if(Math.abs(E[o-1])<=n)break}if(!_)for(c=0,l=o-(p=1),S=o;S<a+1&&(h=p*b[S],b[S]=c*b[S],!(Math.abs(h)<=n));S++)if(d=E[S],E[S]=Math.sqrt(h*h+d*d),c=d/(u=E[S]),p=-h/u,t)for(s=0;s<y;s++)m=A[s][l],g=A[s][S],A[s][l]=m*c+g*p,A[s][S]=-m*p+g*c;if(g=E[a],o===a){if(g<0&&(E[a]=-g,i))for(s=0;s<v;s++)x[s][a]=-x[s][a];break}for(f=E[o],h=(((m=E[a-1])-g)*(m+g)+((d=b[a-1])-(u=b[a]))*(d+u))/(2*u*m),d=Math.sqrt(h*h+1),h=((f-g)*(f+g)+u*(m/(h<0?h-d:h+d)-u))/f,S=o+(p=c=1);S<a+1;S++){if(d=b[S],m=E[S],u=p*d,d*=c,g=Math.sqrt(h*h+u*u),h=f*(c=h/(b[S-1]=g))+d*(p=u/g),d=-f*p+d*c,u=m*p,m*=c,i)for(s=0;s<v;s++)f=x[s][S-1],g=x[s][S],x[s][S-1]=f*c+g*p,x[s][S]=-f*p+g*c;if(g=Math.sqrt(h*h+u*u),h=(c=h/(E[S-1]=g))*d+(p=u/g)*m,f=-p*d+c*m,t)for(s=0;s<y;s++)m=A[s][S-1],g=A[s][S],A[s][S-1]=m*c+g*p,A[s][S]=-m*p+g*c}b[o]=0,b[a]=h,E[a]=f}for(S=0;S<v;S++)E[S]<n&&(E[S]=0);return{u:A,q:E,v:x}},e.VERSION="1.1.1",Object.defineProperty(e,"__esModule",{value:!0})}))})),g=d(((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)},t.exports=e.default})),v=d(((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()},t.exports=e.default})),y=d(((e,t)=>{function i(e,t,n,r){this.message=e,this.expected=t,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,i)}!function(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}(i,Error),i.buildMessage=function(e,t){var i,n={literal:function(e){return'"'+s(e.text)+'"'},class:function(e){var t,i="";for(t=0;t<e.parts.length;t++)i+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+i+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function s(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function o(e){return n[e.type](e)}return"Expected "+function(e){var t,i,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=o(e[t]);if(n.sort(),n.length>0){for(t=1,i=1;t<n.length;t++)n[t-1]!==n[t]&&(n[i]=n[t],i++);n.length=i}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+(((i=t)?'"'+s(i)+'"':"end of input")+" found.")},t.exports={SyntaxError:i,parse:function(e,t){t=void 0!==t?t:{};var n,r={},s={svg_path:ge},a=ge,o=function(e){if(!e)return[];for(var t=[],i=0;i<e.length;i++)t=t.concat.apply(t,e[i]);var n=t[0];return n&&"m"==n.code&&(delete n.relative,n.code="M"),t},l=function(e,t){return function(e,t){if(!t)return[e];for(var i=[e],n=0,r=t.length;n<r;n++)i[n+1]=t[n][1];return i}(e,t)},c=/^[Mm]/,h=de(["M","m"],!1,!1),d=function(e,t,i){var n=Fe(e,[t]);return i&&(n=n.concat(Fe("M"==e?"L":"l",i[1]))),n},u=/^[Zz]/,p=de(["Z","z"],!1,!1),f=function(){return Fe("Z")},m=/^[Ll]/,g=de(["L","l"],!1,!1),v=function(e,t){return Fe(e,t)},y=/^[Hh]/,b=de(["H","h"],!1,!1),A=function(e,t){return Fe(e,t.map((function(e){return{x:e}})))},x=/^[Vv]/,w=de(["V","v"],!1,!1),S=function(e,t){return Fe(e,t.map((function(e){return{y:e}})))},_=/^[Cc]/,E=de(["C","c"],!1,!1),C=function(e,t,i){return{x1:e.x,y1:e.y,x2:t.x,y2:t.y,x:i.x,y:i.y}},M=/^[Ss]/,T=de(["S","s"],!1,!1),I=function(e,t){return{x2:e.x,y2:e.y,x:t.x,y:t.y}},P=/^[Qq]/,D=de(["Q","q"],!1,!1),R=function(e,t){return{x1:e.x,y1:e.y,x:t.x,y:t.y}},B=/^[Tt]/,L=de(["T","t"],!1,!1),O=/^[Aa]/,N=de(["A","a"],!1,!1),k=function(e,t,i,n,r,s){return{rx:e,ry:t,xAxisRotation:i,largeArc:n,sweep:r,x:s.x,y:s.y}},F=function(e,t){return{x:e,y:t}},U=function(e){return 1*e},z=function(e){return 1*e.join("")},j=/^[01]/,V=de(["0","1"],!1,!1),G=function(e){return"1"==e},H=function(){return""},W=",",Q=he(",",!1),q=function(e){return e.join("")},X=".",Y=he(".",!1),K=/^[eE]/,J=de(["e","E"],!1,!1),Z=/^[+\-]/,$=de(["+","-"],!1,!1),ee=/^[0-9]/,te=de([["0","9"]],!1,!1),ie=function(e){return e.join("")},ne=/^[ \t\n\r]/,re=de([" ","\t","\n","\r"],!1,!1),se=0,ae=[{line:1,column:1}],oe=0,le=[],ce=0;if("startRule"in t){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');a=s[t.startRule]}function he(e,t){return{type:"literal",text:e,ignoreCase:t}}function de(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function ue(t){var i,n=ae[t];if(n)return n;for(i=t-1;!ae[i];)i--;for(n={line:(n=ae[i]).line,column:n.column};i<t;)10===e.charCodeAt(i)?(n.line++,n.column=1):n.column++,i++;return ae[t]=n,n}function pe(e,t){var i=ue(e),n=ue(t);return{start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:n.line,column:n.column}}}function fe(e){se<oe||(se>oe&&(oe=se,le=[]),le.push(e))}function me(e,t,n){return new i(i.buildMessage(e,t),e,t,n)}function ge(){var e,t,i,n,s;for(e=se,t=[],i=Oe();i!==r;)t.push(i),i=Oe();if(t!==r)if(i=function(){var e,t,i,n,s,a;if(e=se,t=ve(),t!==r){for(i=[],n=se,s=[],a=Oe();a!==r;)s.push(a),a=Oe();for(s!==r?(a=ve())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);n!==r;){for(i.push(n),n=se,s=[],a=Oe();a!==r;)s.push(a),a=Oe();s!==r?(a=ve())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r)}i!==r?e=t=l(t,i):(se=e,e=r)}else se=e,e=r;return e}(),i===r&&(i=null),i!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?e=t=o(i):(se=e,e=r)}else se=e,e=r;else se=e,e=r;return e}function ve(){var t,i,n,s,a,o;if(t=se,i=function(){var t,i,n,s,a,o,l;if(t=se,c.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(h)),i!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?(s=Ee())!==r?(a=se,(o=Ie())===r&&(o=null),o!==r?(l=be())!==r?a=o=[o,l]:(se=a,a=r):(se=a,a=r),a===r&&(a=null),a!==r?t=i=d(i,s,a):(se=t,t=r)):(se=t,t=r):(se=t,t=r)}else se=t,t=r;return t}(),i!==r){for(n=[],s=se,a=[],o=Oe();o!==r;)a.push(o),o=Oe();for(a!==r?(o=ye())!==r?s=a=[a,o]:(se=s,s=r):(se=s,s=r);s!==r;){for(n.push(s),s=se,a=[],o=Oe();o!==r;)a.push(o),o=Oe();a!==r?(o=ye())!==r?s=a=[a,o]:(se=s,s=r):(se=s,s=r)}n!==r?t=i=l(i,n):(se=t,t=r)}else se=t,t=r;return t}function ye(){var t;return(t=function(){var t,i;return t=se,u.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(p)),i!==r&&(i=f()),t=i,t}())===r&&((t=function(){var t,i,n,s;if(t=se,m.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(g)),i!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?(s=be())!==r?t=i=v(i,s):(se=t,t=r):(se=t,t=r)}else se=t,t=r;return t}())===r&&((t=function(){var t,i,n,s;if(t=se,y.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(b)),i!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?(s=Ae())!==r?t=i=A(i,s):(se=t,t=r):(se=t,t=r)}else se=t,t=r;return t}())===r&&((t=function(){var t,i,n,s;if(t=se,x.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(w)),i!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?(s=Ae())!==r?t=i=S(i,s):(se=t,t=r):(se=t,t=r)}else se=t,t=r;return t}())===r&&((t=function(){var t,i,n,s;if(t=se,_.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(E)),i!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?(s=function(){var e,t,i,n,s,a;if(e=se,t=xe(),t!==r){for(i=[],n=se,(s=Ie())===r&&(s=null),s!==r?(a=xe())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);n!==r;)i.push(n),n=se,(s=Ie())===r&&(s=null),s!==r?(a=xe())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);i!==r?e=t=l(t,i):(se=e,e=r)}else se=e,e=r;return e}(),s!==r?t=i=v(i,s):(se=t,t=r)):(se=t,t=r)}else se=t,t=r;return t}())===r&&((t=function(){var t,i,n,s;if(t=se,M.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(T)),i!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?(s=function(){var e,t,i,n,s,a;if(e=se,t=we(),t!==r){for(i=[],n=se,(s=Ie())===r&&(s=null),s!==r?(a=we())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);n!==r;)i.push(n),n=se,(s=Ie())===r&&(s=null),s!==r?(a=we())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);i!==r?e=t=l(t,i):(se=e,e=r)}else se=e,e=r;return e}(),s!==r?t=i=v(i,s):(se=t,t=r)):(se=t,t=r)}else se=t,t=r;return t}())===r&&((t=function(){var t,i,n,s;if(t=se,P.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(D)),i!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?(s=function(){var e,t,i,n,s,a;if(e=se,t=Se(),t!==r){for(i=[],n=se,(s=Ie())===r&&(s=null),s!==r?(a=Se())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);n!==r;)i.push(n),n=se,(s=Ie())===r&&(s=null),s!==r?(a=Se())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);i!==r?e=t=l(t,i):(se=e,e=r)}else se=e,e=r;return e}(),s!==r?t=i=v(i,s):(se=t,t=r)):(se=t,t=r)}else se=t,t=r;return t}())===r&&((t=function(){var t,i,n,s;if(t=se,B.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(L)),i!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?(s=function(){var e,t,i,n,s,a;if(e=se,t=Ee(),t!==r){for(i=[],n=se,(s=Ie())===r&&(s=null),s!==r?(a=Ee())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);n!==r;)i.push(n),n=se,(s=Ie())===r&&(s=null),s!==r?(a=Ee())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);i!==r?e=t=l(t,i):(se=e,e=r)}else se=e,e=r;return e}(),s!==r?t=i=v(i,s):(se=t,t=r)):(se=t,t=r)}else se=t,t=r;return t}())===r&&(t=function(){var t,i,n,s;if(t=se,O.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(N)),i!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?(s=function(){var e,t,i,n,s,a;if(e=se,t=_e(),t!==r){for(i=[],n=se,(s=Ie())===r&&(s=null),s!==r?(a=_e())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);n!==r;)i.push(n),n=se,(s=Ie())===r&&(s=null),s!==r?(a=_e())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);i!==r?e=t=l(t,i):(se=e,e=r)}else se=e,e=r;return e}(),s!==r?t=i=v(i,s):(se=t,t=r)):(se=t,t=r)}else se=t,t=r;return t}())))))))),t}function be(){var e,t,i,n,s,a;if(e=se,(t=Ee())!==r){for(i=[],n=se,(s=Ie())===r&&(s=null),s!==r?(a=Ee())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);n!==r;)i.push(n),n=se,(s=Ie())===r&&(s=null),s!==r?(a=Ee())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);i!==r?e=t=l(t,i):(se=e,e=r)}else se=e,e=r;return e}function Ae(){var e,t,i,n,s,a;if(e=se,(t=Me())!==r){for(i=[],n=se,(s=Ie())===r&&(s=null),s!==r?(a=Me())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);n!==r;)i.push(n),n=se,(s=Ie())===r&&(s=null),s!==r?(a=Me())!==r?n=s=[s,a]:(se=n,n=r):(se=n,n=r);i!==r?e=t=l(t,i):(se=e,e=r)}else se=e,e=r;return e}function xe(){var e,t,i,n,s,a;return e=se,(t=Ee())!==r?((i=Ie())===r&&(i=null),i!==r?(n=Ee())!==r?((s=Ie())===r&&(s=null),s!==r?(a=Ee())!==r?e=t=C(t,n,a):(se=e,e=r):(se=e,e=r)):(se=e,e=r):(se=e,e=r)):(se=e,e=r),e}function we(){var e,t,i,n;return e=se,(t=Ee())!==r?((i=Ie())===r&&(i=null),i!==r?(n=Ee())!==r?e=t=I(t,n):(se=e,e=r):(se=e,e=r)):(se=e,e=r),e}function Se(){var e,t,i,n;return e=se,(t=Ee())!==r?((i=Ie())===r&&(i=null),i!==r?(n=Ee())!==r?e=t=R(t,n):(se=e,e=r):(se=e,e=r)):(se=e,e=r),e}function _e(){var e,t,i,n,s,a,o,l,c,h,d;return e=se,(t=Ce())!==r?((i=Ie())===r&&(i=null),i!==r?(n=Ce())!==r?((s=Ie())===r&&(s=null),s!==r?(a=Me())!==r?Ie()!==r?(o=Te())!==r?((l=Ie())===r&&(l=null),l!==r?(c=Te())!==r?((h=Ie())===r&&(h=null),h!==r?(d=Ee())!==r?e=t=k(t,n,a,o,c,d):(se=e,e=r):(se=e,e=r)):(se=e,e=r):(se=e,e=r)):(se=e,e=r):(se=e,e=r):(se=e,e=r):(se=e,e=r)):(se=e,e=r):(se=e,e=r)):(se=e,e=r),e}function Ee(){var e,t,i,n;return e=se,(t=Me())!==r?((i=Ie())===r&&(i=null),i!==r?(n=Me())!==r?e=t=F(t,n):(se=e,e=r):(se=e,e=r)):(se=e,e=r),e}function Ce(){var e,t;return e=se,(t=De())===r&&(t=Le()),t!==r&&(t=U(t)),e=t}function Me(){var e,t,i,n;return e=se,t=se,(i=Be())===r&&(i=null),i!==r?(n=De())!==r?t=i=[i,n]:(se=t,t=r):(se=t,t=r),t===r&&(t=se,(i=Be())===r&&(i=null),i!==r?(n=Le())!==r?t=i=[i,n]:(se=t,t=r):(se=t,t=r)),t!==r&&(t=z(t)),e=t}function Te(){var t,i;return t=se,j.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(V)),i!==r&&(i=G(i)),t=i}function Ie(){var e,t,i,n,s;if(e=se,t=[],(i=Oe())!==r)for(;i!==r;)t.push(i),i=Oe();else t=r;if(t!==r)if((i=Pe())===r&&(i=null),i!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?e=t=[t,i,n]:(se=e,e=r)}else se=e,e=r;else se=e,e=r;if(e===r){if(e=se,t=se,(i=Pe())!==r){for(n=[],s=Oe();s!==r;)n.push(s),s=Oe();n!==r?t=i=[i,n]:(se=t,t=r)}else se=t,t=r;t!==r&&(t=H()),e=t}return e}function Pe(){var t;return 44===e.charCodeAt(se)?(t=W,se++):(t=r,0===ce&&fe(Q)),t}function De(){var t,i,n,s;return t=se,i=se,n=function(){var t,i,n,s,a;return t=se,i=se,n=Le(),n===r&&(n=null),n!==r?(46===e.charCodeAt(se)?(s=X,se++):(s=r,0===ce&&fe(Y)),s!==r&&(a=Le())!==r?(n=[n,s,a],i=n):(se=i,i=r)):(se=i,i=r),i===r&&(i=se,n=Le(),n!==r?(46===e.charCodeAt(se)?(s=X,se++):(s=r,0===ce&&fe(Y)),s!==r?(n=[n,s],i=n):(se=i,i=r)):(se=i,i=r)),i!==r&&(i=q(i)),t=i,t}(),n!==r?((s=Re())===r&&(s=null),s!==r?i=n=[n,s]:(se=i,i=r)):(se=i,i=r),i===r&&(i=se,(n=Le())!==r?(s=Re())!==r?i=n=[n,s]:(se=i,i=r):(se=i,i=r)),i!==r&&(i=q(i)),t=i}function Re(){var t,i,n,s,a;return t=se,i=se,K.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(J)),n!==r?((s=Be())===r&&(s=null),s!==r?(a=Le())!==r?i=n=[n,s,a]:(se=i,i=r):(se=i,i=r)):(se=i,i=r),i!==r&&(i=q(i)),t=i}function Be(){var t;return Z.test(e.charAt(se))?(t=e.charAt(se),se++):(t=r,0===ce&&fe($)),t}function Le(){var t,i,n;if(t=se,i=[],ee.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(te)),n!==r)for(;n!==r;)i.push(n),ee.test(e.charAt(se))?(n=e.charAt(se),se++):(n=r,0===ce&&fe(te));else i=r;return i!==r&&(i=ie(i)),t=i}function Oe(){var t,i;return t=se,ne.test(e.charAt(se))?(i=e.charAt(se),se++):(i=r,0===ce&&fe(re)),i!==r&&(i=H()),t=i}var Ne={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var ke in Ne)Ne[ke.toUpperCase()]=Ne[ke];function Fe(e,t){t||(t=[{}]);for(var i=t.length;i--;){var n={code:e,command:Ne[e]};for(var r in e==e.toLowerCase()&&(n.relative=!0),t[i])n[r]=t[i][r];t[i]=n}return t}if((n=a())!==r&&se===e.length)return n;throw n!==r&&se<e.length&&fe({type:"end"}),me(le,oe<e.length?e.charAt(oe):null,oe<e.length?pe(oe,oe+1):pe(oe,oe))}}})),b=d(((e,t)=>{var i=y().parse;i.parseSVG=i,i.makeAbsolute=function(e){var t,i={x:0,y:0},n={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return e.forEach((function(e){for(var r in"moveto"===e.command&&(t=e),e.x0=i.x,e.y0=i.y,n)r in e&&(e[r]+=e.relative?e[n[r]]:0);"x"in e||(e.x=i.x),"y"in e||(e.y=i.y),e.relative=!1,e.code=e.code.toUpperCase(),"closepath"==e.command&&(e.x=t.x,e.y=t.y),i=e})),e},t.exports=i})),A=d(((e,t)=>{t.exports=function(e,t){for(var i=e.split("."),n=t.split("."),r=0;r<3;r++){var s=Number(i[r]),a=Number(n[r]);if(s>a)return 1;if(a>s)return-1;if(!isNaN(s)&&isNaN(a))return 1;if(isNaN(s)&&!isNaN(a))return-1}return 0}})),x="149",w=0,S=1,_=2,E=3,C=0,M=1,T=2,I=1,P=2,D=3,R=0,B=1,L=2,O=0,N=1,k=2,F=3,U=4,z=5,j=100,V=101,G=102,H=103,W=104,Q=200,q=201,X=202,Y=203,K=204,J=205,Z=206,$=207,ee=208,te=209,ie=210,ne=0,re=1,se=2,ae=3,oe=4,le=5,ce=6,he=7,de=0,ue=1,pe=2,fe=0,me=1,ge=2,ve=3,ye=4,be=5,Ae=301,xe=302,we=303,Se=304,_e=306,Ee=1e3,Ce=1001,Me=1002,Te=1003,Ie=1004,Pe=1005,De=1006,Re=1007,Be=1008,Le=1009,Oe=1010,Ne=1011,ke=1012,Fe=1013,Ue=1014,ze=1015,je=1016,Ve=1017,Ge=1018,He=1020,We=1021,Qe=1023,qe=1024,Xe=1025,Ye=1026,Ke=1027,Je=1028,Ze=1029,$e=1030,et=1031,tt=1033,it=33776,nt=33777,rt=33778,st=33779,at=35840,ot=35841,lt=35842,ct=35843,ht=36196,dt=37492,ut=37496,pt=37808,ft=37809,mt=37810,gt=37811,vt=37812,yt=37813,bt=37814,At=37815,xt=37816,wt=37817,St=37818,_t=37819,Et=37820,Ct=37821,Mt=36492,Tt=36283,It=36284,Pt=36285,Dt=36286,Rt=2202,Bt=2300,Lt=2301,Ot=2302,Nt=2400,kt=2401,Ft=2402,Ut=2500,zt=3e3,jt=3001,Vt=3200,Gt=3201,Ht=0,Wt=1,Qt="srgb",qt="srgb-linear",Xt=7680,Yt=35044,Kt="300 es",Jt=1035,Zt=class{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let i=this._listeners[e];if(void 0!==i){let e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e);e.target=null}}},$t=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],ei=1234567,ti=Math.PI/180,ii=180/Math.PI;function ni(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return($t[255&e]+$t[e>>8&255]+$t[e>>16&255]+$t[e>>24&255]+"-"+$t[255&t]+$t[t>>8&255]+"-"+$t[t>>16&15|64]+$t[t>>24&255]+"-"+$t[63&i|128]+$t[i>>8&255]+"-"+$t[i>>16&255]+$t[i>>24&255]+$t[255&n]+$t[n>>8&255]+$t[n>>16&255]+$t[n>>24&255]).toLowerCase()}function ri(e,t,i){return Math.max(t,Math.min(i,e))}function si(e,t){return(e%t+t)%t}function ai(e,t,i){return(1-i)*e+i*t}function oi(e){return 0===(e&e-1)&&0!==e}function li(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function ci(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function hi(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function di(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var ui=Object.freeze({__proto__:null,DEG2RAD:ti,RAD2DEG:ii,ceilPowerOfTwo:li,clamp:ri,damp:function(e,t,i,n){return ai(e,t,1-Math.exp(-i*n))},degToRad:function(e){return e*ti},denormalize:hi,euclideanModulo:si,floorPowerOfTwo:ci,generateUUID:ni,inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},isPowerOfTwo:oi,lerp:ai,mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},normalize:di,pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(si(e,2*t)-t)},radToDeg:function(e){return e*ii},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},seededRandom:function(e){void 0!==e&&(ei=e);let t=ei+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},setQuaternionFromProperEuler:function(e,t,i,n,r){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+n)/2),h=a((t+n)/2),d=s((t-n)/2),u=a((t-n)/2),p=s((n-t)/2),f=a((n-t)/2);switch(r){case"XYX":e.set(o*h,l*d,l*u,o*c);break;case"YZY":e.set(l*u,o*h,l*d,o*c);break;case"ZXZ":e.set(l*d,l*u,o*h,o*c);break;case"XZX":e.set(o*h,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*h,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)}}),pi=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;pi.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*i-s*n+e.x,this.y=r*n+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},fi=class{constructor(){fi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,n,r,s,a,o,l){let c=this.elements;return c[0]=e,c[1]=n,c[2]=a,c[3]=t,c[4]=r,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],h=i[7],d=i[2],u=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],b=n[7],A=n[2],x=n[5],w=n[8];return r[0]=s*f+a*v+o*A,r[3]=s*m+a*y+o*x,r[6]=s*g+a*b+o*w,r[1]=l*f+c*v+h*A,r[4]=l*m+c*y+h*x,r[7]=l*g+c*b+h*w,r[2]=d*f+u*v+p*A,r[5]=d*m+u*y+p*x,r[8]=d*g+u*b+p*w,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-i*r*c+i*a*o+n*r*l-n*s*o}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=c*s-a*l,d=a*o-c*r,u=l*r-s*o,p=t*h+i*d+n*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=h*f,e[1]=(n*l-c*i)*f,e[2]=(a*i-n*s)*f,e[3]=d*f,e[4]=(c*t-n*o)*f,e[5]=(n*r-a*t)*f,e[6]=u*f,e[7]=(i*o-l*t)*f,e[8]=(s*t-i*r)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,s,a){let o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-n*l,n*o,-n*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(mi.makeScale(e,t)),this}rotate(e){return this.premultiply(mi.makeRotation(-e)),this}translate(e,t){return this.premultiply(mi.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}},mi=new fi;function gi(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var vi={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function yi(e,t){return new vi[e](t)}function bi(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Ai(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function xi(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var wi={[Qt]:{[qt]:Ai},[qt]:{[Qt]:xi}},Si={legacyMode:!0,get workingColorSpace(){return qt},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(wi[t]&&void 0!==wi[t][i]){let n=wi[t][i];return e.r=n(e.r),e.g=n(e.g),e.b=n(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},_i={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ei={r:0,g:0,b:0},Ci={h:0,s:0,l:0},Mi={h:0,s:0,l:0};function Ti(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function Ii(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Pi=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qt;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Si.toWorkingColorSpace(this,t),this}setRGB(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Si.workingColorSpace;return this.r=e,this.g=t,this.b=i,Si.toWorkingColorSpace(this,n),this}setHSL(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Si.workingColorSpace;if(e=si(e,1),t=ri(t,0,1),i=ri(i,0,1),0===t)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=Ti(r,n,e+1/3),this.g=Ti(r,n,e),this.b=Ti(r,n,e-1/3)}return Si.toWorkingColorSpace(this,n),this}setStyle(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qt;function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e,r=t[1],s=t[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,Si.toWorkingColorSpace(this,i),n(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,Si.toWorkingColorSpace(this,i),n(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){let t=parseFloat(e[1])/360,r=parseFloat(e[2])/100,s=parseFloat(e[3])/100;return n(e[4]),this.setHSL(t,r,s,i)}}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){let e=t[1],n=e.length;if(3===n)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,Si.toWorkingColorSpace(this,i),this;if(6===n)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,Si.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qt,i=_i[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ai(e.r),this.g=Ai(e.g),this.b=Ai(e.b),this}copyLinearToSRGB(e){return this.r=xi(e.r),this.g=xi(e.g),this.b=xi(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qt;return Si.fromWorkingColorSpace(Ii(this,Ei),e),ri(255*Ei.r,0,255)<<16^ri(255*Ei.g,0,255)<<8^ri(255*Ei.b,0,255)}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qt;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Si.workingColorSpace;Si.fromWorkingColorSpace(Ii(this,Ei),t);let i,n,r=Ei.r,s=Ei.g,a=Ei.b,o=Math.max(r,s,a),l=Math.min(r,s,a),c=(l+o)/2;if(l===o)i=0,n=0;else{let e=o-l;switch(n=c<=.5?e/(o+l):e/(2-o-l),o){case r:i=(s-a)/e+(s<a?6:0);break;case s:i=(a-r)/e+2;break;case a:i=(r-s)/e+4}i/=6}return e.h=i,e.s=n,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Si.workingColorSpace;return Si.fromWorkingColorSpace(Ii(this,Ei),t),e.r=Ei.r,e.g=Ei.g,e.b=Ei.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qt;return Si.fromWorkingColorSpace(Ii(this,Ei),e),e!==Qt?`color(${e} ${Ei.r} ${Ei.g} ${Ei.b})`:`rgb(${255*Ei.r|0},${255*Ei.g|0},${255*Ei.b|0})`}offsetHSL(e,t,i){return this.getHSL(Ci),Ci.h+=e,Ci.s+=t,Ci.l+=i,this.setHSL(Ci.h,Ci.s,Ci.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Ci),e.getHSL(Mi);let i=ai(Ci.h,Mi.h,t),n=ai(Ci.s,Mi.s,t),r=ai(Ci.l,Mi.l,t);return this.setHSL(i,n,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Pi.NAMES=_i;var Di,Ri=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Di&&(Di=bi("canvas")),Di.width=e.width,Di.height=e.height;let i=Di.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Di}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=bi("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let e=0;e<r.length;e++)r[e]=255*Ai(r[e]/255);return i.putImageData(n,0,0),t}if(e.data){let t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Ai(t[e]/255)):t[e]=Ai(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},Bi=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,this.uuid=ni(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];let i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(Li(n[t].image)):e.push(Li(n[t]))}else e=Li(n);i.url=e}return t||(e.images[this.uuid]=i),i}};function Li(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?Ri.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Oi=0,Ni=class extends Zt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ni.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ni.DEFAULT_MAPPING,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ce,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ce,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:De,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Be,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Qe,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Le,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Ni.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:zt;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Oi++}),this.uuid=ni(),this.name="",this.source=new Bi(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new pi(0,0),this.repeat=new pi(1,1),this.center=new pi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new fi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ee:e.x=e.x-Math.floor(e.x);break;case Ce:e.x=e.x<0?0:1;break;case Me:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Ee:e.y=e.y-Math.floor(e.y);break;case Ce:e.y=e.y<0?0:1;break;case Me:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}};Ni.DEFAULT_IMAGE=null,Ni.DEFAULT_MAPPING=300,Ni.DEFAULT_ANISOTROPY=1;var ki=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;ki.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*t+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*t+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*t+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r,s=e.elements,a=s[0],o=s[4],l=s[8],c=s[1],h=s[5],d=s[9],u=s[2],p=s[6],f=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-u)<.01&&Math.abs(d-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+u)<.1&&Math.abs(d+p)<.1&&Math.abs(a+h+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let e=(a+1)/2,s=(h+1)/2,m=(f+1)/2,g=(o+c)/4,v=(l+u)/4,y=(d+p)/4;return e>s&&e>m?e<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(e),n=g/i,r=v/i):s>m?s<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(s),i=g/n,r=y/n):m<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(m),i=v/r,n=y/r),this.set(i,n,r,t),this}let m=Math.sqrt((p-d)*(p-d)+(l-u)*(l-u)+(c-o)*(c-o));return Math.abs(m)<.001&&(m=1),this.x=(p-d)/m,this.y=(l-u)/m,this.z=(c-o)/m,this.w=Math.acos((a+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Fi=class extends Zt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new ki(0,0,e,t),this.scissorTest=!1,this.viewport=new ki(0,0,e,t);let n={width:e,height:t,depth:1};this.texture=new Ni(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:De,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new Bi(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},Ui=class extends Ni{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Te,this.minFilter=Te,this.wrapR=Ce,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},zi=class extends Fi{constructor(){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isWebGLMultipleRenderTargets=!0;let t=this.texture;this.texture=[];for(let i=0;i<e;i++)this.texture[i]=t.clone(),this.texture[i].isRenderTargetTexture=!0}setSize(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},ji=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,s,a){let o=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3],d=r[s+0],u=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===a)return e[t+0]=d,e[t+1]=u,e[t+2]=p,void(e[t+3]=f);if(h!==f||o!==d||l!==u||c!==p){let e=1-a,t=o*d+l*u+c*p+h*f,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){let r=Math.sqrt(n),s=Math.atan2(r,t*i);e=Math.sin(e*s)/r,a=Math.sin(a*s)/r}let r=a*i;if(o=o*e+d*r,l=l*e+u*r,c=c*e+p*r,h=h*e+f*r,e===1-a){let e=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=e,l*=e,c*=e,h*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,r,s){let a=i[n],o=i[n+1],l=i[n+2],c=i[n+3],h=r[s],d=r[s+1],u=r[s+2],p=r[s+3];return e[t]=a*p+c*h+o*u-l*d,e[t+1]=o*p+c*d+l*h-a*u,e[t+2]=l*p+c*u+a*d-o*h,e[t+3]=c*p-a*h-o*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,n=e._y,r=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(n/2),h=a(r/2),d=o(i/2),u=o(n/2),p=o(r/2);switch(s){case"XYZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"YXZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"ZXY":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"ZYX":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"YZX":this._x=d*c*h+l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h-d*u*p;break;case"XZY":this._x=d*c*h-l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],n=t[4],r=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],h=t[10],d=i+a+h;if(d>0){let e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(s-n)*e}else if(i>a&&i>h){let e=2*Math.sqrt(1+i-a-h);this._w=(c-o)/e,this._x=.25*e,this._y=(n+s)/e,this._z=(r+l)/e}else if(a>h){let e=2*Math.sqrt(1+a-i-h);this._w=(r-l)/e,this._x=(n+s)/e,this._y=.25*e,this._z=(o+c)/e}else{let e=2*Math.sqrt(1+h-i-a);this._w=(s-n)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ri(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(0===i)return this;let n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,n=e._y,r=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=i*c+s*a+n*l-r*o,this._y=n*c+s*o+r*a-i*l,this._z=r*c+s*l+i*o-n*a,this._w=s*c-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let i=this._x,n=this._y,r=this._z,s=this._w,a=s*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;let o=1-a*a;if(o<=Number.EPSILON){let e=1-t;return this._w=e*s+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=s*h+this._w*d,this._x=i*h+this._x*d,this._y=n*h+this._y*d,this._z=r*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(r),i*Math.cos(r),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Vi=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Vi.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Hi.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Hi.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=e.elements,s=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(e){let t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*n-a*i,c=o*i+a*t-r*n,h=o*n+r*i-s*t,d=-r*t-s*i-a*n;return this.x=l*o+d*-r+c*-a-h*-s,this.y=c*o+d*-s+h*-r-l*-a,this.z=h*o+d*-a+l*-s-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,n=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Gi.copy(this).projectOnVector(e),this.sub(Gi)}reflect(e){return this.sub(Gi.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(ri(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},Gi=new Vi,Hi=new ji,Wi=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vi(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vi(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let l=e[o],c=e[o+1],h=e[o+2];l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(t,i,n),this.max.set(r,s,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let l=e.getX(o),c=e.getY(o),h=e.getZ(o);l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(t,i,n),this.max.set(r,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=qi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);let i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){let t=i.attributes.position;for(let i=0,n=t.count;i<n;i++)qi.fromBufferAttribute(t,i).applyMatrix4(e.matrixWorld),this.expandByPoint(qi)}else null===i.boundingBox&&i.computeBoundingBox(),Xi.copy(i.boundingBox),Xi.applyMatrix4(e.matrixWorld),this.union(Xi);let n=e.children;for(let r=0,s=n.length;r<s;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,qi),qi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(tn),nn.subVectors(this.max,tn),Yi.subVectors(e.a,tn),Ki.subVectors(e.b,tn),Ji.subVectors(e.c,tn),Zi.subVectors(Ki,Yi),$i.subVectors(Ji,Ki),en.subVectors(Yi,Ji);let t=[0,-Zi.z,Zi.y,0,-$i.z,$i.y,0,-en.z,en.y,Zi.z,0,-Zi.x,$i.z,0,-$i.x,en.z,0,-en.x,-Zi.y,Zi.x,0,-$i.y,$i.x,0,-en.y,en.x,0];return!(!an(t,Yi,Ki,Ji,nn)||(t=[1,0,0,0,1,0,0,0,1],!an(t,Yi,Ki,Ji,nn)))&&(rn.crossVectors(Zi,$i),t=[rn.x,rn.y,rn.z],an(t,Yi,Ki,Ji,nn))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return qi.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(qi).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Qi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Qi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Qi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Qi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Qi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Qi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Qi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Qi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Qi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Qi=[new Vi,new Vi,new Vi,new Vi,new Vi,new Vi,new Vi,new Vi],qi=new Vi,Xi=new Wi,Yi=new Vi,Ki=new Vi,Ji=new Vi,Zi=new Vi,$i=new Vi,en=new Vi,tn=new Vi,nn=new Vi,rn=new Vi,sn=new Vi;function an(e,t,i,n,r){for(let s=0,a=e.length-3;s<=a;s+=3){sn.fromArray(e,s);let a=r.x*Math.abs(sn.x)+r.y*Math.abs(sn.y)+r.z*Math.abs(sn.z),o=t.dot(sn),l=i.dot(sn),c=n.dot(sn);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}var on=new Wi,ln=new Vi,cn=new Vi,hn=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;void 0!==t?i.copy(t):on.setFromPoints(e).getCenter(i);let n=0;for(let r=0,s=e.length;r<s;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ln.subVectors(e,this.center);let t=ln.lengthSq();if(t>this.radius*this.radius){let e=Math.sqrt(t),i=.5*(e-this.radius);this.center.addScaledVector(ln,i/e),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(cn.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ln.copy(e.center).add(cn)),this.expandByPoint(ln.copy(e.center).sub(cn))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}},dn=new Vi,un=new Vi,pn=new Vi,fn=new Vi,mn=new Vi,gn=new Vi,vn=new Vi,yn=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vi(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,dn)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=dn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(dn.copy(this.direction).multiplyScalar(t).add(this.origin),dn.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){un.copy(e).add(t).multiplyScalar(.5),pn.copy(t).sub(e).normalize(),fn.copy(this.origin).sub(un);let r,s,a,o,l=.5*e.distanceTo(t),c=-this.direction.dot(pn),h=fn.dot(this.direction),d=-fn.dot(pn),u=fn.lengthSq(),p=Math.abs(1-c*c);if(p>0)if(r=c*d-h,s=c*h-d,o=l*p,r>=0)if(s>=-o)if(s<=o){let e=1/p;r*=e,s*=e,a=r*(r+c*s+2*h)+s*(c*r+s+2*d)+u}else s=l,r=Math.max(0,-(c*s+h)),a=-r*r+s*(s+2*d)+u;else s=-l,r=Math.max(0,-(c*s+h)),a=-r*r+s*(s+2*d)+u;else s<=-o?(r=Math.max(0,-(-c*l+h)),s=r>0?-l:Math.min(Math.max(-l,-d),l),a=-r*r+s*(s+2*d)+u):s<=o?(r=0,s=Math.min(Math.max(-l,-d),l),a=s*(s+2*d)+u):(r=Math.max(0,-(c*l+h)),s=r>0?l:Math.min(Math.max(-l,-d),l),a=-r*r+s*(s+2*d)+u);else s=c>0?-l:l,r=Math.max(0,-(c*s+h)),a=-r*r+s*(s+2*d)+u;return i&&i.copy(this.direction).multiplyScalar(r).add(this.origin),n&&n.copy(pn).multiplyScalar(s).add(un),a}intersectSphere(e,t){dn.subVectors(e.center,this.origin);let i=dn.dot(this.direction),n=dn.dot(dn)-i*i,r=e.radius*e.radius;if(n>r)return null;let s=Math.sqrt(r-n),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,s,a,o,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(i=(e.min.x-d.x)*l,n=(e.max.x-d.x)*l):(i=(e.max.x-d.x)*l,n=(e.min.x-d.x)*l),c>=0?(r=(e.min.y-d.y)*c,s=(e.max.y-d.y)*c):(r=(e.max.y-d.y)*c,s=(e.min.y-d.y)*c),i>s||r>n||((r>i||isNaN(i))&&(i=r),(s<n||isNaN(n))&&(n=s),h>=0?(a=(e.min.z-d.z)*h,o=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,o=(e.min.z-d.z)*h),i>o||a>n)||((a>i||i!==i)&&(i=a),(o<n||n!==n)&&(n=o),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return null!==this.intersectBox(e,dn)}intersectTriangle(e,t,i,n,r){mn.subVectors(t,e),gn.subVectors(i,e),vn.crossVectors(mn,gn);let s,a=this.direction.dot(vn);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}fn.subVectors(this.origin,e);let o=s*this.direction.dot(gn.crossVectors(fn,gn));if(o<0)return null;let l=s*this.direction.dot(mn.cross(fn));if(l<0||o+l>a)return null;let c=-s*fn.dot(vn);return c<0?null:this.at(c/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},bn=class{constructor(){bn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,n,r,s,a,o,l,c,h,d,u,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=d,g[3]=u,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new bn).fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,n=1/An.setFromMatrixColumn(e,0).length(),r=1/An.setFromMatrixColumn(e,1).length(),s=1/An.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,n=e.y,r=e.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){let e=s*c,i=s*h,n=a*c,r=a*h;t[0]=o*c,t[4]=-o*h,t[8]=l,t[1]=i+n*l,t[5]=e-r*l,t[9]=-a*o,t[2]=r-e*l,t[6]=n+i*l,t[10]=s*o}else if("YXZ"===e.order){let e=o*c,i=o*h,n=l*c,r=l*h;t[0]=e+r*a,t[4]=n*a-i,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-a,t[2]=i*a-n,t[6]=r+e*a,t[10]=s*o}else if("ZXY"===e.order){let e=o*c,i=o*h,n=l*c,r=l*h;t[0]=e-r*a,t[4]=-s*h,t[8]=n+i*a,t[1]=i+n*a,t[5]=s*c,t[9]=r-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){let e=s*c,i=s*h,n=a*c,r=a*h;t[0]=o*c,t[4]=n*l-i,t[8]=e*l+r,t[1]=o*h,t[5]=r*l+e,t[9]=i*l-n,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){let e=s*o,i=s*l,n=a*o,r=a*l;t[0]=o*c,t[4]=r-e*h,t[8]=n*h+i,t[1]=h,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=i*h+n,t[10]=e-r*h}else if("XZY"===e.order){let e=s*o,i=s*l,n=a*o,r=a*l;t[0]=o*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=s*c,t[9]=i*h-n,t[2]=n*h-i,t[6]=a*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(wn,e,Sn)}lookAt(e,t,i){let n=this.elements;return Cn.subVectors(e,t),0===Cn.lengthSq()&&(Cn.z=1),Cn.normalize(),_n.crossVectors(i,Cn),0===_n.lengthSq()&&(1===Math.abs(i.z)?Cn.x+=1e-4:Cn.z+=1e-4,Cn.normalize(),_n.crossVectors(i,Cn)),_n.normalize(),En.crossVectors(Cn,_n),n[0]=_n.x,n[4]=En.x,n[8]=Cn.x,n[1]=_n.y,n[5]=En.y,n[9]=Cn.y,n[2]=_n.z,n[6]=En.z,n[10]=Cn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],h=i[5],d=i[9],u=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],A=i[15],x=n[0],w=n[4],S=n[8],_=n[12],E=n[1],C=n[5],M=n[9],T=n[13],I=n[2],P=n[6],D=n[10],R=n[14],B=n[3],L=n[7],O=n[11],N=n[15];return r[0]=s*x+a*E+o*I+l*B,r[4]=s*w+a*C+o*P+l*L,r[8]=s*S+a*M+o*D+l*O,r[12]=s*_+a*T+o*R+l*N,r[1]=c*x+h*E+d*I+u*B,r[5]=c*w+h*C+d*P+u*L,r[9]=c*S+h*M+d*D+u*O,r[13]=c*_+h*T+d*R+u*N,r[2]=p*x+f*E+m*I+g*B,r[6]=p*w+f*C+m*P+g*L,r[10]=p*S+f*M+m*D+g*O,r[14]=p*_+f*T+m*R+g*N,r[3]=v*x+y*E+b*I+A*B,r[7]=v*w+y*C+b*P+A*L,r[11]=v*S+y*M+b*D+A*O,r[15]=v*_+y*T+b*R+A*N,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],h=e[6],d=e[10],u=e[14];return e[3]*(+r*o*h-n*l*h-r*a*d+i*l*d+n*a*u-i*o*u)+e[7]*(+t*o*u-t*l*d+r*s*d-n*s*u+n*l*c-r*o*c)+e[11]*(+t*l*h-t*a*u-r*s*h+i*s*u+r*a*c-i*l*c)+e[15]*(-n*a*c-t*o*h+t*a*d+n*s*h-i*s*d+i*o*c)}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(e,t,i){let n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=e[9],d=e[10],u=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=h*m*l-f*d*l+f*o*u-a*m*u-h*o*g+a*d*g,y=p*d*l-c*m*l-p*o*u+s*m*u+c*o*g-s*d*g,b=c*f*l-p*h*l+p*a*u-s*f*u-c*a*g+s*h*g,A=p*h*o-c*f*o-p*a*d+s*f*d+c*a*m-s*h*m,x=t*v+i*y+n*b+r*A;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/x;return e[0]=v*w,e[1]=(f*d*r-h*m*r-f*n*u+i*m*u+h*n*g-i*d*g)*w,e[2]=(a*m*r-f*o*r+f*n*l-i*m*l-a*n*g+i*o*g)*w,e[3]=(h*o*r-a*d*r-h*n*l+i*d*l+a*n*u-i*o*u)*w,e[4]=y*w,e[5]=(c*m*r-p*d*r+p*n*u-t*m*u-c*n*g+t*d*g)*w,e[6]=(p*o*r-s*m*r-p*n*l+t*m*l+s*n*g-t*o*g)*w,e[7]=(s*d*r-c*o*r+c*n*l-t*d*l-s*n*u+t*o*u)*w,e[8]=b*w,e[9]=(p*h*r-c*f*r-p*i*u+t*f*u+c*i*g-t*h*g)*w,e[10]=(s*f*r-p*a*r+p*i*l-t*f*l-s*i*g+t*a*g)*w,e[11]=(c*a*r-s*h*r-c*i*l+t*h*l+s*i*u-t*a*u)*w,e[12]=A*w,e[13]=(c*f*n-p*h*n+p*i*d-t*f*d-c*i*m+t*h*m)*w,e[14]=(p*a*n-s*f*n-p*i*o+t*f*o+s*i*m-t*a*m)*w,e[15]=(s*h*n-c*a*n+c*i*o-t*h*o-s*i*d+t*a*d)*w,this}scale(e){let t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),n=Math.sin(t),r=1-i,s=e.x,a=e.y,o=e.z,l=r*s,c=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,c*a+i,c*o-n*s,0,l*o-n*a,c*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,s){return this.set(1,i,r,0,e,1,s,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){let n=this.elements,r=t._x,s=t._y,a=t._z,o=t._w,l=r+r,c=s+s,h=a+a,d=r*l,u=r*c,p=r*h,f=s*c,m=s*h,g=a*h,v=o*l,y=o*c,b=o*h,A=i.x,x=i.y,w=i.z;return n[0]=(1-(f+g))*A,n[1]=(u+b)*A,n[2]=(p-y)*A,n[3]=0,n[4]=(u-b)*x,n[5]=(1-(d+g))*x,n[6]=(m+v)*x,n[7]=0,n[8]=(p+y)*w,n[9]=(m-v)*w,n[10]=(1-(d+f))*w,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){let n=this.elements,r=An.set(n[0],n[1],n[2]).length(),s=An.set(n[4],n[5],n[6]).length(),a=An.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],xn.copy(this);let o=1/r,l=1/s,c=1/a;return xn.elements[0]*=o,xn.elements[1]*=o,xn.elements[2]*=o,xn.elements[4]*=l,xn.elements[5]*=l,xn.elements[6]*=l,xn.elements[8]*=c,xn.elements[9]*=c,xn.elements[10]*=c,t.setFromRotationMatrix(xn),i.x=r,i.y=s,i.z=a,this}makePerspective(e,t,i,n,r,s){let a=this.elements,o=2*r/(t-e),l=2*r/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),d=-(s+r)/(s-r),u=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=u,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,n,r,s){let a=this.elements,o=1/(t-e),l=1/(i-n),c=1/(s-r),h=(t+e)*o,d=(i+n)*l,u=(s+r)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-u,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},An=new Vi,xn=new bn,wn=new Vi(0,0,0),Sn=new Vi(1,1,1),_n=new Vi,En=new Vi,Cn=new Vi,Mn=new bn,Tn=new ji,In=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:In.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.elements,r=n[0],s=n[4],a=n[8],o=n[1],l=n[5],c=n[9],h=n[2],d=n[6],u=n[10];switch(t){case"XYZ":this._y=Math.asin(ri(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,u),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ri(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,u),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(ri(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,u),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-ri(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,u),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ri(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,u));break;case"XZY":this._z=Math.asin(-ri(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Mn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Mn,t,i)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return Tn.setFromEuler(this),this.setFromQuaternion(Tn,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};In.DEFAULT_ORDER="XYZ";var Pn=class{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}},Dn=0,Rn=new Vi,Bn=new ji,Ln=new bn,On=new Vi,Nn=new Vi,kn=new Vi,Fn=new ji,Un=new Vi(1,0,0),zn=new Vi(0,1,0),jn=new Vi(0,0,1),Vn={type:"added"},Gn={type:"removed"},Hn=class extends Zt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Dn++}),this.uuid=ni(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Hn.DEFAULT_UP.clone();let e=new Vi,t=new In,i=new ji,n=new Vi(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new bn},normalMatrix:{value:new fi}}),this.matrix=new bn,this.matrixWorld=new bn,this.matrixAutoUpdate=Hn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Hn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Pn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Bn.setFromAxisAngle(e,t),this.quaternion.multiply(Bn),this}rotateOnWorldAxis(e,t){return Bn.setFromAxisAngle(e,t),this.quaternion.premultiply(Bn),this}rotateX(e){return this.rotateOnAxis(Un,e)}rotateY(e){return this.rotateOnAxis(zn,e)}rotateZ(e){return this.rotateOnAxis(jn,e)}translateOnAxis(e,t){return Rn.copy(e).applyQuaternion(this.quaternion),this.position.add(Rn.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Un,e)}translateY(e){return this.translateOnAxis(zn,e)}translateZ(e){return this.translateOnAxis(jn,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ln.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?On.copy(e):On.set(e,t,i);let n=this.parent;this.updateWorldMatrix(!0,!1),Nn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ln.lookAt(Nn,On,this.up):Ln.lookAt(On,Nn,this.up),this.quaternion.setFromRotationMatrix(Ln),n&&(Ln.extractRotation(n.matrixWorld),Bn.setFromRotationMatrix(Ln),this.quaternion.premultiply(Bn.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Vn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Gn)),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(Gn)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ln.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Ln.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ln),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){let n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let n=0,r=this.children.length;n<r;n++){let r=this.children[n].getObjectsByProperty(e,t);r.length>0&&(i=i.concat(r))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Nn,e,kn),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Nn,Fn,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,n=t.length;i<n;i++){let n=t[i];(!0===n.matrixWorldAutoUpdate||!0===e)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(!0===e&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){let e=this.children;for(let t=0,i=e.length;t<i;t++){let i=e[t];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);let t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){let i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){let n=i[t];r(e.shapes,n)}else r(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(r(e.materials,this.material[i]));n.material=t}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){let i=this.animations[t];n.animations.push(r(e.animations,i))}}if(t){let t=s(e.geometries),n=s(e.materials),r=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),c=s(e.animations),h=s(e.nodes);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=n,i;function s(e){let t=[];for(let i in e){let n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let i=0;i<e.children.length;i++){let t=e.children[i];this.add(t.clone())}return this}};Hn.DEFAULT_UP=new Vi(0,1,0),Hn.DEFAULT_MATRIX_AUTO_UPDATE=!0,Hn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Wn=new Vi,Qn=new Vi,qn=new Vi,Xn=new Vi,Yn=new Vi,Kn=new Vi,Jn=new Vi,Zn=new Vi,$n=new Vi,er=new Vi,tr=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vi,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Vi;this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),Wn.subVectors(e,t),n.cross(Wn);let r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){Wn.subVectors(n,t),Qn.subVectors(i,t),qn.subVectors(e,t);let s=Wn.dot(Wn),a=Wn.dot(Qn),o=Wn.dot(qn),l=Qn.dot(Qn),c=Qn.dot(qn),h=s*l-a*a;if(0===h)return r.set(-2,-1,-1);let d=1/h,u=(l*o-a*c)*d,p=(s*c-a*o)*d;return r.set(1-u-p,p,u)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,Xn),Xn.x>=0&&Xn.y>=0&&Xn.x+Xn.y<=1}static getUV(e,t,i,n,r,s,a,o){return this.getBarycoord(e,t,i,n,Xn),o.set(0,0),o.addScaledVector(r,Xn.x),o.addScaledVector(s,Xn.y),o.addScaledVector(a,Xn.z),o}static isFrontFacing(e,t,i,n){return Wn.subVectors(i,t),Qn.subVectors(e,t),Wn.cross(Qn).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Wn.subVectors(this.c,this.b),Qn.subVectors(this.a,this.b),.5*Wn.cross(Qn).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return tr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return tr.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return tr.getUV(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return tr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return tr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i,n,r=this.a,s=this.b,a=this.c;Yn.subVectors(s,r),Kn.subVectors(a,r),Zn.subVectors(e,r);let o=Yn.dot(Zn),l=Kn.dot(Zn);if(o<=0&&l<=0)return t.copy(r);$n.subVectors(e,s);let c=Yn.dot($n),h=Kn.dot($n);if(c>=0&&h<=c)return t.copy(s);let d=o*h-c*l;if(d<=0&&o>=0&&c<=0)return i=o/(o-c),t.copy(r).addScaledVector(Yn,i);er.subVectors(e,a);let u=Yn.dot(er),p=Kn.dot(er);if(p>=0&&u<=p)return t.copy(a);let f=u*l-o*p;if(f<=0&&l>=0&&p<=0)return n=l/(l-p),t.copy(r).addScaledVector(Kn,n);let m=c*p-u*h;if(m<=0&&h-c>=0&&u-p>=0)return Jn.subVectors(a,s),n=(h-c)/(h-c+(u-p)),t.copy(s).addScaledVector(Jn,n);let g=1/(m+f+d);return i=f*g,n=d*g,t.copy(r).addScaledVector(Yn,i).addScaledVector(Kn,n)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},ir=0,nr=class extends Zt{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ir++}),this.uuid=ni(),this.name="",this.type="Material",this.blending=N,this.side=R,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=K,this.blendDst=J,this.blendEquation=j,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ae,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Xt,this.stencilZFail=Xt,this.stencilZPass=Xt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){let t=[];for(let i in e){let n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==N&&(i.blending=this.blending),this.side!==R&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){let t=n(e.textures),r=n(e.images);t.length>0&&(i.textures=t),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(null!==t){let e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}},rr=class extends nr{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Pi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=de,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},sr=new Vi,ar=new pi,or=class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=Yt,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)ar.fromBufferAttribute(this,t),ar.applyMatrix3(e),this.setXY(t,ar.x,ar.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)sr.fromBufferAttribute(this,t),sr.applyMatrix3(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)sr.fromBufferAttribute(this,t),sr.applyMatrix4(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)sr.fromBufferAttribute(this,t),sr.applyNormalMatrix(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)sr.fromBufferAttribute(this,t),sr.transformDirection(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=hi(t,this.array)),t}setX(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=hi(t,this.array)),t}setY(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=hi(t,this.array)),t}setZ(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=hi(t,this.array)),t}setW(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),i=di(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),i=di(i,this.array),n=di(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),i=di(i,this.array),n=di(n,this.array),r=di(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Yt&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},lr=class extends or{constructor(e,t,i){super(new Uint16Array(e),t,i)}},cr=class extends or{constructor(e,t,i){super(new Uint32Array(e),t,i)}},hr=class extends or{constructor(e,t,i){super(new Float32Array(e),t,i)}},dr=0,ur=new bn,pr=new Hn,fr=new Vi,mr=new Wi,gr=new Wi,vr=new Vi,yr=class extends Zt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:dr++}),this.uuid=ni(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(gi(e)?cr:lr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(void 0!==i){let t=(new fi).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}let n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return ur.makeRotationFromQuaternion(e),this.applyMatrix4(ur),this}rotateX(e){return ur.makeRotationX(e),this.applyMatrix4(ur),this}rotateY(e){return ur.makeRotationY(e),this.applyMatrix4(ur),this}rotateZ(e){return ur.makeRotationZ(e),this.applyMatrix4(ur),this}translate(e,t,i){return ur.makeTranslation(e,t,i),this.applyMatrix4(ur),this}scale(e,t,i){return ur.makeScale(e,t,i),this.applyMatrix4(ur),this}lookAt(e){return pr.lookAt(e),pr.updateMatrix(),this.applyMatrix4(pr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(fr).negate(),this.translate(fr.x,fr.y,fr.z),this}setFromPoints(e){let t=[];for(let i=0,n=e.length;i<n;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new hr(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Wi);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vi(-1/0,-1/0,-1/0),new Vi(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){let e=t[i];mr.setFromBufferAttribute(e),this.morphTargetsRelative?(vr.addVectors(this.boundingBox.min,mr.min),this.boundingBox.expandByPoint(vr),vr.addVectors(this.boundingBox.max,mr.max),this.boundingBox.expandByPoint(vr)):(this.boundingBox.expandByPoint(mr.min),this.boundingBox.expandByPoint(mr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new hn);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vi,1/0);if(e){let i=this.boundingSphere.center;if(mr.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){let i=t[e];gr.setFromBufferAttribute(i),this.morphTargetsRelative?(vr.addVectors(mr.min,gr.min),mr.expandByPoint(vr),vr.addVectors(mr.max,gr.max),mr.expandByPoint(vr)):(mr.expandByPoint(gr.min),mr.expandByPoint(gr.max))}mr.getCenter(i);let n=0;for(let t=0,r=e.count;t<r;t++)vr.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(vr));if(t)for(let r=0,s=t.length;r<s;r++){let s=t[r],a=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)vr.fromBufferAttribute(s,t),a&&(fr.fromBufferAttribute(e,t),vr.add(fr)),n=Math.max(n,i.distanceToSquared(vr))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let i=e.array,n=t.position.array,r=t.normal.array,s=t.uv.array,a=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new or(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let E=0;E<a;E++)l[E]=new Vi,c[E]=new Vi;let h=new Vi,d=new Vi,u=new Vi,p=new pi,f=new pi,m=new pi,g=new Vi,v=new Vi;function y(e,t,i){h.fromArray(n,3*e),d.fromArray(n,3*t),u.fromArray(n,3*i),p.fromArray(s,2*e),f.fromArray(s,2*t),m.fromArray(s,2*i),d.sub(h),u.sub(h),f.sub(p),m.sub(p);let r=1/(f.x*m.y-m.x*f.y);!isFinite(r)||(g.copy(d).multiplyScalar(m.y).addScaledVector(u,-f.y).multiplyScalar(r),v.copy(u).multiplyScalar(f.x).addScaledVector(d,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[i].add(g),c[e].add(v),c[t].add(v),c[i].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:i.length}]);for(let E=0,C=b.length;E<C;++E){let e=b[E],t=e.start;for(let n=t,r=t+e.count;n<r;n+=3)y(i[n+0],i[n+1],i[n+2])}let A=new Vi,x=new Vi,w=new Vi,S=new Vi;function _(e){w.fromArray(r,3*e),S.copy(w);let t=l[e];A.copy(t),A.sub(w.multiplyScalar(w.dot(t))).normalize(),x.crossVectors(S,t);let i=x.dot(c[e])<0?-1:1;o[4*e]=A.x,o[4*e+1]=A.y,o[4*e+2]=A.z,o[4*e+3]=i}for(let E=0,C=b.length;E<C;++E){let e=b[E],t=e.start;for(let n=t,r=t+e.count;n<r;n+=3)_(i[n+0]),_(i[n+1]),_(i[n+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new or(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);let n=new Vi,r=new Vi,s=new Vi,a=new Vi,o=new Vi,l=new Vi,c=new Vi,h=new Vi;if(e)for(let d=0,u=e.count;d<u;d+=3){let u=e.getX(d+0),p=e.getX(d+1),f=e.getX(d+2);n.fromBufferAttribute(t,u),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),a.fromBufferAttribute(i,u),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),a.add(c),o.add(c),l.add(c),i.setXYZ(u,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,d=t.count;e<d;e+=3)n.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)vr.fromBufferAttribute(e,t),vr.normalize(),e.setXYZ(t,vr.x,vr.y,vr.z)}toNonIndexed(){function e(e,t){let i=e.array,n=e.itemSize,r=e.normalized,s=new i.constructor(t.length*n),a=0,o=0;for(let l=0,c=t.length;l<c;l++){a=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*n;for(let e=0;e<n;e++)s[o++]=i[a++]}return new or(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new yr,i=this.index.array,n=this.attributes;for(let a in n){let r=e(n[a],i);t.setAttribute(a,r)}let r=this.morphAttributes;for(let a in r){let n=[],s=r[a];for(let t=0,r=s.length;t<r;t++){let r=e(s[t],i);n.push(r)}t.morphAttributes[a]=n}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let e=s[a];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let t=this.parameters;for(let i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let t=i[o];e.data.attributes[o]=t.toJSON(e.data)}let n={},r=!1;for(let o in this.morphAttributes){let t=this.morphAttributes[o],i=[];for(let n=0,r=t.length;n<r;n++){let r=t[n];i.push(r.toJSON(e.data))}i.length>0&&(n[o]=i,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;null!==i&&this.setIndex(i.clone(t));let n=e.attributes;for(let l in n){let e=n[l];this.setAttribute(l,e.clone(t))}let r=e.morphAttributes;for(let l in r){let e=[],i=r[l];for(let n=0,r=i.length;n<r;n++)e.push(i[n].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,c=s.length;l<c;l++){let e=s[l];this.addGroup(e.start,e.count,e.materialIndex)}let a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());let o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},br=new bn,Ar=new yn,xr=new hn,wr=new Vi,Sr=new Vi,_r=new Vi,Er=new Vi,Cr=new Vi,Mr=new pi,Tr=new pi,Ir=new pi,Pr=new Vi,Dr=new Vi,Rr=class extends Hn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rr;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){let t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){let i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(n,e);let a=this.morphTargetInfluences;if(r&&a){Cr.set(0,0,0);for(let i=0,n=r.length;i<n;i++){let n=a[i],o=r[i];0!==n&&(Er.fromBufferAttribute(o,e),s?Cr.addScaledVector(Er,n):Cr.addScaledVector(Er.sub(t),n))}t.add(Cr)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n||(null===i.boundingSphere&&i.computeBoundingSphere(),xr.copy(i.boundingSphere),xr.applyMatrix4(r),!1===e.ray.intersectsSphere(xr))||(br.copy(r).invert(),Ar.copy(e.ray).applyMatrix4(br),null!==i.boundingBox&&!1===Ar.intersectsBox(i.boundingBox)))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,h=i.groups,d=i.drawRange;if(null!==a)if(Array.isArray(n))for(let u=0,p=h.length;u<p;u++){let i=h[u],r=n[i.materialIndex];for(let n=Math.max(i.start,d.start),o=Math.min(a.count,Math.min(i.start+i.count,d.start+d.count));n<o;n+=3){let o=a.getX(n),h=a.getX(n+1),d=a.getX(n+2);s=Br(this,r,e,Ar,l,c,o,h,d),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=i.materialIndex,t.push(s))}}else{for(let i=Math.max(0,d.start),r=Math.min(a.count,d.start+d.count);i<r;i+=3){let r=a.getX(i),o=a.getX(i+1),h=a.getX(i+2);s=Br(this,n,e,Ar,l,c,r,o,h),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}}else if(void 0!==o)if(Array.isArray(n))for(let u=0,p=h.length;u<p;u++){let i=h[u],r=n[i.materialIndex];for(let n=Math.max(i.start,d.start),a=Math.min(o.count,Math.min(i.start+i.count,d.start+d.count));n<a;n+=3){s=Br(this,r,e,Ar,l,c,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=i.materialIndex,t.push(s))}}else{for(let i=Math.max(0,d.start),r=Math.min(o.count,d.start+d.count);i<r;i+=3){s=Br(this,n,e,Ar,l,c,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}}}};function Br(e,t,i,n,r,s,a,o,l){e.getVertexPosition(a,wr),e.getVertexPosition(o,Sr),e.getVertexPosition(l,_r);let c=function(e,t,i,n,r,s,a,o){let l;if(l=t.side===B?n.intersectTriangle(a,s,r,!0,o):n.intersectTriangle(r,s,a,t.side===R,o),null===l)return null;Dr.copy(o),Dr.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(Dr);return c<i.near||c>i.far?null:{distance:c,point:Dr.clone(),object:e}}(e,t,i,n,wr,Sr,_r,Pr);if(c){r&&(Mr.fromBufferAttribute(r,a),Tr.fromBufferAttribute(r,o),Ir.fromBufferAttribute(r,l),c.uv=tr.getUV(Pr,wr,Sr,_r,Mr,Tr,Ir,new pi)),s&&(Mr.fromBufferAttribute(s,a),Tr.fromBufferAttribute(s,o),Ir.fromBufferAttribute(s,l),c.uv2=tr.getUV(Pr,wr,Sr,_r,Mr,Tr,Ir,new pi));let e={a:a,b:o,c:l,normal:new Vi,materialIndex:0};tr.getNormal(wr,Sr,_r,e.normal),c.face=e}return c}var Lr=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};let a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);let o=[],l=[],c=[],h=[],d=0,u=0;function p(e,t,i,n,r,s,p,f,m,g,v){let y=s/m,b=p/g,A=s/2,x=p/2,w=f/2,S=m+1,_=g+1,E=0,C=0,M=new Vi;for(let a=0;a<_;a++){let s=a*b-x;for(let o=0;o<S;o++){let d=o*y-A;M[e]=d*n,M[t]=s*r,M[i]=w,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[i]=f>0?1:-1,c.push(M.x,M.y,M.z),h.push(o/m),h.push(1-a/g),E+=1}}for(let a=0;a<g;a++)for(let e=0;e<m;e++){let t=d+e+S*a,i=d+e+S*(a+1),n=d+(e+1)+S*(a+1),r=d+(e+1)+S*a;o.push(t,i,r),o.push(i,n,r),C+=6}a.addGroup(u,C,v),u+=C,d+=E}p("z","y","x",-1,-1,i,t,e,s,r,0),p("z","y","x",1,-1,i,t,-e,s,r,1),p("x","z","y",1,1,e,i,t,n,s,2),p("x","z","y",1,-1,e,i,-t,n,s,3),p("x","y","z",1,-1,e,t,i,n,r,4),p("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new hr(l,3)),this.setAttribute("normal",new hr(c,3)),this.setAttribute("uv",new hr(h,2))}static fromJSON(e){return new Lr(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Or(e){let t={};for(let i in e){t[i]={};for(let n in e[i]){let r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function Nr(e){let t={};for(let i=0;i<e.length;i++){let n=Or(e[i]);for(let e in n)t[e]=n[e]}return t}function kr(e){return null===e.getRenderTarget()&&e.outputEncoding===jt?Qt:qt}var Fr={clone:Or,merge:Nr},Ur=class extends nr{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Or(e.uniforms),this.uniformsGroups=function(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let n in this.uniforms){let i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let n in this.extensions)!0===this.extensions[n]&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},zr=class extends Hn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new bn,this.projectionMatrix=new bn,this.projectionMatrixInverse=new bn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}},jr=class extends zr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*ii*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*ti*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*ii*Math.atan(Math.tan(.5*ti*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*ti*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,s=this.view;if(null!==this.view&&this.view.enabled){let e=s.fullWidth,a=s.fullHeight;r+=s.offsetX*n/e,t-=s.offsetY*i/a,n*=s.width/e,i*=s.height/a}let a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Vr=-90,Gr=class extends Hn{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let n=new jr(Vr,1,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(1,0,0),this.add(n);let r=new jr(Vr,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);let s=new jr(Vr,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new jr(Vr,1,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new jr(Vr,1,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new jr(Vr,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();let i=this.renderTarget,[n,r,s,a,o,l]=this.children,c=e.getRenderTarget(),h=e.toneMapping,d=e.xr.enabled;e.toneMapping=fe,e.xr.enabled=!1;let u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=u,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=h,e.xr.enabled=d,i.texture.needsPMREMUpdate=!0}},Hr=class extends Ni{constructor(e,t,i,n,r,s,a,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:Ae,i,n,r,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Wr=class extends Fi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},n=[i,i,i,i,i,i];this.texture=new Hr(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:De}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Lr(5,5,5),r=new Ur({name:"CubemapFromEquirect",uniforms:Or(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:B,blending:O});r.uniforms.tEquirect.value=t;let s=new Rr(n,r),a=t.minFilter;return t.minFilter===Be&&(t.minFilter=De),new Gr(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,n){let r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,n);e.setRenderTarget(r)}},Qr=new Vi,qr=new Vi,Xr=new fi,Yr=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vi(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let n=Qr.subVectors(i,t).cross(qr.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(Qr),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||Xr.getNormalMatrix(e),n=this.coplanarPoint(Qr).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}},Kr=new hn,Jr=new Vi,Zr=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yr,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yr,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Yr,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Yr,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Yr,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Yr;this.planes=[e,t,i,n,r,s]}set(e,t,i,n,r,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],h=i[7],d=i[8],u=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(a-n,h-o,f-d,y-m).normalize(),t[1].setComponents(a+n,h+o,f+d,y+m).normalize(),t[2].setComponents(a+r,h+l,f+u,y+g).normalize(),t[3].setComponents(a-r,h-l,f-u,y-g).normalize(),t[4].setComponents(a-s,h-c,f-p,y-v).normalize(),t[5].setComponents(a+s,h+c,f+p,y+v).normalize(),this}intersectsObject(e){let t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Kr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Kr)}intersectsSprite(e){return Kr.center.set(0,0,0),Kr.radius=.7071067811865476,Kr.applyMatrix4(e.matrixWorld),this.intersectsSphere(Kr)}intersectsSphere(e){let t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let n=t[i];if(Jr.x=n.normal.x>0?e.max.x:e.min.x,Jr.y=n.normal.y>0?e.max.y:e.min.y,Jr.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Jr)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}};function $r(){let e=null,t=!1,i=null,n=null;function r(t,s){i(t,s),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function es(e,t){let i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);let i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){let e=n.get(t);return void((!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);let s=n.get(t);void 0===s?n.set(t,function(t,n){let r,s=t.array,a=t.usage,o=e.createBuffer();if(e.bindBuffer(n,o),e.bufferData(n,s,a),t.onUploadCallback(),s instanceof Float32Array)r=5126;else if(s instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");r=5131}else r=5123;else if(s instanceof Int16Array)r=5122;else if(s instanceof Uint32Array)r=5125;else if(s instanceof Int32Array)r=5124;else if(s instanceof Int8Array)r=5120;else if(s instanceof Uint8Array)r=5121;else{if(!(s instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+s);r=5121}return{buffer:o,type:r,bytesPerElement:s.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(function(t,n,r){let s=n.array,a=n.updateRange;e.bindBuffer(r,t),-1===a.count?e.bufferSubData(r,0,s):(i?e.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):e.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1),n.onUploadCallback()}(s.buffer,t,r),s.version=t.version)}}}var ts=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};let r=e/2,s=t/2,a=Math.floor(i),o=Math.floor(n),l=a+1,c=o+1,h=e/a,d=t/o,u=[],p=[],f=[],m=[];for(let g=0;g<c;g++){let e=g*d-s;for(let t=0;t<l;t++){let i=t*h-r;p.push(i,-e,0),f.push(0,0,1),m.push(t/a),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let e=0;e<a;e++){let t=e+l*g,i=e+l*(g+1),n=e+1+l*(g+1),r=e+1+l*g;u.push(t,i,r),u.push(i,n,r)}this.setIndex(u),this.setAttribute("position",new hr(p,3)),this.setAttribute("normal",new hr(f,3)),this.setAttribute("uv",new hr(m,2))}static fromJSON(e){return new ts(e.width,e.height,e.widthSegments,e.heightSegments)}},is={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},ns={common:{diffuse:{value:new Pi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new fi},uv2Transform:{value:new fi},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new pi(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Pi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Pi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new fi}},sprite:{diffuse:{value:new Pi(16777215)},opacity:{value:1},center:{value:new pi(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new fi}}},rs={basic:{uniforms:Nr([ns.common,ns.specularmap,ns.envmap,ns.aomap,ns.lightmap,ns.fog]),vertexShader:is.meshbasic_vert,fragmentShader:is.meshbasic_frag},lambert:{uniforms:Nr([ns.common,ns.specularmap,ns.envmap,ns.aomap,ns.lightmap,ns.emissivemap,ns.bumpmap,ns.normalmap,ns.displacementmap,ns.fog,ns.lights,{emissive:{value:new Pi(0)}}]),vertexShader:is.meshlambert_vert,fragmentShader:is.meshlambert_frag},phong:{uniforms:Nr([ns.common,ns.specularmap,ns.envmap,ns.aomap,ns.lightmap,ns.emissivemap,ns.bumpmap,ns.normalmap,ns.displacementmap,ns.fog,ns.lights,{emissive:{value:new Pi(0)},specular:{value:new Pi(1118481)},shininess:{value:30}}]),vertexShader:is.meshphong_vert,fragmentShader:is.meshphong_frag},standard:{uniforms:Nr([ns.common,ns.envmap,ns.aomap,ns.lightmap,ns.emissivemap,ns.bumpmap,ns.normalmap,ns.displacementmap,ns.roughnessmap,ns.metalnessmap,ns.fog,ns.lights,{emissive:{value:new Pi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:is.meshphysical_vert,fragmentShader:is.meshphysical_frag},toon:{uniforms:Nr([ns.common,ns.aomap,ns.lightmap,ns.emissivemap,ns.bumpmap,ns.normalmap,ns.displacementmap,ns.gradientmap,ns.fog,ns.lights,{emissive:{value:new Pi(0)}}]),vertexShader:is.meshtoon_vert,fragmentShader:is.meshtoon_frag},matcap:{uniforms:Nr([ns.common,ns.bumpmap,ns.normalmap,ns.displacementmap,ns.fog,{matcap:{value:null}}]),vertexShader:is.meshmatcap_vert,fragmentShader:is.meshmatcap_frag},points:{uniforms:Nr([ns.points,ns.fog]),vertexShader:is.points_vert,fragmentShader:is.points_frag},dashed:{uniforms:Nr([ns.common,ns.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:is.linedashed_vert,fragmentShader:is.linedashed_frag},depth:{uniforms:Nr([ns.common,ns.displacementmap]),vertexShader:is.depth_vert,fragmentShader:is.depth_frag},normal:{uniforms:Nr([ns.common,ns.bumpmap,ns.normalmap,ns.displacementmap,{opacity:{value:1}}]),vertexShader:is.meshnormal_vert,fragmentShader:is.meshnormal_frag},sprite:{uniforms:Nr([ns.sprite,ns.fog]),vertexShader:is.sprite_vert,fragmentShader:is.sprite_frag},background:{uniforms:{uvTransform:{value:new fi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:is.background_vert,fragmentShader:is.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:is.backgroundCube_vert,fragmentShader:is.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:is.cube_vert,fragmentShader:is.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:is.equirect_vert,fragmentShader:is.equirect_frag},distanceRGBA:{uniforms:Nr([ns.common,ns.displacementmap,{referencePosition:{value:new Vi},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:is.distanceRGBA_vert,fragmentShader:is.distanceRGBA_frag},shadow:{uniforms:Nr([ns.lights,ns.fog,{color:{value:new Pi(0)},opacity:{value:1}}]),vertexShader:is.shadow_vert,fragmentShader:is.shadow_frag}};rs.physical={uniforms:Nr([rs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new pi(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Pi(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new pi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Pi(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Pi(1,1,1)},specularColorMap:{value:null}}]),vertexShader:is.meshphysical_vert,fragmentShader:is.meshphysical_frag};var ss={r:0,b:0,g:0};function as(e,t,i,n,r,s,a){let o,l,c=new Pi(0),h=!0===s?0:1,d=null,u=0,p=null;function f(t,i){t.getRGB(ss,kr(e)),n.buffers.color.setClear(ss.r,ss.g,ss.b,i,a)}return{getClearColor:function(){return c},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;c.set(e),h=t,f(c,h)},getClearAlpha:function(){return h},setClearAlpha:function(e){h=e,f(c,h)},render:function(n,s){let a=!1,m=!0===s.isScene?s.background:null;m&&m.isTexture&&(m=(s.backgroundBlurriness>0?i:t).get(m));let g=e.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?f(c,h):m&&m.isColor&&(f(m,1),a=!0),(e.autoClear||a)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.mapping===_e)?(void 0===l&&(l=new Rr(new Lr(1,1,1),new Ur({name:"BackgroundCubeMaterial",uniforms:Or(rs.backgroundCube.uniforms),vertexShader:rs.backgroundCube.vertexShader,fragmentShader:rs.backgroundCube.fragmentShader,side:B,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=s.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=s.backgroundIntensity,l.material.toneMapped=m.encoding!==jt,(d!==m||u!==m.version||p!==e.toneMapping)&&(l.material.needsUpdate=!0,d=m,u=m.version,p=e.toneMapping),l.layers.enableAll(),n.unshift(l,l.geometry,l.material,0,0,null)):m&&m.isTexture&&(void 0===o&&(o=new Rr(new ts(2,2),new Ur({name:"BackgroundMaterial",uniforms:Or(rs.background.uniforms),vertexShader:rs.background.vertexShader,fragmentShader:rs.background.fragmentShader,side:R,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=m,o.material.uniforms.backgroundIntensity.value=s.backgroundIntensity,o.material.toneMapped=m.encoding!==jt,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),(d!==m||u!==m.version||p!==e.toneMapping)&&(o.material.needsUpdate=!0,d=m,u=m.version,p=e.toneMapping),o.layers.enableAll(),n.unshift(o,o.geometry,o.material,0,0,null))}}}function os(e,t,i,n){let r=e.getParameter(34921),s=n.isWebGL2?null:t.get("OES_vertex_array_object"),a=n.isWebGL2||null!==s,o={},l=p(null),c=l,h=!1;function d(t){return n.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function u(t){return n.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function p(e){let t=[],i=[],n=[];for(let s=0;s<r;s++)t[s]=0,i[s]=0,n[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function f(){let e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function m(e){g(e,0)}function g(i,r){let s=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;s[i]=1,0===a[i]&&(e.enableVertexAttribArray(i),a[i]=1),o[i]!==r&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r)}function v(){let t=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function y(t,i,r,s,a,o){!0!==n.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,i,r,s,a,o):e.vertexAttribIPointer(t,i,r,a,o)}function b(){A(),h=!0,c!==l&&(c=l,d(c.object))}function A(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,u,b,A){let x=!1;if(a){let t=function(t,i,r){let a=!0===r.wireframe,l=o[t.id];void 0===l&&(l={},o[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[a];return void 0===h&&(h=p(n.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),c[a]=h),h}(b,u,l);c!==t&&(c=t,d(c.object)),x=function(e,t,i,n){let r=c.attributes,s=t.attributes,a=0,o=i.getAttributes();for(let l in o)if(o[l].location>=0){let t=r[l],i=s[l];if(void 0===i&&("instanceMatrix"===l&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(i=e.instanceColor)),void 0===t||t.attribute!==i||i&&t.data!==i.data)return!0;a++}return c.attributesNum!==a||c.index!==n}(r,b,u,A),x&&function(e,t,i,n){let r={},s=t.attributes,a=0,o=i.getAttributes();for(let l in o)if(o[l].location>=0){let t=s[l];void 0===t&&("instanceMatrix"===l&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(t=e.instanceColor));let i={};i.attribute=t,t&&t.data&&(i.data=t.data),r[l]=i,a++}c.attributes=r,c.attributesNum=a,c.index=n}(r,b,u,A)}else{let e=!0===l.wireframe;(c.geometry!==b.id||c.program!==u.id||c.wireframe!==e)&&(c.geometry=b.id,c.program=u.id,c.wireframe=e,x=!0)}null!==A&&i.update(A,34963),(x||h)&&(h=!1,function(r,s,a,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();let l=o.attributes,c=a.getAttributes(),h=s.defaultAttributeValues;for(let t in c){let n=c[t];if(n.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){let t=s.normalized,a=s.itemSize,l=i.get(s);if(void 0===l)continue;let c=l.buffer,h=l.type,d=l.bytesPerElement;if(s.isInterleavedBufferAttribute){let i=s.data,l=i.stride,u=s.offset;if(i.isInstancedInterleavedBuffer){for(let e=0;e<n.locationSize;e++)g(n.location+e,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<n.locationSize;e++)m(n.location+e);e.bindBuffer(34962,c);for(let e=0;e<n.locationSize;e++)y(n.location+e,a/n.locationSize,h,t,l*d,(u+a/n.locationSize*e)*d)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<n.locationSize;e++)g(n.location+e,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<n.locationSize;e++)m(n.location+e);e.bindBuffer(34962,c);for(let e=0;e<n.locationSize;e++)y(n.location+e,a/n.locationSize,h,t,a*d,a/n.locationSize*e*d)}}else if(void 0!==h){let i=h[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(n.location,i);break;case 3:e.vertexAttrib3fv(n.location,i);break;case 4:e.vertexAttrib4fv(n.location,i);break;default:e.vertexAttrib1fv(n.location,i)}}}}v()}(r,l,u,b),null!==A&&e.bindBuffer(34963,i.get(A).buffer))},reset:b,resetDefaultState:A,dispose:function(){b();for(let e in o){let t=o[e];for(let e in t){let i=t[e];for(let e in i)u(i[e].object),delete i[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;let t=o[e.id];for(let i in t){let e=t[i];for(let t in e)u(e[t].object),delete e[t];delete t[i]}delete o[e.id]},releaseStatesOfProgram:function(e){for(let t in o){let i=o[t];if(void 0===i[e.id])continue;let n=i[e.id];for(let e in n)u(n[e].object),delete n[e];delete i[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function ls(e,t,i,n){let r,s=n.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,n){e.drawArrays(r,t,n),i.update(n,r,1)},this.renderInstances=function(n,a,o){if(0===o)return;let l,c;if(s)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](r,n,a,o),i.update(a,r,o)}}function cs(e,t,i){let n;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let s=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,a=void 0!==i.precision?i.precision:"highp",o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);let l=s||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=e.getParameter(34930),d=e.getParameter(35660),u=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=d>0,b=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){let i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:d,maxTextureSize:u,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:s?e.getParameter(36183):0}}function hs(e){let t=this,i=null,n=0,r=!1,s=!1,a=new Yr,o=new fi,l={value:null,needsUpdate:!1};function c(e,i,n,r){let s=null!==e?e.length:0,c=null;if(0!==s){if(c=l.value,!0!==r||null===c){let t=n+4*s,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let i=0,l=n;i!==s;++i,l+=4)a.copy(e[i]).applyMatrix4(r,o),a.normal.toArray(c,l),c[l+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){let i=0!==e.length||t||0!==n||r;return r=t,n=e.length,i},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){i=c(e,t,0)},this.setState=function(a,o,h){let d=a.clippingPlanes,u=a.clipIntersection,p=a.clipShadows,f=e.get(a);if(!r||null===d||0===d.length||s&&!p)s?c(null):(l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0);else{let e=s?0:n,t=4*e,r=f.clippingState||null;l.value=r,r=c(d,o,t,h);for(let n=0;n!==t;++n)r[n]=i[n];f.clippingState=r,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=e}}}function ds(e){let t=new WeakMap;function i(e,t){return t===we?e.mapping=Ae:t===Se&&(e.mapping=xe),e}function n(e){let i=e.target;i.removeEventListener("dispose",n);let r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){let s=r.mapping;if(s===we||s===Se){if(t.has(r)){return i(t.get(r).texture,r.mapping)}{let s=r.image;if(s&&s.height>0){let a=new Wr(s.height/2);return a.fromEquirectangularTexture(e,r),t.set(r,a),r.addEventListener("dispose",n),i(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}var us=class extends zr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e,s=i+e,a=n+t,o=n-t;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}},ps=[.125,.215,.35,.446,.526,.582],fs=20,ms=new us,gs=new Pi,vs=null,ys=(1+Math.sqrt(5))/2,bs=1/ys,As=[new Vi(1,1,1),new Vi(-1,1,1),new Vi(1,1,-1),new Vi(-1,1,-1),new Vi(0,ys,bs),new Vi(0,ys,-bs),new Vi(bs,0,ys),new Vi(-bs,0,ys),new Vi(ys,bs,0),new Vi(-ys,bs,0)],xs=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;vs=this._renderer.getRenderTarget(),this._setSize(256);let r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Es(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=_s(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(vs),e.scissorTest=!1,Ss(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ae||e.mapping===xe?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),vs=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:De,minFilter:De,generateMipmaps:!1,type:je,format:Qe,encoding:zt,depthBuffer:!1},n=ws(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=ws(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){let t=[],i=[],n=[],r=e,s=e-4+1+ps.length;for(let a=0;a<s;a++){let s=Math.pow(2,r);i.push(s);let o=1/s;a>e-4?o=ps[a-e+4-1]:0===a&&(o=0),n.push(o);let l=1/(s-2),c=-l,h=1+l,d=[c,c,h,c,h,h,c,c,h,h,c,h],u=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*u),y=new Float32Array(m*p*u),b=new Float32Array(g*p*u);for(let e=0;e<u;e++){let t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];v.set(n,f*p*e),y.set(d,m*p*e);let r=[e,e,e,e,e,e];b.set(r,g*p*e)}let A=new yr;A.setAttribute("position",new or(v,f)),A.setAttribute("uv",new or(y,m)),A.setAttribute("faceIndex",new or(b,g)),t.push(A),r>4&&r--}return{lodPlanes:t,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(e,t,i){let n=new Float32Array(fs),r=new Vi(0,1,0);return new Ur({name:"SphericalGaussianBlur",defines:{n:fs,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Cs(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:O,depthTest:!1,depthWrite:!1})}(n,e,t)}return n}_compileMaterial(e){let t=new Rr(this._lodPlanes[0],e);this._renderer.compile(t,ms)}_sceneToCubeUV(e,t,i,n){let r=new jr(90,1,t,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(gs),o.toneMapping=fe,o.autoClear=!1;let h=new rr({name:"PMREM.Background",side:B,depthWrite:!1,depthTest:!1}),d=new Rr(new Lr,h),u=!1,p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,u=!0):(h.color.copy(gs),u=!0);for(let f=0;f<6;f++){let t=f%3;0===t?(r.up.set(0,s[f],0),r.lookAt(a[f],0,0)):1===t?(r.up.set(0,0,s[f]),r.lookAt(0,a[f],0)):(r.up.set(0,s[f],0),r.lookAt(0,0,a[f]));let i=this._cubeSize;Ss(n,t*i,f>2?i:0,i,i),o.setRenderTarget(n),u&&o.render(d,r),o.render(e,r)}d.geometry.dispose(),d.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,n=e.mapping===Ae||e.mapping===xe;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=Es()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=_s());let r=n?this._cubemapMaterial:this._equirectMaterial,s=new Rr(this._lodPlanes[0],r);r.uniforms.envMap.value=e;let a=this._cubeSize;Ss(t,0,0,3*a,2*a),i.setRenderTarget(t),i.render(s,ms)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){let t=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),i=As[(n-1)%As.length];this._blur(e,n-1,n,t,i)}t.autoClear=i}_blur(e,t,i,n,r){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,n,"latitudinal",r),this._halfBlur(s,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,s,a){let o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");let c=new Rr(this._lodPlanes[n],l),h=l.uniforms,d=this._sizeLods[i]-1,u=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,p=r/u,f=isFinite(r)?1+Math.floor(3*p):fs;f>fs&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);let m=[],g=0;for(let b=0;b<fs;++b){let e=b/p,t=Math.exp(-e*e/2);m.push(t),0===b?g+=t:b<f&&(g+=2*t)}for(let b=0;b<m.length;b++)m[b]=m[b]/g;h.envMap.value=e.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a);let{_lodMax:v}=this;h.dTheta.value=u,h.mipInt.value=v-i;let y=this._sizeLods[n];Ss(t,3*y*(n>v-4?n-v+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(c,ms)}};function ws(e,t,i){let n=new Fi(e,t,i);return n.texture.mapping=_e,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Ss(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function _s(){return new Ur({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Cs(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:O,depthTest:!1,depthWrite:!1})}function Es(){return new Ur({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Cs(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:O,depthTest:!1,depthWrite:!1})}function Cs(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Ms(e){let t=new WeakMap,i=null;function n(e){let i=e.target;i.removeEventListener("dispose",n);let r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){let s=r.mapping,a=s===we||s===Se,o=s===Ae||s===xe;if(a||o){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=t.get(r);return null===i&&(i=new xs(e)),n=a?i.fromEquirectangular(r,n):i.fromCubemap(r,n),t.set(r,n),n.texture}if(t.has(r))return t.get(r).texture;{let s=r.image;if(a&&s&&s.height>0||o&&s&&function(e){let t=0,i=6;for(let n=0;n<i;n++)void 0!==e[n]&&t++;return t===i}(s)){null===i&&(i=new xs(e));let s=a?i.fromEquirectangular(r):i.fromCubemap(r);return t.set(r,s),r.addEventListener("dispose",n),s.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function Ts(e){let t={};function i(i){if(void 0!==t[i])return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(e){let t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Is(e,t,i,n){let r={},s=new WeakMap;function a(e){let o=e.target;null!==o.index&&t.remove(o.index);for(let i in o.attributes)t.remove(o.attributes[i]);o.removeEventListener("dispose",a),delete r[o.id];let l=s.get(o);l&&(t.remove(l),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(e){let i=[],n=e.index,r=e.attributes.position,a=0;if(null!==n){let e=n.array;a=n.version;for(let t=0,n=e.length;t<n;t+=3){let n=e[t+0],r=e[t+1],s=e[t+2];i.push(n,r,r,s,s,n)}}else{let e=r.array;a=r.version;for(let t=0,n=e.length/3-1;t<n;t+=3){let e=t+0,n=t+1,r=t+2;i.push(e,n,n,r,r,e)}}let o=new(gi(i)?cr:lr)(i,1);o.version=a;let l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,i.memory.geometries++),t},update:function(e){let i=e.attributes;for(let r in i)t.update(i[r],34962);let n=e.morphAttributes;for(let r in n){let e=n[r];for(let i=0,n=e.length;i<n;i++)t.update(e[i],34962)}},getWireframeAttribute:function(e){let t=s.get(e);if(t){let i=e.index;null!==i&&t.version<i.version&&o(e)}else o(e);return s.get(e)}}}function Ps(e,t,i,n){let r,s,a,o=n.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(r,n,s,t*a),i.update(n,r,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,d;if(o)h=e,d="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[d](r,l,s,n*a,c),i.update(l,r,c)}}function Ds(e){let t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(t.calls++,i){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Rs(e,t){return e[0]-t[0]}function Bs(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ls(e,t,i){let n={},r=new Float32Array(8),s=new WeakMap,a=new ki,o=[];for(let l=0;l<8;l++)o[l]=[l,0];return{update:function(l,c,h,d){let u=l.morphTargetInfluences;if(!0===t.isWebGL2){let n=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,r=void 0!==n?n.length:0,o=s.get(c);if(void 0===o||o.count!==r){let e=function(){v.dispose(),s.delete(c),c.removeEventListener("dispose",e)};void 0!==o&&o.texture.dispose();let i=void 0!==c.morphAttributes.position,n=void 0!==c.morphAttributes.normal,l=void 0!==c.morphAttributes.color,h=c.morphAttributes.position||[],d=c.morphAttributes.normal||[],u=c.morphAttributes.color||[],p=0;!0===i&&(p=1),!0===n&&(p=2),!0===l&&(p=3);let f=c.attributes.position.count*p,m=1;f>t.maxTextureSize&&(m=Math.ceil(f/t.maxTextureSize),f=t.maxTextureSize);let g=new Float32Array(f*m*4*r),v=new Ui(g,f,m,r);v.type=ze,v.needsUpdate=!0;let y=4*p;for(let t=0;t<r;t++){let e=h[t],r=d[t],s=u[t],o=f*m*4*t;for(let t=0;t<e.count;t++){let c=t*y;!0===i&&(a.fromBufferAttribute(e,t),g[o+c+0]=a.x,g[o+c+1]=a.y,g[o+c+2]=a.z,g[o+c+3]=0),!0===n&&(a.fromBufferAttribute(r,t),g[o+c+4]=a.x,g[o+c+5]=a.y,g[o+c+6]=a.z,g[o+c+7]=0),!0===l&&(a.fromBufferAttribute(s,t),g[o+c+8]=a.x,g[o+c+9]=a.y,g[o+c+10]=a.z,g[o+c+11]=4===s.itemSize?a.w:1)}}o={count:r,texture:v,size:new pi(f,m)},s.set(c,o),c.addEventListener("dispose",e)}let l=0;for(let e=0;e<u.length;e++)l+=u[e];let h=c.morphTargetsRelative?1:1-l;d.getUniforms().setValue(e,"morphTargetBaseInfluence",h),d.getUniforms().setValue(e,"morphTargetInfluences",u),d.getUniforms().setValue(e,"morphTargetsTexture",o.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",o.size)}else{let t=void 0===u?0:u.length,i=n[c.id];if(void 0===i||i.length!==t){i=[];for(let e=0;e<t;e++)i[e]=[e,0];n[c.id]=i}for(let e=0;e<t;e++){let t=i[e];t[0]=e,t[1]=u[e]}i.sort(Bs);for(let e=0;e<8;e++)e<t&&i[e][1]?(o[e][0]=i[e][0],o[e][1]=i[e][1]):(o[e][0]=Number.MAX_SAFE_INTEGER,o[e][1]=0);o.sort(Rs);let s=c.morphAttributes.position,a=c.morphAttributes.normal,l=0;for(let e=0;e<8;e++){let t=o[e],i=t[0],n=t[1];i!==Number.MAX_SAFE_INTEGER&&n?(s&&c.getAttribute("morphTarget"+e)!==s[i]&&c.setAttribute("morphTarget"+e,s[i]),a&&c.getAttribute("morphNormal"+e)!==a[i]&&c.setAttribute("morphNormal"+e,a[i]),r[e]=n,l+=n):(s&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),a&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),r[e]=0)}let h=c.morphTargetsRelative?1:1-l;d.getUniforms().setValue(e,"morphTargetBaseInfluence",h),d.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function Os(e,t,i,n){let r=new WeakMap;function s(e){let t=e.target;t.removeEventListener("dispose",s),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){let a=n.render.frame,o=e.geometry,l=t.get(e,o);return r.get(l)!==a&&(t.update(l),r.set(l,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}var Ns=new Ni,ks=new Ui,Fs=new class extends Ni{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Te,this.minFilter=Te,this.wrapR=Ce,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Us=new Hr,zs=[],js=[],Vs=new Float32Array(16),Gs=new Float32Array(9),Hs=new Float32Array(4);function Ws(e,t,i){let n=e[0];if(null==n||n<=0||n>0)return e;let r=t*i,s=zs[r];if(void 0===s&&(s=new Float32Array(r),zs[r]=s),0!==t){n.toArray(s,0);for(let n=1,r=0;n!==t;++n)r+=i,e[n].toArray(s,r)}return s}function Qs(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function qs(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function Xs(e,t){let i=js[t];void 0===i&&(i=new Int32Array(t),js[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function Ys(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Ks(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Qs(i,t))return;e.uniform2fv(this.addr,t),qs(i,t)}}function Js(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Qs(i,t))return;e.uniform3fv(this.addr,t),qs(i,t)}}function Zs(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Qs(i,t))return;e.uniform4fv(this.addr,t),qs(i,t)}}function $s(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(Qs(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),qs(i,t)}else{if(Qs(i,n))return;Hs.set(n),e.uniformMatrix2fv(this.addr,!1,Hs),qs(i,n)}}function ea(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(Qs(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),qs(i,t)}else{if(Qs(i,n))return;Gs.set(n),e.uniformMatrix3fv(this.addr,!1,Gs),qs(i,n)}}function ta(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(Qs(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),qs(i,t)}else{if(Qs(i,n))return;Vs.set(n),e.uniformMatrix4fv(this.addr,!1,Vs),qs(i,n)}}function ia(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function na(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Qs(i,t))return;e.uniform2iv(this.addr,t),qs(i,t)}}function ra(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Qs(i,t))return;e.uniform3iv(this.addr,t),qs(i,t)}}function sa(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Qs(i,t))return;e.uniform4iv(this.addr,t),qs(i,t)}}function aa(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function oa(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Qs(i,t))return;e.uniform2uiv(this.addr,t),qs(i,t)}}function la(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Qs(i,t))return;e.uniform3uiv(this.addr,t),qs(i,t)}}function ca(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Qs(i,t))return;e.uniform4uiv(this.addr,t),qs(i,t)}}function ha(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(t||Ns,r)}function da(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||Fs,r)}function ua(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||Us,r)}function pa(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||ks,r)}function fa(e,t){e.uniform1fv(this.addr,t)}function ma(e,t){let i=Ws(t,this.size,2);e.uniform2fv(this.addr,i)}function ga(e,t){let i=Ws(t,this.size,3);e.uniform3fv(this.addr,i)}function va(e,t){let i=Ws(t,this.size,4);e.uniform4fv(this.addr,i)}function ya(e,t){let i=Ws(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function ba(e,t){let i=Ws(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Aa(e,t){let i=Ws(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function xa(e,t){e.uniform1iv(this.addr,t)}function wa(e,t){e.uniform2iv(this.addr,t)}function Sa(e,t){e.uniform3iv(this.addr,t)}function _a(e,t){e.uniform4iv(this.addr,t)}function Ea(e,t){e.uniform1uiv(this.addr,t)}function Ca(e,t){e.uniform2uiv(this.addr,t)}function Ma(e,t){e.uniform3uiv(this.addr,t)}function Ta(e,t){e.uniform4uiv(this.addr,t)}function Ia(e,t,i){let n=this.cache,r=t.length,s=Xs(i,r);Qs(n,s)||(e.uniform1iv(this.addr,s),qs(n,s));for(let a=0;a!==r;++a)i.setTexture2D(t[a]||Ns,s[a])}function Pa(e,t,i){let n=this.cache,r=t.length,s=Xs(i,r);Qs(n,s)||(e.uniform1iv(this.addr,s),qs(n,s));for(let a=0;a!==r;++a)i.setTexture3D(t[a]||Fs,s[a])}function Da(e,t,i){let n=this.cache,r=t.length,s=Xs(i,r);Qs(n,s)||(e.uniform1iv(this.addr,s),qs(n,s));for(let a=0;a!==r;++a)i.setTextureCube(t[a]||Us,s[a])}function Ra(e,t,i){let n=this.cache,r=t.length,s=Xs(i,r);Qs(n,s)||(e.uniform1iv(this.addr,s),qs(n,s));for(let a=0;a!==r;++a)i.setTexture2DArray(t[a]||ks,s[a])}var Ba=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Ys;case 35664:return Ks;case 35665:return Js;case 35666:return Zs;case 35674:return $s;case 35675:return ea;case 35676:return ta;case 5124:case 35670:return ia;case 35667:case 35671:return na;case 35668:case 35672:return ra;case 35669:case 35673:return sa;case 5125:return aa;case 36294:return oa;case 36295:return la;case 36296:return ca;case 35678:case 36198:case 36298:case 36306:case 35682:return ha;case 35679:case 36299:case 36307:return da;case 35680:case 36300:case 36308:case 36293:return ua;case 36289:case 36303:case 36311:case 36292:return pa}}(t.type)}},La=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return fa;case 35664:return ma;case 35665:return ga;case 35666:return va;case 35674:return ya;case 35675:return ba;case 35676:return Aa;case 5124:case 35670:return xa;case 35667:case 35671:return wa;case 35668:case 35672:return Sa;case 35669:case 35673:return _a;case 5125:return Ea;case 36294:return Ca;case 36295:return Ma;case 36296:return Ta;case 35678:case 36198:case 36298:case 36306:case 35682:return Ia;case 35679:case 36299:case 36307:return Pa;case 35680:case 36300:case 36308:case 36293:return Da;case 36289:case 36303:case 36311:case 36292:return Ra}}(t.type)}},Oa=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){if(void 0===t)return;let n=this.seq;for(let r=0,s=n.length;r!==s;++r){let s=n[r];s.setValue(e,t[s.id],i)}}},Na=/(\w+)(\])?(\[|\.)?/g;function ka(e,t){e.seq.push(t),e.map[t.id]=t}function Fa(e,t,i){let n=e.name,r=n.length;for(Na.lastIndex=0;;){let s=Na.exec(n),a=Na.lastIndex,o=s[1],l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){ka(i,void 0===c?new Ba(o,e,t):new La(o,e,t));break}{let e=i.map[o];void 0===e&&(e=new Oa(o),ka(i,e)),i=e}}}var Ua=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){let i=e.getActiveUniform(t,n);Fa(i,e.getUniformLocation(t,i.name),this)}}setValue(e,t,i,n){let r=this.map[t];void 0!==r&&r.setValue(e,i,n)}setOptional(e,t,i){let n=t[i];void 0!==n&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,s=t.length;r!==s;++r){let s=t[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,n)}}static seqWithValue(e,t){let i=[];for(let n=0,r=e.length;n!==r;++n){let r=e[n];r.id in t&&i.push(r)}return i}};function za(e,t,i){let n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}var ja=0;function Va(e,t,i){let n=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(n&&""===r)return"";let s=/ERROR: 0:(\d+)/.exec(r);if(s){let n=parseInt(s[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){let i=e.split("\n"),n=[],r=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=r;a<s;a++){let e=a+1;n.push(`${e===t?">":" "} ${e}: ${i[a]}`)}return n.join("\n")}(e.getShaderSource(t),n)}return r}function Ga(e,t){let i=function(e){switch(e){case zt:return["Linear","( value )"];case jt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Ha(e,t){let i;switch(t){case me:i="Linear";break;case ge:i="Reinhard";break;case ve:i="OptimizedCineon";break;case ye:i="ACESFilmic";break;case be:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Wa(e){return""!==e}function Qa(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function qa(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Xa=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ya(e){return e.replace(Xa,Ka)}function Ka(e,t){let i=is[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Ya(i)}var Ja=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Za(e){return e.replace(Ja,$a)}function $a(e,t,i,n){let r="";for(let s=parseInt(t);s<parseInt(i);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function eo(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function to(e,t,i,n){let r,s,a=e.getContext(),o=i.defines,l=i.vertexShader,c=i.fragmentShader,h=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===I?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===P?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===D&&(t="SHADOWMAP_TYPE_VSM"),t}(i),d=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Ae:case xe:t="ENVMAP_TYPE_CUBE";break;case _e:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===xe&&(t="ENVMAP_MODE_REFRACTION");return t}(i),p=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case de:t="ENVMAP_BLENDING_MULTIPLY";break;case ue:t="ENVMAP_BLENDING_MIX";break;case pe:t="ENVMAP_BLENDING_ADD"}return t}(i),f=function(e){let t=e.envMapCubeUVHeight;if(null===t)return null;let i=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),m=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Wa).join("\n")}(i),g=function(e){let t=[];for(let i in e){let n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(o),v=a.createProgram(),y=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(r=[g].filter(Wa).join("\n"),r.length>0&&(r+="\n"),s=[m,g].filter(Wa).join("\n"),s.length>0&&(s+="\n")):(r=[eo(i),"#define SHADER_NAME "+i.shaderName,g,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Wa).join("\n"),s=[m,eo(i),"#define SHADER_NAME "+i.shaderName,g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.envMap?"#define "+u:"",i.envMap?"#define "+p:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==fe?"#define TONE_MAPPING":"",i.toneMapping!==fe?is.tonemapping_pars_fragment:"",i.toneMapping!==fe?Ha("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",is.encodings_pars_fragment,Ga("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Wa).join("\n")),l=Ya(l),l=Qa(l,i),l=qa(l,i),c=Ya(c),c=Qa(c,i),c=qa(c,i),l=Za(l),c=Za(c),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(y="#version 300 es\n",r=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,s=["#define varying in",i.glslVersion===Kt?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Kt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s);let b,A,x=y+s+c,w=za(a,35633,y+r+l),S=za(a,35632,x);if(a.attachShader(v,w),a.attachShader(v,S),void 0!==i.index0AttributeName?a.bindAttribLocation(v,0,i.index0AttributeName):!0===i.morphTargets&&a.bindAttribLocation(v,0,"position"),a.linkProgram(v),e.debug.checkShaderErrors){let e=a.getProgramInfoLog(v).trim(),t=a.getShaderInfoLog(w).trim(),i=a.getShaderInfoLog(S).trim(),n=!0,o=!0;if(!1===a.getProgramParameter(v,35714)){n=!1;let t=Va(a,w,"vertex"),i=Va(a,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(v,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+i)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):(""===t||""===i)&&(o=!1);o&&(this.diagnostics={runnable:n,programLog:e,vertexShader:{log:t,prefix:r},fragmentShader:{log:i,prefix:s}})}return a.deleteShader(w),a.deleteShader(S),this.getUniforms=function(){return void 0===b&&(b=new Ua(a,v)),b},this.getAttributes=function(){return void 0===A&&(A=function(e,t){let i={},n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){let n=e.getActiveAttrib(t,r),s=n.name,a=1;35674===n.type&&(a=2),35675===n.type&&(a=3),35676===n.type&&(a=4),i[s]={type:n.type,location:e.getAttribLocation(t,s),locationSize:a}}return i}(a,v)),A},this.destroy=function(){n.releaseStatesOfProgram(this),a.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=ja++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=S,this}var io=0,no=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return void 0===i&&(i=new ro(e),t.set(e,i)),i}},ro=class{constructor(e){this.id=io++,this.code=e,this.usedTimes=0}};function so(e,t,i,n,r,s,a){let o=new Pn,l=new no,c=[],h=r.isWebGL2,d=r.logarithmicDepthBuffer,u=r.vertexTextures,p=r.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,o,c,m,g){let v=m.fog,y=g.geometry,b=s.isMeshStandardMaterial?m.environment:null,A=(s.isMeshStandardMaterial?i:t).get(s.envMap||b),x=A&&A.mapping===_e?A.image.height:null,w=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));let S,_,E,C,M=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,T=void 0!==M?M.length:0,I=0;if(void 0!==y.morphAttributes.position&&(I=1),void 0!==y.morphAttributes.normal&&(I=2),void 0!==y.morphAttributes.color&&(I=3),w){let e=rs[w];S=e.vertexShader,_=e.fragmentShader}else S=s.vertexShader,_=s.fragmentShader,l.update(s),E=l.getVertexShaderID(s),C=l.getFragmentShaderID(s);let P=e.getRenderTarget(),D=s.alphaTest>0,R=s.clearcoat>0,O=s.iridescence>0;return{isWebGL2:h,shaderID:w,shaderName:s.type,vertexShader:S,fragmentShader:_,defines:s.defines,customVertexShaderID:E,customFragmentShaderID:C,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:u,outputEncoding:null===P?e.outputEncoding:!0===P.isXRRenderTarget?P.texture.encoding:zt,map:!!s.map,matcap:!!s.matcap,envMap:!!A,envMapMode:A&&A.mapping,envMapCubeUVHeight:x,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:s.normalMapType===Wt,tangentSpaceNormalMap:s.normalMapType===Ht,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===jt,clearcoat:R,clearcoatMap:R&&!!s.clearcoatMap,clearcoatRoughnessMap:R&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:R&&!!s.clearcoatNormalMap,iridescence:O,iridescenceMap:O&&!!s.iridescenceMap,iridescenceThicknessMap:O&&!!s.iridescenceThicknessMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&s.blending===N,alphaMap:!!s.alphaMap,alphaTest:D,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!y.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUvs:!!s.map||!!s.bumpMap||!!s.normalMap||!!s.specularMap||!!s.alphaMap||!!s.emissiveMap||!!s.roughnessMap||!!s.metalnessMap||!!s.clearcoatMap||!!s.clearcoatRoughnessMap||!!s.clearcoatNormalMap||!!s.iridescenceMap||!!s.iridescenceThicknessMap||!!s.displacementMap||!!s.transmissionMap||!!s.thicknessMap||!!s.specularIntensityMap||!!s.specularColorMap||!!s.sheenColorMap||!!s.sheenRoughnessMap,uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap)&&!!s.displacementMap,fog:!!v,useFog:!0===s.fog,fogExp2:v&&v.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:T,morphTextureStride:I,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:fe,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===L,flipSided:s.side===B,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){let i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.customVertexShaderID),i.push(t.customFragmentShaderID)),void 0!==t.defines)for(let e in t.defines)i.push(e),i.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(i,t),function(e,t){o.disableAll(),t.isWebGL2&&o.enable(0),t.supportsVertexTextures&&o.enable(1),t.instancing&&o.enable(2),t.instancingColor&&o.enable(3),t.map&&o.enable(4),t.matcap&&o.enable(5),t.envMap&&o.enable(6),t.lightMap&&o.enable(7),t.aoMap&&o.enable(8),t.emissiveMap&&o.enable(9),t.bumpMap&&o.enable(10),t.normalMap&&o.enable(11),t.objectSpaceNormalMap&&o.enable(12),t.tangentSpaceNormalMap&&o.enable(13),t.clearcoat&&o.enable(14),t.clearcoatMap&&o.enable(15),t.clearcoatRoughnessMap&&o.enable(16),t.clearcoatNormalMap&&o.enable(17),t.iridescence&&o.enable(18),t.iridescenceMap&&o.enable(19),t.iridescenceThicknessMap&&o.enable(20),t.displacementMap&&o.enable(21),t.specularMap&&o.enable(22),t.roughnessMap&&o.enable(23),t.metalnessMap&&o.enable(24),t.gradientMap&&o.enable(25),t.alphaMap&&o.enable(26),t.alphaTest&&o.enable(27),t.vertexColors&&o.enable(28),t.vertexAlphas&&o.enable(29),t.vertexUvs&&o.enable(30),t.vertexTangents&&o.enable(31),t.uvsVertexOnly&&o.enable(32),e.push(o.mask),o.disableAll(),t.fog&&o.enable(0),t.useFog&&o.enable(1),t.flatShading&&o.enable(2),t.logarithmicDepthBuffer&&o.enable(3),t.skinning&&o.enable(4),t.morphTargets&&o.enable(5),t.morphNormals&&o.enable(6),t.morphColors&&o.enable(7),t.premultipliedAlpha&&o.enable(8),t.shadowMapEnabled&&o.enable(9),t.physicallyCorrectLights&&o.enable(10),t.doubleSided&&o.enable(11),t.flipSided&&o.enable(12),t.useDepthPacking&&o.enable(13),t.dithering&&o.enable(14),t.specularIntensityMap&&o.enable(15),t.specularColorMap&&o.enable(16),t.transmission&&o.enable(17),t.transmissionMap&&o.enable(18),t.thicknessMap&&o.enable(19),t.sheen&&o.enable(20),t.sheenColorMap&&o.enable(21),t.sheenRoughnessMap&&o.enable(22),t.decodeVideoTexture&&o.enable(23),t.opaque&&o.enable(24),e.push(o.mask)}(i,t),i.push(e.outputEncoding)),i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){let t,i=f[e.type];if(i){let e=rs[i];t=Fr.clone(e.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,i){let n;for(let e=0,r=c.length;e<r;e++){let t=c[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new to(e,i,t,s),c.push(n)),n},releaseProgram:function(e){if(0===--e.usedTimes){let t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function ao(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function oo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function lo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function co(){let e=[],t=0,i=[],n=[],r=[];function s(i,n,r,s,a,o){let l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:a,group:o},e[t]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){t=0,i.length=0,n.length=0,r.length=0},push:function(e,t,a,o,l,c){let h=s(e,t,a,o,l,c);a.transmission>0?n.push(h):!0===a.transparent?r.push(h):i.push(h)},unshift:function(e,t,a,o,l,c){let h=s(e,t,a,o,l,c);a.transmission>0?n.unshift(h):!0===a.transparent?r.unshift(h):i.unshift(h)},finish:function(){for(let i=t,n=e.length;i<n;i++){let t=e[i];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){i.length>1&&i.sort(e||oo),n.length>1&&n.sort(t||lo),r.length>1&&r.sort(t||lo)}}}function ho(){let e=new WeakMap;return{get:function(t,i){let n,r=e.get(t);return void 0===r?(n=new co,e.set(t,[n])):i>=r.length?(n=new co,r.push(n)):n=r[i],n},dispose:function(){e=new WeakMap}}}function uo(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new Vi,color:new Pi};break;case"SpotLight":i={position:new Vi,direction:new Vi,color:new Pi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vi,color:new Pi,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vi,skyColor:new Pi,groundColor:new Pi};break;case"RectAreaLight":i={color:new Pi,position:new Vi,halfWidth:new Vi,halfHeight:new Vi}}return e[t.id]=i,i}}}var po=0;function fo(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function mo(e,t){let i=new uo,n=function(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new pi};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new pi,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let l=0;l<9;l++)r.probe.push(new Vi);let s=new Vi,a=new bn,o=new bn;return{setup:function(s,a){let o=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let h=0,d=0,u=0,p=0,f=0,m=0,g=0,v=0,y=0,b=0;s.sort(fo);let A=!0!==a?Math.PI:1;for(let e=0,t=s.length;e<t;e++){let t=s[e],a=t.color,x=t.intensity,w=t.distance,S=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=a.r*x*A,l+=a.g*x*A,c+=a.b*x*A;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],x);else if(t.isDirectionalLight){let e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*A),t.castShadow){let e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[h]=i,r.directionalShadowMap[h]=S,r.directionalShadowMatrix[h]=t.shadow.matrix,m++}r.directional[h]=e,h++}else if(t.isSpotLight){let e=i.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(x*A),e.distance=w,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[u]=e;let s=t.shadow;if(t.map&&(r.spotLightMap[y]=t.map,y++,s.updateMatrices(t),t.castShadow&&b++),r.spotLightMatrix[u]=s.matrix,t.castShadow){let e=n.get(t);e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,r.spotShadow[u]=e,r.spotShadowMap[u]=S,v++}u++}else if(t.isRectAreaLight){let e=i.get(t);e.color.copy(a).multiplyScalar(x),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){let e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*A),e.distance=t.distance,e.decay=t.decay,t.castShadow){let e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[d]=i,r.pointShadowMap[d]=S,r.pointShadowMatrix[d]=t.shadow.matrix,g++}r.point[d]=e,d++}else if(t.isHemisphereLight){let e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(x*A),e.groundColor.copy(t.groundColor).multiplyScalar(x*A),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=ns.LTC_FLOAT_1,r.rectAreaLTC2=ns.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=ns.LTC_HALF_1,r.rectAreaLTC2=ns.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=c;let x=r.hash;(x.directionalLength!==h||x.pointLength!==d||x.spotLength!==u||x.rectAreaLength!==p||x.hemiLength!==f||x.numDirectionalShadows!==m||x.numPointShadows!==g||x.numSpotShadows!==v||x.numSpotMaps!==y)&&(r.directional.length=h,r.spot.length=u,r.rectArea.length=p,r.point.length=d,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+y-b,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=b,x.directionalLength=h,x.pointLength=d,x.spotLength=u,x.rectAreaLength=p,x.hemiLength=f,x.numDirectionalShadows=m,x.numPointShadows=g,x.numSpotShadows=v,x.numSpotMaps=y,r.version=po++)},setupView:function(e,t){let i=0,n=0,l=0,c=0,h=0,d=t.matrixWorldInverse;for(let u=0,p=e.length;u<p;u++){let t=e[u];if(t.isDirectionalLight){let e=r.directional[i];e.direction.setFromMatrixPosition(t.matrixWorld),s.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(d),i++}else if(t.isSpotLight){let e=r.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(t.matrixWorld),s.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(d),l++}else if(t.isRectAreaLight){let e=r.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),o.identity(),a.copy(t.matrixWorld),a.premultiply(d),o.extractRotation(a),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(t.isPointLight){let e=r.point[n];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),n++}else if(t.isHemisphereLight){let e=r.hemi[h];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(d),h++}}},state:r}}function go(e,t){let i=new mo(e,t),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(e){i.setup(n,e)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function vo(e,t){let i=new WeakMap;return{get:function(n){let r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=i.get(n);return void 0===a?(r=new go(e,t),i.set(n,[r])):s>=a.length?(r=new go(e,t),a.push(r)):r=a[s],r},dispose:function(){i=new WeakMap}}}var yo=class extends nr{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Vt,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},bo=class extends nr{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new Vi,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},Ao="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",xo="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function wo(e,t,i){let n=new Zr,r=new pi,s=new pi,a=new ki,o=new yo({depthPacking:Gt}),l=new bo,c={},h=i.maxTextureSize,d={[R]:B,[B]:R,[L]:L},u=new Ur({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new pi},radius:{value:4}},vertexShader:Ao,fragmentShader:xo}),p=u.clone();p.defines.HORIZONTAL_PASS=1;let f=new yr;f.setAttribute("position",new or(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new Rr(f,u),g=this;function v(i,n){let s=t.update(m);u.defines.VSM_SAMPLES!==i.blurSamples&&(u.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,u.needsUpdate=!0,p.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new Fi(r.x,r.y)),u.uniforms.shadow_pass.value=i.map.texture,u.uniforms.resolution.value=i.mapSize,u.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,s,u,m,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,s,p,m,null)}function y(t,i,n,r,s,a){let h=null,u=!0===n.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==u)h=u;else if(h=!0===n.isPointLight?l:o,e.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0){let e=h.uuid,t=i.uuid,n=c[e];void 0===n&&(n={},c[e]=n);let r=n[t];void 0===r&&(r=h.clone(),n[t]=r),h=r}return h.visible=i.visible,h.wireframe=i.wireframe,h.side=a===D?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:d[i.side],h.alphaMap=i.alphaMap,h.alphaTest=i.alphaTest,h.map=i.map,h.clipShadows=i.clipShadows,h.clippingPlanes=i.clippingPlanes,h.clipIntersection=i.clipIntersection,h.displacementMap=i.displacementMap,h.displacementScale=i.displacementScale,h.displacementBias=i.displacementBias,h.wireframeLinewidth=i.wireframeLinewidth,h.linewidth=i.linewidth,!0===n.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(n.matrixWorld),h.nearDistance=r,h.farDistance=s),h}function b(i,r,s,a,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&o===D)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);let n=t.update(i),r=i.material;if(Array.isArray(r)){let t=n.groups;for(let l=0,c=t.length;l<c;l++){let c=t[l],h=r[c.materialIndex];if(h&&h.visible){let t=y(i,h,a,s.near,s.far,o);e.renderBufferDirect(s,null,n,t,i,c)}}}else if(r.visible){let t=y(i,r,a,s.near,s.far,o);e.renderBufferDirect(s,null,n,t,i,null)}}let l=i.children;for(let e=0,t=l.length;e<t;e++)b(l[e],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=I,this.render=function(t,i,o){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===t.length)return;let l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),u=e.state;u.setBlending(O),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(let p=0,f=t.length;p<f;p++){let l=t[p],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);let d=c.getFrameExtents();if(r.multiply(d),s.copy(c.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/d.x),r.x=s.x*d.x,c.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/d.y),r.y=s.y*d.y,c.mapSize.y=s.y)),null===c.map){let e=this.type!==D?{minFilter:Te,magFilter:Te}:{};c.map=new Fi(r.x,r.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();let f=c.getViewportCount();for(let e=0;e<f;e++){let t=c.getViewport(e);a.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),u.viewport(a),c.updateMatrices(l,e),n=c.getFrustum(),b(i,o,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===D&&v(c,o),c.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(l,c,d)}}function So(e,t,i){let n=i.isWebGL2;let r=new function(){let t=!1,i=new ki,n=null,r=new ki(0,0,0,0);return{setMask:function(i){n!==i&&!t&&(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,s,a,o){!0===o&&(t*=a,n*=a,s*=a),i.set(t,n,s,a),!1===r.equals(i)&&(e.clearColor(t,n,s,a),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},s=new function(){let t=!1,i=null,n=null,r=null;return{setTest:function(e){e?xe(2929):we(2929)},setMask:function(n){i!==n&&!t&&(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){switch(t){case ne:e.depthFunc(512);break;case re:e.depthFunc(519);break;case se:e.depthFunc(513);break;case ae:e.depthFunc(515);break;case oe:e.depthFunc(514);break;case le:e.depthFunc(518);break;case ce:e.depthFunc(516);break;case he:e.depthFunc(517);break;default:e.depthFunc(515)}n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,i=null,n=null,r=null}}},a=new function(){let t=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(e){t||(e?xe(2960):we(2960))},setMask:function(n){i!==n&&!t&&(e.stencilMask(n),i=n)},setFunc:function(t,i,a){(n!==t||r!==i||s!==a)&&(e.stencilFunc(t,i,a),n=t,r=i,s=a)},setOp:function(t,i,n){(a!==t||o!==i||l!==n)&&(e.stencilOp(t,i,n),a=t,o=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,c=null}}},o=new WeakMap,l=new WeakMap,c={},h={},d=new WeakMap,u=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,A=null,x=null,w=!1,S=null,_=null,E=null,I=null,P=null,D=e.getParameter(35661),R=!1,de=0,ue=e.getParameter(7938);-1!==ue.indexOf("WebGL")?(de=parseFloat(/^WebGL (\d)/.exec(ue)[1]),R=de>=1):-1!==ue.indexOf("OpenGL ES")&&(de=parseFloat(/^OpenGL ES (\d)/.exec(ue)[1]),R=de>=2);let pe=null,fe={},me=e.getParameter(3088),ge=e.getParameter(2978),ve=(new ki).fromArray(me),ye=(new ki).fromArray(ge);function be(t,i,n){let r=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let a=0;a<n;a++)e.texImage2D(i+a,0,6408,1,1,0,6408,5121,r);return s}let Ae={};function xe(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function we(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}Ae[3553]=be(3553,3553,1),Ae[34067]=be(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),a.setClear(0),xe(2929),s.setFunc(ae),Ce(!1),Me(M),xe(2884),Ee(O);let Se={[j]:32774,[V]:32778,[G]:32779};if(n)Se[H]=32775,Se[W]=32776;else{let e=t.get("EXT_blend_minmax");null!==e&&(Se[H]=e.MIN_EXT,Se[W]=e.MAX_EXT)}let _e={[Q]:0,[q]:1,[X]:768,[K]:770,[ie]:776,[ee]:774,[Z]:772,[Y]:769,[J]:771,[te]:775,[$]:773};function Ee(t,i,n,r,s,a,o,l){if(t!==O){if(!1===f&&(xe(3042),f=!0),t===z)s=s||i,a=a||n,o=o||r,(i!==g||s!==b)&&(e.blendEquationSeparate(Se[i],Se[s]),g=i,b=s),(n!==v||r!==y||a!==A||o!==x)&&(e.blendFuncSeparate(_e[n],_e[r],_e[a],_e[o]),v=n,y=r,A=a,x=o),m=t,w=!1;else if(t!==m||l!==w){if((g!==j||b!==j)&&(e.blendEquation(32774),g=j,b=j),l)switch(t){case N:e.blendFuncSeparate(1,771,1,771);break;case k:e.blendFunc(1,1);break;case F:e.blendFuncSeparate(0,769,0,1);break;case U:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case N:e.blendFuncSeparate(770,771,1,771);break;case k:e.blendFunc(770,1);break;case F:e.blendFuncSeparate(0,769,0,1);break;case U:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,A=null,x=null,m=t,w=l}}else!0===f&&(we(3042),f=!1)}function Ce(t){S!==t&&(t?e.frontFace(2304):e.frontFace(2305),S=t)}function Me(t){t!==C?(xe(2884),t!==_&&(t===M?e.cullFace(1029):t===T?e.cullFace(1028):e.cullFace(1032))):we(2884),_=t}function Te(t,i,n){t?(xe(32823),(I!==i||P!==n)&&(e.polygonOffset(i,n),I=i,P=n)):we(32823)}return{buffers:{color:r,depth:s,stencil:a},enable:xe,disable:we,bindFramebuffer:function(t,i){return h[t]!==i&&(e.bindFramebuffer(t,i),h[t]=i,n&&(36009===t&&(h[36160]=i),36160===t&&(h[36009]=i)),!0)},drawBuffers:function(n,r){let s=u,a=!1;if(n)if(s=d.get(r),void 0===s&&(s=[],d.set(r,s)),n.isWebGLMultipleRenderTargets){let e=n.texture;if(s.length!==e.length||36064!==s[0]){for(let t=0,i=e.length;t<i;t++)s[t]=36064+t;s.length=e.length,a=!0}}else 36064!==s[0]&&(s[0]=36064,a=!0);else 1029!==s[0]&&(s[0]=1029,a=!0);a&&(i.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:Ee,setMaterial:function(e,t){e.side===L?we(2884):xe(2884);let i=e.side===B;t&&(i=!i),Ce(i),e.blending===N&&!1===e.transparent?Ee(O):Ee(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);let n=e.stencilWrite;a.setTest(n),n&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Te(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?xe(32926):we(32926)},setFlipSided:Ce,setCullFace:Me,setLineWidth:function(t){t!==E&&(R&&e.lineWidth(t),E=t)},setPolygonOffset:Te,setScissorTest:function(e){e?xe(3089):we(3089)},activeTexture:function(t){void 0===t&&(t=33984+D-1),pe!==t&&(e.activeTexture(t),pe=t)},bindTexture:function(t,i,n){void 0===n&&(n=null===pe?33984+D-1:pe);let r=fe[n];void 0===r&&(r={type:void 0,texture:void 0},fe[n]=r),(r.type!==t||r.texture!==i)&&(pe!==n&&(e.activeTexture(n),pe=n),e.bindTexture(t,i||Ae[t]),r.type=t,r.texture=i)},unbindTexture:function(){let t=fe[pe];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(mH){console.error("THREE.WebGLState:",mH)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(mH){console.error("THREE.WebGLState:",mH)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(mH){console.error("THREE.WebGLState:",mH)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(mH){console.error("THREE.WebGLState:",mH)}},updateUBOMapping:function(t,i){let n=l.get(i);void 0===n&&(n=new WeakMap,l.set(i,n));let r=n.get(t);void 0===r&&(r=e.getUniformBlockIndex(i,t.name),n.set(t,r))},uniformBlockBinding:function(t,i){let n=l.get(i).get(t);o.get(i)!==n&&(e.uniformBlockBinding(i,n,t.__bindingPointIndex),o.set(i,n))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(mH){console.error("THREE.WebGLState:",mH)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(mH){console.error("THREE.WebGLState:",mH)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(mH){console.error("THREE.WebGLState:",mH)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(mH){console.error("THREE.WebGLState:",mH)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(mH){console.error("THREE.WebGLState:",mH)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(mH){console.error("THREE.WebGLState:",mH)}},scissor:function(t){!1===ve.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ve.copy(t))},viewport:function(t){!1===ye.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),ye.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===n&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},pe=null,fe={},h={},d=new WeakMap,u=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,A=null,x=null,w=!1,S=null,_=null,E=null,I=null,P=null,ve.set(0,0,e.canvas.width,e.canvas.height),ye.set(0,0,e.canvas.width,e.canvas.height),r.reset(),s.reset(),a.reset()}}}function _o(e,t,i,n,r,s,a){let o,l=r.isWebGL2,c=r.maxTextures,h=r.maxCubemapSize,d=r.maxTextureSize,u=r.maxSamples,p=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function y(e,t){return v?new OffscreenCanvas(e,t):bi("canvas")}function b(e,t,i,n){let r=1;if((e.width>n||e.height>n)&&(r=n/Math.max(e.width,e.height)),r<1||!0===t){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let n=t?ci:Math.floor,s=n(r*e.width),a=n(r*e.height);void 0===o&&(o=y(s,a));let l=i?y(s,a):o;return l.width=s,l.height=a,l.getContext("2d").drawImage(e,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+a+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function A(e){return oi(e.width)&&oi(e.height)}function x(e,t){return e.generateMipmaps&&t&&e.minFilter!==Te&&e.minFilter!==De}function w(t){e.generateMipmap(t)}function S(i,n,r,s){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===l)return n;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=n;return 6403===n&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),33319===n&&(5126===r&&(o=33328),5131===r&&(o=33327),5121===r&&(o=33323)),6408===n&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=s===jt&&!1===a?35907:32856),32819===r&&(o=32854),32820===r&&(o=32855)),(33325===o||33326===o||33327===o||33328===o||34842===o||34836===o)&&t.get("EXT_color_buffer_float"),o}function _(e,t,i){return!0===x(e,i)||e.isFramebufferTexture&&e.minFilter!==Te&&e.minFilter!==De?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function E(e){return e===Te||e===Ie||e===Pe?9728:9729}function C(e){let t=e.target;t.removeEventListener("dispose",C),function(e){let t=n.get(e);if(void 0===t.__webglInit)return;let i=e.source,r=g.get(i);if(r){let n=r[t.__cacheKey];n.usedTimes--,0===n.usedTimes&&T(e),0===Object.keys(r).length&&g.delete(i)}n.remove(e)}(t),t.isVideoTexture&&m.delete(t)}function M(t){let i=t.target;i.removeEventListener("dispose",M),function(t){let i=t.texture,r=n.get(t),s=n.get(i);if(void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),a.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let n=0;n<6;n++)e.deleteFramebuffer(r.__webglFramebuffer[n]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[n]);else{if(e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let o=0,l=i.length;o<l;o++){let t=n.get(i[o]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),a.memory.textures--),n.remove(i[o])}n.remove(i),n.remove(t)}(i)}function T(t){let i=n.get(t);e.deleteTexture(i.__webglTexture);let r=t.source;delete g.get(r)[i.__cacheKey],a.memory.textures--}let I=0;function P(e,t){let r=n.get(e);if(e.isVideoTexture&&function(e){let t=a.render.frame;m.get(e)!==t&&(m.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){let i=e.image;if(null===i)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==i.complete)return void O(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(3553,r.__webglTexture,33984+t)}let D={[Ee]:10497,[Ce]:33071,[Me]:33648},R={[Te]:9728,[Ie]:9984,[Pe]:9986,[De]:9729,[Re]:9985,[Be]:9987};function B(i,s,a){if(a?(e.texParameteri(i,10242,D[s.wrapS]),e.texParameteri(i,10243,D[s.wrapT]),(32879===i||35866===i)&&e.texParameteri(i,32882,D[s.wrapR]),e.texParameteri(i,10240,R[s.magFilter]),e.texParameteri(i,10241,R[s.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),(32879===i||35866===i)&&e.texParameteri(i,32882,33071),(s.wrapS!==Ce||s.wrapT!==Ce)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,E(s.magFilter)),e.texParameteri(i,10241,E(s.minFilter)),s.minFilter!==Te&&s.minFilter!==De&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){let a=t.get("EXT_texture_filter_anisotropic");if(s.magFilter===Te||s.minFilter!==Pe&&s.minFilter!==Be||s.type===ze&&!1===t.has("OES_texture_float_linear")||!1===l&&s.type===je&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(e.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function L(t,i){let n=!1;void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",C));let r=i.source,s=g.get(r);void 0===s&&(s={},g.set(r,s));let o=function(e){let t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(i);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,n=!0),s[o].usedTimes++;let r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&T(i)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return n}function O(t,r,a){let o=3553;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(o=35866),r.isData3DTexture&&(o=32879);let c=L(t,r),h=r.source;i.bindTexture(o,t.__webglTexture,33984+a);let u=n.get(h);if(h.version!==u.__version||!0===c){i.activeTexture(33984+a),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);let t=function(e){return!l&&(e.wrapS!==Ce||e.wrapT!==Ce||e.minFilter!==Te&&e.minFilter!==De)}(r)&&!1===A(r.image),n=b(r.image,t,!1,d);n=j(r,n);let p=A(n)||l,f=s.convert(r.format,r.encoding),m=s.convert(r.type),g=S(r.internalFormat,f,m,r.encoding,r.isVideoTexture);B(o,r,p);let v,y=r.mipmaps,E=l&&!0!==r.isVideoTexture,C=void 0===u.__version||!0===c,M=_(r,n,p);if(r.isDepthTexture)g=6402,l?g=r.type===ze?36012:r.type===Ue?33190:r.type===He?35056:33189:r.type===ze&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Ye&&6402===g&&r.type!==ke&&r.type!==Ue&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Ue,m=s.convert(r.type)),r.format===Ke&&6402===g&&(g=34041,r.type!==He&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=He,m=s.convert(r.type))),C&&(E?i.texStorage2D(3553,1,g,n.width,n.height):i.texImage2D(3553,0,g,n.width,n.height,0,f,m,null));else if(r.isDataTexture)if(y.length>0&&p){E&&C&&i.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let e=0,t=y.length;e<t;e++)v=y[e],E?i.texSubImage2D(3553,e,0,0,v.width,v.height,f,m,v.data):i.texImage2D(3553,e,g,v.width,v.height,0,f,m,v.data);r.generateMipmaps=!1}else E?(C&&i.texStorage2D(3553,M,g,n.width,n.height),i.texSubImage2D(3553,0,0,0,n.width,n.height,f,m,n.data)):i.texImage2D(3553,0,g,n.width,n.height,0,f,m,n.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){E&&C&&i.texStorage3D(35866,M,g,y[0].width,y[0].height,n.depth);for(let e=0,t=y.length;e<t;e++)v=y[e],r.format!==Qe?null!==f?E?i.compressedTexSubImage3D(35866,e,0,0,0,v.width,v.height,n.depth,f,v.data,0,0):i.compressedTexImage3D(35866,e,g,v.width,v.height,n.depth,0,v.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?i.texSubImage3D(35866,e,0,0,0,v.width,v.height,n.depth,f,m,v.data):i.texImage3D(35866,e,g,v.width,v.height,n.depth,0,f,m,v.data)}else{E&&C&&i.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let e=0,t=y.length;e<t;e++)v=y[e],r.format!==Qe?null!==f?E?i.compressedTexSubImage2D(3553,e,0,0,v.width,v.height,f,v.data):i.compressedTexImage2D(3553,e,g,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?i.texSubImage2D(3553,e,0,0,v.width,v.height,f,m,v.data):i.texImage2D(3553,e,g,v.width,v.height,0,f,m,v.data)}else if(r.isDataArrayTexture)E?(C&&i.texStorage3D(35866,M,g,n.width,n.height,n.depth),i.texSubImage3D(35866,0,0,0,0,n.width,n.height,n.depth,f,m,n.data)):i.texImage3D(35866,0,g,n.width,n.height,n.depth,0,f,m,n.data);else if(r.isData3DTexture)E?(C&&i.texStorage3D(32879,M,g,n.width,n.height,n.depth),i.texSubImage3D(32879,0,0,0,0,n.width,n.height,n.depth,f,m,n.data)):i.texImage3D(32879,0,g,n.width,n.height,n.depth,0,f,m,n.data);else if(r.isFramebufferTexture){if(C)if(E)i.texStorage2D(3553,M,g,n.width,n.height);else{let e=n.width,t=n.height;for(let n=0;n<M;n++)i.texImage2D(3553,n,g,e,t,0,f,m,null),e>>=1,t>>=1}}else if(y.length>0&&p){E&&C&&i.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let e=0,t=y.length;e<t;e++)v=y[e],E?i.texSubImage2D(3553,e,0,0,f,m,v):i.texImage2D(3553,e,g,f,m,v);r.generateMipmaps=!1}else E?(C&&i.texStorage2D(3553,M,g,n.width,n.height),i.texSubImage2D(3553,0,0,0,f,m,n)):i.texImage2D(3553,0,g,f,m,n);x(r,p)&&w(o),u.__version=h.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function N(t,r,a,o,l){let c=s.convert(a.format,a.encoding),h=s.convert(a.type),d=S(a.internalFormat,c,h,a.encoding);n.get(r).__hasExternalTextures||(32879===l||35866===l?i.texImage3D(l,0,d,r.width,r.height,r.depth,0,c,h,null):i.texImage2D(l,0,d,r.width,r.height,0,c,h,null)),i.bindFramebuffer(36160,t),z(r)?p.framebufferTexture2DMultisampleEXT(36160,o,l,n.get(a).__webglTexture,0,U(r)):(3553===l||l>=34069&&l<=34074)&&e.framebufferTexture2D(36160,o,l,n.get(a).__webglTexture,0),i.bindFramebuffer(36160,null)}function k(t,i,n){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n||z(i)){let t=i.depthTexture;t&&t.isDepthTexture&&(t.type===ze?r=36012:t.type===Ue&&(r=33190));let n=U(i);z(i)?p.renderbufferStorageMultisampleEXT(36161,n,r,i.width,i.height):e.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else e.renderbufferStorage(36161,r,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){let r=U(i);n&&!1===z(i)?e.renderbufferStorageMultisample(36161,r,35056,i.width,i.height):z(i)?p.renderbufferStorageMultisampleEXT(36161,r,35056,i.width,i.height):e.renderbufferStorage(36161,34041,i.width,i.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{let t=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let r=0;r<t.length;r++){let a=t[r],o=s.convert(a.format,a.encoding),l=s.convert(a.type),c=S(a.internalFormat,o,l,a.encoding),h=U(i);n&&!1===z(i)?e.renderbufferStorageMultisample(36161,h,c,i.width,i.height):z(i)?p.renderbufferStorageMultisampleEXT(36161,h,c,i.width,i.height):e.renderbufferStorage(36161,c,i.width,i.height)}}e.bindRenderbuffer(36161,null)}function F(t){let r=n.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(r.depthTexture).__webglTexture||r.depthTexture.image.width!==r.width||r.depthTexture.image.height!==r.height)&&(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),P(r.depthTexture,0);let s=n.get(r.depthTexture).__webglTexture,a=U(r);if(r.depthTexture.format===Ye)z(r)?p.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,a):e.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==Ke)throw new Error("Unknown depthTexture format");z(r)?p.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,a):e.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=e.createRenderbuffer(),k(r.__webglDepthbuffer[n],t,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),k(r.__webglDepthbuffer,t,!1);i.bindFramebuffer(36160,null)}function U(e){return Math.min(u,e.samples)}function z(e){let i=n.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function j(e,i){let n=e.encoding,r=e.format,s=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Jt||n!==zt&&(n===jt?!1===l?!0===t.has("EXT_sRGB")&&r===Qe?(e.format=Jt,e.minFilter=De,e.generateMipmaps=!1):i=Ri.sRGBToLinear(i):(r!==Qe||s!==Le)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}this.allocateTextureUnit=function(){let e=I;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),I+=1,e},this.resetTextureUnits=function(){I=0},this.setTexture2D=P,this.setTexture2DArray=function(e,t){let r=n.get(e);e.version>0&&r.__version!==e.version?O(r,e,t):i.bindTexture(35866,r.__webglTexture,33984+t)},this.setTexture3D=function(e,t){let r=n.get(e);e.version>0&&r.__version!==e.version?O(r,e,t):i.bindTexture(32879,r.__webglTexture,33984+t)},this.setTextureCube=function(t,r){let a=n.get(t);t.version>0&&a.__version!==t.version?function(t,r,a){if(6!==r.image.length)return;let o=L(t,r),c=r.source;i.bindTexture(34067,t.__webglTexture,33984+a);let d=n.get(c);if(c.version!==d.__version||!0===o){i.activeTexture(33984+a),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);let t=r.isCompressedTexture||r.image[0].isCompressedTexture,n=r.image[0]&&r.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=t||n?n?r.image[e].image:r.image[e]:b(r.image[e],!1,!0,h),u[e]=j(r,u[e]);let p,f=u[0],m=A(f)||l,g=s.convert(r.format,r.encoding),v=s.convert(r.type),y=S(r.internalFormat,g,v,r.encoding),E=l&&!0!==r.isVideoTexture,C=void 0===d.__version||!0===o,M=_(r,f,m);if(B(34067,r,m),t){E&&C&&i.texStorage2D(34067,M,y,f.width,f.height);for(let e=0;e<6;e++){p=u[e].mipmaps;for(let t=0;t<p.length;t++){let n=p[t];r.format!==Qe?null!==g?E?i.compressedTexSubImage2D(34069+e,t,0,0,n.width,n.height,g,n.data):i.compressedTexImage2D(34069+e,t,y,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):E?i.texSubImage2D(34069+e,t,0,0,n.width,n.height,g,v,n.data):i.texImage2D(34069+e,t,y,n.width,n.height,0,g,v,n.data)}}}else{p=r.mipmaps,E&&C&&(p.length>0&&M++,i.texStorage2D(34067,M,y,u[0].width,u[0].height));for(let e=0;e<6;e++)if(n){E?i.texSubImage2D(34069+e,0,0,0,u[e].width,u[e].height,g,v,u[e].data):i.texImage2D(34069+e,0,y,u[e].width,u[e].height,0,g,v,u[e].data);for(let t=0;t<p.length;t++){let n=p[t].image[e].image;E?i.texSubImage2D(34069+e,t+1,0,0,n.width,n.height,g,v,n.data):i.texImage2D(34069+e,t+1,y,n.width,n.height,0,g,v,n.data)}}else{E?i.texSubImage2D(34069+e,0,0,0,g,v,u[e]):i.texImage2D(34069+e,0,y,g,v,u[e]);for(let t=0;t<p.length;t++){let n=p[t];E?i.texSubImage2D(34069+e,t+1,0,0,g,v,n.image[e]):i.texImage2D(34069+e,t+1,y,g,v,n.image[e])}}}x(r,m)&&w(34067),d.__version=c.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(a,t,r):i.bindTexture(34067,a.__webglTexture,33984+r)},this.rebindTextures=function(e,t,i){let r=n.get(e);void 0!==t&&N(r.__webglFramebuffer,e,e.texture,36064,3553),void 0!==i&&F(e)},this.setupRenderTarget=function(t){let o=t.texture,c=n.get(t),h=n.get(o);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=e.createTexture()),h.__version=o.version,a.memory.textures++);let d=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultipleRenderTargets,p=A(t)||l;if(d){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(c.__webglFramebuffer=e.createFramebuffer(),u)if(r.drawBuffers){let i=t.texture;for(let t=0,r=i.length;t<r;t++){let r=n.get(i[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&t.samples>0&&!1===z(t)){let n=u?o:[o];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer);for(let i=0;i<n.length;i++){let r=n[i];c.__webglColorRenderbuffer[i]=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer[i]);let a=s.convert(r.format,r.encoding),o=s.convert(r.type),l=S(r.internalFormat,a,o,r.encoding,!0===t.isXRRenderTarget),h=U(t);e.renderbufferStorageMultisample(36161,h,l,t.width,t.height),e.framebufferRenderbuffer(36160,36064+i,36161,c.__webglColorRenderbuffer[i])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),k(c.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(36160,null)}}if(d){i.bindTexture(34067,h.__webglTexture),B(34067,o,p);for(let e=0;e<6;e++)N(c.__webglFramebuffer[e],t,o,36064,34069+e);x(o,p)&&w(34067),i.unbindTexture()}else if(u){let e=t.texture;for(let r=0,s=e.length;r<s;r++){let s=e[r],a=n.get(s);i.bindTexture(3553,a.__webglTexture),B(3553,s,p),N(c.__webglFramebuffer,t,s,36064+r,3553),x(s,p)&&w(3553)}i.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(e,h.__webglTexture),B(e,o,p),N(c.__webglFramebuffer,t,o,36064,e),x(o,p)&&w(e),i.unbindTexture()}t.depthBuffer&&F(t)},this.updateRenderTargetMipmap=function(e){let t=A(e)||l,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let s=0,a=r.length;s<a;s++){let a=r[s];if(x(a,t)){let t=e.isWebGLCubeRenderTarget?34067:3553,r=n.get(a).__webglTexture;i.bindTexture(t,r),w(t),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(l&&t.samples>0&&!1===z(t)){let r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,a=t.height,o=16384,l=[],c=t.stencilBuffer?33306:36096,h=n.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(let t=0;t<r.length;t++)i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),i.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);i.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,h.__webglFramebuffer);for(let i=0;i<r.length;i++){l.push(36064+i),t.depthBuffer&&l.push(c);let u=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===u&&(t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024)),d&&e.framebufferRenderbuffer(36008,36064,36161,h.__webglColorRenderbuffer[i]),!0===u&&(e.invalidateFramebuffer(36008,[c]),e.invalidateFramebuffer(36009,[c])),d){let t=n.get(r[i]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,s,a,0,0,s,a,o,9728),f&&e.invalidateFramebuffer(36008,l)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),d)for(let t=0;t<r.length;t++){i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,h.__webglColorRenderbuffer[t]);let s=n.get(r[t]).__webglTexture;i.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,s,0)}i.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=N,this.useMultisampledRTT=z}function Eo(e,t,i){let n=i.isWebGL2;return{convert:function(i){let r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(i===Le)return 5121;if(i===Ve)return 32819;if(i===Ge)return 32820;if(i===Oe)return 5120;if(i===Ne)return 5122;if(i===ke)return 5123;if(i===Fe)return 5124;if(i===Ue)return 5125;if(i===ze)return 5126;if(i===je)return n?5131:(r=t.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(i===We)return 6406;if(i===Qe)return 6408;if(i===qe)return 6409;if(i===Xe)return 6410;if(i===Ye)return 6402;if(i===Ke)return 34041;if(i===Jt)return r=t.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(i===Je)return 6403;if(i===Ze)return 36244;if(i===$e)return 33319;if(i===et)return 33320;if(i===tt)return 36249;if(i===it||i===nt||i===rt||i===st)if(s===jt){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(i===it)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===nt)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===rt)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===st)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(i===it)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===nt)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===rt)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===st)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===at||i===ot||i===lt||i===ct){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(i===at)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===ot)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===lt)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===ct)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===ht)return r=t.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===dt||i===ut){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(i===dt)return s===jt?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(i===ut)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(i===pt||i===ft||i===mt||i===gt||i===vt||i===yt||i===bt||i===At||i===xt||i===wt||i===St||i===_t||i===Et||i===Ct){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(i===pt)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===ft)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===mt)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===gt)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===vt)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===yt)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===bt)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===At)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===xt)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===wt)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===St)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===_t)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Et)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===Ct)return s===jt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===Mt){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(i===Mt)return s===jt?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(i===Tt||i===It||i===Pt||i===Dt){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(i===Mt)return r.COMPRESSED_RED_RGTC1_EXT;if(i===It)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Pt)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===Dt)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===He?n?34042:(r=t.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[i]?e[i]:null}}}var Co=class extends jr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=e}},Mo=class extends Hn{constructor(){super(),this.isGroup=!0,this.type="Group"}},To={type:"move"},Io=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Mo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Mo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vi,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vi),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Mo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vi,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vi),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(let s of e.hand.values()){let e=t.getJointPose(s,i),n=this._getHandJoint(l,s);null!==e&&(n.matrix.fromArray(e.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.jointRadius=e.radius),n.visible=null!==e}let n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=n.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(n=t.getPose(e.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(To)))}return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){let i=new Mo;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},Po=class extends Ni{constructor(e,t,i,n,r,s,a,o,l,c){if((c=void 0!==c?c:Ye)!==Ye&&c!==Ke)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Ye&&(i=Ue),void 0===i&&c===Ke&&(i=He),super(null,n,r,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:Te,this.minFilter=void 0!==o?o:Te,this.flipY=!1,this.generateMipmaps=!1}},Do=class extends Zt{constructor(e,t){super();let i=this,n=null,r=1,s=null,a="local-floor",o=1,l=null,c=null,h=null,d=null,u=null,p=null,f=t.getContextAttributes(),m=null,g=null,v=[],y=[],b=new Set,A=new Map,x=new jr;x.layers.enable(1),x.viewport=new ki;let w=new jr;w.layers.enable(2),w.viewport=new ki;let S=[x,w],_=new Co;_.layers.enable(1),_.layers.enable(2);let E=null,C=null;function M(e){let t=y.indexOf(e.inputSource);if(-1===t)return;let i=v[t];void 0!==i&&i.dispatchEvent({type:e.type,data:e.inputSource})}function T(){n.removeEventListener("select",M),n.removeEventListener("selectstart",M),n.removeEventListener("selectend",M),n.removeEventListener("squeeze",M),n.removeEventListener("squeezestart",M),n.removeEventListener("squeezeend",M),n.removeEventListener("end",T),n.removeEventListener("inputsourceschange",I);for(let e=0;e<v.length;e++){let t=y[e];null!==t&&(y[e]=null,v[e].disconnect(t))}E=null,C=null,e.setRenderTarget(m),u=null,d=null,h=null,n=null,g=null,L.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function I(e){for(let t=0;t<e.removed.length;t++){let i=e.removed[t],n=y.indexOf(i);n>=0&&(y[n]=null,v[n].disconnect(i))}for(let t=0;t<e.added.length;t++){let i=e.added[t],n=y.indexOf(i);if(-1===n){for(let e=0;e<v.length;e++){if(e>=y.length){y.push(i),n=e;break}if(null===y[e]){y[e]=i,n=e;break}}if(-1===n)break}let r=v[n];r&&r.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new Io,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new Io,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new Io,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:u},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(c){if(n=c,null!==n){if(m=e.getRenderTarget(),n.addEventListener("select",M),n.addEventListener("selectstart",M),n.addEventListener("selectend",M),n.addEventListener("squeeze",M),n.addEventListener("squeezestart",M),n.addEventListener("squeezeend",M),n.addEventListener("end",T),n.addEventListener("inputsourceschange",I),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===n.renderState.layers||!1===e.capabilities.isWebGL2){let i={antialias:void 0!==n.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(n,t,i),n.updateRenderState({baseLayer:u}),g=new Fi(u.framebufferWidth,u.framebufferHeight,{format:Qe,type:Le,encoding:e.outputEncoding,stencilBuffer:f.stencil})}else{let i=null,s=null,a=null;f.depth&&(a=f.stencil?35056:33190,i=f.stencil?Ke:Ye,s=f.stencil?He:Ue);let o={colorFormat:32856,depthFormat:a,scaleFactor:r};h=new XRWebGLBinding(n,t),d=h.createProjectionLayer(o),n.updateRenderState({layers:[d]}),g=new Fi(d.textureWidth,d.textureHeight,{format:Qe,type:Le,depthTexture:new Po(d.textureWidth,d.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await n.requestReferenceSpace(a),L.setContext(n),L.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};let P=new Vi,D=new Vi;function R(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===n)return;_.near=w.near=x.near=e.near,_.far=w.far=x.far=e.far,(E!==_.near||C!==_.far)&&(n.updateRenderState({depthNear:_.near,depthFar:_.far}),E=_.near,C=_.far);let t=e.parent,i=_.cameras;R(_,t);for(let n=0;n<i.length;n++)R(i[n],t);_.matrixWorld.decompose(_.position,_.quaternion,_.scale),e.matrix.copy(_.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);let r=e.children;for(let n=0,s=r.length;n<s;n++)r[n].updateMatrixWorld(!0);2===i.length?function(e,t,i){P.setFromMatrixPosition(t.matrixWorld),D.setFromMatrixPosition(i.matrixWorld);let n=P.distanceTo(D),r=t.projectionMatrix.elements,s=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],d=(s[8]+1)/s[0],u=a*h,p=a*d,f=n/(-h+d),m=f*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();let g=a+f,v=o+f,y=u-m,b=p+(n-m),A=l*o/v*g,x=c*o/v*g;e.projectionMatrix.makePerspective(y,b,A,x,g,v)}(_,x,w):_.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return _},this.getFoveation=function(){if(null!==d||null!==u)return o},this.setFoveation=function(e){o=e,null!==d&&(d.fixedFoveation=e),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=e)},this.getPlanes=function(){return b};let B=null;let L=new $r;L.setAnimationLoop((function(t,n){if(c=n.getViewerPose(l||s),p=n,null!==c){let t=c.views;null!==u&&(e.setRenderTargetFramebuffer(g,u.framebuffer),e.setRenderTarget(g));let i=!1;t.length!==_.cameras.length&&(_.cameras.length=0,i=!0);for(let n=0;n<t.length;n++){let r=t[n],s=null;if(null!==u)s=u.getViewport(r);else{let t=h.getViewSubImage(d,r);s=t.viewport,0===n&&(e.setRenderTargetTextures(g,t.colorTexture,d.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let a=S[n];void 0===a&&(a=new jr,a.layers.enable(n),a.viewport=new ki,S[n]=a),a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===n&&_.matrix.copy(a.matrix),!0===i&&_.cameras.push(a)}}for(let e=0;e<v.length;e++){let t=y[e],i=v[e];null!==t&&void 0!==i&&i.update(t,n,l||s)}if(B&&B(t,n),n.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:n.detectedPlanes});let e=null;for(let t of b)n.detectedPlanes.has(t)||(null===e&&(e=[]),e.push(t));if(null!==e)for(let t of e)b.delete(t),A.delete(t),i.dispatchEvent({type:"planeremoved",data:t});for(let t of n.detectedPlanes)if(b.has(t)){let e=A.get(t);t.lastChangedTime>e&&(A.set(t,t.lastChangedTime),i.dispatchEvent({type:"planechanged",data:t}))}else b.add(t),A.set(t,n.lastChangedTime),i.dispatchEvent({type:"planeadded",data:t})}p=null})),this.setAnimationLoop=function(e){B=e},this.dispose=function(){}}};function Ro(e,t){function i(i,n){i.opacity.value=n.opacity,n.color&&i.diffuse.value.copy(n.color),n.emissive&&i.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(i.map.value=n.map),n.alphaMap&&(i.alphaMap.value=n.alphaMap),n.bumpMap&&(i.bumpMap.value=n.bumpMap,i.bumpScale.value=n.bumpScale,n.side===B&&(i.bumpScale.value*=-1)),n.displacementMap&&(i.displacementMap.value=n.displacementMap,i.displacementScale.value=n.displacementScale,i.displacementBias.value=n.displacementBias),n.emissiveMap&&(i.emissiveMap.value=n.emissiveMap),n.normalMap&&(i.normalMap.value=n.normalMap,i.normalScale.value.copy(n.normalScale),n.side===B&&i.normalScale.value.negate()),n.specularMap&&(i.specularMap.value=n.specularMap),n.alphaTest>0&&(i.alphaTest.value=n.alphaTest);let r,s,a=t.get(n).envMap;if(a&&(i.envMap.value=a,i.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,i.reflectivity.value=n.reflectivity,i.ior.value=n.ior,i.refractionRatio.value=n.refractionRatio),n.lightMap){i.lightMap.value=n.lightMap;let t=!0!==e.physicallyCorrectLights?Math.PI:1;i.lightMapIntensity.value=n.lightMapIntensity*t}n.aoMap&&(i.aoMap.value=n.aoMap,i.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap?r=n.clearcoatRoughnessMap:n.iridescenceMap?r=n.iridescenceMap:n.iridescenceThicknessMap?r=n.iridescenceThicknessMap:n.specularIntensityMap?r=n.specularIntensityMap:n.specularColorMap?r=n.specularColorMap:n.transmissionMap?r=n.transmissionMap:n.thicknessMap?r=n.thicknessMap:n.sheenColorMap?r=n.sheenColorMap:n.sheenRoughnessMap&&(r=n.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),i.uvTransform.value.copy(r.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),i.uv2Transform.value.copy(s.matrix))}return{refreshFogUniforms:function(t,i){i.color.getRGB(t.fogColor.value,kr(e)),i.isFog?(t.fogNear.value=i.near,t.fogFar.value=i.far):i.isFogExp2&&(t.fogDensity.value=i.density)},refreshMaterialUniforms:function(e,n,r,s,a){n.isMeshBasicMaterial||n.isMeshLambertMaterial?i(e,n):n.isMeshToonMaterial?(i(e,n),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,n)):n.isMeshPhongMaterial?(i(e,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,n)):n.isMeshStandardMaterial?(i(e,n),function(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}(e,n),n.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap)),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===B&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap)),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,n,a)):n.isMeshMatcapMaterial?(i(e,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,n)):n.isMeshDepthMaterial?i(e,n):n.isMeshDistanceMaterial?(i(e,n),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,n)):n.isMeshNormalMaterial?i(e,n):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,n)):n.isPointsMaterial?function(e,t,i,n){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*n,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,n,r,s):n.isSpriteMaterial?function(e,t){let i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,n):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Bo(e,t,i,n){let r={},s={},a=[],o=i.isWebGL2?e.getParameter(35375):0;function l(e,t,i){let n=e.value;if(void 0===i[t]){if("number"==typeof n)i[t]=n;else{let e=Array.isArray(n)?n:[n],r=[];for(let t=0;t<e.length;t++)r.push(e[t].clone());i[t]=r}return!0}if("number"==typeof n){if(i[t]!==n)return i[t]=n,!0}else{let e=Array.isArray(i[t])?i[t]:[i[t]],r=Array.isArray(n)?n:[n];for(let t=0;t<e.length;t++){let i=e[t];if(!1===i.equals(r[t]))return i.copy(r[t]),!0}}return!1}function c(e){let t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function h(t){let i=t.target;i.removeEventListener("dispose",h);let n=a.indexOf(i.__bindingPointIndex);a.splice(n,1),e.deleteBuffer(r[i.id]),delete r[i.id],delete s[i.id]}return{bind:function(e,t){let i=t.program;n.uniformBlockBinding(e,i)},update:function(i,d){let u=r[i.id];void 0===u&&(function(e){let t=e.uniforms,i=0,n=16,r=0;for(let s=0,a=t.length;s<a;s++){let e=t[s],a={boundary:0,storage:0},o=Array.isArray(e.value)?e.value:[e.value];for(let t=0,i=o.length;t<i;t++){let e=c(o[t]);a.boundary+=e.boundary,a.storage+=e.storage}if(e.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=i,s>0){r=i%n,0!==r&&n-r-a.boundary<0&&(i+=n-r,e.__offset=i)}i+=a.storage}r=i%n,r>0&&(i+=n-r),e.__size=i,e.__cache={}}(i),u=function(t){let i=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=i;let n=e.createBuffer(),r=t.__size,s=t.usage;return e.bindBuffer(35345,n),e.bufferData(35345,r,s),e.bindBuffer(35345,null),e.bindBufferBase(35345,i,n),n}(i),r[i.id]=u,i.addEventListener("dispose",h));let p=d.program;n.updateUBOMapping(i,p);let f=t.render.frame;s[i.id]!==f&&(function(t){let i=r[t.id],n=t.uniforms,s=t.__cache;e.bindBuffer(35345,i);for(let r=0,a=n.length;r<a;r++){let t=n[r];if(!0===l(t,r,s)){let i=t.__offset,n=Array.isArray(t.value)?t.value:[t.value],r=0;for(let s=0;s<n.length;s++){let a=n[s],o=c(a);"number"==typeof a?(t.__data[0]=a,e.bufferSubData(35345,i+r,t.__data)):a.isMatrix3?(t.__data[0]=a.elements[0],t.__data[1]=a.elements[1],t.__data[2]=a.elements[2],t.__data[3]=a.elements[0],t.__data[4]=a.elements[3],t.__data[5]=a.elements[4],t.__data[6]=a.elements[5],t.__data[7]=a.elements[0],t.__data[8]=a.elements[6],t.__data[9]=a.elements[7],t.__data[10]=a.elements[8],t.__data[11]=a.elements[0]):(a.toArray(t.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,i,t.__data)}}e.bindBuffer(35345,null)}(i),s[i.id]=f)},dispose:function(){for(let t in r)e.deleteBuffer(r[t]);a=[],r={},s={}}}}function Lo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isWebGLRenderer=!0;let t,i=void 0!==e.canvas?e.canvas:function(){let e=bi("canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,o=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;t=null!==n?n.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let d=null,u=null,p=[],f=[];this.domElement=i,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=zt,this.physicallyCorrectLights=!1,this.toneMapping=fe,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,b=null,A=-1,w=null,S=new ki,_=new ki,E=null,C=i.width,M=i.height,T=1,I=null,P=null,D=new ki(0,0,C,M),O=new ki(0,0,C,M),N=!1,k=new Zr,F=!1,U=!1,z=null,j=new bn,V=new pi,G=new Vi,H={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function W(){return null===b?T:1}let Q,q,X,Y,K,J,Z,$,ee,te,ie,ne,re,se,ae,oe,le,ce,he,de,ue,pe,me,ge,ve=n;function ye(e,t){for(let n=0;n<e.length;n++){let r=e[n],s=i.getContext(r,t);if(null!==s)return s}return null}try{let e={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${x}`),i.addEventListener("webglcontextlost",xe,!1),i.addEventListener("webglcontextrestored",we,!1),i.addEventListener("webglcontextcreationerror",Se,!1),null===ve){let t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),ve=ye(t,e),null===ve)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ve.getShaderPrecisionFormat&&(ve.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ke){throw console.error("THREE.WebGLRenderer: "+ke.message),ke}function be(){Q=new Ts(ve),q=new cs(ve,Q,e),Q.init(q),pe=new Eo(ve,Q,q),X=new So(ve,Q,q),Y=new Ds,K=new ao,J=new _o(ve,Q,X,K,q,pe,Y),Z=new ds(m),$=new Ms(m),ee=new es(ve,q),me=new os(ve,Q,ee,q),te=new Is(ve,ee,Y,me),ie=new Os(ve,te,ee,Y),he=new Ls(ve,q,J),oe=new hs(K),ne=new so(m,Z,$,Q,q,me,oe),re=new Ro(m,K),se=new ho,ae=new vo(Q,q),ce=new as(m,Z,$,X,ie,t,o),le=new wo(m,ie,q),ge=new Bo(ve,Y,q,X),de=new ls(ve,Q,Y,q),ue=new Ps(ve,Q,Y,q),Y.programs=ne.programs,m.capabilities=q,m.extensions=Q,m.properties=K,m.renderLists=se,m.shadowMap=le,m.state=X,m.info=Y}be();let Ae=new Do(m,ve);function xe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function we(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let e=Y.autoReset,t=le.enabled,i=le.autoUpdate,n=le.needsUpdate,r=le.type;be(),Y.autoReset=e,le.enabled=t,le.autoUpdate=i,le.needsUpdate=n,le.type=r}function Se(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function _e(e){let t=e.target;t.removeEventListener("dispose",_e),function(e){(function(e){let t=K.get(e).programs;void 0!==t&&(t.forEach((function(e){ne.releaseProgram(e)})),e.isShaderMaterial&&ne.releaseShaderCache(e))})(e),K.remove(e)}(t)}this.xr=Ae,this.getContext=function(){return ve},this.getContextAttributes=function(){return ve.getContextAttributes()},this.forceContextLoss=function(){let e=Q.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=Q.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return T},this.setPixelRatio=function(e){void 0!==e&&(T=e,this.setSize(C,M,!1))},this.getSize=function(e){return e.set(C,M)},this.setSize=function(e,t,n){Ae.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(C=e,M=t,i.width=Math.floor(e*T),i.height=Math.floor(t*T),!1!==n&&(i.style.width=e+"px",i.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(C*T,M*T).floor()},this.setDrawingBufferSize=function(e,t,n){C=e,M=t,T=n,i.width=Math.floor(e*n),i.height=Math.floor(t*n),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(S)},this.getViewport=function(e){return e.copy(D)},this.setViewport=function(e,t,i,n){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,i,n),X.viewport(S.copy(D).multiplyScalar(T).floor())},this.getScissor=function(e){return e.copy(O)},this.setScissor=function(e,t,i,n){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,i,n),X.scissor(_.copy(O).multiplyScalar(T).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(e){X.setScissorTest(N=e)},this.setOpaqueSort=function(e){I=e},this.setTransparentSort=function(e){P=e},this.getClearColor=function(e){return e.copy(ce.getClearColor())},this.setClearColor=function(){ce.setClearColor.apply(ce,arguments)},this.getClearAlpha=function(){return ce.getClearAlpha()},this.setClearAlpha=function(){ce.setClearAlpha.apply(ce,arguments)},this.clear=function(){let e=0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(e|=16384),(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(e|=256),(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(e|=1024),ve.clear(e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",xe,!1),i.removeEventListener("webglcontextrestored",we,!1),i.removeEventListener("webglcontextcreationerror",Se,!1),se.dispose(),ae.dispose(),K.dispose(),Z.dispose(),$.dispose(),ie.dispose(),me.dispose(),ge.dispose(),ne.dispose(),Ae.dispose(),Ae.removeEventListener("sessionstart",Ce),Ae.removeEventListener("sessionend",Me),z&&(z.dispose(),z=null),Te.stop()},this.renderBufferDirect=function(e,t,i,n,r,s){null===t&&(t=H);let a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(e,t,i,n,r){!0!==t.isScene&&(t=H),J.resetTextureUnits();let s=t.fog,a=n.isMeshStandardMaterial?t.environment:null,o=null===b?m.outputEncoding:!0===b.isXRRenderTarget?b.texture.encoding:zt,l=(n.isMeshStandardMaterial?$:Z).get(n.envMap||a),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!n.normalMap&&!!i.attributes.tangent,d=!!i.morphAttributes.position,p=!!i.morphAttributes.normal,f=!!i.morphAttributes.color,g=n.toneMapped?m.toneMapping:fe,v=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,y=void 0!==v?v.length:0,x=K.get(n),S=u.state.lights;if(!0===F&&(!0===U||e!==w)){let t=e===w&&n.id===A;oe.setState(n,e,t)}let _=!1;n.version===x.__version?(x.needsLights&&x.lightsStateVersion!==S.state.version||x.outputEncoding!==o||r.isInstancedMesh&&!1===x.instancing||!r.isInstancedMesh&&!0===x.instancing||r.isSkinnedMesh&&!1===x.skinning||!r.isSkinnedMesh&&!0===x.skinning||x.envMap!==l||!0===n.fog&&x.fog!==s||void 0!==x.numClippingPlanes&&(x.numClippingPlanes!==oe.numPlanes||x.numIntersection!==oe.numIntersection)||x.vertexAlphas!==c||x.vertexTangents!==h||x.morphTargets!==d||x.morphNormals!==p||x.morphColors!==f||x.toneMapping!==g||!0===q.isWebGL2&&x.morphTargetsCount!==y)&&(_=!0):(_=!0,x.__version=n.version);let E=x.currentProgram;!0===_&&(E=Oe(n,t,r));let C=!1,I=!1,P=!1,D=E.getUniforms(),R=x.uniforms;if(X.useProgram(E.program)&&(C=!0,I=!0,P=!0),n.id!==A&&(A=n.id,I=!0),C||w!==e){if(D.setValue(ve,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&D.setValue(ve,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,I=!0,P=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){let t=D.map.cameraPosition;void 0!==t&&t.setValue(ve,G.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&D.setValue(ve,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&D.setValue(ve,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){D.setOptional(ve,r,"bindMatrix"),D.setOptional(ve,r,"bindMatrixInverse");let e=r.skeleton;e&&(q.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),D.setValue(ve,"boneTexture",e.boneTexture,J),D.setValue(ve,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let B=i.morphAttributes;if((void 0!==B.position||void 0!==B.normal||void 0!==B.color&&!0===q.isWebGL2)&&he.update(r,i,n,E),(I||x.receiveShadow!==r.receiveShadow)&&(x.receiveShadow=r.receiveShadow,D.setValue(ve,"receiveShadow",r.receiveShadow)),n.isMeshGouraudMaterial&&null!==n.envMap&&(R.envMap.value=l,R.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),I&&(D.setValue(ve,"toneMappingExposure",m.toneMappingExposure),x.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(R,P),s&&!0===n.fog&&re.refreshFogUniforms(R,s),re.refreshMaterialUniforms(R,n,T,M,z),Ua.upload(ve,x.uniformsList,R,J)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Ua.upload(ve,x.uniformsList,R,J),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&D.setValue(ve,"center",r.center),D.setValue(ve,"modelViewMatrix",r.modelViewMatrix),D.setValue(ve,"normalMatrix",r.normalMatrix),D.setValue(ve,"modelMatrix",r.matrixWorld),r.previousModelViewMatrix&&D.setValue(ve,"previousModelViewMatrix",r.previousModelViewMatrix),e.previousProjectionMatrix&&D.setValue(ve,"previousProjectionMatrix",e.previousProjectionMatrix),n.isShaderMaterial||n.isRawShaderMaterial){let e=n.uniformsGroups;for(let t=0,i=e.length;t<i;t++)if(q.isWebGL2){let i=e[t];ge.update(i,E),ge.bind(i,E)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return E}(e,t,i,n,r);X.setMaterial(n,a);let l=i.index,c=1;!0===n.wireframe&&(l=te.getWireframeAttribute(i),c=2);let h=i.drawRange,d=i.attributes.position,p=h.start*c,f=(h.start+h.count)*c;null!==s&&(p=Math.max(p,s.start*c),f=Math.min(f,(s.start+s.count)*c)),null!==l?(p=Math.max(p,0),f=Math.min(f,l.count)):null!=d&&(p=Math.max(p,0),f=Math.min(f,d.count));let g=f-p;if(g<0||g===1/0)return;me.setup(r,n,o,i,l);let v,y=de;if(null!==l&&(v=ee.get(l),y=ue,y.setIndex(v)),r.isMesh)!0===n.wireframe?(X.setLineWidth(n.wireframeLinewidth*W()),y.setMode(1)):y.setMode(4);else if(r.isLine){let e=n.linewidth;void 0===e&&(e=1),X.setLineWidth(e*W()),r.isLineSegments?y.setMode(1):r.isLineLoop?y.setMode(2):y.setMode(3)}else r.isPoints?y.setMode(0):r.isSprite&&y.setMode(4);if(r.isInstancedMesh)y.renderInstances(p,g,r.count);else if(i.isInstancedBufferGeometry){let e=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,t=Math.min(i.instanceCount,e);y.renderInstances(p,g,t)}else y.render(p,g)},this.compile=function(e,t){function i(e,t,i){!0===e.transparent&&e.side===L&&!1===e.forceSinglePass?(e.side=B,e.needsUpdate=!0,Oe(e,t,i),e.side=R,e.needsUpdate=!0,Oe(e,t,i),e.side=L):Oe(e,t,i)}u=ae.get(e),u.init(),f.push(u),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(u.pushLight(e),e.castShadow&&u.pushShadow(e))})),u.setupLights(m.physicallyCorrectLights),e.traverse((function(t){let n=t.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){i(n[r],e,t)}else i(n,e,t)})),f.pop(),u=null};let Ee=null;function Ce(){Te.stop()}function Me(){Te.start()}let Te=new $r;function Ie(e,t,i,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)u.pushLight(e),e.castShadow&&u.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||k.intersectsSprite(e)){n&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);let t=ie.update(e),r=e.material;r.visible&&d.push(e,t,r,i,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Y.render.frame&&(e.skeleton.update(),e.skeleton.frame=Y.render.frame),!e.frustumCulled||k.intersectsObject(e))){n&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);let t=ie.update(e),r=e.material;if(Array.isArray(r)){let n=t.groups;for(let s=0,a=n.length;s<a;s++){let a=n[s],o=r[a.materialIndex];o&&o.visible&&d.push(e,t,o,i,G.z,a)}}else r.visible&&d.push(e,t,r,i,G.z,null)}let r=e.children;for(let s=0,a=r.length;s<a;s++)Ie(r[s],t,i,n)}function Pe(e,t,i,n){let r=e.opaque,s=e.transmissive,o=e.transparent;u.setupLightsView(i),!0===F&&oe.setGlobalState(m.clippingPlanes,i),s.length>0&&function(e,t,i){let n=q.isWebGL2;null===z&&(z=new Fi(1,1,{generateMipmaps:!0,type:Q.has("EXT_color_buffer_half_float")?je:Le,minFilter:Be,samples:n&&!0===a?4:0})),m.getDrawingBufferSize(V),n?z.setSize(V.x,V.y):z.setSize(ci(V.x),ci(V.y));let r=m.getRenderTarget();m.setRenderTarget(z),m.clear();let s=m.toneMapping;m.toneMapping=fe,De(e,t,i),m.toneMapping=s,J.updateMultisampleRenderTarget(z),J.updateRenderTargetMipmap(z),m.setRenderTarget(r)}(r,t,i),n&&X.viewport(S.copy(n)),r.length>0&&De(r,t,i),s.length>0&&De(s,t,i),o.length>0&&De(o,t,i),X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1)}function De(e,t,i){let n=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){let s=e[r],a=s.object,o=s.geometry,l=null===n?s.material:n,c=s.group;a.layers.test(i.layers)&&Re(a,t,i,o,l,c)}}function Re(e,t,i,n,r,s){e.onBeforeRender(m,t,i,n,r,s),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(m,t,i,n,e,s),!0===r.transparent&&r.side===L&&!1===r.forceSinglePass?(r.side=B,r.needsUpdate=!0,m.renderBufferDirect(i,t,n,r,e,s),r.side=R,r.needsUpdate=!0,m.renderBufferDirect(i,t,n,r,e,s),r.side=L):m.renderBufferDirect(i,t,n,r,e,s),e.onAfterRender(m,t,i,n,r,s)}function Oe(e,t,i){!0!==t.isScene&&(t=H);let n=K.get(e),r=u.state.lights,s=u.state.shadowsArray,a=r.state.version,o=ne.getParameters(e,r.state,s,t,i),l=ne.getProgramCacheKey(o),c=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=(e.isMeshStandardMaterial?$:Z).get(e.envMap||n.environment),void 0===c&&(e.addEventListener("dispose",_e),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===a)return Ne(e,o),h}else o.uniforms=ne.getUniforms(e),e.onBuild(i,o,m),e.onBeforeCompile(o,m),h=ne.acquireProgram(o,l),c.set(l,h),n.uniforms=o.uniforms;let d=n.uniforms;(!e.isShaderMaterial&&!e.isRawShaderMaterial||!0===e.clipping)&&(d.clippingPlanes=oe.uniform),Ne(e,o),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=a,n.needsLights&&(d.ambientLightColor.value=r.state.ambient,d.lightProbe.value=r.state.probe,d.directionalLights.value=r.state.directional,d.directionalLightShadows.value=r.state.directionalShadow,d.spotLights.value=r.state.spot,d.spotLightShadows.value=r.state.spotShadow,d.rectAreaLights.value=r.state.rectArea,d.ltc_1.value=r.state.rectAreaLTC1,d.ltc_2.value=r.state.rectAreaLTC2,d.pointLights.value=r.state.point,d.pointLightShadows.value=r.state.pointShadow,d.hemisphereLights.value=r.state.hemi,d.directionalShadowMap.value=r.state.directionalShadowMap,d.directionalShadowMatrix.value=r.state.directionalShadowMatrix,d.spotShadowMap.value=r.state.spotShadowMap,d.spotLightMatrix.value=r.state.spotLightMatrix,d.spotLightMap.value=r.state.spotLightMap,d.pointShadowMap.value=r.state.pointShadowMap,d.pointShadowMatrix.value=r.state.pointShadowMatrix);let p=h.getUniforms(),f=Ua.seqWithValue(p.seq,d);return n.currentProgram=h,n.uniformsList=f,h}function Ne(e,t){let i=K.get(e);i.outputEncoding=t.outputEncoding,i.instancing=t.instancing,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphColors=t.morphColors,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents,i.toneMapping=t.toneMapping}Te.setAnimationLoop((function(e){Ee&&Ee(e)})),typeof self<"u"&&Te.setContext(self),this.setAnimationLoop=function(e){Ee=e,Ae.setAnimationLoop(e),null===e?Te.stop():Te.start()},Ae.addEventListener("sessionstart",Ce),Ae.addEventListener("sessionend",Me),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Ae.enabled&&!0===Ae.isPresenting&&(!0===Ae.cameraAutoUpdate&&Ae.updateCamera(t),t=Ae.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,b),u=ae.get(e,f.length),u.init(),f.push(u),j.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),k.setFromProjectionMatrix(j),U=this.localClippingEnabled,F=oe.init(this.clippingPlanes,U),d=se.get(e,p.length),d.init(),p.push(d),Ie(e,t,0,m.sortObjects),d.finish(),!0===m.sortObjects&&d.sort(I,P),!0===F&&oe.beginShadows();let i=u.state.shadowsArray;if(le.render(i,e,t),!0===F&&oe.endShadows(),!0===this.info.autoReset&&this.info.reset(),ce.render(d,e),u.setupLights(m.physicallyCorrectLights),t.isArrayCamera){let i=t.cameras;for(let t=0,n=i.length;t<n;t++){let n=i[t];Pe(d,e,n,n.viewport)}}else Pe(d,e,t);null!==b&&(J.updateMultisampleRenderTarget(b),J.updateRenderTargetMipmap(b)),!0===e.isScene&&e.onAfterRender(m,e,t),me.resetDefaultState(),A=-1,w=null,f.pop(),u=f.length>0?f[f.length-1]:null,p.pop(),d=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(e,t,i){K.get(e.texture).__webglTexture=t,K.get(e.depthTexture).__webglTexture=i;let n=K.get(e);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===Q.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){let i=K.get(e);i.__webglFramebuffer=t,i.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b=e,v=t,y=i;let n=!0,r=null,s=!1,a=!1;if(e){let i=K.get(e);void 0!==i.__useDefaultFramebuffer?(X.bindFramebuffer(36160,null),n=!1):void 0===i.__webglFramebuffer?J.setupRenderTarget(e):i.__hasExternalTextures&&J.rebindTextures(e,K.get(e.texture).__webglTexture,K.get(e.depthTexture).__webglTexture);let o=e.texture;(o.isData3DTexture||o.isDataArrayTexture||o.isCompressedArrayTexture)&&(a=!0);let l=K.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=l[t],s=!0):r=q.isWebGL2&&e.samples>0&&!1===J.useMultisampledRTT(e)?K.get(e).__webglMultisampledFramebuffer:l,S.copy(e.viewport),_.copy(e.scissor),E=e.scissorTest}else S.copy(D).multiplyScalar(T).floor(),_.copy(O).multiplyScalar(T).floor(),E=N;if(X.bindFramebuffer(36160,r)&&q.drawBuffers&&n&&X.drawBuffers(e,r),X.viewport(S),X.scissor(_),X.setScissorTest(E),s){let n=K.get(e.texture);ve.framebufferTexture2D(36160,36064,34069+t,n.__webglTexture,i)}else if(a){let n=K.get(e.texture),r=t||0;ve.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}A=-1},this.readRenderTargetPixels=function(e,t,i,n,r,s,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=K.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){X.bindFramebuffer(36160,o);try{let a=e.texture,o=a.format,l=a.type;if(o!==Qe&&pe.convert(o)!==ve.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");let c=l===je&&(Q.has("EXT_color_buffer_half_float")||q.isWebGL2&&Q.has("EXT_color_buffer_float"));if(l!==Le&&pe.convert(l)!==ve.getParameter(35738)&&(l!==ze||!(q.isWebGL2||Q.has("OES_texture_float")||Q.has("WEBGL_color_buffer_float")))&&!c)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r&&ve.readPixels(t,i,n,r,pe.convert(o),pe.convert(l),s)}finally{let e=null!==b?K.get(b).__webglFramebuffer:null;X.bindFramebuffer(36160,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,i,n,r,s,a){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=K.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){let a=e.texture,l=a.format,c=a.type;if(t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r){X.bindFramebuffer(ve.FRAMEBUFFER,o);let e=ve.createBuffer();ve.bindBuffer(ve.PIXEL_PACK_BUFFER,e),ve.bufferData(ve.PIXEL_PACK_BUFFER,s.byteLength,ve.STREAM_READ),ve.readPixels(t,i,n,r,pe.convert(l),pe.convert(c),0);let a=null!==b?K.get(b).__webglFramebuffer:null;X.bindFramebuffer(ve.FRAMEBUFFER,a);let h=ve.fenceSync(ve.SYNC_GPU_COMMANDS_COMPLETE,0);return ve.flush(),await function(e,t,i){return new Promise((function(n,r){setTimeout((function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:n()}}),i)}))}(ve,h,4),ve.bindBuffer(ve.PIXEL_PACK_BUFFER,e),ve.getBufferSubData(ve.PIXEL_PACK_BUFFER,0,s),ve.deleteBuffer(e),ve.deleteSync(h),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Math.pow(2,-i),r=Math.floor(t.image.width*n),s=Math.floor(t.image.height*n);J.setTexture2D(t,0),ve.copyTexSubImage2D(3553,i,0,0,e.x,e.y,r,s),X.unbindTexture()},this.copyTextureToTexture=function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.image.width,s=t.image.height,a=pe.convert(i.format),o=pe.convert(i.type);J.setTexture2D(i,0),ve.pixelStorei(37440,i.flipY),ve.pixelStorei(37441,i.premultiplyAlpha),ve.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?ve.texSubImage2D(3553,n,e.x,e.y,r,s,a,o,t.image.data):t.isCompressedTexture?ve.compressedTexSubImage2D(3553,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):ve.texSubImage2D(3553,n,e.x,e.y,a,o,t.image),0===n&&i.generateMipmaps&&ve.generateMipmap(3553),X.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");let s,a=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,l=e.max.z-e.min.z+1,c=pe.convert(n.format),h=pe.convert(n.type);if(n.isData3DTexture)J.setTexture3D(n,0),s=32879;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(n,0),s=35866}ve.pixelStorei(37440,n.flipY),ve.pixelStorei(37441,n.premultiplyAlpha),ve.pixelStorei(3317,n.unpackAlignment);let d=ve.getParameter(3314),u=ve.getParameter(32878),p=ve.getParameter(3316),f=ve.getParameter(3315),g=ve.getParameter(32877),v=i.isCompressedTexture?i.mipmaps[0]:i.image;ve.pixelStorei(3314,v.width),ve.pixelStorei(32878,v.height),ve.pixelStorei(3316,e.min.x),ve.pixelStorei(3315,e.min.y),ve.pixelStorei(32877,e.min.z),i.isDataTexture||i.isData3DTexture?ve.texSubImage3D(s,r,t.x,t.y,t.z,a,o,l,c,h,v.data):i.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ve.compressedTexSubImage3D(s,r,t.x,t.y,t.z,a,o,l,c,v.data)):ve.texSubImage3D(s,r,t.x,t.y,t.z,a,o,l,c,h,v),ve.pixelStorei(3314,d),ve.pixelStorei(32878,u),ve.pixelStorei(3316,p),ve.pixelStorei(3315,f),ve.pixelStorei(32877,g),0===r&&n.generateMipmaps&&ve.generateMipmap(s),X.unbindTexture()},this.initRenderTarget=function(e){void 0===K.get(e).__webglFramebuffer&&J.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?J.setTextureCube(e,0):e.isData3DTexture?J.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?J.setTexture2DArray(e,0):J.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){v=0,y=0,b=null,X.reset(),me.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends Lo{}).prototype.isWebGL1Renderer=!0;var Oo=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new Pi(e),this.near=t,this.far=i}clone(){return new Oo(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},No=class extends Hn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},ko=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Yt,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ni()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ni()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ni()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Fo=new Vi,Uo=class{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Fo.fromBufferAttribute(this,t),Fo.applyMatrix4(e),this.setXYZ(t,Fo.x,Fo.y,Fo.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Fo.fromBufferAttribute(this,t),Fo.applyNormalMatrix(e),this.setXYZ(t,Fo.x,Fo.y,Fo.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Fo.fromBufferAttribute(this,t),Fo.transformDirection(e),this.setXYZ(t,Fo.x,Fo.y,Fo.z);return this}setX(e,t){return this.normalized&&(t=di(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=di(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=di(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=di(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=hi(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=hi(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=hi(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=hi(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=di(t,this.array),i=di(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=di(t,this.array),i=di(i,this.array),n=di(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=di(t,this.array),i=di(i,this.array),n=di(n,this.array),r=di(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new or(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Uo(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},zo=class extends Hn{constructor(){super(),this.isBone=!0,this.type="Bone"}},jo=class extends Ni{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:Te,arguments.length>9&&void 0!==arguments[9]?arguments[9]:Te,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Vo=new bn,Go=new bn,Ho=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=ni(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new bn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let t=new bn;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,s=e.length;r<s;r++){let n=e[r]?e[r].matrixWorld:Go;Vo.multiplyMatrices(n,t[r]),Vo.toArray(i,16*r)}null!==n&&(n.needsUpdate=!0)}clone(){return new Ho(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=li(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new jo(t,e,e,Qe,ze);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){let n=e.bones[i],r=t[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new zo),this.bones.push(r),this.boneInverses.push((new bn).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){let r=t[n];e.bones.push(r.uuid);let s=i[n];e.boneInverses.push(s.toArray())}return e}},Wo=class extends or{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},Qo=new bn,qo=new bn,Xo=[],Yo=new bn,Ko=new Rr,Jo=class extends Rr{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Wo(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let n=0;n<i;n++)this.setMatrixAt(n,Yo)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){let i=this.matrixWorld,n=this.count;if(Ko.geometry=this.geometry,Ko.material=this.material,void 0!==Ko.material)for(let r=0;r<n;r++){this.getMatrixAt(r,Qo),qo.multiplyMatrices(i,Qo),Ko.matrixWorld=qo,Ko.raycast(e,Xo);for(let e=0,i=Xo.length;e<i;e++){let i=Xo[e];i.instanceId=r,i.object=this,t.push(i)}Xo.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Wo(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},Zo=class extends nr{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Pi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},$o=new Vi,el=new Vi,tl=new bn,il=new yn,nl=new hn,rl=class extends Hn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Zo;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)$o.fromBufferAttribute(t,e-1),el.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=$o.distanceTo(el);e.setAttribute("lineDistance",new hr(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),nl.copy(i.boundingSphere),nl.applyMatrix4(n),nl.radius+=r,!1===e.ray.intersectsSphere(nl))return;tl.copy(n).invert(),il.copy(e.ray).applyMatrix4(tl);let a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new Vi,c=new Vi,h=new Vi,d=new Vi,u=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(null!==p){for(let i=Math.max(0,s.start),n=Math.min(p.count,s.start+s.count)-1;i<n;i+=u){let n=p.getX(i),r=p.getX(i+1);if(l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,r),il.distanceSqToSegment(l,c,d,h)>o)continue;d.applyMatrix4(this.matrixWorld);let s=e.ray.origin.distanceTo(d);s<e.near||s>e.far||t.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,s.start),n=Math.min(f.count,s.start+s.count)-1;i<n;i+=u){if(l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,i+1),il.distanceSqToSegment(l,c,d,h)>o)continue;d.applyMatrix4(this.matrixWorld);let n=e.ray.origin.distanceTo(d);n<e.near||n>e.far||t.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){let t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}},sl=new Vi,al=new Vi,ol=class extends rl{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)sl.fromBufferAttribute(t,e),al.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+sl.distanceTo(al);e.setAttribute("lineDistance",new hr(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},ll=class extends Ni{constructor(e,t,i,n,r,s,a,o,l){super(e,t,i,n,r,s,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:De,this.magFilter=void 0!==r?r:De,this.generateMipmaps=!1;let c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},cl=class extends Ni{constructor(e,t,i,n,r,s,a,o,l){super(e,t,i,n,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},hl=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t,i=[],n=this.getPoint(0),r=0;i.push(0);for(let s=1;s<=e;s++)t=this.getPoint(s/e),r+=t.distanceTo(n),i.push(r),n=t;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i,n=this.getLengths(),r=0,s=n.length;i=t||e*n[s-1];let a,o=0,l=s-1;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),a=n[r]-i,a<0)o=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(r=l,n[r]===i)return r/(s-1);let c=n[r];return(r+(i-c)/(n[r+1]-c))/(s-1)}getTangent(e,t){let i=e-1e-4,n=e+1e-4;i<0&&(i=0),n>1&&(n=1);let r=this.getPoint(i),s=this.getPoint(n),a=t||(r.isVector2?new pi:new Vi);return a.copy(s).sub(r).normalize(),a}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new Vi,n=[],r=[],s=[],a=new Vi,o=new bn;for(let u=0;u<=e;u++){let t=u/e;n[u]=this.getTangentAt(t,new Vi)}r[0]=new Vi,s[0]=new Vi;let l=Number.MAX_VALUE,c=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),d<=l&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),s[0].crossVectors(n[0],r[0]);for(let u=1;u<=e;u++){if(r[u]=r[u-1].clone(),s[u]=s[u-1].clone(),a.crossVectors(n[u-1],n[u]),a.length()>Number.EPSILON){a.normalize();let e=Math.acos(ri(n[u-1].dot(n[u]),-1,1));r[u].applyMatrix4(o.makeRotationAxis(a,e))}s[u].crossVectors(n[u],r[u])}if(!0===t){let t=Math.acos(ri(r[0].dot(r[e]),-1,1));t/=e,n[0].dot(a.crossVectors(r[0],r[e]))>0&&(t=-t);for(let i=1;i<=e;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],t*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},dl=class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let i=t||new pi,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0===this.aClockwise&&!s&&(r===n?r=-n:r-=n);let a=this.aStartAngle+e*r,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){let e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};function ul(){let e=0,t=0,i=0,n=0;function r(r,s,a,o){e=r,t=a,i=-3*r+3*s-2*a-o,n=2*r-2*s+a+o}return{initCatmullRom:function(e,t,i,n,s){r(t,i,s*(i-e),s*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,s,a,o){let l=(t-e)/s-(i-e)/(s+a)+(i-t)/a,c=(i-t)/a-(n-t)/(a+o)+(n-i)/o;l*=a,c*=a,r(t,i,l,c)},calc:function(r){let s=r*r;return e+t*r+i*s+n*(s*r)}}}var pl=new Vi,fl=new ul,ml=new ul,gl=new ul;function vl(e,t,i,n,r){let s=.5*(n-t),a=.5*(r-i),o=e*e;return(2*i-2*n+s+a)*(e*o)+(-3*i+3*n-2*s-a)*o+s*e+i}function yl(e,t,i,n){return function(e,t){let i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function bl(e,t,i,n,r){return function(e,t){let i=1-e;return i*i*i*t}(e,t)+function(e,t){let i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,r)}var Al=class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pi,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pi,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new pi;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pi,i=this.v0,n=this.v1,r=this.v2,s=this.v3;return t.set(bl(e,i.x,n.x,r.x,s.x),bl(e,i.y,n.y,r.y,s.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},xl=class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vi,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Vi,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Vi;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vi,i=this.v0,n=this.v1,r=this.v2,s=this.v3;return t.set(bl(e,i.x,n.x,r.x,s.x),bl(e,i.y,n.y,r.y,s.y),bl(e,i.z,n.z,r.z,s.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},wl=class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pi;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pi;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new pi;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Sl=class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vi;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vi;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},_l=class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pi,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pi;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pi,i=this.v0,n=this.v1,r=this.v2;return t.set(yl(e,i.x,n.x,r.x),yl(e,i.y,n.y,r.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},El=class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pi,i=this.points,n=(i.length-1)*e,r=Math.floor(n),s=n-r,a=i[0===r?r:r-1],o=i[r],l=i[r>i.length-2?i.length-1:r+1],c=i[r>i.length-3?i.length-1:r+2];return t.set(vl(s,a.x,o.x,l.x,c.x),vl(s,a.y,o.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push((new pi).fromArray(i))}return this}},Cl=Object.freeze({__proto__:null,ArcCurve:class extends dl{constructor(e,t,i,n,r,s){super(e,t,i,i,n,r,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e){let t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vi,r=this.points,s=r.length,a=(s-(this.closed?0:1))*e,o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:0===l&&o===s-1&&(o=s-2,l=1),this.closed||o>0?t=r[(o-1)%s]:(pl.subVectors(r[0],r[1]).add(r[0]),t=pl);let c=r[o%s],h=r[(o+1)%s];if(this.closed||o+2<s?i=r[(o+2)%s]:(pl.subVectors(r[s-1],r[s-2]).add(r[s-1]),i=pl),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,n=Math.pow(t.distanceToSquared(c),e),r=Math.pow(c.distanceToSquared(h),e),s=Math.pow(h.distanceToSquared(i),e);r<1e-4&&(r=1),n<1e-4&&(n=r),s<1e-4&&(s=r),fl.initNonuniformCatmullRom(t.x,c.x,h.x,i.x,n,r,s),ml.initNonuniformCatmullRom(t.y,c.y,h.y,i.y,n,r,s),gl.initNonuniformCatmullRom(t.z,c.z,h.z,i.z,n,r,s)}else"catmullrom"===this.curveType&&(fl.initCatmullRom(t.x,c.x,h.x,i.x,this.tension),ml.initCatmullRom(t.y,c.y,h.y,i.y,this.tension),gl.initCatmullRom(t.z,c.z,h.z,i.z,this.tension));return n.set(fl.calc(l),ml.calc(l),gl.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push((new Vi).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:Al,CubicBezierCurve3:xl,EllipseCurve:dl,LineCurve:wl,LineCurve3:Sl,QuadraticBezierCurve:_l,QuadraticBezierCurve3:class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vi,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Vi;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vi,i=this.v0,n=this.v1,r=this.v2;return t.set(yl(e,i.x,n.x,r.x),yl(e,i.y,n.y,r.y),yl(e,i.z,n.z,r.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},SplineCurve:El}),Ml=class extends hl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new wl(t,e))}getPoint(e,t){let i=e*this.getLength(),n=this.getCurveLengths(),r=0;for(;r<n.length;){if(n[r]>=i){let e=n[r]-i,s=this.curves[r],a=s.getLength(),o=0===a?0:1-e/a;return s.getPointAt(o,t)}r++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,i=[];for(let n=0,r=this.curves;n<r.length;n++){let s=r[n],a=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){let n=o[t];e&&e.equals(n)||(i.push(n),e=n)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let i=e.curves[t];this.curves.push((new Cl[i.type]).fromJSON(i))}return this}},Tl=class extends Ml{constructor(e){super(),this.type="Path",this.currentPoint=new pi,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new wl(this.currentPoint.clone(),new pi(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){let r=new _l(this.currentPoint.clone(),new pi(e,t),new pi(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,s){let a=new Al(this.currentPoint.clone(),new pi(e,t),new pi(i,n),new pi(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new El(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,n,r,s),this}absarc(e,t,i,n,r,s){return this.absellipse(e,t,i,i,n,r,s),this}ellipse(e,t,i,n,r,s,a,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,r,s,a,o),this}absellipse(e,t,i,n,r,s,a,o){let l=new dl(e,t,i,n,r,s,a,o);if(this.curves.length>0){let e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},Il=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new pi(0,-.5),new pi(.5,0),new pi(0,.5)],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=ri(n,0,2*Math.PI);let r=[],s=[],a=[],o=[],l=[],c=1/t,h=new Vi,d=new pi,u=new Vi,p=new Vi,f=new Vi,m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,u.x=1*g,u.y=-m,u.z=0*g,f.copy(u),u.normalize(),o.push(u.x,u.y,u.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,u.x=1*g,u.y=-m,u.z=0*g,p.copy(u),u.x+=f.x,u.y+=f.y,u.z+=f.z,u.normalize(),o.push(u.x,u.y,u.z),f.copy(p)}for(let v=0;v<=t;v++){let r=i+v*c*n,u=Math.sin(r),p=Math.cos(r);for(let i=0;i<=e.length-1;i++){h.x=e[i].x*u,h.y=e[i].y,h.z=e[i].x*p,s.push(h.x,h.y,h.z),d.x=v/t,d.y=i/(e.length-1),a.push(d.x,d.y);let n=o[3*i+0]*u,r=o[3*i+1],c=o[3*i+0]*p;l.push(n,r,c)}}for(let v=0;v<t;v++)for(let t=0;t<e.length-1;t++){let i=t+v*e.length,n=i,s=i+e.length,a=i+e.length+1,o=i+1;r.push(n,s,o),r.push(a,o,s)}this.setIndex(r),this.setAttribute("position",new hr(s,3)),this.setAttribute("uv",new hr(a,2)),this.setAttribute("normal",new hr(l,3))}static fromJSON(e){return new Il(e.points,e.segments,e.phiStart,e.phiLength)}},Pl=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};let l=this;n=Math.floor(n),r=Math.floor(r);let c=[],h=[],d=[],u=[],p=0,f=[],m=i/2,g=0;function v(i){let r=p,s=new pi,f=new Vi,v=0,y=!0===i?e:t,b=!0===i?1:-1;for(let e=1;e<=n;e++)h.push(0,m*b,0),d.push(0,b,0),u.push(.5,.5),p++;let A=p;for(let e=0;e<=n;e++){let t=e/n*o+a,i=Math.cos(t),r=Math.sin(t);f.x=y*r,f.y=m*b,f.z=y*i,h.push(f.x,f.y,f.z),d.push(0,b,0),s.x=.5*i+.5,s.y=.5*r*b+.5,u.push(s.x,s.y),p++}for(let e=0;e<n;e++){let t=r+e,n=A+e;!0===i?c.push(n,n+1,t):c.push(n+1,n,t),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}(function(){let s=new Vi,v=new Vi,y=0,b=(t-e)/i;for(let l=0;l<=r;l++){let c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=n;e++){let t=e/n,r=t*o+a,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*i+m,v.z=y*f,h.push(v.x,v.y,v.z),s.set(l,b,f).normalize(),d.push(s.x,s.y,s.z),u.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<n;e++)for(let t=0;t<r;t++){let i=f[t][e],n=f[t+1][e],r=f[t+1][e+1],s=f[t][e+1];c.push(i,n,s),c.push(n,r,s),y+=6}l.addGroup(g,y,0),g+=y})(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new hr(h,3)),this.setAttribute("normal",new hr(d,3)),this.setAttribute("uv",new hr(u,2))}static fromJSON(e){return new Pl(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Dl=class extends Pl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,i,n,r,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(e){return new Dl(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Rl=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};let r=[],s=[];function a(e,t,i,n){let r=n+1,s=[];for(let a=0;a<=r;a++){s[a]=[];let n=e.clone().lerp(i,a/r),o=t.clone().lerp(i,a/r),l=r-a;for(let e=0;e<=l;e++)s[a][e]=0===e&&a===r?n:n.clone().lerp(o,e/l)}for(let a=0;a<r;a++)for(let e=0;e<2*(r-a)-1;e++){let t=Math.floor(e/2);e%2===0?(o(s[a][t+1]),o(s[a+1][t]),o(s[a][t])):(o(s[a][t+1]),o(s[a+1][t+1]),o(s[a+1][t]))}}function o(e){r.push(e.x,e.y,e.z)}function l(t,i){let n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function c(e,t,i,n){n<0&&1===e.x&&(s[t]=e.x-1),0===i.x&&0===i.z&&(s[t]=n/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(function(e){let i=new Vi,n=new Vi,r=new Vi;for(let s=0;s<t.length;s+=3)l(t[s+0],i),l(t[s+1],n),l(t[s+2],r),a(i,n,r,e)})(n),function(e){let t=new Vi;for(let i=0;i<r.length;i+=3)t.x=r[i+0],t.y=r[i+1],t.z=r[i+2],t.normalize().multiplyScalar(e),r[i+0]=t.x,r[i+1]=t.y,r[i+2]=t.z}(i),function(){let e=new Vi;for(let t=0;t<r.length;t+=3){e.x=r[t+0],e.y=r[t+1],e.z=r[t+2];let i=h(e)/2/Math.PI+.5,n=d(e)/Math.PI+.5;s.push(i,1-n)}(function(){let e=new Vi,t=new Vi,i=new Vi,n=new Vi,a=new pi,o=new pi,l=new pi;for(let d=0,u=0;d<r.length;d+=9,u+=6){e.set(r[d+0],r[d+1],r[d+2]),t.set(r[d+3],r[d+4],r[d+5]),i.set(r[d+6],r[d+7],r[d+8]),a.set(s[u+0],s[u+1]),o.set(s[u+2],s[u+3]),l.set(s[u+4],s[u+5]),n.copy(e).add(t).add(i).divideScalar(3);let p=h(n);c(a,u+0,e,p),c(o,u+2,t,p),c(l,u+4,i,p)}})(),function(){for(let e=0;e<s.length;e+=6){let t=s[e+0],i=s[e+2],n=s[e+4],r=Math.max(t,i,n),a=Math.min(t,i,n);r>.9&&a<.1&&(t<.2&&(s[e+0]+=1),i<.2&&(s[e+2]+=1),n<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new hr(r,3)),this.setAttribute("normal",new hr(r.slice(),3)),this.setAttribute("uv",new hr(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new Rl(e.vertices,e.indices,e.radius,e.details)}},Bl=class extends Rl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Bl(e.radius,e.detail)}},Ll=class extends Tl{constructor(e){super(e),this.uuid=ni(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let i=e.holes[t];this.holes.push((new Tl).fromJSON(i))}return this}},Ol=function(e,t){let i,n,r,s,a,o,l,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,h=t&&t.length,d=h?t[0]*c:e.length,u=Nl(e,0,d,c,!0),p=[];if(!u||u.next===u.prev)return p;if(h&&(u=function(e,t,i,n){let r,s,a,o,l,c=[];for(r=0,s=t.length;r<s;r++)a=t[r]*n,o=r<s-1?t[r+1]*n:e.length,l=Nl(e,a,o,n,!1),l===l.next&&(l.steiner=!0),c.push(ql(l));for(c.sort(Gl),r=0;r<c.length;r++)i=Hl(c[r],i);return i}(e,t,u,c)),e.length>80*c){i=r=e[0],n=s=e[1];for(let t=c;t<d;t+=c)a=e[t],o=e[t+1],a<i&&(i=a),o<n&&(n=o),a>r&&(r=a),o>s&&(s=o);l=Math.max(r-i,s-n),l=0!==l?32767/l:0}return Fl(u,p,c,i,n,l,0),p};function Nl(e,t,i,n,r){let s,a;if(r===function(e,t,i,n){let r=0;for(let s=t,a=i-n;s<i;s+=n)r+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return r}(e,t,i,n)>0)for(s=t;s<i;s+=n)a=nc(s,e[s],e[s+1],a);else for(s=i-n;s>=t;s-=n)a=nc(s,e[s],e[s+1],a);return a&&Jl(a,a.next)&&(rc(a),a=a.next),a}function kl(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!Jl(n,n.next)&&0!==Kl(n.prev,n,n.next))n=n.next;else{if(rc(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function Fl(e,t,i,n,r,s,a){if(!e)return;!a&&s&&function(e,t,i,n){let r=e;do{0===r.z&&(r.z=Ql(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,i,n,r,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,n=i,o=0,t=0;t<c&&(o++,n=n.nextZ,n);t++);for(l=c;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(a>1)}(r)}(e,n,r,s);let o,l,c=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,s?zl(e,n,r,s):Ul(e))t.push(o.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),rc(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?Fl(e=jl(kl(e),t,i),t,i,n,r,s,2):2===a&&Vl(e,t,i,n,r,s):Fl(kl(e),t,i,n,r,s,1);break}}function Ul(e){let t=e.prev,i=e,n=e.next;if(Kl(t,i,n)>=0)return!1;let r=t.x,s=i.x,a=n.x,o=t.y,l=i.y,c=n.y,h=r<s?r<a?r:a:s<a?s:a,d=o<l?o<c?o:c:l<c?l:c,u=r>s?r>a?r:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c,f=n.next;for(;f!==t;){if(f.x>=h&&f.x<=u&&f.y>=d&&f.y<=p&&Xl(r,o,s,l,a,c,f.x,f.y)&&Kl(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function zl(e,t,i,n){let r=e.prev,s=e,a=e.next;if(Kl(r,s,a)>=0)return!1;let o=r.x,l=s.x,c=a.x,h=r.y,d=s.y,u=a.y,p=o<l?o<c?o:c:l<c?l:c,f=h<d?h<u?h:u:d<u?d:u,m=o>l?o>c?o:c:l>c?l:c,g=h>d?h>u?h:u:d>u?d:u,v=Ql(p,f,t,i,n),y=Ql(m,g,t,i,n),b=e.prevZ,A=e.nextZ;for(;b&&b.z>=v&&A&&A.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Xl(o,h,l,d,c,u,b.x,b.y)&&Kl(b.prev,b,b.next)>=0||(b=b.prevZ,A.x>=p&&A.x<=m&&A.y>=f&&A.y<=g&&A!==r&&A!==a&&Xl(o,h,l,d,c,u,A.x,A.y)&&Kl(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Xl(o,h,l,d,c,u,b.x,b.y)&&Kl(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;A&&A.z<=y;){if(A.x>=p&&A.x<=m&&A.y>=f&&A.y<=g&&A!==r&&A!==a&&Xl(o,h,l,d,c,u,A.x,A.y)&&Kl(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function jl(e,t,i){let n=e;do{let r=n.prev,s=n.next.next;!Jl(r,s)&&Zl(r,n,n.next,s)&&tc(r,s)&&tc(s,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(s.i/i|0),rc(n),rc(n.next),n=e=s),n=n.next}while(n!==e);return kl(n)}function Vl(e,t,i,n,r,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Yl(a,e)){let o=ic(a,e);return a=kl(a,a.next),o=kl(o,o.next),Fl(a,t,i,n,r,s,0),void Fl(o,t,i,n,r,s,0)}e=e.next}a=a.next}while(a!==e)}function Gl(e,t){return e.x-t.x}function Hl(e,t){let i=function(e,t){let i,n=t,r=-1/0,s=e.x,a=e.y;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){let e=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=s&&e>r&&(r=e,i=n.x<n.next.x?n:n.next,e===s))return i}n=n.next}while(n!==t);if(!i)return null;let o,l=i,c=i.x,h=i.y,d=1/0;n=i;do{s>=n.x&&n.x>=c&&s!==n.x&&Xl(a<h?s:r,a,c,h,a<h?r:s,a,n.x,n.y)&&(o=Math.abs(a-n.y)/(s-n.x),tc(n,e)&&(o<d||o===d&&(n.x>i.x||n.x===i.x&&Wl(i,n)))&&(i=n,d=o)),n=n.next}while(n!==l);return i}(e,t);if(!i)return t;let n=ic(i,e);return kl(n,n.next),kl(i,i.next)}function Wl(e,t){return Kl(e.prev,e,t.prev)<0&&Kl(t.next,e,e.next)<0}function Ql(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ql(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Xl(e,t,i,n,r,s,a,o){return(r-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(n-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(r-a)*(n-o)}function Yl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Zl(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(tc(e,t)&&tc(t,e)&&function(e,t){let i=e,n=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(Kl(e.prev,e,t.prev)||Kl(e,t.prev,t))||Jl(e,t)&&Kl(e.prev,e,e.next)>0&&Kl(t.prev,t,t.next)>0)}function Kl(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Jl(e,t){return e.x===t.x&&e.y===t.y}function Zl(e,t,i,n){let r=ec(Kl(e,t,i)),s=ec(Kl(e,t,n)),a=ec(Kl(i,n,e)),o=ec(Kl(i,n,t));return!!(r!==s&&a!==o||0===r&&$l(e,i,t)||0===s&&$l(e,n,t)||0===a&&$l(i,e,n)||0===o&&$l(i,t,n))}function $l(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function ec(e){return e>0?1:e<0?-1:0}function tc(e,t){return Kl(e.prev,e,e.next)<0?Kl(e,t,e.next)>=0&&Kl(e,e.prev,t)>=0:Kl(e,t,e.prev)<0||Kl(e,e.next,t)<0}function ic(e,t){let i=new sc(e.i,e.x,e.y),n=new sc(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function nc(e,t,i,n){let r=new sc(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function rc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function sc(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}var ac=class{static area(e){let t=e.length,i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i}static isClockWise(e){return ac.area(e)<0}static triangulateShape(e,t){let i=[],n=[],r=[];oc(e),lc(i,e);let s=e.length;t.forEach(oc);for(let o=0;o<t.length;o++)n.push(s),s+=t[o].length,lc(i,t[o]);let a=Ol(i,n);for(let o=0;o<a.length;o+=3)r.push(a.slice(o,o+3));return r}};function oc(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function lc(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var cc=class extends Rl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new cc(e.radius,e.detail)}},hc=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,c=[],h=new Vi,d=new Vi,u=[],p=[],f=[],m=[];for(let g=0;g<=i;g++){let u=[],v=g/i,y=0;0==g&&0==s?y=.5/t:g==i&&o==Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){let o=i/t;h.x=-e*Math.cos(n+o*r)*Math.sin(s+v*a),h.y=e*Math.cos(s+v*a),h.z=e*Math.sin(n+o*r)*Math.sin(s+v*a),p.push(h.x,h.y,h.z),d.copy(h).normalize(),f.push(d.x,d.y,d.z),m.push(o+y,1-v),u.push(l++)}c.push(u)}for(let g=0;g<i;g++)for(let e=0;e<t;e++){let t=c[g][e+1],n=c[g][e],r=c[g+1][e],a=c[g+1][e+1];(0!==g||s>0)&&u.push(t,n,a),(g!==i-1||o<Math.PI)&&u.push(n,r,a)}this.setIndex(u),this.setAttribute("position",new hr(p,3)),this.setAttribute("normal",new hr(f,3)),this.setAttribute("uv",new hr(m,2))}static fromJSON(e){return new hc(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},dc=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);let s=[],a=[],o=[],l=[],c=new Vi,h=new Vi,d=new Vi;for(let u=0;u<=i;u++)for(let s=0;s<=n;s++){let p=s/n*r,f=u/i*Math.PI*2;h.x=(e+t*Math.cos(f))*Math.cos(p),h.y=(e+t*Math.cos(f))*Math.sin(p),h.z=t*Math.sin(f),a.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),d.subVectors(h,c).normalize(),o.push(d.x,d.y,d.z),l.push(s/n),l.push(u/i)}for(let u=1;u<=i;u++)for(let e=1;e<=n;e++){let t=(n+1)*u+e-1,i=(n+1)*(u-1)+e-1,r=(n+1)*(u-1)+e,a=(n+1)*u+e;s.push(t,i,a),s.push(i,r,a)}this.setIndex(s),this.setAttribute("position",new hr(a,3)),this.setAttribute("normal",new hr(o,3)),this.setAttribute("uv",new hr(l,2))}static fromJSON(e){return new dc(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},uc=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);let a=[],o=[],l=[],c=[],h=new Vi,d=new Vi,u=new Vi,p=new Vi,f=new Vi,m=new Vi,g=new Vi;for(let y=0;y<=i;++y){let a=y/i*r*Math.PI*2;v(a,r,s,e,u),v(a+.01,r,s,e,p),m.subVectors(p,u),g.addVectors(p,u),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=n;++e){let r=e/n*Math.PI*2,s=-t*Math.cos(r),a=t*Math.sin(r);h.x=u.x+(s*g.x+a*f.x),h.y=u.y+(s*g.y+a*f.y),h.z=u.z+(s*g.z+a*f.z),o.push(h.x,h.y,h.z),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(y/i),c.push(e/n)}}for(let y=1;y<=i;y++)for(let e=1;e<=n;e++){let t=(n+1)*(y-1)+(e-1),i=(n+1)*y+(e-1),r=(n+1)*y+e,s=(n+1)*(y-1)+e;a.push(t,i,s),a.push(i,r,s)}function v(e,t,i,n,r){let s=Math.cos(e),a=Math.sin(e),o=i/t*e,l=Math.cos(o);r.x=n*(2+l)*.5*s,r.y=n*(2+l)*a*.5,r.z=n*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new hr(o,3)),this.setAttribute("normal",new hr(l,3)),this.setAttribute("uv",new hr(c,2))}static fromJSON(e){return new uc(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},pc=class extends Ur{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function fc(e,t,i){return gc(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)}function mc(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function gc(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function vc(e){let t=e.length,i=new Array(t);for(let n=0;n!==t;++n)i[n]=n;return i.sort((function(t,i){return e[t]-e[i]})),i}function yc(e,t,i){let n=e.length,r=new e.constructor(n);for(let s=0,a=0;a!==n;++s){let n=i[s]*t;for(let i=0;i!==t;++i)r[a++]=e[n+i]}return r}function bc(e,t,i,n){let r=1,s=e[0];for(;void 0!==s&&void 0===s[n];)s=e[r++];if(void 0===s)return;let a=s[n];if(void 0!==a)if(Array.isArray(a))do{a=s[n],void 0!==a&&(t.push(s.time),i.push.apply(i,a)),s=e[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[n],void 0!==a&&(t.push(s.time),a.toArray(i,i.length)),s=e[r++]}while(void 0!==s);else do{a=s[n],void 0!==a&&(t.push(s.time),i.push(a)),s=e[r++]}while(void 0!==s)}var Ac=class{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let s;i:{n:if(!(e<n)){for(let s=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(r=n,n=t[++i],e<n)break t}s=t.length;break i}if(e>=r)break e;{let a=t[1];e<a&&(i=2,r=a);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===s)break;if(n=r,r=t[--i-1],e>=r)break t}s=i,i=0}}for(;i<s;){let n=i+s>>>1;e<t[n]?s=n:i=n+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let s=0;s!==n;++s)t[s]=i[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},xc=class extends Ac{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Nt,endingEnd:Nt}}intervalChanged_(e,t,i){let n=this.parameterPositions,r=e-2,s=e+1,a=n[r],o=n[s];if(void 0===a)switch(this.getSettings_().endingStart){case kt:r=e,a=2*t-i;break;case Ft:r=n.length-2,a=t+n[r]-n[r+1];break;default:r=e,a=i}if(void 0===o)switch(this.getSettings_().endingEnd){case kt:s=e,o=2*i-t;break;case Ft:s=1,o=i+n[1]-n[0];break;default:s=e-1,o=t}let l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,i,n){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,u=this._weightNext,p=(i-t)/(n-t),f=p*p,m=f*p,g=-d*m+2*d*f-d*p,v=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,y=(-1-u)*m+(1.5+u)*f+.5*p,b=u*m-u*f;for(let A=0;A!==a;++A)r[A]=g*s[c+A]+v*s[l+A]+y*s[o+A]+b*s[h+A];return r}},wc=class extends Ac{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(i-t)/(n-t),h=1-c;for(let d=0;d!==a;++d)r[d]=s[l+d]*h+s[o+d]*c;return r}},Sc=class extends Ac{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}},_c=class{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=mc(t,this.TimeBufferType),this.values=mc(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){let t,i=e.constructor;if(i.toJSON!==this.toJSON)t=i.toJSON(e);else{t={name:e.name,times:mc(e.times,Array),values:mc(e.values,Array)};let i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}InterpolantFactoryMethodDiscrete(e){return new Sc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new wc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new xc(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Bt:t=this.InterpolantFactoryMethodDiscrete;break;case Lt:t=this.InterpolantFactoryMethodLinear;break;case Ot:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Bt;case this.InterpolantFactoryMethodLinear:return Lt;case this.InterpolantFactoryMethodSmooth:return Ot}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){let i=this.times,n=i.length,r=0,s=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==s&&i[s]>t;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);let e=this.getValueSize();this.times=fc(i,r,s),this.values=fc(this.values,r*e,s*e)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==r;a++){let t=i[a];if("number"==typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,t),e=!1;break}if(null!==s&&s>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,t,s),e=!1;break}s=t}if(void 0!==n&&gc(n))for(let a=0,o=n.length;a!==o;++a){let t=n[a];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,t),e=!1;break}}return e}optimize(){let e=fc(this.times),t=fc(this.values),i=this.getValueSize(),n=this.getInterpolation()===Ot,r=e.length-1,s=1;for(let a=1;a<r;++a){let r=!1,o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(n)r=!0;else{let e=a*i,n=e-i,s=e+i;for(let a=0;a!==i;++a){let i=t[e+a];if(i!==t[n+a]||i!==t[s+a]){r=!0;break}}}if(r){if(a!==s){e[s]=e[a];let n=a*i,r=s*i;for(let e=0;e!==i;++e)t[r+e]=t[n+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*i,n=s*i,a=0;a!==i;++a)t[n+a]=t[e+a];++s}return s!==e.length?(this.times=fc(e,0,s),this.values=fc(t,0,s*i)):(this.times=e,this.values=t),this}clone(){let e=fc(this.times,0),t=fc(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}};_c.prototype.TimeBufferType=Float32Array,_c.prototype.ValueBufferType=Float32Array,_c.prototype.DefaultInterpolation=Lt;var Ec=class extends _c{};Ec.prototype.ValueTypeName="bool",Ec.prototype.ValueBufferType=Array,Ec.prototype.DefaultInterpolation=Bt,Ec.prototype.InterpolantFactoryMethodLinear=void 0,Ec.prototype.InterpolantFactoryMethodSmooth=void 0;var Cc=class extends _c{};Cc.prototype.ValueTypeName="color";var Mc=class extends _c{};Mc.prototype.ValueTypeName="number";var Tc=class extends Ac{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-t)/(n-t),l=e*a;for(let c=l+a;l!==c;l+=4)ji.slerpFlat(r,0,s,l-a,s,l,o);return r}},Ic=class extends _c{InterpolantFactoryMethodLinear(e){return new Tc(this.times,this.values,this.getValueSize(),e)}};Ic.prototype.ValueTypeName="quaternion",Ic.prototype.DefaultInterpolation=Lt,Ic.prototype.InterpolantFactoryMethodSmooth=void 0;var Pc=class extends _c{};Pc.prototype.ValueTypeName="string",Pc.prototype.ValueBufferType=Array,Pc.prototype.DefaultInterpolation=Bt,Pc.prototype.InterpolantFactoryMethodLinear=void 0,Pc.prototype.InterpolantFactoryMethodSmooth=void 0;var Dc=class extends _c{};Dc.prototype.ValueTypeName="vector";var Rc=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ut;this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=ni(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,n=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)t.push(Bc(i[s]).scale(n));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=i.length;r!==s;++r)t.push(_c.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(e,t,i,n){let r=t.length,s=[];for(let a=0;a<r;a++){let e=[],o=[];e.push((a+r-1)%r,a,(a+1)%r),o.push(0,1,0);let l=vc(e);e=yc(e,1,l),o=yc(o,1,l),!n&&0===e[0]&&(e.push(r),o.push(o[0])),s.push(new Mc(".morphTargetInfluences["+t[a].name+"]",e,o).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let n={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let t=e[a],i=t.name.match(r);if(i&&i.length>1){let e=i[1],r=n[e];r||(n[e]=r=[]),r.push(t)}}let s=[];for(let a in n)s.push(this.CreateFromMorphTargetSequence(a,n[a],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(e,t,i,n,r){if(0!==i.length){let s=[],a=[];bc(i,s,a,n),0!==s.length&&r.push(new e(t,s,a))}},n=[],r=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){let t,i={};for(t=0;t<e.length;t++)if(e[t].morphTargets)for(let n=0;n<e[t].morphTargets.length;n++)i[e[t].morphTargets[n]]=-1;for(let r in i){let i=[],s=[];for(let n=0;n!==e[t].morphTargets.length;++n){let n=e[t];i.push(n.time),s.push(n.morphTarget===r?1:0)}n.push(new Mc(".morphTargetInfluence["+r+"]",i,s))}o=i.length*s}else{let r=".bones["+t[c].name+"]";i(Dc,r+".position",e,"pos",n),i(Ic,r+".quaternion",e,"rot",n),i(Dc,r+".scale",e,"scl",n)}}return 0===n.length?null:new this(r,o,n,a)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){let i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function Bc(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Mc;case"vector":case"vector2":case"vector3":case"vector4":return Dc;case"color":return Cc;case"quaternion":return Ic;case"bool":case"boolean":return Ec;case"string":return Pc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let t=[],i=[];bc(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var Lc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Oc=class{constructor(e,t,i){let n,r=this,s=!1,a=0,o=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++,!1===s&&void 0!==r.onStart&&r.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return n?n(e):e},this.setURLModifier=function(e){return n=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){let t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){let i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}},Nc=new Oc,kc=class{constructor(e){this.manager=void 0!==e?e:Nc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise((function(n,r){i.load(e,n,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},Fc={},Uc=class extends Error{constructor(e,t){super(e),this.response=t}},zc=class extends kc{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=Lc.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==Fc[e])return void Fc[e].push({onLoad:t,onProgress:i,onError:n});Fc[e]=[],Fc[e].push({onLoad:t,onProgress:i,onError:n});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===t.body||void 0===t.body.getReader)return t;let i=Fc[e],n=t.body.getReader(),r=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),s=r?parseInt(r):0,a=0!==s,o=0,l=new ReadableStream({start(e){!function t(){n.read().then((n=>{let{done:r,value:l}=n;if(r)e.close();else{o+=l.byteLength;let n=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let e=0,t=i.length;e<t;e++){let t=i[e];t.onProgress&&t.onProgress(n)}e.enqueue(l),t()}}))}()}});return new Response(l)}throw new Uc(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(void 0===a)return e.text();{let t=/charset="?([^;"\s]*)"?/i.exec(a),i=t&&t[1]?t[1].toLowerCase():void 0,n=new TextDecoder(i);return e.arrayBuffer().then((e=>n.decode(e)))}}})).then((t=>{Lc.add(e,t);let i=Fc[e];delete Fc[e];for(let e=0,n=i.length;e<n;e++){let n=i[e];n.onLoad&&n.onLoad(t)}})).catch((t=>{let i=Fc[e];if(void 0===i)throw this.manager.itemError(e),t;delete Fc[e];for(let e=0,n=i.length;e<n;e++){let n=i[e];n.onError&&n.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},jc=class extends kc{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=Lc.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;let a=bi("img");function o(){c(),Lc.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}},Vc=class extends kc{constructor(e){super(e)}load(e,t,i,n){let r=new Ni,s=new jc(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),i,n),r}},Gc=class extends Hn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new Pi(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}},Hc=class extends Gc{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Pi(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},Wc=new bn,Qc=new Vi,qc=new Vi,Xc=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new pi(512,512),this.map=null,this.mapPass=null,this.matrix=new bn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Zr,this._frameExtents=new pi(1,1),this._viewportCount=1,this._viewports=[new ki(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;Qc.setFromMatrixPosition(e.matrixWorld),t.position.copy(Qc),qc.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(qc),t.updateMatrixWorld(),Wc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Wc),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Wc)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},Yc=class extends Xc{constructor(){super(new jr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=2*ii*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},Kc=class extends Gc{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.target=new Hn,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new Yc}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},Jc=new bn,Zc=new Vi,$c=new Vi,eh=class extends Xc{constructor(){super(new jr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new pi(4,2),this._viewportCount=6,this._viewports=[new ki(2,1,1,1),new ki(0,1,1,1),new ki(3,1,1,1),new ki(1,1,1,1),new ki(3,0,1,1),new ki(1,0,1,1)],this._cubeDirections=[new Vi(1,0,0),new Vi(-1,0,0),new Vi(0,0,1),new Vi(0,0,-1),new Vi(0,1,0),new Vi(0,-1,0)],this._cubeUps=[new Vi(0,1,0),new Vi(0,1,0),new Vi(0,1,0),new Vi(0,1,0),new Vi(0,0,1),new Vi(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Zc.setFromMatrixPosition(e.matrixWorld),i.position.copy(Zc),$c.copy(i.position),$c.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt($c),i.updateMatrixWorld(),n.makeTranslation(-Zc.x,-Zc.y,-Zc.z),Jc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jc)}},th=class extends Gc{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new eh}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},ih=class extends Xc{constructor(){super(new us(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},nh=class extends Gc{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.target=new Hn,this.shadow=new ih}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},rh=class extends yr{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},sh=class extends kc{constructor(e){super(e)}load(e,t,i,n){let r=this,s=new zc(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(i){try{t(r.parse(JSON.parse(i)))}catch(s){n?n(s):console.error(s),r.manager.itemError(e)}}),i,n)}parse(e){let t={},i={};function n(e,n){if(void 0!==t[n])return t[n];let r=e.interleavedBuffers[n],s=function(e,t){if(void 0!==i[t])return i[t];let n=e.arrayBuffers[t],r=new Uint32Array(n).buffer;return i[t]=r,r}(e,r.buffer),a=yi(r.type,s),o=new ko(a,r.stride);return o.uuid=r.uuid,t[n]=o,o}let r=e.isInstancedBufferGeometry?new rh:new yr,s=e.data.index;if(void 0!==s){let e=yi(s.type,s.array);r.setIndex(new or(e,1))}let a=e.data.attributes;for(let h in a){let t,i=a[h];if(i.isInterleavedBufferAttribute){let r=n(e.data,i.data);t=new Uo(r,i.itemSize,i.offset,i.normalized)}else{let e=yi(i.type,i.array);t=new(i.isInstancedBufferAttribute?Wo:or)(e,i.itemSize,i.normalized)}void 0!==i.name&&(t.name=i.name),void 0!==i.usage&&t.setUsage(i.usage),void 0!==i.updateRange&&(t.updateRange.offset=i.updateRange.offset,t.updateRange.count=i.updateRange.count),r.setAttribute(h,t)}let o=e.data.morphAttributes;if(o)for(let h in o){let t=o[h],i=[];for(let r=0,s=t.length;r<s;r++){let s,a=t[r];if(a.isInterleavedBufferAttribute){let t=n(e.data,a.data);s=new Uo(t,a.itemSize,a.offset,a.normalized)}else{let e=yi(a.type,a.array);s=new or(e,a.itemSize,a.normalized)}void 0!==a.name&&(s.name=a.name),i.push(s)}r.morphAttributes[h]=i}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);let l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let h=0,d=l.length;h!==d;++h){let e=l[h];r.addGroup(e.start,e.count,e.materialIndex)}let c=e.data.boundingSphere;if(void 0!==c){let e=new Vi;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new hn(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}},ah=class{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=oh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=oh();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function oh(){return(typeof performance>"u"?Date:performance).now()}var lh=class{constructor(e,t,i){let n,r,s;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,n=this.valueSize,r=e*n+n,s=this.cumulativeWeight;if(0===s){for(let e=0;e!==n;++e)i[r+e]=i[e];s=t}else{s+=t;let e=t/s;this._mixBufferRegion(i,r,0,e,n)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){let e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,n);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let r=i,s=n;r!==s;++r)t[r]=t[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let s=0;s!==r;++s)e[t+s]=e[i+s]}_slerp(e,t,i,n){ji.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){let s=this._workIndex*r;ji.multiplyQuaternionsFlat(e,s,e,t,e,i),ji.slerpFlat(e,t,e,t,e,s,n)}_lerp(e,t,i,n,r){let s=1-n;for(let a=0;a!==r;++a){let r=t+a;e[r]=e[r]*s+e[i+a]*n}}_lerpAdditive(e,t,i,n,r){for(let s=0;s!==r;++s){let r=t+s;e[r]=e[r]+e[i+s]*n}}},ch="\\[\\]\\.:\\/",hh=new RegExp("["+ch+"]","g"),dh="[^"+ch+"]",uh="[^"+ch.replace("\\.","")+"]",ph=/((?:WC+[\/:])*)/.source.replace("WC",dh),fh=/(WCOD+)?/.source.replace("WCOD",uh),mh=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",dh),gh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",dh),vh=new RegExp("^"+ph+fh+mh+gh+"$"),yh=["material","materials","bones","map"],bh=class{constructor(e,t,i){this.path=t,this.parsedPath=i||bh.parseTrackName(t),this.node=bh.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new bh.Composite(e,t,i):new bh(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(hh,"")}static parseTrackName(e){let t=vh.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){let e=i.nodeName.substring(n+1);-1!==yh.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){let i=function(e){for(let n=0;n<e.length;n++){let r=e[n];if(r.name===t||r.uuid===t)return r;let s=i(r.children);if(s)return s}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(e=bh.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}let s=e[n];if(void 0===s){let i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};bh.Composite=class{constructor(e,t,i){let n=i||bh.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},bh.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},bh.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},bh.prototype.GetterByBindingType=[bh.prototype._getValue_direct,bh.prototype._getValue_array,bh.prototype._getValue_arrayElement,bh.prototype._getValue_toArray],bh.prototype.SetterByBindingTypeAndVersioning=[[bh.prototype._setValue_direct,bh.prototype._setValue_direct_setNeedsUpdate,bh.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[bh.prototype._setValue_array,bh.prototype._setValue_array_setNeedsUpdate,bh.prototype._setValue_array_setMatrixWorldNeedsUpdate],[bh.prototype._setValue_arrayElement,bh.prototype._setValue_arrayElement_setNeedsUpdate,bh.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[bh.prototype._setValue_fromArray,bh.prototype._setValue_fromArray_setNeedsUpdate,bh.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Ah=class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;let r=t.tracks,s=r.length,a=new Array(s),o={endingStart:Nt,endingEnd:Nt};for(let l=0;l!==s;++l){let e=r[l].createInterpolant(null);a[l]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let i=this._clip.duration,n=e._clip.duration,r=n/i,s=i/n;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let n=this._mixer,r=n.time,s=this.timeScale,a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);let r=this._startTime;if(null!==r){let n=(e-r)*i;n<0||0===i?t=0:(this._startTime=null,t=i*n)}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(s),t[i].accumulateAdditive(a);else for(let i=0,r=e.length;i!==r;++i)e[i].evaluate(s),t[i].accumulate(n,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(null!==i){let n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(null!==i){t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,n=this.time+e,r=this._loopCount,s=i===Rt;if(0===e)return-1===r?n:s&&1===(1&r)?t-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=t||n<0){let i=Math.floor(n/t);n-=t*i,r+=Math.abs(i);let a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){let t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1===(1&r))return t-n}return n}_setEndings(e,t,i){let n=this._interpolantSettings;i?(n.endingStart=kt,n.endingEnd=kt):(n.endingStart=e?this.zeroSlopeAtStart?kt:Nt:Ft,n.endingEnd=t?this.zeroSlopeAtEnd?kt:Nt:Ft)}_scheduleFading(e,t,i){let n=this._mixer,r=n.time,s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=t,a[1]=r+e,o[1]=i,this}},xh=new Float32Array(1),wh=class extends Zt{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,s=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];void 0===c&&(c={},l[o]=c);for(let h=0;h!==r;++h){let e=n[h],r=e.name,l=c[r];if(void 0!==l)++l.referenceCount,s[h]=l;else{if(l=s[h],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,r));continue}let n=t&&t._propertyBindings[h].binding.parsedPath;l=new lh(bh.create(i,r,n),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,o,r),s[h]=l}a[h].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}let t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){let i=t[e];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){let i=t[e];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){let n=this._actions,r=this._actionsByClip,s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{let t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;let r=e._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){let e=t[i];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){let n=this._bindingsByRootAndName,r=this._bindings,s=n[t];void 0===s&&(s={},n[t]=s),s[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[n],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[r],0===Object.keys(a).length&&delete s[n]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&(i=new wc(new Float32Array(2),new Float32Array(2),1,xh),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){let n=t||this._root,r=n.uuid,s="string"==typeof e?Rc.findByName(n,e):e,a=null!==s?s.uuid:e,o=this._actionsByClip[a],l=null;if(void 0===i&&(i=null!==s?s.blendMode:Ut),void 0!==o){let e=o.actionByRoot[r];if(void 0!==e&&e.blendMode===i)return e;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;let c=new Ah(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(e,t){let i=t||this._root,n=i.uuid,r="string"==typeof e?Rc.findByName(i,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[n]||null}stopAllAction(){let e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(n,e,r,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){let e=r.knownActions;for(let i=0,n=e.length;i!==n;++i){let n=e[i];this._deactivateAction(n);let r=n._cacheIndex,s=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let r in i){let e=i[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}let n=this._bindingsByRootAndName[t];if(void 0!==n)for(let r in n){let e=n[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){let i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}},Sh=class{constructor(e){this.value=e}clone(){return new Sh(void 0===this.value.clone?this.value:this.value.clone())}},_h=class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new yn(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new Pn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Ch(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(Eh),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let n=0,r=e.length;n<r;n++)Ch(e[n],this,i,t);return i.sort(Eh),i}};function Eh(e,t){return e.distance-t.distance}function Ch(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){let n=e.children;for(let e=0,r=n.length;e<r;e++)Ch(n[e],t,i,!0)}}var Mh=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ri(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},Th=new pi,Ih=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pi(1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pi(-1/0,-1/0);this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Th.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Th.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Ph=new Vi,Dh=new Vi,Rh=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vi;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Ph.subVectors(e,this.start),Dh.subVectors(this.end,this.start);let i=Dh.dot(Dh),n=Dh.dot(Ph)/i;return t&&(n=ri(n,0,1)),n}closestPointToPoint(e,t,i){let n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},Bh=new Vi,Lh=class extends Hn{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new yr,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let e=s/o*Math.PI*2,t=a/o*Math.PI*2;n.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}i.setAttribute("position",new hr(n,3));let r=new Zo({fog:!1,toneMapped:!1});this.cone=new ol(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Bh.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Bh),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Oh=class extends Rr{constructor(e,t,i){super(new hc(t,4,2),new rr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Nh=new Vi,kh=new Vi,Fh=new Vi,Uh=class extends Hn{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",void 0===t&&(t=1);let n=new yr;n.setAttribute("position",new hr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let r=new Zo({fog:!1,toneMapped:!1});this.lightPlane=new rl(n,r),this.add(this.lightPlane),n=new yr,n.setAttribute("position",new hr([0,0,0,0,0,1],3)),this.targetLine=new rl(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Nh.setFromMatrixPosition(this.light.matrixWorld),kh.setFromMatrixPosition(this.light.target.matrixWorld),Fh.subVectors(kh,Nh),this.lightPlane.lookAt(kh),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(kh),this.targetLine.scale.z=Fh.length()}},zh=new Vi,jh=new zr,Vh=class extends ol{constructor(e){let t=new yr,i=new Zo({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={};function a(e,t){o(e),o(t)}function o(e){n.push(0,0,0),r.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(n.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new hr(n,3)),t.setAttribute("color",new hr(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new Pi(16755200),c=new Pi(16711680),h=new Pi(43775),d=new Pi(16777215),u=new Pi(3355443);this.setColors(l,c,h,d,u)}setColors(e,t,i,n,r){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,n.r,n.g,n.b),s.setXYZ(39,n.r,n.g,n.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap;jh.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Gh("c",t,e,jh,0,0,-1),Gh("t",t,e,jh,0,0,1),Gh("n1",t,e,jh,-1,-1,-1),Gh("n2",t,e,jh,1,-1,-1),Gh("n3",t,e,jh,-1,1,-1),Gh("n4",t,e,jh,1,1,-1),Gh("f1",t,e,jh,-1,-1,1),Gh("f2",t,e,jh,1,-1,1),Gh("f3",t,e,jh,-1,1,1),Gh("f4",t,e,jh,1,1,1),Gh("u1",t,e,jh,.7,1.1,-1),Gh("u2",t,e,jh,-.7,1.1,-1),Gh("u3",t,e,jh,0,2,-1),Gh("cf1",t,e,jh,-1,0,1),Gh("cf2",t,e,jh,1,0,1),Gh("cf3",t,e,jh,0,-1,1),Gh("cf4",t,e,jh,0,1,1),Gh("cn1",t,e,jh,-1,0,-1),Gh("cn2",t,e,jh,1,0,-1),Gh("cn3",t,e,jh,0,-1,-1),Gh("cn4",t,e,jh,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Gh(e,t,i,n,r,s,a){zh.set(r,s,a).unproject(n);let o=t[e];if(void 0!==o){let e=i.getAttribute("position");for(let t=0,i=o.length;t<i;t++)e.setXYZ(o[t],zh.x,zh.y,zh.z)}}var Hh=class extends ol{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960,i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new yr;n.setIndex(new or(i,1)),n.setAttribute("position",new hr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Zo({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},Wh=class extends ol{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new yr;i.setAttribute("position",new hr(t,3)),i.setAttribute("color",new hr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new Zo({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,i){let n=new Pi,r=this.geometry.attributes.color.array;return n.set(e),n.toArray(r,0),n.toArray(r,3),n.set(t),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},Qh=function(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){let e=l-127;e<-27?(n[l]=0,n[256|l]=32768,r[l]=24,r[256|l]=24):e<-14?(n[l]=1024>>-e-14,n[256|l]=1024>>-e-14|32768,r[l]=-e-1,r[256|l]=-e-1):e<=15?(n[l]=e+15<<10,n[256|l]=e+15<<10|32768,r[l]=13,r[256|l]=13):e<128?(n[l]=31744,n[256|l]=64512,r[l]=24,r[256|l]=24):(n[l]=31744,n[256|l]=64512,r[l]=13,r[256|l]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,s[l]=e|t}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}();var qh=Object.freeze({__proto__:null,fromHalfFloat:function(e){let t=e>>10;return Qh.uint32View[0]=Qh.mantissaTable[Qh.offsetTable[t]+(1023&e)]+Qh.exponentTable[t],Qh.floatView[0]},toHalfFloat:function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=ri(e,-65504,65504),Qh.floatView[0]=e;let t=Qh.uint32View[0],i=t>>23&511;return Qh.baseTable[i]+((8388607&t)>>Qh.shiftTable[i])}});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:x}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=x);var Xh=".",Yh=Symbol("target"),Kh=Symbol("unsubscribe");function Jh(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}var Zh=Array.isArray;function $h(e){return"symbol"==typeof e}var ed={after:(e,t)=>Zh(e)?e.slice(t.length):""===t?e:e.slice(t.length+1),concat:(e,t)=>Zh(e)?(e=[...e],t&&e.push(t),e):t&&void 0!==t.toString?(""!==e&&(e+=Xh),$h(t)?e+t.toString():e+t):e,initial:e=>{if(Zh(e))return e.slice(0,-1);if(""===e)return e;let t=e.lastIndexOf(Xh);return-1===t?"":e.slice(0,t)},last:e=>{if(Zh(e))return e[e.length-1]||"";if(""===e)return e;let t=e.lastIndexOf(Xh);return-1===t?e:e.slice(t+1)},walk:(e,t)=>{if(Zh(e))for(let i of e)t(i);else if(""!==e){let i=0,n=e.indexOf(Xh);if(-1===n)t(e);else for(;i<e.length;)-1===n&&(n=e.length),t(e.slice(i,n)),i=n+1,n=e.indexOf(Xh,i)}},get(e,t){return this.walk(t,(t=>{e&&(e=e[t])})),e}},td=ed;function id(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&$h(i)||t.ignoreUnderscores&&"_"===i.charAt(0)||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var nd=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return void 0===this._descriptorCache&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),n=i[t];return void 0===n&&(n=Reflect.getOwnPropertyDescriptor(e,t),i[t]=n),n}getProxy(e,t,i,n){if(this.isUnsubscribed)return e;let r=e[n],s=r||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return void 0===a&&(a=void 0===r?new Proxy(e,i):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,td.get(t,this.getPath(e)))}defineProperty(e,t,i){return!!Reflect.defineProperty(e,t,i)&&(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0)}setProperty(e,t,i,n,r){if(!this._equals(r,i)||!(t in e)){let r=this._getOwnPropertyDescriptor(e,t);return void 0!==r&&"set"in r?Reflect.set(e,t,i,n):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let n=this._getDescriptorCache().get(e);n&&(delete n[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let n=this._getOwnPropertyDescriptor(t,i);return void 0!==e&&void 0!==n&&Object.is(e.value,n.value)&&(e.writable||!1)===(n.writable||!1)&&(e.enumerable||!1)===(n.enumerable||!1)&&(e.configurable||!1)===(n.configurable||!1)&&e.get===n.get&&e.set===n.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return void 0!==i&&!0!==i.configurable&&!0!==i.writable}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function rd(e){return"[object Object]"===toString.call(e)}function sd(){return!0}function ad(e,t){return e.length!==t.length||e.some(((e,i)=>t[i]!==e))}var od=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),ld=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),cd={push:sd,pop:sd,shift:sd,unshift:sd,copyWithin:ad,reverse:ad,sort:ad,splice:ad,flat:ad,fill:ad},hd=new Set([...od,...ld,...Object.keys(cd)]);function dd(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var ud=["keys","values","entries"],pd=new Set(["has","toString"]),fd={add:dd,clear:dd,delete:dd,forEach:dd},md=new Set([...pd,...Object.keys(fd),...ud]);function gd(e,t){if(e.size!==t.size)return!0;let i;for(let[n,r]of e)if(i=t.get(n),i!==r||void 0===i&&!t.has(n))return!0;return!1}var vd=new Set([...pd,"get"]),yd={set:gd,clear:gd,delete:gd,forEach:gd},bd=new Set([...vd,...Object.keys(yd),...ud]),Ad=class{constructor(e,t,i,n){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=n,this._changes=n?[]:null,this.clone=void 0===t?e:this._shallowClone(e)}static isHandledMethod(e){return od.has(e)}_shallowClone(e){let t=e;if(rd(e))t={...e};else if(Zh(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map((e=>this._shallowClone(e))));else if(e instanceof Map){t=new Map;for(let[i,n]of e.entries())t.set(i,this._shallowClone(n))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,n){return e?(Zh(n)?this._onIsChanged=cd[t]:n instanceof Set?this._onIsChanged=fd[t]:n instanceof Map&&(this._onIsChanged=yd[t]),n):i}update(e,t,i){let n=td.after(e,this._path);if("length"!==t){let e=this.clone;td.walk(n,(t=>{e&&e[t]&&(this._clonedCache.has(e[t])||(e[t]=this._shallowClone(e[t])),e=e[t])})),this._hasOnValidate&&this._changes.push({path:n,property:t,previous:i}),e&&e[t]&&(e[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;-1!==i;i--)t=this._changes[i],td.get(e,t.path)[t.property]=t.previous}isChanged(e){return void 0===this._onIsChanged?this._isChanged:this._onIsChanged(this.clone,e)}},xd=class extends Ad{static isHandledMethod(e){return hd.has(e)}},wd=class extends Ad{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},Sd=class extends Ad{static isHandledMethod(e){return md.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},_d=class extends Ad{static isHandledMethod(e){return bd.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},Ed=class extends Ad{constructor(e,t,i,n){super(void 0,t,i,n),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},Cd=class extends Ad{constructor(e,t,i,n){super(void 0,t,i,n),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},Md=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return rd(e)||Zh(e)||Jh(e)}static isHandledMethod(e,t){return rd(e)?Ad.isHandledMethod(t):Zh(e)?xd.isHandledMethod(t):e instanceof Set?Sd.isHandledMethod(t):e instanceof Map?_d.isHandledMethod(t):Jh(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let n=Ad;Zh(e)?n=xd:e instanceof Date?n=wd:e instanceof Set?n=Sd:e instanceof Map?n=_d:e instanceof WeakSet?n=Ed:e instanceof WeakMap&&(n=Cd),this._stack.push(new n(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:n}=e,r=Md.isHandledMethod(i,n);return this._stack[this._stack.length-1].preferredThisArg(r,n,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){void 0!==this._previousClone&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},Td={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},Id=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i={...Td,...i};let n=Symbol("ProxyTarget"),{equals:r,isShallow:s,ignoreDetached:a,details:o}=i,l=new nd(r),c="function"==typeof i.onValidate,h=new Md(c),d=(e,t,n,r,s)=>!c||h.isCloning||!0===i.onValidate(td.concat(l.getPath(e),t),n,r,s),u=(t,n,r,s)=>{!id(l,i,n)&&(!a||!l.isDetached(t,e))&&p(l.getPath(t),n,r,s)},p=(e,i,n,r,s)=>{h.isCloning?h.update(e,i,r):t(td.concat(e,i),n,r,s)},f=e=>e&&(e[n]||e),m=(t,r,o,c)=>function(e){return("object"==typeof e?null===e:"function"!=typeof e)||e instanceof RegExp}(t)||"constructor"===o||s&&!Md.isHandledMethod(r,o)||id(l,i,o)||l.isGetInvariant(r,o)||a&&l.isDetached(r,e)?t:(void 0===c&&(c=l.getPath(r)),l.getProxy(t,td.concat(c,o),g,n)),g={get(e,t,i){if($h(t)){if(t===n||t===Yh)return e;if(t===Kh&&!l.isUnsubscribed&&0===l.getPath(e).length)return l.unsubscribe(),e}let r=Jh(e)?Reflect.get(e,t):Reflect.get(e,t,i);return m(r,e,t)},set(e,t,i,s){i=f(i);let a=e[n]||e,o=a[t];if(r(o,i)&&t in e)return!0;let c=d(e,t,i,o);return c&&l.setProperty(a,t,i,s,o)?(u(e,t,e[t],o),!0):!c},defineProperty(e,t,i){if(!l.isSameDescriptor(i,e,t)){let n=e[t];d(e,t,i.value,n)&&l.defineProperty(e,t,i,n)&&u(e,t,i.value,n)}return!0},deleteProperty(e,t){if(!Reflect.has(e,t))return!0;let i=Reflect.get(e,t),n=d(e,t,void 0,i);return n&&l.deleteProperty(e,t,i)?(u(e,t,void 0,i),!0):!n},apply(t,i,s){let a=i[n]||i;if(l.isUnsubscribed)return Reflect.apply(t,a,s);if((!1===o||!0!==o&&!o.includes(t.name))&&Md.isHandledType(a)){let n=td.initial(l.getPath(t)),o=Md.isHandledMethod(a,t.name);h.start(a,n,s);let c=Reflect.apply(t,h.preferredThisArg(t,i,a),o?s.map((e=>f(e))):s),u=h.isChanged(a,r),v=h.stop();if(Md.isHandledType(c)&&o&&(i instanceof Map&&"get"===t.name&&(n=td.concat(n,s[0])),c=l.getProxy(c,n,g)),u){let i={name:t.name,args:s,result:c},r=h.isCloning?td.initial(n):n,o=h.isCloning?td.last(n):"";d(td.get(e,r),o,a,v,i)?p(r,o,a,v,i):h.undo(a)}return(i instanceof Map||i instanceof Set)&&function(e){return"object"==typeof e&&"function"==typeof e.next}(c)?function(e,t,i,n,r){let s=e.next;if("entries"===t.name)e.next=function(){let e=s.call(this);return!1===e.done&&(e.value[0]=r(e.value[0],t,e.value[0],n),e.value[1]=r(e.value[1],t,e.value[0],n)),e};else if("values"===t.name){let a=i[Yh].keys();e.next=function(){let e=s.call(this);return!1===e.done&&(e.value=r(e.value,t,a.next().value,n)),e}}else e.next=function(){let e=s.call(this);return!1===e.done&&(e.value=r(e.value,t,e.value,n)),e};return e}(c,t,i,n,m):c}return Reflect.apply(t,i,s)}},v=l.getProxy(e,i.pathAsArray?[]:"",g);return t=t.bind(v),c&&(i.onValidate=i.onValidate.bind(v)),v};Id.target=e=>e&&e[Yh]||e,Id.unsubscribe=e=>e[Kh]||e;var Pd=Id,Dd="object"==typeof global&&global&&global.Object===Object&&global,Rd="object"==typeof self&&self&&self.Object===Object&&self,Bd=Dd||Rd||Function("return this")(),Ld=Bd.Symbol,Od=Object.prototype,Nd=Od.hasOwnProperty,kd=Od.toString,Fd=Ld?Ld.toStringTag:void 0;var Ud=function(e){var t=Nd.call(e,Fd),i=e[Fd];try{e[Fd]=void 0;var n=!0}catch{}var r=kd.call(e);return n&&(t?e[Fd]=i:delete e[Fd]),r},zd=Object.prototype.toString;var jd=function(e){return zd.call(e)},Vd=Ld?Ld.toStringTag:void 0;var Gd=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Vd&&Vd in Object(e)?Ud(e):jd(e)};var Hd=function(e){return null!=e&&"object"==typeof e};var Wd=function(e){return"symbol"==typeof e||Hd(e)&&"[object Symbol]"==Gd(e)};var Qd=function(e,t){for(var i=-1,n=null==e?0:e.length,r=Array(n);++i<n;)r[i]=t(e[i],i,e);return r},qd=Array.isArray,Xd=1/0,Yd=Ld?Ld.prototype:void 0,Kd=Yd?Yd.toString:void 0;var Jd=function e(t){if("string"==typeof t)return t;if(qd(t))return Qd(t,e)+"";if(Wd(t))return Kd?Kd.call(t):"";var i=t+"";return"0"==i&&1/t==-Xd?"-0":i},Zd=/\s/;var $d=function(e){for(var t=e.length;t--&&Zd.test(e.charAt(t)););return t},eu=/^\s+/;var tu=function(e){return e&&e.slice(0,$d(e)+1).replace(eu,"")};var iu=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},nu=/^[-+]0x[0-9a-f]+$/i,ru=/^0b[01]+$/i,su=/^0o[0-7]+$/i,au=parseInt;var ou=function(e){if("number"==typeof e)return e;if(Wd(e))return NaN;if(iu(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=iu(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=tu(e);var i=ru.test(e);return i||su.test(e)?au(e.slice(2),i?2:8):nu.test(e)?NaN:+e};var lu=function(e){return e};var cu=function(e){if(!iu(e))return!1;var t=Gd(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},hu=Bd["__core-js_shared__"],du=function(){var e=/[^.]+$/.exec(hu&&hu.keys&&hu.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var uu=function(e){return!!du&&du in e},pu=Function.prototype.toString;var fu=function(e){if(null!=e){try{return pu.call(e)}catch{}try{return e+""}catch{}}return""},mu=/^\[object .+?Constructor\]$/,gu=Function.prototype,vu=Object.prototype,yu=gu.toString,bu=vu.hasOwnProperty,Au=RegExp("^"+yu.call(bu).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var xu=function(e){return!(!iu(e)||uu(e))&&(cu(e)?Au:mu).test(fu(e))};var wu=function(e,t){return e?.[t]};var Su=function(e,t){var i=wu(e,t);return xu(i)?i:void 0},_u=Su(Bd,"WeakMap"),Eu=Object.create,Cu=function(){function e(){}return function(t){if(!iu(t))return{};if(Eu)return Eu(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),Mu=Cu;var Tu=function(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)};var Iu=function(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t},Pu=Date.now;var Du=function(e){var t=0,i=0;return function(){var n=Pu(),r=16-(n-i);if(i=n,r>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}};var Ru=function(e){return function(){return e}},Bu=function(){try{var e=Su(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Lu=Bu,Ou=Lu?function(e,t){return Lu(e,"toString",{configurable:!0,enumerable:!1,value:Ru(t),writable:!0})}:lu,Nu=Du(Ou);var ku=function(e,t){for(var i=-1,n=null==e?0:e.length;++i<n&&!1!==t(e[i],i,e););return e},Fu=/^(?:0|[1-9]\d*)$/;var Uu=function(e,t){var i=typeof e;return!!(t=t??9007199254740991)&&("number"==i||"symbol"!=i&&Fu.test(e))&&e>-1&&e%1==0&&e<t};var zu=function(e,t,i){"__proto__"==t&&Lu?Lu(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i};var ju=function(e,t){return e===t||e!==e&&t!==t},Vu=Object.prototype.hasOwnProperty;var Gu=function(e,t,i){var n=e[t];(!Vu.call(e,t)||!ju(n,i)||void 0===i&&!(t in e))&&zu(e,t,i)};var Hu=function(e,t,i,n){var r=!i;i||(i={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=n?n(i[o],e[o],o,i,e):void 0;void 0===l&&(l=e[o]),r?zu(i,o,l):Gu(i,o,l)}return i},Wu=Math.max;var Qu=function(e,t,i){return t=Wu(void 0===t?e.length-1:t,0),function(){for(var n=arguments,r=-1,s=Wu(n.length-t,0),a=Array(s);++r<s;)a[r]=n[t+r];r=-1;for(var o=Array(t+1);++r<t;)o[r]=n[r];return o[t]=i(a),Tu(e,this,o)}};var qu=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Xu=function(e){return null!=e&&qu(e.length)&&!cu(e)},Yu=Object.prototype;var Ku=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Yu)};var Ju=function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n};var Zu=function(e){return Hd(e)&&"[object Arguments]"==Gd(e)},$u=Object.prototype,ep=$u.hasOwnProperty,tp=$u.propertyIsEnumerable,ip=Zu(function(){return arguments}())?Zu:function(e){return Hd(e)&&ep.call(e,"callee")&&!tp.call(e,"callee")},np=ip;var rp=function(){return!1},sp="object"==typeof exports&&exports&&!exports.nodeType&&exports,ap=sp&&"object"==typeof module&&module&&!module.nodeType&&module,op=ap&&ap.exports===sp?Bd.Buffer:void 0,lp=(op?op.isBuffer:void 0)||rp,cp={};cp["[object Float32Array]"]=cp["[object Float64Array]"]=cp["[object Int8Array]"]=cp["[object Int16Array]"]=cp["[object Int32Array]"]=cp["[object Uint8Array]"]=cp["[object Uint8ClampedArray]"]=cp["[object Uint16Array]"]=cp["[object Uint32Array]"]=!0,cp["[object Arguments]"]=cp["[object Array]"]=cp["[object ArrayBuffer]"]=cp["[object Boolean]"]=cp["[object DataView]"]=cp["[object Date]"]=cp["[object Error]"]=cp["[object Function]"]=cp["[object Map]"]=cp["[object Number]"]=cp["[object Object]"]=cp["[object RegExp]"]=cp["[object Set]"]=cp["[object String]"]=cp["[object WeakMap]"]=!1;var hp=function(e){return Hd(e)&&qu(e.length)&&!!cp[Gd(e)]};var dp=function(e){return function(t){return e(t)}},up="object"==typeof exports&&exports&&!exports.nodeType&&exports,pp=up&&"object"==typeof module&&module&&!module.nodeType&&module,fp=pp&&pp.exports===up&&Dd.process,mp=function(){try{return pp&&pp.require&&pp.require("util").types||fp&&fp.binding&&fp.binding("util")}catch{}}(),gp=mp&&mp.isTypedArray,vp=gp?dp(gp):hp,yp=Object.prototype.hasOwnProperty;var bp=function(e,t){var i=qd(e),n=!i&&np(e),r=!i&&!n&&lp(e),s=!i&&!n&&!r&&vp(e),a=i||n||r||s,o=a?Ju(e.length,String):[],l=o.length;for(var c in e)(t||yp.call(e,c))&&(!a||!("length"==c||r&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Uu(c,l)))&&o.push(c);return o};var Ap=function(e,t){return function(i){return e(t(i))}},xp=Ap(Object.keys,Object),wp=Object.prototype.hasOwnProperty;var Sp=function(e){if(!Ku(e))return xp(e);var t=[];for(var i in Object(e))wp.call(e,i)&&"constructor"!=i&&t.push(i);return t};var _p=function(e){return Xu(e)?bp(e):Sp(e)};var Ep=function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t},Cp=Object.prototype.hasOwnProperty;var Mp=function(e){if(!iu(e))return Ep(e);var t=Ku(e),i=[];for(var n in e)"constructor"==n&&(t||!Cp.call(e,n))||i.push(n);return i};var Tp=function(e){return Xu(e)?bp(e,!0):Mp(e)},Ip=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pp=/^\w*$/;var Dp=function(e,t){if(qd(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!Wd(e))||(Pp.test(e)||!Ip.test(e)||null!=t&&e in Object(t))},Rp=Su(Object,"create");var Bp=function(){this.__data__=Rp?Rp(null):{},this.size=0};var Lp=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Op=Object.prototype.hasOwnProperty;var Np=function(e){var t=this.__data__;if(Rp){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return Op.call(t,e)?t[e]:void 0},kp=Object.prototype.hasOwnProperty;var Fp=function(e){var t=this.__data__;return Rp?void 0!==t[e]:kp.call(t,e)};var Up=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Rp&&void 0===t?"__lodash_hash_undefined__":t,this};function zp(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}zp.prototype.clear=Bp,zp.prototype.delete=Lp,zp.prototype.get=Np,zp.prototype.has=Fp,zp.prototype.set=Up;var jp=zp;var Vp=function(){this.__data__=[],this.size=0};var Gp=function(e,t){for(var i=e.length;i--;)if(ju(e[i][0],t))return i;return-1},Hp=Array.prototype.splice;var Wp=function(e){var t=this.__data__,i=Gp(t,e);return!(i<0)&&(i==t.length-1?t.pop():Hp.call(t,i,1),--this.size,!0)};var Qp=function(e){var t=this.__data__,i=Gp(t,e);return i<0?void 0:t[i][1]};var qp=function(e){return Gp(this.__data__,e)>-1};var Xp=function(e,t){var i=this.__data__,n=Gp(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this};function Yp(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}Yp.prototype.clear=Vp,Yp.prototype.delete=Wp,Yp.prototype.get=Qp,Yp.prototype.has=qp,Yp.prototype.set=Xp;var Kp=Yp,Jp=Su(Bd,"Map");var Zp=function(){this.size=0,this.__data__={hash:new jp,map:new(Jp||Kp),string:new jp}};var $p=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var ef=function(e,t){var i=e.__data__;return $p(t)?i["string"==typeof t?"string":"hash"]:i.map};var tf=function(e){var t=ef(this,e).delete(e);return this.size-=t?1:0,t};var nf=function(e){return ef(this,e).get(e)};var rf=function(e){return ef(this,e).has(e)};var sf=function(e,t){var i=ef(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this};function af(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}af.prototype.clear=Zp,af.prototype.delete=tf,af.prototype.get=nf,af.prototype.has=rf,af.prototype.set=sf;var of=af;function lf(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var i=function(){var n=arguments,r=t?t.apply(this,n):n[0],s=i.cache;if(s.has(r))return s.get(r);var a=e.apply(this,n);return i.cache=s.set(r,a)||s,a};return i.cache=new(lf.Cache||of),i}lf.Cache=of;var cf=lf;var hf=function(e){var t=cf(e,(function(e){return 500===i.size&&i.clear(),e})),i=t.cache;return t},df=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,uf=/\\(\\)?/g,pf=hf((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(df,(function(e,i,n,r){t.push(n?r.replace(uf,"$1"):i||e)})),t})),ff=pf;var mf=function(e){return null==e?"":Jd(e)};var gf=function(e,t){return qd(e)?e:Dp(e,t)?[e]:ff(mf(e))},vf=1/0;var yf=function(e){if("string"==typeof e||Wd(e))return e;var t=e+"";return"0"==t&&1/e==-vf?"-0":t};var bf=function(e,t){for(var i=0,n=(t=gf(t,e)).length;null!=e&&i<n;)e=e[yf(t[i++])];return i&&i==n?e:void 0};var Af=function(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e},xf=Ld?Ld.isConcatSpreadable:void 0;var wf=function(e){return qd(e)||np(e)||!!(xf&&e&&e[xf])};var Sf=function e(t,i,n,r,s){var a=-1,o=t.length;for(n||(n=wf),s||(s=[]);++a<o;){var l=t[a];i>0&&n(l)?i>1?e(l,i-1,n,r,s):Af(s,l):r||(s[s.length]=l)}return s};var _f=function(e){return(null==e?0:e.length)?Sf(e,1):[]};var Ef=function(e){return Nu(Qu(e,void 0,_f),e+"")},Cf=Ap(Object.getPrototypeOf,Object),Mf=Function.prototype,Tf=Object.prototype,If=Mf.toString,Pf=Tf.hasOwnProperty,Df=If.call(Object);var Rf=function(e){if(!Hd(e)||"[object Object]"!=Gd(e))return!1;var t=Cf(e);if(null===t)return!0;var i=Pf.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&If.call(i)==Df};var Bf=function(e,t,i){var n=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(i=i>r?r:i)<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(r);++n<r;)s[n]=e[n+t];return s};var Lf=function(){this.__data__=new Kp,this.size=0};var Of=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i};var Nf=function(e){return this.__data__.get(e)};var kf=function(e){return this.__data__.has(e)};var Ff=function(e,t){var i=this.__data__;if(i instanceof Kp){var n=i.__data__;if(!Jp||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new of(n)}return i.set(e,t),this.size=i.size,this};function Uf(e){var t=this.__data__=new Kp(e);this.size=t.size}Uf.prototype.clear=Lf,Uf.prototype.delete=Of,Uf.prototype.get=Nf,Uf.prototype.has=kf,Uf.prototype.set=Ff;var zf=Uf;var jf=function(e,t){return e&&Hu(t,_p(t),e)};var Vf=function(e,t){return e&&Hu(t,Tp(t),e)},Gf="object"==typeof exports&&exports&&!exports.nodeType&&exports,Hf=Gf&&"object"==typeof module&&module&&!module.nodeType&&module,Wf=Hf&&Hf.exports===Gf?Bd.Buffer:void 0,Qf=Wf?Wf.allocUnsafe:void 0;var qf=function(e,t){if(t)return e.slice();var i=e.length,n=Qf?Qf(i):new e.constructor(i);return e.copy(n),n};var Xf=function(e,t){for(var i=-1,n=null==e?0:e.length,r=0,s=[];++i<n;){var a=e[i];t(a,i,e)&&(s[r++]=a)}return s};var Yf=function(){return[]},Kf=Object.prototype.propertyIsEnumerable,Jf=Object.getOwnPropertySymbols,Zf=Jf?function(e){return null==e?[]:(e=Object(e),Xf(Jf(e),(function(t){return Kf.call(e,t)})))}:Yf,$f=Zf;var em=function(e,t){return Hu(e,$f(e),t)},tm=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Af(t,$f(e)),e=Cf(e);return t}:Yf,im=tm;var nm=function(e,t){return Hu(e,im(e),t)};var rm=function(e,t,i){var n=t(e);return qd(e)?n:Af(n,i(e))};var sm=function(e){return rm(e,_p,$f)};var am=function(e){return rm(e,Tp,im)},om=Su(Bd,"DataView"),lm=Su(Bd,"Promise"),cm=Su(Bd,"Set"),hm="[object Map]",dm="[object Promise]",um="[object Set]",pm="[object WeakMap]",fm="[object DataView]",mm=fu(om),gm=fu(Jp),vm=fu(lm),ym=fu(cm),bm=fu(_u),Am=Gd;(om&&Am(new om(new ArrayBuffer(1)))!=fm||Jp&&Am(new Jp)!=hm||lm&&Am(lm.resolve())!=dm||cm&&Am(new cm)!=um||_u&&Am(new _u)!=pm)&&(Am=function(e){var t=Gd(e),i="[object Object]"==t?e.constructor:void 0,n=i?fu(i):"";if(n)switch(n){case mm:return fm;case gm:return hm;case vm:return dm;case ym:return um;case bm:return pm}return t});var xm=Am,wm=Object.prototype.hasOwnProperty;var Sm=function(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&wm.call(e,"index")&&(i.index=e.index,i.input=e.input),i},_m=Bd.Uint8Array;var Em=function(e){var t=new e.constructor(e.byteLength);return new _m(t).set(new _m(e)),t};var Cm=function(e,t){var i=t?Em(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)},Mm=/\w*$/;var Tm=function(e){var t=new e.constructor(e.source,Mm.exec(e));return t.lastIndex=e.lastIndex,t},Im=Ld?Ld.prototype:void 0,Pm=Im?Im.valueOf:void 0;var Dm=function(e){return Pm?Object(Pm.call(e)):{}};var Rm=function(e,t){var i=t?Em(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)};var Bm=function(e,t,i){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return Em(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return Cm(e,i);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Rm(e,i);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return Tm(e);case"[object Symbol]":return Dm(e)}};var Lm=function(e){return"function"!=typeof e.constructor||Ku(e)?{}:Mu(Cf(e))};var Om=function(e){return Hd(e)&&"[object Map]"==xm(e)},Nm=mp&&mp.isMap,km=Nm?dp(Nm):Om;var Fm=function(e){return Hd(e)&&"[object Set]"==xm(e)},Um=mp&&mp.isSet,zm=Um?dp(Um):Fm,jm="[object Arguments]",Vm="[object Function]",Gm="[object Object]",Hm={};Hm[jm]=Hm["[object Array]"]=Hm["[object ArrayBuffer]"]=Hm["[object DataView]"]=Hm["[object Boolean]"]=Hm["[object Date]"]=Hm["[object Float32Array]"]=Hm["[object Float64Array]"]=Hm["[object Int8Array]"]=Hm["[object Int16Array]"]=Hm["[object Int32Array]"]=Hm["[object Map]"]=Hm["[object Number]"]=Hm[Gm]=Hm["[object RegExp]"]=Hm["[object Set]"]=Hm["[object String]"]=Hm["[object Symbol]"]=Hm["[object Uint8Array]"]=Hm["[object Uint8ClampedArray]"]=Hm["[object Uint16Array]"]=Hm["[object Uint32Array]"]=!0,Hm["[object Error]"]=Hm[Vm]=Hm["[object WeakMap]"]=!1;var Wm=function e(t,i,n,r,s,a){var o,l=1&i,c=2&i,h=4&i;if(n&&(o=s?n(t,r,s,a):n(t)),void 0!==o)return o;if(!iu(t))return t;var d=qd(t);if(d){if(o=Sm(t),!l)return Iu(t,o)}else{var u=xm(t),p=u==Vm||"[object GeneratorFunction]"==u;if(lp(t))return qf(t,l);if(u==Gm||u==jm||p&&!s){if(o=c||p?{}:Lm(t),!l)return c?nm(t,Vf(o,t)):em(t,jf(o,t))}else{if(!Hm[u])return s?t:{};o=Bm(t,u,l)}}a||(a=new zf);var f=a.get(t);if(f)return f;a.set(t,o),zm(t)?t.forEach((function(r){o.add(e(r,i,n,r,t,a))})):km(t)&&t.forEach((function(r,s){o.set(s,e(r,i,n,s,t,a))}));var m=d?void 0:(h?c?am:sm:c?Tp:_p)(t);return ku(m||t,(function(r,s){m&&(r=t[s=r]),Gu(o,s,e(r,i,n,s,t,a))})),o};var Qm=function(e){return Wm(e,5)};var qm=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Xm=function(e){return this.__data__.has(e)};function Ym(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new of;++t<i;)this.add(e[t])}Ym.prototype.add=Ym.prototype.push=qm,Ym.prototype.has=Xm;var Km=Ym;var Jm=function(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1};var Zm=function(e,t){return e.has(t)};var $m=function(e,t,i,n,r,s){var a=1&i,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(e),h=s.get(t);if(c&&h)return c==t&&h==e;var d=-1,u=!0,p=2&i?new Km:void 0;for(s.set(e,t),s.set(t,e);++d<o;){var f=e[d],m=t[d];if(n)var g=a?n(m,f,d,t,e,s):n(f,m,d,e,t,s);if(void 0!==g){if(g)continue;u=!1;break}if(p){if(!Jm(t,(function(e,t){if(!Zm(p,t)&&(f===e||r(f,e,i,n,s)))return p.push(t)}))){u=!1;break}}else if(f!==m&&!r(f,m,i,n,s)){u=!1;break}}return s.delete(e),s.delete(t),u};var eg=function(e){var t=-1,i=Array(e.size);return e.forEach((function(e,n){i[++t]=[n,e]})),i};var tg=function(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i},ig=Ld?Ld.prototype:void 0,ng=ig?ig.valueOf:void 0;var rg=function(e,t,i,n,r,s,a){switch(i){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new _m(e),new _m(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ju(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var o=eg;case"[object Set]":var l=1&n;if(o||(o=tg),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;n|=2,a.set(e,t);var h=$m(o(e),o(t),n,r,s,a);return a.delete(e),h;case"[object Symbol]":if(ng)return ng.call(e)==ng.call(t)}return!1},sg=Object.prototype.hasOwnProperty;var ag=function(e,t,i,n,r,s){var a=1&i,o=sm(e),l=o.length;if(l!=sm(t).length&&!a)return!1;for(var c=l;c--;){var h=o[c];if(!(a?h in t:sg.call(t,h)))return!1}var d=s.get(e),u=s.get(t);if(d&&u)return d==t&&u==e;var p=!0;s.set(e,t),s.set(t,e);for(var f=a;++c<l;){var m=e[h=o[c]],g=t[h];if(n)var v=a?n(g,m,h,t,e,s):n(m,g,h,e,t,s);if(!(void 0===v?m===g||r(m,g,i,n,s):v)){p=!1;break}f||(f="constructor"==h)}if(p&&!f){var y=e.constructor,b=t.constructor;y!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(p=!1)}return s.delete(e),s.delete(t),p},og="[object Arguments]",lg="[object Array]",cg="[object Object]",hg=Object.prototype.hasOwnProperty;var dg=function(e,t,i,n,r,s){var a=qd(e),o=qd(t),l=a?lg:xm(e),c=o?lg:xm(t),h=(l=l==og?cg:l)==cg,d=(c=c==og?cg:c)==cg,u=l==c;if(u&&lp(e)){if(!lp(t))return!1;a=!0,h=!1}if(u&&!h)return s||(s=new zf),a||vp(e)?$m(e,t,i,n,r,s):rg(e,t,l,i,n,r,s);if(!(1&i)){var p=h&&hg.call(e,"__wrapped__"),f=d&&hg.call(t,"__wrapped__");if(p||f){var m=p?e.value():e,g=f?t.value():t;return s||(s=new zf),r(m,g,i,n,s)}}return!!u&&(s||(s=new zf),ag(e,t,i,n,r,s))};var ug=function e(t,i,n,r,s){return t===i||(null==t||null==i||!Hd(t)&&!Hd(i)?t!==t&&i!==i:dg(t,i,n,r,e,s))};var pg=function(e,t){return null!=e&&t in Object(e)};var fg=function(e,t,i){for(var n=-1,r=(t=gf(t,e)).length,s=!1;++n<r;){var a=yf(t[n]);if(!(s=null!=e&&i(e,a)))break;e=e[a]}return s||++n!=r?s:!!(r=null==e?0:e.length)&&qu(r)&&Uu(a,r)&&(qd(e)||np(e))};var mg=function(e,t){return null!=e&&fg(e,t,pg)},gg=function(){return Bd.Date.now()},vg=Math.max,yg=Math.min;var bg=function(e,t,i){var n,r,s,a,o,l,c=0,h=!1,d=!1,u=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var i=n,s=r;return n=r=void 0,c=t,a=e.apply(s,i)}function f(e){var i=e-l;return void 0===l||i>=t||i<0||d&&e-c>=s}function m(){var e=gg();if(f(e))return g(e);o=setTimeout(m,function(e){var i=t-(e-l);return d?yg(i,s-(e-c)):i}(e))}function g(e){return o=void 0,u&&n?p(e):(n=r=void 0,a)}function v(){var e=gg(),i=f(e);if(n=arguments,r=this,l=e,i){if(void 0===o)return function(e){return c=e,o=setTimeout(m,t),h?p(e):a}(l);if(d)return clearTimeout(o),o=setTimeout(m,t),p(l)}return void 0===o&&(o=setTimeout(m,t)),a}return t=ou(t)||0,iu(i)&&(h=!!i.leading,s=(d="maxWait"in i)?vg(ou(i.maxWait)||0,t):s,u="trailing"in i?!!i.trailing:u),v.cancel=function(){void 0!==o&&clearTimeout(o),c=0,n=l=r=o=void 0},v.flush=function(){return void 0===o?a:g(gg())},v};var Ag=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};var xg=function(e,t){return e>t};var wg=function(e,t){return t.length<2?e:bf(e,Bf(t,0,-1))};var Sg=function(e,t){return ug(e,t)};var _g=function(e,t,i){for(var n=-1,r=e.length;++n<r;){var s=e[n],a=t(s);if(null!=a&&(void 0===o?a===a&&!Wd(a):i(a,o)))var o=a,l=s}return l};var Eg=function(e){return e&&e.length?_g(e,lu,xg):void 0};var Cg=function(e,t){return t=gf(t,e),null==(e=wg(e,t))||delete e[yf(Ag(t))]};var Mg=function(e){return Rf(e)?void 0:e},Tg=Ef((function(e,t){var i={};if(null==e)return i;var n=!1;t=Qd(t,(function(t){return t=gf(t,e),n||(n=t.length>1),t})),Hu(e,am(e),i),n&&(i=Wm(i,7,Mg));for(var r=t.length;r--;)Cg(i,t[r]);return i})),Ig=Tg;var Pg=function(e,t,i,n){if(!iu(e))return e;for(var r=-1,s=(t=gf(t,e)).length,a=s-1,o=e;null!=o&&++r<s;){var l=yf(t[r]),c=i;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(r!=a){var h=o[l];void 0===(c=n?n(h,l,o):void 0)&&(c=iu(h)?h:Uu(t[r+1])?[]:{})}Gu(o,l,c),o=o[l]}return e};var Dg=function(e,t,i){for(var n=-1,r=t.length,s={};++n<r;){var a=t[n],o=bf(e,a);i(o,a)&&Pg(s,gf(a,e),o)}return s};var Rg=function(e,t){return Dg(e,t,(function(t,i){return mg(e,i)}))},Bg=Ef((function(e,t){return null==e?{}:Rg(e,t)})),Lg=Bg;var Og=function(e,t,i){var n=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return iu(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),bg(e,t,{leading:n,maxWait:t,trailing:r})};function Ng(e){for(let t of Object.keys(e))void 0===e[t]&&delete e[t];return e}function kg(e,t){return Object.setPrototypeOf(e,t),e}var Fg=!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().includes(" electron/"),Ug=(Fg&&(()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");e?window.localStorage.setItem("desktop-app-version",e):window.localStorage.getItem("desktop-app-version")})(),!(typeof window>"u")&&window.navigator.platform.toUpperCase().includes("MAC")),zg=!(typeof window>"u")&&(/iPad|iPhone|iPod/.test(window.navigator.userAgent)||Ug&&"ontouchend"in document),jg=!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Vg=!(typeof window>"u")&&("ontouchstart"in window||navigator.maxTouchPoints>0),Gg=(()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)})(),Hg=Number((()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]})());function Wg(e){return Array.isArray(e)?e:[e]}function Qg(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function qg(e){return Ug?e.metaKey:e.ctrlKey}var Xg=[],Yg={},Kg={},Jg={};function Zg(e){Xg.includes(e)||Xg.push(e)}function $g(e){delete Yg[e.pointerId];for(let t=0;t<Xg.length;t++)if(Xg[t].pointerId===e.pointerId){Xg.splice(t,1);break}}function ev(e){if("touch"!==e.pointerType)return;let t=Yg[e.pointerId];void 0===t&&(t={x:0,y:0},Yg[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function tv(e){let t=e.pointerId===Xg[0].pointerId?Xg[1]:Xg[0];return Yg[t.pointerId]}function iv(e){Kg[e.key]=!0,Jg[e.key]=void 0===Jg[e.key]?1:Jg[e.key]+1}function nv(e){if(Ug&&Kg.Meta)for(let t in Kg)Kg[t]=!1;else Kg[e.key]=!1;Jg={}}var rv,sv,av=new Promise((e=>{rv=e}));function ov(){if(sv)return sv;return sv=async function(){let e=i.e(208).then(i.bind(i,1208)),[t,n]=await Promise.all([e,fetch("https://unpkg.com/@splinetool/navmesh-wasm@1.9.87/build/navmesh.wasm").then((e=>e.arrayBuffer()))]),r=t.default,s=await r({wasmBinary:n});rv(s)}()}var lv,cv,hv=new Promise((e=>{lv=e}));function dv(){if(cv)return cv;return cv=async function(){let e=await i.e(293).then(i.bind(i,7293));await e.init(),lv(e)}()}var uv=class{modifyById(e,t){let i=this;if(void 0===i[e])throw new Error("not expected");{let n={...i,[e]:t};return Object.setPrototypeOf(n,uv.prototype),n}}add(e,t){return this.runOp({type:1,id:e,data:t})?.data??this}runOp(e){let t=this;if(1===e.type){let i,n=t[e.id];i=void 0===n?{type:2,id:e.id}:{type:1,id:e.id,data:n};let{id:r,data:s}=e,a={...t,[r]:s};return Object.setPrototypeOf(a,uv.prototype),{data:a,actual:e,reverse:i}}if(2===e.type){let{id:i}=e,n=t[i];if(void 0===n)return null;{let r={...t};return Object.setPrototypeOf(r,uv.prototype),delete r[i],{data:r,actual:e,reverse:{type:1,id:i,data:n}}}}return null}};function pv(e){if(void 0!==e.deepFreeze)return void e.deepFreeze(e);let t=Object.getOwnPropertyNames(e);for(let i of t){let t=e[i];t&&"object"==typeof t&&pv(t)}return Object.freeze(e)}var fv=class extends Error{};function mv(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function gv(e,t,i){if(void 0===e?void 0===t?(e=0,t=10):e=t-10:void 0===t&&(t=e+10),e>t){let i=e;e=t,t=i}let n=[],r=1/(i+1);for(let s=0;s<i;s++){let i=e+(t-e)*(s+.75+.5*Math.random())*r;n.push(i)}return n}function vv(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function yv(e,t){for(let i of e)!0!==t(i.id,i.data)&&yv(i.children,t)}function bv(e,t){if(!0!==t(e.id,e.data))for(let i of e.children)bv(i,t)}var Av,xv=class extends Array{constructor(){super(...arguments),Object.setPrototypeOf(this,xv.prototype)}deepFreeze(){let e=0;for(;e<this.length;)pv(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(!t)return e;e=t}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){return this.get(e)?.data}has(e){return void 0!==this.childrenOf(e)}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){return null===e?this:this.get(e)?.children}traverseFrom(e,t){if(null===e)this.traverse(t);else{let i=this.get(e);i&&bv(i,t)}}traverse(e){yv(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return null===e?this:this.get(e).children}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let i=this.parent(e),n=this.childrenArray(i),r=n.findIndex((t=>t.id===e));if(r<0)throw new Error("not expected");let s=n[r];return n=[...n],n[r]={...s,data:t},this.modifyArrayBy(i,n)}}modifyArrayBy(e,t){let i=e,n=t;for(;null!==i;){let e=n,t=i;if(i=this.parent(i),void 0===i)throw new Error;n=this.childrenArray(i);let r=n.findIndex((e=>e.id===t));if(r<0)throw new Error;n=[...n],n[r]={...n[r],children:e}}Object.setPrototypeOf(n,xv.prototype);let r=n;return r.fillCaches(),r}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec(e){let{id:t,children:i}=e;if(void 0!==this.get(t))return!0;for(let n of i)if(this.checkDuplicatedIdRec(n))return!0;return!1}addOp(e){let{parent:t,fi:i,id:n,data:r,children:s}=e;if(null!==t&&void 0===this.get(t))return null;if(this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:i,id:n,data:r,children:s};return o=[...o,l],o.sort(((e,t)=>e.fi-t.fi)),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:n}}}}deleteOp(e){let{id:t}=e;if(null===this.get(t))return null;{let i=this.parent(t);if(void 0===i)return null;let n=this.childrenArray(i),r=n.findIndex((e=>e.id===t));e.localIndex=r,n=[...n];let s=n.splice(r,1)[0];return{data:this.modifyArrayBy(i,n),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:n}=e;if(null!==t&&void 0===this.get(t))return this.deleteOp({type:8,id:n});if(null!==t){let e=t;for(;null!==e;){if(void 0===e)throw new Error;if(e===n)throw new fv("cyclic tree");e=this.parent(e)}}let r=this.parent(n);if(void 0===r)return null;let s=r,a=this.childrenArray(r),o=a.findIndex((e=>e.id===n));a=[...a];let l=a.splice(o,1)[0],c=this.modifyArrayBy(r,a);r=t,a=c.childrenArray(r);let h=l.fi;return l={...l,fi:i},a=[...a,l],a.sort(((e,t)=>e.fi-t.fi)),e.localIndex=a.indexOf(l),c=c.modifyArrayBy(r,a),{data:c,actual:e,reverse:{type:9,parent:s,fi:h,id:n}}}previous(e,t){if(null===t){let t=this.childrenArray(e);return 0===t.length?null:t[t.length-1].id}let i=null;for(let n of this.childrenArray(e)){if(n.id===t)return i;i=n.id}return null}traverseSortNext(e){let t=this.parent(e);if(void 0!==t){let i=this.childrenArray(t),n=i.findIndex((t=>t.id===e))+1;if(n<i.length)return i[n].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(void 0!==t){let i=this.childrenArray(t),n=i.findIndex((t=>t.id===e))-1;return n>=0?this.traverseSortPrevious(i[n].id):t}}getAllSorted(e){let t=[];for(let i of e){let e=this.getWithSortKey(i.id);void 0!==e&&t.push({...i,...e})}t.sort(((e,t)=>function(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}(e.sortKey,t.sortKey)));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],n=this.get(t),r=n;if(void 0!==n){for(;t;)i.splice(0,0,n.fi),null!==(t=this.parent(t))&&(n=this.get(t));return{...r,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let n=this.childrenArray(e);if(null===t){if(0===n.length)return gv(0,i,i);{let e=n[0].fi;return gv(e-i,e,i)}}{let r=this.get(t);if(void 0===r||this.parent(t)!==e)throw new Error("illegal args");let s=n.find((e=>e.fi>r.fi));if(void 0===s){let e=n[n.length-1].fi;return gv(e,e+i,i)}return gv(r.fi,s.fi,i)}}};(e=>{e.runOp=function(e,t){if(0!==t.type)return null;if(Array.isArray(e)){let i=t.props,n={},r=[...e],s=!1;if(i)for(let e of Object.keys(i)){let t=parseInt(e);if(isNaN(t))throw new Error("wrong index");n[e]=r[t],r[t]=i[e],s=!0}return s?{data:r,actual:t,reverse:{type:0,props:n}}:null}{let i=t.props,n={},r={...e},s=!1;if(i)for(let e of Object.keys(i)){n[e]=r[e];let t=i[e];void 0===t?delete r[e]:r[e]=t,s=!0}return s?{data:r,actual:t,reverse:{type:0,props:n}}:null}}})(Av||(Av={}));var wv=class extends Array{constructor(){super(...arguments),Object.setPrototypeOf(this,wv.prototype)}deepFreeze(){let e=0;for(;e<this.length;)pv(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){return this.get(e)?.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let i=this,n=i.findIndex((t=>t.id===e));if(n<0)throw new Error("not expected");let r=i[n];return i=[...i],i[n]={...r,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,wv.prototype);let t=e;return typeof process<"u"||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:n}=e,r=this,s={fi:t,id:i,data:n};return r=[...r,s],r.sort(((e,t)=>e.fi-t.fi)),e.localIndex=r.indexOf(s),{data:this.modifyArrayBy(r),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,n=i.findIndex((e=>e.id===t));if(-1===n)return null;e.localIndex=n,i=[...i];let r=i.splice(n,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...r}}}moveOp(e){let{fi:t,id:i}=e,n=this;n=[...n];let r=n.findIndex((e=>e.id===i));if(-1===r)return null;let s=n[r].fi,a={...n[r],fi:t};return n[r]=a,n.sort(((e,t)=>e.fi-t.fi)),e.localIndex=n.indexOf(a),{data:this.modifyArrayBy(n),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(null===e)return 0===this.length?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(null===e){if(0===i.length)return gv(0,t,t);{let e=i[0].fi;return gv(e-t,e,t)}}{let n=this.get(e);if(void 0===n)throw new Error("illegal args");let r=i.find((e=>e.fi>n.fi));if(void 0===r){let e=i[i.length-1].fi;return gv(e,e+t,t)}return gv(n.fi,r.fi,t)}}};function Sv(e){return e&&"object"==typeof e&&e instanceof Iv}var _v,Ev,Cv,Mv,Tv,Iv=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,n=0,r={};for(;n<e.path.length;){if(t.push(i),i=void 0===i?void 0:i[e.path[n]],void 0!==i&&!Sv(i))return null;n+=1}i=i?mv(i):new Iv;for(let[s,a]of Object.entries(e.props)){let e=i[s];r[s]=e,void 0===a?delete i[s]:i[s]=a}for(;n>0;){if(0===Object.keys(i).length){let r=t[n-1];r&&(i=mv(r),delete i[e.path[n-1]])}else{let r=t[n-1];if(r){let t=mv(r);t[e.path[n-1]]=i,i=t}else{let t=new Iv;t[e.path[n-1]]=i,i=t}}n-=1}return{data:Object.setPrototypeOf(i,Iv.prototype),actual:e,reverse:{...e,props:r}}}};function Pv(e,t){if(void 0===t)return;let i=!1,n=e.map((e=>{let n=e.id,r=Dv(e.data,t[n]);if(i=i||void 0!==r,void 0===r&&(r=e.data),e.children){let s=Pv(e.children,t);return void 0!==s?i=!0:s=e.children,{...e,id:n,data:r,children:s}}return{...e,id:n,data:r}}));return i?n:void 0}function Dv(e,t){if(!Sv(t))return t;if(e instanceof xv){let i=Pv(e,t);return void 0!==i&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}if(e instanceof wv)return function(e,t){if(void 0===t)return;let i=!1,n=e.map((e=>{let n=e.id,r=Dv(e.data,t[n]);return i=i||void 0!==r,void 0===r&&(r=e.data),{...e,id:n,data:r}}));return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}(e,t);if(Array.isArray(e)){let i=!1,n=e.map(((e,n)=>{let r=Dv(e,t[n]);return i=i||void 0!==r,void 0===r&&(r=e),r}));return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}if(e instanceof Iv)return Rv(e,t);if(e&&"object"==typeof e){let i={},n=!1;for(let[r,s]of Object.entries(e)){let e=Dv(s,t[r]);n=n||void 0!==e,void 0===e&&(e=s),i[r]=e}return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}function Rv(e,t){if(void 0===e)return t;if(void 0===t)return e;if(!Sv(t))return t;if(!Sv(e))return _v.apply(e,t);let i=new Set;for(let r of Object.keys(e))i.add(r);for(let r of Object.keys(t))i.add(r);let n=new Iv;for(let r of i){let i=Rv(void 0===e?void 0:e[r],void 0===t?void 0:t[r]);n[r]=i}return n}function Bv(e,t){let i={cur:[],result:[],len:0};return[e=kv(e,t,i)??e,i.result]}function Lv(e,t){return null===e?null:(e.cur[e.len]=t,e.len+=1,e)}function Ov(e){e&&(e.len-=1)}function Nv(e,t,i){let n=!1,r=e.map((e=>{let r=e.id,s=t[r];if(void 0!==s&&"string"==typeof s&&(n=!0,r=s,null!==i))throw new Error("not supported");let a=kv(e.data,t,Lv(i,r));Ov(i),n=n||void 0!==a,void 0===a&&(a=e.data);let o=Nv(e.children,t,i);return void 0!==o?n=!0:o=e.children,{...e,id:r,data:a,children:o}}));if(n)return r}function kv(e,t,i){if(e instanceof xv){let n=Nv(e,t,i);return void 0!==n&&Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}if(e instanceof wv)return function(e,t,i){let n=!1,r=e.map((e=>{let r=e.id,s=t[r];if(void 0!==s&&"string"==typeof s&&(n=!0,r=s,null!==i))throw new Error("not supported");let a=kv(e.data,t,Lv(i,r));return Ov(i),n=n||void 0!==a,void 0===a&&(a=e.data),{...e,id:r,data:a}}));if(n)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}(e,t,i);if(Array.isArray(e)){let n=!1,r=e.map(((e,r)=>{let s=kv(e,t,Lv(i,r));return Ov(i),n=n||void 0!==s,void 0===s&&(s=e),s}));return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}if(e&&"object"==typeof e&&!vv(e)){let n={},r=!1;for(let[s,a]of Object.entries(e))if("name"!==s&&"variableId"!==s){let e=t[s];if("string"==typeof e){if(null!==i)throw new Error("not supported");r=!0,s=e}let o=kv(a,t,Lv(i,s));Ov(i),r=r||void 0!==o,void 0===o&&(o=a),n[s]=o}else n[s]=a;return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}if("string"==typeof e){let n=t[e];return void 0!==n&&function(e){if(null===e)return null;e.result.push(e.cur.slice(0,e.len))}(i),n}}(Ev=_v||(_v={})).apply=function(e,t){return Dv(e,t)??e},Ev.merge=function(e,t){return Rv(e,t)},Ev.filterOp=function(e,t){let i=0,n=t.path,r=e;for(;i<n.length&&void 0!==r;){if(r=Kv.zoomOnce(r,n[i]),void 0===r)return t;if(!Sv(r))return;i+=1}if(void 0===r)return t;if(Sv(r)){if(0===t.type){let e={...t.props};for(let t of Object.keys(r))delete e[t];return{...t,props:e}}if(1===t.type||4===t.type||7===t.type){let e=Pv([t],r);return e?(console.log(e),e):t}return t}},(e=>{e.replaceProps=function(e,t){let i=Kv.zoom(t,e.path);if("object"==typeof i){let t={};for(let n of Object.keys(e.props))t[n]=i[n];return{...e,props:t}}return{...e,props:{}}}})(Cv||(Cv={})),(e=>{function t(e,t){let i=t.path;for(var n=[];;){let r;if(e instanceof Iv&&0===t.type&&(r=e.runOp({...t,path:i.slice(n.length)}),null===r&&(r=void 0)),void 0===r&&n.length===i.length&&(r=e instanceof xv||e instanceof wv||e instanceof uv?e.runOp(t):Av.runOp(e,t)),void 0!==r){if(null!==r){let e=r.data;for(let t=n.length-1;t>=0;t--){let r=i[t],s=n[t];if(s instanceof xv){if("number"==typeof r)throw new Error("illegal arg");e=s.modifyById(r,e)}else if(s instanceof wv){if("number"==typeof r)throw new Error("illegal arg");e=s.modifyById(r,e)}else if(s instanceof uv){if("number"==typeof r)throw new Error("illegal arg");e=s.modifyById(r,e)}else if(s instanceof Iv){let t={...s,[r]:e};e=Object.setPrototypeOf(t,Iv.prototype)}else{if("object"!=typeof s)return null;if(Array.isArray(s)){if("string"==typeof r&&(r=parseInt(r),isNaN(r)))throw new Error("Invalid path");let t=e;e=[...s],e[r]=t}else e={...s,[r]:e}}}return{data:e,actual:{...r.actual,path:i},reverse:{...r.reverse,path:i}}}return null}let s,a=i[n.length];if(e instanceof xv){if("number"==typeof a)throw new Error("");s=e.get(a)?.data}else if(e instanceof wv){if("number"==typeof a)throw new Error("");s=e.get(a)?.data}else null!==e&&(s=e[a]);if(void 0===s)return null;n.push(e),e=s}}function i(e,t){for(let i=0;i<e.length&&i<t.length;i++)if(e[i]!==t[i])return!0;return!1}function n(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}e.drop=function(e,t){return{...e,path:e.path.slice(t)}},e.applySimple=function(e,i){return t(e,i)?.data??e},e.apply=t,e.pathDisjoint=i,e.pathEq=n,e.commutative=function(e,t){return i(e.path,t.path)},e.subsumed=function(e,t){return!(0!==e.type||0!==t.type||!n(e.path,t.path))&&Object.keys(e.props).every((e=>void 0!==t.props[e]))}})(Mv||(Mv={})),(e=>{function t(e,t){var i=e;let n=[],r=[];for(let a of t)try{if(3===a.type||5===a.type&&"variables"===a.path[a.path.length-1]){let e,t,s;if(3===a.type?(e=Kv.zoom(i,[...a.path,a.id]),s=Mv.apply(i,{...a,type:2})):(e=Kv.zoom(i,[...a.path,a.id,"value"]),s=Mv.apply(i,a)),null!==s){i=s.data;let[o,l]=Bv(i,{[a.id]:e});i=o;for(let s=0;s<l.length;s++){let o=l[s],c=o.pop();if("number"==typeof c){let n=[c];for(let e=s+1;e<l.length;e++){let t=l[e],i=t[t.length-1];if("number"!=typeof i||!Kv.equal(o,t.slice(0,t.length-1)))break;n.push(i),l.splice(e,1)}let r=Kv.zoom(i,o);t=r.map(((e,t)=>n.includes(t)?a.id:e)),e=r,c=o.pop()}else{if("alphaOverride"===c||"alpha"===c){e/=100;let t=e,n=Kv.zoom(i,o.slice(0,o.length-2)),r=n.layers.map((e=>e.id===o[o.length-1]?{...e,data:{...e.data,[c]:t}}:e));Object.setPrototypeOf(r,Object.getPrototypeOf(n.layers)),n.layers=r}t=a.id}n.push({type:0,path:o,props:{[c]:e}}),r.push({type:0,path:o,props:{[c]:t}})}r.push(s.reverse),n.push(s.actual)}}else{let e=Mv.apply(i,a);null!==e&&(n.push(e.actual),i=e.data,r.push(e.reverse))}}catch(s){if(s instanceof fv)return null;throw s}return{data:i,actual:n,reverse:r.reverse()}}e.empty=function(){return[]},e.removePrefix=function(e,t){let i=[];for(let n of e){let[e,...r]=n.path;e===t&&i.push({...n,path:r})}return i},e.addPrefix=function(e,t){return e.map((e=>({...e,path:[t,...e.path]})))},e.concat=function(e,t){return[...e,...t]},e.compress=function(e,t){return[...e.filter((e=>!t.some((t=>Mv.subsumed(e,t))))),...t]},e.commutative=function(e,t){return e.every((e=>t.every((t=>Mv.commutative(e,t)))))},e.applyAll=function(e,i){for(let n of i){let i=t(e,n);null!==i&&(e=i.data)}return e},e.apply=t})(Tv||(Tv={}));var Fv=Symbol(),Uv=Symbol(),zv=Symbol(),jv=class{reportOp(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=this;if(null===t)return;n._current=t.data;let r=i;for(;!(n instanceof Jv);){let e=n._path,t=n._current;if(""!==e&&r.splice(0,0,e),n=n._parent,null===n)return;n.update(e,t)}n.push(r,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[zv];i&&i(),delete this._children[e]}}}},Vv=class extends jv{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if("string"==typeof e&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,Av.runOp(this._current,e),e.path)}},Gv=class extends jv{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,uv.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},Hv={get(e,t){if(t===zv)return()=>{e._parent=null};if(t===Fv)return e._current;if(t===Uv)return e;let{_current:i,_children:n}=e;if("push"===t&&Array.isArray(i))throw new Error("not supported to expand array");let r=void 0===n?void 0:n[t];if(void 0!==r)return r;let s=i[t],a=Zv(e,t,s);return a!==s?(void 0===n&&(n={},e._children=n),n[t]=a,a):s},has:(e,t)=>t in e._current,ownKeys:e=>Reflect.ownKeys(e._current),defineProperty(){throw Error("not supported")},getPrototypeOf:e=>Object.getPrototypeOf(e._current),setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,n=Reflect.getOwnPropertyDescriptor(i,t);return n&&{writable:!0,configurable:!0,enumerable:n.enumerable,value:i[t]}}},Wv={...Hv,set(e,t,i){let n={type:0,props:{[t]:ty(i)??i}};return e.deleteChildren(t),e.runOp(n),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},Qv={...Hv,set(e,t,i){return void 0===i?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty:(e,t)=>(e.runOp({type:2,id:t}),!0)},qv=class extends jv{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[zv]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse(((t,i)=>{e(t,this.data(t))}))}data(e){let{_current:t,_children:i}=this,n=void 0===i?void 0:i[e];if(void 0!==n)return n;let r=t.get(e)?.data,s=Zv(this,e,r);return s!==r?(void 0===i&&(i={},this._children=i),i[e]=s,s):r}add(e,t,i,n,r){this.runOp({type:7,parent:e,fi:t,id:i,data:n,children:r})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let n=this._current.insertAfterHelper(e,t,i.length);for(let r=0;r<i.length;r++){let t=i[r];this.add(e,n[r],t.id,t.data,t.children)}}insertBefore(e,t,i){let n=this._current.insertBeforeHelper(e,t,i.length);for(let r=0;r<i.length;r++){let t=i[r];this.add(e,n[r],t.id,t.data,t.children)}}moveAfter(e,t,i){let n=this._current.insertAfterHelper(e,t,i.length);for(let r=0;r<i.length;r++){let t=i[r];this.move(e,n[r],t)}}moveBefore(e,t,i){let n=this._current.insertBeforeHelper(e,t,i.length);for(let r=0;r<i.length;r++){let t=i[r];this.move(e,n[r],t)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},Xv=class extends jv{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[zv]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let t=this._current[i].id,n=this._current[i].fi;e(this.data(this._current[i].id),t,n)}}find(e){let t=this.length;for(let i=0;i<t;i++){let t=this._current[i].id;if(e(this.data(t),t))return this.get(t)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){let{_current:t,_children:i}=this,n=void 0===i?void 0:i[e];if(void 0!==n)return n;let r=t.get(e)?.data,s=Zv(this,e,r);return s!==r?(void 0===i&&(i={},this._children=i),i[e]=s,s):r}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.add(i[n],e.id,e.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.add(i[n],e.id,e.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.move(i[n],e)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.move(i[n],e)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function Yv(e,t,i){if(e.length>0){let n=e[e.length-1];if(0===n.type&&0===t.type&&Kv.equal(n.path,i))return void Object.assign(n.props,t.props)}e.push({...t,path:i})}var Kv,Jv=class extends jv{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(""!==e)throw new Error("");this._current=t}push(e,t,i,n){Yv(this.ts,t,e),Yv(this.actual,i,e),Yv(this.reverse,n,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function Zv(e,t,i){return i instanceof xv?new qv(e,t,i):i instanceof wv?new Xv(e,t,i):i instanceof uv?new Proxy(new Gv(e,t,i),Qv):null!==i&&"object"==typeof i?vv(i)?i:new Proxy(new Vv(e,t,i),Wv):i}function $v(e){let t=new Jv(e);return[Zv(t,"",e),t]}function ey(e,t){let[i,n]=$v(e);return t(i),n.result()}function ty(e){return e instanceof qv||e instanceof Xv?e._current:null!==e&&"object"==typeof e?e[Fv]:e}function iy(e,t){let i=[];if(!(t.length<=e.length))return null;for(var n=0;n<t.length;){if("*"===t[n])i.push(e[n]);else if(e[n]!==t[n])return null;n+=1}return i}(e=>{function t(e,t){return(e instanceof xv||e instanceof qv)&&"string"==typeof t||(e instanceof wv||e instanceof Xv)&&"string"==typeof t?e.data(t):"number"==typeof t&&Array.isArray(e)||"string"==typeof t&&"object"==typeof e&&null!==e?e[t]:void 0}function i(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;n<i.length&&void 0!==e;)e=t(e,i[n]),n+=1;return e}e.equal=function(e,t){if(t.length!==e.length)return!1;for(var i=0;i<e.length;){if(e[i]!==t[i])return!1;i+=1}return!0},e.removeOverridden=function(e,t,n){let r=i(n,e);if(void 0!==r&&"object"==typeof r&&null!==r){let e={...t};return Object.keys(r).forEach((t=>{delete e[t]})),e}return t},e.zoomOnce=t,e.zoom=i})(Kv||(Kv={}));var ny,ry=class{},sy=class extends ry{constructor(e){super(),this.id=e}},ay=class extends ry{constructor(e){super(),this.data=e}};try{ny=new TextDecoder}catch{}var oy,ly,cy,hy,dy,uy,py,fy=0,my=[],gy=my,vy=0,yy={},by=0,Ay=0,xy=[],wy={useRecords:!1,mapsAsObjects:!0},Sy=class{},_y=new Sy;_y.name="MessagePack 0xC1";var Ey=!1,Cy=class{constructor(e){e&&(!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(oy)return Jy((()=>(Zy(),this?this.unpack(e,t):Cy.prototype.unpack.call(wy,e,t))));ly=t>-1?t:e.length,fy=0,vy=0,Ay=0,hy=null,gy=my,dy=null,oy=e;try{py=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(Ev){throw oy=null,e instanceof Uint8Array?Ev:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof Cy){if(yy=this,this.structures)return cy=this.structures,My();(!cy||cy.length>0)&&(cy=[])}else yy=wy,(!cy||cy.length>0)&&(cy=[]);return My()}unpackMultiple(e,t){let i,n=0;try{Ey=!0;let r=e.length,s=this?this.unpack(e,r):tb.unpack(e,r);if(!t){for(i=[s];fy<r;)n=fy,i.push(My());return i}for(t(s);fy<r;)if(n=fy,!1===t(My()))return}catch(gA){throw gA.lastPosition=n,gA.values=i,gA}finally{Ey=!1,Zy()}}_mergeStructures(e,t){for(let i=0,n=(e=e||[]).length;i<n;i++){let t=e[i];t&&(t.isShared=!0,i>=32&&(t.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let n=e[i],r=t[i];r&&(n&&((e.restoreStructures||(e.restoreStructures=[]))[i]=n),e[i]=r)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function My(){try{if(!yy.trusted&&!Ey){let e=cy.sharedLength||0;e<cy.length&&(cy.length=e)}let e=Iy();if(fy==ly)cy.restoreStructures&&Ty(),cy=null,oy=null,uy&&(uy=null);else{if(fy>ly){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}if(!Ey)throw new Error("Data read, but end of buffer not reached")}return e}catch(vE){throw cy.restoreStructures&&Ty(),Zy(),(vE instanceof RangeError||vE.message.startsWith("Unexpected end of buffer"))&&(vE.incomplete=!0),vE}}function Ty(){for(let e in cy.restoreStructures)cy[e]=cy.restoreStructures[e];cy.restoreStructures=null}function Iy(){let e=oy[fy++];if(e<160){if(e<128){if(e<64)return e;{let t=cy[63&e]||yy.getStructures&&By()[63&e];return t?(t.read||(t.read=Dy(t,63&e)),t.read()):e}}if(e<144){if(e-=128,yy.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[qy()]=Iy();return t}{let t=new Map;for(let i=0;i<e;i++)t.set(Iy(),Iy());return t}}{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=Iy();return t}}if(e<192){let t=e-160;if(Ay>=fy)return hy.slice(fy-by,(fy+=t)-by);if(0==Ay&&ly<140){let e=t<16?Gy(t):Vy(t);if(null!=e)return e}return Ly(t)}{let t;switch(e){case 192:return null;case 193:return dy?(t=Iy(),t>0?dy[1].slice(dy.position1,dy.position1+=t):dy[0].slice(dy.position0,dy.position0-=t)):_y;case 194:return!1;case 195:return!0;case 196:return Hy(oy[fy++]);case 197:return t=py.getUint16(fy),fy+=2,Hy(t);case 198:return t=py.getUint32(fy),fy+=4,Hy(t);case 199:return Wy(oy[fy++]);case 200:return t=py.getUint16(fy),fy+=2,Wy(t);case 201:return t=py.getUint32(fy),fy+=4,Wy(t);case 202:if(t=py.getFloat32(fy),yy.useFloat32>2){let e=$y[(127&oy[fy])<<1|oy[fy+1]>>7];return fy+=4,(e*t+(t>0?.5:-.5)|0)/e}return fy+=4,t;case 203:return t=py.getFloat64(fy),fy+=8,t;case 204:return oy[fy++];case 205:return t=py.getUint16(fy),fy+=2,t;case 206:return t=py.getUint32(fy),fy+=4,t;case 207:return yy.int64AsNumber?(t=4294967296*py.getUint32(fy),t+=py.getUint32(fy+4)):t=py.getBigUint64(fy),fy+=8,t;case 208:return py.getInt8(fy++);case 209:return t=py.getInt16(fy),fy+=2,t;case 210:return t=py.getInt32(fy),fy+=4,t;case 211:return yy.int64AsNumber?(t=4294967296*py.getInt32(fy),t+=py.getUint32(fy+4)):t=py.getBigInt64(fy),fy+=8,t;case 212:if(t=oy[fy++],114==t)return Xy(63&oy[fy++]);{let e=xy[t];if(e)return e.read?(fy++,e.read(Iy())):e.noBuffer?(fy++,e()):e(oy.subarray(fy,++fy));throw new Error("Unknown extension "+t)}case 213:return t=oy[fy],114==t?(fy++,Xy(63&oy[fy++],oy[fy++])):Wy(2);case 214:return Wy(4);case 215:return Wy(8);case 216:return Wy(16);case 217:return t=oy[fy++],Ay>=fy?hy.slice(fy-by,(fy+=t)-by):Oy(t);case 218:return t=py.getUint16(fy),Ay>=(fy+=2)?hy.slice(fy-by,(fy+=t)-by):Ny(t);case 219:return t=py.getUint32(fy),Ay>=(fy+=4)?hy.slice(fy-by,(fy+=t)-by):ky(t);case 220:return t=py.getUint16(fy),fy+=2,Uy(t);case 221:return t=py.getUint32(fy),fy+=4,Uy(t);case 222:return t=py.getUint16(fy),fy+=2,zy(t);case 223:return t=py.getUint32(fy),fy+=4,zy(t);default:if(e>=224)return e-256;if(void 0===e){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}throw new Error("Unknown MessagePack token "+e)}}}var Py=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Dy(e,t){function i(){if(i.count++>2){let i=e.read=new Function("r","return function(){return {"+e.map((e=>Py.test(e)?e+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}}")(Iy);return 0===e.highByte&&(e.read=Ry(t,e.read)),i()}let n={};for(let t=0,i=e.length;t<i;t++){n[e[t]]=Iy()}return n}return i.count=0,0===e.highByte?Ry(t,i):i}var Ry=(e,t)=>function(){let i=oy[fy++];if(0===i)return t();let n=e<32?-(e+(i<<5)):e+(i<<5),r=cy[n]||By()[n];if(!r)throw new Error("Record id is not defined for "+n);return r.read||(r.read=Dy(r,e)),r.read()};function By(){let e=Jy((()=>(oy=null,yy.getStructures())));return cy=yy._mergeStructures(e,cy)}var Ly=Fy,Oy=Fy,Ny=Fy,ky=Fy;function Fy(e){let t;if(e<16&&(t=Gy(e)))return t;if(e>64&&ny)return ny.decode(oy.subarray(fy,fy+=e));let i=fy+e,n=[];for(t="";fy<i;){let e=oy[fy++];if(0===(128&e))n.push(e);else if(192===(224&e)){let t=63&oy[fy++];n.push((31&e)<<6|t)}else if(224===(240&e)){let t=63&oy[fy++],i=63&oy[fy++];n.push((31&e)<<12|t<<6|i)}else if(240===(248&e)){let t=(7&e)<<18|(63&oy[fy++])<<12|(63&oy[fy++])<<6|63&oy[fy++];t>65535&&(t-=65536,n.push(t>>>10&1023|55296),t=56320|1023&t),n.push(t)}else n.push(e);n.length>=4096&&(t+=jy.apply(String,n),n.length=0)}return n.length>0&&(t+=jy.apply(String,n)),t}function Uy(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=Iy();return t}function zy(e){if(yy.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[qy()]=Iy();return t}{let t=new Map;for(let i=0;i<e;i++)t.set(Iy(),Iy());return t}}var jy=String.fromCharCode;function Vy(e){let t=fy,i=new Array(e);for(let n=0;n<e;n++){let e=oy[fy++];if((128&e)>0)return void(fy=t);i[n]=e}return jy.apply(String,i)}function Gy(e){if(e<4){if(e<2){if(0===e)return"";{let e=oy[fy++];return(128&e)>1?void(fy-=1):jy(e)}}{let t=oy[fy++],i=oy[fy++];if((128&t)>0||(128&i)>0)return void(fy-=2);if(e<3)return jy(t,i);let n=oy[fy++];return(128&n)>0?void(fy-=3):jy(t,i,n)}}{let t=oy[fy++],i=oy[fy++],n=oy[fy++],r=oy[fy++];if((128&t)>0||(128&i)>0||(128&n)>0||(128&r)>0)return void(fy-=4);if(e<6){if(4===e)return jy(t,i,n,r);{let e=oy[fy++];return(128&e)>0?void(fy-=5):jy(t,i,n,r,e)}}if(e<8){let s=oy[fy++],a=oy[fy++];if((128&s)>0||(128&a)>0)return void(fy-=6);if(e<7)return jy(t,i,n,r,s,a);let o=oy[fy++];return(128&o)>0?void(fy-=7):jy(t,i,n,r,s,a,o)}{let s=oy[fy++],a=oy[fy++],o=oy[fy++],l=oy[fy++];if((128&s)>0||(128&a)>0||(128&o)>0||(128&l)>0)return void(fy-=8);if(e<10){if(8===e)return jy(t,i,n,r,s,a,o,l);{let e=oy[fy++];return(128&e)>0?void(fy-=9):jy(t,i,n,r,s,a,o,l,e)}}if(e<12){let c=oy[fy++],h=oy[fy++];if((128&c)>0||(128&h)>0)return void(fy-=10);if(e<11)return jy(t,i,n,r,s,a,o,l,c,h);let d=oy[fy++];return(128&d)>0?void(fy-=11):jy(t,i,n,r,s,a,o,l,c,h,d)}{let c=oy[fy++],h=oy[fy++],d=oy[fy++],u=oy[fy++];if((128&c)>0||(128&h)>0||(128&d)>0||(128&u)>0)return void(fy-=12);if(e<14){if(12===e)return jy(t,i,n,r,s,a,o,l,c,h,d,u);{let e=oy[fy++];return(128&e)>0?void(fy-=13):jy(t,i,n,r,s,a,o,l,c,h,d,u,e)}}{let p=oy[fy++],f=oy[fy++];if((128&p)>0||(128&f)>0)return void(fy-=14);if(e<15)return jy(t,i,n,r,s,a,o,l,c,h,d,u,p,f);let m=oy[fy++];return(128&m)>0?void(fy-=15):jy(t,i,n,r,s,a,o,l,c,h,d,u,p,f,m)}}}}}function Hy(e){return yy.copyBuffers?Uint8Array.prototype.slice.call(oy,fy,fy+=e):oy.subarray(fy,fy+=e)}function Wy(e){let t=oy[fy++];if(xy[t])return xy[t](oy.subarray(fy,fy+=e));throw new Error("Unknown extension type "+t)}var Qy=new Array(4096);function qy(){let e=oy[fy++];if(!(e>=160&&e<192))return fy--,Iy();if(e-=160,Ay>=fy)return hy.slice(fy-by,(fy+=e)-by);if(!(0==Ay&&ly<180))return Ly(e);let t,i=4095&(e<<5^(e>1?py.getUint16(fy):e>0?oy[fy]:0)),n=Qy[i],r=fy,s=fy+e-3,a=0;if(n&&n.bytes==e){for(;r<s;){if(t=py.getUint32(r),t!=n[a++]){r=1879048192;break}r+=4}for(s+=3;r<s;)if(t=oy[r++],t!=n[a++]){r=1879048192;break}if(r===s)return fy=r,n.string;s-=3,r=fy}for(n=[],Qy[i]=n,n.bytes=e;r<s;)t=py.getUint32(r),n.push(t),r+=4;for(s+=3;r<s;)t=oy[r++],n.push(t);let o=e<16?Gy(e):Vy(e);return n.string=null!=o?o:Ly(e)}var Xy=(e,t)=>{var i=Iy();let n=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let r=cy[e];return r&&r.isShared&&((cy.restoreStructures||(cy.restoreStructures=[]))[e]=r),cy[e]=i,i.read=Dy(i,n),i.read()},Yy="object"==typeof self?self:global;xy[0]=()=>{},xy[0].noBuffer=!0,xy[101]=()=>{let e=Iy();return(Yy[e[0]]||Error)(e[1])},xy[105]=e=>{let t=py.getUint32(fy-4);uy||(uy=new Map);let i,n=oy[fy];i=n>=144&&n<160||220==n||221==n?[]:{};let r={target:i};uy.set(t,r);let s=Iy();return r.used?Object.assign(i,s):(r.target=s,s)},xy[112]=e=>{let t=py.getUint32(fy-4),i=uy.get(t);return i.used=!0,i.target},xy[115]=()=>new Set(Iy());var Ky=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((e=>e+"Array"));function Jy(e){let t=ly,i=fy,n=vy,r=by,s=Ay,a=hy,o=gy,l=uy,c=dy,h=new Uint8Array(oy.slice(0,ly)),d=cy,u=cy.slice(0,cy.length),p=yy,f=Ey,m=e();return ly=t,fy=i,vy=n,by=r,Ay=s,hy=a,gy=o,uy=l,dy=c,oy=h,Ey=f,(cy=d).splice(0,cy.length,...u),yy=p,py=new DataView(oy.buffer,oy.byteOffset,oy.byteLength),m}function Zy(){oy=null,uy=null,cy=null}xy[116]=e=>{let t=e[0],i=Ky[t];if(!i)throw new Error("Could not find typed array for code "+t);return new Yy[i](Uint8Array.prototype.slice.call(e,1).buffer)},xy[120]=()=>{let e=Iy();return new RegExp(e[0],e[1])},xy[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=fy;fy+=t-4,(dy=[Iy(),Iy()]).position0=0,dy.position1=0;let n=fy;fy=i;try{return Iy()}finally{fy=n}},xy[255]=e=>4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid");var $y=new Array(147);for(let yH=0;yH<256;yH++)$y[yH]=+("1e"+Math.floor(45.15-.30103*yH));var eb,tb=new Cy({useRecords:!1}),ib=(tb.unpack,tb.unpackMultiple,tb.unpack,new Float32Array(1));new Uint8Array(ib.buffer,0,4);try{eb=new TextEncoder}catch{}var nb,rb,sb,ab,ob,lb=typeof Buffer<"u",cb=lb?Buffer.allocUnsafeSlow:Uint8Array,hb=lb?Buffer:Uint8Array,db=lb?4294967296:2144337920,ub=0,pb=null,fb=/[\u0080-\uFFFF]/,mb=Symbol("record-id"),gb=class extends Cy{constructor(e){super(e),this.offset=0;let t,i,n,r,s,a=0,o=hb.prototype.utf8Write?function(e,t,i){return sb.utf8Write(e,t,i)}:!(!eb||!eb.encodeInto)&&function(e,t){return eb.encodeInto(e,sb.subarray(t)).written},l=this;e||(e={});let c=e&&e.sequential,h=e.structures||e.saveStructures,d=e.maxSharedStructures;if(null==d&&(d=h?32:0),d>8160)throw new Error("Maximum maxSharedStructure is 8160");let u=e.maxOwnStructures;null==u&&(u=h?32:64),c&&!e.saveStructures&&(this.structures=[]);let p=d>32||u+d>64,f=d+64,m=d+u+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],v=0,y=0;this.pack=this.encode=function(e,o){if(sb||(sb=new cb(8192),ab=new DataView(sb.buffer,0,8192),ub=0),(ob=sb.length-10)-ub<2048?(sb=new cb(sb.length),ab=new DataView(sb.buffer,0,sb.length),ob=sb.length-10,ub=0):ub=ub+7&2147483640,t=ub,s=l.structuredClone?new Map:null,l.bundleStrings?(pb=["",""],sb[ub++]=214,sb[ub++]=98,pb.position=ub-t,ub+=4):pb=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let e=i.sharedLength||0;if(e>d)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let t=0;t<e;t++){let e=i[t];if(!e)continue;let n,r=i.transitions;for(let t=0,i=e.length;t<i;t++){let i=e[t];n=r[i],n||(n=r[i]=Object.create(null)),r=n}r[mb]=t+64}a=e}c||(i.nextId=e+64)}n&&(n=!1),r=i||[];try{if(b(e),pb){ab.setUint32(pb.position+t,ub-pb.position-t);let e=pb;pb=null,b(e[0]),b(e[1])}if(l.offset=ub,s&&s.idsToInsert){(ub+=6*s.idsToInsert.length)>ob&&x(ub),l.offset=ub;let e=function(e,t){let i,n=6*t.length,r=e.length-n;for(t.sort(((e,t)=>e.offset>t.offset?1:-1));i=t.pop();){let t=i.offset,s=i.id;e.copyWithin(t+n,t,r),n-=6;let a=t+n;e[a++]=214,e[a++]=105,e[a++]=s>>24,e[a++]=s>>16&255,e[a++]=s>>8&255,e[a++]=255&s,r=t}return e}(sb.subarray(t,ub),s.idsToInsert);return s=null,e}return o&Ib?(sb.start=t,sb.end=ub,sb):sb.subarray(t,ub)}finally{if(i){if(y<10&&y++,v>1e4)i.transitions=null,y=0,v=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let e=0,t=g.length;e<t;e++)g[e][mb]=0;g=[]}if(n&&l.saveStructures){let n=i.sharedLength||d;i.length>n&&(i=i.slice(0,n));let r=sb.subarray(t,ub);return!1===l.saveStructures(i,a)?(l._mergeStructures(l.getStructures()),l.pack(e)):(a=n,r)}}o&Pb&&(ub=t)}};let b=e=>{ub>ob&&(sb=x(ub));var i,n=typeof e;if("string"===n){let t,n=e.length;if(pb&&n>=8&&n<4096){let t=fb.test(e);return pb[t?0:1]+=e,sb[ub++]=193,void b(t?-n:n)}t=n<32?1:n<256?2:n<65536?3:5;let r=3*n;if(ub+r>ob&&(sb=x(ub+r)),n<64||!o){let r,s,a,o=ub+t;for(r=0;r<n;r++)s=e.charCodeAt(r),s<128?sb[o++]=s:s<2048?(sb[o++]=s>>6|192,sb[o++]=63&s|128):55296===(64512&s)&&56320===(64512&(a=e.charCodeAt(r+1)))?(s=65536+((1023&s)<<10)+(1023&a),r++,sb[o++]=s>>18|240,sb[o++]=s>>12&63|128,sb[o++]=s>>6&63|128,sb[o++]=63&s|128):(sb[o++]=s>>12|224,sb[o++]=s>>6&63|128,sb[o++]=63&s|128);i=o-ub-t}else i=o(e,ub+t,r);i<32?sb[ub++]=160|i:i<256?(t<2&&sb.copyWithin(ub+2,ub+1,ub+1+i),sb[ub++]=217,sb[ub++]=i):i<65536?(t<3&&sb.copyWithin(ub+3,ub+2,ub+2+i),sb[ub++]=218,sb[ub++]=i>>8,sb[ub++]=255&i):(t<5&&sb.copyWithin(ub+5,ub+3,ub+3+i),sb[ub++]=219,ab.setUint32(ub,i),ub+=4),ub+=i}else if("number"===n)if(e>>>0===e)e<64?sb[ub++]=e:e<256?(sb[ub++]=204,sb[ub++]=e):e<65536?(sb[ub++]=205,sb[ub++]=e>>8,sb[ub++]=255&e):(sb[ub++]=206,ab.setUint32(ub,e),ub+=4);else if((e|0)===e)e>=-32?sb[ub++]=256+e:e>=-128?(sb[ub++]=208,sb[ub++]=e+256):e>=-32768?(sb[ub++]=209,ab.setInt16(ub,e),ub+=2):(sb[ub++]=210,ab.setInt32(ub,e),ub+=4);else{let t;if((t=this.useFloat32)>0&&e<4294967296&&e>=-2147483648){let i;if(sb[ub++]=202,ab.setFloat32(ub,e),t<4||((i=e*$y[(127&sb[ub])<<1|sb[ub+1]>>7])|0)===i)return void(ub+=4);ub--}sb[ub++]=203,ab.setFloat64(ub,e),ub+=8}else if("object"===n)if(e){if(s){let i=s.get(e);if(i){if(!i.id){let e=s.idsToInsert||(s.idsToInsert=[]);i.id=e.push(i)}return sb[ub++]=214,sb[ub++]=112,ab.setUint32(ub,i.id),void(ub+=4)}s.set(e,{offset:ub-t})}let n=e.constructor;if(n===Object)A(e,!0);else if(n===Array){(i=e.length)<16?sb[ub++]=144|i:i<65536?(sb[ub++]=220,sb[ub++]=i>>8,sb[ub++]=255&i):(sb[ub++]=221,ab.setUint32(ub,i),ub+=4);for(let t=0;t<i;t++)b(e[t])}else if(n===Map){(i=e.size)<16?sb[ub++]=128|i:i<65536?(sb[ub++]=222,sb[ub++]=i>>8,sb[ub++]=255&i):(sb[ub++]=223,ab.setUint32(ub,i),ub+=4);for(let[t,i]of e)b(t),b(i)}else{for(let t=0,i=nb.length;t<i;t++){if(e instanceof rb[t]){let i=nb[t];if(i.write)return i.type&&(sb[ub++]=212,sb[ub++]=i.type,sb[ub++]=0),void b(i.write.call(this,e));let n,r=sb,s=ab,a=ub;sb=null;try{n=i.pack.call(this,e,(e=>(sb=r,r=null,(ub+=e)>ob&&x(ub),{target:sb,targetView:ab,position:ub-e})),b)}finally{r&&(ab=s,ub=a,ob=(sb=r).length-10)}return void(n&&(n.length+ub>ob&&x(n.length+ub),ub=bb(n,sb,ub,i.type)))}}A(e,!e.hasOwnProperty)}}else sb[ub++]=192;else if("boolean"===n)sb[ub++]=e?195:194;else if("bigint"===n){if(e<BigInt(1)<<BigInt(63)&&e>=-(BigInt(1)<<BigInt(63)))sb[ub++]=211,ab.setBigInt64(ub,e);else if(e<BigInt(1)<<BigInt(64)&&e>0)sb[ub++]=207,ab.setBigUint64(ub,e);else{if(!this.largeBigIntToFloat)throw new RangeError(e+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");sb[ub++]=203,ab.setFloat64(ub,Number(e))}ub+=8}else if("undefined"===n)this.encodeUndefinedAsNil?sb[ub++]=192:(sb[ub++]=212,sb[ub++]=0,sb[ub++]=0);else{if("function"!==n)throw new Error("Unknown type: "+n);b(this.writeFunction&&this.writeFunction())}},A=!1===this.useRecords?this.variableMapSize?e=>{let t,i=Object.keys(e),n=i.length;n<16?sb[ub++]=128|n:n<65536?(sb[ub++]=222,sb[ub++]=n>>8,sb[ub++]=255&n):(sb[ub++]=223,ab.setUint32(ub,n),ub+=4);for(let r=0;r<n;r++)b(t=i[r]),b(e[t])}:(e,i)=>{sb[ub++]=222;let n=ub-t;ub+=2;let r=0;for(let t in e)(i||e.hasOwnProperty(t))&&(b(t),b(e[t]),r++);sb[n+++t]=r>>8,sb[n+t]=255&r}:e=>{let t,i=Object.keys(e),s=r.transitions||(r.transitions=Object.create(null)),a=0;for(let n=0,r=i.length;n<r;n++){let e=i[n];t=s[e],t||(t=s[e]=Object.create(null),a++),s=t}let o=s[mb];if(o)o>=96&&p?(sb[ub++]=96+(31&(o-=96)),sb[ub++]=o>>5):sb[ub++]=o;else{o=r.nextId,o||(o=64),o<f&&this.shouldShareStructure&&!this.shouldShareStructure(i)?(o=r.nextOwnId,o<m||(o=f),r.nextOwnId=o+1):(o>=m&&(o=f),r.nextId=o+1);let e=i.highByte=o>=96&&p?o-96>>5:-1;s[mb]=o,r[o-64]=i,o<f?(i.isShared=!0,r.sharedLength=o-63,n=!0,e>=0?(sb[ub++]=96+(31&o),sb[ub++]=e):sb[ub++]=o):(e>=0?(sb[ub++]=213,sb[ub++]=114,sb[ub++]=96+(31&o),sb[ub++]=e):(sb[ub++]=212,sb[ub++]=114,sb[ub++]=o),a&&(v+=y*a),g.length>=u&&(g.shift()[mb]=0),g.push(s),b(i))}for(let n=0,r=i.length;n<r;n++)b(e[i[n]])},x=e=>{let i;if(e>16777216){if(e-t>db)throw new Error("Packed buffer would be larger than maximum buffer size");i=Math.min(db,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else i=1+(Math.max(e-t<<2,sb.length-1)>>12)<<12;let n=new cb(i);return ab=new DataView(n.buffer,0,i),sb.copy?sb.copy(n,0,t,e):n.set(sb.slice(t,e)),ub-=t,t=0,ob=n.length-10,sb=n}}useBuffer(e){sb=e,ab=new DataView(sb.buffer,sb.byteOffset,sb.byteLength),ub=0}};function vb(e,t,i,n){let r=e.byteLength;if(r+1<256){var{target:s,position:a}=i(4+r);s[a++]=199,s[a++]=r+1}else if(r+1<65536){var{target:s,position:a}=i(5+r);s[a++]=200,s[a++]=r+1>>8,s[a++]=r+1&255}else{var{target:s,position:a,targetView:o}=i(7+r);s[a++]=201,o.setUint32(a,r+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function yb(e,t){let i=e.byteLength;var n,r;if(i<256){var{target:n,position:r}=t(i+2);n[r++]=196,n[r++]=i}else if(i<65536){var{target:n,position:r}=t(i+3);n[r++]=197,n[r++]=i>>8,n[r++]=255&i}else{var{target:n,position:r,targetView:s}=t(i+5);n[r++]=198,s.setUint32(r,i),r+=4}n.set(e,r)}function bb(e,t,i,n){let r=e.length;switch(r){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:r<256?(t[i++]=199,t[i++]=r):r<65536?(t[i++]=200,t[i++]=r>>8,t[i++]=255&r):(t[i++]=201,t[i++]=r>>24,t[i++]=r>>16&255,t[i++]=r>>8&255,t[i++]=255&r)}return t[i++]=n,t.set(e,i),i+=r}function Ab(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");rb.unshift(e.Class),nb.unshift(e)}!function(e){e.unpack?xy[e.type]=e.unpack:xy[e.type]=e}(e)}rb=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Sy],nb=[{pack(e,t,i){let n=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&n>=0&&n<4294967296){let{target:e,targetView:i,position:r}=t(6);e[r++]=214,e[r++]=255,i.setUint32(r,n)}else if(n>0&&n<17179869184){let{target:i,targetView:r,position:s}=t(10);i[s++]=215,i[s++]=255,r.setUint32(s,4e6*e.getMilliseconds()+(n/1e3/4294967296|0)),r.setUint32(s+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:e,targetView:n,position:r}=t(3);e[r++]=212,e[r++]=255,e[r++]=255}else{let{target:i,targetView:r,position:s}=t(15);i[s++]=199,i[s++]=12,i[s++]=255,r.setUint32(s,1e6*e.getMilliseconds()),r.setBigInt64(s+4,BigInt(Math.floor(n)))}}},{pack(e,t,i){let n=Array.from(e),{target:r,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=115,r[s++]=0),i(n)}},{pack(e,t,i){let{target:n,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=101,n[r++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:n,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=120,n[r++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?vb(e,16,t):yb(lb?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==hb&&this.structuredClone?vb(e,Ky.indexOf(i.name),t):yb(e,t)}},{pack(e,t){let{target:i,position:n}=t(1);i[n]=193}}];var xb,wb,Sb,_b=new gb({useRecords:!1}),{NEVER:Eb,ALWAYS:Cb,DECIMAL_ROUND:Mb,DECIMAL_FIT:Tb}=(_b.pack,_b.pack,{NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4}),Ib=512,Pb=1024,Db=new gb({structuredClone:!0});function Rb(e){if(vv(e))return e;if(Array.isArray(e))return e.map(Rb);if("object"==typeof e&&null!==e){let t={};for(let i of Object.keys(e).sort())t[i]=Rb(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}return e}function Bb(e){return"MouseDown"===e||"MouseUp"===e||"KeyDown"===e||"KeyUp"===e||"Collision"===e||"Trigger"===e}Ab({Class:uv.prototype.constructor,type:1,write:e=>({...e}),read:e=>(Object.setPrototypeOf(e,uv.prototype),e)}),Ab({Class:wv.prototype.constructor,type:2,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,wv.prototype),e)}),Ab({Class:xv.prototype.constructor,type:3,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,xv.prototype),e)}),Ab({Class:sy.prototype.constructor,type:4,write:e=>e.id,read:e=>new sy(e)}),Ab({Class:ay.prototype.constructor,type:5,write:e=>e.data,read:e=>new ay(e)}),Ab({Class:Iv.prototype.constructor,type:6,write:e=>({...e}),read:e=>(Object.setPrototypeOf(e,Iv.prototype),e)}),(e=>{function t(e){return Db.pack(e)}e.serialize=t,e.deserialize=function(e){return Db.unpack(e)},e.checksum=function(e){return function(e){var t=0;if(0===e.length)return t;for(let i=0;i<e.length;i++)t=(t<<5)-t+e[i],t|=0;return t}(t(Rb(e))).toString()}})(xb||(xb={})),(Sb=wb||(wb={})).toEventUIType=function(e){return"Conditional"===e.type?"Distance"===e.condition.type?"Distance":"StateChange":e.type},Sb.fromEventUIType=function(e){return"Distance"===e||"StateChange"===e?"Conditional":e};var Lb,Ob,Nb,kb,Fb,Ub,zb,jb,Vb,Gb,Hb,Wb,Qb,qb,Xb,Yb,Kb,Jb,Zb,$b,eA={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]};(e=>{e.is=function(e){return"MouseDown"===e.type||"MouseUp"===e.type||"MousePress"===e.type||"KeyDown"===e.type||"KeyUp"===e.type||"KeyPress"===e.type},e.defaultData=function(e){return"MouseDown"===e||"MouseUp"===e||"MousePress"===e?{type:e,mode:"Object",disabled:!1,actions:new wv}:{type:e,disabled:!1,key:void 0,actions:new wv}}})(Lb||(Lb={})),(e=>{e.propertyDefaultData=function(e){return{type:"Property",value:[e??null,"position","x"]}},e.valueDefaultData={type:"Literal",value:0}})(Ob||(Ob={})),(e=>{e.comparisonDefaultData=function(e){return{type:"Comparison",operator:"==",lOperand:Ob.propertyDefaultData(e),rOperand:{...Ob.valueDefaultData}}},e.distanceDefaultData=function(e){return{type:"Distance",toObject:e??null,fromObject:e??null,distance:200}},e.stateDefaultData=function(e,t){return{type:"State",object:e??null,state:t??null}}})(Nb||(Nb={})),(e=>{e.isConditionalSubActions=function(e){return void 0!==e.find((e=>"ifActions"===e||"elseActions"===e))}})(kb||(kb={})),(e=>{e.is=function(e){return"Conditional"===e.type},e.defaultData=function(e){return{type:"Conditional",disabled:!1,inActions:new wv,outActions:new wv,condition:Nb.distanceDefaultData(e)}}})(Fb||(Fb={})),(e=>{e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new wv,drop:new wv}}})(Ub||(Ub={})),(e=>{e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new wv}})(zb||(zb={})),(e=>{e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5}})(jb||(jb={})),(e=>{e.is=function(e){return"MouseHover"===e.type},e.defaultData=function(){return{type:"MouseHover",disabled:!1,actions:new wv}}})(Vb||(Vb={})),(e=>{e.is=function(e){return"Scroll"===e.type},e.defaultData=function(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new wv}}})(Gb||(Gb={})),(e=>{e.is=function(e){return"Start"===e.type},e.defaultData=function(){return{type:"Start",disabled:!1,actions:new wv}}})(Hb||(Hb={})),(e=>{e.is=function(e){return"Collision"===e.type},e.defaultData=function(){return{type:"Collision",disabled:!1,target:"character",actions:new wv}}})(Wb||(Wb={})),(e=>{e.is=function(e){return"Trigger"===e.type},e.defaultData=function(e,t){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new wv,triggerZone:"box",position:t.toArray(),rotation:[0,0,0],size:e.toArray(),radius:e.length()/2,helperVisible:!0}}})(Qb||(Qb={})),(Xb=qb||(qb={})).defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]},Xb.is=function(e){return"Resize"===e.type},Xb.sizeToDevice=function(e){return"string"==typeof e?e:"custom"},Xb.deviceToSize=function(e){return"string"==typeof e?[...Xb.defaultSizes[e]]:[...e]},Xb.defaultData=function(){let e={size:"mobile",operator:"<",actions:new wv},t={size:"tablet",operator:"<",actions:new wv},i={size:[...Xb.defaultSizes.custom],operator:"<>",actions:new wv},n=new wv;return n.push({id:ui.generateUUID(),fi:0,data:e},{id:ui.generateUUID(),fi:1,data:t},{id:ui.generateUUID(),fi:2,data:i}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:n}},Xb.defaultBreakpointData=function(){return{size:[...Xb.defaultSizes.custom],operator:"<>",actions:new wv}},(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]},e.is=function(e){return"VariableChange"===e.type},e.defaultData=function(){return{disabled:!1,type:"VariableChange",actions:new wv,variableId:"",objectId:null,property:"Position X"}}})(Yb||(Yb={})),(e=>{e.is=function(e){return"API"===e.type},e.defaultData=function(){return{disabled:!1,type:"API",successActions:new wv,errorActions:new wv,userAPIId:""}}})(Kb||(Kb={})),(e=>{e.is=function(e){return"WEBHOOK"===e.type},e.defaultData=function(){return{disabled:!1,type:"WEBHOOK",actions:new wv,userWebhookId:""}}})(Jb||(Jb={})),(e=>{e.is=function(e){return"AIAssistantListener"===e.type},e.defaultData=function(){return{disabled:!1,type:"AIAssistantListener",actions:new wv,analysis:"average",analysisRange:[0,71],analysisSingle:0}}})(Zb||(Zb={})),(e=>{e.is=function(e){return"AIAssistantTrigger"===e.type},e.defaultData=function(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new wv}}})($b||($b={}));var tA,iA,nA,rA,sA,aA,oA,lA,cA,hA,dA,uA,pA,fA,mA,gA,vA,yA,bA,AA,xA="personal camera",wA="a218fcc3-276b-49b9-b485-49037fd14f5f",SA=5526619;function _A(e){return"string"==typeof e&&36===e.length&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}(e=>{function t(e,t){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function i(e,i){return Math.sqrt(t(e,i))}function n(t,i,n){let r=e.sub(i,t),s=e.sub(n,t),a=e.dot(r,s)/e.dot(r,r),o=e.scalarMultiply(r,a);return e.add(t,o)}e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.lerp=function(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i]},e.add=function(e,t){return[e[0]+t[0],e[1]+t[1]]},e.sub=function(e,t){return[e[0]-t[0],e[1]-t[1]]},e.multiply=function(e,t){return[e[0]*t[0],e[1]*t[1]]},e.divide=function(e,t){return[e[0]/t[0],e[1]/t[1]]},e.distanceSquared=t,e.distance=i,e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},e.scalarMultiply=function(e,t){return[e[0]*t,e[1]*t]},e.projectionOnto=n,e.projectionOntoDistance=function(e,t,r){return i(e,n(e,t,r))},e.center=function(e,t){return[.5*(e[0]+t[0]),.5*(e[1]+t[1])]}})(tA||(tA={})),(nA=iA||(iA={})).isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},nA.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]},nA.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},nA.div=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2]]},nA.mul=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]},nA.dist=function(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},nA.lerp=function(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i,e[2]+(t[2]-e[2])*i]},(e=>{e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.lerp=function(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i,e[2]+(t[2]-e[2])*i,e[3]+(t[3]-e[3])*i]}})(rA||(rA={})),(e=>{let t=180/Math.PI,i=Math.PI/180;function n(e){return"number"==typeof e?e*t:e}function r(e){return"number"==typeof e?e*i:e}e.radToDeg=function(e){return[n(e[0]),n(e[1]),n(e[2])]},e.degToRad=function(e){return[r(e[0]),r(e[1]),r(e[2])]}})(sA||(sA={})),(oA=aA||(aA={})).identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],oA.isEqual=function(e,t){for(let i=0;i<16;i++)if(e[i]!==t[i])return!1;return!0},oA.simplify=function(e){return e??oA.identity},oA.applyMatrix4=function(e,t){let i=t.slice(0);for(var n=0,r=t.length;n<r;n+=3){let r=e[3]*t[n]+e[7]*t[n+1]+e[11]*t[n+2]+e[15];i[n]=(e[0]*t[n]+e[4]*t[n+1]+e[8]*t[n+2]+e[12])/r,i[n+1]=(e[1]*t[n]+e[5]*t[n+1]+e[9]*t[n+2]+e[13])/r,i[n+2]=(e[2]*t[n]+e[6]*t[n+1]+e[10]*t[n+2]+e[14])/r}return i},(cA=lA||(lA={})).isRGB=function(e){return"object"==typeof e&&"number"==typeof e.r&&"number"==typeof e.g&&"number"==typeof e.b},cA.white={r:1,g:1,b:1},cA.red={r:1,g:0,b:0},cA.black={r:0,g:0,b:0},cA.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:1}},cA.clone=function(e){return{r:e.r,g:e.g,b:e.b}},cA.fromHex=function(e){return{r:((e=Math.floor(e))>>16&255)/255,g:(e>>8&255)/255,b:(255&e)/255}},cA.toHex=function(e){return 65536*Math.round(255*e.r)+256*Math.round(255*e.g)+Math.round(255*e.b)},cA.equals=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b},cA.equalsFixed=function(e,t){return e.r.toFixed(2)===t.r.toFixed(2)&&e.g.toFixed(2)===t.g.toFixed(2)&&e.b.toFixed(2)===t.b.toFixed(2)},cA.lerp=function(e,t,i){return{r:e.r+(t.r-e.r)*i,g:e.g+(t.g-e.g)*i,b:e.b+(t.b-e.b)*i}},(dA=hA||(hA={})).white={...lA.white,a:1},dA.transparent={...lA.white,a:0},dA.from0to1=function(e){return{r:e[0],g:e[1],b:e[2],a:e[3]}},dA.fromHexAndA=function(e,t){return{...lA.fromHex(e),a:t}},dA.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:e.a}},dA.equals=function(e,t){return lA.equals(e,t)&&e.a===t.a},dA.equalsFixed=function(e,t){return lA.equalsFixed(e,t)&&e.a.toFixed(2)===t.a.toFixed(2)},dA.lerp=function(e,t,i){return{r:e.r+(t.r-e.r)*i,g:e.g+(t.g-e.g)*i,b:e.b+(t.b-e.b)*i,a:e.a+(t.a-e.a)*i}},dA.toStyle=function(){let{r:e,g:t,b:i,a:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dA.white;return`rgba(${255*e}, ${255*t}, ${255*i}, ${n})`},(e=>{e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}})(uA||(uA={})),(e=>{e.defaultData={mass:1,stiffness:80,damping:10,velocity:0}})(pA||(pA={})),(e=>{e.defaultData={control1:[.5,0],control2:[.5,1]}})(fA||(fA={})),(gA=mA||(mA={})).linear=[0,0,1,1],gA.ease=[.25,.1,.25,1],gA.easeIn=[.42,0,1,1],gA.easeOut=[0,0,.58,1],gA.easeInOut=[.42,0,.58,1],(e=>{e.all=["PerspectiveCamera","OrthographicCamera"],e.is=function(t){return e.all.includes(t)}})(vA||(vA={})),(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset},e.getZoom=function(e){return"PerspectiveCamera"===e.type?e.perspective?.zoom??1:e.orthographic?.zoom??1}})(yA||(yA={})),(e=>{e.defaultData=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:2*Math.max(e[0],e[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[e[0]+e[0]*t,0,0]},grid:{count:[2,2,2],size:e.map((e=>e*(1+t))),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}},e.merge=function(e,t){let i={...e};if(NA.forEach((n=>{Object.assign(i,{[n]:t[n]??e[n]})})),i.radial={...e.radial},t.radial){let n=e.radial,r=t.radial;kA.forEach((e=>{Object.assign(i.radial,{[e]:r[e]??n[e]})}))}if(i.linear={...e.linear},t.linear){let n=e.linear,r=t.linear;FA.forEach((e=>{Object.assign(i.linear,{[e]:r[e]??n[e]})}))}if(i.grid={...e.grid},t.grid){let n=e.grid,r=t.grid;UA.forEach((e=>{Object.assign(i.grid,{[e]:r[e]??n[e]})}))}if(i.toObject={...e.toObject},t.toObject){let n=e.toObject,r=t.toObject;zA.forEach((e=>{Object.assign(i.toObject,{[e]:r[e]??n[e]})}))}if(i.randomnessObject={...e.randomnessObject},t.randomnessObject){let n=e.randomnessObject,r=t.randomnessObject;jA.forEach((e=>{Object.assign(i.randomnessObject,{[e]:r[e]??n[e]})}))}return i}})(bA||(bA={})),(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];e.toOps=function(e,i){let n=[];void 0!==e.count&&n.push({type:0,path:i,props:{count:e.count}});for(let r of t){let t=e[r];t&&Object.keys(t).length>0&&n.push({type:0,path:[...i,r],props:t})}return n}})(AA||(AA={}));var EA,CA,MA,TA,IA,PA,DA,RA,BA,LA,OA,NA=["count"],kA=["radius","start","end","position","scale","rotation"],FA=["position","scale","rotation"],UA=["count","size"],zA=["count","position","scale","rotation"],jA=["strength","scale","rotation","position","movement","seed","freqScale"];(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],e.is=function(t){return e.all.includes(t)}})(EA||(EA={})),(e=>{e.defaultData=function(e){return function(e){if("PointLight"===e)return{type:e,color:hA.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if("SpotLight"===e)return{type:e,color:hA.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===e)return{type:e,color:hA.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}(e)}})(CA||(CA={})),(e=>{e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...e.defaultCollisionData}})(MA||(MA={})),(e=>{e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]}})(TA||(TA={})),(e=>{e.defaultData={castShadow:!0,receiveShadow:!0},e.equals=function(e,t){return e.castShadow===t.castShadow&&e.receiveShadow===t.receiveShadow}})(IA||(IA={})),(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0},e.equals=function(e,t){return e.flatShading===t.flatShading&&e.side===t.side&&e.wireframe===t.wireframe}})(PA||(PA={})),(e=>{e.defaultData={...PA.defaultData,...IA.defaultData}})(DA||(DA={})),(e=>{e.getMaterialData=function(e,t){let i=[];if("material"in e){let n="string"==typeof e.material?t.materials[e.material]??t.lib.materials[e.material]?.asset:e.material;n&&i.push(n)}else if("materials"in e)for(let n of e.materials){let e="string"==typeof n?t.materials[n]??t.lib.materials[n]?.asset:n;e&&i.push(e)}return i}})(RA||(RA={})),(e=>{e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7})(BA||(BA={})),(e=>{e.is=function(e){return"texture"===e||"video"===e||"color"===e||"depth"===e||"normal"===e||"gradient"===e||"noise"===e||"fresnel"===e||"rainbow"===e||"toon"===e||"outline"===e||"particle"===e||"transmission"===e||"matcap"===e||"displace"===e||"pattern"===e||"light"===e}})(LA||(LA={})),(e=>{e.is=function(e){return"phong"===e||"toon"===e||"lambert"===e||"physical"===e}})(OA||(OA={}));var VA,GA,HA,WA,QA=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],qA=["wrapping","image","video","name","minFilter","magFilter"];(e=>{e.patch=function(e,t){let{texture:i,...n}=t;if(Object.assign(e,n),i){let t=e.texture;t&&Object.assign(t,i)}},e.defaultData=function(e,t){return"light"===e&&t?function(e){let t={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(e){case"phong":return{...t,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...t,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...t,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...t,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}(t):function(e){let t={alpha:1,mode:0,isMask:!1,visible:!0};switch(e){case"texture":return{...t,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...t,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:BA.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...t,type:"color",color:lA.fromHex(SA)};case"depth":return{...t,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...t,type:"normal",cnormal:[1,1,1]};case"gradient":return{...t,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...t,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...lA.fromHex(6710886),a:1},colorB:{...lA.fromHex(6710886),a:1},colorC:{...lA.fromHex(16777215),a:1},colorD:{...lA.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...t,type:"fresnel",color:hA.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...t,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...t,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:hA.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...t,type:"outline",outlineColor:hA.fromHexAndA(0,1),contourColor:hA.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...t,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...t,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...t,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...lA.fromHex(0),a:1},colorB:{...lA.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}(e)}})(VA||(VA={})),(e=>{function t(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer1",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer2",n=new wv;return n.push({fi:0,data:VA.defaultData("light",e),id:t}),n.push({fi:1,data:VA.defaultData("color"),id:i}),{layers:n}}e.isMergable=function(e){return!e.layers.some((e=>"texture"===e.data.type&&0!==e.data.projection||"depth"===e.data.type&&!e.data.isWorldSpace||"noise"===e.data.type||"displace"===e.data.type))},e.getHash=function(e){let t="";return e.layers.forEach((e=>{Object.entries(e.data).forEach((e=>{let[i,n]=e;t+=`${i}${n}`,Array.isArray(n)?n.forEach((e=>t+=`${e}`)):"object"==typeof n?Object.values(n).forEach((e=>{t+="number"==typeof e?`${e.toFixed(4)}`:`${e}`})):t+=`${n}`}))})),t},e.defaultEmptyData=function(){return{layers:new wv}},e.defaultData=function(){return t("phong",arguments.length>0&&void 0!==arguments[0]?arguments[0]:"layer1",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer2")},e.withName=function(e,t){return{...e,name:t}},e.defaultTwoLayerData=t,e.defaultUIObjectMaterial=function(e){let t=VA.defaultData("texture");e&&Object.assign(t.texture,{image:e});let i=new wv;return i.push({fi:0,data:t,id:"layer1"}),i.push({fi:1,data:{...VA.defaultData("transmission"),alpha:1},id:"layer2"}),i.push({fi:2,data:{...VA.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:i}},e.defaultTwoLayerTextureData=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"phong",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer1",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"layer2",r=VA.defaultData("texture");Object.assign(r.texture,{image:e});let s=new wv;return s.push({fi:0,data:r,id:i}),s.push({fi:1,data:VA.defaultData("light",t),id:n}),{layers:s}},e.defaultTwoLayerVideoTextureData=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"phong",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer1",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"layer2",r=VA.defaultData("video");Object.assign(r.texture,{video:e});let s=new wv;return s.push({fi:0,data:r,id:i}),s.push({fi:1,data:VA.defaultData("light",t),id:n}),{layers:s}}})(GA||(GA={})),(e=>{e.defaultData=function(){return{points:new wv,roundness:0,shapeHoles:[],isClosed:!1}}})(HA||(HA={})),(e=>{e.defaultData=function(){return{points:new wv,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}})(WA||(WA={}));var XA,YA={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0};(e=>{e.merge=function(e,t){let i={...e};return ex.forEach((n=>{Object.assign(i,{[n]:t[n]??e[n]})})),i}})(XA||(XA={}));var KA,JA,ZA,$A={shape:YA,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},ex=["depth","offset","angle","twist","startScale","endScale"];(e=>{e.is2DParametricMesh=function(e){return"PolygonGeometry"===e||"RectangleGeometry"===e||"StarGeometry"===e||"TriangleGeometry"===e||"EllipseGeometry"===e||"UIGeometry"===e},e.isParametricMesh=function(e){return"PolygonGeometry"===e||"PolygonGeometry"===e||"RectangleGeometry"===e||"StarGeometry"===e||"TriangleGeometry"===e||"EllipseGeometry"===e||"PathGeometry"===e||"VectorGeometry"===e||"ConeGeometry"===e||"CubeGeometry"===e||"CylinderGeometry"===e||"DodecahedronGeometry"===e||"HelixGeometry"===e||"IcosahedronGeometry"===e||"LatheGeometry"===e||"PyramidGeometry"===e||"SphereGeometry"===e||"PlaneGeometry"===e||"BackdropGeometry"===e||"TorusGeometry"===e||"TorusKnotGeometry"===e||"BooleanGeometry"===e||"TextGeometry"===e||"InputGeometry"===e}})(KA||(KA={})),(e=>{e.merge=function(e,t){let i={...e};return Object.assign(i,t),"PathGeometry"===i.type&&"extrusion"in t&&t.extrusion&&(i.extrusion={...e.extrusion},Object.assign(i.extrusion,XA.merge(i.extrusion,t.extrusion))),i}})(JA||(JA={})),(e=>{e.defaultData=function(t){if("RectangleGeometry"===t)return{width:320,height:320,type:t,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("UIGeometry"===t)return{type:t,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if("PathGeometry"===t)return{type:t,width:1,height:1,depth:1,path:WA.defaultData(),extrusion:$A};if("VectorGeometry"===t)return{width:1,height:1,type:t,subdivisions:12,shape:HA.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===t)return{type:t,operation:2,width:0,height:0,depth:0,phongAngle:35};if("ShapeBlendGeometry"===t)return{type:t,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if("TextGeometry"===t)return{type:t,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if("InputGeometry"===t)return{...e.defaultData("TextGeometry"),type:t,editable:!0};if("SphereGeometry"===t)return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}})(ZA||(ZA={}));var tx,ix,nx,rx,sx,ax,ox,lx,cx,hx,dx,ux,px,fx,mx,gx,vx,yx,bx,Ax,xx,wx,Sx,_x,Ex,Cx,Mx,Tx,Ix,Px,Dx,Rx,Bx,Lx,Ox,Nx,kx,Fx,Ux,zx,jx,Vx,Gx=["width","height","depth"];function Hx(e){e.layers.forEach((e=>{if("depth"===e.type&&void 0!==e.colorA){let t=e.colorA,i=e.colorB,n=[[t.r,t.g,t.b,t.a],[i.r,i.g,i.b,i.a]],r=[0,1];for(let e=2;e<10;e++)n.push(n[1]),r.push(1);let s={...Lg(ty(e),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,e.near),far:Math.max(0,e.far),colors:n,steps:r,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(e,s)}else if("depth"===e.type&&1===e.gradientType&&(e.near<0||e.far<0)){let t={...ty(e),near:Math.max(e.near,0),far:Math.max(e.far,0)};Object.assign(e,t)}}))}function Wx(e,t){Object.values(e.shared.materials).forEach((e=>t(e)))}function Qx(e,t){e.scene.objects.traverse(((e,i)=>{"materials"in i?i.materials.forEach(((e,n)=>{void 0===e&&(i.materials[n]=GA.defaultData(),e=i.materials[n]),"string"!=typeof e&&t(e)})):"material"in i?"string"!=typeof i.material&&(void 0===i.material&&(i.material=GA.defaultData()),t(i.material)):"Mesh"===i.type&&(void 0===i.material&&(i.material=GA.defaultData()),t(i.material)),"overrides"in i&&Object.values(i.overrides).forEach((e=>{e.material&&"string"!=typeof e.material&&Object.getPrototypeOf(e.material)!==Iv.prototype&&t(e.material)}))}))}function qx(e){void 0===e.layers&&Object.assign(e,GA.defaultTwoLayerData("lambert"))}function Xx(e){!e.layers||e.layers.forEach((e=>{if("depth"===e.type&&10===e.colors.length){let t=[...e.colors];t.push(e.colors[9]);let i=[...e.steps];i.push(e.steps[9]);let n={...ty(e),colors:t,steps:i};Object.assign(e,n)}}))}function Yx(e){e.scene.objects.traverse(((e,t)=>{"materials"in t?t.materials.forEach((e=>{"string"!=typeof e&&Xx(e)})):"material"in t&&"string"!=typeof t.material&&Xx(t.material)})),Object.values(e.shared.materials).forEach((e=>Xx(e)))}function Kx(e){e.layers&&e.layers.forEach((e=>{"depth"===e.type&&void 0!==e.num&&(e.colors=e.colors.slice(0,e.num),e.steps=e.steps.slice(0,e.num),delete e.num)}))}function Jx(e){e.layers&&e.layers.forEach((e=>{(function(e){return"displace"!==e.type})(e)&&void 0===e.isMask&&(e.isMask=!1),("texture"===e.type||"video"===e.type)&&void 0===e.blending&&(e.blending=0),("noise"===e.type||"displace"===e.type&&"noise"===e.displacementType)&&(void 0===e.voronoiStyle&&(e.voronoiStyle=0),void 0===e.highCut&&(e.highCut=1),void 0===e.lowCut&&(e.lowCut=0),void 0===e.smoothness&&(e.smoothness=.3),void 0===e.seed&&(e.seed=0),void 0===e.quality&&(e.quality=1))}))}function Zx(e){let t=e.layers.find((e=>"light"===e.type))?.data;if("basic"===t?.category){let e=VA.defaultData("light","phong"),i=t;Object.assign(i,e),i.visible=!1}}function $x(e){Wx(e,Zx),Qx(e,Zx)}function ew(e){e.layers.forEach((e=>{"light"===e.type&&"toon"!==e.category&&void 0===e.occlusion&&(e.occlusion=!0)}))}function tw(e){e.layers&&e.layers.forEach((e=>{"light"===e.type&&void 0===e.bumpMapIntensity&&(e.bumpMapIntensity=5)}))}function iw(e,t){if(t<1&&(Qx(e,Hx),Wx(e,Hx),e.schema=1),t<2&&(function(e){Object.assign(e.scene.publish,{orbitControls:{...Ex.defaultData,...ty(e.scene.publish.orbitControls)}})}(e),e.schema=2),t<3&&(function(e){function t(e){if(e.layers)for(let t of Object.values(e.layers))if(t)for(let[e,i]of Object.entries(t))if((QA.includes(e)||"boolean"==typeof i)&&delete t[e],"texture"===e)for(let[t,n]of Object.entries(i))(qA.includes(t)||"boolean"==typeof n)&&delete i[t]}e.scene.objects.traverse(((e,i)=>{i.states.forEach((e=>{let i=e;i.material?t(i.material):i.materials&&i.materials.forEach((e=>{t(e)}))}))}))}(e),e.schema=3),t<4&&(function(e){e.scene.publish.withBackground=!0}(e),e.schema=4),t<5&&(function(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}(e),e.schema=5),t<6&&(function(e){e.scene.objects.traverse(((e,t)=>{let i=t.cloner;i&&(i.radial.scale=i.radial.scale.map((e=>e+1)),i.linear.scale=i.linear.scale.map((e=>e+1)))}))}(e),e.schema=6),t<7&&(function(e){e.scene.objects.traverse(((e,t)=>{let i=t.geometry;i&&("DodecahedronGeometry"===i.type||"IcosahedronGeometry"===i.type)&&(i.detail=Math.round(i.detail))}))}(e),e.schema=7),t<8&&(e.schema=8),t<9&&(Yx(e),e.schema=9),t<10&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&("BooleanGeometry"===t.geometry.type||"SubdivGeometry"===t.geometry.type)&&(t.geometry.phongAngle=35)}))}(e),e.schema=10),t<11&&(function(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse(((e,t)=>{("DirectionalLight"===t.type||"SpotLight"===t.type)&&(t.shadowResolution=1024,t.shadowRadius=1,t.depth=1e5)})),e.shared.penumbraSize=new Array(5).fill(.5)}(e),e.schema=11),t<12&&(Yx(e),e.schema=12),t<13&&(function(e){e.shared.audios=kg({},uv.prototype)}(e),e.schema=13),t<14&&(function(e){let t=e.shared.materials;Object.entries(t).forEach((e=>{let[i,n]=e;if(!n.layers){let e={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:e})}}))}(e),e.schema=14),t<15&&(function(e){Object.entries(ty(e.shared.images)).filter((e=>!1===e[1].asset)).map((e=>e[0])).forEach((t=>{delete e.shared.images[t]})),Object.entries(ty(e.shared.audios)).filter((e=>!1===e[1].asset)).map((e=>e[0])).forEach((t=>{delete e.shared.audios[t]}))}(e),e.schema=15),t<16&&(function(e){e.scene.publish.settings.web.preload=!1}(e),e.schema=16),t<17&&(Qx(e,Kx),Wx(e,Kx),e.schema=17),t<18&&(Qx(e,qx),Wx(e,qx),e.schema=18),t<19&&(function(e){Object.assign(e.scene.publish.settings,{video:{...Cx.defaultData.settings.video,...ty(e.scene.publish.settings.video)}})}(e),e.schema=19),t<20&&(function(e){e.shared.fonts=kg({},uv.prototype)}(e),function(e){let t=[];e.scene.objects.traverse(((i,n)=>{let r=n;if("TextFrame"===r.type){let n=GA.defaultTwoLayerData("phong"),s="string"==typeof r.color?e.shared.colors[r.color]:r.color;n.layers[1].data.color={r:s.r,g:s.g,b:s.b},n.layers[1].data.alpha=r.alpha;let a=function(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")}(r.font);void 0===e.shared.fonts[a]&&(e.shared.fonts[a]={name:a});let o={name:r.name,...ux.defaultData,...vx.defaultData,flatShading:!1,wireframe:!1,geometry:{...ZA.defaultData("TextGeometry"),width:r.width,height:r.height,font:a,depth:0,horizontalAlign:r.horizontalAlign,verticalAlign:r.verticalAlign,fontSize:1.40625*r.fontSize,lineHeight:r.lineHeight/1.40625,letterSpacing:r.letterSpacing-1,text:r.text,textTransform:r.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:n,states:ty(r.states),events:ty(r.events),visible:r.visible,raycastLock:r.raycastLock,position:r.position,rotation:r.rotation,scale:r.scale,hiddenMatrix:r.hiddenMatrix},l=ty(e.scene.objects).parent(i);e.scene.objects.insertAfter(l??null,i,[{id:i+"new",data:o,children:[]}]),t.push(i)}})),t.forEach((t=>{e.scene.objects.delete(t)}))}(e),e.schema=20),t<21&&(function(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse(((e,i)=>{i.events.forEach((e=>{if(t[Number(e.type)])if(Object.assign(e,{type:t[Number(e.type)]}),"Audio"===e.type&&"audioEvent"in e&&(Object.assign(e,{playAudio:e.audioEvent}),delete e.audioEvent),"GameControl"===e.type)Object.assign(e,{gameActions:{idle:new wv,move:new wv,jump:new wv}});else{let t=new wv;Object.assign(e,{actions:t}),("MouseDown"===e.type||"MouseUp"===e.type||"KeyDown"===e.type||"KeyUp"===e.type)&&"url"in e&&t.push({fi:0,id:ui.generateUUID(),data:{type:"Link",url:e.url,delay:0}}),"targets"in e&&(e.targets.forEach(((e,i,n)=>{let r={easing:e.easing,duration:e.duration};6===e.easing?Object.assign(r,Lg(e,"mass","stiffness","damping","velocity")):5===e.easing&&Object.assign(r,{control1:{...e.control1},control2:{...e.control2}});let s={repeat:e.repeat?-1:0,delay:e.delay,delayDirection:e.delayDirection,direction:e.cycle&&e.rewind?"pingpong-rewind":e.cycle?"pingpong":"normal"},a={state:e.state,...s,...r},o={allowSlerp:!0,type:"Transition",object:e.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new wv({fi:0,id:ui.generateUUID(),data:{state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4}},{fi:1,id:ui.generateUUID(),data:a})};t.push({fi:n,id:i,data:o})})),delete e.targets)}}))}))}(e),function(e){e.scene.objects.traverse(((e,t)=>{function i(e,i){let n=new wv,r=[];if(t.events.forEach(((e,t,s)=>{if("Audio"===e.type&&e.trigger===i){let i;r.push(t),"play"===e.interaction?i={...Lg(e,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in e?e.after:void 0,toggle:"after"in e?e.toggle:void 0,type:"Audio"}:("pause"===e.interaction||"stop"===e.interaction)&&(i={...Lg(e,"interaction","delay","object","playAudio"),type:"Audio"}),i&&n.push({fi:s,id:t,data:i})}})),r.forEach((e=>t.events.delete(e))),n.length){let i=t.events.find((t=>t.type===e))?.data;i?"actions"in i&&i.actions.insertBefore(null,n):t.events.insertBefore(null,[{id:ui.generateUUID(),data:{type:e,actions:n}}])}}i("Start","start"),i("MouseDown","mouseDown"),i("MouseUp","mouseUp"),i("KeyDown","keyDown"),i("KeyUp","keyUp")}))}(e),e.schema=21),t<22&&($x(e),e.schema=22),t<23&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&"SubdivGeometry"===t.geometry.type&&(t.geometry.scaleBaked||(t.geometry.scaleBaked=[1,1,1]))}))}(e),e.schema=23),t<24&&(function(e){e.scene.objects.traverse(((e,t)=>{("Empty"===t.type||"Mesh"===t.type)&&t.cloner&&!t.cloner.randomnessObject&&!t.cloner.toObject&&!t.cloner.randomness&&(t.cloner={...t.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})}))}(e),e.schema=24),(t<25||void 0===e.shared.videos)&&(function(e){e.shared.videos=kg({},uv.prototype)}(e),t<25&&(e.schema=25)),t<26&&(function(e){e.scene.objects.traverse(((t,i)=>{let n=e.scene.objects.unproxy().parent(t);if(n){let t=ty(e.scene.objects.data(n));t&&"Mesh"===t.type&&"BooleanGeometry"===t.geometry.type&&"Mesh"===i.type&&(i.visible=!0!==ty(i).booleanExclude)}}))}(e),e.schema=26),t<27&&(function(e){e.scene.objects.traverse(((e,t)=>{if("Mesh"===t.type){let e=t;"NonParametricGeometry"===t.geometry.type?void 0!==e.material&&delete e.material:void 0!==e.materials&&delete e.materials}}))}(e),e.schema=27),t<28&&($x(e),e.schema=28),t<29&&(function(e){function t(e){Object.setPrototypeOf(e,Iv.prototype),e.texture&&Object.setPrototypeOf(e.texture,Iv.prototype)}function i(e){Object.setPrototypeOf(e,Iv.prototype);for(let i in e)t(e[i])}e.scene.objects.traverse(((e,t)=>{t.states.forEach((e=>{let t=e;if(t.material){let e=ty(t.material).layers;i(e),t.material.layers=e}if(t.materials)for(let n=0;n<t.materials.length;n++){let e=t.materials[n],r=ty(e).layers;i(r),e.layers=r}}))}))}(e),e.schema=29),t<30&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&"NonParametricGeometry"===t.geometry.type&&!("material"in t)&&!("materials"in t)&&(t.material=GA.defaultTwoLayerData("phong"))}))}(e),e.schema=30),t<31&&(function(e){void 0===e.scene.publish.orbitControls.autoZoom&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse(((e,t)=>{("OrthographicCamera"===t.type||"PerspectiveCamera"===t.type)&&(void 0===t.orthographic.autoZoom&&(t.orthographic.autoZoom=!1),void 0===t.orthographic.autoZoomFrustumSize&&(t.orthographic.autoZoomFrustumSize=790))}))}(e),e.schema=31),t<33&&(function(e){e.scene.objects.traverse(((e,t)=>{void 0===t.pathSnapping&&(t.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),void 0===t.pathSnapping.offset&&(t.pathSnapping.offset=0)}))}(e),e.schema=33),t<34&&(function(e){void 0===e.scene.publish.mouseEventTarget&&(e.scene.publish.mouseEventTarget="canvas"),void 0===e.scene.publish.settings.web.hint&&(e.scene.publish.settings.web.hint=!1)}(e),e.schema=34),t<35&&(function(e){let{video:t}=e.scene.publish.settings;"gif"===t.format&&t.fps>48&&(t.fps=15)}(e),e.schema=35),t<36&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&(e.resetYPosition=Math.abs(e.resetYPosition-t.position[1]))}))}))}(e),e.schema=36),t<37&&(function(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse(((e,i)=>{t&&null===i.physics?i.collision=!1:i.collision="visibility"}))}(e),e.schema=37),t<38&&(Qx(e,Jx),Wx(e,Jx),e.schema=38),t<39&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&(e.navmesh=Vx.defaultDataThirdPerson.navmesh)}))}))}(e),e.schema=39),t<40&&(function(e){e.scene.styles||(e.scene.styles=Ix.defaultData())}(e),e.schema=40),t<41&&(function(e){void 0===e.scene.environment.ambientLight.occlusion&&(e.scene.environment.ambientLight.occlusion=!1),void 0===e.scene.environment.ambientLight.aoFullRes&&(e.scene.environment.ambientLight.aoFullRes=!1),void 0===e.scene.environment.ambientLight.radius&&(e.scene.environment.ambientLight.radius=256),void 0===e.scene.environment.ambientLight.bias&&(e.scene.environment.ambientLight.bias=.5),void 0===e.scene.environment.ambientLight.aoColor&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Qx(e,ew),Wx(e,ew)}(e),e.schema=41),t<42&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&Object.assign(e.gameActions,{run:new wv})}))}))}(e),e.schema=42),t<43&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&(e.keyAssignments=[...e.keyAssignments,["run","\u21e7"],["none","Ctrl"]])}))}))}(e),e.schema=43),t<99){Qx(e,tw),Wx(e,tw),null===e.scene.publish.playCamera&&(e.scene.publish.playCamera=xA);let t=ty(e.scene.objects),i=e.scene.objects;e.scene.publish.playPage=wA,i.insertBefore(null,null,[{id:wA,data:{...wx.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:Lg(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:Lg(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...ax.defaultData,...Lg(e.scene.environment,"usePhysics","gravity")},camera:ty(e.scene.ownerCamera)??wx.defaultData.camera,name:"Scene"},children:[]}]);for(let e of t)e.id!==Dx.TRASH_CAN_ID&&i.move(wA,e.fi,e.id);let n=0,r=0;e.shared.penumbraSize&&e.scene.objects.traverse(((t,i)=>{"DirectionalLight"===i.type?(i.penumbraSize=e.shared.penumbraSize[Math.min(n,2)],n+=1):"SpotLight"===i.type&&(i.penumbraSize=e.shared.penumbraSize[3+Math.min(r,1)],r+=1),(void 0===i.physics||null===i.physics)&&"Instance"!==i.type&&(i.physics={},Object.assign(i.physics,TA.defaultData)),void 0!==i.physics&&null!==i.physics&&(i.physics.enabled=i.collision??"visibility",delete i.collision)})),e.schema=99}}function nw(e){e.layers&&e.layers.forEach((e=>{"light"===e.type&&void 0===e.alphaOverride&&(e.alphaOverride=1)}))}(e=>{e.defaultData={enabled:!1,useBackgroundColor:!1,color:lA.white,near:.1,far:2e3}})(tx||(tx={})),(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focusDistance:100,focalLength:20,bokehScale:5},noise:{...t,blendFunction:16}}})(ix||(ix={})),(e=>{e.defaultData={softShadowQuality:"low"}})(nx||(nx={})),(e=>{e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75}})(rx||(rx={})),(e=>{e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}}})(sx||(sx={})),(e=>{e.defaultData={usePhysics:!1,gravity:-10}})(ax||(ax={})),(e=>{e.defaultData={playCamera:xA,gameControlObject:null}})(ox||(ox={})),(e=>{e.defaultData={backgroundColor:hA.fromHexAndA(2960946,1),postprocessing:ix.defaultData,fog:tx.defaultData,globalPhysics:ax.defaultData,ambient:rx.defaultData,ao:sx.defaultData,shadow:nx.defaultData,publish:ox.defaultData}})(lx||(lx={})),(e=>{e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95}})(cx||(cx={})),(e=>{e.isComponentRelated=function(e){return"Component"===e||"Instance"===e},e.isEmptyOrComponent=function(e){return"Empty"===e||"Instance"===e}})(hx||(hx={})),(e=>{e.identity={...uA.identity,hiddenMatrix:aA.identity},e.fromObject=function(e){return{position:e.position,rotation:e.rotation,scale:e.scale,hiddenMatrix:e.hiddenMatrix}},e.merge=function(e,t){return{position:t?.position||e.position,rotation:t?.rotation||e.rotation,scale:t?.scale||e.scale,hiddenMatrix:t?.hiddenMatrix||e.hiddenMatrix}},e.diff=function(e,t){return Ng({position:iA.isEqual(e.position,t.position)?void 0:t.position,rotation:iA.isEqual(e.rotation,t.rotation)?void 0:t.rotation,scale:iA.isEqual(e.scale,t.scale)?null:t.scale,hiddenMatrix:aA.isEqual(e.hiddenMatrix,t.hiddenMatrix)?void 0:t.hiddenMatrix})}})(dx||(dx={})),(e=>{e.defaultData={states:new wv,events:new wv,visible:!0,raycastLock:!1,physics:TA.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...dx.identity,cloner:null}})(ux||(ux={})),(e=>{e.defaultData={type:"Empty",...ux.defaultData}})(px||(px={})),(e=>{e.defaultData={type:"ParticleCollider",...cx.defaultData,...ux.defaultData}})(fx||(fx={})),(e=>{e.defaultData={type:"Component",...ux.defaultData}})(mx||(mx={})),(e=>{e.defaultData={type:"Particle",...ux.defaultData,...MA.defaultData}})(gx||(gx={})),(e=>{e.defaultData={type:"Mesh",...ux.defaultData,...DA.defaultData}})(vx||(vx={})),(e=>{e.defaultData={...ux.defaultData,...dx.identity,position:[0,0,yA.DefaultTargetOffset],...yA.defaultData}})(yx||(yx={})),(e=>{e.defaultData=function(e){return{...ux.defaultData,...CA.defaultData(e)}},e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(bx||(bx={})),(e=>{function t(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;i<t.length;){let n=e?e[t[i]]:void 0;if(t.length===i+1)return n;if(!n)return;e=n.descendants,i+=1}}e.resolveWithDes=t,e.resolve=function(e,i){let n=t(e,i,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);if(n){let e=Object.keys(n);if(1===e.length&&"descendants"===e[0])return}return n}})(Ax||(Ax={})),(e=>{function t(e,t){return{...ux.defaultData,...t,component:e,overrides:new Iv,physics:void 0,events:void 0,type:"Instance"}}e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"],e.ofComponent=t,e.fromComponentData=function(e){let i=dx.fromObject(e.data);return t(e.id,i)}})(xx||(xx={})),(e=>{e.defaultData={type:"Page",...ux.defaultData,physics:{...TA.defaultData,fusedBody:!1},...lx.defaultData,camera:yx.defaultData},e.isUIPage=function(e){return void 0!==e.uiScene}})(wx||(wx={})),(e=>{e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:aA.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:TA.defaultData,states:new wv,events:new wv,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...yA.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...ux.defaultData,...vx.defaultData,geometry:ZA.defaultData("RectangleGeometry"),material:GA.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...ux.defaultData,...vx.defaultData,geometry:ZA.defaultData("BooleanGeometry"),material:GA.defaultTwoLayerData("phong","layer1","layer2")},e.defaultShapeBlendObject={name:"Shape Blend",...ux.defaultData,...vx.defaultData,geometry:ZA.defaultData("ShapeBlendGeometry"),material:GA.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...ux.defaultData,...vx.defaultData,geometry:ZA.defaultData("TextGeometry"),material:GA.defaultTwoLayerData("phong","layer1","layer2")},e.defaultInputObject={name:"Input",...ux.defaultData,...vx.defaultData,geometry:ZA.defaultData("InputGeometry"),material:GA.defaultTwoLayerData("phong","layer1","layer2")}})(Sx||(Sx={})),(e=>{e.newEmpty=function(e,t){let i={name:t};return"Mesh"===e.type?(i.geometry={},"material"in e&&(i.material={layers:new Iv}),"materials"in e&&(i.materials=e.materials.map((e=>({layers:new Iv}))))):vA.is(e.type)&&(i.perspective={},i.orthographic={}),i},e.toOps=function(e,t){let i,n=[],r={orthographic:0,perspective:0,geometry:0};function s(e,t){for(let[i,r]of Object.entries(t.layers)){let{texture:t,...s}=r;if(void 0!==t&&Object.keys(t).length>0){let r={path:[...e,"layers",i,"texture"],props:t,type:0};n.push(r)}if(Object.keys(s).length>0){let t={path:[...e,"layers",i],props:s,type:0};n.push(t)}}}for(let[a,o]of Object.entries(t))if("name"!==a)if("cloner"===a)n.push(...AA.toOps(o,["cloner"]));else if("pathSnapping"===a)n.push({path:[a],props:{slide:o.slide,offset:o.offset},type:0});else if("material"===a)s(["material"],o);else if("materials"===a)for(let[e,t]of Object.entries(o))s(["materials",e],t);else if(0===r[a]){if("geometry"===a&&void 0!==o.extrusion){let e={path:[a,"extrusion"],props:o.extrusion,type:0};n.push(e),o={...o},delete o.extrusion}if(Object.keys(o).length>0){let e={path:[a],props:o,type:0};n.push(e)}}else void 0===i&&(i={path:[],props:{},type:0},n.push(i)),i.props[a]=o;return n},e.patch=function(e,t){if(void 0===t)return e;let i={...e};if(Object.assign(i,dx.merge(i,t)),Object.assign(i,{pathSnapping:Object.assign({},i.pathSnapping,{slide:t.pathSnapping?.slide??i.pathSnapping?.slide??0,offset:t.pathSnapping?.offset??i.pathSnapping?.offset??0})}),vA.is(e.type)){i.orthographic={...i.orthographic},i.perspective={...i.perspective};let e=t;void 0!==e.orthographic?.zoom&&(i.orthographic.zoom=e.orthographic.zoom),void 0!==e.perspective?.zoom&&(i.perspective.zoom=e.perspective.zoom),void 0!==e.isUpVectorFlipped&&(i.isUpVectorFlipped=e.isUpVectorFlipped),void 0!==e.targetOffset&&(i.targetOffset=e.targetOffset)}else if("Mesh"===e.type)"geometry"in t&&Object.assign(i,{geometry:JA.merge(i.geometry,t.geometry)}),(t.material||t.materials)&&(i=function(e,t){if(void 0===t)return e;let i={...e};return"material"in i&&"material"in t&&t.material&&(i.material=ey(i.material,(e=>{if("string"!=typeof e)for(let[i,n]of Object.entries(t.material.layers)){let t=e.layers.data(i);t&&VA.patch(t,n)}})).data),i.materials&&t.materials&&(i.materials=ey(i.materials,(e=>{for(let n=0;n<i.materials.length;n++){let i=t.materials[n];if("string"!=typeof i)for(let[t,r]of Object.entries(i.layers)){let i=e[n]?.layers?.data(t);i&&VA.patch(i,r)}}})).data),i}(i,t)),i.cloner&&"cloner"in t&&Object.assign(i,{cloner:bA.merge(i.cloner,t.cloner)});else if("Empty"===e.type)i.cloner&&"cloner"in t&&Object.assign(i,{cloner:bA.merge(i.cloner,t.cloner)});else if(EA.is(e.type)){let e=t;void 0!==e.intensity&&(i.intensity=e.intensity),void 0!==e.color&&("string"==typeof e.color?i.color=e.color:i.color=lA.clone(e.color))}return i}})(_x||(_x={})),(e=>{e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0}})(Ex||(Ex={})),(e=>{e.defaultData={orbitControls:Ex.defaultData,playPage:wA,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map(((e,t)=>{let i=0,n=0;return t<5?n=-30:t<10&&(n=30),0===t||10===t||5===t?i=30:(4===t||11===t||9===t)&&(i=-30),[120,[i,n],"show"]})),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1}})(Cx||(Cx={})),(e=>{e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""}})(Mx||(Mx={})),(e=>{e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0}})(Tx||(Tx={})),(e=>{e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...Mx.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:Tx.defaultData}),e.generateSeed=()=>Math.round(1e5*Math.random())})(Ix||(Ix={})),(e=>{e.physicsEnabled=function(e){return void 0!==e.find((e=>"Page"===e.data.type&&e.data.globalPhysics.usePhysics))},e.traverseModuleInstances=function(e,t,i){e.scene.objects.traverseFrom(t,((t,n)=>{if("Instance"===n.type){let r=ow.getComponentData(e,n.component)?.data;r&&i(t,n,r.events)}else i(t,n,n.events)}))}})(Px||(Px={})),(e=>{function t(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[],r=Sx.defaultMeshObject;t&&(n.push({...e.defaultLight}),n.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:r,children:[]})),n.push(...i);let s=new xv;return s.push({fi:1,id:wA,data:{...wx.defaultData,name:"Scene 1"},children:n}),s}function i(t){return{...e.defaultData,objects:kg(t,xv.prototype)}}e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:bx.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]},e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:Cx.defaultData,styles:Ix.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new xv,publish:Cx.defaultData,styles:Ix.defaultData()}},e.emptyDataWithPage=function(){return{objects:t(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]),publish:Cx.defaultData,styles:Ix.defaultData()}},e.emptyData=function(){return{objects:new xv,publish:{...Cx.defaultData},styles:Ix.defaultData()}},e.withObjs=i,e.withObj=function(e,t){return i([{id:e,data:t,children:[],fi:0}])}})(Dx||(Dx={})),(e=>{e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}}})(Rx||(Rx={})),(e=>{e.defaultData=e=>({url:e,name:"New Webhook",parametersSchemas:new wv}),e.defaultParameterValueByType=e=>"number"===e?0:"boolean"!==e&&""})(Bx||(Bx={})),(e=>{e.defaultData=function(e){return{url:e,method:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",name:"New API",headers:new wv,queries:new wv,autoStart:!0}}})(Lx||(Lx={})),(e=>{function t(e){return void 0!==e.textValue}function i(e){return"boolean"==typeof e}e.isTextValue=t,e.isNumber=function(e){return"number"==typeof e},e.isBoolean=i,e.typeOfVariable=function(e){return t(e)?"string":i(e)?"boolean":"number"},e.getDisplayedValue=function(t){return e.isTextValue(t)?Array.isArray(t.textValue)?t.textValue.map((e=>e.toString().padStart(t.padding??2,"0"))).join(t.deliminator??":")+(void 0!==t.suffix?" "+t.suffix:""):t.textValue.toString():e.isBoolean(t)?t?"True":"False":e.isNumber(t)?parseFloat(t.toFixed(3)).toString():t.toString()}})(Ox||(Ox={})),(e=>{e.all=["images","videos","colors","audios","particles","fonts","materials","variables"]})(Nx||(Nx={})),(e=>{e.all=[...Nx.all,"components"]})(kx||(kx={})),(e=>{e.defaultData=function(){return{images:new uv,videos:new uv,colors:new uv,audios:new uv,particles:new uv,fonts:new uv,materials:new uv,components:new uv,variables:new uv,userAPIs:new uv,userWebhooks:new uv}}})(Fx||(Fx={})),(e=>{e.defaultData=function(){return{images:new uv,videos:new uv,colors:new uv,audios:new uv,particles:new uv,fonts:new uv,materials:new uv,components:new uv,variables:new uv,userAPIs:new uv,userWebhooks:new uv}}})(Ux||(Ux={})),(e=>{e.defaultColors=function(){let e={"89b10010-844c-11ec-a8a3-0242ac120002":{r:.5,g:.5,b:.5,a:1,name:"Default Color"}};return kg(e,uv.prototype)},e.defaultImages=function(){return kg({},uv.prototype)},e.emptyData=function(){return{catelogs:new uv,materials:new uv,images:new uv,videos:new uv,colors:new uv,audios:new uv,particles:new uv,fonts:new uv,variables:new wv,userAPIs:new uv,userWebhooks:new uv,lib:Ux.defaultData()}},e.defaultVariables=function(e){switch(e){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let t=[0,0,0];return{name:"Time",value:{textValue:t,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:t,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",e)}},e.getFormattedTimerTime=function(e,t){if("HH:mm:ss"===t.format){let t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60);return{textValue:[t,i,Math.round(e-3600*t-60*i)]}}if("mm:ss"===t.format){let t=Math.floor(e/60);return{textValue:[t,Math.round(e-60*t)]}}return e="number"===t.format?Math.round(e):Math.round(1e3*e)/1e3}})(zx||(zx={})),(e=>{e.list=["idle","move","jump","run"]})(jx||(jx={})),(e=>{e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","\u25b2"],["rotPosY","\u25c0"],["rotNegX","\u25bc"],["rotNegY","\u25b6"],["jump","Space"],["run","\u21e7"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new wv,move:new wv,jump:new wv,run:new wv},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:hA.fromHexAndA(3728051,1)}}})(Vx||(Vx={}));var rw=180/Math.PI;function sw(e){e.rotation=e.rotation.slice(0,3).map((e=>e*rw))}function aw(e){sw(e),"Page"===e.type&&sw(e.camera),e.states?.forEach((e=>{void 0===e.rotation||null===e.rotation||(e.rotation=e.rotation.slice(0,3).map((e=>e*rw)))}));let t=e.geometry;t&&"SphereGeometry"===t.type&&(t.thetaLength=(t.thetaLength??180)*rw),t&&"TorusGeometry"===t.type&&(t.arc=t.arc*rw),t&&"PathGeometry"===t.type&&(t.extrusion.angle*=rw,t.extrusion.twist*=rw),"Mesh"===e.type&&"TextGeometry"===e.geometry.type&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(ty(e.events))&&e.events?.forEach((e=>{("MouseDown"===e.type||"MouseUp"===e.type||"MousePress"===e.type||"KeyDown"===e.type||"KeyUp"===e.type||"KeyPress"===e.type||"Collision"===e.type||"Trigger"===e.type)&&(e.runMode=e.toggle?"Toggle":"Repeat")}))}var ow,lw,cw,hw,dw,uw,pw,fw,mw,gw,vw,yw,bw,Aw,xw,ww,Sw,_w,Ew,Cw,Mw=115;function Tw(e,t){t(e.data);for(let i of e.children)Tw(i,t)}function Iw(e){let t=e.schema??104;t!==Mw&&t<105&&(Tw(e.asset,aw),e.schema=105)}function Pw(e){let t=e.schema??0;if(t!==Mw){console.warn("updating from ",t,"to ",Mw),iw(e,t),t<100&&(void 0===e.scene.publish.joystickSizeAndXYOffset&&(e.scene.publish.joystickSizeAndXYOffset=Cx.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(Qx(e,nw),Wx(e,nw),e.schema=101),t<102&&(function(e){e.scene.objects.traverse(((e,t)=>{let i=t.geometry;i&&"PathGeometry"===i.type&&(i.extrusion.capType="flat",i.extrusion.bevel=50,i.extrusion.bevelSides=6,"Custom"===i.extrusion.shape.type&&(i.extrusion.shape.shapeQuality="low"))}))}(e),e.schema=102),t<104&&(e.shared.catelogs=new uv,e.shared.lib=Ux.defaultData(),e.schema=104),t<105&&(function(e){e.shared.variables=kg({},uv.prototype)}(e),e.scene.objects.traverse(((e,t)=>{aw(t)})),e.schema=105);for(let t of Object.values(e.shared.lib.components))Iw(t);t<106&&(function(e){let t=ty(e.shared.variables);e.shared.variables=kg(Object.entries(t??{}).map(((e,t)=>{let[i,n]=e;return{fi:t,id:i,data:n}})),wv.prototype)}(e),e.schema=106),t<107&&(e.shared.lib.variables=Ux.defaultData().variables,e.schema=107),t<109&&(function(e){e.shared.particles=kg({},uv.prototype),e.shared.lib&&(e.shared.lib.particles=Ux.defaultData().particles)}(e),e.schema=109),t<110&&(function(e){e.scene.objects.traverse(((e,t)=>{"Particle"===t.type&&"number"==typeof t.renderMaterial.size&&Object.assign(t.renderMaterial,{size:[t.renderMaterial.size,t.renderMaterial.size]})}))}(e),e.schema=110),t<111&&(e.scene.objects.traverse(((e,t)=>{!function(e){Array.isArray(ty(e.events))&&e.events?.forEach((e=>{"disabled"in e||(e.disabled=!1),("MouseDown"===e.type||"MouseUp"===e.type||"MousePress"===e.type)&&(e.mode=e.mode||"Object")}))}(t)})),e.schema=111),t<112&&(function(e){e.scene.objects.traverse(((e,t)=>{"Page"===t.type&&(t.postprocessing.depthOfField.focusDistance=100,t.postprocessing.depthOfField.focalLength=20,t.postprocessing.depthOfField.bokehScale=5)}))}(e),e.schema=112),t<113&&(function(e){e.scene.objects.traverse(((e,t)=>{!1!==Array.isArray(ty(t.events))&&t.events?.forEach((e=>{let t=e.runMode;"MouseDown"===e.type||"MouseUp"===e.type||"KeyDown"===e.type||"KeyUp"===e.type||"Collision"===e.type||"Trigger"===e.type?e.actions?.forEach((e=>{"Transition"===e.type&&(e.runMode=t??"Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle"===t?"Toggle":"Normal")})):"MouseHover"===e.type||"MousePress"===e.type||"KeyPress"===e.type?e.actions?.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")})):"GameControl"===e.type?(delete e.actions,Object.keys(e.gameActions).forEach((t=>{e.gameActions[t]?.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),"Animation"===e.type&&(e.runMode="Normal")}))}))):"DragDrop"===e.type?(delete e.actions,e.dragDropActions?.drag?.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")})),e.dragDropActions?.drop?.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")}))):"Resize"===e.type?(delete e.actions,e.breakpoints?.forEach((e=>{e.actions?.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")}))}))):"Start"===e.type?e.actions?.forEach((e=>{"Transition"===e.type&&(e.runMode="Once"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})):"VariableChange"===e.type||"Scroll"===e.type?e.actions?.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})):"Conditional"===e.type&&(delete e.actions,e.inActions?.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})),e.outActions?.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})))}))}))}(e),e.schema=113),t<114&&(void 0===e.scene.publish.settings.web.imageQuality&&(e.scene.publish.settings.web.imageQuality=70),e.schema=114),t<115&&(function(e){e.shared.userAPIs=kg({},uv.prototype),e.shared.userWebhooks=kg({},uv.prototype),e.shared.lib&&(e.shared.lib.userAPIs=Ux.defaultData().userAPIs,e.shared.lib.userWebhooks=Ux.defaultData().userWebhooks)}(e),e.schema=115)}}function Dw(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new yr,c=0;for(let h=0;h<e.length;++h){let d=e[h],u=0;if(i!==(null!==d.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let e in d.attributes){if(!n.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[e]&&(s[e]=[]),s[e].push(d.attributes[e]),u++}if(u!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(o!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let e in d.morphAttributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[e]&&(a[e]=[]),a[e].push(d.morphAttributes[e])}if(t){let e;if(i)e=d.index.count;else{if(void 0===d.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;e=d.attributes.position.count}l.addGroup(c,e,h),c+=e}}if(i){let t=0,i=[];for(let n=0;n<e.length;++n){let r=e[n].index;for(let e=0;e<r.count;++e)i.push(r.getX(e)+t);t+=e[n].attributes.position.count}l.setIndex(i)}for(let h in s){let e=Rw(s[h]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,e)}for(let h in a){let e=a[h][0].length;if(0===e)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let t=0;t<e;++t){let e=[];for(let n=0;n<a[h].length;++n)e.push(a[h][n][t]);let i=Rw(e);if(!i)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(i)}}return l}function Rw(e){let t,i,n,r=0;for(let o=0;o<e.length;++o){let s=e[o];if(s.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=s.itemSize),i!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=s.normalized),n!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=s.array.length}let s=new t(r),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new or(s,i,n)}(e=>{e.defaultData={schema:Mw,scene:Dx.defaultData,frames:(new uv).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Rx.defaultData),shared:{...zx.emptyData(),colors:zx.defaultColors()}},e.emptyDataForImports=function(){let e=Dx.emptyDataWithPage();return{schema:Mw,scene:e,frames:(new uv).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Rx.defaultData),shared:{...zx.emptyData(),colors:zx.defaultColors(),images:zx.defaultImages()}}},e.emptyData=function(){return{schema:Mw,scene:Dx.emptyDataWithPage(),frames:(new uv).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Rx.defaultData),shared:zx.emptyData()}},e.clipboard2dData=function(){return{schema:Mw,scene:Dx.emptyData(),frames:new uv,shared:zx.emptyData()}},e.collabHelper={...Tv,updateSchema:e=>(e.schema??0)<Mw?ey(e,Pw):(e.schema??0)-Mw},e.updateSchemaDirectly=function(t){let i=e.collabHelper.updateSchema(t);return"number"==typeof i?0===i?t:null:i.data},e.withoutLib=function(e){return{...e,shared:{...e.shared,lib:Ux.defaultData()}}},e.getComponentData=function(e,t){let i=e.scene.objects.get(t);if(i&&"Component"===i.data.type)return i;{let i=e.shared.lib.components[t];if(i)return i.asset}},e.hasSensitiveData=function(e){let t=Object.values(e.shared.userAPIs);for(let i of t){let e=i.headers;for(let t of e)if("authorization"===t.data.key.toLowerCase()&&""!==t.data.value)return!0}return!1}})(ow||(ow={})),(e=>{e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"}})(lw||(lw={})),(e=>{e.is=function(e){return!0}})(cw||(cw={})),(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]},e.merge=function(e,t){return{position:t?.position??e.position,rotation:t?.rotation??e.rotation,scale:t?.scale??e.scale,shear:t?.shear??e.shear}},e.diff=function(e,t){return Ng({position:tA.isEqual(e.position,t.position)?void 0:t.position,rotation:e.rotation===t.rotation?void 0:t.rotation,scale:tA.isEqual(e.scale,t.scale)?void 0:t.scale,shear:e.shear&&t.shear&&tA.isEqual(e.shear,t.shear)?void 0:t.shear})}})(hw||(hw={})),(e=>{e.defaultData={horizontalConstraint:0,verticalConstraint:0}})(dw||(dw={})),(e=>{e.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8}})(uw||(uw={})),(e=>{e.defaultData={opacity:1,fill:{color:hA.fromHexAndA(SA,1),enabled:!0},stroke:{color:hA.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:hA.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:hA.from0to1([0,0,0,1]),enabled:!1,spread:0}}})(pw||(pw={})),(e=>{e.newEmpty=function(e,t){return{name:t}},e.patch=function(e,t){if(void 0===t)return e;let i={...e};return Object.assign(i,hw.merge(i,t)),i=function(e,t){if(void 0===t)return e;let i={...e},n=["width","height","cornerRadius"];for(let r of n)r in i&&r in t&&void 0!==t[r]&&Object.assign(i,{[r]:t[r]});return i}(i,t),i=function(e,t){if(void 0===t)return e;let i={...e};return"fill"in i&&"fill"in t&&void 0!==t.fill&&Object.assign(i,{fill:{...i.fill,...t.fill}}),"stroke"in i&&"stroke"in t&&void 0!==t.stroke&&Object.assign(i,{stroke:{...i.stroke,...t.stroke}}),"layerBlur"in i&&"layerBlur"in t&&void 0!==t.layerBlur&&Object.assign(i,{layerBlur:{...i.layerBlur,...t.layerBlur}}),"backgroundBlur"in i&&"backgroundBlur"in t&&void 0!==t.backgroundBlur&&Object.assign(i,{backgroundBlur:{...i.backgroundBlur,...t.backgroundBlur}}),"dropShadow"in i&&"dropShadow"in t&&void 0!==t.dropShadow&&Object.assign(i,{dropShadow:{...i.dropShadow,...t.dropShadow}}),"innerShadow"in i&&"innerShadow"in t&&void 0!==t.innerShadow&&Object.assign(i,{innerShadow:{...i.innerShadow,...t.innerShadow}}),i}(i,t),i},e.toOps=function(e,t){let i,n=[];for(let[r,s]of Object.entries(t))"name"!==r&&(void 0===i&&(i={path:[],props:{},type:0},n.push(i)),i.props[r]=s);return n}})(fw||(fw={})),(e=>{e.defaultData={...hw.defaultData,...dw.defaultData,states:new wv,events:new wv,visible:!0,raycastLock:!1}})(mw||(mw={})),(e=>{e.defaultData={...mw.defaultData,...pw.defaultData}})(gw||(gw={})),(e=>{e.defaultData={cornerRadius:[0,0,0,0]}})(vw||(vw={})),(e=>{e.defaultData={...gw.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"}})(yw||(yw={})),(e=>{e.defaultData={...gw.defaultData,...vw.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"}})(bw||(bw={})),(e=>{e.defaultData={...gw.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"}})(Aw||(Aw={})),(e=>{e.defaultData={...gw.defaultData,type:"path2d",path:"",name:"Path"}})(xw||(xw={})),(e=>{e.is=function(e){return"ellipse2d"===e.type||"rectangle2d"===e.type||"text2d"===e.type||"vector2d"===e.type||"path2d"===e.type}})(ww||(ww={})),(e=>{e.defaultData={...mw.defaultData,name:"Group",type:"group2d"}})(Sw||(Sw={})),(e=>{e.defaultData=()=>({...mw.defaultData,...vw.defaultData,...pw.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:hA.fromHexAndA(4737101,1),enabled:!0},stroke:{color:hA.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}})})(_w||(_w={})),(e=>{e.defaultData=function(e){switch(e){case"rectangle2d":case"vector2d":return{...bw.defaultData};case"ellipse2d":return{...yw.defaultData};case"text2d":return{...Aw.defaultData};case"path2d":return{...xw.defaultData};case"frame2d":return{..._w.defaultData()};case"group2d":return{...Sw.defaultData}}},e.getPivot=function(e){return"width"in e&&"height"in e?["number"==typeof e.width?.5*e.width:0,"number"==typeof e.height?.5*e.height:0]:[0,0]},e.isResizeable=function(e){return"rectangle2d"===e.type||"ellipse2d"===e.type||"text2d"===e.type||"frame2d"===e.type},e.isAutoLayoutable=function(e){return"frame2d"===e.type&&void 0!==e.autoLayout},e.hasCorners=function(e){return"rectangle2d"===e.type||"frame2d"===e.type}})(Ew||(Ew={})),(e=>{e.defaultData={name:"UI",type:"scene2d",objects:new xv},e.emptyData=function(){return{type:"scene2d",objects:new xv}}})(Cw||(Cw={}));var Bw=Math.pow(2,-24),Lw=class{constructor(){}};function Ow(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function Nw(e){let t=-1,i=-1/0;for(let n=0;n<3;n++){let r=e[n+3]-e[n];r>i&&(i=r,t=n)}return t}function kw(e,t){t.set(e)}function Fw(e,t,i){let n,r;for(let s=0;s<3;s++){let a=s+3;n=e[s],r=t[s],i[s]=n<r?n:r,n=e[a],r=t[a],i[a]=n>r?n:r}}function Uw(e,t,i){for(let n=0;n<3;n++){let r=t[e+2*n],s=t[e+2*n+1],a=r-s,o=r+s;a<i[n]&&(i[n]=a),o>i[n+3]&&(i[n+3]=o)}}function zw(e){let t=e[3]-e[0],i=e[4]-e[1],n=e[5]-e[2];return 2*(t*i+i*n+n*t)}function jw(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,h=-1/0,d=1/0,u=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,v=null!==r;for(let y=6*t,b=6*(t+i);y<b;y+=6){let t=e[y+0],i=e[y+1],n=t-i,r=t+i;n<s&&(s=n),r>l&&(l=r),v&&t<d&&(d=t),v&&t>f&&(f=t);let b=e[y+2],A=e[y+3],x=b-A,w=b+A;x<a&&(a=x),w>c&&(c=w),v&&b<u&&(u=b),v&&b>m&&(m=b);let S=e[y+4],_=e[y+5],E=S-_,C=S+_;E<o&&(o=E),C>h&&(h=C),v&&S<p&&(p=S),v&&S>g&&(g=S)}n[0]=s,n[1]=a,n[2]=o,n[3]=l,n[4]=c,n[5]=h,v&&(r[0]=d,r[1]=u,r[2]=p,r[3]=f,r[4]=m,r[5]=g)}var Vw=32,Gw=(e,t)=>e.candidate-t.candidate,Hw=new Array(Vw).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),Ww=new Float32Array(6);function Qw(e,t){function i(e){u&&u(e/p)}function n(t,r,u){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!f&&m>=l&&(f=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),u<=h||m>=l)return i(r+u),t.offset=r,t.count=u,t;let g=function(e,t,i,n,r,s){let a=-1,o=0;if(0===s)a=Nw(t),-1!==a&&(o=(t[a]+t[a+3])/2);else if(1===s)a=Nw(e),-1!==a&&(o=function(e,t,i,n){let r=0;for(let s=t,a=t+i;s<a;s++)r+=e[6*s+2*n];return r/i}(i,n,r,a));else if(2===s){let s=zw(e),l=1.25*r,c=6*n,h=6*(n+r);for(let e=0;e<3;e++){let n=t[e],d=(t[e+3]-n)/Vw;if(r<Vw/4){let t=[...Hw];t.length=r;let n=0;for(let r=c;r<h;r+=6,n++){let s=t[n];s.candidate=i[r+2*e],s.count=0;let{bounds:a,leftCacheBounds:o,rightCacheBounds:l}=s;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0;Uw(r,i,a)}t.sort(Gw);let d=r;for(let e=0;e<d;e++){let i=t[e];for(;e+1<d&&t[e+1].candidate===i.candidate;)t.splice(e+1,1),d--}for(let r=c;r<h;r+=6){let n=i[r+2*e];for(let e=0;e<d;e++){let s=t[e];n>=s.candidate?Uw(r,i,s.rightCacheBounds):(Uw(r,i,s.leftCacheBounds),s.count++)}}for(let i=0;i<d;i++){let n=t[i],c=n.count,h=r-n.count,d=n.leftCacheBounds,u=n.rightCacheBounds,p=0;0!==c&&(p=zw(d)/s);let f=0;0!==h&&(f=zw(u)/s);let m=1+1.25*(p*c+f*h);m<l&&(a=e,l=m,o=n.candidate)}}else{for(let e=0;e<Vw;e++){let t=Hw[e];t.count=0,t.candidate=n+d+e*d;let i=t.bounds;for(let e=0;e<3;e++)i[e]=1/0,i[e+3]=-1/0}for(let r=c;r<h;r+=6){let t=~~((i[r+2*e]-n)/d);t>=Vw&&(t=Vw-1);let s=Hw[t];s.count++,Uw(r,i,s.bounds)}let t=Hw[Vw-1];kw(t.bounds,t.rightCacheBounds);for(let e=Vw-2;e>=0;e--){let t=Hw[e],i=Hw[e+1];Fw(t.bounds,i.rightCacheBounds,t.rightCacheBounds)}let u=0;for(let i=0;i<Vw-1;i++){let t=Hw[i],n=t.count,c=t.bounds,h=Hw[i+1].rightCacheBounds;0!==n&&(0===u?kw(c,Ww):Fw(c,Ww,Ww)),u+=n;let d=0,p=0;0!==u&&(d=zw(Ww)/s);let f=r-u;0!==f&&(p=zw(h)/s);let m=1+1.25*(d*u+p*f);m<l&&(a=e,l=m,o=t.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}(t.boundingData,p,a,r,u,d);if(-1===g.axis)return i(r+u),t.offset=r,t.count=u,t;let v=function(e,t,i,n,r){let s=i,a=i+n-1,o=r.pos,l=2*r.axis;for(;;){for(;s<=a&&t[6*s+l]<o;)s++;for(;s<=a&&t[6*a+l]>=o;)a--;if(!(s<a))return s;for(let i=0;i<3;i++){let n=e[3*s+i];e[3*s+i]=e[3*a+i],e[3*a+i]=n;let r=t[6*s+2*i+0];t[6*s+2*i+0]=t[6*a+2*i+0],t[6*a+2*i+0]=r;let o=t[6*s+2*i+1];t[6*s+2*i+1]=t[6*a+2*i+1],t[6*a+2*i+1]=o}s++,a--}}(o,a,r,u,g);if(v===r||v===r+u)i(r+u),t.offset=r,t.count=u;else{t.splitAxis=g.axis;let e=new Lw,i=r,o=v-r;t.left=e,e.boundingData=new Float32Array(6),jw(a,i,o,e.boundingData,s),n(e,i,o,s,m+1);let l=new Lw,c=v,h=u-o;t.right=l,l.boundingData=new Float32Array(6),jw(a,c,h,l.boundingData,s),n(l,c,h,s,m+1)}return t}!function(e,t){if(!e.index){let i,n=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;i=n>65535?new Uint32Array(new r(4*n)):new Uint16Array(new r(2*n)),e.setIndex(new or(i,1));for(let e=0;e<n;e++)i[e]=e}}(e,t);let r=new Float32Array(6),s=new Float32Array(6),a=function(e,t){let i=e.attributes.position,n=e.index.array,r=n.length/3,s=new Float32Array(6*r),a=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let h=["getX","getY","getZ"];for(let d=0;d<r;d++){let e,r,u,p=3*d,f=6*d;a?(e=n[p+0],r=n[p+1],u=n[p+2]):(e=n[p+0]*c+l,r=n[p+1]*c+l,u=n[p+2]*c+l);for(let n=0;n<3;n++){let l,c,d;a?(l=i[h[n]](e),c=i[h[n]](r),d=i[h[n]](u)):(l=o[e+n],c=o[r+n],d=o[u+n]);let p=l;c<p&&(p=c),d<p&&(p=d);let m=l;c>m&&(m=c),d>m&&(m=d);let g=(m-p)/2,v=2*n;s[f+v+0]=p+g,s[f+v+1]=g+(Math.abs(p)+g)*Bw,p<t[n]&&(t[n]=p),m>t[n+3]&&(t[n+3]=m)}}return s}(e,r),o=e.index.array,l=t.maxDepth,c=t.verbose,h=t.maxLeafTris,d=t.strategy,u=t.onProgress,p=e.index.count/3,f=!1,m=[],g=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let r of e.groups)i.add(r.start),i.add(r.start+r.count);let n=Array.from(i.values()).sort(((e,t)=>e-t));for(let r=0;r<n.length-1;r++){let e=n[r],i=n[r+1];t.push({offset:e/3,count:(i-e)/3})}return t}(e);if(1===g.length){let e=g[0],t=new Lw;t.boundingData=r,function(e,t,i,n){let r=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0;for(let h=6*t,d=6*(t+i);h<d;h+=6){let t=e[h+0];t<r&&(r=t),t>o&&(o=t);let i=e[h+2];i<s&&(s=i),i>l&&(l=i);let n=e[h+4];n<a&&(a=n),n>c&&(c=n)}n[0]=r,n[1]=s,n[2]=a,n[3]=o,n[4]=l,n[5]=c}(a,e.offset,e.count,s),n(t,e.offset,e.count,s),m.push(t)}else for(let v of g){let e=new Lw;e.boundingData=new Float32Array(6),jw(a,v.offset,v.count,e.boundingData,s),n(e,v.offset,v.count,s),m.push(e)}return m}var qw=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,n=-1/0;for(let r=0,s=e.length;r<s;r++){let s=e[r][t];i=s<i?s:i,n=s>n?s:n}this.min=i,this.max=n}setFromPoints(e,t){let i=1/0,n=-1/0;for(let r=0,s=t.length;r<s;r++){let s=t[r],a=e.dot(s);i=a<i?a:i,n=a>n?a:n}this.min=i,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}};qw.prototype.setFromBox=function(){let e=new Vi;return function(t,i){let n=i.min,r=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let i=0;i<=1;i++)for(let l=0;l<=1;l++){e.x=n.x*o+r.x*(1-o),e.y=n.y*i+r.y*(1-i),e.z=n.z*l+r.z*(1-l);let c=t.dot(e);s=Math.min(c,s),a=Math.max(c,a)}this.min=s,this.max=a}}();!function(){let e=new qw}();var Xw=function(){let e=new Vi,t=new Vi,i=new Vi;return function(n,r,s){let a=n.start,o=e,l=r.start,c=t;i.subVectors(a,l),e.subVectors(n.end,n.start),t.subVectors(r.end,r.start);let h,d,u=i.dot(c),p=c.dot(o),f=c.dot(c),m=i.dot(o),g=o.dot(o)*f-p*p;h=0!==g?(u*p-m*f)/g:0,d=(u+h*p)/f,s.x=h,s.y=d}}(),Yw=function(){let e=new pi,t=new Vi,i=new Vi;return function(n,r,s,a){Xw(n,r,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1)return n.at(o,s),void r.at(l,a);if(o>=0&&o<=1)return l<0?r.at(0,a):r.at(1,a),void n.closestPointToPoint(a,!0,s);if(l>=0&&l<=1)return o<0?n.at(0,s):n.at(1,s),void r.closestPointToPoint(s,!0,a);{let e,c;e=o<0?n.start:n.end,c=l<0?r.start:r.end;let h=t,d=i;return n.closestPointToPoint(c,!0,t),r.closestPointToPoint(e,!0,i),h.distanceToSquared(c)<=d.distanceToSquared(e)?(s.copy(h),void a.copy(c)):(s.copy(e),void a.copy(d))}}}(),Kw=function(){let e=new Vi,t=new Vi,i=new Yr,n=new Rh;return function(r,s){let{radius:a,center:o}=r,{a:l,b:c,c:h}=s;if(n.start=l,n.end=c,n.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(n.start=l,n.end=h,n.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(n.start=c,n.end=h,n.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let d=s.getPlane(i);if(Math.abs(d.distanceToPoint(o))<=a){let e=d.projectPoint(o,t);if(s.containsPoint(e))return!0}return!1}}();function Jw(e){return Math.abs(e)<1e-15}var Zw=class extends tr{constructor(){super(...arguments),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new Vi)),this.satBounds=new Array(4).fill().map((()=>new qw)),this.points=[this.a,this.b,this.c],this.sphere=new hn,this.plane=new Yr,this.needsUpdate=!0}intersectsSphere(e){return Kw(e,this)}update(){let e=this.a,t=this.b,i=this.c,n=this.points,r=this.satAxes,s=this.satBounds,a=r[0],o=s[0];this.getNormal(a),o.setFromPoints(a,n);let l=r[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,n);let h=r[2],d=s[2];h.subVectors(t,i),d.setFromPoints(h,n);let u=r[3],p=s[3];u.subVectors(i,e),p.setFromPoints(u,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};Zw.prototype.closestPointToSegment=function(){let e=new Vi,t=new Vi,i=new Rh;return function(n){let r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,{start:o,end:l}=n,c=this.points,h=1/0;for(let d=0;d<3;d++){let o=(d+1)%3;i.start.copy(c[d]),i.end.copy(c[o]),Yw(i,n,e,t),r=e.distanceToSquared(t),r<h&&(h=r,s&&s.copy(e),a&&a.copy(t))}return this.closestPointToPoint(o,e),r=o.distanceToSquared(e),r<h&&(h=r,s&&s.copy(e),a&&a.copy(o)),this.closestPointToPoint(l,e),r=l.distanceToSquared(e),r<h&&(h=r,s&&s.copy(e),a&&a.copy(l)),Math.sqrt(h)}}(),Zw.prototype.intersectsTriangle=function(){let e=new Zw,t=new Array(3),i=new Array(3),n=new qw,r=new qw,s=new Vi,a=new Vi,o=new Vi,l=new Vi,c=new Rh,h=new Rh,d=new Rh;return function(u){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.needsUpdate&&this.update(),u.isExtendedTriangle?u.needsUpdate&&u.update():(e.copy(u),e.update(),u=e);let m=this.plane,g=u.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let e=this.satBounds,a=this.satAxes;i[0]=u.a,i[1]=u.b,i[2]=u.c;for(let t=0;t<4;t++){let r=e[t],s=a[t];if(n.setFromPoints(s,i),r.isSeparated(n))return!1}let o=u.satBounds,l=u.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let i=0;i<4;i++){let e=o[i],r=l[i];if(n.setFromPoints(r,t),e.isSeparated(n))return!1}for(let c=0;c<4;c++){let e=a[c];for(let a=0;a<4;a++){let o=l[a];if(s.crossVectors(e,o),n.setFromPoints(s,t),r.setFromPoints(s,i),n.isSeparated(r))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}{let e=this.points,t=!1,i=0;for(let o=0;o<3;o++){let n=e[o],r=e[(o+1)%3];c.start.copy(n),c.end.copy(r),c.delta(a);let s=t?h.start:h.end,l=Jw(g.distanceToPoint(n));if(Jw(g.normal.dot(a))&&l){h.copy(c),i=2;break}if((g.intersectLine(c,s)||l)&&!Jw(s.distanceTo(r))){if(i++,t)break;t=!0}}if(1===i&&u.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(2!==i)return!1;let n=u.points,r=!1,s=0;for(let a=0;a<3;a++){let e=n[a],t=n[(a+1)%3];c.start.copy(e),c.end.copy(t),c.delta(o);let i=r?d.start:d.end,l=Jw(m.distanceToPoint(e));if(Jw(m.normal.dot(o))&&l){d.copy(c),s=2;break}if((m.intersectLine(c,i)||l)&&!Jw(i.distanceTo(t))){if(s++,r)break;r=!0}}if(1===s&&this.containsPoint(d.end))return p&&(p.start.copy(d.end),p.end.copy(d.end)),!0;if(2!==s)return!1;if(h.delta(a),d.delta(o),a.dot(o)<0){let e=d.start;d.start=d.end,d.end=e}let f=h.start.dot(a),v=h.end.dot(a),y=d.start.dot(a),b=d.end.dot(a);return(f===b||y===v||v<y!==f<b)&&(p&&(l.subVectors(h.start,d.start),l.dot(a)>0?p.start.copy(h.start):p.start.copy(d.start),l.subVectors(h.end,d.end),l.dot(a)<0?p.end.copy(h.end):p.end.copy(d.end)),!0)}}}(),Zw.prototype.distanceToPoint=function(){let e=new Vi;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Zw.prototype.distanceToTriangle=function(){let e=new Vi,t=new Vi,i=["a","b","c"],n=new Rh,r=new Rh;return function(s){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=a||o?n:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let t=0;t<3;t++){let n,r=i[t],l=s[r];this.closestPointToPoint(l,e),n=l.distanceToSquared(e),n<c&&(c=n,a&&a.copy(e),o&&o.copy(l));let h=this[r];s.closestPointToPoint(h,e),n=h.distanceToSquared(e),n<c&&(c=n,a&&a.copy(h),o&&o.copy(e))}for(let h=0;h<3;h++){let l=i[h],d=i[(h+1)%3];n.set(this[l],this[d]);for(let h=0;h<3;h++){let l=i[h],d=i[(h+1)%3];r.set(s[l],s[d]),Yw(n,r,e,t);let u=e.distanceToSquared(t);u<c&&(c=u,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(c)}}();var $w=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new Vi,this.max=new Vi,this.matrix=new bn,this.invMatrix=new bn,this.points=new Array(8).fill().map((()=>new Vi)),this.satAxes=new Array(3).fill().map((()=>new Vi)),this.satBounds=new Array(3).fill().map((()=>new qw)),this.alignedSatBounds=new Array(3).fill().map((()=>new qw)),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};$w.prototype.update=function(){let e=this.matrix,t=this.min,i=this.max,n=this.points;for(let l=0;l<=1;l++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let a=n[1*l|2*r|4*s];a.x=l?i.x:t.x,a.y=r?i.y:t.y,a.z=s?i.z:t.z,a.applyMatrix4(e)}let r=this.satBounds,s=this.satAxes,a=n[0];for(let l=0;l<3;l++){let e=s[l],t=r[l],i=n[1<<l];e.subVectors(a,i),t.setFromPoints(e,n)}let o=this.alignedSatBounds;o[0].setFromPointsField(n,"x"),o[1].setFromPointsField(n,"y"),o[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},$w.prototype.intersectsBox=function(){let e=new qw;return function(t){this.needsUpdate&&this.update();let i=t.min,n=t.max,r=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=n.x,a[0].isSeparated(e)||(e.min=i.y,e.max=n.y,a[1].isSeparated(e))||(e.min=i.z,e.max=n.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let i=s[o],n=r[o];if(e.setFromBox(i,t),n.isSeparated(e))return!1}return!0}}(),$w.prototype.intersectsTriangle=function(){let e=new Zw,t=new Array(3),i=new qw,n=new qw,r=new Vi;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let e=0;e<3;e++){let n=a[e],r=o[e];if(i.setFromPoints(r,t),n.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,h=this.points;for(let e=0;e<3;e++){let t=l[e],n=c[e];if(i.setFromPoints(n,h),t.isSeparated(i))return!1}for(let e=0;e<3;e++){let s=o[e];for(let e=0;e<4;e++){let a=c[e];if(r.crossVectors(s,a),i.setFromPoints(r,t),n.setFromPoints(r,h),i.isSeparated(n))return!1}}return!0}}(),$w.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},$w.prototype.distanceToPoint=function(){let e=new Vi;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),$w.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map((()=>new Rh)),i=new Array(12).fill().map((()=>new Rh)),n=new Vi,r=new Vi;return function(s){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(r),this.closestPointToPoint(r,n),s.closestPointToPoint(n,r),o&&o.copy(n),l&&l.copy(r)),0;let c=a*a,h=s.min,d=s.max,u=this.points,p=1/0;for(let e=0;e<8;e++){let t=u[e];r.copy(t).clamp(h,d);let i=t.distanceToSquared(r);if(i<p&&(p=i,o&&o.copy(t),l&&l.copy(r),i<c))return Math.sqrt(i)}let f=0;for(let n=0;n<3;n++)for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let a=(n+1)%3,o=(n+2)%3,l=1<<n|r<<a|s<<o,c=u[r<<a|s<<o],p=u[l];t[f].set(c,p);let m=e[n],g=e[a],v=e[o],y=i[f],b=y.start,A=y.end;b[m]=h[m],b[g]=r?h[g]:d[g],b[v]=s?h[v]:d[g],A[m]=d[m],A[g]=r?h[g]:d[g],A[v]=s?h[v]:d[g],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let i=0;i<=1;i++){r.x=e?d.x:h.x,r.y=t?d.y:h.y,r.z=i?d.z:h.z,this.closestPointToPoint(r,n);let s=r.distanceToSquared(n);if(s<p&&(p=s,o&&o.copy(n),l&&l.copy(r),s<c))return Math.sqrt(s)}for(let e=0;e<12;e++){let s=t[e];for(let e=0;e<12;e++){let t=i[e];Yw(s,t,n,r);let a=n.distanceToSquared(r);if(a<p&&(p=a,o&&o.copy(n),l&&l.copy(r),a<c))return Math.sqrt(a)}}return Math.sqrt(p)}}();var eS=new Vi,tS=new Vi,iS=new Vi,nS=new pi,rS=new pi,sS=new pi,aS=new Vi,oS=new Vi,lS=new Vi,cS=new Vi;function hS(e,t,i,n,r,s,a,o,l){eS.fromBufferAttribute(t,s),tS.fromBufferAttribute(t,a),iS.fromBufferAttribute(t,o);let c=function(e,t,i,n,r,s){let a;return a=s===B?e.intersectTriangle(n,i,t,!0,r):e.intersectTriangle(t,i,n,s!==L,r),null===a?null:{distance:e.origin.distanceTo(r),point:r.clone()}}(e,eS,tS,iS,cS,l);if(c){n&&(nS.fromBufferAttribute(n,s),rS.fromBufferAttribute(n,a),sS.fromBufferAttribute(n,o),c.uv=tr.getInterpolation(cS,eS,tS,iS,nS,rS,sS,new pi)),r&&(nS.fromBufferAttribute(r,s),rS.fromBufferAttribute(r,a),sS.fromBufferAttribute(r,o),c.uv1=tr.getInterpolation(cS,eS,tS,iS,nS,rS,sS,new pi)),i&&(aS.fromBufferAttribute(i,s),oS.fromBufferAttribute(i,a),lS.fromBufferAttribute(i,o),c.normal=tr.getInterpolation(cS,eS,tS,iS,aS,oS,lS,new Vi),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let t={a:s,b:a,c:o,normal:new Vi,materialIndex:0};tr.getNormal(eS,tS,iS,t.normal),c.face=t,c.faceIndex=s}return c}function dS(e,t,i,n,r){let s=3*n,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:c,normal:h,uv:d,uv1:u}=e.attributes,p=hS(i,c,h,d,u,a,o,l,t);return p?(p.faceIndex=n,r&&r.push(p),p):null}function uS(e,t,i,n){let r=e.a,s=e.b,a=e.c,o=t,l=t+1,c=t+2;i&&(o=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),r.x=n.getX(o),r.y=n.getY(o),r.z=n.getZ(o),s.x=n.getX(l),s.y=n.getY(l),s.z=n.getZ(l),a.x=n.getX(c),a.y=n.getY(c),a.z=n.getZ(c)}function pS(e,t,i,n,r,s,a){let o=i.index,l=i.attributes.position;for(let c=e,h=t+e;c<h;c++)if(uS(a,3*c,o,l),a.needsUpdate=!0,n(a,c,r,s))return!0;return!1}var fS=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function mS(e,t){return 65535===t[e+15]}function gS(e,t){return t[e+6]}function vS(e,t){return t[e+14]}function yS(e){return e+8}function bS(e,t){return t[e+6]}var AS=new Wi,xS=new Vi,wS=["x","y","z"];function SS(e,t,i,n,r){let s=2*e,a=IS,o=PS,l=DS;if(mS(s,o)){!function(e,t,i,n,r,s){for(let a=n,o=n+r;a<o;a++)dS(e,t,i,a,s)}(t,i,n,gS(e,l),vS(s,o),r)}else{let s=yS(e);MS(s,a,n,xS)&&SS(s,t,i,n,r);let o=bS(e,l);MS(o,a,n,xS)&&SS(o,t,i,n,r)}}function _S(e,t,i,n){let r=2*e,s=IS,a=PS,o=DS;if(mS(r,a)){return function(e,t,i,n,r){let s=1/0,a=null;for(let o=n,l=n+r;o<l;o++){let n=dS(e,t,i,o);n&&n.distance<s&&(a=n,s=n.distance)}return a}(t,i,n,gS(e,o),vS(r,a))}{let r,a,l=function(e,t){return t[e+7]}(e,o),c=wS[l],h=n.direction[c]>=0;h?(r=yS(e),a=bS(e,o)):(r=bS(e,o),a=yS(e));let d=MS(r,s,n,xS)?_S(r,t,i,n):null;if(d){let e=d.point[c];if(h?e<=s[a+l]:e>=s[a+l+3])return d}let u=MS(a,s,n,xS)?_S(a,t,i,n):null;return d&&u?d.distance<=u.distance?d:u:d||u||null}}var ES=function(){let e,t,i=[],n=new fS((()=>new Wi));return function(){e=n.getPrimitive(),t=n.getPrimitive(),i.push(e,t);let s=r(...arguments);n.releasePrimitive(e),n.releasePrimitive(t),i.pop(),i.pop();let a=i.length;return a>0&&(t=i[a-1],e=i[a-2]),s};function r(i,n,s,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;function h(e){let t=2*e,i=PS,n=DS;for(;!mS(t,i);)t=2*(e=yS(e));return gS(e,n)}function d(e){let t=2*e,i=PS,n=DS;for(;!mS(t,i);)t=2*(e=bS(e,n));return gS(e,n)+vS(t,i)}let u=2*i,p=IS,f=PS,m=DS;if(mS(u,f)){let t=gS(i,m),n=vS(u,f);return Ow(i,p,e),a(t,n,!1,c,l+i,e)}{let u,g,v,y,b=yS(i),A=bS(i,m),x=b,w=A;if(o&&(v=e,y=t,Ow(x,p,v),Ow(w,p,y),u=o(v),g=o(y),g<u)){x=A,w=b;let e=u;u=g,g=e,v=y}v||(v=e,Ow(x,p,v));let S,_=s(v,mS(2*x,f),u,c+1,l+x);if(2===_){let e=h(x);S=a(e,d(x)-e,!0,c+1,l+x,v)}else S=_&&r(x,n,s,a,o,l,c+1);if(S)return!0;y=t,Ow(w,p,y);let E,C=s(y,mS(2*w,f),g,c+1,l+w);if(2===C){let e=h(w);E=a(e,d(w)-e,!0,c+1,l+w,y)}else E=C&&r(w,n,s,a,o,l,c+1);return!!E}}}(),CS=function(){let e=new Zw,t=new Zw,i=new bn,n=new $w,r=new $w;return function s(a,o,l,c){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=2*a,u=IS,p=PS,f=DS;if(null===h&&(l.boundingBox||l.computeBoundingBox(),n.set(l.boundingBox.min,l.boundingBox.max,c),h=n),!mS(d,p)){let e=a+8,t=f[a+6];return Ow(e,u,AS),!!(h.intersectsBox(AS)&&s(e,o,l,c,h)||(Ow(t,u,AS),h.intersectsBox(AS)&&s(t,o,l,c,h)))}{let n=o,s=n.index,h=n.attributes.position,m=l.index,g=l.attributes.position,v=gS(a,f),y=vS(d,p);if(i.copy(c).invert(),l.boundsTree)return Ow(a,u,r),r.matrix.copy(i),r.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:e=>r.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(c),e.b.applyMatrix4(c),e.c.applyMatrix4(c),e.needsUpdate=!0;for(let i=3*v,n=3*(y+v);i<n;i+=3)if(uS(t,i,s,h),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}});for(let r=3*v,a=y+3*v;r<a;r+=3){uS(e,r,s,h),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let i=0,n=m.count;i<n;i+=3)if(uS(t,i,m,g),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function MS(e,t,i,n){return Ow(e,t,AS),i.intersectBox(AS,n)}var TS,IS,PS,DS,RS=[];function BS(e){TS&&RS.push(TS),TS=e,IS=new Float32Array(e),PS=new Uint16Array(e),DS=new Uint32Array(e)}function LS(){TS=null,IS=null,PS=null,DS=null,RS.length&&BS(RS.pop())}var OS=Symbol("skip tree generation"),NS=new Wi,kS=new Wi,FS=new bn,US=new $w,zS=new $w,jS=new Vi,VS=new Vi,GS=new Vi,HS=new Vi,WS=new Vi,QS=new Wi,qS=new fS((()=>new Zw)),XS=class{static serialize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),XS.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};let i,n=e.geometry,r=e._roots,s=n.getIndex();return i=t.cloneBuffers?{roots:r.map((e=>e.slice())),index:s.array.slice()}:{roots:r,index:s.array},i}static deserialize(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("boolean"==typeof i)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),XS.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});i={setIndex:!0,...i};let{index:n,roots:r}=e,s=new XS(t,{...i,[OS]:!0});if(s._roots=r,i.setIndex){let i=t.getIndex();if(null===i){let i=new or(e.index,1,!1);t.setIndex(i)}else i.array!==n&&(i.array.set(n),i.needsUpdate=!0)}return s}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[OS]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[OS]||(this._roots=function(e,t){let i,n,r,s=Qw(e,t),a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let h=0;h<s.length;h++){let e=s[h],t=new o(32*l(e));i=new Float32Array(t),n=new Uint32Array(t),r=new Uint16Array(t),c(0,e),a.push(t)}return a;function l(e){return e.count?1:1+l(e.left)+l(e.right)}function c(e,t){let s=e/4,a=e/2,o=!!t.count,l=t.boundingData;for(let n=0;n<6;n++)i[s+n]=l[n];if(o){let i=t.offset,o=t.count;return n[s+6]=i,r[a+14]=o,r[a+15]=65535,e+32}{let i,r=t.left,a=t.right,o=t.splitAxis;if(i=c(e+32,r),i/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[s+6]=i/4,i=c(i,a),n[s+7]=o,i}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Wi))),this.geometry=e}refit(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&Array.isArray(e)&&(e=new Set(e));let t,i,n,r,s=this.geometry,a=s.index.array,o=s.attributes.position,l=0,c=this._roots;for(let d=0,u=c.length;d<u;d++)t=c[d],i=new Uint32Array(t),n=new Uint16Array(t),r=new Float32Array(t),h(0,l),l+=t.byteLength;function h(t,s){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=2*t;if(65535===n[c+15]){let e=i[t+6],s=1/0,l=1/0,h=1/0,d=-1/0,u=-1/0,p=-1/0;for(let t=3*e,i=3*(e+n[c+14]);t<i;t++){let e=a[t],i=o.getX(e),n=o.getY(e),r=o.getZ(e);i<s&&(s=i),i>d&&(d=i),n<l&&(l=n),n>u&&(u=n),r<h&&(h=r),r>p&&(p=r)}return(r[t+0]!==s||r[t+1]!==l||r[t+2]!==h||r[t+3]!==d||r[t+4]!==u||r[t+5]!==p)&&(r[t+0]=s,r[t+1]=l,r[t+2]=h,r[t+3]=d,r[t+4]=u,r[t+5]=p,!0)}{let n=t+8,a=i[t+6],o=n+s,c=a+s,d=l,u=!1,p=!1;e?d||(u=e.has(o),p=e.has(c),d=!u&&!p):(u=!0,p=!0);let f=d||p,m=!1;(d||u)&&(m=h(n,s,d));let g=!1;f&&(g=h(a,s,d));let v=m||g;if(v)for(let e=0;e<3;e++){let i=n+e,s=a+e,o=r[i],l=r[i+3],c=r[s],h=r[s+3];r[t+e]=o<c?o:c,r[t+e+3]=l>h?l:h}return v}}}traverse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this._roots[t],n=new Uint32Array(i),r=new Uint16Array(i);!function t(s){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=2*s,l=65535===r[o+15];if(l){let t=n[s+6],c=r[o+14];e(a,l,new Float32Array(i,4*s,6),t,c)}else{let r=s+8,o=n[s+6],c=n[s+7];e(a,l,new Float32Array(i,4*s,6),c)||(t(r,a+1),t(o,a+1))}}(0)}raycast(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R,i=this._roots,n=this.geometry,r=[],s=t.isMaterial,a=Array.isArray(t),o=n.groups,l=s?t.side:t;for(let c=0,h=i.length;c<h;c++){let s=a?t[o[c].materialIndex].side:l,h=r.length;if(BS(i[c]),SS(0,n,s,e,r),LS(),a){let e=o[c].materialIndex;for(let t=h,i=r.length;t<i;t++)r[t].face.materialIndex=e}}return r}raycastFirst(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R,i=this._roots,n=this.geometry,r=t.isMaterial,s=Array.isArray(t),a=null,o=n.groups,l=r?t.side:t;for(let c=0,h=i.length;c<h;c++){let r=s?t[o[c].materialIndex].side:l;BS(i[c]);let h=_S(0,n,r,e);LS(),null!=h&&(null==a||h.distance<a.distance)&&(a=h,s&&(h.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(e,t){let i=this.geometry,n=!1;for(let r of this._roots)if(BS(r),n=CS(0,i,e,t),LS(),n)break;return n}shapecast(e,t,i){let n=this.geometry;if(e instanceof Function){if(t){let e=t;t=(t,i,n,r)=>{let s=3*i;return e(t,s,s+1,s+2,n,r)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let r=qS.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let e=o;o=(t,i,s,a,o)=>!!e(t,i,s,a,o)||pS(t,i,n,l,s,a,r)}else o||(o=l?(e,t,i,s)=>pS(e,t,n,l,i,s,r):(e,t,i)=>i);let c=!1,h=0;for(let d of this._roots){if(BS(d),c=ES(0,n,a,o,s,h),LS(),c)break;h+=d.byteLength}return qS.releasePrimitive(r),c}bvhcast(e,t,i){let{intersectsRanges:n,intersectsTriangles:r}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;FS.copy(t).invert();let c=qS.getPrimitive(),h=qS.getPrimitive();if(r){let e=function(e,i,n,d,u,p,f,m){for(let g=n,v=n+d;g<v;g++){uS(h,3*g,o,l),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let t=e,n=e+i;t<n;t++)if(uS(c,3*t,s,a),c.needsUpdate=!0,r(c,h,t,g,u,p,f,m))return!0}return!1};if(n){let t=n;n=function(i,n,r,s,a,o,l,c){return!!t(i,n,r,s,a,o,l,c)||e(i,n,r,s,a,o,l,c)}}else n=e}e.getBoundingBox(kS),kS.applyMatrix4(t);let d=this.shapecast({intersectsBounds:e=>kS.intersectsBox(e),intersectsRange:(t,i,r,s,a,o)=>(NS.copy(o),NS.applyMatrix4(FS),e.shapecast({intersectsBounds:e=>NS.intersectsBox(e),intersectsRange:(e,r,o,l,c)=>n(t,i,e,r,s,a,l,c)}))});return qS.releasePrimitive(c),qS.releasePrimitive(h),d}intersectsBox(e,t){return US.set(e.min,e.max,t),US.needsUpdate=!0,this.shapecast({intersectsBounds:e=>US.intersectsBox(e),intersectsTriangle:e=>US.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0;e.boundingBox||e.computeBoundingBox(),US.set(e.boundingBox.min,e.boundingBox.max,t),US.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=e.attributes.position,h=e.index,d=qS.getPrimitive(),u=qS.getPrimitive(),p=VS,f=GS,m=null,g=null;n&&(m=HS,g=WS);let v=1/0,y=null,b=null;return FS.copy(t).invert(),zS.matrix.copy(FS),this.shapecast({boundsTraverseOrder:e=>US.distanceToBox(e),intersectsBounds:(e,t,i)=>i<v&&i<s&&(t&&(zS.min.copy(e.min),zS.max.copy(e.max),zS.needsUpdate=!0),!0),intersectsRange:(i,n)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>zS.distanceToBox(e),intersectsBounds:(e,t,i)=>i<v&&i<s,intersectsRange:(e,s)=>{for(let a=3*e,A=3*(e+s);a<A;a+=3){uS(u,a,h,c),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let e=3*i,t=3*(i+n);e<t;e+=3){uS(d,e,l,o),d.needsUpdate=!0;let t=d.distanceToTriangle(u,p,m);if(t<v&&(f.copy(p),g&&g.copy(m),v=t,y=e/3,b=a/3),t<r)return!0}}}});for(let e=0,s=h?h.count:c.count;e<s;e+=3){uS(u,e,h,c),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=3*i,s=3*(i+n);t<s;t+=3){uS(d,t,l,o),d.needsUpdate=!0;let i=d.distanceToTriangle(u,p,m);if(i<v&&(f.copy(p),g&&g.copy(m),v=i,y=t/3,b=e/3),i<r)return!0}}}}),qS.releasePrimitive(d),qS.releasePrimitive(u),v===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=v,i.faceIndex=y,n&&(n.point?n.point.copy(g):n.point=g.clone(),n.point.applyMatrix4(FS),f.applyMatrix4(FS),n.distance=f.sub(n.point).length(),n.faceIndex=b),i)}closestPointToPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,r=i*i,s=n*n,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:t=>(jS.copy(e).clamp(t.min,t.max),jS.distanceToSquared(e)),intersectsBounds:(e,t,i)=>i<a&&i<s,intersectsTriangle:(t,i)=>{t.closestPointToPoint(e,jS);let n=e.distanceToSquared(jS);return n<a&&(VS.copy(jS),a=n,o=i),n<r}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(VS):t.point=VS.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach((t=>{Ow(0,new Float32Array(t),QS),e.union(QS)})),e}},YS=u(f()),KS=.5*(Math.sqrt(3)-1),JS=(3-Math.sqrt(3))/6,ZS=1/3,$S=1/6,e_=(Math.sqrt(5),Math.sqrt(5),e=>0|Math.floor(e)),t_=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),i_=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function n_(e){let t=new Uint8Array(512);for(let i=0;i<256;i++)t[i]=i;for(let i=0;i<255;i++){let n=i+~~(e()*(256-i)),r=t[i];t[i]=t[n],t[n]=r}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var r_,s_=new tr,a_=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let i=1;s_.a.fromBufferAttribute(e,n),s_.b.fromBufferAttribute(e,n+1),s_.c.fromBufferAttribute(e,n+2),i*=s_.getArea(),t[n/3]=i}this.distribution=new Float32Array(e.count/3);let i=0;for(let n=0;n<t.length;n++)i+=t[n],this.distribution[n]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*i);return this.sampleFace(n,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,n=t.length-1,r=-1;for(;i<=n;){let s=Math.ceil((i+n)/2);if(0===s||t[s-1]<=e&&t[s]>e){r=s;break}e<t[s]?n=s-1:i=s+1}return r}sampleFace(e,t,i){let n=this.randomFunction(),r=this.randomFunction();return n+r>1&&(n=1-n,r=1-r),s_.a.fromBufferAttribute(this.positionAttribute,3*e),s_.b.fromBufferAttribute(this.positionAttribute,3*e+1),s_.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(s_.a,n).addScaledVector(s_.b,r).addScaledVector(s_.c,1-(n+r)),s_.getNormal(i),this}},o_=u(m()),l_=new bn,c_=new bn,h_=new bn;(e=>{e.is=function(e){return e&&e.__isSPEObject}})(r_||(r_={}));var d_,u_=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new bn,this.copyPreviousMatrix=!0,this.hiddenMatrix=new bn,this.matrixWorldRigid=new bn,this.shearScale=new bn,this.shearScaleInv=new bn}get __isSPEObject(){return!0}isDescendantOf(e){e instanceof Hn&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);for(let t of this.children)t.updateMatrixWorld(e)}updateWorldMatrix(e,t){let i=this.parent;if(e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),t)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i of this.children)r_.is(i)&&i.traverseObject(e,t+1)}traverseObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t))for(let i of this.children)r_.is(i)&&i.traverseObject(e,t+1)}updateMatrixWorldSVD(){let e=this.matrixWorld.elements,t=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],{u:i,v:n,q:r}=(0,o_.SVD)(t),s=l_.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),a=c_.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),o=h_.copy(a).transpose();this.shearScale.makeScale(r[0],r[1],r[2]).multiply(o).premultiply(a),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(s,o).copyPosition(this.matrixWorld),r.every((e=>Math.abs(r[0]-e)<.01))?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(e,t){this.updateWorldMatrix(!0,!1);let i=(new bn).copy(this.matrixWorld).invert();return null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),i.multiply(e.parent.matrixWorld)),"hiddenMatrix"in e&&e.hiddenMatrix instanceof bn?e.hiddenMatrix.premultiply(i):e.applyMatrix4(i),e.updateWorldMatrix(!1,!1),this.add(e),void 0!==t&&(this.children.pop(),this.children.splice(t,0,e)),this}copy(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return super.copy(e,t),this.hasNonUniformScale=e.hasNonUniformScale,this}onAfterRender(e,t,i,n,r,s){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},p_=class extends(u_(Hn)){},f_=class extends p_{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];i?.object!==t&&(i&&this.remove(i),i=new f_(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){return void 0!==this.playModeVisible?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&!0===this.object.dataPatched.cloner?.hideBase}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return"Mesh"===this.object.type}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},m_=new Vi,g_=new Vi,v_=new bn,y_=[new Vi(-1,1,1),new Vi(-1,-1,1),new Vi(1,-1,1),new Vi(1,1,1),new Vi(-1,1,-1),new Vi(-1,-1,-1),new Vi(1,-1,-1),new Vi(1,1,-1)],b_=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],A_=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],x_=(e,t,i)=>{e.updateEntityBoxSize(m_,g_),v_.copy(t).multiply(e.matrixWorld),0===g_.x&&0===g_.y&&0===g_.z?i.push(new Vi(m_.x,m_.y,m_.z).applyMatrix4(v_)):y_.forEach((e=>{i.push(e.clone().multiply(g_).add(m_).applyMatrix4(v_))}))},w_=class extends Wi{constructor(){super(...arguments),this.matrix=new bn,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map((e=>e.clone())),this.faces=e.faces.map((e=>e.clone())),this.edges=e.edges.map((e=>e.clone())),this.centerEdges=e.centerEdges.map((e=>e.clone())),this}setFromObjectSize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=(new bn).copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t){let i=[];return!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2])?e.traverseEntity((e=>{if(e.visible||e.cloner&&e.data.visible){if(!("geometry"in e))return void i.push(new Vi);x_(e,t,i)}})):x_(e,t,i),this.setFromPoints(i)}getCenter(e){return(e=super.getCenter(e)).applyMatrix4(this.matrix),e}getPositionToCenter(e){return(e=super.getCenter(e)).applyMatrix4(v_.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(g_).multiplyScalar(.5),this.getCenter(m_),v_.copy(this.matrix).setPosition(m_),this.vertices=y_.map((e=>e.clone().multiply(g_).applyMatrix4(v_)))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=b_.map((e=>{let[t,i]=e;return new Rh(this.vertices[t],this.vertices[i])})),this.centerEdges=this.edges.map((e=>e.getCenter(new Vi)))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=A_.map((e=>{let[t,i]=e;return this.vertices[t].clone().add(this.vertices[i]).multiplyScalar(.5)}))}},S_={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},__=class extends Ml{constructor(){super()}getPoints(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,i=[],n=this.getCurveLengths(),r=n[n.length-1]/n.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=0===s?n[s]:n[s]-n[s-1],c=Math.ceil(t*l/r),h=o.getPoints(c);for(let t=0;t<h.length;t++){let n=h[t];e&&e.equals(n)||(i.push(n),e=n)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}},E_=.001;function C_(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=E_}function M_(e,t){let i=new Vi(...e.position),n=new Vi(...e.controlNext.position),r=new Vi(...t.controlPrevious.position),s=new Vi(...t.position);return C_(i,n,s)&&C_(i,r,s)}function T_(e){let t=e.points.map((e=>new Vi(...e.data.position))),i=[e.points[0]],n=new Vi(...i[0].data.position);for(let h=0;h<e.points.length-1;h++)C_(n,t[h],t[h+1])||(i.push(e.points[h]),n=t[h]);i.push(e.points[e.points.length-1]);let r=e.isClosed,s=i.length-(r?0:1),a=i.length,o=[];for(let h=0;h<a;h++){let t=i[h].data,n=new Vi(...t.position),s=new Vi(...t.controlPrevious.position),l=new Vi(...t.controlNext.position),c={position:n,baseRoundness:t.roundness,controlPrevious:s,controlNext:l};if(0===t.roundness||!e.isClosed&&(0===h||h===a-1)){o[h]={...c,removedLength:0};continue}let d=r&&h==a-1?0:h+1,u=i[r&&0==h?a-1:h-1].data,p=i[d].data,f=new Vi(...u.position),m=new Vi(...p.position),g=f.clone().sub(n).normalize(),v=m.clone().sub(n).normalize();Object.assign(c,{prevDir:g,nextDir:v});let y=M_(u,t),b=M_(t,p);if(y&&b){let e=g.clone().add(v).normalize(),i=e.clone().cross(g).length()/g.dot(e);o[h]={...c,tan:i,removedLength:t.roundness/i}}else o[h]={...c,removedLength:0}}for(let h=0;h<s;h++){let e=r&&h===a-1?0:h+1,t=o[h],i=o[e];if(0!==t.removedLength||0!==i.removedLength){let e=t.position.distanceTo(i.position);t.removedLength=Math.min(t.removedLength,e/2),i.removedLength=Math.min(i.removedLength,e/2)}}let l=[];for(let h=0;h<s;h++){let e=h,t=r&&h===a-1?0:h+1,n=o[e],s=o[t],c=null;if(M_(i[e].data,i[t].data)){let e=n.position.clone(),t=s.position.clone();(0!==n.removedLength||0!==s.removedLength)&&(n.nextDir&&e.add(n.nextDir.clone().setLength(n.removedLength)),s.prevDir&&t.add(s.prevDir.clone().setLength(s.removedLength))),e.distanceTo(t)>E_&&(c=new xl(e,e.clone().lerp(t,.3),t.clone().lerp(e,.3),t))}else n.position.distanceTo(s.position)>E_&&(c=new xl(n.position,n.controlNext,s.controlPrevious,s.position));l[2*h+1]=c}for(let h=0;h<a;h++){let e=o[h];if(0===e.removedLength){l[2*h]=null;continue}let t=e.position,i=e.prevDir.clone().multiplyScalar(e.removedLength).add(t),n=e.nextDir.clone().multiplyScalar(e.removedLength).add(t),r=e.tan*e.removedLength,s=e.prevDir.clone().add(e.nextDir).normalize(),a=i.clone().lerp(n,.5),c=i.distanceTo(n)/2,d=s.clone().multiplyScalar(Math.sqrt(Math.pow(r,2)-Math.pow(c,2))).add(a),u=s.clone().multiplyScalar(-r).add(d),p=t.distanceTo(u)/t.distanceTo(a),f=e.prevDir.clone().multiplyScalar(p*t.distanceTo(i)).add(t),m=f.clone().lerp(u,2),g=i.clone().lerp(f,4/3),v=n.clone().lerp(m,4/3);l[2*h]=new xl(i,g,v,n)}let c=new __;return l.forEach((e=>{e&&c.add(e)})),c}(e=>{e.is=function(e){return e&&e.__isEntity}})(d_||(d_={}));var I_=e=>d_.is(e),P_={type:"completeState",isfromEntity:!0},D_=["x","y","z"],R_=new Vi,B_=(new Vi).set(0,1,0),L_=e=>class extends(u_(e)){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new w_,this._recursiveBBox=new w_,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(e){let t=this.children[e];if(d_.is(t))return t}entityChildrenCount(){let e=this.children.length;for(;e--;)if(d_.is(this.children[e]))return e+1;return 0}get isConcreteEntity(){return"string"==typeof this.identity}get isVirtualEntity(){return"string"!=typeof this.identity}get isInstanceRoot(){return this.isConcreteEntity&&"Instance"===this.data.type}nearestInstanceSelfOrParent(){let e=this;for(;"Instance"!==e.data.type;){let t=e.parent;if(!d_.is(t))return;e=t}return e}forInstancesRec(e){this.instances.forEach((t=>{t.disposed||e(t),t.forInstancesRec(e)}))}super_Entity(e,t){"string"==typeof e&&(this.uuid=e),this.identity=e,this.data=t,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this.data.states.length||i){for(let e of this.data.states)_x.toOps(this.data,e.data).forEach((e=>{let i=Cv.replaceProps(e,this.data);this.dataPatched=this.data,this.updateByPatchedOp(i,this.data,t)}));if(null!==e){let i=this.data.states.data(e);i&&(this.dataPatched=_x.patch(this.data,i),_x.toOps(this.data,i).forEach((e=>{this.updateByPatchedOp(e,this.dataPatched,t)})))}i&&this.updateTransformState(this.dataPatched,t),this.stateSelection=e,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(e,t){e.setScalar(0),t.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((e=>{I_(e)&&e.resetBBoxNeedsUpdateSelf()})),this.traverseEntity((e=>{e.resetBBoxNeedsUpdateSelf()}))}find(e){let t;return this.traverseEntity((i=>{i.uuid===e&&(t=i)})),t}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children,i=t.indexOf(this)+1;if(d_.is(t[i]))return t[i];if(d_.is(e))return e.traverseSortNextHelper()}}sortNext(){let e=this.children;return this.children.length>0&&d_.is(this.children[0])?e[0]:this.traverseSortNextHelper()}goUp(e){let t=this;for(;e>0&&null!==t;)t=t.parent,e-=1;return t}hasAnccestorOrSelf(e){return this===e||this.hasAnccestor(e)}hasAnccestor(e){let t=this.parent;for(;t;){if(e===t)return!0;t=t.parent}return!1}countToAccestor(e){let t=0,i=this;for(;i!==e;){if(null===i)return-1;i=i.parent,t+=1}return t}forEachEntity(e){for(let t of this.children)I_(t)&&e(t)}traverseEntityAncestors(e){this.traverseAncestors((t=>{d_.is(t)&&e(t)}))}traverseConcreteEntity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t))for(let i of this.children)I_(i)&&i.isConcreteEntity&&i.traverseEntity(e,t+1)}traverseEntity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t))for(let i of this.children)I_(i)&&i.traverseEntity(e,t+1)}traverseVisibleEntity(e){e(this);for(let t of this.children)I_(t)&&t.visible&&t.traverseVisibleEntity(e)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.dispatchEvent({type:"updateMatrixWorld"})}copy(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return super.copy(e,t),this.dataPatched=e.dataPatched,this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),this}hasEntityChild(){return this.children.some((e=>I_(e)))}isAncestorOf(e){if(this.uuid===e)return!1;let t=!1;return this.traverseEntity((i=>{i.uuid===e&&(t=!0)})),t}toObjectTransformState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.updateWorldMatrix(!0,!1);let t={position:this.position.toArray(),rotation:[this.rotation.x*ui.RAD2DEG,this.rotation.y*ui.RAD2DEG,this.rotation.z*ui.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return Ig(t,e)}getTransformValues(e,t,i){return t[e].map(((t,n)=>i?.shared.getVariable(t,[this.uuid,e,D_[n]])??t))}updateTransformState(e,t){let i=!1;return e.position&&(this.position.fromArray(this.getTransformValues("position",e,t)),i=!0),e.rotation&&(R_.fromArray(this.getTransformValues("rotation",e,t)).multiplyScalar(ui.DEG2RAD),this.rotation.setFromVector3(R_),i=!0),e.scale&&(this.scale.fromArray(this.getTransformValues("scale",e,t)),i=!0),void 0!==e.hiddenMatrix&&(i=!0,this.hiddenMatrix.fromArray(e.hiddenMatrix??aA.identity)),i&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((e=>{e.invalidateClonerTransform(this)}))),e.position&&e.rotation&&e.scale&&void 0!==e.hiddenMatrix&&this.updateWorldMatrix(!1,!0),i}onVariableUpdate(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.resetBBoxNeedsUpdate():(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((e=>{e.invalidateClonerTransform(this)})))}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let e of this.children)d_.is(e)&&e.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach((e=>{d_.is(e)&&e.disposeRecursively()}))}toState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(e)};return Ig(t,e)}updateByObjUpdateOp(e,t){void 0!==e&&this.updateByOp({type:0,props:e,path:[]},{...this.data,...e},t,!1)}updateByOp(e,t,i,n){let r=this.data;this.data=t;let s=e,a=iy(e.path,["states","*"]);if(null!==a){if(0===e.type){let[t]=a;if(this?.stateSelection===t){let t={...e.props};if(delete t.name,Object.values(e.props).some((e=>void 0===e))){let i=this.data;if(void 0!==i){let n=Kv.zoom(i,e.path.slice(2));if(n)for(let i in e.props)void 0===e.props[i]&&i in n&&(t[i]=n[i])}}s={...e,props:t,path:e.path.slice(2)}}}}else if(0===e.type){let t=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==t){if(void 0!==e.props.name&&t.name){let{name:e,...i}=t;t=i}if(void 0!==e.props.material&&"material"in t){let{material:e,...i}=t;t=i}let i=Kv.removeOverridden(e.path,e.props,t);s={...e,props:i}}}if(this.updateByPatchedOpBase(s,_x.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i),iy(e.path,["overrides"])){let n=[],r=[...e.path];for(n.push(r[1]),r.splice(0,2);r.length>0&&"descendants"===r[0];)n.push(r[1]),r.splice(0,2);if(void 0===n[n.length-1]){if(0===e.type)for(let t of Object.keys(e.props)){n[n.length-1]=t;let r=i.scene.findInstance([this.uuid,...n]);r&&(r.overrideData=e.props[t],r.updateState(_v.apply(r.component.data,r.overrideData),i))}}else{let s=i.scene.findInstance([this.uuid,...n]);if(s){let a=Kv.zoom(s.component.data,r);if(0===(e={...e,path:r}).type){let t=e.props;if(a)for(let[i,n]of Object.entries(e.props))void 0===n&&(t===e.props&&(t={...e.props}),t[i]=a[i]);e={...e,props:t}}s.overrideData=Ax.resolve(t.overrides,n),s.updateByOp(e,Mv.applySimple(s.data,e),i,!1)}}}else if(this.instances.length>0){let n;if(0===e.path.length&&0===e.type){let t;for(let i of xx.rootOverrideProps)i in e.props&&(void 0===t&&(t={}),t[i]=e.props[i]);t&&(n={...e,props:t})}else for(let t of xx.rootOverrideProps)if(iy(e.path,[t])){n=e;break}void 0!==n&&this.instances.forEach((e=>{if(e.isInstanceRoot){let t=_v.filterOp(e.overrideData,n);t&&e.updateByOp(t,Mv.applySimple(e.data,t),i,!0)}})),this.instances.forEach((n=>{if(!n.isInstanceRoot){let s=_v.filterOp(n.overrideData,e);if(s){let a;a=r===n.data&&e===s?t:Mv.applySimple(n.data,s),n.updateByOp(s,a,i,!0)}}}))}}updateByPatchedOpBase(e,t,i){if(this.dataPatched=t,0===e.path.length&&0===e.type)void 0!==e.props.type&&!vA.is(e.props.type)&&S_.changeEntityProptotype(this,t,i);else if(1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&"type"in e.props){S_.changeEntityProptotype(this,t,i);for(let e of this.children)d_.is(e)&&e.updateVisible(i.scene)}this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){if(0===e.path.length&&0===e.type?this.updateState(e.props,i):0===e.type&&("resolutionLevel"in e.props||"useChildrenColors"in e.props)&&this.updateState(t,i),"morphTargetInfluences"===e.path[0]&&0===e.type){let n=t.morphTargetInfluences.get(e.path[1])?.data.name;n&&this.updateMorphInfluences(n,i.shared.getVariable(e.props.value,[this.uuid,"morphTargetInfluences",n]))}if(null!==iy(e.path,["pathSnapping"])&&this.updatePathSnapping(t.pathSnapping),null!==iy(e.path,["cloner"])){let n=Mv.drop(e,1);0===n.path.length&&0===n.type&&!0===n.props.disabled?this.setFromClonerState(null,i):this.cloner?this.cloner.updateState(t.cloner,i.scene):(this.setFromClonerState(t.cloner,i),this.expandCloner(i.scene)),this.updateVisible(i.scene)}}updatePathSnapping(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.dataPatched.pathSnapping;this._updatedPathSnapping=e,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(e){let t=this._updatedPathSnapping?.pathId??this.dataPatched.pathSnapping.pathId,i=this._updatedPathSnapping?.slide??this.dataPatched.pathSnapping.slide??0,n=this._updatedPathSnapping?.offset??this.dataPatched.pathSnapping.offset??0,r=this._updatedPathSnapping?.orientation??this.dataPatched.pathSnapping.orientation;if(null===t)return;let s=e.find(t);if(!s||!1===this._needApplyPathSnapping)return;this._needApplyPathSnapping=!1;let a=s.data;if(a.geometry.path.points.length<=1)return;let o=T_(a.geometry.path),l=(i+n)%1;i+n===1&&0===l&&(l=1);let c=null;try{c=o.curves.length?o.getPointAt(l):null}catch(p){}if(null===c)return;let h=this.parent?this.parent?.matrixWorld:new bn;s.updateMatrixWorld();let d=(new bn).multiplyMatrices(h.clone().invert(),s.matrixWorld);c.applyMatrix4(d);let u={position:c.toArray(),rotation:a.rotation};if("tangential"===r){let e=(new bn).extractRotation(s.matrixWorld),t=o.getTangentAt(l).applyMatrix4(e).add(c),i=(new bn).lookAt(c,t,B_),n=R_.setFromEuler((new In).setFromRotationMatrix(i)).multiplyScalar(ui.RAD2DEG);u={...u,rotation:n.toArray()}}this.updateTransformState(u),this.traverseEntity((e=>{e._cameraType&&e.dispatchEvent(P_)}))}updateVisible(e){if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||!0!==this.dataPatched.cloner?.hideBase),!e)return;let t=!1;this.traverseEntity((e=>{if("Splat"===e.data.type)return t=!0,!0})),t&&e.reloadSplats()}updateState_Entity(e,t){void 0!==e.name&&(this.name=e.name),void 0!==e.raycastLock&&(this.raycastLock=e.raycastLock),void 0!==e.visible&&(this.updateVisible(t?.scene),this.resetBBoxNeedsUpdate()),t&&"cloner"in e&&void 0!==e.cloner&&(this.setFromClonerState(e.cloner,t),this.updateVisible(t.scene)),this.updateTransformState(e,t)}get attachedSurfaceCloners(){return this.children.filter((e=>e instanceof S_.Cloner&&"toObject"===e.parameters.type))}setFromClonerState(e,t){this.disposed||(null===e||e.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):void 0===this.cloner?(this.cloner=new S_.Cloner(this,e),t.scene.addPendingExpandCloner(this)):this.cloner.updateState(e,t.scene))}expandCloner(e){!this.disposed&&this.cloner&&this.cloner.expandClones(e)}invalidateClonerTransform(e){this.cloner&&this.cloner.invalidateTransform(e)}requestRender(){this.dispatchEvent({type:"requestRender"})}},O_=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.parameters?.radiusTop,n=e.parameters?.radiusBottom,r=Object.assign({},t?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);r.thetaLength=ui.clamp(r.thetaLength,0,360);let s=r.width/2,a=r.radiusTop??s,o=r.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),r.shapeBlendNode){a=i??s,o=n??s;let e=2*Math.max(a,o);r.width=e,r.depth=e}return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width),radiusTop:a,radiusBottom:o})}}static build(e){let t,{width:i,depth:n,height:r,radialSegments:s,heightSegments:a,openEnded:o,thetaStart:l,thetaLength:c,radiusTop:h,radiusBottom:d,cornerRadius:u,cornerSegments:p,hollow:f}=e.parameters;return 0===c?(t=new yr,t.setAttribute("position",new hr([],3))):t=u||f?new F_(h,d,r,s,a,o,l,c*Math.PI/180,u,u,p,f):new Pl(h,d,r,s,a,o,l,c*Math.PI/180),t.scale(1,1,n/i),Object.assign(t,{userData:{...e,type:"CylinderGeometry"}})}};function N_(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function k_(e){return new pi(e.y,-e.x)}var F_=class extends yr{constructor(e,t,i,n,r,s,a,o,l,c,h,d){let u=arguments.length>12&&void 0!==arguments[12]&&arguments[12];super(),this.type="RoundedCylinderBufferGeometry",e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,n=Math.floor(n)||8,r=Math.floor(r)||1,s=void 0!==s&&s,a=void 0!==a?a:0,o=void 0!==o?o:2*Math.PI,s&&(l=0,c=0);let p=[],f=[],m=[],g=[],v=0,y=i/2,b=new Vi,A=new Vi;u&&0==e&&(e=l),u&&0==t&&(t=c);let x=new pi(e,y),w=new pi(t,-y),S=null,_=null,E=null,C=null,M=x.clone().sub(w),T=0,I=0,P=0;d>0&&(T=Math.min(e,t)*(1-d),I=e-T,P=t-T);let D=x.clone();D.x-=T;let R=Math.PI-M.angle(),B=M.angle(),L=Math.tan(B/2),O=Math.tan(R/2),N=L+O,k=d?N:O,F=d?N:L;if(l=Math.min(l,(e-I)/k,M.length()/N),c=Math.min(c,(t-P)/F,M.length()/N),l>0){let e=l/L;S=x.clone().sub(new pi(e,l)),d&&(E=S.clone(),E.x-=T-N*l),x.sub(M.clone().setLength(e))}if(c>0){let e=c/O;_=w.clone().sub(new pi(e,-c)),w.add(M.clone().setLength(e)),d&&(C=_.clone(),C.x-=T-N*c,D.sub(M.clone().setLength(e)))}M=x.clone().sub(w);let U=M.length()<.5,z=[];for(let H=0;H<=n;H++){let h=[],u=H/n,p=u*o+a,y=new pi(Math.sin(p),Math.cos(p));if(C&&_?(j(h,u,y,R,c,C,-1,!0),j(h,u,y,B,c,_,-1,!1)):_?(V(h,y,_.x,0,-1),j(h,u,y,B,c,_,-1,!1)):s||V(h,y,t,P,-1),N_(k_(M).normalize(),y,b),!U)for(let e=0;e<=r;e++){let t=e/r;N_(M.clone().multiplyScalar(t).add(w),y,A),f.push(A.x,A.y,A.z),m.push(b.x,b.y,b.z),g.push(u,.5+A.y/i),h.push(v++)}if(E&&S?(j(h,u,y,R,l,S,1,!1),j(h,u,y,B,l,E,1,!0)):S?(j(h,u,y,R,l,S,1,!1),V(h,y,S.x,0,1)):s||V(h,y,e,I,1),d&&!U){N_(k_(M).multiplyScalar(-1).normalize(),y,b);for(let e=0;e<=r;e++){let t=e/r;N_(M.clone().multiplyScalar(-t).add(D),y,A),f.push(A.x,A.y,A.z),m.push(b.x,b.y,b.z),g.push(u,.5+A.y/i),h.push(v++)}}d&&!s&&h.push(h[0]),z.push(h)}for(let H=0;H<z.length-1;H++)for(let e=0;e<z[0].length-1;e++){if(s&&d&&e==r)continue;let t=z[H][e],i=z[H+1][e],n=z[H+1][e+1],a=z[H][e+1],o=f[3*n+0],l=f[3*n+2];p.push(t,i,a),(0!=o||0!=l)&&p.push(i,n,a)}function j(e,t,n,r,s,a,o,l){for(let c=0;c<h+1;c++){let d=c/h,u=o<0?d:1-d;l&&(u-=1),u*=r;let p=new pi(Math.sin(u),Math.cos(u)*o);N_(p.clone().multiplyScalar(s).add(a),n,A),f.push(A.x,A.y,A.z),N_(p,n,b),m.push(b.x,b.y,b.z),g.push(t,.5+A.y/i),e.push(v++)}}function V(e,t,i,n,r){let s=new Vi,a=new pi,o=[i,n];r<0&&o.reverse();for(let l of o)a.set(l,y*r),N_(a,t,s),f.push(s.x,s.y,s.z),m.push(0,r,0),g.push(.5,.5),e.push(v++)}function G(i,n,r){let s=new pi(Math.sin(r),Math.cos(r)),a=new pi(-Math.cos(r),Math.sin(r)),o=new Vi,l=i<0?(e,t,i)=>p.push(e,t,i):(e,t,i)=>p.push(e,i,t);N_(new pi((e+t+I+P)/4,0),s,o),f.push(o.x,o.y,o.z),m.push(a.x,0,a.y),g.push(.5,.5);let c=v++;for(let e of n){let t=f.slice(3*e,3*e+3);f.push(...t),m.push(a.x,0,a.y);let i=g.slice(2*e,2*e+2);g.push(...i),v++}for(let e=c+1;e<v-1;e++)l(c,e,e+1);l(c,v-1,c+1)}o<2*Math.PI&&(G(-1,z[0],a),G(1,z[z.length-1],a+o)),this.setIndex(p),this.setAttribute("position",new hr(f,3)),this.setAttribute("normal",new hr(m,3)),this.setAttribute("uv",new hr(g,2))}},U_=Math.PI/2,z_=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:4;super(),this.type="BoxGeometry",n=Math.floor(n),r=Math.floor(r),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,i/2);let l=[],c=[],h=[],d=[],u=0;function p(e,t,i,n,r,s,o,p,f,m){let g=(s-2*a)/f,v=(o-2*a)/m,y=s/2-a,b=o/2-a,A=p/2,x=f+1,w=m+1,S=0,_=new Vi;for(let a=0;a<w;a++){let s=a*v-b;for(let o=0;o<x;o++){let l=o*g-y;_[e]=l*n,_[t]=s*r,_[i]=A,c.push(_.x,_.y,_.z),_[e]=0,_[t]=0,_[i]=p>0?1:-1,h.push(_.x,_.y,_.z),d.push(o/f),d.push(1-a/m),S+=1}}for(let a=0;a<m;a++)for(let e=0;e<f;e++){let t=u+e+x*a,i=u+e+x*(a+1),n=u+(e+1)+x*(a+1),r=u+(e+1)+x*a;l.push(t,i,r),l.push(i,n,r)}u+=S}function f(e,t,i,n,r,s,p,f,m,g){let v=(p-2*a)/g,y=p/2-a,b=f/2-a,A=m/2,x=g+1,w=0,S=new Vi,_=new Vi;for(let l=0;l<o+1;l++){let u=l/o*U_,p=Math.sin(u)*a,f=(1-Math.cos(u))*a,m=Math.sin(u),E=Math.cos(u);S[t]=(b+p)*r,S[i]=(A-f)*s,_[e]=0,_[t]=m*Math.sign(S[t]),_[i]=E*Math.sign(S[i]);for(let t=0;t<x;t++){let i=t*v-y;S[e]=i*n,c.push(S.x,S.y,S.z),h.push(_.x,_.y,_.z),d.push(t/g),d.push(0),w+=1}}for(let a=0;a<o;a++)for(let e=0;e<g;e++){let t=u+e+x*a,i=u+e+x*(a+1),n=u+(e+1)+x*(a+1),r=u+(e+1)+x*a;l.push(t,i,r),l.push(i,n,r)}u+=w}function m(n,r,s){let p=new Vi,f=new Vi(e/2,t/2,i/2);f.subScalar(a);let m=[],g=n*r*s>0?(e,t,i)=>l.push(e,t,i):(e,t,i)=>l.push(e,i,t);for(let e=0;e<=o;e++){let t=[],i=U_*(1-e/o),l=Math.cos(i),g=Math.sin(i),v=0;for(let o=0;o<=e;o++){let i=Math.cos(v),o=Math.sin(v);p.x=l*i,p.y=g,p.z=l*o;let m=f.clone().addScaledVector(p,a);c.push(n*m.x,r*m.y,s*m.z),h.push(n*p.x,r*p.y,s*p.z),d.push(0,0),t.push(u++),v+=U_/e}m.push(t)}let v=m.length-1;for(let e=0;e<v;e++){let t=m[e],i=m[e+1],n=t.length-1;g(t[0],i[1],i[0]);for(let e=1;e<=n;e++)g(t[e-1],t[e],i[e]),g(t[e],i[e+1],i[e])}}p("z","y","x",-1,-1,i,t,e,s,r),p("z","y","x",1,-1,i,t,-e,s,r),p("x","z","y",1,1,e,i,t,n,s),p("x","z","y",1,-1,e,i,-t,n,s),p("x","y","z",1,-1,e,t,i,n,r),p("x","y","z",-1,-1,e,t,-i,n,r),a>0&&(f("z","y","x",-1,-1,1,i,t,e,s),f("z","y","x",1,-1,-1,i,t,e,s),f("z","y","x",-1,1,-1,i,t,e,s),f("z","y","x",1,1,1,i,t,e,s),f("x","y","z",-1,-1,-1,e,t,i,n),f("x","y","z",1,-1,1,e,t,i,n),f("x","y","z",-1,1,1,e,t,i,n),f("x","y","z",1,1,-1,e,t,i,n),f("y","x","z",-1,-1,1,t,e,i,r),f("y","x","z",1,-1,-1,t,e,i,r),f("y","x","z",1,1,1,t,e,i,r),f("y","x","z",-1,1,-1,t,e,i,r),m(1,1,1),m(-1,1,1),m(1,-1,1),m(-1,-1,1),m(1,1,-1),m(-1,1,-1),m(1,-1,-1),m(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new hr(c,3)),this.setAttribute("normal",new hr(h,3)),this.setAttribute("uv",new hr(d,2))}},j_=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4;super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];return function(){r=Math.min(.99999,r),0==r&&(s=0);let o={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],c=new Vi,h=c.clone(),d=new tr,u=r*n,p=n-u,f=s+1,m=new Vi,g=(e,t)=>m.subVectors(e,t).normalize(),v=(e,t)=>Array(e).fill(void 0).map(t),y=v(e.length/3,((t,i)=>(new Vi).fromArray(e,3*i).setLength(n))),b=[],A=1e6;for(let e=0;e<y.length;e++){let i,n,r,s=y[e],a=[],o=1e10,l=-1;for(;-1!=(l=t.indexOf(e,l+1));){let e=l-l%3;i=t[e+(l+1)%3],n=t[e+(l+2)%3],r=s.distanceToSquared(y[i]),o=Math.min(o,r),a.push([i,n,r])}o+=1e-6;let c=[],h=0,d=a.length;for(let t=0;t<d;t++){[i,n,r]=a[h];let t=1==b[i]?.includes(e);r<=o&&c.push(i+ +t*A),h=a.findIndex((e=>e[0]==n))}b.push(c)}let x=[];{let e,t,i=0,n=0,r=3==o;for(let a=0;a<=s;a++){e=a*(a+1)/2,t=(a+1)*(a+2)/2;for(let o=0;o<s-a;o++)[i,n]=[e+o+a+2,t+o+a+3],x.push(e,t,...r?[n,e]:[i,t],n,i),[e,t]=[i,n];x.push(e,t,e+s+2)}}let w=c.clone(),S=c.clone(),_=c.clone(),E=c.clone(),C=c.clone(),M=[],T=v(y.length,(()=>v(o,(()=>c.clone()))));for(let e=0;e<y.length;e++){c.copy(y[e]).normalize(),w.copy(c).multiplyScalar(p);let t=b[e];for(let s=0;s<t.length;s++){let i=t[s],n=t[(s+1)%o];d.setFromPointsAndIndices(y,e,i%A,n%A),d.b.sub(d.a).setLength(1e10).add(d.a),d.c.sub(d.a).setLength(1e10).add(d.a),d.closestPointToPoint(w,T[e][s])}let i=[],n=[],r=[],v=new Vi;0==s&&[...T[e]].reduce(((e,t)=>e.add(t)),v).multiplyScalar(1/o);for(let a=0;a<o;a++){let t=[],l=(a-1+o)%o,d=T[e][l],y=T[e][a];c.copy(d).sub(w),h.copy(y).sub(w);let b=w.angleTo(c),A=c.angleTo(h),x=Math.cos(b)*u;0==s?S.copy(v):S.copy(w).setLength(p+x),n.push(x);let M=[S,d,y];for(let e=0;e<2;e++){let n=M[e],r=M[e+1];E.subVectors(n,w),C.subVectors(r,w),_.crossVectors(E,C).normalize();for(let s=0;s<f;s++){let r=[b,A][e]*s/f;c.copy(E).applyAxisAngle(_,r).add(w),i.push(c.clone()),e&&(g(c,w),t.push([0==s?n:c.clone(),m.clone()]))}e&&(g(r,w),t.push([r,m.clone()]))}r.push(t)}M.push(r);let I=2*f,P=2;for(let e=0;e<o;e++){let t=I*e,r=I*((e+1)%o),s=[i[t]];for(let a=1;a<f;a++){E=i[t+a],C=i[r+a],s.push(E);for(let t=1,i=a-P+1;t<=i;t++)c.lerpVectors(E,C,t/(i+1)),c.sub(w).setLength(n[e]).add(w),s.push(c.clone());s.push(C)}for(let e=0;e<f;e++)s.push(i[e+f+t]);s.push(i[r+f]);let h=x.map((e=>s[e]));a.push(...h.map((e=>[e.x,e.y,e.z])).flat()),l.push(...h.map((e=>(g(e,w),[m.x,m.y,m.z]))).flat())}}let I=[];for(let e=0;e<b.length;e++)for(let t=0;t<o;t++){let i=b[e][t];if(i<A){let n=b[i].findIndex((t=>t%A==e)),r=M[e][t],s=M[i][n];for(let e=0;e<f;e++){let t=r[e],i=s[f-e],n=r[e+1];[t,i,n,n,i,s[f-(e+1)]].forEach((e=>{a.push(e[0].x,e[0].y,e[0].z),l.push(e[1].x,e[1].y,e[1].z)}))}I.push(r[0][0],s[f][0],r[f][0],s[0][0])}}for(;I.length;){let e,t,i,n;[e,t]=I.splice(0,2);let r=[e];for(;e!=t;)r.push(t),i=I.indexOf(t),n=i%2,t=I.splice(i-n,2)[1-n];m.subVectors(r[0],r[1]).cross(c.subVectors(r[0],r[2])).normalize();let s=m.dot(r[0])<0;s&&m.negate();for(let o=1;o<=r.length-2;o++)[r[o+ +s],r[o+1-+s],r[0]].forEach((e=>{a.push(e.x,e.y,e.z),l.push(m.x,m.y,m.z)}))}}(),function(){let e=new Vi;for(let p=0;p<a.length;p+=3){e.x=a[p+0],e.y=a[p+1],e.z=a[p+2];let t=d(e)/2/Math.PI+.5,i=u(e)/Math.PI+.5;o.push(t,1-i)}let t=new Vi,i=new Vi,n=new Vi,r=new Vi,s=new pi,l=new pi,c=new pi,h=(e,t,i,n)=>{n<0&&1===e.x&&(o[t]=e.x-1),0===i.x&&0===i.z&&(o[t]=n/2/Math.PI+.5)};for(let p=0,f=0;p<a.length;p+=9,f+=6){t.set(a[p+0],a[p+1],a[p+2]),i.set(a[p+3],a[p+4],a[p+5]),n.set(a[p+6],a[p+7],a[p+8]),s.set(o[f+0],o[f+1]),l.set(o[f+2],o[f+3]),c.set(o[f+4],o[f+5]),r.copy(t).add(i).add(n).divideScalar(3);let e=d(r);h(s,f+0,t,e),h(l,f+2,i,e),h(c,f+4,n,e)}for(let a=0;a<o.length;a+=6){let e=o[a+0],t=o[a+2],i=o[a+4],n=Math.max(e,t,i),r=Math.min(e,t,i);n>.9&&r<.1&&(e<.2&&(o[a+0]+=1),t<.2&&(o[a+2]+=1),i<.2&&(o[a+4]+=1))}function d(e){return Math.atan2(e.z,-e.x)}function u(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}}(),this.setAttribute("position",new hr(a,3)),this.setAttribute("normal",new hr(l,3)),void this.setAttribute("uv",new hr(o,2))}static fromJSON(e){return new j_(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},V_=class extends j_{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=(1+Math.sqrt(5))/2,r=1/n,s="DodecahedronGeometry";super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],s,e,t,i),this.type=s}static fromJSON(e){return new V_(e.radius,e.corner,e.cornerSides)}},G_=1e-12,H_=class{constructor(e){this.position=new pi,this.startPosition=new pi,this.uuid=ui.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new H_(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},W_=class extends H_{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new W_(this.parent).copy(this)}},Q_=class extends H_{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new W_(this),new W_(this))}static create(e,t){let i=new Q_(e,new pi(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return 0===t?this.controls[1]:1===t?this.controls[0]:null}applyOffsetToControls(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let i=0,n=this.controls.length;i<n;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new Q_(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){let e=this.curveBefore?.getTangentAt(1),t=this.curveAfter?.getTangentAt(0);return[e,t]}computeNormals(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pi,[i,n]=this.computeTangents();return i&&n&&(q_(i,e),q_(n,t)),[e,t]}computeTangent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pi,[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pi,[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function q_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pi,i=e.length();return t.set(-e.y/i,e.x/i)}var X_=new pi,Y_=new pi,K_=new pi,J_=new pi,Z_=new pi,$_=new pi,eE=new Vi,tE=new Vi;function iE(e){let t=new pi;t.addVectors(e.v0,X_.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new pi;return i.addVectors(e.v2,Y_.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Al(e.v0,t,i,e.v2)}function nE(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(e-t)<i}function rE(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return e.distanceTo(t)<i}function sE(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return e.distanceTo(t)<i}function aE(e,t,i){let n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),r=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((r*r+n*n-s*s)/(2*r*n))}function oE(e,t,i){return pE(e,t)&&pE(t,i)&&lE(e.position,t.position,i.position)}function lE(e,t,i){return 0===X_.copy(t).sub(e).cross(Y_.copy(i).sub(e))}function cE(e,t,i,n,r){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return n.set(o+l,a+c),r.set(o-l,a-c),[n,r]}function hE(e,t,i){return e.distanceTo(i)<t.distanceTo(i)?t:e}function dE(e,t,i,n,r,s){let a,o=t.x-e.x,l=t.y-e.y,c=i.x-e.x,h=i.y-e.y,d=Math.sqrt((o+c)*(o+c)+(l+h)*(l+h));return aE(t,e,i)>Math.PI&&(d*=-1),a=nE(h,l)?(l+h)*(n/d-.5)*8/3/(o-c):(o+c)*(n/d-.5)*8/3/(h-l),r.set(t.x-a*l,t.y+a*o),s.set(i.x+a*h,i.y-a*c),[r,s]}function uE(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function pE(e,t){return lE(e.position,e.controls[1].position,t.position)&&lE(e.position,t.controls[0].position,t.position)}function fE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[];for(let r=0,s=e.length;r<s;r++){let s=e[r],a=0;if(i&&void 0!==s.roundedCurveCorner){let e=.5*mE(s.roundedCurveCorner,t);r>0&&(n[r-1]+=e),a+=e}void 0!==s.curveAfter&&(a+=mE(s.curveAfter,t)),n.push(a)}return e.length>0&&i&&void 0!==e[0].roundedCurveCorner&&(n[e.length-1]+=.5*mE(e[0].roundedCurveCorner,t)),n}function mE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return e&&e instanceof dl?2*t:e&&(e instanceof wl||e instanceof Sl)?1:e&&e instanceof El?t*e.points.length:t}var gE,vE,yE,bE=new pi,AE=new pi,xE=new pi,wE=new pi,SE=new pi,_E=new pi,EE=class extends Ll{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;super(),this.points=[],this.shapeHoles=[],this.plane=new Yr(new Vi(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=ui.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let n=new EE;return n.isClosed=e.isClosed,n.points=e.points.map((e=>Q_.create(e.id,e.data))),"number"==typeof e.roundness&&(n.roundness=e.roundness),n.shapeHoles=e.shapeHoles.map((e=>EE.createFromState(e))),void 0!==t&&void 0!==i&&n.applySize(t,i),n.update(),n}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map((e=>this.getPointIndexById(e))).filter((e=>e>=0))}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex((t=>t.uuid===e));if(i<0){let i=t;for(let t=0,n=this.shapeHoles.length;t<n;t++){let n=this.shapeHoles[t],r=n.points.length,s=n.getPointIndexById(e);if(!(s<0))return s+i;i+=r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,n=this.shapeHoles.length;i<n;i++){let n=this.shapeHoles[i],r=e-t;if(r<=n.points.length-1)return n.points[r];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,n=this.shapeHoles.length;i<n;i++){let n=this.shapeHoles[i],r=n.points.indexOf(e);if(r>=0)return t+r;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map((e=>e.points)));return[...this.points,...e]}applySize(e,t){0===e&&(e=.001),0===t&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=bE.set(e,t);for(let n=0,r=this.points.length;n<r;n++){let e=this.points[n];e.position.multiply(i),e.controls[0].position.multiply(i),e.controls[1].position.multiply(i)}for(let n=0,r=this.shapeHoles.length;n<r;n++)this.shapeHoles[n].applyScale(e,t);this._update()}createPoint(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ui.generateUUID();t=e instanceof pi?e:new pi(e,i);let r=new Q_(n,t);return r.roundness=this.roundness,r}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];if(i.uuid===e)return i}for(let t=0,i=this.shapeHoles.length;t<i;t++){let i=this.shapeHoles[t].getPointByUuid(e);if(i)return i}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find((t=>t.uuid===e));t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t);let n=i?this.roundedCurveDivisions:this.curveDivisions;return function(e,t){let i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=tE.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){let r=t[l],c=X_,h=mE(r,n);o.push(h);for(let t=0;t<=h;t++)if(r instanceof Al||r instanceof _l||r instanceof wl){if(r.getPoint(t/h,c),s.set(c.x,c.y,0),void 0!==i&&sE(i,s))continue;void 0===i&&(i=eE),i.copy(s),e.setXYZ(a,s.x,s.y,s.z),a++}}r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++)}(e,i?this.roundedCurves:this.curves,t,this.autoClose),n.reduce(((e,t)=>e+t),0)+1}computeCurveDivisions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;return this.curveDivisions=fE(this.points,e,!1),this.roundedCurveDivisions=fE(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12;return 2*function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=tE.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){if(!1===i[l])continue;let r,c=t[l],h=X_,d=mE(c,n);o.push(d);for(let t=0;t<=d;t++)if(c instanceof Al||c instanceof _l||c instanceof wl){if(c.getPoint(t/d,h),s.set(h.x,h.y,0),r?.equals(s))continue;void 0===r?r=eE:(e.setXYZ(a,r.x,r.y,r.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),r.copy(s)}}return r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}(e,this.curves,t,i,this.autoClose).reduce(((e,t)=>e+t),0)}extractShapePointsToFlatArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t),function(e,t){let i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=0;for(let a=0;a<t.length;a++){let r=t[a],o=mE(r,n),l=X_;for(let t=0;t<=o;t++)if(r instanceof Al||r instanceof _l||r instanceof wl){if(r.getPoint(t/o,l),void 0!==i&&rE(i,l,G_))continue;void 0===i&&(i=Y_),i.copy(l),e.push(l.x,l.y),s++}}return nE(e[0],e[e.length-2],G_)&&nE(e[1],e[e.length-1],G_)&&(e.pop(),e.pop()),r&&s>1&&!(nE(e[s-1],e[1],G_)&&nE(e[s-2],e[0],G_))&&(e.push(e[0],e[1]),s++),e}(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);let n=t?this.roundedCurveDivisions:this.curveDivisions,r=0;t&&void 0!==this.points[0].roundedCurveCorner&&(r=.5*mE(this.points[0].roundedCurveCorner,this.subdivision));let s=e-r;s<0&&(s+=n.reduce(((e,t)=>e+t),0));for(let a=0,o=n.length;a<o;a++){let e=n[a];if(s<i+e)return[a,(s-i+1)/e];i+=e}return[0,1]}getCurveT(e,t,i){let n=this.points[e],r=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,a=s[e];if(uE(n,r)){let e=n.position.distanceTo(r.position);return n.position.distanceTo(bE.set(i.x,i.y))/e}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/a}dispose(){}_applyCurveForPoint(e,t){uE(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let n=i.clone();e.roundedCurveBefore=n,t.roundedCurveAfter=n,e.roundedCurveCorner=void 0,this.roundedCurves.push(n)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let e=this.points[t];if(0===t)this.moveTo(e.position.x,e.position.y);else{let i=this.points[t-1];this._applyCurveForPoint(e,i)}}let e=this.getLastPoint();if(e?.curveAfter&&(e.curveAfter=void 0),this.isClosed){let e=this.points[0],t=this.points[this.points.length-1];this._applyCurveForPoint(e,t)}if(this.points.length>2){let e=0;for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t],n=this.points[t-1]??this.points[this.points.length-1],r=this.points[t+1]??this.points[0],s=i.roundness,a=n&&r&&oE(n,i,r);if(!i.controlsMoved()&&s>0&&!a){let n=i.curveBefore,r=i.curveAfter;if(void 0===n||void 0===r)continue;let a,o=i.roundedCurveBefore,l=i.roundedCurveAfter,c=n.getLength(),h=r.getLength(),d=Math.min(s,.499*c),u=Math.min(s,.499*h),p=Math.min(d,u),f=1-p/c,m=p/h,g=n.getPointAt(f,bE),v=r.getPointAt(m,AE);if(this._subSplitCurve(n,o,f,g,void 0),this._subSplitCurve(r,l,m,void 0,v),this.useCubicForRoundedCorners){let e=aE(g,i.position,v)/2,t=Math.tan(e)*g.distanceTo(i.position),[n,r]=cE(g,v,t,xE,wE),s=hE(n,r,i.position),[o,l]=dE(s,g,v,t,SE,_E);a=new Al(g.clone(),o.clone(),l.clone(),v.clone())}else a=new _l(g.clone(),i.position.clone(),v.clone());i.roundedCurveCorner=a,this.roundedCurves.splice(t+e,0,a),e++}}}}_subSplitCurve(e,t,i,n,r){if(!(e instanceof wl)){let s=e,a=t,o=s.getUtoTmapping(i,0),l=function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=X_.subVectors(t,e).multiplyScalar(r).add(e),a=Y_.subVectors(i,t).multiplyScalar(r).add(t),o=K_.subVectors(n,i).multiplyScalar(r).add(i),l=s,c=J_.subVectors(a,s).multiplyScalar(r).add(s),h=Z_.subVectors(o,a).multiplyScalar(r).add(a),d=o,u=$_.subVectors(h,c).multiplyScalar(r).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,u.x,u.y,h.x,h.y,d.x,d.y,n.x,n.y]}(s.v0,s.v1,s.v2,s.v3,o);return void 0!==n&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),void 0!==r&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return void 0!==n&&t.v2.copy(n),void 0!==r&&t.v1.copy(r),t}clone(){let e=new EE(this._width,this._height);return e.points=this.points.map((e=>e.clone())),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map((e=>e.clone())),e}toJSON(){return{points:this.points.reduce(((e,t)=>e.concat(t.toJSON())),[]),shapeHoles:this.shapeHoles.map((e=>e.toJSON())),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let i=0;i<t;i++){let t=7*i,n=e.points[t+0],r=e.points[t+1],s=e.points[t+2],a=e.points[t+3],o=e.points[t+4],l=e.points[t+5],c=e.points[t+6],h=new Q_(ui.generateUUID(),new pi(n,r));h.controls[0].position.set(s,a),h.controls[1].position.set(o,l),h.roundness=c,this.points.push(h)}return this.shapeHoles=e.shapeHoles?.length?e.shapeHoles.map((e=>{let t=new EE;return t.fromJSON(e),t})):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isText=t;let i=(e,t)=>{t instanceof Al&&t.v3.equals(e.position)&&e.controls[0].position.copy(t.v2)};return this.points=(e=>{let t,n,r=[];for(t=0,n=e.length;t<n;t++)e[t]instanceof _l&&(e[t]=iE(e[t]));for(t=0,n=e.length;t<n;t++){let n,s=e[t],a=t>0?e[t-1]:null;s instanceof Al?(n=this.createPoint(s.v0),n.controls[1].position.copy(s.v1)):s instanceof wl&&(n=this.createPoint(s.v1)),void 0!==n&&(null!==a&&i(n,a),r.push(n))}let s=e[e.length-1],a=!1;return s instanceof Al?s.v3.equals(r[0].position)&&(r[0].controls[0].position.copy(s.v2),a=!0):s instanceof wl&&s.v2.equals(r[0].position)&&(a=!0),this.isClosed=a,r})(e.curves),e instanceof Ll&&(this.shapeHoles=e.holes.map((e=>{let t=new EE;return t.fromShape(e),t}))),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.roundness&&(i.roundness=t.roundness),void 0!==t.areControlsDirectionsMirrored&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){let i=this.getPointByUuid(e)?.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){let i=this.getPointByUuid(e)?.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},CE=2*Math.PI;function ME(e,t,i,n,r){let{x:s,y:a}=e;return{x:s*t+n,y:a*i+r}}function TE(e,t){let i=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:1.3333333333333333*Math.tan(t/4),n=Math.cos(e),r=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:n-r*i,y:r+n*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function IE(e,t,i,n){let r=e*n-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*n));return r*Math.acos(s)}function PE(e){let{px:t,py:i,cx:n,cy:r,rx:s,ry:a,largeArcFlag:o,sweepFlag:l}=e,c=[];if(0===s||0===a)return[];let h=(t-n)/2,d=(i-r)/2;if(0===h&&0===d)return[];s=Math.abs(s),a=Math.abs(a);let u=Math.pow(h,2)/Math.pow(s,2)+Math.pow(d,2)/Math.pow(a,2);u>1&&(s*=Math.sqrt(u),a*=Math.sqrt(u));let p=function(e,t,i,n,r,s,a,o,l,c){let h=Math.pow(r,2),d=Math.pow(s,2),u=Math.pow(a,2),p=Math.pow(o,2),f=h*d-h*p-d*u;f<0&&(f=0),f/=h*p+d*u,f=Math.sqrt(f)*(l===c?-1:1);let m=f*r/s*o,g=f*-s/r*a,v=m+(e+i)/2,y=g+(t+n)/2,b=(a-m)/r,A=(o-g)/s,x=(-a-m)/r,w=(-o-g)/s,S=IE(1,0,b,A),_=IE(b,A,x,w);return!c&&_>0&&(_-=CE),c&&_<0&&(_+=CE),{centerx:v,centery:y,ang1:S,ang2:_}}(t,i,n,r,s,a,h,d,o,l),{ang1:f,ang2:m}=p,{centerx:g,centery:v}=p,y=Math.abs(m)/(CE/4);Math.abs(1-y)<1e-7&&(y=1);let b=Math.max(Math.ceil(y),1);m/=b;for(let A=0;A<b;A++)c.push(TE(f,m)),f+=m;return c.map((e=>{let{x:t,y:i}=ME(e[0],s,a,g,v),{x:n,y:r}=ME(e[1],s,a,g,v),{x:o,y:l}=ME(e[2],s,a,g,v);return{x1:t,y1:i,x2:n,y2:r,x:o,y:l}}))}function DE(e,t){if(!e)throw t||"Assertion Failed!"}(vE=gE||(gE={}))[vE.ODD=0]="ODD",vE[vE.NONZERO=1]="NONZERO",vE[vE.POSITIVE=2]="POSITIVE",vE[vE.NEGATIVE=3]="NEGATIVE",vE[vE.ABS_GEQ_TWO=4]="ABS_GEQ_TWO",function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"}(yE||(yE={}));var RE=function(){function e(){}return e.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},e.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},e.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},e.edgeEval=function(t,i,n){DE(e.vertLeq(t,i)&&e.vertLeq(i,n));var r=i.s-t.s,s=n.s-i.s;return r+s>0?r<s?i.t-t.t+(t.t-n.t)*(r/(r+s)):i.t-n.t+(n.t-t.t)*(s/(r+s)):0},e.edgeSign=function(t,i,n){DE(e.vertLeq(t,i)&&e.vertLeq(i,n));var r=i.s-t.s,s=n.s-i.s;return r+s>0?(i.t-n.t)*r+(i.t-t.t)*s:0},e.transEval=function(t,i,n){DE(e.transLeq(t,i)&&e.transLeq(i,n));var r=i.t-t.t,s=n.t-i.t;return r+s>0?r<s?i.s-t.s+(t.s-n.s)*(r/(r+s)):i.s-n.s+(n.s-t.s)*(s/(r+s)):0},e.transSign=function(t,i,n){DE(e.transLeq(t,i)&&e.transLeq(i,n));var r=i.t-t.t,s=n.t-i.t;return r+s>0?(i.s-n.s)*r+(i.s-t.s)*s:0},e.vertCCW=function(e,t,i){return e.s*(t.t-i.t)+t.s*(i.t-e.t)+i.s*(e.t-t.t)>=0},e.interpolate=function(e,t,i,n){return(e=e<0?0:e)<=(i=i<0?0:i)?0===i?(t+n)/2:t+e/(e+i)*(n-t):n+i/(e+i)*(t-n)},e.intersect=function(t,i,n,r,s){var a,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(n,r)||(l=n,n=r,r=l),e.vertLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.vertLeq(n,i)?e.vertLeq(i,r)?((a=e.edgeEval(t,n,i))+(o=e.edgeEval(n,i,r))<0&&(a=-a,o=-o),s.s=e.interpolate(a,n.s,o,i.s)):((a=e.edgeSign(t,n,i))+(o=-e.edgeSign(t,r,i))<0&&(a=-a,o=-o),s.s=e.interpolate(a,n.s,o,r.s)):s.s=(n.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(n,r)||(l=n,n=r,r=l),e.transLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.transLeq(n,i)?e.transLeq(i,r)?((a=e.transEval(t,n,i))+(o=e.transEval(n,i,r))<0&&(a=-a,o=-o),s.t=e.interpolate(a,n.t,o,i.t)):((a=e.transSign(t,n,i))+(o=-e.transSign(t,r,i))<0&&(a=-a,o=-o),s.t=e.interpolate(a,n.t,o,r.t)):s.t=(n.t+i.t)/2},e}(),BE=function(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},LE=function(){function e(e){this.side=e,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(e){this.Sym.Lface=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(e){this.Sym.Org=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(e){this.Sym.Lnext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(e){this.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(e){this.Lnext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(e){this.Sym.Onext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(e){this.Sym.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(e){this.Sym.Lnext.Sym=e},enumerable:!0,configurable:!0}),e}(),OE=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},NE=function(){function e(){var e=new OE,t=new BE,i=new LE(0),n=new LE(1);e.next=e.prev=e,e.anEdge=null,t.next=t.prev=t,i.next=i,i.Sym=n,n.next=n,n.Sym=i,this.vHead=e,this.fHead=t,this.eHead=i,this.eHeadSym=n}return e.prototype.makeEdge_=function(e){var t=new LE(0),i=new LE(1);e.Sym.side<e.side&&(e=e.Sym);var n=e.Sym.next;return i.next=n,n.Sym.next=t,t.next=e,e.Sym.next=i,t.Sym=i,t.Onext=t,t.Lnext=i,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,i.Sym=t,i.Onext=i,i.Lnext=t,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,t},e.prototype.splice_=function(e,t){var i=e.Onext,n=t.Onext;i.Sym.Lnext=t,n.Sym.Lnext=e,e.Onext=n,t.Onext=i},e.prototype.makeVertex_=function(e,t,i){var n=e;DE(n,"Vertex can't be null!");var r=i.prev;n.prev=r,r.next=n,n.next=i,i.prev=n,n.anEdge=t;var s=t;do{s.Org=n,s=s.Onext}while(s!==t)},e.prototype.makeFace_=function(e,t,i){var n=e;DE(n,"Face can't be null");var r=i.prev;n.prev=r,r.next=n,n.next=i,i.prev=n,n.anEdge=t,n.trail=null,n.marked=!1,n.inside=i.inside;var s=t;do{s.Lface=n,s=s.Lnext}while(s!==t)},e.prototype.killEdge_=function(e){e.Sym.side<e.side&&(e=e.Sym);var t=e.next,i=e.Sym.next;t.Sym.next=i,i.Sym.next=t},e.prototype.killVertex_=function(e,t){var i=e.anEdge,n=i;do{n.Org=t,n=n.Onext}while(n!==i);var r=e.prev,s=e.next;s.prev=r,r.next=s},e.prototype.killFace_=function(e,t){var i=e.anEdge,n=i;do{n.Lface=t,n=n.Lnext}while(n!==i);var r=e.prev,s=e.next;s.prev=r,r.next=s},e.prototype.makeEdge=function(){var e=new OE,t=new OE,i=new BE,n=this.makeEdge_(this.eHead);return this.makeVertex_(e,n,this.vHead),this.makeVertex_(t,n.Sym,this.vHead),this.makeFace_(i,n,this.fHead),n},e.prototype.splice=function(e,t){var i=!1,n=!1;if(e!==t){if(t.Org!==e.Org&&(n=!0,this.killVertex_(t.Org,e.Org)),t.Lface!==e.Lface&&(i=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(t,e),!n){var r=new OE;this.makeVertex_(r,t,e.Org),e.Org.anEdge=e}if(!i){var s=new BE;this.makeFace_(s,t,e.Lface),e.Lface.anEdge=e}}},e.prototype.delete=function(e){var t=e.Sym,i=!1;if(e.Lface!==e.Rface&&(i=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!i){var n=new BE;this.makeFace_(n,e,e.Lface)}t.Onext===t?(this.killVertex_(t.Org,null),this.killFace_(t.Lface,null)):(e.Lface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),this.killEdge_(e)},e.prototype.addEdgeVertex=function(e){var t=this.makeEdge_(e),i=t.Sym;this.splice_(t,e.Lnext),t.Org=e.Dst;var n=new OE;return this.makeVertex_(n,i,t.Org),t.Lface=i.Lface=e.Lface,t},e.prototype.splitEdge=function(e){var t=this.addEdgeVertex(e).Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,t),e.Dst=t.Org,t.Dst.anEdge=t.Sym,t.Rface=e.Rface,t.winding=e.winding,t.Sym.winding=e.Sym.winding,t.idx=e.idx,t.Sym.idx=e.Sym.idx,t},e.prototype.connect=function(e,t){var i=!1,n=this.makeEdge_(e),r=n.Sym;if(t.Lface!==e.Lface&&(i=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(n,e.Lnext),this.splice_(r,t),n.Org=e.Dst,r.Org=t.Org,n.Lface=r.Lface=e.Lface,e.Lface.anEdge=r,!i){var s=new BE;this.makeFace_(s,n,e.Lface)}return n},e.prototype.zapFace=function(e){var t,i,n,r,s,a=e.anEdge;i=a.Lnext;do{i=(t=i).Lnext,t.Lface=null,null===t.Rface&&(t.Onext===t?this.killVertex_(t.Org,null):(t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),(n=t.Sym).Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),this.killEdge_(t))}while(t!=a);r=e.prev,(s=e.next).prev=r,r.next=s},e.prototype.countFaceVerts_=function(e){var t=e.anEdge,i=0;do{i++,t=t.Lnext}while(t!==e.anEdge);return i},e.prototype.mergeConvexFaces=function(e){var t,i,n,r,s;for(t=this.fHead.next;t!==this.fHead;t=t.next)if(t.inside)for(s=(i=t.anEdge).Org;n=i.Lnext,(r=i.Sym)&&r.Lface&&r.Lface.inside&&(this.countFaceVerts_(t)+this.countFaceVerts_(r.Lface)-2<=e&&RE.vertCCW(i.Lprev.Org,i.Org,r.Lnext.Lnext.Org)&&RE.vertCCW(r.Lprev.Org,r.Org,i.Lnext.Lnext.Org)&&(n=r.Lnext,this.delete(r),i=null,r=null)),!i||i.Lnext.Org!==s;)i=n;return!0},e.prototype.check=function(){var e,t,i,n,r,s,a=this.fHead,o=this.vHead,l=this.eHead;for(t=a,t=a;(e=t.next)!==a;t=e){DE(e.prev===t),r=e.anEdge;do{DE(r.Sym!==r),DE(r.Sym.Sym===r),DE(r.Lnext.Onext.Sym===r),DE(r.Onext.Sym.Lnext===r),DE(r.Lface===e),r=r.Lnext}while(r!==e.anEdge)}for(DE(e.prev===t&&null===e.anEdge),n=o,n=o;(i=n.next)!==o;n=i){DE(i.prev===n),r=i.anEdge;do{DE(r.Sym!==r),DE(r.Sym.Sym===r),DE(r.Lnext.Onext.Sym===r),DE(r.Onext.Sym.Lnext===r),DE(r.Org===i),r=r.Onext}while(r!==i.anEdge)}for(DE(i.prev===n&&null===i.anEdge),s=l,s=l;(r=s.next)!==l;s=r)DE(r.Sym.next===s.Sym),DE(r.Sym!==r),DE(r.Sym.Sym===r),DE(null!==r.Org),DE(null!==r.Dst),DE(r.Lnext.Onext.Sym===r),DE(r.Onext.Sym.Lnext===r);DE(r.Sym.next===s.Sym&&r.Sym===this.eHeadSym&&r.Sym.Sym===r&&null===r.Org&&null===r.Dst&&null===r.Lface&&null===r.Rface)},e}(),kE=function(){this.handle=null},FE=function(){this.key=null,this.node=0},UE=function(){function e(e,t){this.leq=t,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=e,this.nodes=[],this.handles=[];for(var i=0;i<e+1;i++)this.nodes[i]=new kE,this.handles[i]=new FE;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(e){var t,i,n,r=this.nodes,s=this.handles;for(t=r[e].handle;;){if((n=e<<1)<this.size&&this.leq(s[r[n+1].handle].key,s[r[n].handle].key)&&++n,DE(n<=this.max),i=r[n].handle,n>this.size||this.leq(s[t].key,s[i].key)){r[e].handle=t,s[t].node=e;break}r[e].handle=i,s[i].node=e,e=n}},e.prototype.floatUp_=function(e){var t,i,n,r=this.nodes,s=this.handles;for(t=r[e].handle;;){if(i=r[n=e>>1].handle,0===n||this.leq(s[i].key,s[t].key)){r[e].handle=t,s[t].node=e;break}r[e].handle=i,s[i].node=e,e=n}},e.prototype.init=function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(e){var t,i;if(2*(t=++this.size)>this.max){var n,r;for(this.max*=2,r=this.nodes.length,this.nodes.length=this.max+1,n=r;n<this.nodes.length;n++)this.nodes[n]=new kE;for(r=this.handles.length,this.handles.length=this.max+1,n=r;n<this.handles.length;n++)this.handles[n]=new FE}return 0===this.freeList?i=t:(i=this.freeList,this.freeList=this.handles[i].node),this.nodes[t].handle=i,this.handles[i].node=t,this.handles[i].key=e,this.initialized&&this.floatUp_(t),i},e.prototype.extractMin=function(){var e=this.nodes,t=this.handles,i=e[1].handle,n=t[i].key;return this.size>0&&(e[1].handle=e[this.size].handle,t[e[1].handle].node=1,t[i].key=null,t[i].node=this.freeList,this.freeList=i,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(e){var t,i=this.nodes,n=this.handles;DE(e>=1&&e<=this.max&&null!==n[e].key),i[t=n[e].node].handle=i[this.size].handle,n[i[t].handle].node=t,--this.size,t<=this.size&&(t<=1||this.leq(n[i[t>>1].handle].key,n[i[t].handle].key)?this.floatDown_(t):this.floatUp_(t)),n[e].key=null,n[e].node=this.freeList,this.freeList=e},e}(),zE=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},jE=function(){this.key=null,this.next=null,this.prev=null},VE=function(){function e(e,t){this.frame=e,this.leq=t,this.head=new jE,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(e){return this.insertBefore(this.head,e)},e.prototype.search=function(e){var t=this.head;do{t=t.next}while(null!==t.key&&!this.leq(this.frame,e,t.key));return t},e.prototype.insertBefore=function(e,t){do{e=e.prev}while(null!==e.key&&!this.leq(this.frame,e.key,t));var i=new jE;return i.key=t,i.next=e.next,e.next.prev=i,i.prev=e,e.next=i,i},e.prototype.delete=function(e){e.next.prev=e.prev,e.prev.next=e.next},e}(),GE=function(){function e(){}return e.regionBelow=function(e){return e.nodeUp.prev.key},e.regionAbove=function(e){return e.nodeUp.next.key},e.debugEvent=function(e){},e.addWinding=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.edgeLeq=function(e,t,i){var n=e.event,r=t.eUp,s=i.eUp;return r.Dst===n?s.Dst===n?RE.vertLeq(r.Org,s.Org)?RE.edgeSign(s.Dst,r.Org,s.Org)<=0:RE.edgeSign(r.Dst,s.Org,r.Org)>=0:RE.edgeSign(s.Dst,n,s.Org)<=0:s.Dst===n?RE.edgeSign(r.Dst,n,r.Org)>=0:RE.edgeEval(r.Dst,n,r.Org)>=RE.edgeEval(s.Dst,n,s.Org)},e.deleteRegion=function(e,t){t.fixUpperEdge&&DE(0===t.eUp.winding),t.eUp.activeRegion=null,e.dict.delete(t.nodeUp)},e.fixUpperEdge=function(e,t,i){DE(t.fixUpperEdge),e.mesh.delete(t.eUp),t.fixUpperEdge=!1,t.eUp=i,i.activeRegion=t},e.topLeftRegion=function(t,i){var n,r=i.eUp.Org;do{i=e.regionAbove(i)}while(i.eUp.Org===r);if(i.fixUpperEdge){if(null===(n=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext)))return null;e.fixUpperEdge(t,i,n),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do{t=e.regionAbove(t)}while(t.eUp.Dst===i);return t},e.addRegionBelow=function(e,t,i){var n=new zE;return n.eUp=i,n.nodeUp=e.dict.insertBefore(t.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,i.activeRegion=n,n},e.isWindingInside=function(e,t){switch(e.windingRule){case gE.ODD:return 0!==(1&t);case gE.NONZERO:return 0!==t;case gE.POSITIVE:return t>0;case gE.NEGATIVE:return t<0;case gE.ABS_GEQ_TWO:return t>=2||t<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var n=i.eUp,r=n.Lface;r.inside=i.inside,r.anEdge=n,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,n){for(var r,s=null,a=i,o=i.eUp;a!==n;){if(a.fixUpperEdge=!1,(r=(s=e.regionBelow(a)).eUp).Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}r=t.mesh.connect(o.Lprev,r.Sym),e.fixUpperEdge(t,s,r)}o.Onext!==r&&(t.mesh.splice(r.Oprev,r),t.mesh.splice(o,r)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,i,n,r,s,a){var o,l,c,h,d=!0;c=n;do{DE(RE.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext}while(c!==r);for(null===s&&(s=e.regionBelow(i).eUp.Rprev),l=i,h=s;(c=(o=e.regionBelow(l)).eUp.Sym).Org===h.Org;)c.Onext!==h&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(h.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!d&&e.checkForRightSplice(t,l)&&(e.addWinding(c,h),e.deleteRegion(t,l),t.mesh.delete(h)),d=!1,l=o,h=c;l.dirty=!0,DE(l.windingNumber-c.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(e,t,i){e.mesh.splice(t,i)},e.vertexWeights=function(e,t,i){var n=RE.vertL1dist(t,e),r=RE.vertL1dist(i,e),s=.5*r/(n+r),a=.5*n/(n+r);e.coords[0]+=s*t.coords[0]+a*i.coords[0],e.coords[1]+=s*t.coords[1]+a*i.coords[1],e.coords[2]+=s*t.coords[2]+a*i.coords[2]},e.getIntersectData=function(t,i,n,r,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,n,r),e.vertexWeights(i,s,a)},e.checkForRightSplice=function(t,i){var n=e.regionBelow(i),r=i.eUp,s=n.eUp;if(RE.vertLeq(r.Org,s.Org)){if(RE.edgeSign(s.Dst,r.Org,s.Org)>0)return!1;RE.vertEq(r.Org,s.Org)?r.Org!==s.Org&&(t.pq.delete(r.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,r)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(r,s.Oprev),i.dirty=n.dirty=!0)}else{if(RE.edgeSign(r.Dst,s.Org,r.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(r.Sym),t.mesh.splice(s.Oprev,r)}return!0},e.checkForLeftSplice=function(t,i){var n,r=e.regionBelow(i),s=i.eUp,a=r.eUp;if(DE(!RE.vertEq(s.Dst,a.Dst)),RE.vertLeq(s.Dst,a.Dst)){if(RE.edgeSign(s.Dst,a.Dst,s.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,n=t.mesh.splitEdge(s),t.mesh.splice(a.Sym,n),n.Lface.inside=i.inside}else{if(RE.edgeSign(a.Dst,s.Dst,a.Org)>0)return!1;i.dirty=r.dirty=!0,n=t.mesh.splitEdge(a),t.mesh.splice(s.Lnext,a.Sym),n.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var n,r,s=e.regionBelow(i),a=i.eUp,o=s.eUp,l=a.Org,c=o.Org,h=a.Dst,d=o.Dst,u=new OE;if(DE(!RE.vertEq(d,h)),DE(RE.edgeSign(h,t.event,l)<=0),DE(RE.edgeSign(d,t.event,c)>=0),DE(l!==t.event&&c!==t.event),DE(!i.fixUpperEdge&&!s.fixUpperEdge),l===c||Math.min(l.t,h.t)>Math.max(c.t,d.t))return!1;if(RE.vertLeq(l,c)){if(RE.edgeSign(d,l,c)>0)return!1}else if(RE.edgeSign(h,c,l)<0)return!1;return e.debugEvent(t),RE.intersect(h,l,d,c,u),DE(Math.min(l.t,h.t)<=u.t),DE(u.t<=Math.max(c.t,d.t)),DE(Math.min(d.s,h.s)<=u.s),DE(u.s<=Math.max(c.s,l.s)),RE.vertLeq(u,t.event)&&(u.s=t.event.s,u.t=t.event.t),n=RE.vertLeq(l,c)?l:c,RE.vertLeq(n,u)&&(u.s=n.s,u.t=n.t),RE.vertEq(u,l)||RE.vertEq(u,c)?(e.checkForRightSplice(t,i),!1):!RE.vertEq(h,t.event)&&RE.edgeSign(h,t.event,u)>=0||!RE.vertEq(d,t.event)&&RE.edgeSign(d,t.event,u)<=0?d===t.event?(t.mesh.splitEdge(a.Sym),t.mesh.splice(o.Sym,a),i=e.topLeftRegion(t,i),a=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),s),e.addRightEdges(t,i,a.Oprev,a,a,!0),!0):h===t.event?(t.mesh.splitEdge(o.Sym),t.mesh.splice(a.Lnext,o.Oprev),s=i,i=e.topRightRegion(i),r=e.regionBelow(i).eUp.Rprev,s.eUp=o.Oprev,o=e.finishLeftRegions(t,s,null),e.addRightEdges(t,i,o.Onext,a.Rprev,r,!0),!0):(RE.edgeSign(h,t.event,u)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(a.Sym),a.Org.s=t.event.s,a.Org.t=t.event.t),RE.edgeSign(d,t.event,u)<=0&&(i.dirty=s.dirty=!0,t.mesh.splitEdge(o.Sym),o.Org.s=t.event.s,o.Org.t=t.event.t),!1):(t.mesh.splitEdge(a.Sym),t.mesh.splitEdge(o.Sym),t.mesh.splice(o.Oprev,a),a.Org.s=u.s,a.Org.t=u.t,a.Org.pqHandle=t.pq.insert(a.Org),e.getIntersectData(t,a.Org,l,h,c,d),e.regionAbove(i).dirty=i.dirty=s.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var n,r,s=e.regionBelow(i);;){for(;s.dirty;)i=s,s=e.regionBelow(s);if(!i.dirty&&(s=i,null===(i=e.regionAbove(i))||!i.dirty))return;if(i.dirty=!1,n=i.eUp,r=s.eUp,n.Dst!==r.Dst&&e.checkForLeftSplice(t,i)&&(s.fixUpperEdge?(e.deleteRegion(t,s),t.mesh.delete(r),r=(s=e.regionBelow(i)).eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(n),n=(i=e.regionAbove(s)).eUp)),n.Org!==r.Org)if(n.Dst===r.Dst||i.fixUpperEdge||s.fixUpperEdge||n.Dst!==t.event&&r.Dst!==t.event)e.checkForRightSplice(t,i);else if(e.checkForIntersect(t,i))return;n.Org===r.Org&&n.Dst===r.Dst&&(e.addWinding(r,n),e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(s))}},e.connectRightVertex=function(t,i,n){var r,s=n.Onext,a=e.regionBelow(i),o=i.eUp,l=a.eUp,c=!1;o.Dst!==l.Dst&&e.checkForIntersect(t,i),RE.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),a),c=!0),RE.vertEq(l.Org,t.event)&&(t.mesh.splice(n,l.Oprev),n=e.finishLeftRegions(t,a,null),c=!0),c?e.addRightEdges(t,i,n.Onext,s,s,!0):(r=RE.vertLeq(l.Org,o.Org)?l.Oprev:o,r=t.mesh.connect(n.Lprev,r),e.addRightEdges(t,i,r,r.Onext,r.Onext,!1),r.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i))},e.connectLeftDegenerate=function(t,i,n){var r,s,a,o,l;return r=i.eUp,RE.vertEq(r.Org,n)?(DE(!1),void e.spliceMergeVertices(t,r,n.anEdge)):RE.vertEq(r.Dst,n)?(DE(!1),i=e.topRightRegion(i),s=o=(a=(l=e.regionBelow(i)).eUp.Sym).Onext,l.fixUpperEdge&&(DE(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(n.anEdge,a),RE.edgeGoesLeft(s)||(s=null),void e.addRightEdges(t,i,a.Onext,o,s,!0)):(t.mesh.splitEdge(r.Sym),i.fixUpperEdge&&(t.mesh.delete(r.Onext),i.fixUpperEdge=!1),t.mesh.splice(n.anEdge,r),void e.sweepEvent(t,n))},e.connectLeftVertex=function(t,i){var n,r,s,a,o,l,c=new zE;if(c.eUp=i.anEdge.Sym,n=t.dict.search(c).key,r=e.regionBelow(n)){if(a=n.eUp,o=r.eUp,0===RE.edgeSign(a.Dst,i,a.Org))return void e.connectLeftDegenerate(t,n,i);if(s=RE.vertLeq(o.Dst,a.Dst)?n:r,n.inside||s.fixUpperEdge){if(s===n)l=t.mesh.connect(i.anEdge.Sym,a.Lnext);else l=t.mesh.connect(o.Dnext,i.anEdge).Sym;s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,n,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,n,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var n=i.anEdge;null===n.activeRegion;)if((n=n.Onext)===i.anEdge)return void e.connectLeftVertex(t,i);var r=e.topLeftRegion(t,n.activeRegion);DE(null!==r);var s=e.regionBelow(r),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,r,o):e.addRightEdges(t,r,o.Onext,a,a,!0)},e.addSentinel=function(e,t,i,n){var r=new zE,s=e.mesh.makeEdge();s.Org.s=i,s.Org.t=n,s.Dst.s=t,s.Dst.t=n,e.event=s.Dst,r.eUp=s,r.windingNumber=0,r.inside=!1,r.fixUpperEdge=!1,r.sentinel=!0,r.dirty=!1,r.nodeUp=e.dict.insert(r)},e.initEdgeDict=function(t){t.dict=new VE(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],n=t.bmax[1]-t.bmin[1],r=t.bmin[0]-i,s=t.bmax[0]+i,a=t.bmin[1]-n,o=t.bmax[1]+n;e.addSentinel(t,r,s,a),e.addSentinel(t,r,s,o)},e.doneEdgeDict=function(t){for(var i,n=0;null!==(i=t.dict.min().key);)i.sentinel||(DE(i.fixUpperEdge),DE(1===++n)),DE(0===i.windingNumber),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,n,r,s=t.mesh.eHead;for(i=s.next;i!==s;i=n)n=i.next,r=i.Lnext,RE.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,r,i),t.mesh.delete(i),r=(i=r).Lnext),r.Lnext===i&&(r!==i&&((r===n||r===n.Sym)&&(n=n.next),t.mesh.delete(r)),(i===n||i===n.Sym)&&(n=n.next),t.mesh.delete(i))},e.initPriorityQ=function(e){var t,i,n,r=0;for(i=(n=e.mesh.vHead).next;i!==n;i=i.next)r++;for(r+=8,t=e.pq=new UE(r,RE.vertLeq),i=(n=e.mesh.vHead).next;i!==n;i=i.next)i.pqHandle=t.insert(i);return i===n&&(t.init(),!0)},e.donePriorityQ=function(e){e.pq=null},e.removeDegenerateFaces=function(t,i){var n,r,s;for(n=i.fHead.next;n!==i.fHead;n=r)r=n.next,DE((s=n.anEdge).Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){var n,r;if(void 0===i&&(i=!0),e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);null!==(n=t.pq.extractMin());){for(;null!==(r=t.pq.min())&&RE.vertEq(r,n);)r=t.pq.extractMin(),e.spliceMergeVertices(t,n.anEdge,r.anEdge);e.sweepEvent(t,n)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),!!e.removeDegenerateFaces(t,t.mesh)&&(i&&t.mesh.check(),!0)},e}(),HE=function(){function e(){this.mesh=new NE,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=gE.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.prototype.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(!t)throw"Zero-size vector!";t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},e.prototype.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},e.prototype.computeNormal_=function(e){var t,i,n,r,s,a,o=[0,0,0],l=[0,0,0],c=[0,0,0],h=[0,0,0],d=[0,0,0],u=[null,null,null],p=[null,null,null],f=this.mesh.vHead;t=f.next;for(var m=0;m<3;++m)r=t.coords[m],l[m]=r,p[m]=t,o[m]=r,u[m]=t;for(t=f.next;t!==f;t=t.next)for(var g=0;g<3;++g)(r=t.coords[g])<l[g]&&(l[g]=r,p[g]=t),r>o[g]&&(o[g]=r,u[g]=t);var v=0;if(o[1]-l[1]>o[0]-l[0]&&(v=1),o[2]-l[2]>o[v]-l[v]&&(v=2),l[v]>=o[v])return e[0]=0,e[1]=0,void(e[2]=1);for(a=0,i=p[v],n=u[v],c[0]=i.coords[0]-n.coords[0],c[1]=i.coords[1]-n.coords[1],c[2]=i.coords[2]-n.coords[2],t=f.next;t!==f;t=t.next)h[0]=t.coords[0]-n.coords[0],h[1]=t.coords[1]-n.coords[1],h[2]=t.coords[2]-n.coords[2],d[0]=c[1]*h[2]-c[2]*h[1],d[1]=c[2]*h[0]-c[0]*h[2],d[2]=c[0]*h[1]-c[1]*h[0],(s=d[0]*d[0]+d[1]*d[1]+d[2]*d[2])>a&&(a=s,e[0]=d[0],e[1]=d[1],e[2]=d[2]);a<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(c)]=1)},e.prototype.checkOrientation_=function(){for(var e,t,i=this.mesh.fHead,n=this.mesh.vHead,r=0,s=i.next;s!==i;s=s.next)if(!((t=s.anEdge).winding<=0))do{r+=(t.Org.s-t.Dst.s)*(t.Org.t+t.Dst.t),t=t.Lnext}while(t!==s.anEdge);if(r<0){for(e=n.next;e!==n;e=e.next)e.t=-e.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var e,t,i=this.mesh.vHead,n=[0,0,0],r=!1;n[0]=this.normal[0],n[1]=this.normal[1],n[2]=this.normal[2],!n[0]&&!n[1]&&!n[2]&&(this.computeNormal_(n),r=!0),e=this.sUnit,t=this.tUnit;var s=this.longAxis_(n);e[s]=0,e[(s+1)%3]=1,e[(s+2)%3]=0,t[s]=0,t[(s+1)%3]=0,t[(s+2)%3]=n[s]>0?1:-1;for(var a=i.next;a!==i;a=a.next)a.s=this.dot_(a.coords,e),a.t=this.dot_(a.coords,t);r&&this.checkOrientation_();for(var o=!0,l=i.next;l!==i;l=l.next)o?(this.bmin[0]=this.bmax[0]=l.s,this.bmin[1]=this.bmax[1]=l.t,o=!1):(l.s<this.bmin[0]&&(this.bmin[0]=l.s),l.s>this.bmax[0]&&(this.bmax[0]=l.s),l.t<this.bmin[1]&&(this.bmin[1]=l.t),l.t>this.bmax[1]&&(this.bmax[1]=l.t))},e.prototype.addWinding_=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.prototype.tessellateMonoRegion_=function(e,t){var i,n;if((i=t.anEdge).Lnext===i||i.Lnext.Lnext===i)throw"Mono region invalid";for(;RE.vertLeq(i.Dst,i.Org);i=i.Lprev);for(;RE.vertLeq(i.Org,i.Dst);i=i.Lnext);n=i.Lprev;for(;i.Lnext!==n;)if(RE.vertLeq(i.Dst,n.Org)){for(;n.Lnext!==i&&(RE.edgeGoesLeft(n.Lnext)||RE.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)n=e.connect(n.Lnext,n).Sym;n=n.Lprev}else{for(;n.Lnext!==i&&(RE.edgeGoesRight(i.Lprev)||RE.edgeSign(i.Dst,i.Org,i.Lprev.Org)>=0);)i=e.connect(i,i.Lprev).Sym;i=i.Lnext}if(n.Lnext===i)throw"Mono region invalid";for(;n.Lnext.Lnext!==i;)n=e.connect(n.Lnext,n).Sym;return!0},e.prototype.tessellateInterior_=function(e){for(var t,i=e.fHead.next;i!==e.fHead;i=t)if(t=i.next,i.inside&&!this.tessellateMonoRegion_(e,i))return!1;return!0},e.prototype.discardExterior_=function(e){for(var t,i=e.fHead.next;i!==e.fHead;i=t)t=i.next,i.inside||e.zapFace(i)},e.prototype.setWindingNumber_=function(e,t,i){for(var n,r=e.eHead.next;r!==e.eHead;r=n)n=r.next,r.Rface.inside!==r.Lface.inside?r.winding=r.Lface.inside?t:-t:i?e.delete(r):r.winding=0},e.prototype.getNeighbourFace_=function(e){return e.Rface&&e.Rface.inside?e.Rface.n:-1},e.prototype.outputPolymesh_=function(e,t,i,n){var r,s,a=0,o=0;i>3&&e.mergeConvexFaces(i);for(var l=e.vHead.next;l!==e.vHead;l=l.next)l.n=-1;for(var c=e.fHead.next;c!==e.fHead;c=c.next)if(c.n=-1,c.inside){r=c.anEdge,s=0;do{-1===(l=r.Org).n&&(l.n=o,o++),s++,r=r.Lnext}while(r!==c.anEdge);if(s>i)throw"Face vertex greater that support polygon";c.n=a,++a}this.elementCount=a,t===yE.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*i,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(l=e.vHead.next;l!==e.vHead;l=l.next)if(-1!==l.n){var h=l.n*n;this.vertices[h+0]=l.coords[0],this.vertices[h+1]=l.coords[1],n>2&&(this.vertices[h+2]=l.coords[2]),this.vertexIndices[l.n]=l.idx}var d=0;for(c=e.fHead.next;c!==e.fHead;c=c.next)if(c.inside){r=c.anEdge,s=0;do{l=r.Org;this.elements[d++]=l.n,s++,r=r.Lnext}while(r!==c.anEdge);for(var u=s;u<i;++u)this.elements[d++]=-1;if(t===yE.CONNECTED_POLYGONS){r=c.anEdge;do{this.elements[d++]=this.getNeighbourFace_(r),r=r.Lnext}while(r!==c.anEdge);for(var p=s;p<i;++p)this.elements[d++]=-1}}},e.prototype.outputContours_=function(e,t){var i,n,r=0,s=0;this.vertexCount=0,this.elementCount=0;for(var a=e.fHead.next;a!==e.fHead;a=a.next)if(a.inside){n=i=a.anEdge;do{this.vertexCount++,i=i.Lnext}while(i!==n);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*t,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var o=0,l=0,c=0;r=0;for(a=e.fHead.next;a!==e.fHead;a=a.next)if(a.inside){s=0,n=i=a.anEdge;do{this.vertices[o++]=i.Org.coords[0],this.vertices[o++]=i.Org.coords[1],t>2&&(this.vertices[o++]=i.Org.coords[2]),this.vertexIndices[l++]=this.vertexIdCallback?this.vertexIdCallback(i):i.Org.idx,s++,i=i.Lnext}while(i!==n);this.elements[c++]=r,this.elements[c++]=s,r+=s}},e.prototype.addContour=function(e,t){null===this.mesh&&(this.mesh=new NE),e<2&&(e=2),e>3&&(e=3);for(var i=null,n=0;n<t.length;n+=e)null===i?(i=this.mesh.makeEdge(),this.mesh.splice(i,i.Sym)):(this.mesh.splitEdge(i),i=i.Lnext),i.Org.coords[0]=t[n+0],i.Org.coords[1]=t[n+1],i.Org.coords[2]=e>2?t[n+2]:0,i.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(i),i.winding=1,i.Sym.winding=-1},e.prototype.tesselate=function(e,t,i,n,r,s){if(void 0===e&&(e=gE.ODD),void 0===t&&(t=yE.POLYGONS),void 0===s&&(s=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,r&&(this.normal[0]=r[0],this.normal[1]=r[1],this.normal[2]=r[2]),this.windingRule=e,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),GE.computeInterior(this,s);var a=this.mesh;return t===yE.BOUNDARY_CONTOURS?this.setWindingNumber_(a,1,!0):this.tessellateInterior_(a),s&&a.check(),t===yE.BOUNDARY_CONTOURS?this.outputContours_(a,n):this.outputPolymesh_(a,t,i,n),!0},e}();function WE(e){var t=e.windingRule,i=void 0===t?gE.ODD:t,n=e.elementType,r=void 0===n?yE.POLYGONS:n,s=e.polySize,a=void 0===s?3:s,o=e.vertexSize,l=void 0===o?2:o,c=e.normal,h=void 0===c?[0,0,1]:c,d=e.contours,u=void 0===d?[]:d,p=e.strict,f=void 0===p||p,m=e.debug,g=void 0!==m&&m;if(!u&&f)throw new Error("Contours can't be empty");if(u){var v=new HE;e.edgeCreateCallback&&(v.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(v.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<u.length;y++)v.addContour(l||2,u[y]);return v.tesselate(i,r,a,l,h,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}gE.ODD,gE.NONZERO,gE.POSITIVE,gE.NEGATIVE,gE.ABS_GEQ_TWO,yE.POLYGONS,yE.CONNECTED_POLYGONS,yE.BOUNDARY_CONTOURS;var QE=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*QE.eSize;this.buffer=new ArrayBuffer(i);let n=Float32Array.BYTES_PER_ELEMENT,r=0;this.positions=new Float32Array(this.buffer,r*n,3*e),r+=3*e,this.normals=new Float32Array(this.buffer,r*n,3*e),r+=3*e,this.uvs=new Float32Array(this.buffer,r*n,2*e)}realloc(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity} \u2192 ${e}`);let i=e*QE.eSize,n=new ArrayBuffer(i),r=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(n,s*r,3*e);s+=3*e;let o=new Float32Array(n,s*r,3*e);s+=3*e;let l=new Float32Array(n,s*r,2*e);t?(a.set(this.positions.subarray(0,3*this.size)),o.set(this.normals.subarray(0,3*this.size)),l.set(this.uvs.subarray(0,2*this.size))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=n,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.size+e;if(t>this.capacity){let e=this.capacity;for(;t>e;)e*=2;this.realloc(e)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} \u2192 ${this.size}`),this.realloc(this.size,!0)}},qE=QE;qE.eSize=8*Float32Array.BYTES_PER_ELEMENT;var XE=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e<t?-1:e>t?1:0;if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;let e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:i}=this,n=t[e];for(;e>0;){let r=e-1>>1,s=t[r];if(i(n,s)>=0)break;t[e]=s,e=r}t[e]=n}_down(e){let{data:t,compare:i}=this,n=this.length>>1,r=t[e];for(;e<n;){let n=1+(e<<1),s=n+1;if(s<this.length&&i(t[s],t[n])<0&&(n=s),i(t[n],r)>=0)break;t[e]=t[n],e=n}t[e]=r}};function YE(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=1/0,s=1/0,a=-1/0,o=-1/0;for(let[y,b]of e[0])y<r&&(r=y),b<s&&(s=b),y>a&&(a=y),b>o&&(o=b);let l=a-r,c=o-s,h=Math.max(i,Math.min(l,c));if(h===i){let e=[r,s];return e.distance=0,e.distance}let d=new XE([],((e,t)=>t.max-e.max)),u=function(e){let t=0,i=0,n=0,r=e[0];for(let a=0,o=r.length,l=o-1;a<o;l=a++){let e=r[a],s=r[l],o=e[0]*s[1]-s[0]*e[1];i+=(e[0]+s[0])*o,n+=(e[1]+s[1])*o,t+=3*o}let s=new KE(i/t,n/t,0,e);return 0===t||s.d<0?new KE(r[0][0],r[0][1],0,e):s}(e),p=new KE(r+l/2,s+c/2,0,e);p.d>u.d&&(u=p);let f=2;function m(r,s,a){let o=new KE(r,s,a,e);if(f++,o.max>u.d+i&&d.push(o),o.d>u.d&&(u=o,n&&console.log(`found best ${Math.round(1e4*o.d)/1e4} after ${f} probes`),u.d>t))return t}let g=h/2;for(let y=r;y<a;y+=h)for(let e=s;e<o;e+=h)m(y+g,e+g,g);for(;d.length;){let{max:e,x:t,y:n,h:r}=d.pop();if(e-u.d<=i)break;g=r/2,m(t-g,n-g,g),m(t+g,n-g,g),m(t-g,n+g,g),m(t+g,n+g,g)}n&&console.log(`num probes: ${f}\nbest distance: ${u.d}`);let v=[u.x,u.y];return v.distance=u.d,v.distance}function KE(e,t,i,n){this.x=e,this.y=t,this.h=i,this.d=function(e,t,i){let n=!1,r=1/0;for(let s of i)for(let i=0,a=s.length,o=a-1;i<a;o=i++){let a=s[i],l=s[o];a[1]>t!=l[1]>t&&e<(l[0]-a[0])*(t-a[1])/(l[1]-a[1])+a[0]&&(n=!n),r=Math.min(r,JE(e,t,a,l))}return 0===r?0:(n?1:-1)*Math.sqrt(r)}(e,t,n),this.max=this.d+this.h*Math.SQRT2}function JE(e,t,i,n){let r=i[0],s=i[1],a=n[0]-r,o=n[1]-s;if(0!==a||0!==o){let i=((e-r)*a+(t-s)*o)/(a*a+o*o);i>1?(r=n[0],s=n[1]):i>0&&(r+=a*i,s+=o*i)}return a=e-r,o=t-s,a*a+o*o}var ZE={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},$E={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},eC={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},tC=(e,t)=>i=>{let[n,r]=i;return r<n&&(r+=t),(e>=n?e:e+t)<=r},iC=class extends yr{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:gE.ODD,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=n,this._bevelSegmentsInput=r;let o,l,c,h=this._shape.extractShapePointsToFlatArray([],n),d=this._shape.shapeHoles.map((e=>{let t=e.extractShapePointsToFlatArray([],n),i=[];for(let n=t.length-1;n>=1;n-=2){let e=t[n-1],r=t[n-0];i.push(e,r)}return i})),u=[],p=[];for(let E=0;E<h.length;E+=2)p.push([h[E],h[E+1]]);u.push(p);for(let E=0;E<d.length;E++){let e=d[E],t=[];for(let i=0;i<e.length;i+=2)t.push([e[i],e[i+1]]);u.push(t)}o=e.isText?.1*(new Ih).setFromPoints(e.points.map((e=>e.position))).getSize(new pi).length():0===u[0].length?i:i>0?YE(u,i):1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,o,t/2),this._bevelSegments=Math.floor(r));try{l=WE({windingRule:s,elementType:yE.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[h]})}catch{l=ZE}try{c=WE({windingRule:gE.ODD,elementType:yE.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...d]})}catch{c=$E}if(!l)throw new Error("error generating geometry");let f=l.elementCount;if(c){l.elementCount+=c.elementCount;for(let e=0;e<c.elements.length;e++){let t=c.elements[e],i=e%2===0?l.vertexCount:0;l.elements.push(t+i)}for(let e=0;e<c.vertexIndices.length;e++){let t=c.vertexIndices[e],i=l.vertexCount;l.vertexIndices.push(t+i)}for(let e=0;e<c.vertices.length;e++){let t=c.vertices[e];l.vertices.push(t)}}let m=1/0,g=-1/0,v=1/0,y=-1/0;for(let E=0,C=l.vertexCount;E<C;E++){let e=2*E,t=l.vertices[e+0],i=l.vertices[e+1];t<m&&(m=t),t>g&&(g=t),i<v&&(v=i),i>y&&(y=i)}this._minX=m,this._minY=v,this._width=g-m,this._height=y-v,this._buffer=new qE(this._computeBufferEstimatedSize(l));let b=[],A=[];for(let E=l.elementCount-1;E>=0;E--){let e=E>=f,t=2*E,i=l.elements[t+0],r=l.elements[t+1],s=i+r,c={start:i,count:r,normals:[],continuous:[],concave:[]},h=i,u=s-1,p=i+1,m=this._shape.roundedCurves.length;do{let t=h-i,n=l.vertices[2*u+0],a=l.vertices[2*u+1],o=l.vertices[2*h+0],d=l.vertices[2*h+1],f=l.vertices[2*p+0],g=l.vertices[2*p+1],v=o-n,y=d-a,b=Math.sqrt(v*v+y*y);v/=b,y/=b;let A=o-f,x=d-g,w=Math.sqrt(A*A+x*x);A/=w,x/=w,c.normals[2*t+0]=-x,c.normals[2*t+1]=A,c.concave[t]=v*x-y*A>0;let S=l.vertexIndices[h];if(Array.isArray(S))c.continuous[t]=!1;else{let[e,i]=this._shape.getCurveIndexFromVertexId(S-1,!0);if(i>0&&i<1)c.continuous[t]=!0;else{let n=1===i?e+1:e-1;n=(n+m)%m;let r=1===i?0:1,s=this._shape.roundedCurves[e].getTangent(i),a=this._shape.roundedCurves[n].getTangent(r);c.continuous[t]=s.dot(a)>.95}}e&&(c.normals[2*t+0]*=-1,c.normals[2*t+1]*=-1),[u,h,p]=[h,p,p+1],p>=s&&(p-=r)}while(p!==i+1);let g=[];g.push({bevelI:0,angle:0,size:0,boundary:{vertices:l.vertices.slice(2*i,2*s),vertexCount:r,vertexIndices:new Array(r).fill(!0).map(((e,t)=>[t,t])),elements:[0,r],elementCount:1,mesh:null},reverseMap:[],insetPoints:l.vertices.slice(2*i,2*s)});let v=0;for(let a=1;a<=this._bevelSegments;a++){let t=a/this._bevelSegments*Math.PI/2,i=(1-Math.cos(t))*this._bevel,s=[],o=[],h=[],d=[],u=0;for(let a=0;a<r;a++){let t=2*a,p=(a-1+r)%r*2,f=l.vertices[2*c.start+t+0],m=l.vertices[2*c.start+t+1],g=-c.normals[p+0]*i,v=-c.normals[p+1]*i,y=-c.normals[t+0]*i,b=-c.normals[t+1]*i;if(c.concave[a]||!c.concave[a]&&e){let t=Math.atan2(v,g),r=Math.atan2(b,y);r>t&&(r-=2*Math.PI);let o=r-t;if(c.continuous[a]||e){let n=t+o/2,r=Math.cos(n)*i,l=Math.sin(n)*i;s[2*u+0]=f+r*(e?-1:1),s[2*u+1]=m+l*(e?-1:1),d[u]=a,u++}else{let e=Math.max(1,Math.floor(n/4*Math.abs(o)/Math.PI));for(let n=0;n<=e;n++){let r=t+o*(n/e),l=Math.cos(r)*i,c=Math.sin(r)*i;s[2*u+0]=f+l,s[2*u+1]=m+c,d[u]=a,u++}}}else s[2*u+0]=f+g,s[2*u+1]=m+v,d[u]=a,o[a]=u,u++,s[2*u+0]=f,s[2*u+1]=m,d[u]=a,u++,s[2*u+0]=f+y,s[2*u+1]=m+b,d[u]=a,h[a]=u,u++}let p=WE({windingRule:gE.POSITIVE,elementType:yE.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[s],edgeCreateCallback:e=>{let t=e.Org.idx,i=d[t],n=d[(t+1)%d.length];e.idx=[i,n],e.Sym.idx=[n,i]},vertexIdCallback:e=>{let t=e.Lprev.idx;return[t?t[1]:0,e.idx?e.idx[0]:0]}});if(!p)throw console.log("Error"),new Error(`error generating bevel geometry for ${a}'th loop`);if(!p.vertexCount){let e=(a-1)/this._bevelSegments*Math.PI/2;v=(1-Math.sin(e))*this._bevel;break}for(let e=0;e<p.vertexIndices.length;e++){let[t,i]=p.vertexIndices[e];if(t===i)continue;let n=i;i<t&&(n+=r);for(let s=t;s<n;s++){let n=s%r,a=(s+1)%r;if(!c.continuous[n]||!c.continuous[a]){p.vertexIndices[e]=[t,n],p.vertexIndices.splice(e+1,0,[a,i]),p.vertices.splice(2*(e+1),0,p.vertices[2*e],p.vertices[2*e+1]);break}}}g.push({bevelI:a,angle:t,size:i,boundary:p,reverseMap:d,insetPoints:s})}let y=(e,t,i)=>{let n=0,r=e.boundary.vertexIndices.length;for(;n<r&&i(e.boundary.vertexIndices[t]);)t=(t+1)%r,n++;return n},x=b.length;for(let n=1;n<g.length;n++){let e=g[n-1],t=g[n],i=e.boundary.vertexIndices.length,s=t.boundary.vertexIndices.length;if(!i||!s)break;let o=c.concave.length,l=0,h=tC(l,r);for(;!e.boundary.vertexIndices.filter(h).length||!t.boundary.vertexIndices.filter(h).length;)l++,h=tC(l,r);let d=e.boundary.vertexIndices.findIndex(h),u=t.boundary.vertexIndices.findIndex(h);do{d=(d+1)%i}while(h(e.boundary.vertexIndices[d]));do{u=(u+1)%s}while(h(t.boundary.vertexIndices[u]));l=(l+1)%r;let p,f,m=l,v=0,A=this._buildBevelVert(c,e,(d-1+i)%i,void 0,v),x=this._buildBevelVert(c,t,(u-1+s)%s,void 0,v),w=!1;do{v=(l||o)/o,h=tC(l,r);let n=y(e,d,h),m=y(t,u,h),g=w;if(w=!1,n&&!m){for(let t=0;t<n;t++)p=this._buildBevelVert(c,e,(d+t)%i,t/(n-1),v),b.push(A.topN,p.topP,x.topN),!1===a&&b.push(p.bottomP,A.bottomN,x.bottomN),A=p;w=!0}else if(!n&&m)for(let e=0;e<m;e++)f=this._buildBevelVert(c,t,(u+e)%s,e/(m-1),v),b.push(x.topN,A.topP,f.topP),!1===a&&b.push(A.bottomP,x.bottomN,f.bottomP),x=f;else if(n&&m)if(p=this._buildBevelVert(c,e,d,0,v),f=this._buildBevelVert(c,t,u,0,v),g?(b.push(A.topN,f.topP,x.topN),b.push(A.topN,p.topP,f.topP),!1===a&&(b.push(f.bottomP,A.bottomN,x.bottomN),b.push(f.bottomP,p.bottomP,A.bottomN))):(b.push(x.topN,A.topN,p.topP),b.push(x.topN,p.topP,f.topP),!1===a&&(b.push(p.bottomP,A.bottomN,x.bottomN),b.push(p.bottomP,x.bottomN,f.bottomP))),A=p,x=f,n===m)for(let r=1;r<n;r++)p=this._buildBevelVert(c,e,(d+r)%i,r/(n-1),v),f=this._buildBevelVert(c,t,(u+r)%s,r/(m-1),v),b.push(A.topN,p.topP,x.topN),b.push(x.topN,p.topP,f.topP),!1===a&&(b.push(p.bottomP,A.bottomN,x.bottomN),b.push(p.bottomP,x.bottomN,f.bottomP)),A=p,x=f;else if(n>m){let r=n/m,o=0;for(let l=1;l<n;l++)p=this._buildBevelVert(c,e,(d+l)%i,l/(n-1),v),b.push(A.topN,p.topP,x.topN),!1===a&&b.push(p.bottomP,A.bottomN,x.bottomN),A=p,l>(o+1)*r&&(o++,f=this._buildBevelVert(c,t,(u+o)%s,o/(m-1),v),b.push(x.topN,p.topP,f.topP),!1===a&&b.push(p.bottomP,x.bottomN,f.bottomP),x=f)}else{let r=m/n,o=0;for(let l=1;l<m;l++)f=this._buildBevelVert(c,t,(u+l)%s,l/(m-1),v),b.push(x.topN,p.topP,f.topP),!1===a&&b.push(p.bottomP,x.bottomN,f.bottomP),x=f,l>(o+1)*r&&(o++,p=this._buildBevelVert(c,e,(d+o)%i,o/(n-1),v),b.push(A.topN,p.topP,x.topN),!1===a&&b.push(p.bottomP,A.bottomN,x.bottomN),A=p)}d=(d+n)%i,u=(u+m)%s,l=(l+1)%o}while(l!==m)}if(!1===a&&this._depth>2*this._bevel&&this._buildWall(g,c,b),e){let e=[];for(let t=b.length-1;t>=x+2;t-=3){let i=b[t-2],n=b[t-1],r=b[t-0];e.push(r,n,i)}b.splice(x,b.length-x,...e)}if(e){let e=[];for(let t=g[g.length-1].boundary.vertices.length-1;t>=1;t-=2){let i=g[g.length-1].boundary.vertices[t-1],n=g[g.length-1].boundary.vertices[t-0];e.push(i,n)}A.push(e)}if(!e){let e,t=g[g.length-1];try{e=WE({windingRule:g.length>1?gE.POSITIVE:gE.ODD,elementType:yE.POLYGONS,vertexSize:2,strict:!0,contours:[t.insetPoints,...A]})}catch{e=eC}if(!e)throw new Error("Error generating geometry for surface");0===d.length&&this._bevel<o&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let i=0;i<3*e.elementCount;i+=3){let t=this._buildSurfaceVert(e,e.elements[i+0],v),n=this._buildSurfaceVert(e,e.elements[i+1],v),r=this._buildSurfaceVert(e,e.elements[i+2],v);b.push(t.top,n.top,r.top),!1===a&&b.push(r.bottom,n.bottom,t.bottom)}}this.vertexCache={}}this._buffer.shrink();let x=new or(Uint32Array.from(b),1),w=new or(this._buffer.positions,3),S=new or(this._buffer.normals,3),_=new or(this._buffer.uvs,2);w.needsUpdate=!0,S.needsUpdate=!0,_.needsUpdate=!0,x.needsUpdate=!0,this.setAttribute("position",w),this.setAttribute("normal",S),this.setAttribute("uv",_),this.setIndex(x)}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,i){let n=e[0];for(let r=0,s=n.boundary.vertexCount;r<s;r++){let e=this._buildBevelVert(t,n,r),a=this._buildBevelVert(t,n,(r+1)%s);i.push(a.topP,e.topN,e.bottomN),i.push(a.topP,e.bottomN,a.bottomP)}}_buildSurfaceVert(e,t,i){let n=t.toString();if(n in this.vertexCache)return this.vertexCache[n];let r=e.vertices[2*t+0],s=e.vertices[2*t+1],a=(r-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=3*l,h=2*l,d={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=r,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[h+0]=a,this._buffer.uvs[h+1]=o,!1===this.forPathBevel&&(this._buffer.positions[c+3]=r,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[h+2]=a,this._buffer.uvs[h+3]=o),this.vertexCache[n]=d,d}_buildBevelVert(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4?arguments[4]:void 0,s=`${t.bevelI}:${i}`;if(s in this.vertexCache&&0!==r&&1!==r&&(!r||r===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let a,o,l,c,[h,d]=t.boundary.vertexIndices[i];h!==d?(o=h,a=d,c=!1,l=e.continuous[o]&&e.continuous[a]):(a=h,o=(a-1+e.count)%e.count,c=e.concave[a]&&t.bevelI>0,l=e.continuous[a]||c);let u=Math.cos(t.angle),p=Math.sin(t.angle),f=2*i,m=2*a,g=2*o,v=t.boundary.vertices[f+0],y=t.boundary.vertices[f+1],b=(1-p)*this._bevel,A=(v-this._minX)/this._width,x=(y-this._minY)/this._height;this.forPathBevel&&(void 0!==r&&(A=r),x=1);let w=e.normals[m+0],S=e.normals[m+1],_=e.normals[g+0],E=e.normals[g+1];if(c){w+=(_-w)*(1-n),S+=(E-S)*(1-n);let e=Math.sqrt(w*w+S*S);w/=e,S/=e}let C=this.forPathBevel?this._buffer.get(l?1:2):this._buffer.get(l?2:4),M=3*C,T=2*C,I={i:i,fi:a,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1,pathBevelUCoord:r};return this._buffer.positions[M+0]=v,this._buffer.positions[M+1]=y,this._buffer.positions[M+2]=(this.forPathBevel?this._bevel:this._depth)-b,this._buffer.normals[M+0]=w*u,this._buffer.normals[M+1]=S*u,this._buffer.normals[M+2]=p,this._buffer.uvs[T+0]=A,this._buffer.uvs[T+1]=x,!1===this.forPathBevel&&(this._buffer.positions[M+3]=v,this._buffer.positions[M+4]=y,this._buffer.positions[M+5]=b,this._buffer.normals[M+3]=w*u,this._buffer.normals[M+4]=S*u,this._buffer.normals[M+5]=-p,this._buffer.uvs[T+2]=x,this._buffer.uvs[T+3]=A),l||(this.forPathBevel?(C+=1,M+=3,T+=2):(C+=2,M+=6,T+=4),I.topP=C+0,I.bottomP=C+1,this._buffer.positions[M+0]=v,this._buffer.positions[M+1]=y,this._buffer.positions[M+2]=(this.forPathBevel?this._bevel:this._depth)-b,this._buffer.normals[M+0]=_*u,this._buffer.normals[M+1]=E*u,this._buffer.normals[M+2]=p,this._buffer.uvs[T+0]=A,this._buffer.uvs[T+1]=x,!1===this.forPathBevel&&(this._buffer.positions[M+3]=v,this._buffer.positions[M+4]=y,this._buffer.positions[M+5]=b,this._buffer.normals[M+3]=_*u,this._buffer.normals[M+4]=E*u,this._buffer.normals[M+5]=-p,this._buffer.uvs[T+2]=x,this._buffer.uvs[T+3]=A)),this.vertexCache[s]=I,I}clone(){let e=new iC(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=Qm(this.userData),e}},nC=class extends yr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.type="ShapeGeometry",this.windingRule=gE.ODD,this.elementType=yE.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:gE.ODD,elementType:yE.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let n,r,s,a=this._shape.extractShapePointsToFlatArray([],this._curveSegments),o=this._shape.shapeHoles.map((e=>e.extractShapePointsToFlatArray([],this._curveSegments))),l=!0,c=!0;for(let u=0,p=a.length/2;u<p;u++){let e=2*u,t=a[e+0],i=a[e+1];if(void 0!==r&&t!==r&&(l=!1),void 0!==s&&i!==s&&(c=!1),r=t,s=i,!l&&!c)break}if(!l&&!c)try{n=WE({contours:[a,...o],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{n=ZE}let h=n?.vertexCount??1,d=n?.elementCount??1;if(this._positionAttribute=new or(new Float32Array(3*h),3),this._normalAttribute=new or(new Float32Array(3*h),3),this._uvAttribute=new or(new Float32Array(2*h),2),this._indexAttribute=new or(new Uint32Array(3*d),1),n){let e=1/0,t=-1/0,i=1/0,r=-1/0;for(let o=0,l=h;o<l;o++){let s=2*o,a=n.vertices[s+0],l=n.vertices[s+1];a<e&&(e=a),a>t&&(t=a),l<i&&(i=l),l>r&&(r=l)}let s=t-e,a=r-i;for(let o=0,l=h;o<l;o++){let t=2*o,r=n.vertices[t+0],l=n.vertices[t+1],c=(r-e)/s,h=(l-i)/a;this._positionAttribute.setXYZ(o,r,l,0),this._normalAttribute.setXYZ(o,0,0,1),this._uvAttribute.setXY(o,c,h)}for(let o=0,l=d;o<l;o++){let e=3*o,t=n.elements[e+0],i=n.elements[e+1],r=n.elements[e+2];this._indexAttribute.setX(e+0,t),this._indexAttribute.setX(e+1,i),this._indexAttribute.setX(e+2,r)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,3*(n?.elementCount??1))}clone(){let e=new nC(this._shape,this._curveSegments);return e.userData=Qm(this.userData),e}},rC=class extends iC{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,arguments.length>5&&void 0!==arguments[5]?arguments[5]:gE.ODD),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,i){let n=e[0];for(let r=0,s=n.boundary.vertexCount;r<s;r++){let e=this._buildBevelVert(t,n,r),a=this._buildBevelVert(t,n,(r+1)%s);i.push(a.topP,e.topN,e.bottomN),i.push(a.topP,e.bottomN,a.bottomP)}}clone(){let e=new rC(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=Qm(this.userData),e}},sC=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:gE.ODD},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=e.shape??t?.shape,o=a?.roundness??i.roundness;void 0!==a&&(a instanceof EE?(a.width!==n||a.height!==r)&&a.applySize(n,r):a=new EE(n,r).fromJSON(a),void 0!==e.parameters?.roundness&&e.parameters?.roundness>0&&a.update());let l=a??new EE(n,r);return{parameters:Object.assign(i,{width:n,height:r,depth:s,roundness:o}),shape:l}}static build(e){let t,{depth:i,extrudeBevelSize:n,extrudeBevelSegments:r,subdivisions:s,roundness:a,windingRule:o}=e.parameters;return e.shape.roundness=a,t=i<=0?new nC(e.shape,s,{windingRule:o}):new rC(e.shape,i,n,s,r,o),Object.assign(t,{userData:{...e,type:"VectorGeometry"}})}},aC=2*Math.PI,oC=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=ui.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof EE?e.shape:new EE,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let t,{width:i,height:n,spikes:r,angle:s,innerRadius:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,h=e.shape,d=function(e,t,i,n,r,s){if(n>=aC)return r>30||r%4===0?(function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=.5522847498,o=t*a,l=i*a;e.addPoint(hC(r-t,s,r-t,s-l,r-t,s+l)),e.addPoint(hC(r,s+i,r-o,s+i,r+o,s+i)),e.addPoint(hC(r+t,s,r+t,s+l,r+t,s-l)),e.addPoint(hC(r,s-i,r+o,s-i,r-o,s-i)),n>0&&uC(e,t,i,n)}(e,t,i,s),Math.round(r/4)):lC(e,n,r,t,i,s);n=Math.max(n,.001);let a={x:0,y:i},o=n+.5*Math.PI,l={x:Math.cos(o)*t,y:Math.sin(o)*i},c=PE({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:n>Math.PI,sweepFlag:!0});return r>30||r%c.length===0?function(e,t,i,n,r,s,a,o){let l=Math.round(r/n.length);e.addPoint(cC(t,i));for(let c=0,h=n.length;c<h;c++){let t=n[c],i=e.points[c],r=cC(t.x,t.y);i.controls[1].position.set(t.x1,t.y1),r.controls[0].position.set(t.x2,t.y2),e.addPoint(r)}return o>0?dC(e,s,a,o):e.addPoint(cC(0,0)),l}(e,a.x,a.y,c,r,t,i,s):lC(e,n,r,t,i,s)}(h,.5*i,.5*n,s*Math.PI/180,r,a);return h.isClosed=!0,h.update(),0===s?(t=new yr,t.setAttribute("position",new hr([],3))):t=sC.create({shape:h,parameters:{subdivisions:d,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}}),Object.assign(t,{userData:{...e,type:"EllipseGeometry"}})}};function lC(e,t,i,n,r,s){let a=-t/i;for(let o=0;o<=i;o++){let t=a*o,i=Math.sin(t)*n,s=Math.cos(t)*r;e.addPoint(cC(i,s))}return t<aC?s>0?dC(e,n,r,s):e.addPoint(cC(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&uC(e,n,r,s)),1}function cC(e,t){return new Q_(ui.generateUUID(),new pi(e,t))}function hC(e,t,i,n,r,s){let a=cC(e,t);return a.controls[0].position.set(i,n),a.controls[1].position.set(r,s),a}function dC(e,t,i,n){pC(e,t,i,n).forEach((t=>e.addPoint(t)))}function uC(e,t,i,n){let r=pC(e,t,i,n),s=new EE;r.forEach((e=>s.addPoint(e))),s.isClosed=!0,e.shapeHoles.push(s)}function pC(e,t,i,n){let r=n*t/100,s=r*(Math.abs(i)/Math.abs(t)),a=new pi(r/t,s/i),o=e.points.map((e=>{let t=e.clone();return t.uuid=ui.generateUUID(),t})).reverse();return o.forEach((e=>{e.position.multiply(a);let t=e.controls[0].position.clone().multiply(a),i=e.controls[1].position.clone().multiply(a);e.controls[0].position.copy(i),e.controls[1].position.copy(t)})),o}var fC=new cr([0,0,0],1),mC=class extends yr{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,o=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1;if(super(),0===n)return;let c=e&&1===n;c&&(l=0),o>100&&(o=100),0===o&&(l=0);let h,d,u,p,f,m,g,v,y=()=>new Vi,b=new Vi,A=y(),x=y(),w=y(),S=y(),_=y(),E=y(),C=y(),M=y(),T=y(),I=y(),P=y(),D=t-2*s+.001,R=D/n,B=Math.ceil(r*n),L=B+1,O=D/B,N=-D/2,k=a+1,F=2*Math.PI/a,U=Math.PI/2/l,z=Math.min((1-o/100)*s,s-.01),j=s-z,V=0,G=2*l+2,H=k*G/2,W=H+k*L,Q=Math.max(0,k*(L+G)),[q,X,Y]=[3,3,2].map((e=>Array(Q*e).fill(0))),K=[],J=i-s;function Z(t,i){let n=Math.PI/2;m=i*O,v=2*Math.PI*(m%R)/R+n,m+=N,g=Math.sin(v)*J,f=Math.cos(v)*J,e?t.set(f,g,m):t.set(f,m,g)}Z(b,-1e-10),Z(A,0),S.copy(b),Z(b,1);let $=b.distanceTo(A),ee=c?0:j+z,te=$*B+2*ee,ie=z,ne=te-ee;for(let oe=0;oe<=B;oe++){Z(x,oe),P.subVectors(x,S).normalize(),S.copy(x),T.copy(x).setComponent(+e+1,0).normalize(),I.crossVectors(P,T).normalize();let t=0===oe,i=oe===B,n=t?3*Math.PI/2:U,r=t?ie:ne,o=t?k:W,h=t?0:Q-k,d=P.clone().multiplyScalar(t?-j:j).add(x),u=P.clone().multiplyScalar(t?-1:1).normalize();for(let e=0;e<k;e++){let p=e*F;if(_.addVectors(b.copy(T).multiplyScalar(s*Math.cos(p)),A.copy(I).multiplyScalar(s*Math.sin(p))),E.copy(_).normalize(),t||i){c||(V=h+e,[0,1,2].forEach((e=>{q[3*V+e]=d.getComponent(e),X[3*V+e]=u.getComponent(e)})),Y[2*V]=+i,Y[2*V+1]=e/a),A.copy(E).multiplyScalar(z),w.addVectors(x,A);for(let i=0;i<l;i++){let s=i*U+n;C.addVectors(b.copy(P).multiplyScalar(j*Math.sin(s)),A.copy(E).multiplyScalar(j*Math.cos(s))),M.copy(C).normalize(),A.addVectors(w,C),C.normalize(),V=o+i*k+e,[0,1,2].forEach((e=>{q[3*V+e]=A.getComponent(e),X[3*V+e]=M.getComponent(e)}));let l=+t+Math.sin(s);Y[2*V]=(r+j*l)/te,Y[2*V+1]=e/a}}A.addVectors(x,_),V=H+oe*k+e,[0,1,2].forEach((e=>{q[3*V+e]=A.getComponent(e),X[3*V+e]=E.getComponent(e)})),Y[2*V]=(ee+oe*$)/te,Y[2*V+1]=e/a}}let re=L+2*l+2,[se,ae]=[+c,re-1];for(let oe=se;oe<=ae-1;oe++){let e=c&&oe===ae-1;for(let t=0;t<k-1;t++)h=oe*k+t,d=h+1,u=(e?t:h)+k,p=(e?t+1:d)+k,0===oe?K.push(d,p,u):oe===re-2?K.push(h,d,u):K.push(h,d,u,d,p,u)}this.setIndex(K),this.setAttribute("position",new hr(q,3)),this.setAttribute("normal",new hr(X,3)),this.setAttribute("uv",new hr(Y,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e,t,i,n,r=this.userData.parameters,s=Math.ceil(r.tubularSegments),a=r.radialSegments+1,o=Array.from(this.getIndex().array),l=6*(s-1)*r.radialSegments,c=s,h=c===s;for(let d=0;d<r.radialSegments;d++)e=c*a+d,t=e+1,i=(h?d:e)+a,n=(h?d+1:t)+a,o[l++]=e,o[l++]=t,o[l++]=i,o[l++]=t,o[l++]=n,o[l++]=i;return o.length=l,fC.array=o,fC.count=o.length,fC}},gC=class extends j_{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=(1+Math.sqrt(5))/2,r="IcosahedronGeometry";super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r,e,t,i),this.type=r}static fromJSON(e){return new gC(e.radius,e.corner,e.cornerSides)}},vC=new bn,yC=new Hn,bC=new Vi,AC=class extends Zt{constructor(){super(),this.uuid=ui.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=(new fi).getNormalMatrix(e);for(let i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(e);for(let i=0,n=this.faces.length;i<n;i++){let e=this.faces[i];e.normal.applyMatrix3(t).normalize();for(let i=0,n=e.vertexNormals.length;i<n;i++)e.vertexNormals[i].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return vC.makeRotationX(e),this.applyMatrix4(vC),this}rotateY(e){return vC.makeRotationY(e),this.applyMatrix4(vC),this}rotateZ(e){return vC.makeRotationZ(e),this.applyMatrix4(vC),this}translate(e,t,i){return vC.makeTranslation(e,t,i),this.applyMatrix4(vC),this}scale(e,t,i){return vC.makeScale(e,t,i),this.applyMatrix4(vC),this}lookAt(e){return yC.lookAt(e),yC.updateMatrix(),this.applyMatrix4(yC.matrix),this}fromBufferGeometry(e){let t=this,i=null!==e.index?e.index:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let r=n.position,s=n.normal,a=n.color,o=n.uv,l=n.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let d=0;d<r.count;d++)t.vertices.push((new Vi).fromBufferAttribute(r,d)),void 0!==a&&t.colors.push((new Pi).fromBufferAttribute(a,d));function c(e,i,n,r){let c=void 0===a?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[n].clone()],h=void 0===s?[]:[(new Vi).fromBufferAttribute(s,e),(new Vi).fromBufferAttribute(s,i),(new Vi).fromBufferAttribute(s,n)],d=new wC(e,i,n,h,c,r);t.faces.push(d),void 0!==o&&t.faceVertexUvs[0].push([(new pi).fromBufferAttribute(o,e),(new pi).fromBufferAttribute(o,i),(new pi).fromBufferAttribute(o,n)]),void 0!==l&&t.faceVertexUvs[1].push([(new pi).fromBufferAttribute(l,e),(new pi).fromBufferAttribute(l,i),(new pi).fromBufferAttribute(l,n)])}let h=e.groups;if(h.length>0)for(let d=0;d<h.length;d++){let e=h[d],t=e.start;for(let n=t,r=t+e.count;n<r;n+=3)void 0!==i?c(i.getX(n),i.getX(n+1),i.getX(n+2),e.materialIndex):c(n,n+1,n+2,e.materialIndex)}else if(void 0!==i)for(let d=0;d<i.count;d+=3)c(i.getX(d),i.getX(d+1),i.getX(d+2));else for(let d=0;d<r.count;d+=3)c(d,d+1,d+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(bC).negate(),this.translate(bC.x,bC.y,bC.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,n=new bn;return n.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(n),this}computeFaceNormals(){let e=new Vi,t=new Vi;for(let i=0,n=this.faces.length;i<n;i++){let n=this.faces[i],r=this.vertices[n.a],s=this.vertices[n.b],a=this.vertices[n.c];e.subVectors(a,s),t.subVectors(r,s),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new Array(this.vertices.length);for(let i=0,n=this.vertices.length;i<n;i++)t[i]=new Vi;if(e){let e=new Vi,i=new Vi;for(let n=0,r=this.faces.length;n<r;n++){let r=this.faces[n],s=this.vertices[r.a],a=this.vertices[r.b],o=this.vertices[r.c];e.subVectors(o,a),i.subVectors(s,a),e.cross(i),t[r.a].add(e),t[r.b].add(e),t[r.c].add(e)}}else{this.computeFaceNormals();for(let e=0,i=this.faces.length;e<i;e++){let i=this.faces[e];t[i.a].add(i.normal),t[i.b].add(i.normal),t[i.c].add(i.normal)}}for(let i=0,n=this.vertices.length;i<n;i++)t[i].normalize();for(let i=0,n=this.faces.length;i<n;i++){let e=this.faces[i],n=e.vertexNormals;3===n.length?(n[0].copy(t[e.a]),n[1].copy(t[e.b]),n[2].copy(t[e.c])):(n[0]=t[e.a].clone(),n[1]=t[e.b].clone(),n[2]=t[e.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e],i=t.vertexNormals;3===i.length?(i[0].copy(t.normal),i[1].copy(t.normal),i[2].copy(t.normal)):(i[0]=t.normal.clone(),i[1]=t.normal.clone(),i[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,i=e.vertexNormals.length;t<i;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}let e=new AC;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let e=this.morphNormals[t].faceNormals,i=this.morphNormals[t].vertexNormals;for(let t=0,n=this.faces.length;t<n;t++){let t=new Vi,n={a:new Vi,b:new Vi,c:new Vi};e.push(t),i.push(n)}}let i=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e],n=i.faceNormals[e],r=i.vertexNormals[e];n.copy(t.normal),r.a.copy(t.vertexNormals[0]),r.b.copy(t.vertexNormals[1]),r.c.copy(t.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Wi),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new hn),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let n,r=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0!==t&&(n=(new fi).getNormalMatrix(t));for(let d=0,u=a.length;d<u;d++){let e=a[d].clone();void 0!==t&&e.applyMatrix4(t),s.push(e)}for(let d=0,u=h.length;d<u;d++)c.push(h[d].clone());for(let d=0,u=l.length;d<u;d++){let e,t,s=l[d],a=s.vertexNormals,c=s.vertexColors,h=new wC(s.a+r,s.b+r,s.c+r);h.normal.copy(s.normal),void 0!==n&&h.normal.applyMatrix3(n).normalize();for(let i=0,r=a.length;i<r;i++)e=a[i].clone(),void 0!==n&&e.applyMatrix3(n).normalize(),h.vertexNormals.push(e);h.color.copy(s.color);for(let i=0,n=c.length;i<n;i++)t=c[i],h.vertexColors.push(t.clone());h.materialIndex=s.materialIndex+i,o.push(h)}for(let d=0,u=e.faceVertexUvs.length;d<u;d++){let t=e.faceVertexUvs[d];void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=[]);for(let e=0,i=t.length;e<i;e++){let i=t[e],n=[];for(let e=0,t=i.length;e<t;e++)n.push(i[e].clone());this.faceVertexUvs[d].push(n)}}}mergeMesh(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}mergeVertices(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t={},i=[],n=[],r=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let e=this.vertices[o],s=Math.round(e.x*r)+"_"+Math.round(e.y*r)+"_"+Math.round(e.z*r);void 0===t[s]?(t[s]=o,i.push(this.vertices[o]),n[o]=i.length-1):n[o]=n[t[s]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let e=this.faces[o];e.a=n[e.a],e.b=n[e.b],e.c=n[e.c];let t=[e.a,e.b,e.c];for(let i=0;i<3;i++)if(t[i]===t[(i+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let e=s[o];this.faces.splice(e,1);for(let t=0,i=this.faceVertexUvs.length;t<i;t++)this.faceVertexUvs[t].splice(e,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let i=e[t];this.vertices.push(new Vi(i.x,i.y,i.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let a=0;a<t;a++)e[a]._id=a;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));let i,n,r=this.faceVertexUvs[0],s=this.faceVertexUvs[1];r&&r.length===t&&(i=[]),s&&s.length===t&&(n=[]);for(let a=0;a<t;a++){let t=e[a]._id;i&&i.push(r[t]),n&&n.push(s[t])}i&&(this.faceVertexUvs[0]=i),n&&(this.faceVertexUvs[1]=n)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){let t=this.parameters;for(let i in t)void 0!==t[i]&&(e[i]=t[i]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let e=this.vertices[p];t.push(e.x,e.y,e.z)}let i=[],n=[],r={},s=[],a={},o=[],l={};for(let p=0;p<this.faces.length;p++){let e=this.faces[p],t=!0,n=!1,r=void 0!==this.faceVertexUvs[0][p],s=e.normal.length()>0,a=e.vertexNormals.length>0,o=1!==e.color.r||1!==e.color.g||1!==e.color.b,l=e.vertexColors.length>0,f=0;if(f=c(f,0,0),f=c(f,1,t),f=c(f,2,n),f=c(f,3,r),f=c(f,4,s),f=c(f,5,a),f=c(f,6,o),f=c(f,7,l),i.push(f),i.push(e.a,e.b,e.c),i.push(e.materialIndex),r){let e=this.faceVertexUvs[0][p];i.push(u(e[0]),u(e[1]),u(e[2]))}if(s&&i.push(h(e.normal)),a){let t=e.vertexNormals;i.push(h(t[0]),h(t[1]),h(t[2]))}if(o&&i.push(d(e.color)),l){let t=e.vertexColors;i.push(d(t[0]),d(t[1]),d(t[2]))}}function c(e,t,i){return i?e|1<<t:e&~(1<<t)}function h(e){let t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==r[t]||(r[t]=n.length/3,n.push(e.x,e.y,e.z)),r[t]}function d(e){let t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==a[t]||(a[t]=s.length,s.push(e.getHex())),a[t]}function u(e){let t=e.x.toString()+e.y.toString();return void 0!==l[t]||(l[t]=o.length/2,o.push(e.x,e.y)),l[t]}return e.data={},e.data.vertices=t,e.data.normals=n,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return(new AC).copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let d=0,u=t.length;d<u;d++)this.vertices.push(t[d].clone());let i=e.colors;for(let d=0,u=i.length;d<u;d++)this.colors.push(i[d].clone());let n=e.faces;for(let d=0,u=n.length;d<u;d++)this.faces.push(n[d].clone());for(let d=0,u=e.faceVertexUvs.length;d<u;d++){let t=e.faceVertexUvs[d];void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=[]);for(let e=0,i=t.length;e<i;e++){let i=t[e],n=[];for(let e=0,t=i.length;e<t;e++){let t=i[e];n.push(t.clone())}this.faceVertexUvs[d].push(n)}}let r=e.morphTargets;for(let d=0,u=r.length;d<u;d++){let e={};if(e.name=r[d].name,void 0!==r[d].vertices){e.vertices=[];for(let t=0,i=r[d].vertices.length;t<i;t++)e.vertices.push(r[d].vertices[t].clone())}if(void 0!==r[d].normals){e.normals=[];for(let t=0,i=r[d].normals.length;t<i;t++)e.normals.push(r[d].normals[t].clone())}this.morphTargets.push(e)}let s=e.morphNormals;for(let d=0,u=s.length;d<u;d++){let e={};if(void 0!==s[d].vertexNormals){e.vertexNormals=[];for(let t=0,i=s[d].vertexNormals.length;t<i;t++){let i=s[d].vertexNormals[t],n={};n.a=i.a.clone(),n.b=i.b.clone(),n.c=i.c.clone(),e.vertexNormals.push(n)}}if(void 0!==s[d].faceNormals){e.faceNormals=[];for(let t=0,i=s[d].faceNormals.length;t<i;t++)e.faceNormals.push(s[d].faceNormals[t].clone())}this.morphNormals.push(e)}let a=e.skinWeights;for(let d=0,u=a.length;d<u;d++)this.skinWeights.push(a[d].clone());let o=e.skinIndices;for(let d=0,u=o.length;d<u;d++)this.skinIndices.push(o[d].clone());let l=e.lineDistances;for(let d=0,u=l.length;d<u;d++)this.lineDistances.push(l[d]);let c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());let h=e.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=(new xC).fromGeometry(this),t=new yr,i=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",CC.call(new or(i,3),e.vertices)),e.normals.length>0){let i=new Float32Array(3*e.normals.length);t.setAttribute("normal",CC.call(new or(i,3),e.normals))}if(e.colors.length>0){let i=new Float32Array(3*e.colors.length);t.setAttribute("color",_C.call(new or(i,3),e.colors))}if(e.uvs.length>0){let i=new Float32Array(2*e.uvs.length);t.setAttribute("uv",EC.call(new or(i,2),e.uvs))}if(e.uvs2.length>0){let i=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",EC.call(new or(i,2),e.uvs2))}t.groups=e.groups;for(let n in e.morphTargets){let i=[],r=e.morphTargets[n];for(let e=0,t=r.length;e<t;e++){let t=r[e],n=new hr(3*t.data.length,3);n.name=t.name,i.push(CC.call(n,t.data))}t.morphAttributes[n]=i}if(e.skinIndices.length>0){let i=new hr(4*e.skinIndices.length,4);t.setAttribute("skinIndex",MC.call(i,e.skinIndices))}if(e.skinWeights.length>0){let i=new hr(4*e.skinWeights.length,4);t.setAttribute("skinWeight",MC.call(i,e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new yr,i=e.geometry;if(e.isPoints||e.isLine){let e=new hr(3*i.vertices.length,3),n=new hr(3*i.colors.length,3);if(t.setAttribute("position",CC.call(e,i.vertices)),t.setAttribute("color",_C.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let e=new hr(i.lineDistances.length,1);t.setAttribute("lineDistance",SC.call(e,i.lineDistances))}null!==i.boundingSphere&&(t.boundingSphere=i.boundingSphere.clone()),null!==i.boundingBox&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};AC.prototype.isGeometry=!0;var xC=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t,i,n,r=[],s=e.faces;for(i=0;i<s.length;i++){let e=s[i];e.materialIndex!==n&&(n=e.materialIndex,void 0!==t&&(t.count=3*i-t.start,r.push(t)),t={start:3*i,materialIndex:n})}void 0!==t&&(t.count=3*i-t.start,r.push(t)),this.groups=r}fromGeometry(e){let t,i=e.faces,n=e.vertices,r=e.faceVertexUvs,s=r[0]&&r[0].length>0,a=r[1]&&r[1].length>0,o=e.morphTargets,l=o.length;if(l>0){t=[];for(let e=0;e<l;e++)t[e]={name:o[e].name,data:[]};this.morphTargets.position=t}let c,h=e.morphNormals,d=h.length;if(d>0){c=[];for(let e=0;e<d;e++)c[e]={name:h[e].name,data:[]};this.morphTargets.normal=c}let u=e.skinIndices,p=e.skinWeights,f=u.length===n.length,m=p.length===n.length;n.length>0&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<i.length;g++){let e=i[g];this.vertices.push(n[e.a],n[e.b],n[e.c]);let v=e.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{let t=e.normal;this.normals.push(t,t,t)}let y=e.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{let t=e.color;this.colors.push(t,t,t)}if(!0===s){let e=r[0][g];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new pi,new pi,new pi))}if(!0===a){let e=r[1][g];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new pi,new pi,new pi))}for(let i=0;i<l;i++){let n=o[i].vertices;t[i].data.push(n[e.a],n[e.b],n[e.c])}for(let t=0;t<d;t++){let e=h[t].vertexNormals[g];c[t].data.push(e.a,e.b,e.c)}f&&this.skinIndices.push(u[e.a],u[e.b],u[e.c]),m&&this.skinWeights.push(p[e.a],p[e.b],p[e.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}},wC=class{constructor(e,t,i,n,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.a=e,this.b=t,this.c=i,this.normal=n&&n.isVector3?n:new Vi,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new Pi,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function SC(e){return this.array.set(e),this}function _C(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new Pi),t[i++]=r.r,t[i++]=r.g,t[i++]=r.b}return this}function EC(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new pi),t[i++]=r.x,t[i++]=r.y}return this}function CC(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new Vi),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z}return this}function MC(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new ki),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z,t[i++]=r.w}return this}var TC=["a","b","c"];function IC(e,t){switch(t){case"c":return e.c;case"b":return e.b;default:return e.a}}function PC(e,t,i){let n=Math.min(e,t)+"_"+Math.max(e,t);return i.get(n)}function DC(e,t,i,n,r,s){let a,o=Math.min(e,t),l=Math.max(e,t),c=o+"_"+l;if(n.has(c))a=n.get(c);else{a={a:i[o],b:i[l],newEdge:null,faces:[]},n.set(c,a)}a.faces.push(r),s[e].edges.push(a),s[t].edges.push(a)}function RC(e,t,i,n,r){e.push(new wC(t,i,n,void 0,void 0,r))}function BC(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function LC(e,t,i,n){e.push([t.clone(),i.clone(),n.clone()])}var OC=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.subdivisions=e}modify(e){(e=e instanceof yr?(new AC).fromBufferGeometry(e):e.clone()).mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t,i,n,r,s,a=new Vi,o=e.vertices,l=e.faces,c=e.faceVertexUvs[0],h=void 0!==c&&c.length>0,d=[],u=new Map;!function(e,t,i,n){let r,s,a;for(r=0,s=e.length;r<s;r++)i[r]={edges:[]};for(r=0,s=t.length;r<s;r++)a=t[r],DC(a.a,a.b,e,n,a,i),DC(a.b,a.c,e,n,a,i),DC(a.c,a.a,e,n,a,i)}(o,l,d,u);let p,f,m,g,v,y,b,A=[];for(let G of Array.from(u.keys())){for(f=u.get(G),m=new Vi,v=3/8,y=1/8,b=f.faces.length,2!=b&&(v=.5,y=0),m.addVectors(f.a,f.b).multiplyScalar(v),a.set(0,0,0),r=0;r<b;r++){for(g=f.faces[r],s=0;s<3&&(p=o[IC(g,TC[s])],p===f.a||p===f.b);s++);p&&a.add(p)}a.multiplyScalar(y),m.add(a),f.newEdge=A.length,A.push(m)}let x,w,S,_,E,C,M,T=[];for(i=0,n=o.length;i<n;i++){for(C=o[i],E=d[i].edges,t=E.length,3==t?x=3/16:t>3&&(x=3/(8*t)),w=1-t*Number(x),S=x,t<=2&&(2==t&&(w=3/4,S=1/8)),M=C.clone().multiplyScalar(w),a.set(0,0,0),r=0;r<t;r++)_=E[r],p=_.a!==C?_.a:_.b,a.add(p);a.multiplyScalar(Number(S)),M.add(a),T.push(M)}let I,P,D,R,B,L,O,N=T.concat(A),k=T.length,F=[],U=[],z=new pi,j=new pi,V=new pi;for(i=0,n=l.length;i<n;i++)g=l[i],I=Number(PC(g.a,g.b,u).newEdge)+k,P=Number(PC(g.b,g.c,u).newEdge)+k,D=Number(PC(g.c,g.a,u).newEdge)+k,RC(F,I,P,D,g.materialIndex),RC(F,g.a,I,D,g.materialIndex),RC(F,g.b,P,I,g.materialIndex),RC(F,g.c,D,P,g.materialIndex),h&&(R=c[i],B=R[0],L=R[1],O=R[2],z.set(BC(B.x,L.x),BC(B.y,L.y)),j.set(BC(L.x,O.x),BC(L.y,O.y)),V.set(BC(B.x,O.x),BC(B.y,O.y)),LC(U,z,j,V),LC(U,B,z,V),LC(U,L,j,z),LC(U,O,V,j));e.vertices=N,e.faces=F,h&&(e.faceVertexUvs[0]=U)}},NC=new Vi,kC=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof EE?e.shape:new EE,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:n,cornerRadius:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=e.parameters,l=e.shape,c=.5*t,h=.5*i,d=2*Math.PI/n;for(let p=0;p<n;p++){let e=d*p,t=0+Math.sin(e)*c,i=0+Math.cos(e)*h;l.addPoint(l.createPoint(t,i))}l.isClosed=!0;for(let p=0,f=l.points.length;p<f;p++)l.points[p].roundness=r;l.roundness=r,l.update();let u=sC.create({shape:l,parameters:{roundness:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(u,{userData:{...e,type:"PolygonGeometry"}})}};function FC(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function UC(e,t,i,n,r,s){let a=t.clone().sub(e),o=i.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),n===r){let t=a.add(o).normalize();s.copy(e).addScaledVector(t,n/Math.sin(l/2))}else{let t=a.angleTo(o);s.copy(e),s.addScaledVector(a,r/Math.sin(t)),s.addScaledVector(o,n/Math.sin(t))}}function zC(e,t,i){let n=e.clone().sub(t),r=i.clone().sub(t);return n.projectOnVector(r),n.add(t)}var jC=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:4;super(),i=Math.floor(Math.max(3,i)),n=Math.floor(n),a=Math.floor(a);let o,l=[],c=[],h=[],d=[],u=0,p=t/2,f=Math.PI/i,m=e*Math.cos(Math.PI/i),g=2*Math.PI/i,v=(i-2)*Math.PI/i,y=Math.PI-v,b=new Vi(0,-p,0),A=new Vi(0,p,0),x=new pi(e,-p),w=new pi(m,-p),S=new pi(0,A.y).sub(w),_=new pi(0,A.y).sub(x),E=new pi(S.y,-S.x).normalize(),C=new pi(_.y,-_.x).normalize(),M=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-S.angle())/2)-1e-8;s=Math.min(s,M);{let e=new Vi(E.x,E.y,0),t=new Vi(Math.cos(g)*e.x,e.y,Math.sin(g)*e.x);o=e.angleTo(t)}let T=s/Math.tan((Math.PI-S.angle())/2),I=s/Math.tan((Math.PI-o)/2),P=new Vi;if(!r){c.push(b.x,b.y,b.z),h.push(0,-1,0),d.push(0,0);let e=u++,t=[],n=x.clone(),r=T/Math.cos(Math.PI/i);n.x-=r;for(let s=0;s<i;s++){let e=s/i*Math.PI*2+f;FC(n,new pi(Math.sin(e),Math.cos(e)),P),c.push(P.x,P.y,P.z),h.push(0,-1,0),d.push(0,0),t.push(u++)}for(let i=0;i<t.length;i++)l.push(t[i],e,t[(i+1)%t.length])}let D=[];{let e=new Vi,t=new Vi,n=new Vi,r=new Vi,p=new Vi,m=new Vi;for(let g=0;g<i;g++){let v=g/i*Math.PI*2+f,y=(g+.5)/i*Math.PI*2+f,w=(g+1)/i*Math.PI*2+f,_=new pi(Math.sin(v),Math.cos(v)),M=new pi(Math.sin(y),Math.cos(y)),P=new pi(Math.sin(w),Math.cos(w));FC(x,_,t),FC(x,P,n),FC(E,M,e),UC(A,t,n,I,I,r),c.push(r.x,r.y,r.z),UC(t,A,n,I,T,p),c.push(p.x,p.y,p.z),UC(n,t,A,T,I,m),c.push(m.x,m.y,m.z),h.push(e.x,e.y,e.z),h.push(e.x,e.y,e.z),h.push(e.x,e.y,e.z),d.push(0,0),d.push(0,0),d.push(0,0);let L=u++,O=u++,N=u++;if(l.push(L,O,N),s>0){{let e=t.clone().add(n).multiplyScalar(.5),i=A.clone().sub(e).normalize(),r=b.clone().sub(e).normalize().add(i).normalize().multiplyScalar(-1);R(e,m.clone().sub(p),r,S.angle())}let f,g;{let e=new Vi;FC(C,P,e);let t=m.clone().add(r).multiplyScalar(.5);t=zC(t,n,A);let i=m.clone().sub(r);[f,g]=R(t,i,e,o,r.y)}{let e=f,t=e.clone().setY(0).normalize(),i=new Vi(0,-1,0),n=t.clone().cross(i);B(e,t,i,n)}D.concat(g);{let t=S.angle(),n=Math.PI-t,r=A.clone();r.y-=s/Math.sin(t-Math.PI/2);let o=new Vi,p=[];for(let l=0;l<a;l++){let t=[],f=Math.PI/2-n*l/a,m=Math.cos(f),g=Math.sin(f),v=y;for(let n=0;n<=l;n++){let n=Math.cos(v),a=Math.sin(v);e.x=m*a,e.y=g,e.z=m*n,o.copy(r).addScaledVector(e,s),c.push(o.x,o.y,o.z),h.push(e.x,e.y,e.z),d.push(0,0),t.push(u++),v+=2*Math.PI/l/i}p.push(t)}g.reverse(),p.push(g);let f=p.length-1;for(let e=0;e<f;e++){let t=p[e],i=p[e+1],n=t.length-1;l.push(i[1],t[0],i[0]);for(let e=1;e<=n;e++)l.push(t[e],t[e-1],i[e]),l.push(i[e+1],t[e],i[e])}}}}}function R(e,t,i,n,r){let o=-n/2,p=(Math.PI-n)/2,f=t.clone().normalize().cross(i);e.addScaledVector(i,-s/Math.sin(p));let m=new Vi,g=new Vi,v=u,y=[];for(let l=0;l<=a;l++){let p=o+l/a*n;g.set(0,0,0),g.addScaledVector(f,Math.sin(p)),g.addScaledVector(i,Math.cos(p));for(let i=0;i<=1;i++){let n=i/1-.5;if(m.copy(e),m.addScaledVector(t,n),m.addScaledVector(g,s),null!=r){let e=Math.max(0,m.y-r);m.addScaledVector(t,-e/t.y)}c.push(m.x,m.y,m.z),h.push(g.x,g.y,g.z),d.push(0,0),0===i&&y.push(u),u++}}for(let s=0;s<a;s++)for(let e=0;e<1;e++){let t=v+e+2*s,i=t+2,n=i+1,r=t+1;l.push(t,i,r),l.push(i,n,r)}return[e.clone().addScaledVector(t,.5),y]}function B(e,t,i,n){let r=Math.PI/2,o=_.angle()-r,p=[],f=new Vi,m=new Vi;for(let l=0;l<=a;l++){let g=[],v=l/a;for(let a=0;a<=l;a++){let p=((l?a/l:0)-.5)*y,b=Math.cos(p),A=Math.sin(p),x=(r+Math.atan(Math.tan(o)*b))*v,w=Math.cos(x),S=Math.sin(x);f.set(0,0,0),f.addScaledVector(t,S*b),f.addScaledVector(i,w),f.addScaledVector(n,S*A),m.copy(e).addScaledVector(f,s),c.push(m.x,m.y,m.z),h.push(f.x,f.y,f.z),d.push(0,0),g.push(u++)}p.push(g)}let g=p.length-1;for(let s=0;s<g;s++){let e=p[s],t=p[s+1],i=e.length-1;l.push(e[0],t[1],t[0]);for(let n=1;n<=i;n++)l.push(e[n-1],e[n],t[n]),l.push(e[n],t[n+1],t[n])}}this.setIndex(l),this.setAttribute("position",new hr(c,3)),this.setAttribute("normal",new hr(h,3)),this.setAttribute("uv",new hr(d,2))}},VC=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),n=Object.assign(t?.ui??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof EE?e.shape:new EE,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:n}}static build(e){let t=e.shape,{width:i,height:n,cornerRadius:r,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c={x:.5*i,y:.5*n},h={x:-c.x,y:-c.y},d={x:c.x,y:c.y};function u(e,t,r){return t>i&&r>n?Math.min(e*i/t,e*n/r):t>i?e*i/t:r>n?e*n/r:e}let p=[];p[0]=0===r[0]?0:u(r[0],r[0]+r[3],r[0]+r[1]),p[1]=0===r[1]?0:u(r[1],r[1]+r[2],r[1]+r[0]),p[2]=0===r[2]?0:u(r[2],r[2]+r[1],r[2]+r[3]),p[3]=0===r[3]?0:u(r[3],r[3]+r[0],r[3]+r[2]);let f=h.x,m=d.x,g=d.y,v=h.y;t.addPoint(t.createPoint(f,g)),t.addPoint(t.createPoint(m,g)),t.addPoint(t.createPoint(m,v)),t.addPoint(t.createPoint(f,v)),t.isClosed=!0;let y=!0;for(let A=0,x=t.points.length;A<x;A++)t.points[A].roundness=p[A],A>0&&p[A]!==p[A-1]&&(y=!1);y&&(t.roundness=p[0]),t.useCubicForRoundedCorners=1!==s,t.update();let b=sC.create({shape:t,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(b,{userData:{...e,type:"RectangleGeometry"}})}},GC=class extends yr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:90,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:24;super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;0==r&&(s=1),s=Math.max(1,Math.floor(s)),r=Math.min(r,100),n=Math.min(180-c,n),n*=Math.PI/180;let h=[],d=Math.PI/2,u=function(){return new Vi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)},p=u(),f=u(),[m,g,v]=[t/2,e/2,i/2],y=-g,b=+g,[A,x,w]=[u(y,-m,+v),u(y,-m,-v),u(y,+m,-v)],S=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.sin(e-Math.PI/(+t+1))},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.cos(e-Math.PI/(+t+1))};w.y=Math.sin(n)*t-m;let E=Math.cos(n)*t-v,C=A.z-c;n<=d?(w.z=Math.min(E,C),w.z==C&&(w.y-=(E-C)/Math.tan(d-n))):x.z=Math.min(x.z-E-v,A.z-c),p.subVectors(A,x),f.subVectors(w,x);let M=Math.min(p.length(),f.length())*r/100,T=M*Math.tan(n/2),I=M/Math.cos(n/2),P=p.clone().normalize().add(f.normalize()).setLength(I).add(x);p.set(0,S(n,!0),_(n,!0)),h.push([w,p.clone()]);let D=(Math.PI-n)/s;for(let V=0;V<=s;V++){let e=d+n+V*D;p.set(0,Math.sin(e)*T,Math.cos(e)*T),p.add(P),f.set(0,S(e),_(e)),h.push([p.clone(),f.clone()])}h.push([A,u(0,1,0)]);let R=Math.sin(D/2)*T*2,B=h.length-1,L=h[0][0].distanceTo(h[1][0]),O=L+R*s+h[B-1][0].distanceTo(h[B][0]);h[0].push(1);for(let V=0;V<=s;V++)h[V+1].push(1-(L+V*R)/O);h[B].push(0);let N,k,F,[U,z,j]=h[0];for(let V=1;V<h.length;V++)[N,k,F]=h[V],a.push(y,U.y,U.z,y,N.y,N.z,b,U.y,U.z,b,U.y,U.z,y,N.y,N.z,b,N.y,N.z),o.push(0,z.y,z.z,0,k.y,k.z,0,z.y,z.z,0,z.y,z.z,0,k.y,k.z,0,k.y,k.z),l.push(0,j,0,F,1,j,1,j,0,F,1,F),[U,z,j]=[N,k,F];this.setAttribute("position",new hr(a,3)),this.setAttribute("normal",new hr(o,3)),this.setAttribute("uv",new hr(l,2))}},HC=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof EE?e.shape:new EE,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:n,spikes:r,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,h=e.shape,d=.5*t,u=.5*i,p=a*Math.PI/360/r,f=Math.PI/2*3*-1,m=d*n/100,g=u*n/100;if(3===r&&50===n){p=2*Math.PI/r;for(let e=0;e<r;e++){let t=p*e,i=0+Math.sin(t)*d,n=0+Math.cos(t)*u;h.addPoint(h.createPoint(i,n))}}else for(let y=0;y<r;y++){let e=0+Math.cos(f)*d,t=0+Math.sin(f)*u;h.addPoint(h.createPoint(e,t)),f+=p,e=0+Math.cos(f)*m,t=0+Math.sin(f)*g,h.addPoint(h.createPoint(e,t)),f+=p}h.isClosed=!0;for(let y=0,b=h.points.length;y<b;y++)h.points[y].roundness=s;h.roundness=s,h.update();let v=sC.create({shape:h,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(v,{userData:{...e,type:"StarGeometry"}})}};var WC={parseRgba:function(e){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(e.toLowerCase())},hsvToRgb:function(e,t,i){let n,r,s,a=Math.floor(6*e),o=6*e-a,l=i*(1-t),c=i*(1-o*t),h=i*(1-(1-o)*t);switch(a%6){case 0:n=i,r=h,s=l;break;case 1:n=c,r=i,s=l;break;case 2:n=l,r=i,s=h;break;case 3:n=l,r=c,s=i;break;case 4:n=h,r=l,s=i;break;default:n=i,r=l,s=c}return{r:255*n,g:255*r,b:255*s}},rgbToHsv:function(e,t,i){e/=255,t/=255,i/=255;let n,r=Math.max(e,t,i),s=Math.min(e,t,i),a=r,o=r-s,l=0==r?0:o/r;if(r==s)n=0;else{switch(r){case e:n=(t-i)/o+(t<i?6:0);break;case t:n=(i-e)/o+2;break;default:n=(e-t)/o+4}n/=6}return{h:n,s:l,v:a}},hexToRgb:function(e){return{r:(e=Math.floor(e))>>16&255,g:e>>8&255,b:255&e}},rgbToHex:function(e,t,i){return(e<<16)+(t<<8)+i},rgbToHexString:function(e,t,i){return"#"+[e=Math.round(e),t=Math.round(t),i=Math.round(i)].map((e=>e.toString(16).padStart(2,"0"))).join("").toUpperCase()},hexStringToRgb:function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((e,t,i,n)=>String(t+t+i+i+n+n)));let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}},QC=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+QC.version}static addUnaryOp(e){return QC.max_unop_len=Math.max(e.length,QC.max_unop_len),QC.unary_ops[e]=1,QC}static addBinaryOp(e,t,i){return QC.max_binop_len=Math.max(e.length,QC.max_binop_len),QC.binary_ops[e]=t,i?QC.right_associative.add(e):QC.right_associative.delete(e),QC}static addIdentifierChar(e){return QC.additional_identifier_chars.add(e),QC}static addLiteral(e,t){return QC.literals[e]=t,QC}static removeUnaryOp(e){return delete QC.unary_ops[e],e.length===QC.max_unop_len&&(QC.max_unop_len=QC.getMaxKeyLen(QC.unary_ops)),QC}static removeAllUnaryOps(){return QC.unary_ops={},QC.max_unop_len=0,QC}static removeIdentifierChar(e){return QC.additional_identifier_chars.delete(e),QC}static removeBinaryOp(e){return delete QC.binary_ops[e],e.length===QC.max_binop_len&&(QC.max_binop_len=QC.getMaxKeyLen(QC.binary_ops)),QC.right_associative.delete(e),QC}static removeAllBinaryOps(){return QC.binary_ops={},QC.max_binop_len=0,QC}static removeLiteral(e){return delete QC.literals[e],QC}static removeAllLiterals(){return QC.literals={},QC}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new QC(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map((e=>e.length)))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return QC.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!QC.binary_ops[String.fromCharCode(e)]||QC.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return QC.isIdentifierStart(e)||QC.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(QC.hooks[e]){let i={context:this,node:t};return QC.hooks.run(e,i),i.node}return t}searchHook(e){if(QC.hooks[e]){let t={context:this};return QC.hooks[e].find((function(e){return e.call(t.context,t),t.node})),t.node}}gobbleSpaces(){let e=this.code;for(;e===QC.SPACE_CODE||e===QC.TAB_CODE||e===QC.LF_CODE||e===QC.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions(),t=1===e.length?e[0]:{type:QC.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t,i,n=[];for(;this.index<this.expr.length;)if(t=this.code,t===QC.SEMCOL_CODE||t===QC.COMMA_CODE)this.index++;else if(i=this.gobbleExpression())n.push(i);else if(this.index<this.expr.length){if(t===e)break;this.throwError('Unexpected "'+this.char+'"')}return n}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,QC.max_binop_len),t=e.length;for(;t>0;){if(QC.binary_ops.hasOwnProperty(e)&&(!QC.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!QC.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,i,n,r,s,a,o,l;if(s=this.gobbleToken(),!s||(t=this.gobbleBinaryOp(),!t))return s;for(r={value:t,prec:QC.binaryPrecedence(t),right_a:QC.right_associative.has(t)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+t),n=[s,r,a];t=this.gobbleBinaryOp();){if(i=QC.binaryPrecedence(t),0===i){this.index-=t.length;break}r={value:t,prec:i,right_a:QC.right_associative.has(t)},l=t;let o=e=>r.right_a&&e.right_a?i>e.prec:i<=e.prec;for(;n.length>2&&o(n[n.length-2]);)a=n.pop(),t=n.pop().value,s=n.pop(),e={type:QC.BINARY_EXP,operator:t,left:s,right:a},n.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),n.push(r,e)}for(o=n.length-1,e=n[o];o>1;)e={type:QC.BINARY_EXP,operator:n[o-1].value,left:n[o-2],right:e},o-=2;return e}gobbleToken(){let e,t,i,n;if(this.gobbleSpaces(),n=this.searchHook("gobble-token"),n)return this.runHook("after-token",n);if(e=this.code,QC.isDecimalDigit(e)||e===QC.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===QC.SQUOTE_CODE||e===QC.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(e===QC.OBRACK_CODE)n=this.gobbleArray();else{for(t=this.expr.substr(this.index,QC.max_unop_len),i=t.length;i>0;){if(QC.unary_ops.hasOwnProperty(t)&&(!QC.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!QC.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=i;let e=this.gobbleToken();return e||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:QC.UNARY_EXP,operator:t,argument:e,prefix:!0})}t=t.substr(0,--i)}QC.isIdentifierStart(e)?(n=this.gobbleIdentifier(),QC.literals.hasOwnProperty(n.name)?n={type:QC.LITERAL,value:QC.literals[n.name],raw:n.name}:n.name===QC.this_str&&(n={type:QC.THIS_EXP})):e===QC.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook("after-token",n)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===QC.PERIOD_CODE||t===QC.OBRACK_CODE||t===QC.OPAREN_CODE||t===QC.QUMARK_CODE;){let i;if(t===QC.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==QC.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===QC.OBRACK_CODE?(e={type:QC.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==QC.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===QC.OPAREN_CODE?e={type:QC.CALL_EXP,arguments:this.gobbleArguments(QC.CPAREN_CODE),callee:e}:(t===QC.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),e={type:QC.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),i&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e,t,i="";for(;QC.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);if(this.code===QC.PERIOD_CODE)for(i+=this.expr.charAt(this.index++);QC.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);if(e=this.char,"e"===e||"E"===e){for(i+=this.expr.charAt(this.index++),e=this.char,("+"===e||"-"===e)&&(i+=this.expr.charAt(this.index++));QC.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);QC.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+i+this.char+")")}return t=this.code,QC.isIdentifierStart(t)?this.throwError("Variable names cannot start with a number ("+i+this.char+")"):(t===QC.PERIOD_CODE||1===i.length&&i.charCodeAt(0)===QC.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:QC.LITERAL,value:parseFloat(i),raw:i}}gobbleStringLiteral(){let e="",t=this.index,i=this.expr.charAt(this.index++),n=!1;for(;this.index<this.expr.length;){let t=this.expr.charAt(this.index++);if(t===i){n=!0;break}if("\\"===t)switch(t=this.expr.charAt(this.index++),t){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=t}else e+=t}return n||this.throwError('Unclosed quote after "'+e+'"'),{type:QC.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(QC.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,QC.isIdentifierPart(e));)this.index++;return{type:QC.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],i=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let r=this.code;if(r===e){i=!0,this.index++,e===QC.CPAREN_CODE&&n&&n>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}if(r===QC.COMMA_CODE){if(this.index++,n++,n!==t.length)if(e===QC.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===QC.CBRACK_CODE)for(let e=t.length;e<n;e++)t.push(null)}else if(t.length!==n&&0!==n)this.throwError("Expected comma");else{let e=this.gobbleExpression();(!e||e.type===QC.COMPOUND)&&this.throwError("Expected comma"),t.push(e)}}return i||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(QC.CPAREN_CODE);if(this.code===QC.CPAREN_CODE)return this.index++,1===e.length?e[0]:!!e.length&&{type:QC.SEQUENCE_EXP,expressions:e};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:QC.ARRAY_EXP,elements:this.gobbleArguments(QC.CBRACK_CODE)}}},qC=new class{add(e,t,i){if("string"!=typeof arguments[0])for(let n in arguments[0])this.add(n,arguments[0][n],arguments[1]);else(Array.isArray(e)?e:[e]).forEach((function(e){this[e]=this[e]||[],t&&this[e][i?"unshift":"push"](t)}),this)}run(e,t){this[e]=this[e]||[],this[e].forEach((function(e){e.call(t&&t.context?t.context:t,t)}))}};Object.assign(QC,{hooks:qC,plugins:new class{constructor(e){this.jsep=e,this.registered={}}register(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{if("object"!=typeof e||!e.name||!e.init)throw new Error("Invalid JSEP plugin format");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)}))}}(QC),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),QC.max_unop_len=QC.getMaxKeyLen(QC.unary_ops),QC.max_binop_len=QC.getMaxKeyLen(QC.binary_ops);var XC=e=>new QC(e).parse();Object.getOwnPropertyNames(QC).forEach((e=>{void 0===XC[e]&&"prototype"!==e&&(XC[e]=QC[e])})),XC.Jsep=QC;var YC={name:"ternary",init(e){e.hooks.add("after-expression",(function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,n=this.gobbleExpression();if(n||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let r=this.gobbleExpression();if(r||this.throwError("Expected expression"),t.node={type:"ConditionalExpression",test:i,consequent:n,alternate:r},i.operator&&e.binary_ops[i.operator]<=.9){let n=i;for(;n.right.operator&&e.binary_ops[n.right.operator]<=.9;)n=n.right;t.node.test=n.right,n.right=t.node,t.node=i}}else this.throwError("Expected :")}}))}};function KC(e){return{all:e=e||new Map,on:function(t,i){var n=e.get(t);n?n.push(i):e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var n=e.get(t);n&&n.slice().map((function(e){e(i)})),(n=e.get("*"))&&n.slice().map((function(e){e(t,i)}))}}}XC.plugins.register(YC);var JC=class{constructor(e,t,i){this.id=e,this.userAPI=t,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise((e=>e())),this.emitter=KC(),this._innerCallUserAPI=async e=>{this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await async function(e,t){let i,n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new AbortController,s=e.url,a=e.proxy?.enabled??!1;if("OpenAI"===e.integration?.type){let i=eM(""===e.integration.prompt?[]:JSON.parse(e.integration.prompt),t),r=""===e.integration.behavior?[]:eM(JSON.parse(e.integration.behavior),t);n=`{\n\t\t"model": "${e.integration.model}",\n\t\t"messages": [${e.integration.useBehavior?`\n\t\t{\n\t\t\t"role": "system",\n\t\t\t"content": "${r}"\n\t\t},`:""}\n\t\t{\n\t\t\t"role": "user",\n\t\t\t"content": "${i}"\n\t\t}\n\t\t]\n\t}`}if(a){let i;s=`https://apis.spline.design/file/${e.proxy.fileId}/external-api/request?uuidexternalapi=${e.proxy.proxyId}`,void 0!==n?i=n:"POST"===e.method&&e.body&&(i=eM(JSON.parse(e.body),t)),void 0!==i&&(s+=`&data=${encodeURIComponent(i.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else"OpenAI"===e.integration?.type?i=n:"POST"===e.method&&e.body&&(i=eM(JSON.parse(e.body),t));let o=await fetch(s,{method:a?"GET":e.method,headers:a?void 0:ZC(e),signal:r.signal,body:i});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if("OpenAI"===e.integration?.type){let e=await o.json();return a&&(e=e.response),{content:e.choices[0].message.content}}{let e=await o.json();return a&&(e=e.response),e}}(this.userAPI,e),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(t){let i=t.message?.split("_:_")?.[0]?.replace("status:","")??"null";this.error=i,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},"OpenAI"===t?.integration?.type?this.result={content:""}:"GET"===t.method&&""!==t.url&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=bg(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=void 0!==this.userAPI.debounce&&this.userAPI.debounce>0?bg(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(e){await this.callUserAPI(e)}async callUserAPI(e){await this._debouncedCallUserAPI(e)}update(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.userAPI=e,this._updateDebouncedCallUserAPI(),""!==this.userAPI.url&&"GET"===this.userAPI.method&&i&&this._debouncedPrefetch(t)}retrieveValue(e){if(this.result)try{return Kv.zoom(this.result,e)}catch(Sb){console.error(Sb)}}retrieveZoomedKeyValues(e){if(this.result){let t=e&&e.length?Kv.zoom(this.result,e):this.result;if(function(e){return"object"==typeof e&&null!==e}(t))return Object.entries(t);if(function(e){return Array.isArray(e)}(t))return t.map(((e,t)=>[t.toString(),e]));throw function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e}(t)?new Error("This path points to a value, use retrieveValue() instead. "+e?.join(".")):new Error("Path error"+e?.join("."))}}dispose(){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}get autostart(){return this.userAPI.autoStart}};function ZC(e){let t=new Headers;return e.headers.forEach((e=>{""!==e.data.key&&t.append(e.data.key,e.data.value)})),t}var $C=(e,t)=>{if("string"==typeof e){let i=t.getVariable(e);if(i)return $C(i,t)}return Ox.isBoolean(e)?Ox.getDisplayedValue(e).toLowerCase():Ox.getDisplayedValue(e)},eM=(e,t)=>e.map(((e,i)=>{if("text"in e)return e.text;if("type"in e){if("paragraph"===e.type)return(i>0?"\n":"")+eM(e.children,t);if("variable"===e.type){let i=t.getVariable(e.variableId);if(void 0!==i)return $C(i,t)}}return""})).join(""),tM=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],iM=["0","1","2","3","4","5","6","7","8","9","."],nM=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function rM(e){return"string"==typeof e&&(!isNaN(e)&&!isNaN(parseFloat(e)))}function sM(e,t){let i,n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"number",s="";for(let a=0;a<e.length;a++){let i=e[a];if("objType"in i&&"api"===i.objType){let e=JSON.parse(i.id),n=e[0],r=t.getUserAPI(n);if(void 0!==r&&r instanceof JC){let t=r.retrieveValue(e.slice(1));void 0!==t&&(s+=t)}}else if("objType"in i&&"webhook"===i.objType){let e=JSON.parse(i.id),[n,r]=e,a=t.getUserWebhook(n);if(void 0!==a){let e=a.getParameterValue(r);void 0!==e&&(s+=e)}}else if("objType"in i&&"aiAssistant"===i.objType){let e=t.openAIRealtime;if("objId"in i&&void 0!==i.objId){let n;if(t.scene.data.objects.traverse(((e,t)=>{let r=t.events?.find((e=>e.id===i.objId));r&&(n=r)})),void 0!==n&&"AIAssistantListener"===n.data.type){let t=e?.computeAnalysisForListenerEvent(n.data);if(void 0!==t){s+=t;continue}}}s+=e?.voice??0}else if("id"in i){let n=e[a-1];if(a>0&&"id"in n)return void console.error("Two variables in a row",e);let o=t.getVariable(i.id),l=Ox.getDisplayedValue(o);"number"===r&&Ox.isTextValue(o)&&Array.isArray(o.textValue)&&1===o.textValue.length?l=parseFloat(l).toString():"boolean"===r&&Ox.isBoolean(o)?l=o?"true":"false":"boolean"===r&&Ox.isTextValue(o)&&!Array.isArray(o.textValue)&&(l='"'+l+'"'),s+=l}else"string"!==r?"and"!==i.name?"or"!==i.name?"True"!==i.name?"False"!==i.name?"boolean"!==r||rM(i.name)||iM.includes(i.name)||tM.includes(i.name)||nM.includes(i.name.replace(/\($/g,""))?s+=i.name:s+='"'+i.name+'"':s+="false":s+="true":s+="||":s+="&&":('"'!==i.name&&("+"!==i.name||i.escaped)&&(s+=i.name),"+"===i.name&&!i.escaped&&"\\"===s[s.length-1]&&(s=s.slice(0,-1)+i.name))}if("string"===r)return s;if(0===e.length){if("number"===r)return 0;if("boolean"===r)return!1}try{i=XC(s)}catch(Xb){return void console.error(s,Xb)}try{n=aM(i)}catch(Xb){console.error(s,i,Xb)}return n}function aM(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return Number(aM(e.left)===aM(e.right));case"!=":return Number(aM(e.left)!==aM(e.right));case">":return Number(aM(e.left)>aM(e.right));case">=":return Number(aM(e.left)>=aM(e.right));case"<":return Number(aM(e.left)<aM(e.right));case"<=":return Number(aM(e.left)<=aM(e.right));case"+":return aM(e.left)+aM(e.right);case"-":return aM(e.left)-aM(e.right);case"*":return aM(e.left)*aM(e.right);case"/":return aM(e.left)/aM(e.right);case"%":return aM(e.left)%aM(e.right);case"&&":return aM(e.left)&&aM(e.right);case"||":return aM(e.left)||aM(e.right);case"^":return Math.pow(aM(e.left),aM(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-aM(e.argument);case"!":return Number(!aM(e.argument));default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if("Identifier"===e.callee.type){if("random"===e.callee.name){let t=0,i=1;if(e.arguments.length>=1)try{t=aM(e.arguments[0])}catch(Ev){console.warn(Ev)}if(e.arguments.length>=2)try{i=aM(e.arguments[1])}catch(Ev){console.warn(Ev)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(aM))}throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}XC.addBinaryOp("^",11,!0);var oM=new bn,lM=new bn;var cM=class extends yr{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&1===this.inputs.parameters.extrusion.depth}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&1===e.depth)||!function(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:n}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),n=Math.max(0,Math.min(n,1));let r=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(n*r),a=this.inputs.path.isClosed?Math.ceil((i+n)*r):Math.ceil(Math.min(1,i+n)*r),o=Math.min(Math.max(2,a-s+1),r+2),l=[],c=[];for(let B=0;B<o;B++){let i=this.inputs.path.isClosed?(B+s)%e.length:Math.min(B+s,e.length-1);l.push(e[i].clone()),c.push(t[i].clone())}let h=(e,t,i)=>{l[e]=l[e].clone().lerp(l[t],i),c[e]=function(e,t,i){let n=[new Vi,new Vi,new Vi],r=[new Vi,new Vi,new Vi];return e.extractBasis(n[0],n[1],n[2]),t.extractBasis(r[0],r[1],r[2]),n.forEach(((e,t)=>{let n=r[t],s=ui.lerp(e.length(),n.length(),i);e.lerp(n,i).setLength(s)})),(new bn).makeBasis(n[0],n[1],n[2])}(c[e],c[t],i)},d=0,u=n*r%1;(!this.inputs.path.isClosed||i<=1)&&(u||0===n)&&(d=u,h(0,1,d));let p=0,f=(n+i)*r%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&n+i<1)&&f&&(p=f,h(l.length-1,l.length-2,1-p)),0===i){let e=l.length-1;l[e].copy(l[0]),c[e].copy(c[0])}this._applyPathModifiers(c,d,p);let{bevel:m,bevelSides:g}=this.inputs.parameters.extrusion,v=m>0?this.inputs.parameters.extrusion.capType:"flat",y=5;"Custom"===this.inputs.parameters.extrusion.shape.type&&(y="low"===this.inputs.parameters.extrusion.shape.shapeQuality?5:12);let b,{regions:A,infos:x,vertices:w}=this._computeShapePoints(y),S=0;"round"===v&&(b=new iC(this.inputs.shapeData,2*m,m,y,g,void 0,!0),S=b.getAttribute("position").count);let _=0,E=0;x.sort(((e,t)=>e.start-t.start)),x.forEach((e=>{e.verticesStart=_,e.verticesCount=e.continuous.reduce(((e,t,i)=>e+(0!==i&&t?1:2)),0),E+=e.verticesCount,_=E}));let C,M=E*o,T=0;if(this._isOpenEnded()&&"flat"===v){try{C=WE({windingRule:gE.ODD,elementType:yE.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:A})}catch{C=eC}T=C.vertexCount}let I=M+2*T+2*S,P=M+2*T,D={positions:new Float32Array(3*I),normals:new Float32Array(3*I),uvs:new Float32Array(2*I)},R=[];if(x.forEach((e=>{this._extrudeRegion(e,w,c,l,D,R,this._isGeometryClosed()&&!this._isOpenEnded())})),C&&(this._closeEnd(C,M,R,D,c[0],l[0],!1),this._closeEnd(C,M+T,R,D,c[c.length-1],l[l.length-1],!0)),b){D.positions.set(b.getAttribute("position").array,3*P),D.normals.set(b.getAttribute("normal").array,3*P),D.uvs.set(b.getAttribute("uv").array,2*P);for(let n=P;n<P+S;n++)D.uvs[2*n+1]=1e-4;let e=R.length;R.push(...b.getIndex().array.map((e=>e+P))),P+=S,D.positions.set(b.getAttribute("position").array,3*P),D.normals.set(b.getAttribute("normal").array,3*P),D.uvs.set(b.getAttribute("uv").array,2*P);let t=R.length;R.push(...b.getIndex().array.map((e=>e+P))),this.setAttribute("position",new or(D.positions,3)),this.setAttribute("normal",new or(D.normals,3)),this.setAttribute("uv",new or(D.uvs,2)),this.setIndex(R);let i=oM;i.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(i,P,I),i.copy(c[0]).setPosition(l[0]).multiply(lM.makeScale(1,1,-1)),this.applyMatrix4OnRange(i,P-S,P),this.reverseIndicesOnRange(e,t)}else this.setAttribute("position",new or(D.positions,3)),this.setAttribute("normal",new or(D.normals,3)),this.setAttribute("uv",new or(D.uvs,2)),this.setIndex(R)}_extractPathPoints(){let e=T_(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach((e=>{t[t.length-1].distanceToSquared(e)>.001&&t.push(e)})),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,n=this.inputs.path.isClosed,r=new Vi,s=new Vi,a=new Vi,o=new Vi,l=new Vi(0,1,0);for(let f=0;f<i;f++){let c,h,d=e[f];c=0===f?n?e[e.length-2]:d.clone().multiplyScalar(2).sub(e[1]):e[f-1],h=f===i-1?n?e[1]:d.clone().multiplyScalar(2).sub(e[f-1]):e[f+1];let u=d.clone().sub(c).normalize(),p=h.clone().sub(d).normalize(),m=u.clone().add(p).normalize();a.copy(m),0===f&&(m.equals(l)||m.clone().negate().equals(l))&&l.set(0,0,1);let g=l.clone().cross(m).normalize(),v=m.clone().cross(g).normalize();l.copy(v),o.copy(g),0===f&&(r.copy(v),s.copy(m));let y=(new bn).makeBasis(g,v,m);t.push(y)}let c=n?s:a,h=n?r:new Vi(0,1,0),d=c.clone().cross(o).normalize(),u=Math.acos(h.dot(d));if(isNaN(u))return t;let p=h.clone().cross(d);c.dot(p)>0&&(u*=-1);for(let f=1;f<t.length;f++){let e=(new bn).makeRotationZ(u*f/t.length);t[f].multiply(e)}return t}_applyPathModifiers(e,t,i){let n=e.length,{angle:r,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new bn,c=new bn;return e.forEach(((e,h)=>{let d=0===h?0:h===n-1?1:(h-t)/(n-(0===i?0:1)-(t+(1-i)));l.makeRotationZ(ui.lerp(r,r+s,d)*ui.DEG2RAD);let u=ui.lerp(a,o,d);c.makeScale(u,u,u),e.multiply(l).multiply(c)})),e}_computeShapePoints(){let e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gE.ODD,r=this.inputs.shapeData,s=r.extractShapePointsToFlatArray([],i),a=r.shapeHoles.map((e=>{let t=e.extractShapePointsToFlatArray([],i),n=[];for(let i=t.length-1;i>=1;i-=2){let e=t[i-1],r=t[i-0];n.push(e,r)}return n}));try{e=WE({windingRule:n,elementType:yE.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[s]})}catch{e=ZE}try{t=WE({windingRule:gE.ODD,elementType:yE.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...a]})}catch{t=$E}if(!e)throw new Error("error generating geometry");let o=e.elementCount;if(t){e.elementCount+=t.elementCount;for(let i=0;i<t.elements.length;i++){let n=t.elements[i],r=i%2===0?e.vertexCount:0;e.elements.push(n+r)}for(let i=0;i<t.vertexIndices.length;i++){let n=t.vertexIndices[i],r=e.vertexCount;e.vertexIndices.push(n+r)}for(let i=0;i<t.vertices.length;i++){let n=t.vertices[i];e.vertices.push(n)}}let l=1/0,c=-1/0,h=1/0,d=-1/0;for(let p=0,f=e.vertexCount;p<f;p++){let t=2*p,i=e.vertices[t+0],n=e.vertices[t+1];i<l&&(l=i),i>c&&(c=i),n<h&&(h=n),n>d&&(d=n)}let u=[];for(let p=e.elementCount-1;p>=0;p--){let t=p>=o,i=2*p,n=e.elements[i+0],s=e.elements[i+1],a=n+s,l={start:n,count:s,normals:[],isHole:t,continuous:[],verticesStart:0,verticesCount:0};u.push(l);let c=n,h=a-1,d=n+1,f=r.roundedCurves.length;do{let i=c-n,o=e.vertices[2*h+0],u=e.vertices[2*h+1],p=e.vertices[2*c+0],m=e.vertices[2*c+1],g=e.vertices[2*d+0],v=e.vertices[2*d+1],y=p-o,b=m-u,A=Math.sqrt(y*y+b*b);y/=A,b/=A;let x=p-g,w=m-v,S=Math.sqrt(x*x+w*w);x/=S,w/=S,l.normals[2*i+0]=-w,l.normals[2*i+1]=x;let _=e.vertexIndices[c];if(Array.isArray(_))l.continuous[i]=!1;else{let[e,t]=r.getCurveIndexFromVertexId(_-1,!0);if(t>0&&t<1)l.continuous[i]=!0;else{let n=1===t?e+1:e-1;n=(n+f)%f;let s=1===t?0:1,a=r.roundedCurves[e].getTangent(t),o=r.roundedCurves[n].getTangent(s);l.continuous[i]=a.dot(o)>.95}}t&&(l.normals[2*i+0]*=-1,l.normals[2*i+1]*=-1),[h,c,d]=[c,d,d+1],d>=a&&(d-=s)}while(d!==n+1)}return{regions:[s,...a],infos:u,vertices:e.vertices}}_insertVertex(e,t,i,n,r){let s=2*t,a=3*t;e.positions[a+0]=i.x,e.positions[a+1]=i.y,e.positions[a+2]=i.z,e.normals[a+0]=n.x,e.normals[a+1]=n.y,e.normals[a+2]=n.z,e.uvs[s+0]=r.x,e.uvs[s+1]=r.y}_extrudeRegion(e,t,i,n,r,s,a){let o=new Vi,l=new Vi,c=new Vi,h=new Vi,d=new pi;i.forEach(((s,a)=>{let u=n[a],p=e.verticesStart*i.length+e.verticesCount*a;for(let n=0;n<e.count;n++){let f=2*(e.start+n);if(o.set(t[f+0],t[f+1],0),c.copy(o).applyMatrix4(s).add(u),e.continuous[n])h.set(e.normals[2*n+0],e.normals[2*n+1],0);else{let i=0===n?2*(e.start+e.count-1):f-2;l.set(t[i+0],t[i+1],0),h.copy(o).sub(l),h.set(-h.y,h.x,0),e.isHole||h.negate()}if(h.applyMatrix4(s).normalize(),d.set(0===n?1:n/e.count,a/(i.length-1)),this._insertVertex(r,p,c,h,d),p++,!e.continuous[n]||0===n){if(0===n)h.set(e.normals[2*n+0],e.normals[2*n+1],0),d.set(0,a/(i.length-1));else{let i=n===e.count-1?2*e.start:f+2;l.set(t[i+0],t[i+1],0),h.copy(l).sub(o),h.set(-h.y,h.x,0),e.isHole||h.negate()}h.applyMatrix4(s).normalize(),this._insertVertex(r,p,c,h,d),p++}}}));let u=i.length-1;for(let p=0;p<u;p++){let t=e.verticesStart*i.length+e.verticesCount*p,n=e.verticesStart*i.length+e.verticesCount*(p+1),r=0;for(let i=0;i<e.count;i++){(!e.continuous[i]||0===i)&&r++;let a=i===e.count-1?0:r+1,o=t+r,l=t+a,c=n+a,h=n+r;e.isHole?s.push(o,c,l,o,h,c):s.push(o,l,c,o,c,h),r++}}}_closeEnd(e,t,i,n,r,s,a){let o=e.vertexCount,l=new Vi(0,0,a?-1:1).applyMatrix4(r),c=new Vi,h=new pi;for(let u=0;u<o;u++){let i=2*u;c.set(e.vertices[i+0],e.vertices[i+1],0).applyMatrix4(r).add(s),this._insertVertex(n,t+u,c,l,h)}let d=e.elements;for(let u=0;u<e.elementCount;u++){let e=3*u,n=d[e+0]+t,r=d[e+(a?1:2)]+t,s=d[e+(a?2:1)]+t;i.push(n,r,s)}}applyMatrix4OnRange(e,t,i){let n,r,s,a,o=e.elements,l=(new fi).getNormalMatrix(e).elements,c=this.attributes.position,h=this.attributes.normal;if(!c||!h)return;let d=c.array,u=h.array,p=c.itemSize;for(let f=t*p,m=i*p;f<m;f+=p)n=d[f+0],r=d[f+1],s=d[f+2],a=1/(o[3]*n+o[7]*r+o[11]*s+o[15]),d[f+0]=(o[0]*n+o[4]*r+o[8]*s+o[12])*a,d[f+1]=(o[1]*n+o[5]*r+o[9]*s+o[13])*a,d[f+2]=(o[2]*n+o[6]*r+o[10]*s+o[14])*a,n=u[f+0],r=u[f+1],s=u[f+2],u[f+0]=l[0]*n+l[3]*r+l[6]*s,u[f+1]=l[1]*n+l[4]*r+l[7]*s,u[f+2]=l[2]*n+l[5]*r+l[8]*s;c.needsUpdate=!0,h.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let n=e;n<t;n+=3){let e=i.getX(n),t=i.getX(n+1),r=i.getX(n+2);i.setXYZ(n,r,t,e)}i.needsUpdate=!0}}};function hM(){let e=new yr;return e.setAttribute("position",new or(new Float32Array([]),3)),e.setIndex(new or(new Uint16Array([]),1)),e}var dM=hM().attributes,uM=class extends yr{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,dM),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i?.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then((()=>{this.update(e),t?.requestRender()}))}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!t?.isLoaded)return void console.warn("Cannot update text because its font is not loaded");let{width:i,height:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=e,c=Ox.getDisplayedValue(o),h=function(e,t,i){let n=[""],r="";for(let s of i)r+=s," "===s||"\n"===s?(n[n.length-1]+=r,r="","\n"===s&&n.push("")):t.getTextWidth(n[n.length-1]+r,e)>e.width&&(n[n.length-1].length&&n.push(""),t.getTextWidth(n[n.length-1]+r,e)>e.width&&(1===r.length?(n[n.length-1]+=r,r=""):(n[n.length-1]+=r.slice(0,-1),r=r[r.length-1],n.push(""))));return n[n.length-1]+=r,n}(e,t,2===l?c.toUpperCase():3===l?c.toLowerCase():c),{shapes:d,charWidths:u,charCoords:p}=t.generateShapes(h,e),f=.5*("number"==typeof i?i:1),m=.5*("number"==typeof n?n:1),g=d.map((e=>(new EE).fromShape(e,!0)));this.vectorShapes=g;let v=g.map((e=>sC.create({shape:e,parameters:{depth:r,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:r<=0?gE.NONZERO:gE.ODD,subdivisions:this.isLowResolution&&r>0?1:12}}))),y=v.length?Dw(v):hM();y.translate(-f,m,0),this.dispose(),this.wrappedText=h,this.charCoords=p,this.charWidths=u,this.deleteAttribute("extrudeNormal"),Object.entries(y.attributes).forEach((e=>{let[t,i]=e;this.setAttribute(t,i)})),this.setIndex(y.index),this.computeBoundingSphere()}clone(){let e=kg(new yr,uM.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach((e=>{let[t,i]=e;this.setAttribute(t,i)})),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:e}})}get text(){return this.userData.parameters.text??""}};var pM,fM,mM=new Promise((e=>{pM=e})),gM=!1;function vM(){if(!gM)return fM||(fM=async function(){let e=i.e(917).then(i.bind(i,917)),[t,n]=await Promise.all([e,fetch("https://unpkg.com/@splinetool/modelling-wasm@1.9.87/build/process.wasm").then((e=>e.arrayBuffer()))]),r=t.default,s=await r({wasmBinary:n});pM(s),gM=!0}(),fM)}var yM=["font"];function bM(e,t,i,n){let r,s,a;"PathGeometry"===e.type?(s=JSON.parse(JSON.stringify(e)),a=[[],["extrusion"]]):(s={...e},a=[[]]);for(let c of a){let e=s;for(let t of c)e=e[t];for(r in e){let i=e[r];_A(i)&&!yM.includes(r)&&(e[r]=t.getVariable(i,[n.uuid,"geometry",...c,r]),_A(e[r])&&(e[r]=1))}}let o,l={parameters:s,type:s.type};if("PathGeometry"===s.type)l.path=s.path;else if("VectorGeometry"===s.type){let e=EE.createFromState(s.shape,s.width,s.height);l.shape=e}else if("NonParametricGeometry"===s.type){if(s.data.groups&&s.data.groups?.forEach((e=>e.materialIndex=Math.max(e.materialIndex??0,0))),l.geometry=(new sh).parse(s),0===l.geometry.groups.length){let e=l.geometry;e.addGroup(0,Math.max(e.getIndex()?.count??0,e.getAttribute("position").count),0)}}else{if("SubdivGeometry"===s.type){let t=new TM(s,i);return t.data=e,t}if("TextGeometry"===s.type)return new uM(s,t);if("InputGeometry"===s.type)return new uM(s,t);if("UIGeometry"===s.type)return VC.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}try{o=ZM(l)}catch(dA){console.error(dA)}if(!o){let e=EE.createFromState(HA.defaultData(),100,100);l.shape=e,o=ZM(l)}return o}var AM=new bn;function xM(e,t,i,n){let r,s,a,o=e.position.array,l=e.normal.array,c=AM.makeScale(t,i,n).invert().elements;for(var h=0,d=o.length;h<d;h+=3)o[h]*=t,o[h+1]*=i,o[h+2]*=n,r=l[h],s=l[h+1],a=l[h+2],l[h]=c[0]*r+c[4]*s+c[8]*a,l[h+1]=c[1]*r+c[5]*s+c[9]*a,l[h+2]=c[2]*r+c[6]*s+c[10]*a;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var wM,SM=new Wi,_M=new Vi;mM.then((e=>{wM=e}));var EM=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),CM=new Uint32Array([0,1,2,3]),MM=new Uint8Array([4]),TM=class extends yr{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,n=iA.div(t,i);this.subdividedGeometry&&xM(this.subdividedGeometry.attributes,...n),this.originalGeometry&&xM(this.originalGeometry.attributes,...n),this.data=e;let r=this.userData.parameters;this.userData.parameters={width:r.width*n[0],height:r.height*n[1],depth:r.depth*n[2]},this.originalGeometry.boundingSphere.center.multiply(_M.fromArray(n));let s=_M.set(r.width,r.height,r.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return 0===this.subdivPointer&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=TM.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new Lr(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let n=this.subdividedGeometry??this.originalGeometry;Object.assign(this,n),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(TM.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new hn,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;SM.setFromBufferAttribute(t),SM.getCenter(i),e.boundingSphere.radius=i.distanceTo(SM.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),SM.getSize(_M);let n={width:_M.x,height:_M.y,depth:_M.z};return this.userData.parameters=n,n}static build(e,t,i,n){let r,s,a,o=e?.phongAngle??35;!1===i&&(o=-1),t&&(wM.free_bvh(t),wM.free_subdivision_surface(t));try{r=TM.allocate(e,n)}catch(l){console.error(l,e),r=TM.allocate({positionWASM:EM,indexWASM:CM,verticesPerFaceWASM:MM},n)}if(wM.set_destination_refinement_level(r,0),s=TM.buildLevel(r,!0,o),e.subdivisions>0)try{wM.set_destination_refinement_level(r,e.subdivisions),a=TM.buildLevel(r,!1,o)}catch{try{wM.set_destination_refinement_level(r,e.subdivisions-1),a=TM.buildLevel(r,!1,o)}catch{a=null}}else a=null;return{subdivPointer:r,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),"DodecahedronGeometry"===e.type&&(e.detail=0);let n,r,s,a,o,l,c=void 0!==e.shape||void 0!==e.path?t.geometry:bM(e,i,!1);if(n="TorusGeometry"===e.type&&e.arc===2*Math.PI?c.getClosedTorusIndicesForBooleanOrSubdiv():c.getIndex(),({positions:r,triIndices:o}=PM(c.getAttribute("position"),n)),"CylinderGeometry"===e.type&&0===e.cornerRadius&&0===e.hollow&&!1===e.openEnded){let t=e.radialSegments*e.heightSegments*3*2;l=[t,t+3*e.radialSegments]}return({indices:s,verticesPerFace:a}=OM(r,o,c,l)),{positions:r,indices:s,verticesPerFace:a}}static allocate(e,t){let i,n,r,s=[],a=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,n=e.indexWASM,r=e.verticesPerFaceWASM):(i=EM,n=CM,r=MM);let o,l=i.length,c=n.length,h=r.length,d=i.length+s.length+a.length,u=n.length+r.length,p=d*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,f=d*Float32Array.BYTES_PER_ELEMENT,m=(Uint32Array.BYTES_PER_ELEMENT,wM._malloc(p)),g=new Float32Array(wM.HEAPF32.buffer,m,d),v=new Uint32Array(wM.HEAPU32.buffer,m+f,u);g.set(i,0),g.set(s,i.length),g.set(a,i.length+s.length),v.set(n,0),v.set(r,n.length),e?.scaleBaked?.some((e=>1!==e))&&(o=(new bn).makeScale(...e.scaleBaked)),t&&(o?o.premultiply(t):o=t);let y=o?wM.alloc_subdivision_surface2(m,l,m+f,c,m+f+n.length*Uint32Array.BYTES_PER_ELEMENT,h,o.elements):wM.alloc_subdivision_surface(m,l,m+f,c,m+f+n.length*Uint32Array.BYTES_PER_ELEMENT,h);return wM._free(m),y}static buildLevel(e,t,i,n,r){let s=r?wM.get_mesh_data2(e,t?wM.Level.CONTROL:wM.Level.REFINED,i,r.elements):wM.get_mesh_data(e,t?wM.Level.CONTROL:wM.Level.REFINED,i),a=wM.HEAPU32.subarray(s>>2,8+(s>>2)),o=a.subarray(4,8),l=0,c=wM.HEAPU32[a[l]>>2],h=wM.HEAPF32.subarray(c>>2,(c>>2)+o[l]);l++;let d=wM.HEAPU32[a[l]>>2],u=wM.HEAPF32.subarray(d>>2,(d>>2)+o[l]);l++;let p=wM.HEAPU32[a[l]>>2],f=wM.HEAPU32.subarray(p>>2,(p>>2)+o[l]);l++;let m=wM.HEAPU32[a[l]>>2],g=wM.HEAPU32.subarray(m>>2,(m>>2)+o[l]);if(l++,void 0===n){let e=new yr;if(e.setIndex(new cr(g,1)),e.setAttribute("position",new hr(h,3)),e.setAttribute("normal",new hr(u,3)),t){e.setAttribute("faceMap",new cr(f,1));let t=new Float32Array(u.length/3*4).fill(0);e.setAttribute("color",new or(t,4))}return wM.free_mesh_data(s),e.userData.type="SubdivGeometry",e}n.getAttribute("position").copyArray(h),n.getAttribute("normal").copyArray(u),n.attributes.position.needsUpdate=!0,n.attributes.normal.needsUpdate=!0,wM.free_mesh_data(s)}static freeSubdivPointer(e){wM.free_bvh(e),wM.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let n=wM.get_wireframe_data_for_base_level(e),r=wM.HEAPU32.subarray(n>>2,4+(n>>2)),s=r.subarray(2,4),a=0,o=wM.HEAPU32[r[a]>>2],l=wM.HEAPF32.subarray(o>>2,(o>>2)+s[a]);a++;let c=wM.HEAPU32[r[a]>>2],h=wM.HEAPU32.subarray(c>>2,(c>>2)+s[a]);if(void 0===t){let e=new yr;e.setAttribute("position",new hr(l,3));let t=new Float32Array(l.length);for(let n=0,r=l.length;n<r;)t[n++]=i.r,t[n++]=i.g,t[n++]=i.b;return e.setAttribute("color",new or(t,3)),e.setIndex(new cr(h,1)),wM.free_wireframe_data_for_base_level(n),e}t.getAttribute("position").copyArray(l),t.attributes.position.needsUpdate=!0,wM.free_wireframe_data_for_base_level(n)}static updateCollabMesh(e,t,i){let n=0===t;n||wM.set_destination_refinement_level(e,t);let r=i?wM.get_topological_data2(e,n?wM.Level.CONTROL:wM.Level.REFINED,i.elements):wM.get_topological_data(e,n?wM.Level.CONTROL:wM.Level.REFINED),s=wM.HEAPU32.subarray(r>>2,6+(r>>2)),a=s.subarray(3,6),o=0,l=wM.HEAPU32[s[o]>>2],c=new Float32Array(wM.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let h=wM.HEAPU32[s[o]>>2],d=new Uint32Array(wM.HEAPU32.subarray(h>>2,(h>>2)+a[o]));o++;let u=wM.HEAPU32[s[o]>>2],p=new Uint8Array(wM.HEAPU32.subarray(u>>2,(u>>2)+a[o]));return wM.free_topological_data(r),{positions:c,indices:d,verticesPerFace:p}}},IM=["getX","getY","getZ"];function PM(e,t){let i={},n=t?t.count:e.count,r=0,s=[],a=[];for(let l=0;l<n;l++){let n=t?t.getX(l):l,o="";for(let t=0;t<3;t++)o+=~~(1e4*e[IM[t]](n))+",";if(o in i)s.push(i[o]);else{for(let t=0;t<3;t++)a.push(e[IM[t]](n));i[o]=r,s.push(r),r++}}let o=[];for(let l=0;l<s.length;l+=3)s[l]===s[l+1]||s[l]===s[l+2]||s[l+1]===s[l+2]||o.push(s[l],s[l+1],s[l+2]);return{positions:a,triIndices:o}}var DM=new Vi,RM=new Vi,BM=new Vi,LM=new Vi;function OM(e,t,i,n){let r=[],s=[];if(void 0!==i.userData.shape&&0===i.userData.parameters.depth&&0===i.userData.shape.shapeHoles.length){let t=i.userData.shape.extractShapePointsToFlatArray([]),n=i.userData.parameters.spikes;if("EllipseGeometry"===i.userData.type&&n<=24&&n%4===0&&i.userData.parameters.angle>=360){let e=t.length/2/n;t=t.filter(((t,i)=>Math.floor(i/2)%e===0))}let a=0;for(let e=0;e<t.length;e+=2)a+=(t[e]-t[(0===e?t.length:e)-2])*(t[e+1]+t[(0===e?t.length:e)-1]);e.length=0;let o=0;if(a<0)for(let i=0;i<t.length;i+=2)e.push(t[i],t[i+1],0),r.push(o++);else for(let i=t.length-2;i>=0;i-=2)e.push(t[i],t[i+1],0),r.push(o++);return s.push(o),{indices:r,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let i=0;if((e[3*t[o]+2]===a||0===e[3*t[o]+2])&&i++,(e[3*t[o+1]+2]===a||0===e[3*t[o+1]+2])&&i++,(e[3*t[o+2]+2]===a||0===e[3*t[o+2]+2])&&i++,3===i)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){DM.set(e[3*t[o]],e[3*t[o]+1],e[3*t[o]+2]),RM.set(e[3*t[o+1]],e[3*t[o+1]+1],e[3*t[o+1]+2]),BM.set(e[3*t[o+4]],e[3*t[o+4]+1],e[3*t[o+4]+2]),LM.set(e[3*t[o+5]],e[3*t[o+5]+1],e[3*t[o+5]+2]),RM.sub(DM).normalize(),BM.sub(DM).normalize(),LM.sub(DM).normalize();let i=RM.cross(BM).dot(LM);Math.abs(i)>.005||n&&n.some(((e,t)=>t%2!==1&&(o>=n[t]&&o<n[t+1])))?(r.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(r.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else r.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let t=[],n=[],o=0;for(let i=0,r=0;i<e.length;i+=3,r++)0===e[i+2]&&(t.push(r),o++),e[i+2]===a&&n.push(r);if(0===i.userData.parameters.extrudeBevelSize){let e=n[0];n[0]=n[1],n[1]=e}t.reverse(),r.push(...t,...n),s.push(o,o)}return{indices:r,verticesPerFace:s}}var NM={};((e,t)=>{for(var i in t)a(e,i,{get:t[i],enumerable:!0})})(NM,{calcBoolean:()=>QM,calcBooleanTopological:()=>WM,freeMeshSet:()=>KM,getMeshSet:()=>qM,hasOpenEdges:()=>XM,transformMeshSet:()=>YM});var kM,FM,UM,zM,jM=new Promise((e=>{kM=e}));function VM(){if(FM)return FM;return FM=async function(){let e=i.e(516).then(i.bind(i,3516)),[t,n]=await Promise.all([e,fetch("https://unpkg.com/@splinetool/boolean-wasm@1.9.87/build/boolean.wasm").then((e=>e.arrayBuffer()))]),r=t.default,s=await r({wasmBinary:n});kM(s)}(),FM}function GM(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,n=t*Float32Array.BYTES_PER_ELEMENT,r=Number.isInteger(e[0])?i:n,s=UM._malloc(r);return(Number.isInteger(e[0])?new Uint32Array(UM.HEAPU32.buffer,s,t):new Float32Array(UM.HEAPF32.buffer,s,t)).set(e,0),s}function HM(e){switch(e){case 0:return UM.OP.UNION;case 1:return UM.OP.INTERSECTION;case 2:return UM.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+e)}}function WM(e,t){void 0===zM&&(zM=UM.init_csg());let i=GM(e),n=UM.csg_calc_topological(zM,i,e.length,HM(t));UM._free(i);let r=UM.HEAPU32.subarray(n>>2,6+(n>>2)),s=r.subarray(3,6),a=0,o=UM.HEAPU32[r[a]>>2],l=new Float32Array(UM.HEAPF32.subarray(o>>2,(o>>2)+s[a]));a++;let c=UM.HEAPU32[r[a]>>2],h=new Uint32Array(UM.HEAPU32.subarray(c>>2,(c>>2)+s[a]));a++;let d=UM.HEAPU32[r[a]>>2],u=new Uint8Array(UM.HEAPU32.subarray(d>>2,(d>>2)+s[a]));return UM.free_mesh_data(n),{positions:l,indices:h,verticesPerFace:u}}function QM(e,t,i,n){void 0===zM&&(zM=UM.init_csg());let r=GM(e),s=UM.csg_calc(zM,r,e.length,n,HM(t));UM._free(r);let a=UM.HEAPU32.subarray(s>>2,5+(s>>2)),o=a.subarray(2,5),l=0,c=UM.HEAPU32[a[l]>>2],h=UM.HEAPF32.subarray(c>>2,(c>>2)+o[l]);l++;let d=UM.HEAPU32[a[l]>>2],u=UM.HEAPF32.subarray(d>>2,(d>>2)+o[l]);l++;let p=o[l];i.setAttribute("position",new hr(h,3)),i.setAttribute("normal",new hr(u,3));let f=UM.HEAPF32.subarray(5+(s>>2),5+(s>>2)+6);return null===i.boundingSphere&&(i.boundingSphere=new hn),i.boundingSphere.center.set(f[0],f[1],f[2]),i.boundingSphere.radius=(f[3]**2+f[4]**2+f[5]**2)**.5,i.userData.parameters={width:2*f[3],height:2*f[4],depth:2*f[5]},UM.free_mesh_data(s),p}function qM(e,t,i){if(void 0===UM)return-1;let n,r,s;if(t&&void 0!==e.userData.positions){let t=e.userData;s=t.verticesPerFace.length,n=t.positions,r=Array(t.verticesPerFace.reduce(((e,t)=>e+t),0)+s);for(let e=0,i=0,n=0;e<t.verticesPerFace.length;e++){r[n++]=t.verticesPerFace[e];for(let s=0;s<t.verticesPerFace[e];s++)r[n++]=t.indices[i++]}}else({positions:n,faceIndices:r,nFaces:s}=function(e,t,i){let n,r;r="TorusGeometry"===e.userData.parameters.type&&e.userData.parameters.arc===2*Math.PI?e.getClosedTorusIndicesForBooleanOrSubdiv():e.getIndex();let s,{positions:a,triIndices:o}=PM(e.getAttribute("position"),r);if(t&&i){let{indices:t,verticesPerFace:i}=OM(a,o,e);s=i.length,n=[];for(let e=0,r=0;e<s;e++){n.push(i[e]);for(let s=0;s<i[e];s++)n.push(t[r++])}}else{let e=o.length;n=Array(e+e/3),s=0;for(let t=0,i=0;i<n.length;)n[i++]=3,s++,n[i++]=o[t++],n[i++]=o[t++],n[i++]=o[t++]}return{positions:a,faceIndices:n,nFaces:s}}(e,t,i));let a=n.length,o=r.length,l=n.length,c=r.length,h=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,d=l*Float32Array.BYTES_PER_ELEMENT,u=(Uint32Array.BYTES_PER_ELEMENT,UM._malloc(h)),p=new Float32Array(UM.HEAPF32.buffer,u,l),f=new Uint32Array(UM.HEAPU32.buffer,u+d,c);p.set(n,0),f.set(r,0);let m=UM.get_csg_mesh(u,a,u+d,o,s);return UM._free(u),m}function XM(e){return UM.has_open_edges(e)}function YM(e,t){UM.transform_csg_mesh(e,t.elements)}function KM(e){UM.free_csg_mesh(e)}jM.then((e=>UM=e));var JM={ConeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=ui.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let t,{width:i,depth:n,height:r,radialSegments:s,heightSegments:a,openEnded:o,thetaStart:l,thetaLength:c,cornerRadiusTop:h,cornerRadiusBottom:d,cornerSegments:u}=e.parameters;return 0===c?(t=new yr,t.setAttribute("position",new hr([],3))):t=h>0||d>0||c<360?new F_(0,i/2,r,s,a,o,l,c*Math.PI/180,h,d,u,0,!0):new Dl(i/2,r,s,a,o),t.scale(1,1,n/i),Object.assign(t,{userData:{...e,type:"ConeGeometry"}})}},CubeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let t,{width:i,height:n,depth:r,widthSegments:s,heightSegments:a,depthSegments:o,cornerRadius:l,cornerSegments:c}=e.parameters;return t=0===l?new Lr(i,n,r,s,a,o):new z_(i,n,r,s,a,o,l,c),Object.assign(t,{userData:{...e,type:"CubeGeometry"}})}},CylinderGeometry:O_,DodecahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,detail:r,corner:s,cornerSides:a}=e.parameters,o=0===r&&0!==s?new V_(.5*t,s,a):new Bl(.5*t,r);return o.scale(1,i/t,n/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},EllipseGeometry:oC,HelixGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??n),s=Math.abs(i.depth??n),a=Math.abs(Math.min(n,s))/2;return{parameters:Object.assign(i,{width:n,height:r,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:n,radius:r,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:h,cornerSegments:d}=e.parameters,u=new mC(!1,t,i,n,r,s,a,o,l,c,h,d);return Object.assign(u,{userData:{...e,type:"HelixGeometry"}})}},IcosahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,detail:r,corner:s,cornerSides:a}=e.parameters,o=0===r&&0!==s?new gC(.5*t,s,a):new cc(.5*t,r);return o.scale(1,i/t,n/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},LatheGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){(e.parameters?.points??[]).forEach((e=>{Array.isArray(e)&&(e.x=e[0],e.y=e[1])}));let i=Object.assign({},t?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:n}=e.parameters,r=new Ll;r.moveTo(t[0].x,t[0].y),r.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new Il(r.extractPoints(n).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},NonParametricGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i,n=e.geometry??t?.geometry??(new yr).copy(new Lr(100,100,100));void 0===t?(n.computeBoundingBox(),n.boundingBox.getSize(NC),i={width:NC.x,height:NC.y,depth:NC.z,subdivisions:0}):i=t.parameters;let r={...i,...e.parameters};return{parameters:{width:Math.abs(r.width),height:Math.abs(r.height),depth:Math.abs(r.depth),subdivisions:Math.abs(r.subdivisions)},geometry:n}}static build(e){let{width:t,height:i,depth:n,subdivisions:r}=e.parameters,s=e.geometry??(new yr).copy(new Lr(100,100,100)),a=s.userData.parameters;void 0===a?(s.computeBoundingBox(),s.boundingBox.getSize(NC)):NC.set(a.width,a.height,a.depth),(t!==NC.x||i!==NC.y||n!==NC.z)&&s.scale(0===NC.x?1:t/NC.x,0===NC.y?1:i/NC.y,0===NC.z?1:n/NC.z);let o=s.originalGeometry;try{r>0?(void 0===o||a?.subdivisions!==r)&&(void 0===o&&(o=s),s=new OC(r).modify(o).toBufferGeometry()):(void 0!==o&&(s=o),o=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals())}catch{void 0!==o&&(s=o),o=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals()}return void 0!==o&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new sh(i).load(e,(e=>{let i=this.normalizeInputs({geometry:e});e.boundingBox.getSize(NC);let n=100/NC.x;Object.assign(i.parameters,{width:100,height:NC.y*n,depth:NC.z*n}),t(this.build(i))}))}},PolygonGeometry:kC,PyramidGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,radialSegments:r,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=new jC(.5*t,i,r,s,a,o,l);return c.scale(1,1,n/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}},RectangleGeometry:VC,SphereGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=ui.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let t,{width:i=100,height:n=i,depth:r=i,widthSegments:s=64,heightSegments:a=64,phiStart:o,phiLength:l,thetaStart:c,thetaLength:h}=e.parameters;return 0===h?(t=new yr,t.setAttribute("position",new hr([],3))):t=new hc(.5*i,s,a,o,l,c,h*ui.DEG2RAD),t.scale(1,n/i,r/i),Object.assign(t,{userData:{...e,type:"SphereGeometry"}})}},PlaneGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:n=8,heightSegments:r=8}=e.parameters,s=new ts(t,i,n,r);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},BackdropGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:n,angle:r,cornerRadius:s,cornerSegments:a}=e.parameters,o=new GC(t,i,n,r,s,a);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},StarGeometry:HC,TextFrameGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,n=new ts(t,i);return Object.assign(n,{userData:{...e,type:"TextFrameGeometry"}})}},TorusGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width);i.shapeBlendNode&&(r=n);let s=Math.round(Math.abs(i.depth??.25*i.width));return{parameters:Object.assign(i,{width:n,height:r,depth:s})}}static build(e){let{width:t,height:i,depth:n,radialSegments:r,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=function(e,t,i,n,r,s,a,o,l,c,h){[t,i]=[i,t],a=t/2;let d=ui.clamp(r/360,0,1);if(0===d){let e=new yr;return e.setAttribute("position",new hr([],3)),e}return 1===d&&(c=0),new mC(!0,e,t,i,n,d,s,a,o,l,c,h)}(t,i,n,.5*t,a,s,0,0,r,o,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}},TorusKnotGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??.125*i.width})}}static build(e){let{width:t,tube:i,tubularSegments:n,radialSegments:r,p:s,q:a}=e.parameters,o=.5*t;o!==i&&(o-=i);let l=new uc(o,i,n,r,s,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},TriangleGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof EE?e.shape:new EE,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=e.parameters,l=e.shape,c=.5*t,h=.5*i;o?(l.addPoint(l.createPoint(-c,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))):(l.addPoint(l.createPoint(0,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))),l.isClosed=!0;for(let u=0,p=l.points.length;u<p;u++)l.points[u].roundness=n;l.roundness=n,l.update();let d=sC.create({shape:l,parameters:{roundness:n,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(d,{userData:{...e,type:"TriangleGeometry"}})}},PathGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},t?.parameters??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),n=Math.abs(i.width),r=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=t?.shapeData??oC.create({parameters:YA}).userData.shape;return{path:e.path??WA.defaultData(),parameters:Object.assign(i,{width:n,height:r,depth:s,extrusion:{...$A,...i.extrusion}}),shapeData:a}}static build(e){if(e.path.points.length>=2){let t=new cM(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}return Object.assign(new yr,{userData:{...e,type:"PathGeometry"}})}},VectorGeometry:sC},ZM=e=>JM[e.type].create(e);function $M(e){return null!==e&&"booleanOp"in e}var eT=class extends(L_(Rr)){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new bn}updateVisible(e){super.updateVisible(e),this.visible=!$M(this.parent)&&this.visible,$M(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){-1!==this.booleanMeshSetAddress&&(NM.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.booleanWasTransformed=!0:this.freeBooleanPointer(),$M(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof eT&&(e.freeBooleanPointer(),$M(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&$M(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.onVariableUpdate(e),$M(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},tT=new Wi;function iT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.count,n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,h=-1/0;for(let d=t;d<i;d++){let t=e.getX(d),i=e.getY(d),n=e.getZ(d);t<s&&(s=t),i<a&&(a=i),n<o&&(o=n),t>l&&(l=t),i>c&&(c=i),n>h&&(h=n)}tT.min.set(s,a,o),tT.max.set(l,c,h),tT.getCenter(n),tT.getSize(r).multiplyScalar(.5)}var nT=new yr,rT=new rr,sT=class extends eT{constructor(e,t){super(nT,rT),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?iT(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},aT=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},null===aT.uuidContext)throw new Error("plz startContext");aT.uuidContext===aT.globalContext?this.uuid="_gid"+aT.uuidContext.nodeContextUuid++:this.uuid="_uid"+aT.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){null===this.uuidContext||this.uuidContext===aT.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let n={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),n}build(e,t,i){t=t??this.getType(e,t);let n=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,n,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,n,r,s){return""}generate(e,t,i,n,r){return""}parse(e,t,i,n){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let n=e.getTypeLength(i);(n>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=n,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type}},oT=aT;oT.globalContext={nodeContextUuid:0},oT.uuidContext=aT.globalContext;var lT=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},cT=new class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=void 0===i||i,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return void 0!==this.nodes[e]}containsKeyword(e){return void 0!==this.keywords[e]}},hT=class extends oT{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=void 0===t.shared||t.shared,this.unique=void 0!==t.unique&&t.unique}build(e,t,i,n){if(t=t??this.getType(e),this.getShared(e,t)){let r=this.getUnique(e,t);r&&void 0===this.uuid&&(this.uuid=ui.generateUUID()),i=e.getUUID(i??this.getUUID(),!r);let s=e.getNodeData(i),a=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(r)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||1===s.deps))return super.build(e,t,i);i=this.getUUID(!1);let o=this.getTemp(e,i);if(o)return e.format(o,a,t);{o=super.generate(e,t,i,s.output,n);let r=this.generate(e,a,i);return e.addNodeCode(o+" = "+r+";"),e.format(o,a,t)}}return super.build(e,t,i)}getShared(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,n,r){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,n??this.getType(e),r,this.getLabel()).name}},dT=class extends hT{constructor(e,t){(t=t??{}).shared=void 0!==t.shared&&t.shared,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,n,r,s){i=e.getUUID(i??this.getUUID()),n=n??this.getType(e);let a=e.getNodeData(i);return this.getReadonly()&&void 0!==this.generateReadonly?this.generateReadonly(e,t,i,n,r,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(n,this,r,s,this.getLabel())),e.format(a.vertex.name,n,t)):(a.fragment||(a.fragment=e.createFragmentUniform(n,this,r,s,this.getLabel())),e.format(a.fragment.name,n,t))}},uT=class extends dT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;super("v2"),this.nodeType="Vector2",this.value=e instanceof pi?e:new pi(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,n,r,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",n,t)}},pT=class extends dT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;super("v3"),this.nodeType="Vector3",this.value=e instanceof Vi?e:new Vi(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,n,r,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",n,t)}},fT=class extends Pi{constructor(e,t,i,n){super(e,t,i),this.isColorA=!0,this.a=n}setRGBA(e,t,i,n){super.setRGB(e,t,i),this.a=n}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"srgb";if("transparent"===e)return this.setRGBA(0,0,0,0),this;if(t=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let n,r=t[1],s=t[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a="rgba"===r?parseFloat(n[4]):1,super.setStyle(e,i);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a="hsla"===r?parseFloat(n[4]):1,super.setStyle(e,i)}}return super.setStyle(e,i)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},mT=class extends dT{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof fT?e:new fT(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,n,r,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",n,t)}},gT=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,vT=/[a-z_0-9]+/gi,yT=class extends hT{constructor(e,t,i,n,r){super(r),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=void 0===r,this.isInterface=!1,this.parse(e,t,i,n)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,n,r){let s,a=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;s=vT.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let t=l[c],i=t[0],n=!this.isMethod||!this.getInputByName(i),r=i;if(this.keywords[i]||this.useKeywords&&n&&cT.containsKeyword(i)){let t=this.keywords[i];if(!t){let n=cT.getKeywordData(i);n.cache&&(t=e.keywords[i]),t=t||cT.getKeyword(i,e),n.cache&&(e.keywords[i]=t)}r=t.build(e)}i!==r&&"."!==o[t.index+a-1]&&(o=o.substring(0,t.index+a)+r+o.substring(t.index+i.length+a),a+=r.length-i.length),void 0===this.getIncludeByName(r)&&cT.contains(r)&&e.include(cT.get(r))}return"source"===t?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,i,n){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=n??{},this.isMethod){let e=gT.exec(this.src);if(this.inputs=[],e&&4==e.length){this.type=e[1],this.name=e[2];let t=e[3].match(vT);if(t){let e=0;for(;e<t.length;){let i,n=t[e++];"in"===n||"out"===n||"inout"===n?i=t[e++]:(i=n,n="");let r=t[e++];this.inputs.push({name:r,type:i,qualifier:n})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},bT=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,AT=class extends hT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||AT.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,n,r){this.src=e||"";let s,a,o="",l=bT.exec(e);this.useDefine=r??"#"===this.src.charAt(0),l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if("source"===t){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,n,r){return e.format(this.name,this.getType(e),t)}},xT=AT;xT.PI="PI",xT.PI2="PI2",xT.RECIPROCAL_PI="RECIPROCAL_PI",xT.RECIPROCAL_PI2="RECIPROCAL_PI2",xT.LOG2="LOG2",xT.EPSILON="EPSILON";var wT=new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}","gim"),ST=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),_T=class extends hT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,n,r){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.src=e,this.inputs=[];let t=wT.exec(e);if(t){let e,i=t[2];for(;e=ST.exec(i);)this.inputs.push({type:e[1],name:e[2]});this.name=t[1]}else this.name="";this.type=this.name}},ET=class extends hT{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",n=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(n,this.getType(e),t)}};cT.addKeyword("uv",(function(){return new ET})),cT.addKeyword("uv2",(function(){return new ET(1)}));var CT=class extends hT{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??CT.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case zt:return["Linear"];case jt:return["sRGB"];default:return[]}}generate(e,t){let i=this.input.build(e,"v4"),n=this.getType(e),r=CT.Nodes[this.method],s=e.include(r);if(s===CT.LINEAR_TO_LINEAR)return e.format(i,n,t);if(2===r.inputs?.length){let r=this.factor.build(e,"f");return e.format(s+"( "+i+", "+r+" )",n,t)}return e.format(s+"( "+i+" )",n,t)}fromEncoding(e){let t=CT.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=CT.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},MT=CT;MT.Nodes={LinearToLinear:new yT(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),sRGBToLinear:new yT(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new yT(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n"))},MT.LINEAR_TO_LINEAR="LinearToLinear",MT.SRGB_TO_LINEAR="sRGBToLinear",MT.LINEAR_TO_SRGB="LinearTosRGB";var TT=class extends yT{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",arguments.length>4?arguments[4]:void 0,arguments.length>3?arguments[3]:void 0,arguments.length>2?arguments[2]:void 0,arguments.length>1?arguments[1]:void 0),this.nodeType="Expression"}},IT=class extends dT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ni,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new ET,this.bias=i,this.project=void 0!==n&&n}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if("sampler2D"===t)return this.getTexture(e,t);let i,n,r=this.getTexture(e,t),s=this.uv.build(e,this.project?"v4":"v2"),a=this.bias?this.bias.build(e,"f"):void 0;void 0===a&&e.context.bias&&(a=e.context.bias.setTexture(this).build(e,"f")),i=this.project?"texture2DProj":a?"tex2DBias":"tex2D",n=a?i+"( "+r+", "+s+", "+a+" )":i+"( "+r+", "+s+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new MT(new TT("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(e,l),e.removeContext(),e.format(n,l,t)}},PT=class extends dT{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,n,r,s){return e.format(this.value+(this.value%1?"":".0"),n,t)}},DT=class extends hT{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,n,r){n=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let t=0;t<s.inputs.length;t++){let i=s.inputs[t],n=this.inputs[t]||this.inputs[i.name];o.push(n.build(e,e.getTypeByFormat(i.type)))}a+=o.join(", ")+" )"}return e.format(a,n,t)}},RT=class extends hT{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:RT.ADD;super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let n=this.a.build(e,i),r=this.b.build(e,i);return e.format("( "+n+" "+this.op+" "+r+" )",i,t)}},BT=RT;BT.ADD="+",BT.SUB="-",BT.MUL="*",BT.DIV="/";var LT=class extends hT{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:LT.ABS,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;super(),this.nodeType="Math",this.a=e,"string"!=typeof t?this.b=t:n=t,"string"!=typeof i?this.c=i:n=i,this.method=n,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case LT.MIX:case LT.CLAMP:case LT.REFRACT:case LT.SMOOTHSTEP:case LT.FACEFORWARD:return 3;case LT.MIN:case LT.MAX:case LT.MOD:case LT.STEP:case LT.REFLECT:case LT.DISTANCE:case LT.DOT:case LT.CROSS:case LT.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,n=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>n?this.a.getType(e):i>n?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case LT.LENGTH:case LT.DISTANCE:case LT.DOT:return"f";case LT.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,n,r,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case LT.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case LT.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case LT.CROSS:i=this.a.build(e,"v3"),n=this.b.build(e,"v3");break;case LT.STEP:i=this.a.build(e,1===s?"f":l),n=this.b.build(e,l);break;case LT.MIN:case LT.MAX:case LT.MOD:i=this.a.build(e,l),n=this.b.build(e,1===a?"f":l);break;case LT.REFRACT:i=this.a.build(e,l),n=this.b.build(e,l),r=this.c.build(e,"f");break;case LT.MIX:i=this.a.build(e,l),n=this.b.build(e,l),r=this.c.build(e,1===o?"f":l);break;default:i=this.a.build(e,l),this.b&&(n=this.b.build(e,l)),this.c&&(r=this.c.build(e,l))}let h=[];h.push(i),n&&h.push(n),r&&h.push(r);let d=this.getNumInputs(e);if(h.length!==d)throw Error(`Arguments not match used in "${this.method}". Require ${d}, currently ${h.length}.`);return e.format(this.method+"( "+h.join(", ")+" )",c,t)}},OT=LT;OT.RAD="radians",OT.DEG="degrees",OT.EXP="exp",OT.EXP2="exp2",OT.LOG="log",OT.LOG2="log2",OT.SQRT="sqrt",OT.INV_SQRT="inversesqrt",OT.FLOOR="floor",OT.CEIL="ceil",OT.NORMALIZE="normalize",OT.FRACT="fract",OT.SATURATE="saturate",OT.SIN="sin",OT.COS="cos",OT.TAN="tan",OT.ASIN="asin",OT.ACOS="acos",OT.ARCTAN="atan",OT.ABS="abs",OT.SIGN="sign",OT.LENGTH="length",OT.NEGATE="negate",OT.INVERT="invert",OT.MIN="min",OT.MAX="max",OT.MOD="mod",OT.STEP="step",OT.REFLECT="reflect",OT.DISTANCE="distance",OT.DOT="dot",OT.CROSS="cross",OT.POW="pow",OT.MIX="mix",OT.CLAMP="clamp",OT.REFRACT="refract",OT.SMOOTHSTEP="smoothstep",OT.FACEFORWARD="faceforward";var NT=class extends hT{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,n){let r=new DT(NT.Nodes.bilinearCubeUV,[t,i,n]);this.colorSpaceTL=this.colorSpaceTL??new MT(new TT("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(r.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new MT(new TT("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(r.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new MT(new TT("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(r.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new MT(new TT("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(r.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new TT(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new TT(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new TT(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new TT(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new TT("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=r,a}generate(e,t){if(e.isShader("fragment")){let i=this.uv,n=this.bias||e.context.roughness,r=new DT(NT.Nodes.roughnessToMip,[n]),s=new OT(r,NT.Nodes.m0,NT.Nodes.cubeUV_maxMipLevel,OT.CLAMP),a=new OT(s,OT.FLOOR),o=new OT(s,OT.FRACT),l=this.bilinearCubeUV(e,this.value,i,a),c=this.bilinearCubeUV(e,this.value,i,new BT(a,new PT(1).setReadonly(!0),BT.ADD)),h=new OT(l,c,o,OT.MIX);return e.format(h.build(e),"v4",t)}return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},kT=NT;kT.Nodes=function(){let e=new _T("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),t=new xT("float cubeUV_maxMipLevel 8.0",!0),i=new xT("float cubeUV_minMipLevel 4.0",!0),n=new xT("float cubeUV_maxTileSize 256.0",!0),r=new xT("float cubeUV_minTileSize 16.0",!0),s=new yT("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");s.useKeywords=!1;let a=new yT("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");a.useKeywords=!1;let o=new yT("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[e,s,a,t,i,n,r]);o.useKeywords=!1;let l=new xT("float r0 1.0",!0),c=new xT("float v0 0.339",!0),h=new xT("float m0 -2.0",!0),d=new xT("float r1 0.8",!0),u=new xT("float v1 0.276",!0),p=new xT("float m1 -1.0",!0),f=new xT("float r4 0.4",!0),m=new xT("float v4 0.046",!0),g=new xT("float m4 2.0",!0),v=new xT("float r5 0.305",!0),y=new xT("float v5 0.016",!0),b=new xT("float m5 3.0",!0),A=new xT("float r6 0.21",!0),x=new xT("float v6 0.0038",!0),w=new xT("float m6 4.0",!0);return{bilinearCubeUV:o,roughnessToMip:new yT("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[l,c,h,d,u,p,f,m,g,v,y,b,A,x,w]),m0:h,cubeUV_maxMipLevel:t}}();var FT=class extends hT{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??FT.VIEW}getShared(){return this.scope===FT.WORLD}build(e,t,i,n){let r=e.context[this.scope+"Normal"];return r?r.build(e,t,i,n):super.build(e,t,i)}generate(e,t,i,n,r){let s;switch(this.scope){case FT.VIEW:s=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case FT.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case FT.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal")}return e.format(s,this.getType(e),t)}},UT=FT;UT.LOCAL="local",UT.WORLD="world",UT.VIEW="view",UT.NORMAL="normal",cT.addKeyword("viewNormal",(function(){return new UT(UT.VIEW)})),cT.addKeyword("localNormal",(function(){return new UT(UT.NORMAL)})),cT.addKeyword("worldNormal",(function(){return new UT(UT.WORLD)}));var zT=class extends hT{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??zT.LOCAL}getType(){return this.scope===zT.PROJECTION?"v4":this.type}getShader(){switch(this.scope){case zT.LOCAL:case zT.WORLD:return!1}return!0}generate(e,t,i,n,r){let s;switch(this.scope){case zT.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case zT.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case zT.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case zT.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(s,this.getType(),t)}},jT=zT;jT.LOCAL="local",jT.WORLD="world",jT.VIEW="view",jT.PROJECTION="projection",cT.addKeyword("position",(function(){return new jT})),cT.addKeyword("worldPosition",(function(){return new jT(jT.WORLD)})),cT.addKeyword("viewPosition",(function(){return new jT(jT.VIEW)}));var VT=class extends hT{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??VT.CUBE}getUnique(e){return!e.context.viewNormal}getType(){return this.scope===VT.SPHERE?"v2":this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let n;switch(this.scope){case VT.VECTOR:{let t=new UT(UT.VIEW),r=e.context.roughness,s=t.build(e,"v3"),a=new jT(jT.VIEW).build(e,"v3"),o=r?r.build(e,"f"):void 0,l=`reflect( -normalize( ${a} ), ${s} )`;o&&(l=`normalize( mix( ${l}, ${s}, ${o} * ${o} ) )`);let c=`inverseTransformDirection( ${l}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${c};`),n="reflectVec"):n=c;break}case VT.CUBE:{let t=new VT(VT.VECTOR).build(e,"v3"),r="vec3( -"+t+".x, "+t+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${r};`),n="reflectCubeVec"):n=r;break}case VT.SPHERE:{let t="normalize( ( viewMatrix * vec4( "+new VT(VT.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${t};`),n="reflectSphereVec"):n=t;break}}return e.format(n,this.getType(),t)}return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},GT=VT;GT.CUBE="cube",GT.SPHERE="sphere",GT.VECTOR="vector";var HT=class extends hT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new IT,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new kT(this.value,t??new GT(GT.VECTOR),i),this.irradianceNode=new kT(this.value,new UT(UT.WORLD),new PT(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},WT=class extends dT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hr,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new GT,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){if("samplerCube"===t)return this.getTexture(e,t);let i,n=this.getTexture(e,t),r=this.uv?.build(e,"v3"),s=this.bias?this.bias.build(e,"f"):void 0;void 0===s&&e.context.bias&&(s=e.context.bias.setTexture(this).build(e,"f")),i=s?"texCubeBias( "+n+", "+r+", "+s+" )":"texCube( "+n+", "+r+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new MT(new TT("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(i),i=this.colorSpace.build(e,o),e.removeContext(),e.format(i,o,t)}},QT=["x","y","z","w"],qT=["float","vec2","vec3","vec4"],XT={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},YT={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},KT=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(e,t){return e.deps.length-t.deps.length}return function(t,i){let n=this.getIncludes(t,i);if(!n)return"";let r="";n=n.sort(e);for(let e=0;e<n.length;e++)n[e].src&&(r+=n[e].src+"\n");return r}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join("\n"),fragment:["float accumAlpha = 0.0;","void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}",""].join("\n")},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode("\nuniform int frameIndex;\nuniform vec2 resolution;\nuniform mat4 previousModelViewMatrix;\nuniform mat4 previousProjectionMatrix;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n"),this.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n\nuniform int frameIndex;\nuniform vec2 resolution;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos) {\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\n"),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let e=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+e+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+e+";"),this.addVertexFinalCode("vUv"+e+" = uv"+e+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("\n\t\t\t\t#ifndef SHAPEBLEND \n\t\t\t\t\tvObjectNormal = normal;\n\t\t\t\t#else\n\t\t\t\t\tvObjectNormal = objectNormal;\n\t\t\t\t#endif\n\t\t\t")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode("\n// TODO: This could be generated CPU side and passed to the shader every frame\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\n// TODO: Pass correct view size\nvec2 offset = haltonSequence[frameIndex];\noffset.x /= resolution.x;\noffset.y /= resolution.y;\n\nvec4 currentPosition = gl_Position;\nvec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);\n\n// We want to calculate the velocity with unjittered positions\n// so that things that are not moving get a velocity = 0\nvCurrentPosition = currentPosition;\nvPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);\n#ifdef OUTLINE_COMPENSATION\nvPreviousPosition.xy += OUTLINE_COMPENSATION;\n#endif\ngl_Position = currentPositionJittered;\n\n"),this.addFragmentFinalCode("\nvec2 oldPos = vPreviousPosition.xy;\n    oldPos /= vPreviousPosition.w;\n    oldPos.xy = (oldPos.xy+1.)/2.0;\n\nvec2 newPos = vCurrentPosition.xy;\n    newPos /= vCurrentPosition.w;\n    newPos.xy = (newPos.xy+1.)/2.0;\n\nvec2 velocity = (newPos - oldPos);\n\n// Discard fully transparent pixels \nif (gl_FragColor.a <= 0.0) discard;\n\ngVelocity = vec4(velocity, 0.0, 1.0);\n")),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){void 0===this.fragmentVariables[e]&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){void 0===this.fragmentParsVariables[e]&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){void 0===this.vertexParsVariables[e]&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+"\n"}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+"\n"}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+"\n"}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+"\n"}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return-1!==this.caches.indexOf(e)}isSlot(e){return-1!==this.slots.indexOf(e)}define(e,t){this.defines[e]=void 0===t?1:t}require(e){this.requires[e]=!0}isDefined(e){return void 0!==this.defines[e]}getVar(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"varying",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"V",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",a=this.getVars(n),o=a[e];if(!o){let n=a.length;o={name:i||"node"+r+n+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,i,n){return this.getVar(e,t,i,this.shader,"T",n)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")}getVarListCode(e,t){t=t??"";let i="";for(let n=0,r=e.length;n<r;++n){let r=e[n],s=r.type,a=r.name,o=r.size,l=this.getFormatByType(s);if(void 0===l)throw new Error("Node pars "+l+" not found.");l.includes("[]")?i+=t+" "+l.substring(0,l.length-2)+" "+a+`[${o}];\n`:i+=t+" "+l+" "+a+";\n"}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof oT?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,n,r,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new lT({type:t,size:i.size,name:n||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:r});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}{let a=this.inputs.uniforms,o=a.list.length,l=new lT({type:t,name:n||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:r});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,n,r){return this.createUniform("vertex",e,t,i,n,r)}createFragmentUniform(e,t,i,n,r){return this.createUniform("fragment",e,t,i,n,r)}include(e,t,i){let n;if(e="string"==typeof e?cT.get(e):e,!1===this.context.include)return e.name;e instanceof yT?n=this.includes.functions:e instanceof xT?n=this.includes.consts:e instanceof _T&&(n=this.includes.structs);let r=n[this.shader]=n[this.shader]||[];if(e){let n=r[e.name];if(n||(n=r[e.name]={node:e,deps:[]},r.push(n),n.src=e.build(this,"source")),e instanceof yT&&t&&r[t.name]&&-1===r[t.name].deps.indexOf(e)&&(r[t.name].deps.push(e),e.includes?.length)){let i=0;do{this.include(e.includes[i++],t)}while(i<e.includes.length)}return i&&(n.src=i),e.name}throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return qT[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return 1===e?"f":"v"+e}findNode(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let n=0;n<arguments.length;n++){let e=t[n];if(e?.isNode)return e}}resolve(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let n=0;n<arguments.length;n++){let e=t[n];if(void 0!==e){if(e.isNode)return e;if(e.isTexture)switch(e.mapping){case Ae:case xe:return new WT(e);case _e:return new HT(new IT(e));default:return new IT(e)}else{if(e.isVector2)return new uT(e);if(e.isVector3)return new pT(e);if(e.isVector4)return new mT(e)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return XT[e]||e}getFormatByType(e){return YT[e]||e}getUUID(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return QT[e]}getIndexByElement(e){return QT.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=zt,t===zt&&this.context.gamma&&(t=jt),t}},JT=class extends dT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;super("c"),this.nodeType="Color",this.value=e instanceof fT?e:new fT(e||0,t,i,n)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,n,r,s){i=e.getUUID(i??this.getUUID()),n=n??this.getType(e);let a=e.getNodeData(i),o=this.getReadonly()&&void 0!==this.generateReadonly;if(this.alpha){let t=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${t};`)}return o?this.generateReadonly(e,t,i,n,r,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(n,this,r,s,this.getLabel())),e.format(a.vertex.name,n,t)):(a.fragment||(a.fragment=e.createFragmentUniform(n,this,r,s,this.getLabel())),e.format(a.fragment.name,n,t))}generateReadonly(e,t,i,n,r,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",n,t)}},ZT=class extends dT{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,n,r,s){return e.format(this.value.toString(),n,t)}},$T=class extends dT{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,n){return e.format(this.value?"true":"false",n,t)}},eI=class extends dT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:"number"==typeof t?new Array(e).fill(t):new Array(e).fill(0)}},tI=class extends dT{},iI=class extends tI{constructor(e){super("v3"),this.image=e,this._value=new Vi}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},nI=class extends tI{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1008,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1006;super("t"),this.image=e,this.wrap=t,this.minFilter=i,this.magFilter=n}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},rI=class extends dT{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new fi}generateReadonly(e,t,i,n,r,s){return e.format("mat3("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},sI=class extends dT{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new bn}generateReadonly(e,t,i,n,r,s){return e.format("mat4("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function aI(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply((new fi).makeRotation(n*ui.DEG2RAD))}var oI=class extends rI{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(new fi),this.repeat=e,this.offset=t,this.rotation=i,aI(this.value,e,t,i)}updateMatrix(){aI(this.value,this.repeat,this.offset,this.rotation)}},lI=class extends dT{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof ki?new Array(e).fill(t):new Array(e).fill(new ki(0))}},cI=class extends hT{constructor(e,t,i,n){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=n}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},hI=class extends hT{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(hI.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.color.build(e,"v3")),n.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},dI=hI;dI.Nodes={customColor:new yT("vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color;\n\t\t\t}")};var uI=class extends hT{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(uI.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.cnormal.build(e,"v3")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},pI=uI;pI.Nodes={customNormal:new yT("vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")};var fI=class extends hT{constructor(e,t,i,n,r,s,a,o,l,c,h,d){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=n,this.axis=r,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=d,this.alpha=c,this.mode=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i,n=`g${this.uuid.toString().replace(/-/g,"")}`;switch(this.projection.value){case 3:i=e.include(fI.Nodes.cylindrical);break;case 2:i=e.include(fI.Nodes.spherical);break;case 1:let t=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],r=["zy","xz","xy"][this.axis.value],s=new yT(`\n\t\tvec3 ${n}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 projected = (1. + (position.${r})) / 2.;\n\t\t\t\tvec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t${2===this.side.value?"":`lalpha *= step(0.0, ${1===this.side.value?"-1.0 * ":""}dot(vObjectNormal, ${t}));`}\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}`);i=e.include(s);break;case 4:i=e.include(fI.Nodes.triplanar);break;default:i=e.include(fI.Nodes.uv)}e.addFragmentVariable(this.calpha,"float");let r=[];if(r.push("normal"),r.push(this.texture.generate(e,"t")),r.push(this.textureSize.build(e,"v2")),r.push(this.crop.build(e,"f")),r.push(this.mat.build(e,"mat3")),r.push(this.size.build(e,"v2")),r.push(this.blending.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),4===this.projection.value){let t=`${n}_writeUvs`,i=t+"0",s=t+"1",a=t+"2",o=`${n}_triplanarWeights`;e.addFragmentVariable(i,"vec2"),e.addFragmentVariable(s,"vec2"),e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(o,"vec3"),r.push(i),r.push(s),r.push(a),r.push(o)}else{let t=`${n}_writeUvs`;e.addFragmentVariable(t,"vec2"),r.push(t)}return e.format(i+"("+r.join(",")+")",this.getType(e),t)}},mI=fI;mI.Nodes={cylindrical:new yT("\nvec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\t\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),spherical:new yT("\nvec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),uv:new yT("vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"),triplanar:new yT("vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {\n\t\t\t\tvec3 p = position;\n\t\t\t\tvec2 uv0 = (1.0 + p.xy) / 2.0;     \n\t\t\t\tvec2 uv1 = (1.0 + p.zy) / 2.0;\t\t\n\t\t\t\tvec2 uv2 = (1.0 + p.xz) / 2.0;\t\t\n\t\n\t\t\t\tuv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\n\t\t\t\t// Write out all sets of UVs that we generated\n\t\t\t\twriteUvs0 = uv0;\n\t\t\t\twriteUvs1 = uv1;\n\t\t\t\twriteUvs2 = uv2;\n\t\t\t\twriteWeights = weights;\n\n\t\t\t\t// Derivatives for LOD\n\t\t\t\tvec2 df0 = fwidth(uv0);\n\t\t\t\tvec2 df1 = fwidth(uv1);\n\t\t\t\tvec2 df2 = fwidth(uv2);\n\t\t\t\tif (df0.x > 0.5) df0.x = 0.0;\n\t\t\t\tif (df1.x > 0.5) df1.x = 0.0;\n\t\t\t\tif (df2.x > 0.5) df2.x = 0.0;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                \tvec4 tmp = \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#else\n                \tvec4 tmp = \n\t\t\t\t\t\ttextureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttextureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttextureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\n\t\t\t\t// Apply cropping across all 3 planes\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;//n * 0.5 + 0.5;\n\t\t\t}\t\t\t\n\t\t\t")};var gI=class extends hT{constructor(e,t,i,n,r,s,a,o,l,c,h,d){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=n,this.isVector=r,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=d,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,n=new yT(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ${i}_IS_VECTOR\n                   #ifdef ${i}_LINEAR\n                       #ifdef ${i}_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ${i}_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ${i}_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a * mask;\n               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t   \n               return color.rgb;\n\t\t\t}`,[gI.Nodes.vectorLinearWorldSpaceDepth,gI.Nodes.vectorLinearObjectSpaceDepth,gI.Nodes.vectorSphericalObjectSpaceDepth,gI.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),0===this.gradientType.value&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let r=e.include(n),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),t)}return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},vI=gI;vI.Nodes={vectorLinearWorldSpaceDepth:new yT("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorLinearObjectSpaceDepth:new yT("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalWorldSpaceDepth:new yT("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalObjectSpaceDepth:new yT("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }")};var yI=class extends hT{constructor(e,t,i,n,r,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=n,this.factor=r,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new yT("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\t\tfloat lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn color;\n\t\t\t\t}"),n=e.include(i),r=[];return r.push(this.color.build(e,"c")),r.push(this.bias.build(e,"f")),r.push(this.scale.build(e,"f")),r.push(this.intensity.build(e,"f")),r.push(this.factor.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(n+"("+r.join(",")+")",this.getType(e),t)}return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},bI=class extends hT{constructor(e,t,i,n,r,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=n,this.offset=r,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(bI.Nodes.gradient),n=[];return n.push(this.gradientType.build(e,"i")),n.push(this.smooth.build(e,"b")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.offset.build(e,"v2")),n.push(this.morph.build(e,"v2")),n.push(this.angle.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},AI=bI;AI.Nodes={gradient:new yT("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\n\t\t\t\treturn color.xyz;\n\t\t\t}")};var xI=class extends hT{constructor(e,t,i,n,r){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=n,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=r}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(xI.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let n=[];return n.push(this.texture.generate(e,"t")),n.push("normal"),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),n.push(this.rotation.build(e,"f")),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},wI=xI;wI.Nodes={matcap:new yT("vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {\n\t\t\t\t\tvec3 viewDir = normalize( vViewPosition );\n\t\t\t\t\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\t\t\t\t\tvec3 y = cross( viewDir, x );\n\t\t\t\t\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) );\n\t\t\t\t\tuv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;\n\t\t\t\t\tuv = uv * 0.495 + 0.5;\n\t\t\t\t\tvec4 matcapColor = texture2D( matcapTex, uv );\n\n\t\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\t\n\t\t\t\t\treturn matcapColor.rgb;\n            \t}")};var SI=function(){let e=new yT("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),t=new yT("float simplexFast(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t mediump vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t mediump vec3 hs = s;\n\t\t\t \n\t\t\t mediump vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t mediump vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t mediump vec3 x1 = x - i1 + G3;\n\t\t\t mediump vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t mediump vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t mediump vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(hs), x);\n\t\t\t d.y = dot(random3(hs + i1), x1);\n\t\t\t d.z = dot(random3(hs + i2), x2);\n\t\t\t d.w = dot(random3(hs + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[e]);t.keywords.F3=new xT("float F3 0.3333333"),t.keywords.G3=new xT("float G3 0.1666667");let i=new yT("float simplexPrecise(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[e]);i.keywords.F3=new xT("float F3 0.3333333"),i.keywords.G3=new xT("float G3 0.1666667");let n=new yT("float simplexFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplexFast(m * rot1)\n\t\t\t\t + 0.2666667 * simplexFast(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplexFast(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplexFast(8.0 * m);\n\t\t}",[t]),r=new yT("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new yT("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new yT("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}",[r,s]),o=new yT("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new yT("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),c=new yT("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}",[l]),h=new yT("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}",[c]);h.keywords.NUM_OCTAVES=new xT("int NUM_OCTAVES 5");let d=new yT("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),u=new yT("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}",[r,s,d]),p=new yT("float hashwithoutsine13(vec3 p3)\n\t\t{\n\t\t\tp3  = fract(p3 * .1031);\n\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t}"),f=new yT("vec3 hashwithoutsine33(vec3 p3)\n\t\t{\n\t\t\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\n\t\t\tp3 += dot(p3, p3.yxz+33.33);\n\t\t\treturn fract((p3.xxy + p3.yxx)*p3.zyx);\n\t\t}"),m=new yT("float metric(in vec3 p)\n\t\t{\n\t\t\t// L2 \n\t\t\treturn length(p);\n\n\t\t\t// Chebyshev \n\t\t\t// vec3 a = abs(p);\n\t\t\t// return max(a.x, max(a.y, a.z));\n\t\t}"),g=new yT("float smin( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(b, a, h) - correction;\n\t\t}"),v=new yT("float smax( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(a, b, h) + correction;\n\t\t}"),y=new yT("float remap(float value, float input_min, float input_max, float output_min, float output_max) {\n\t\t\t// Compute width of each interval\n\t\t\tfloat input_width = input_max - input_min;\n\t\t\tfloat output_width = output_max - output_min;\n\t\t\n\t\t\t// Convert input range into a 0-1 range \n\t\t\tfloat scaled = (value - input_min) / input_width;\n\t\t\n\t\t\t// Convert the 0-1 range into a value in output range\n\t\t\treturn output_min + (scaled * output_width);\n\t\t}");return{simplexFast:t,simplexPrecise:i,simplexFractal:n,simplexAshima:a,fbm:h,perlin:u,voronoi:new yT('float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) \n\t\t{\n\t\t\t// Integer and fractional parts of this point\'s coordinates\n\t\t\tivec3 p = ivec3(floor(x));\n\t\t\tvec3 f = fract(x);\n\n\t\t\t// Different variables that we will use to construct noise:\n\t\t\t//\n\t\t\t// f1: distance to the closest feature point\n\t\t\t// f2: distance to the second closest feature point\n\t\t\t// e: distance to the closest edge (cell boundary)\n\t\t\t//\n\t\t\t// We also compute "smooth" versions of all of the above quantites, essentially\n\t\t\t// replacing "hard" minimums with "smooth" minimums (described by IQ)\n\t\t\tfloat f1_smooth = 8.0;\n\t\t\tfloat f1 = 8.0;\n\t\t\tfloat f2_smooth = 8.0;\n\t\t\tfloat f2 = 8.0;\n\t\t\tfloat e_smooth = 8.0;\n\t\t\tfloat e = 8.0;\n\n\t\t\t// Variables stored from closest cell\n\t\t\tivec3 mb;\n\t\t\tvec3 mr; \n\n\t\t\tint steps = quality;\n\t\t\t\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d = length(r);\n\t\t\t\t\n\t\t\t\tf1_smooth = smin(d, f1_smooth, smoothness);\n\n\t\t\t\t// Store un-smoothed distances too \n\t\t\t\tif (d < f1) \n\t\t\t\t{\n\t\t\t\t\tf2 = f1;\n\t\t\t\t\tf1 = d;\n\n\t\t\t\t\tmb = ivec3(x, y, z);\n\t\t\t\t\tmr = r;\n\t\t\t\t} \n\t\t\t\telse if (d < f2) \n\t\t\t\t{\n\t\t\t\t\tf2 = d;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t\n\t\t\t// Second pass for edge distance  \n\t\t\t// skip for styles don\'t need\n\t\t\tif (style != 0 &&  style != 5 && style != 7)\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\t// Start search at the cell that contains the closest point to "x" (found in 1st pass)\n\t\t\t\tivec3 b = mb + ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d1 = dot(0.5 * (mr + r), (r - mr)); \t\t\t\t// IQ normalizes "r - mr" but that breaks things for the smooth version?\n\t\t\t\tfloat d2 = dot(0.5 * (mr + r), normalize(r - mr));\n\n\t\t\t\te_smooth = smin(d1, e_smooth, smoothness);\n\n\t\t\t\te = min(e, d2);\n\n\t\t\t\t// Also compute a smooth version of F2 in this pass\n\t\t\t\t{\n\t\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\t\tif (b != mb) \n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\t\t\tfloat d = length(r);\n\n\t\t\t\t\t\tf2_smooth = smin(d, f2_smooth, smoothness);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Different visualization modes \n\t\t\tif (style == 0) \n\t\t\t{\n\t\t\t\treturn f1_smooth;\n\t\t\t}\n\t\t\tif (style == 1) \n\t\t\t{\n\t\t\t\treturn f2_smooth;\n\t\t\t}\n\t\t\tif (style == 2) \n\t\t\t{\n\t\t\t\treturn f2_smooth - f1_smooth;\n\t\t\t\t\n\t\t\t\t// "Pebbles" also cool\n\t\t\t\t//return step(0.2, f2_smooth - f1_smooth);\n\t\t\t}\n\t\t\tif (style == 3) \n\t\t\t{\n\t\t\t\t// This one is really good for rock / stone effects\n\t\t\t\tfloat a = f1; \n\t\t\t\tfloat b = f2;\n\t\t\t\tfloat k = 3.0;\n\t\t\t\tfloat h = max(k - abs(a - b), 0.0) / k;\n\t\t\t\tfloat final = min(a, b) - h * h * k * (1.0 / 4.0);\n\t\t\t\treturn final;\n\t\t\t}\n\t\t\tif (style == 4) \n\t\t\t{\n\t\t\t\t// Some random adjustments to make this style stand out more \n\t\t\t\treturn exp(5.0 * e_smooth);\n\t\t\t}\n\t\t\tif (style == 5) \n\t\t\t{\n\t\t\t\treturn pow(f1_smooth, 3.0);\n\t\t\t}\n\t\t\tif (style == 6) \n\t\t\t{\t\t\t\t\n\t\t\t\tconst float eps = 0.0125;\n\n\t\t\t\t// Thicker lines as the user increases the smoothness slider\n\t\t\t\tfloat thickness = smoothness * 0.25 + eps;\n\n\t\t\t\t// Blurrier lines as the user increases the smoothness slider\n\t\t\t\tfloat blur = pow(smoothness, 3.0) * 0.25 + eps;\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\tthickness - thickness * blur, \n\t\t\t\t\tthickness + thickness * blur, \n\t\t\t\t\te\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (style == 7) \n\t\t\t{\n\t\t\t\treturn hashwithoutsine13(vec3(p + mb) + seed);\n\t\t\t}\n\t\t}\n\t',[p,f,m,g,v,y])}}(),_I=class extends hT{constructor(e,t,i,n,r,s,a,o,l,c,h,d,u,p,f,m,g,v,y){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=n,this.fB=r,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=d,this.voronoiStyle=p,this.highCut=f,this.lowCut=m,this.smoothness=g,this.seed=v,this.quality=y,this.isMask=u,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,n,r){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=new yT(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) \n\t\t\t{\n                // Prevent scale of zero \n\t\t\t\tscale = max(abs(scale), 0.001);\n\n\t\t\t\tvec3 st = position / size;\n\t\t\t\tst /= scale;\n\n\t\t\t\t${"voronoi"==s?`\n\t\tfloat v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);\n\n\t\t// Apply clipping to colors\n\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t// Note that the voronoi mode only uses colors "A" and "C" from the UI \n\t\tvec4 color = mix(colorA, colorC, v); \n\t\t`:`\n\t\tvec3 q = vec3(${s}(st),\n\t\t\t\t\t   ${s}(st + vec3(1.0)),\n\t\t\t\t\t   ${s}(st + vec3(1.0)));\n\t\tvec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t  ${s}(st * q));\n\t\tfloat f = ${s}(st + r);\n\t\tvec4 color;\n\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\t\t`}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}`,[SI.simplexFast,SI.simplexFractal,SI.simplexAshima,SI.fbm,SI.perlin,SI.voronoi]),o=e.include(a),l=[];return l.push(this.scale.build(e,"f")),l.push(this.size.build(e,"v3")),l.push(this.move.build(e,"f")),l.push(this.fA.build(e,"v2")),l.push(this.fB.build(e,"v2")),l.push(this.distortion.build(e,"v2")),l.push(this.colorA.build(e,"v4")),l.push(this.colorB.build(e,"v4")),l.push(this.colorC.build(e,"v4")),l.push(this.colorD.build(e,"v4")),l.push(this.voronoiStyle.build(e,"i")),l.push(this.highCut.build(e,"f")),l.push(this.lowCut.build(e,"f")),l.push(this.smoothness.build(e,"f")),l.push(this.seed.build(e,"f")),l.push(this.quality.build(e,"i")),l.push(this.isMask.build(e,"b")),l.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),l.push(this.alpha.build(e,"f")),l.push(this.calpha),e.format(o+"("+l.join(",")+")",this.getType(e),t)}};_I.numOctaves=5;var EI=class extends hT{constructor(e,t,i,n,r,s,a,o,l,c,h,d,u,p,f,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=n,this.contourThreshold=r,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=h,this.resolution=d,this.normalMap=u,this.depthMap=p,this.pixelRatio=f,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let t=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),r=this.compensation.build(e,"b"),s=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(t,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(r,"uniform bool"),e.addVertexParsVariable(s,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`\n                vID = randomColor.r;\n                vec2 ${i}_offset = vec2(0.0);\n                if (${r}) {\n                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));\n                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the\n                    // normals face the camera directly. So we hackily fix this by offsetting the normal\n                    // by a tiny amount.\n                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;\n                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${t} / 2.0) * ${i}_clipPosition.w * 2.0 * ${s};\n                    ${i}_clipPosition.xy += ${i}_offset;\n                    // TODO(MAX): To handle multiple outline layers, we only want to extrude\n                    // if this offset is the biggest of all the potential offsets\n                    gl_Position = ${i}_clipPosition;\n                }\n            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(EI.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},CI=EI;CI.Nodes=function(){let e=new yT("\nfloat sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)\n{\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    vec2 texelSize = (vec2(1.0) / resolution);\n    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;\n\n    vec2 uvSamples[9];\n    vec4 normalSamples[9];\n\n\tuvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);\n\tuvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);\n\tuvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);\n\tuvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);\n\tuvSamples[4] = uv;\n\tuvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);\n\tuvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);\n\tuvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);\n\tuvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);\n\n\n    normalSamples[0] = texture2D(t, uvSamples[0]);\n    normalSamples[1] = texture2D(t, uvSamples[1]);\n    normalSamples[2] = texture2D(t, uvSamples[2]);\n    normalSamples[3] = texture2D(t, uvSamples[3]);\n    normalSamples[4] = texture2D(t, uvSamples[4]);\n    normalSamples[5] = texture2D(t, uvSamples[5]);\n    normalSamples[6] = texture2D(t, uvSamples[6]);\n    normalSamples[7] = texture2D(t, uvSamples[7]);\n    normalSamples[8] = texture2D(t, uvSamples[8]);\n\n    float depthBias = 0.0001;\n    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!\n    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n\n    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);\n  \tvec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);\n\n    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));\n    return edgeNormal;\n}\n");return{outline:new yT("vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {\n                vec3 result = outlineColor;\n                float resultAlpha = 0.0;\n\n                vec3 N = normalize(vWNormal);\n                vec2 nuv = (gl_FragCoord.xy / resolution);\n                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);\n                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);\n\n                //resultAlpha = 1.0;\n                //result = vec3(sobelSample);\n\n                float t = 1.0 - contourThreshold;\n                if(positionalLines) {\n                    vec3 NDir = position * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float f  = fract(NT * contourFrequency * 0.01);\n                    float df = fwidth(NT * contourFrequency);\n\n                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);\n                    if (g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0;\n                    }\n                 }\n                 else {\n                    vec3 NDir = N * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float df = fwidth(NT * contourThreshold);\n                    float f = sin(NT * 1.0 * contourFrequency);\n                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);\n\n                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0 - g;\n                    }\n                 }\n\n                 float lalpha = alpha * resultAlpha * mask;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\t \n                 return result;\n             }",[e])}}();var MI=class extends hT{constructor(e,t,i,n,r,s,a,o,l,c,h,d,u,p,f,m,g,v){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=n,this.offset=r,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=h,this.zigzag=d,this.rotation=u,this.vertical=p,this.horizontal=f,this.sides=m,this.isMask=v,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i;switch(e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float"),this.style.value){case 0:default:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave"}let n=`g${this.uuid.toString().replace(/-/g,"")}`,r=new yT("float hashwithoutsine12(vec2 p)\n\t\t\t\t{\n\t\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * .1031);\n\t\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t\t}"),s=new yT("vec2 rotate_uv(in vec2 uv, float a, bool repeat) \n\t\t\t\t{\n\t\t\t\t\tconst float mid = 0.5;\n\t\t\t\t\tfloat radians = a * (PI / 180.0);\n\t\t\t\t\tvec2 rotated = vec2(\n\t\t\t\t\t\tcos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,\n\t\t\t\t\t\tcos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid\n\t\t\t\t\t);\n\t\t\t\t\treturn repeat ? fract(rotated): rotated;\n\t\t\t\t}"),a="";if(4===this.projection.value){a=`\n\t\t\t\tvec3 p = position;\n\t\t\t\tfloat factor = 0.0125;\n\t\t\t\tvec2 uv0 = fract(p.xy * factor);\n\t\t\t\tvec2 uv1 = fract(p.zy * factor);\n\t\t\t\tvec2 uv2 = fract(p.xz * factor);\n\t\t\t\t\n\t\t\t\tuv0 = rotate_uv(uv0 + offset, rotation, true);\n\t\t\t\tuv1 = rotate_uv(uv1 + offset, rotation, true);\n\t\t\t\tuv2 = rotate_uv(uv2 + offset, rotation, true);\n\t\n\t\t\t\tfloat d0 = ${2===this.style.value?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d1 = ${2===this.style.value?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d2 = ${2===this.style.value?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\t\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\t\t\t\td0 *= weights.z;\n\t\t\t\td1 *= weights.x;\n\t\t\t\td2 *= weights.y;\n\t\t\t\tfloat draw = d0 + d1 + d2;\n\t\n\t\t\t\tvec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;\n\t\t\t\t`}else{let e=2===this.style.value?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,t="";0===this.axis.value?t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.z);\n\t\t\t\t\tfloat phi = acos(p.x / radius);":1===this.axis.value?t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.x, p.z);\n\t\t\t\t\tfloat phi = acos(p.y / radius);":(this.axis.value,t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.x);\n\t\t\t\t\tfloat phi = acos(p.z / radius);");let n="";switch(this.projection.value){case 0:n="custom_uv = vUv.st;";break;case 1:case 3:default:break;case 2:n=`\n\t\t\t\t\t\t\tvec3 p = position;\n\t\t\t\t\t\t\t${t}\n\t\t\t\t\t\t\tcustom_uv = vec2(theta, phi);\n\t\t\t\t\t\t\tcustom_uv /= PI;\n\t\t\t\t\t\t\t`}a=`\n\t\t\t\tvec2 custom_uv;\n\t\t\t\t${n}\n\t\n\t\t\t\tcustom_uv += offset;\n\t\t\t\tcustom_uv = fract(custom_uv);\n\t\t\t\tcustom_uv = rotate_uv(custom_uv, rotation, true);\n\t\n\t\t\t\tfloat draw = ${e};\n\t\t\t\t`}let o=new yT(`vec3 ${n}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\t\tconst float TWO_PI = PI * 2.0;\n\t\t\t\t\tfloat smoothness_remapped = pow(smoothness, 5.0);\t\n\n\t\t\t\t\t${a}\n\n\t\t\t\t\t// Construct final output color\n\t\t\t\t\tvec4 color = mix(colorA, colorB, draw);\n\t\t\t\t\tcolor.a = clamp(color.a, 0.0, 1.0);\n\n\t\t\t\t\t// Apply cuts\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(vertical.x, custom_uv.y) * \n\t\t\t\t\t\tstep(custom_uv.y, vertical.y);\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(horizontal.x, abs(custom_uv.x)) * \n\t\t\t\t\t\tstep(abs(custom_uv.x), horizontal.y);\n\n\t\t\t\t\t// Accumulate alpha \n\t\t\t\t\tfloat lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t\t}`,[s,r,MI.DrawFunctions.circle,MI.DrawFunctions.ring,MI.DrawFunctions.polygon,MI.DrawFunctions.cross,MI.DrawFunctions.diamond,MI.DrawFunctions.checkerboard,MI.DrawFunctions.line,MI.DrawFunctions.wave]),l=e.include(o),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},TI=MI;TI.DrawFunctions=function(){let e=new yT("float hashwithoutsine12(vec2 p) {\n\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * 0.1031);\n\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t}"),t=new yT("vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {\n                // Create tiles in UV-space\n                uv *= frequency;\n\n                // Integer coords\n                vec2 i = floor(uv);\n\n                // Offset every other row based on zigzag param, then compute fractional coords\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = fract(uv);\n\n\t\t\t\t// Rotate the tile itself:\n\t\t\t\t// const float mid = 0.5;\n\t\t\t\t// f = vec2(\n\t\t\t\t// \tcos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,\n\t\t\t\t// \tcos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid\n\t\t\t\t// );\n\t\t\t\t// f = fract(f);\n\n                f = f * 2.0 - 1.0;\n\n\t\t\t\t// Recompute integer coords after shifting - then, random value per tile \n\t\t\t\ti = floor(uv);\n\t\t\t\tfloat rand = (hashwithoutsine12(i) * 5.0 + 1.0);\n\t\t\t\tfloat jitter = mix(1.0, rand, variation);\n\t\t\t\tf *= jitter;\n\n                return f;\n            }",[e]);return{tileAndCenter:t,circle:new yT("float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(\n                    -smoothness, \n                     smoothness, \n                     length(f) - size\n                );\n            }",[t]),ring:new yT("float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\n\t\t\t\tfloat d = length(f);\n                const float inner_width = 0.5;\n\n                float outer = smoothstep(-smoothness, smoothness, d - size);\n                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);\n\t\t\t\treturn outer + (1.0 - inner);   \n            }",[t]),polygon:new yT("float sdf_ngon(in vec2 p, in float r, in int n) {\n                float an = (PI * 2.0) / float(n);\n                float he = r * tan(0.5 * an);\n                \n                // Rotate to first sector\n                p = -p.yx; \n                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);\n                vec2  cs = vec2(cos(bn), sin(bn));\n                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;\n            \n                // Side of polygon\n                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);\n            }\n            \n            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));\n            }",[t]),cross:new yT("float sdf_cross(in vec2 p, in vec2 b, float r ) {\n                p = abs(p); \n\t\t\t\tp = (p.y > p.x) ? p.yx : p.xy;\n                vec2  q = p - b;\n                float k = max(q.y, q.x);\n                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);\n                return sign(k) * length(max(w, 0.0)) + r;\n            }\n            \n            // Avoid namespace conflicts \n            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));\n            }",[t]),diamond:new yT("float ndot(vec2 a, vec2 b) { \n                return a.x*b.x - a.y*b.y; \n            }\n            \n            float sdf_diamond(in vec2 p, in vec2 b) {\n                p = abs(p);\n                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);\n                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));\n                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);\n            }\n\n            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\t            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));\n            }",[t]),checkerboard:new yT("float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                uv *= frequency;\n                vec2 i = floor(uv);\n\n                float offset = mod(i.y, 2.0);\n\n                uv.x += offset + zigzag * offset;\n                float x = floor(uv.x);\n                \n                return mod(x, 2.0);\n            }"),line:new yT("float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);\n\t\t\t\t\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat row = floor(uv * frequency).y;\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(row));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\ts - smoothness, \n\t\t\t\t\ts + smoothness, \n\t\t\t\t\tabs(f.y)\n\t\t\t\t);\n            }",[t]),wave:new yT("// Uses bisection \n            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {\n                // Convert all data to a primitive cosine wave\n                p = c * (p - vec2(d, a));\n                \n                const float TWO_PI = PI * 2.0;\n\n                // Reduce to principal half cycle\n                p.x = mod(p.x, TWO_PI); \n                if (p.x > PI) {\n                    p.x = TWO_PI - p.x;\n                }\n            \n                // Find zero of derivative (minimize distance)\n                float xa = 0.0;\n                float xb = TWO_PI;\n\n                // 24 bit precision\n                for (int i = 0; i < 24; i++) {\n                    float x = 0.5 * (xa + xb);\n                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));\n                    if (y < 0.0) xa = x; \n                    else xb = x;\n                }\n                float x = 0.5 * (xa + xb);\n                \n                // Compute distance    \n                vec2 q = vec2(x, b * c * cos(x));\n                return length(p - q) / c;\n            }\n\n            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                float repeat = frequency.x;\n                uv *= repeat;\n                vec2 i = floor(uv);\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = vec2(uv.x, fract(uv.y));\n\n                // Generalized cosine: y(x) = a + b * cos(cx + d)\n                const float amplitude = 0.125;\n                float wave_frequency = frequency.y * 0.1;\n                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);\n\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(i.y));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);\n            }")}}();var II=class extends hT{constructor(e,t,i,n,r,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=n,this.noiseScale=r,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(II.Nodes.rainbow),n=[];return n.push(this.filmThickness.build(e,"f")),n.push(this.movement.build(e,"f")),n.push(this.wavelengths.build(e,"v3")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.offset.build(e,"v3")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},PI=II;PI.Nodes=function(){let e=new yT("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n\t\t\t\tfloat f = 0.0;\n\t\t\t\t\n\t\t\t\tif (noiseStrength != 0.0) {\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\tfloat noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));\n\t\t\t\t\tf = noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tvec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;\n\t\t\t\tfloat angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));\n\n\t\t\t\tmediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);\n\t\t\t\treturn .5 + .5 * color;\n\t\t\t }",[SI.simplexFast]);return{rainbow:new yT("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tmediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n\t\t\t\tfloat rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n\n\t\t\t\tfloat lalpha = alpha * rainbowContribution * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn res;\n\t\t\t }",[e])}}();var DI=class extends hT{constructor(e,t,i,n,r,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=n,this.isWorldSpace=r,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(DI.Nodes.toon),n=[];return n.push(this.positioning.build(e,"i")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.source.build(e,"v3")),n.push(this.isWorldSpace.build(e,"b")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.shadowColor.build(e,"v4")),n.push(this.offset.build(e,"v3")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},RI=DI;RI.Nodes=function(){let e=new yT("float rand(float n) {\n\t\t\t\treturn fract(sin(n) * 43758.5453123);\n\t\t\t}"),t=new yT("float hash1(float p) { \n\t\t\t\tp = fract(p * 0.011); \n\t\t\t\tp *= p + 7.5; \n\t\t\t\tp *= p + p; \n\t\t\t\treturn fract(p); \n\t\t\t}"),i=new yT("float valueNoise(vec3 x) {\n\t\t\t\tconst vec3 step = vec3(110, 241, 171);\n\t\t\t\n\t\t\t\tvec3 i = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\t\t\t \n\t\t\t\t// For performance, compute the base input to a 1D hash from the integer part of the argument and the \n\t\t\t\t// incremental change to the 1D based on the 3D -> 1D wrapping\n\t\t\t\tfloat n = dot(i, step);\n\t\t\t\n\t\t\t\tvec3 u = f * f * (3.0 - 2.0 * f);\n\t\t\t\treturn mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n\t\t\t\t\t\t   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n\t\t\t}",[t]),n=new yT("vec3 hash3(vec3 x) {\n\t\t\t\tx = vec3(dot(x,vec3(127.1, 311.7, 74.7)),\n\t\t\t\t\t\t dot(x,vec3(269.5, 183.3, 246.1)),\n\t\t\t\t\t\t dot(x,vec3(113.5, 271.9, 124.6)));\n\t\t\t\n\t\t\t\treturn fract(sin(x)*43758.5453123);\n\t\t\t}"),r=new yT('vec3 voronoiNoise(in vec3 x)\n\t\t\t{\n\t\t\t\tvec3 p = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\n\t\t\t\tfloat id = 0.0;\n\t\t\t\tvec2 res = vec2(100.0);\n\n\t\t\t\tfor(int k=-1; k<=1; k++)\n\t\t\t\tfor(int j=-1; j<=1; j++)\n\t\t\t\tfor(int i=-1; i<=1; i++)\n\t\t\t\t{\n\t\t\t\t\tvec3 b = vec3(float(i), float(j), float(k));\n\n\t\t\t\t\t// Comment out the "+ hash(p + b);" part below to get "square" cells\n\t\t\t\t\tvec3 r = vec3(b) - f + hash3(p + b);\n\t\t\t\t\tfloat d = dot(r, r);\n\n\t\t\t\t\tif (d < res.x)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = dot(p + b, vec3(1.0, 57.0, 113.0));\n\t\t\t\t\t\tres = vec2(d, res.x);\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse if (d < res.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tres.y = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn vec3(sqrt(res), abs(id));\n\t\t\t}\n\t\t\t',[n]);return{toon:new yT('vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tfloat shadow = 1.0;\n\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\t// Can\'t do this mode if lighting is "none"\n\t\t\t\t\t#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))\n\n\t\t\t\t\t\t// Algorithm from Chapter 10 of Graphics Shaders\n\t\t\t\t\t\tconst vec3 weights = vec3(0.2125, 0.7154, 0.0721);\n\t\t\t\t\t\tvec3 lpos;\n\t\t\t\t\t\tvec3 l;\n\t\t\t\t\t\tfloat dproduct;\n\n\t\t\t\t\t\t#if (NUM_POINT_LIGHTS > 0)\n\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tPointLightShadow pointLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Light positions are in view-space for some reason?\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: we want to use "intensity" but it isn\'t available in the shader code\n\t\t\t\t\t\t\t\t//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);\n\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tpointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getPointShadow( \n\t\t\t\t\t\t\t\t\t\t\tpointShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowRadius,\n\t\t\t\t\t\t\t\t\t\t\tvPointShadowCoord[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraNear, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraFar);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_DIR_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tDirectionalLightShadow directionalLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Use the direction vector for directional lights instead\n\t\t\t\t\t\t\t\tl = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;\n\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tdirectionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow( \n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tdirectionalShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tSpotLightShadow spotLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tspotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow(\n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tspotShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvSpotLightCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tt = clamp(t, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\t#endif\n\n\t\t\t\t} else if (positioning == 1) {\n\t\t\t\t\t\n\t\t\t\t\tvec3 origin = mix(position, worldPosition, float(isWorldSpace));\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvec3 origin = worldPosition;\n\t\t\t\t\tvec3 source = cameraPosition - offset;\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (noiseStrength > 0.0) {\n\t\t\t\t\t// Distort with noise\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\t\n\t\t\t\t\t// Voronoi "smooth" noise\n\t\t\t\t\tfloat noise = 1.0 - voronoiNoise(st).x;\n\n\t\t\t\t\t// Voronoi cellular noise\n\t\t\t\t\t//float noise = 1.0 - rand(voronoiNoise(st).z);\n\n\t\t\t\t\t// Position warp noise\n\t\t\t\t\t// vec3 offset = vec3(\n\t\t\t\t\t// \tsimplexFast(st),\n\t\t\t\t\t// \tsimplexFast(st + vec3(111.1, 143.89, 217.19)),\n\t\t\t\t\t// \tsimplexFast(st + vec3(171.1, 247.89, 117.23))\n\t\t\t\t\t// );\n\t\t\t\t\t// st += offset;\n\t\t\t\t\t// float noise = valueNoise(st);\n\n\t\t\t\t\tt += noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tt = clamp(t, 0.0, 1.0);\n\n\t\t\t\t// Compute ramp color\n\t\t\t\tfloat p;\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tfor (int i = 1; i < COLORS_MAX; i++) {\n\t\t\t\t\tp = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);\n\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t}\n\n\t\t\t\t// Incorporate custom shadow color\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\tvec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);\n\t\t\t\t\tcolor.rgb = mix(blendedShadow, color.rgb, shadow);\n\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// Accumulate alpha as usual\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\n            }',[SI.simplexFast,e,i,r])}}();var BI={textureBicubic:new yT("float w0( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n        }\n    \n        float w1( float a ) {\n            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n        }\n    \n        float w2( float a ){\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n        }\n    \n        float w3( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * a * a );\n        }\n    \n        // g0 and g1 are the two amplitude functions\n        float g0( float a ) {\n            return w0( a ) + w1( a );\n        }\n    \n        float g1( float a ) {\n            return w2( a ) + w3( a );\n        }\n    \n        // h0 and h1 are the two offset functions\n        float h0( float a ) {\n            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n        }\n    \n        float h1( float a ) {\n            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n        }\n    \n        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n            uv = uv * texelSize.zw + 0.5;\n    \n            vec2 iuv = floor( uv );\n            vec2 fuv = fract( uv );\n    \n            float g0x = g0( fuv.x );\n            float g1x = g1( fuv.x );\n            float h0x = h0( fuv.x );\n            float h1x = h1( fuv.x );\n            float h0y = h0( fuv.y );\n            float h1y = h1( fuv.y );\n    \n            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n    \n            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + \n                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n        }\n\n        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n            vec2 fLodSizeInv = 1.0 / fLodSize;\n            vec2 cLodSizeInv = 1.0 / cLodSize;\n            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n            return mix( fSample, cSample, fract( lod ) );\n        }")};var LI=class extends hT{constructor(e,t,i,n,r,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=n,this.transmissionSamplerMap=r,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,UI.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(LI.Nodes.transmission),n=[];return n.push(this.thickness.build(e,"f")),n.push(this.ior.build(e,"f")),n.push(this.roughness.build(e,"f")),n.push(this.transmissionSamplerSize.build(e,"v2")),n.push(this.transmissionSamplerMap.getTexture(e,"t")),n.push(this.transmissionDepthMap.getTexture(e,"t")),n.push(this.aspectRatio.build(e,"v2")),n.push("normal"),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},OI=LI;OI.Nodes=function(){let e=new yT("vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n\t\t\t\t// Special case for blur == 0.0\n\t\t\t\tif (lod == 0.0) {\n\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\t\treturn texture2DLodEXT( sp, U, 0.0).rgb;\n\t\t\t\t\t#else\n\t\t\t\t\treturn textureLod( sp, U, 0.0).rgb;\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec2 texelSize = vec2(1.0) / resolution;\n                vec2 halton = haltonSequence[frameIndex];\n                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n                float temporalAngle  = temporalOffset * PI2;\n\t\t\t\tvec3 res = vec3(0.0);\n                vec2 uv = vec2(0.0);\n                vec2 offset = vec2(0.0);\n                vec2 vogelSample = vec2(0.0);\n                for (int i = 0; i < NUM_SAMPLES; i++) {\n                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;\n                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20\n                    uv = U + offset;\n                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    res += textureLod(sp, uv, lod).rgb;\n                }\n                return res / float(NUM_SAMPLES);\n            }"),t=new yT("vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        \n\t\t\t\t// Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t        // The thickness is specified in local space\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),i=new yT("float applyIorToRoughness( float roughness, float ior ) {\n\t\t\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\t\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t\t\t}"),n=new yT('vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\t\t\t// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see\n\t\t\t\t// also the code in convertTransmission.ts, which runs during export\n\t\t\t\t#ifdef IS_THREEJS_EXPORT\n\t\t\t\t\tfloat lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);\n\t\t\t\t\treturn textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;\n\t\t\t\t#else\n\t\t\t\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t\t\t\tfloat lod = applyIorToRoughness(roughness, ior);\n\t\t\t\t\treturn blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t\t\t\t#endif\n\t\t\t}',[BI.textureBicubic,i,e]),r=new yT("vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\n\t\t\t\tvec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n\t\t\t\tvec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n\t\t\t\tunrefractedCoords += 1.0;\n\t\t\t\tunrefractedCoords /= 2.0;\n\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\treturn getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    \t\t}",[n,t]);return{transmission:new yT("vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                \n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn transmission;\n            }",[r])}}();var NI=(e=>(e.NOISE="noise",e.MAP="map",e))(NI||{}),kI=class extends hT{constructor(e,t,i,n,r,s,a,o,l,c,h){super("v3"),this.displacementTypeIndex=new ZT(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,"map"===Object.values(NI)[this.displacementTypeIndex.value]&&(this.mat=new rI(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=h,this.voronoiStyle=n,this.smoothness=r,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,n=[];switch(n.push("displaced_position"),n.push("displaced_normal"),Object.values(NI)[this.displacementTypeIndex.value]){case"map":i=e.include(kI.Nodes.map),n.push(this.movementOrTexture.getTexture(e,"t")),n.push("uv"),n.push(this.cropOrOffset.build(e,"f")),this.mat&&n.push(this.mat.build(e,"mat3"));break;case"noise":{let t=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],r=new yT("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),s=new yT(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {\n\t\t\t\t\t\t\t${"voronoi"==t?`\n\t\t\t\t\tfloat v = ${t}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);\n\t\t\t\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\t\t\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\t\t\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t\t\t\treturn p + n * v * intensity;\n\t\t\t\t\t`:`\n\t\t\t\t\treturn p + n * ${t}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t`}\n\t\t\t\t\t\t}`,[SI.simplexPrecise,SI.simplexFractal,SI.simplexAshima,SI.fbm,SI.perlin,SI.voronoi]),a=new yT("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}",[s,r]);i=e.include(a),n.push(this.scale.build(e,"f")),n.push(this.cropOrOffset.build(e,"v3")),n.push(this.movementOrTexture.build(e,"f")),n.push(this.voronoiStyle.build(e,"i")),n.push(this.smoothness.build(e,"f")),n.push(this.seed.build(e,"f")),n.push(this.highCut.build(e,"f")),n.push(this.lowCut.build(e,"f")),n.push(this.quality.build(e,"i"));break}}return n.push(this.intensity.build(e,"f")),n.push("displaced_normal"),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},FI=kI;FI.Nodes=function(){let e=new yT("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),t=new yT("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");return{map:new yT("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}",[e,t])}}();var UI={normalRenderTarget:new IT,normalRenderTargetDepth:new IT,transmissionRenderTarget:new IT,aspectRatio:new uT,transmissionSize:new uT(2048,2048),transmissionRenderTargetDepth:new IT,aoRenderTarget:new IT,aoEnabled:new $T,pixelRatioNode:new PT(1),resolution:new uT,penumbraSize:new eI(5,.5),frameIndex:new ZT(0),transmissionLod:new ZT(2)};for(let yH of Object.values(UI))yH.isRenderGlobal=!0;var zI,jI={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.87/build/ui.wasm"},VI=class extends oT{constructor(){super("basic"),this.nodeType="Basic",this.color=new JT(SA),this.shadingAlpha=new PT(1),this.shadingBlend=new ZT(0),this.previousModelViewMatrix=new sI,this.previouseProjectionMatrix=new sI}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:UI.frameIndex}),e.mergeUniform({resolution:UI.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Fr.merge([ns.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{void 0===this.color&&(this.color=new JT(SA)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),n=this.alpha?this.alpha.flow(e,"f"):void 0,r=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=void 0!==n,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join("\n"));let a=["#include <normal_fragment_begin>",i.code];n&&a.push(n.code,"#ifdef ALPHATEST"," if ( "+n.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(e),o=`luminance(${this.mask.flow(e,"v3").result})`),n?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${n.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),r&&a.push(`gl_FragColor.a *= ${r.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),t=a.join("\n")}return t}},GI=class extends oT{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new JT(SA),this.emissive=new JT(0),this.emissiveIntensity=new PT(1),this.previousModelViewMatrix=new sI,this.previouseProjectionMatrix=new sI,this.shadingAlpha=new PT(1),this.shadingBlend=new ZT(0),this.occlusion=new $T(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:UI.frameIndex}),e.mergeUniform({resolution:UI.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Fr.merge([ns.fog,ns.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t"),n.push("\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:UI.penumbraSize}),e.mergeUniform({frameIndex:UI.frameIndex}),e.mergeUniform({aoMap:UI.aoRenderTarget}),e.mergeUniform({aoEnabled:UI.aoEnabled}),void 0===this.color&&(this.color=new JT(SA)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),n=this.emissive.flow(e,"c",{slot:"emissive"}),r=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let d=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t","#include <clipping_planes_fragment>"];d.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&d.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),d.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),n&&d.push(n.code,"reflectedLight.directDiffuse += "+n.result+" * "+r.result+";"),d.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let u="1.0";this.mask&&(this.mask.analyze(e),u=`luminance(${this.mask.flow(e,"v3").result})`),d.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${u} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${u}, ${o.result} );\n\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&d.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?d.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):d.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&d.push(`gl_FragColor.a *= ${h.result};`),d.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=d.join("\n")}return t}},HI={dHdxy:new yT("vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {\n\n            // Gradient of UVs w.r.t. X coordinate (in screen-space)\n            vec2 dSTdx = dFdx(bumpMapUv);\n\n            // Gradient of UVs w.r.t. Y coordinate (in screen-space)\n            vec2 dSTdy = dFdy(bumpMapUv);\n            \n            // Forward differencing\n            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);\n            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;\n            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;\n            \n            return vec2( dBx, dBy );\n        }"),perturbNormalArb:new yT("vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n            vec3 vSigmaX = dFdx( surf_pos.xyz );\n            vec3 vSigmaY = dFdy( surf_pos.xyz );\n            vec3 vN = surf_norm; // normalized\n            \n            vN = normalize(vN);\n\n            vec3 R1 = cross( vSigmaY, vN );\n            vec3 R2 = cross( vN, vSigmaX );\n\n            R1 = normalize(R1);\n            R2 = normalize(R2);\n    \n            float fDet = dot( vSigmaX, R1 ) * faceDirection;\n    \n            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n            return normalize( abs( fDet ) * vN - vGrad );\n        }")},WI=class extends oT{constructor(){super("phong"),this.nodeType="Phong",this.color=new JT(SA),this.specular=new JT(1118481),this.shininess=new PT(30),this.previousModelViewMatrix=new sI,this.previouseProjectionMatrix=new sI,this.shadingAlpha=new PT(1),this.shadingBlend=new ZT(0),this.occlusion=new $T(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:UI.frameIndex}),e.mergeUniform({resolution:UI.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Fr.merge([ns.fog,ns.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:UI.penumbraSize}),e.mergeUniform({frameIndex:UI.frameIndex}),e.mergeUniform({aoMap:UI.aoRenderTarget}),e.mergeUniform({aoEnabled:UI.aoEnabled}),void 0===this.color&&(this.color=new JT(SA)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let n=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let d=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tBlinnPhongMaterial material;"];if(this.bumpMap){e.include(HI.dHdxy),e.include(HI.perturbNormalArb);let t=this.bumpMap.texture.flow(e,"t"),i=this.bumpMap.flow(e,"v3"),n=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${t.result}, uv0, ${n});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${t.result}, uv1, ${n});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${t.result}, uv2, ${n});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${t.result}, bumpMapCachedUv, ${n});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,d.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${i.result};\n\t\t\t\t\t${r}\n\t\t\t\t\t`)}d.push(n.code,"\tvec3 diffuseColor = "+n.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",r.code,"\tvec3 specular = "+r.result+";",s.code,"\tfloat shininess = max( 0.0001, "+s.result+" );","\tfloat specularStrength = 1.0;"),c&&d.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),d.push("material.diffuseColor = diffuseColor;"),d.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),d.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let u="1.0";this.mask&&(this.mask.analyze(e),u=`luminance(${this.mask.flow(e,"v3").result})`),d.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${u} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${u}, ${o.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&d.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?d.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):d.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&d.push(`gl_FragColor.a *= ${h.result};`),d.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=d.join("\n")}return t}},QI=class extends oT{constructor(){super("standard"),this.nodeType="Standard",this.color=new JT(SA),this.roughness=new PT(.3),this.metalness=new PT(0),this.reflectivity=new PT(.5),this.previousModelViewMatrix=new sI,this.previouseProjectionMatrix=new sI,this.shadingAlpha=new PT(1),this.shadingBlend=new ZT(0),this.occlusion=new $T(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:UI.frameIndex}),e.mergeUniform({resolution:UI.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Fr.merge([ns.fog,ns.lights])),ns.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:UI.penumbraSize}),e.mergeUniform({frameIndex:UI.frameIndex}),e.mergeUniform({aoMap:UI.aoRenderTarget}),e.mergeUniform({aoEnabled:UI.aoEnabled});let i={gamma:!0};void 0===this.color&&(this.color=new JT(SA)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let n=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let r=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,d=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,u=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=void 0!==h,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join("\n"));let p=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(HI.dHdxy),e.include(HI.perturbNormalArb);let t=this.bumpMap.texture.flow(e,"t"),i=this.bumpMap.flow(e,"v3"),n=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${t.result}, uv0, ${n});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${t.result}, uv1, ${n});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${t.result}, uv2, ${n});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${t.result}, bumpMapCachedUv, ${n});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${i.result};\n\t\t\t\t\t${r}\n\t\t\t\t\t`)}if(p.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"\tfloat metalnessFactor = "+a.result+";"),this.roughnessMap){let t=this.roughnessMap.texture.flow(e,"t"),i=this.roughnessMap.flow(e,"v3"),n="";n=4===this.roughnessMap.projection.value?`\n\t\t\t\t\tfloat roughnessChange = 1.0;\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tfloat r0 = luminance(texture(${t.result}, uv0).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r1 = luminance(texture(${t.result}, uv1).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r2 = luminance(texture(${t.result}, uv2).rgb) * roughnessScale;\n\n\t\t\t\t\t\troughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);\n\t\t\t\t\t}\n\t\t\t\t\tfloat roughnessFactor = roughnessChange * ${s.result};\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\n\t\t\t\t\tvec4 vals = texture(${t.result},  roughnessMapCachedUv);\n\t\t\t\t\tfloat roughnessFactor = luminance(vals.rgb) * ${s.result};\n\t\t\t\t\t`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${i.result};\n\n\t\t\t\t\tconst float roughnessScale = 1.0;\n\n\t\t\t\t\t${n}\n\t\t\t\t`)}else p.push(s.code,"\tfloat roughnessFactor = "+s.result+";");h&&p.push(h.code,"#ifdef ALPHATEST","\tif ( "+h.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),u?p.push(u.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+u.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+n.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(e),f=`luminance(${this.mask.flow(e,"v3").result})`),p.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${f} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${f}, ${l.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),c&&p.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),h?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),d&&p.push(`gl_FragColor.a *= ${d.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join("\n")}return t}},qI=class extends oT{constructor(){super("toon"),this.nodeType="Toon",this.color=new JT(SA),this.specular=new JT(1118481),this.shininess=new PT(30),this.previousModelViewMatrix=new sI,this.previouseProjectionMatrix=new sI,this.shadingAlpha=new PT(1),this.shadingBlend=new ZT(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:UI.frameIndex}),e.mergeUniform({resolution:UI.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Fr.merge([ns.fog,ns.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:UI.penumbraSize}),e.mergeUniform({frameIndex:UI.frameIndex}),e.mergeUniform({aoMap:UI.aoRenderTarget}),e.mergeUniform({aoEnabled:UI.aoEnabled}),void 0===this.color&&(this.color=new JT(SA)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),r=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==l,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>","\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join("\n"));let h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tToonMaterial material;"];if(this.bumpMap){e.include(HI.dHdxy),e.include(HI.perturbNormalArb);let t=this.bumpMap.texture.flow(e,"t"),i=this.bumpMap.flow(e,"v3"),n=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${t.result}, uv0, ${n});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${t.result}, uv1, ${n});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${t.result}, uv2, ${n});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${t.result}, bumpMapCachedUv, ${n});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${i.result};\n\t\t\t\t\t${r}\n\t\t\t\t\t`)}h.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",n.code,"\tvec3 specular = "+n.result+";",r.code,"\tfloat shininess = max( 0.0001, "+r.result+" );","\tfloat specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${d} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${d}, ${a.result} );\n\t\t\t\t}\n\t\t\t\t`),o&&h.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&h.push(`gl_FragColor.a *= ${c.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join("\n")}return t}},XI=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout((()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")}),this.timeout+1e3))}has(e){return this.cache.get(e)?.data}load(e){let t=Date.now(),i=this.cache.get(e);return void 0===i?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},YI=class extends XI{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}};var KI=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,0===this.refCount&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount,0}},JI=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data),0}load(e){let t=this.cache.get(e);return void 0===t&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},ZI=class extends KI{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo="video"===e.type,this.isBuffer=!0===e.isWebGLRenderTarget,this.loadPromise=this.updateSrc(this.isBuffer?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let e of Object.values(this._cache))for(let t of Object.values(e))for(let e of Object.values(t))e&&(e.image=this.img,e.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,"string"!=typeof e){var i=new FileReader;let t;i.readAsDataURL(new Blob([e],{type:"video/mp4"})),await new Promise((e=>{i.onloadend=i=>{t=i.target?.result,e(null)}})),this.img.src=t}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=function(e){return"string"==typeof e?e:(zI||(zI=new YI),zI.load(e))}(e),this.img.onload=t,await new Promise((e=>{this.img.onload=()=>{t(),e(null)}}))}getTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1008,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1006,n=this._cache[e]?.[t]?.[i];if(n)return n;{let n;return n=this.isBuffer?this.img.texture:this.isVideo?new ll(this.img,void 0,e,e):new Ni(this.img,void 0,e,e,i,t),this.loaded&&(n.needsUpdate=!0),void 0===this._cache[e]&&(this._cache[e]={}),void 0===this._cache[e][t]&&(this._cache[e][t]={}),this._cache[e][t][i]=n,n}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))for(let t of Object.values(i))t&&(t.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,n]of Object.entries(t))for(let[t,r]of Object.entries(n))r?.dispose(),void 0!==this._cache[e]&&void 0!==this._cache[e][i]&&(this._cache[e][i][t]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},$I=class extends ZI{};function eP(e,t){var i=function(e){if(!iP[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i="06/25/2014, 00:00:00"===t||"\u200e06\u200e/\u200e25\u200e/\u200e2014\u200e \u200e00\u200e:\u200e00\u200e:\u200e00"===t;iP[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return iP[e]}(t);return i.formatToParts?function(e,t){try{for(var i=e.formatToParts(t),n=[],r=0;r<i.length;r++){var s=tP[i[r].type];s>=0&&(n[s]=parseInt(i[r].value,10))}return n}catch(Xb){if(Xb instanceof RangeError)return[NaN];throw Xb}}(i,e):function(e,t){var i=e.format(t).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[n[3],n[1],n[2],n[4],n[5],n[6]]}(i,e)}var tP={year:0,month:1,day:2,hour:3,minute:4,second:5};var iP={};function nP(e,t,i,n,r,s,a){var o=new Date(0);return o.setUTCFullYear(e,t,i),o.setUTCHours(n,r,s,a),o}var rP=36e5,sP=6e4,aP={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function oP(e,t,i){var n,r,s;if(!e||(n=aP.timezoneZ.exec(e)))return 0;if(n=aP.timezoneHH.exec(e))return cP(s=parseInt(n[1],10))?-s*rP:NaN;if(n=aP.timezoneHHMM.exec(e)){s=parseInt(n[1],10);var a=parseInt(n[2],10);return cP(s,a)?(r=Math.abs(s)*rP+a*sP,s>0?-r:r):NaN}if(function(e){if(hP[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),hP[e]=!0,!0}catch{return!1}}(e)){t=new Date(t||Date.now());var o=i?t:function(e){return nP(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}(t),l=lP(o,e),c=i?l:function(e,t,i){var n=e.getTime(),r=n-t,s=lP(new Date(r),i);if(t===s)return t;r-=s-t;var a=lP(new Date(r),i);return s===a?s:Math.max(s,a)}(t,l,e);return-c}return NaN}function lP(e,t){var i=eP(e,t),n=nP(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),r=e.getTime(),s=r%1e3;return n-(r-=s>=0?s:1e3+s)}function cP(e,t){return-23<=e&&e<=23&&(null==t||0<=t&&t<=59)}var hP={};var dP=u(g(),1),uP=u(v(),1),pP=36e5,fP=6e4,mP=2,gP={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/};function vP(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(null===e)return new Date(NaN);var i=t||{},n=null==i.additionalDigits?mP:(0,dP.default)(i.additionalDigits);if(2!==n&&1!==n&&0!==n)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e))return new Date(e.getTime());if("number"==typeof e||"[object Number]"===Object.prototype.toString.call(e))return new Date(e);if("string"!=typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var r=function(e){var t,i={},n=gP.dateTimePattern.exec(e);if(n?(i.date=n[1],t=n[3]):(n=gP.datePattern.exec(e),n?(i.date=n[1],t=n[2]):(i.date=null,t=e)),t){var r=gP.timeZone.exec(t);r?(i.time=t.replace(r[1],""),i.timeZone=r[1].trim()):i.time=t}return i}(e),s=function(e,t){var i,n=gP.YYY[t],r=gP.YYYYY[t];if(i=gP.YYYY.exec(e)||r.exec(e),i){var s=i[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(i=gP.YY.exec(e)||n.exec(e),i){var a=i[1];return{year:100*parseInt(a,10),restDateString:e.slice(a.length)}}return{year:null}}(r.date,n),a=s.year,o=function(e,t){if(null===t)return null;var i,n,r,s;if(0===e.length)return n=new Date(0),n.setUTCFullYear(t),n;if(i=gP.MM.exec(e),i)return n=new Date(0),r=parseInt(i[1],10)-1,wP(t,r)?(n.setUTCFullYear(t,r),n):new Date(NaN);if(i=gP.DDD.exec(e),i){n=new Date(0);var a=parseInt(i[1],10);return function(e,t){if(t<1)return!1;var i=xP(e);return!(i&&t>366||!i&&t>365)}(t,a)?(n.setUTCFullYear(t,0,a),n):new Date(NaN)}if(i=gP.MMDD.exec(e),i){n=new Date(0),r=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return wP(t,r,o)?(n.setUTCFullYear(t,r,o),n):new Date(NaN)}if(i=gP.Www.exec(e),i)return s=parseInt(i[1],10)-1,SP(t,s)?yP(t,s):new Date(NaN);if(i=gP.WwwD.exec(e),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return SP(t,s,l)?yP(t,s,l):new Date(NaN)}return null}(s.restDateString,a);if(isNaN(o))return new Date(NaN);if(o){var l,c=o.getTime(),h=0;if(r.time&&(h=function(e){var t,i,n;if(t=gP.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),_P(i)?i%24*pP:NaN;if(t=gP.HHMM.exec(e),t)return i=parseInt(t[1],10),n=parseFloat(t[2].replace(",",".")),_P(i,n)?i%24*pP+n*fP:NaN;if(t=gP.HHMMSS.exec(e),t){i=parseInt(t[1],10),n=parseInt(t[2],10);var r=parseFloat(t[3].replace(",","."));return _P(i,n,r)?i%24*pP+n*fP+1e3*r:NaN}return null}(r.time),isNaN(h)))return new Date(NaN);if(r.timeZone||i.timeZone){if(l=oP(r.timeZone||i.timeZone,new Date(c+h)),isNaN(l))return new Date(NaN)}else l=(0,uP.default)(new Date(c+h)),l=(0,uP.default)(new Date(c+h+l));return new Date(c+h+l)}return new Date(NaN)}function yP(e,t,i){t=t||0,i=i||0;var n=new Date(0);n.setUTCFullYear(e,0,4);var r=7*t+i+1-(n.getUTCDay()||7);return n.setUTCDate(n.getUTCDate()+r),n}var bP=[31,28,31,30,31,30,31,31,30,31,30,31],AP=[31,29,31,30,31,30,31,31,30,31,30,31];function xP(e){return e%400===0||e%4===0&&e%100!==0}function wP(e,t,i){if(t<0||t>11)return!1;if(null!=i){if(i<1)return!1;var n=xP(e);if(n&&i>AP[t]||!n&&i>bP[t])return!1}return!0}function SP(e,t,i){return!(t<0||t>52||null!=i&&(i<0||i>6))}function _P(e,t,i){return!(null!=e&&(e<0||e>=25)||null!=t&&(t<0||t>=60)||null!=i&&(i<0||i>=60))}function EP(e,t){return t.color(e)}function CP(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1?arguments[1]:void 0,i=t.format,n=e.getSeconds(),r=e;t&&null!==t.timeZone&&(r=function(e,t,i){var n=vP(e,i),r=oP(t,n,!0),s=new Date(n.getTime()-r),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}(new Date,t.timeZone));let s,a=r.getHours(),o=r.getMinutes();"12ampm"===t.format12h24h&&(s=a>=12?"PM":"AM");let l,c,h=a;switch("24"!==t.format12h24h&&(h=a%12,0===h&&(h=12)),i){case"HH:mm:ss":l=[h,o,n];break;case"HH:mm":l=[h,o];break;case"HH":l=[h],s=void 0;break;case"mm":l=[o],s=void 0;break;case"ss":l=[n],s=void 0;break;case"year":c=r.getFullYear();break;case"month":c=r.getMonth()+1;break;case"dayOfYear":c=Math.floor((r.getTime()-new Date(r.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":c=r.getDate();break;case"secondOfDay":c=60*a*60+60*o+n;break;default:console.error("Unknown time format",i),c=0}return void 0!==l?{textValue:l,suffix:s}:c}function MP(e,t){switch(e.type){case"fresnel":return function(e,t){let{bias:i,scale:n,intensity:r,factor:s,color:a}=e;return{...IP(e,t),color:EP(a,t),bias:i,scale:n,intensity:r,factor:s}}(e,t);case"gradient":return function(e,t){let{gradientType:i,smooth:n,colors:r,steps:s,angle:a,offset:o,morph:l}=e;return{...IP(e,t),gradientType:i,smooth:n,colors:r.map((e=>new ki(e[0],e[1],e[2],e[3]))),num:r.length,steps:s,offset:new pi(...o),morph:new pi(...l),angle:a}}(e,t);case"depth":return function(e,t){let{gradientType:i,near:n,far:r,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:c,steps:h,smooth:d}=e;return{...IP(e,t),gradientType:i,near:n,far:r,isVector:s,isWorldSpace:a,origin:new Vi(...o),direction:l?new Vi(...l):new Vi(1,0,0),colors:c.map((e=>void 0!==e?new ki(e[0],e[1],e[2],e[3]):new ki(0,0,0,0))),steps:h.slice(0,c.length),smooth:d}}(e,t);case"normal":return function(e,t){let{cnormal:i}=e;return{...IP(e,t),cnormal:new Vi(i[0],i[1],i[2])}}(e,t);case"noise":return function(e,t){return{...IP(e,t),scale:e.scale,move:e.move,fA:new pi(...e.fA),fB:new pi(...e.fB),size:new Vi(...e.size),distortion:new pi(...e.distortion),colorA:EP(e.colorA,t),colorB:EP(e.colorB,t),colorC:EP(e.colorC,t),colorD:EP(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}(e,t);case"rainbow":return function(e,t){return{...IP(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new Vi(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new Vi(...e.offset)}}(e,t);case"toon":return function(e,t){return{...IP(e,t),positioning:e.positioning,colors:e.colors.map((e=>new ki(e[0],e[1],e[2],e[3]))),num:e.colors.length,steps:e.steps,source:new Vi(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:EP(e.shadowColor,t),offset:new Vi(...e.offset)}}(e,t);case"outline":return function(e,t){return{...IP(e,t),outlineColor:EP(e.outlineColor,t),contourColor:EP(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new Vi(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}(e,t);case"transmission":return function(e,t){return{...IP(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}(e,t);case"color":return function(e,t){return{...IP(e,t),color:EP(e.color,t)}}(e,t);case"pattern":return function(e,t){return{...IP(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new pi(...e.offset),colorA:EP(e.colorA,t),colorB:EP(e.colorB,t),frequency:new pi(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new pi(...e.vertical),horizontal:new pi(...e.horizontal),sides:e.sides}}(e,t)}}function TP(e){return{type:e.type}}function IP(e,t){let{alpha:i,mode:n,isMask:r}=e,s="string"==typeof i?(Number(t.getVariable(i))??100)/100:i;return{...TP(e),alpha:s,mode:n,isMask:r}}var PP=class extends fT{},DP={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},RP={depth:["colors"]};function BP(e,t,i){if("isMask"===t)return!0;let n=DP[e.type],r=RP[e.type];if(void 0!==r){let n=e.color;if(r.includes(t)){let e=n[t]?.value?.length;if(void 0!==e&&e!==i.length)return!0}}return void 0!==n&&n.includes(t)}function LP(e,t,i){let n=i.uniforms[`f${i.id}_texture`];if(!n)return!1;let r=!1,s=e;if("image"in s){let e=s.image,i=t.image(e),r=n;r.image instanceof $I||r.image.deref(),r.image=i}if("video"in s){let e=s.video,i=t.video(e),r=n;r.image instanceof $I||r.image.deref(),r.image=i}if("wrapping"in s){n.wrap=s.wrapping}if("minFilter"in s){n.minFilter=s.minFilter}if("magFilter"in s){n.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*ui.DEG2RAD,r;if("repeat"in s||"offset"in s||"rotation"in s){let e="mat",t=i.uniforms[`f${i.id}_${e}`];"repeat"in s&&(t.repeat=s.repeat),"offset"in s&&(t.offset=s.offset),"rotation"in s&&(t.rotation=s.rotation??0),t.updateMatrix()}return r}var OP=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable("number"==typeof e?100*e:e,i)??100)/100))??1,NP=class{constructor(e,t,i,n,r){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in n)this.uniforms[`f${this.id}_${s}`]=n[s];for(let s in i)jP(s,this,i,r)}get type(){return this.data.type}static create(e,t,i,n){if("light"===i.type)return UP.createLightLayer(e,t,i,n);if("texture"===i.type||"video"===i.type){let r="texture"===i.type?n.uiBuffer(i.texture.image)??n.image(i.texture.image):n.video(i.texture.video),s=new nI(r,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new iI(r),o=new oI(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new PT(i.crop?1:0),c=new ZT(i.projection??0),h=new ZT(["x","y","z"].indexOf(i.axis)??0),d=new ZT(i.side??0),u=new uT(i.size?new pi(i.size[0],i.size[1]):new pi(100,100)),p=new PT(i.blending??0),f=new PT(OP(i.alpha,n)),m=new ZT(i.mode??0),g=new $T(i.isMask??!1),v=new mI(s,a,l,c,h,d,u,p,o,f,m,g),y=new TT(v.calpha,"f");return new kP(e,t,i,{texture:s,textureSize:a,crop:l,projection:c,axis:h,side:d,size:u,blending:p,mat:o,alpha:f,mode:m,isMask:g},v,m,y,g,n)}if("matcap"===i.type){let r=n.image(i.texture.image),s=new nI(r,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new PT(OP(i.alpha,n)),o=new ZT(i.mode??0),l=new $T(i.isMask??!1),c=new PT((i.texture.rotation??0)*ui.DEG2RAD),h=new wI(s,a,o,l,c),d=new TT(h.calpha,"f");return new kP(e,t,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},h,o,d,l,n)}if("displace"===i.type){if("noise"===i.displacementType){let r=new pT(new Vi(...i.offset)),s=new PT(i.scale??10),a=new PT(i.intensity??8),o=new PT(i.movement??1),l=new ZT(i.noiseType??0),c=new ZT(i.voronoiStyle??0),h=new PT(i.smoothness??.5),d=new PT(i.seed??0),u=new PT(i.highCut??1),p=new PT(i.lowCut??0),f=new ZT(i.quality??1),m=new FI(a,o,r,c,h,d,u,p,f,s,l);return new FP(e,t,i,{offset:r,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:h,seed:d,highCut:u,lowCut:p,quality:f},m,n)}throw new Error}return function(e,t,i,n){let r=MP(i,n);return function(e,t,i,n,r){switch(e.type){case"color":{let s=new JT(n.color??SA),a=zP(n),o=new dI(s,a.alpha),l=new TT(o.calpha,"f");return new kP(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,r)}case"fresnel":{let s=new JT(n.color??16777215),a=new PT(n.bias??.1),o=new PT(n.scale??1),l=new PT(n.intensity??2),c=new PT(n.factor??1),h=zP(n),d=new yI(s,a,o,l,c,h.alpha,h.mode,h.isMask),u=new TT(d.calpha,"f");return new kP(t,i,e,{color:s,bias:a,scale:o,intensity:l,factor:c,...h},d,h.mode,u,h.isMask,r)}case"rainbow":{let s=new PT(n.filmThickness??30),a=new PT(n.movement??0),o=new pT(n.wavelengths??new Vi(0,0,0)),l=new PT(n.noiseStrength??0),c=new PT(n.noiseScale??1),h=new pT(n.offset??new Vi(0,0,0)),d=zP(n),u=new PI(s,a,o,l,c,h,d.alpha,d.isMask),p=new TT(u.calpha,"f");return new kP(t,i,e,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:c,offset:h,...d},u,d.mode,p,d.isMask,r)}case"transmission":{let s=new PT(n.thickness??10),a=new PT(n.ior??1.5),o=new PT(n.roughness??.5),l=UI.transmissionSize,c=UI.transmissionRenderTarget,h=UI.transmissionRenderTargetDepth,d=window.innerWidth,u=window.innerHeight,p=d>=u?new uT(u/d,1):new uT(1,d/u),f=zP(n),m=new OI(s,a,o,l,c,h,p,f.alpha),g=new TT(m.calpha,"f");return new kP(t,i,e,{thickness:s,ior:a,roughness:o,aspectRatio:p,...f},m,f.mode,g,f.isMask,r)}case"toon":{let s,a,o=new ZT(n.positioning??0);n.colors?s=new lI(n.colors.length,n.colors):(s=new lI(10,new ki(0,0,0,1)),s.value[1]=new ki(1,1,1,1)),n.steps?a=new eI(n.steps.length,n.steps):(a=new eI(10,1),a.value[0]=0);let l=new pT(n.source??new Vi(0,0,0)),c=new $T(n.isWorldSpace??!0),h=new PT(n.noiseStrength??0),d=new PT(n.noiseScale??1),u=new mT(n.shadowColor),p=new pT(n.offset??new Vi(0,0,0)),f=zP(n),m=new RI(o,s,a,l,c,h,d,u,p,f.alpha),g=new TT(m.calpha,"f");return new kP(t,i,e,{positioning:o,colors:s,steps:a,source:l,isWorldSpace:c,noiseStrength:h,noiseScale:d,shadowColor:u,offset:p,...f},m,f.mode,g,f.isMask,r)}case"outline":{let s=new JT(n.outlineColor??16777215),a=new JT(n.contourColor??16777215),o=new PT(n.outlineWidth??.1),l=new PT(n.contourWidth??.1),c=new PT(n.outlineThreshold??.1),h=new PT(n.contourThreshold??.1),d=new PT(n.outlineSmoothing??.1),u=new PT(n.contourFrequency??.1),p=new pT(n.contourDirection??new Vi(0,1,0)),f=new $T(n.positionalLines??!1),m=new $T(n.compensation??!0),g=UI.normalRenderTarget,v=UI.normalRenderTargetDepth,y=UI.pixelRatioNode,b=UI.resolution,A=zP(n),x=new CI(s,a,o,l,c,h,d,u,p,f,m,b,g,v,y,A.alpha),w=new TT(x.calpha,"f");return new kP(t,i,e,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:h,outlineSmoothing:d,contourFrequency:u,contourDirection:p,positionalLines:f,compensation:m,...A},x,A.mode,w,A.isMask,r)}case"depth":{let s,a,o=new ZT(n.gradientType??0),l=new $T(n.smooth??!1),c=new PT(n.near??50),h=new PT(n.far??200),d=new PT(n.isVector??1),u=new PT(n.isWorldSpace??0),p=new pT(n.origin??new Vi),f=new pT(n.direction??new Vi);n.colors?s=new lI(n.colors.length,n.colors):(s=new lI(2,new ki(0,0,0,1)),s.value[1]=new ki(1,1,1,1)),n.steps?a=new eI(n.steps.length,n.steps):(a=new eI(2,1),a.value[0]=0);let m=zP(n),g=new vI(o,l,c,h,d,u,p,f,s,a,m.alpha,m.isMask),v=new TT(g.calpha,"f");return new kP(t,i,e,{gradientType:o,smooth:l,near:c,far:h,isVector:d,isWorldSpace:u,origin:p,direction:f,colors:s,steps:a,...m},g,m.mode,v,m.isMask,r)}case"noise":{let s=new PT(n.scale??1),a=new pT(n.size??new Vi(100,100,100)),o=new PT(n.move??1),l=new uT(n.fA??new pi(1.7,9.2)),c=new uT(n.fB??new pi(8.3,2.8)),h=new uT(n.distortion??new pi(1,1)),d=new mT(n.colorA),u=new mT(n.colorB),p=new mT(n.colorC),f=new mT(n.colorD),m=new ZT(n.noiseType??0),g=new ZT(n.voronoiStyle??0),v=new PT(n.highCut??1),y=new PT(n.lowCut??0),b=new PT(n.smoothness??.5),A=new PT(n.seed??.5),x=new ZT(n.quality??1),w=zP(n),S=new _I(s,a,o,l,c,h,d,u,p,f,w.alpha,m,w.isMask,g,v,y,b,A,x),_=new TT(S.calpha,"f");return new kP(t,i,e,{scale:s,size:a,move:o,fA:l,fB:c,distortion:h,colorA:d,colorB:u,colorC:p,colorD:f,noiseType:m,...w,voronoiStyle:g,highCut:v,lowCut:y,smoothness:b,seed:A,quality:x},S,w.mode,_,w.isMask,r)}case"normal":{let s=new pT(n.cnormal??new Vi(1,1,1)),a=zP(n),o=new pI(s,a.alpha),l=new TT(o.calpha,"f");return new kP(t,i,e,{cnormal:s,...a},o,a.mode,l,a.isMask,r)}case"gradient":{let s,a,o=new ZT(n.gradientType??0),l=new $T(n.smooth??!1);n.colors?s=new lI(n.colors.length,n.colors):(s=new lI(10,new ki(0,0,0,1)),s.value[1]=new ki(1,1,1,1)),n.steps?a=new eI(n.steps.length,n.steps):(a=new eI(10,1),a.value[0]=0);let c=new uT(n.offset??new pi(0,0)),h=new uT(n.morph??new pi(0,0)),d=new PT(n.angle??0),u=zP(n),p=new AI(o,l,s,a,c,h,d,u.alpha,u.isMask),f=new TT(p.calpha,"f");return new kP(t,i,e,{gradientType:o,smooth:l,colors:s,steps:a,offset:c,morph:h,angle:d,...u},p,u.mode,f,u.isMask,r)}case"pattern":{let s=new ZT(n.style??0),a=new ZT(n.projection??0),o=new ZT(["x","y","z"].indexOf(n.axis)??0),l=new PT(n.blending??0),c=new uT(n.offset??new pi(0,0)),h=new mT(n.colorA),d=new mT(n.colorB),u=new uT(n.frequency??new pi(10,10)),p=new PT(n.size??.5),f=new PT(n.variation??0),m=new PT(n.smoothness??.5),g=new PT(n.zigzag??0),v=new PT(n.rotation??0),y=new uT(n.vertical??new pi(0,1)),b=new uT(n.horizontal??new pi(0,1)),A=new ZT(n.sides??6),x=zP(n),w=new TI(s,a,o,l,c,h,d,u,p,f,m,g,v,y,b,A,x.alpha,x.isMask),S=new TT(w.calpha,"f");return new kP(t,i,e,{style:s,projection:a,axis:o,blending:l,offset:c,colorA:h,colorB:d,frequency:u,size:p,variation:f,smoothness:m,zigzag:g,rotation:v,vertical:y,horizontal:b,sides:A,...x},w,x.mode,S,x.isMask,r)}default:{let s=new JT(1,0,0,1),a=zP(n),o=new dI(s,a.alpha),l=new TT(o.calpha,"f");return new kP(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,r)}}}(i,e,t,r,n)}(e,t,i,n)}updateByOp(e,t,i){let n=e;if(void 0===n.path[0]){if(0===n.type)return"type"in n.props||"category"in n.props||"visible"in n.props||"noiseType"in n.props?(i.scene.markNeedsUpdateRendererDirty(),!0):function(e,t,i,n){let r=!1;for(let[s,a]of Object.entries(e)){if("bumpMap"===s||"roughnessMap"===s){r=!0;continue}if(!s||void 0===a)continue;if(jP(s,i,n,t)){"visible"===s&&"light"===i.type&&(r=!0);continue}i.visible=n.visible;let e=i.uniforms[`f${i.id}_${s}`];if(e&&!(e instanceof tI))switch(r=r||BP(i,s,a),e.constructor){case JT:if("string"==typeof a){let i=t.getColor(a);i&&(e.value=i);break}{let t=a;e.value instanceof PP?e.value=new fT(t.r,t.g,t.b,t.a):e.setRGBA(t);break}case mT:if("string"==typeof a){let i=t.getColor(a);i&&(e.value=i);break}{let t=a;e.value instanceof PP?e.value=new fT(t.r,t.g,t.b,t.a):e.value.setRGBA(t.r,t.g,t.b,t.a);break}case uT:{let t=a;e.value.setX(t[0]),e.value.setY(t[1]);break}case pT:{let t=a;e.value.setX(t[0]),e.value.setY(t[1]),e.value.setZ(t[2]);break}case IT:LP(a,t,i);break;case lI:e.value=a.map((e=>new ki(...e)));break;default:e.value=a}}return r}(n.props,i.shared,this,t)}else if("texture"===n.path[0])return!("texture"in t)&&!("video"in t)||LP(n.props,i.shared,this);return!1}dispose(){if(function(e){let t=e instanceof NP?e.type:e;return"texture"===t||"video"===t||"displace_map"===t||"matcap"===t}(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof $I||t.image.deref()}}hasValueByKey(e){return void 0!==this.uniforms[e]}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&void 0!==t&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},kP=class extends NP{constructor(e,t,i,n,r,s,a,o,l){super(e,t,i,n,l),this.params=n,this.color=r,this.mode=s,this.alpha=a,this.isMask=o}},FP=class extends NP{constructor(e,t,i,n,r,s){super(e,t,i,n,s),this.position=r}},UP=class extends NP{constructor(e,t,i,n,r,s){super(e,t,i,r,s),this.node=n}static createLightLayer(e,t,i,n){let r,s,a=new PT(OP(i.alpha,n)),o=new ZT(i.mode),l=new PT(i.bumpMapIntensity),c=new PT(OP(i.alphaOverride,n));if(i.visible)if("lambert"===i.category){r=new GI;let e=new JT(n.color(i.emissive)??0),t=new $T(i.occlusion??!0);s={emissive:e,occlusion:t},r.emissive=e,r.occlusion=t}else if("toon"===i.category){r=new qI;let e=new PT(i.shininess??30),t=new JT(n.color(i.specular)??1118481);s={shininess:e,specular:t},r.shininess=e,r.specular=t}else if("physical"===i.category){r=new QI;let e=new PT(i.roughness??.3),t=new PT(i.metalness??0),n=new PT(i.reflectivity??.5),a=new $T(i.occlusion??!0);s={roughness:e,metalness:t,reflectivity:n,occlusion:a},r.roughness=e,r.metalness=t,r.reflectivity=n,r.occlusion=a}else{r=new WI;let e=new PT(i.shininess??30),t=new JT(void 0!==i.specular?n.color(i.specular)??1118481:1118481),a=new $T(i.occlusion??!0);s={shininess:e,specular:t,occlusion:a},r.shininess=e,r.specular=t,r.occlusion=a}else r=new VI,s={};return r.alpha=new PT(1),r.shadingAlpha=a,r.shadingBlend=o,r.bumpMapIntensity=l,r.alphaOverride=c,s.alpha=r.shadingAlpha,s.mode=r.shadingBlend,s.bumpMapIntensity=r.bumpMapIntensity,s.alphaOverride=r.alphaOverride,new UP(e,t,i,r,s,n)}get category(){return this.node.category}};function zP(e){return{alpha:new PT(e.alpha??1),mode:new ZT(e.mode??0),isMask:new $T(e.isMask??!1)}}function jP(e,t,i,n){if("displace"===i.type&&("intensity"===e||"visible"===e)){let e=t.uniforms[`f${t.id}_intensity`];return e?(e.value=i.intensity*(i.visible?1:0),e):void 0}if("displace"!==i.type&&("alpha"===e||"visible"===e)){let r=t.uniforms[`f${t.id}_alpha`];if(!r)return;if(r.value=OP(i.alpha,n)*(i.visible?1:0),"outline"===i.type&&"visible"===e){let e=t.uniforms[`f${t.id}_compensation`];e&&(e.value=i.compensation&&i.visible)}return r}}function VP(e,t){let i=0,n=e.layers.find((e=>"light"===e.data.type));if(n){let e=n.data,i=Number(t.getVariable(e.alphaOverride));if(("string"==typeof e.alphaOverride?i/100:e.alphaOverride)<1)return!0}for(let r of e.layers){if("displace"!==r.data.type&&r.data.isMask)return!0;if("displace"!==r.data.type&&"alpha"in r.data&&"light"!==r.data.type&&"fresnel"!==r.data.type&&"texture"!==r.data.type&&"matcap"!==r.data.type&&"rainbow"!==r.data.type&&"outline"!==r.data.type&&"pattern"!==r.data.type){let e=r.data.visible?r.data.alpha:0;if("string"==typeof e&&(e=Math.max(0,Math.min(1,Number(t.getVariable(e)??100)/100))),1===e&&"depth"===r.data.type||"gradient"===r.data.type){for(let t of r.data.colors)if(t[3]<1){e=t[3];break}}else if(1===e&&"noise"===r.data.type){let i=t.color(r.data.colorA).a,n=t.color(r.data.colorB).a,s=t.color(r.data.colorC).a,a=t.color(r.data.colorD).a,o=Math.min(i,Math.min(n,Math.min(s,a)));o<1&&(e=o)}i+=(1-i)*e}}return i<1}var GP=class extends Ur{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},HP=class extends GP{constructor(e,t,i,n){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=n}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,Object.assign(this.defines,e.defines),Object.assign(this.uniforms,e.uniforms),this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i,n){return this.root.getFlavor(e,t,i,n)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},WP=class extends GP{constructor(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=t.shared.needsJitter,oT.startContext(this),this.reset0(e,t),oT.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i,n){let r=i?6:(e?3:0)+t;if(r+=7*((n?.resolutionLevel??0)-(n?.useChildrenColors?4:0)),0===r)return this;void 0===this.flavors&&(this.flavors=[]),r-=1;let s=this.flavors[r];return void 0===s&&(s=new HP(e,t,i,this),s.needsJitter=this.needsJitter,this.flavors[r]=s,s.flatShading=e,s.side=t,s.updateAfterBuild(),n&&(s.defines.SHAPEBLEND=n.resolutionLevel,s.defines.SHAPEBLEND_C=n.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){return this.lightLayer.getNode("occlusion")?.value??!1}reset(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];oT.startContext(this),(this.data!==e||i)&&this.reset0(e,t),oT.endContext(this)}reset0(e,t){this.data=e;let i=e.layers??GA.defaultTwoLayerData("phong").layers;try{this.layers=i.map((e=>NP.create(this.layerIdGen++,e.id,e.data,t.shared)))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=VP(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if("alphaOverride"===e[0])this.transparent=VP(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if("layer"===e[0]){let n=e[1],r=e[2];if(n&&r){let e=this.layers.find((e=>e.uuid===n));e?.hasValue(r)&&("alpha"===r?(this.transparent=VP(this.data,i.shared),e.setValue(r,Math.max(0,Math.min(Number(t)/100,1)))):e.setValue(r,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find((e=>"light"===e.data.type));t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach((t=>{"alpha"in t.data&&"string"==typeof t.data.alpha&&e.shared.getVariable(t.data.alpha,["material",this.uuid,"layer",t.id,"alpha"])}))}getLayersOfType(e){return this.layers.filter((t=>t.type===e))}getLayerByUuid(e){return this.layers.find((t=>t.uuid===e))}onUpdate(e){this.lightLayer=this.layers.find((e=>e instanceof UP)),void 0===this.lightLayer&&(this.lightLayer=new UP(0,"",{...VA.defaultData("light","phong"),visible:!1},new VI,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find((e=>e instanceof UP));if(!e)return;let t=e.data,i=t.bumpMap,n=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let r=0;r<this.layers.length;++r){let t=this.layers[r];t instanceof kP&&t.color instanceof mI&&(t.uuid===i&&(e.node.bumpMap=t.color),t.uuid===n&&(e.node.roughnessMap=t.color))}}updateByOp(e,t,i){if(oT.startContext(this),void 0!==t?this.data=t:t=this.data,this.transparent=VP(t,i.shared),"layers"===e.path[0]){let n=i.shared,r=e.path[1];if(void 0===r)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{0===e.type&&void 0!==e.props.occlusion&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find((e=>e.uuid===r));if(s){let a,o=t.layers.data(r);0===e.type&&("alpha"in e.props||"alphaOverride"in e.props)&&(a="alpha"in e.props?{...e.props,alpha:OP(e.props.alpha,n,["material",this.uuid,"layer",r,"alpha"])}:{...e.props,alphaOverride:OP(e.props.alphaOverride,n,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...e,...a?{props:a}:{},path:e.path.slice(2)},o,i)&&this.reset0(t,i)}}}else this.reset0(t,i);oT.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof kP?t.color.mask=void 0:t instanceof UP&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof kP&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,n=this.layers[i];n instanceof UP?n.node.mask=new BT(t.color,t.alpha,BT.MUL):n instanceof kP&&(n.isMask.value||(n.color.mask=new BT(t.color,t.alpha,BT.MUL)))}}}blendColors(){let e=this.layers.findIndex((e=>e instanceof kP)),t=this.layers.findIndex((e=>e instanceof UP));if(-1!==e&&e<t){let i=this.layers[e].color;for(let n=e+1;n<t;++n){let e=this.layers[n];if(e instanceof kP){if(e.isMask.value)continue;i=new cI(i,e.color,e.alpha,e.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new TT("outgoingLight","f"),t=this.layers.findIndex((e=>e instanceof UP));if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let t=this.layers[i];if(t instanceof kP){if(t.isMask.value)continue;e=new cI(e,t.color,t.alpha,t.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter((e=>e instanceof FP));if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new BT(t,e[i].position,BT.ADD),t=new BT(t,new PT(.5).setReadonly(!0),BT.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.shapeBlendhack&&this.shapeBlendhack(this),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}clampUniformsForPreview(e,t){let i=(e,t,i)=>Math.min(Math.max(e,t),i);for(let n of this.layers)if("displace"===n.type){let r=i(n.uniforms[`f${n.id}_intensity`].value,e,t);n.uniforms[`f${n.id}_intensity`].value=r}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new KT;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach((e=>e.dispose())),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof kP){let t=e.params.texture;if(t instanceof nI&&!t.image.loaded)return!1}return!0}};Object.defineProperties(GP.prototype,{properties:{get:function(){return this.fragment.properties}}});var QP=class extends WP{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},qP=new Map;function XP(e){if("string"==typeof e)return e;let t=qP.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},qP.set(e,t)),t.url}var YP,KP,JP,ZP=new Promise((e=>{YP=e})),$P=!1;function eD(){if(!$P)return KP||(KP=async function(){await i.e(519).then(i.bind(i,5519)),YP(void 0!==window?window:global),$P=!0}())}function tD(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{if(void 0===i.events||!1===Array.isArray(i.events))return!0;let n=[];i.events.forEach((e=>{"dragDropActions"in e.data?(n.push(...e.data.dragDropActions.drag),n.push(...e.data.dragDropActions.drop)):"inActions"in e.data?(n.push(...e.data.inActions),n.push(...e.data.outActions)):"gameActions"in e.data?(n.push(...e.data.gameActions.idle),n.push(...e.data.gameActions.move),n.push(...e.data.gameActions.jump),n.push(...e.data.gameActions.run)):"breakpoints"in e.data?e.data.breakpoints.forEach((e=>{n.push(...e.data.actions)})):"actions"in e.data&&n.push(...e.data.actions),t=t||n.some((e=>"Audio"===e.data.type))}))})),t}ZP.then((e=>JP=e));var iD,nD,rD=class{constructor(e){let t,{src:i,volume:n,delay:r,loop:s}=e;this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)},t="string"==typeof i?{src:i}:{src:XP(i),format:"wav"},this.sound=new JP.Howl(t),this.sound.on("end",this.onEnd),this.src=i,void 0!==n&&(this.volume=n),void 0!==r&&(this.delay=r),void 0!==s&&(this.loop=s)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout((()=>{this.sound.play(),this.clearDelay()}),this.delay)}fade(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout((()=>{this.sound.fade(this._volume,0,t),this.clearFade()}),e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){"playing"===this._status||this.sound.playing()||("paused"===this._status?(0===this.sound.seek()?this.replay():this.sound.play(),this._status="playing"):"stopped"===this._status&&(this.replay(),this._status="playing"))}pause(){"playing"===this._status&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},sD=class{constructor(){this.type="ShapePath",this.color=new Pi,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Tl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath?.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath?.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,r,s){return this.currentPath?.bezierCurveTo(e,t,i,n,r,s),this}splineThru(e){return this.currentPath?.splineThru(e),this}toShapes(){let e=0,t=1,i=2,n=3,r=4,s=5,a=6,o={loc:e,t:0};function l(t,n,r,s){let a=t.x,l=n.x,h=r.x,d=s.x,u=t.y,p=n.y,f=r.y,m=s.y,g=(d-h)*(u-f)-(m-f)*(a-h),v=(m-f)*(l-a)-(d-h)*(p-u),y=g/v,b=((l-a)*(u-f)-(p-u)*(a-h))/v;if(0===v&&0!==g||y<=0||y>=1||b<0||b>1)return null;if(0===g&&0===v){for(let h=0;h<2;h++){if(c(0===h?r:s,t,n),o.loc===e){let e=0===h?r:s;return{x:e.x,y:e.y,t:o.t}}if(o.loc===i){return{x:+(a+o.t*(l-a)).toPrecision(10),y:+(u+o.t*(p-u)).toPrecision(10),t:o.t}}}return null}for(let i=0;i<2;i++)if(c(0===i?r:s,t,n),o.loc===e){let e=0===i?r:s;return{x:e.x,y:e.y,t:o.t}}return{x:+(a+y*(l-a)).toPrecision(10),y:+(u+y*(p-u)).toPrecision(10),t:y}}function c(l,c,h){let d,u=h.x-c.x,p=h.y-c.y,f=l.x-c.x,m=l.y-c.y,g=u*m-f*p;return l.x===c.x&&l.y===c.y?(o.loc=e,void(o.t=0)):l.x===h.x&&l.y===h.y?(o.loc=t,void(o.t=1)):void(g<-Number.EPSILON?o.loc=n:g>Number.EPSILON?o.loc=r:u*f<0||p*m<0?o.loc=s:Math.sqrt(u*u+p*p)<Math.sqrt(f*f+m*m)?o.loc=a:(d=0!==u?f/u:m/p,o.loc=i,o.t=d))}function h(e,t,i){let n=new pi;t.getCenter(n);let r=[];return i.forEach((t=>{t.boundingBox.containsPoint(n)&&function(e,t){let i=[],n=[];for(let r=1;r<e.length;r++){let s=e[r-1],a=e[r];for(let e=1;e<t.length;e++){let r=l(s,a,t[e-1],t[e]);null!==r&&void 0===i.find((e=>e.t<=r.t+Number.EPSILON&&e.t>=r.t-Number.EPSILON))&&(i.push(r),n.push(new pi(r.x,r.y)))}}return n}(e,t.points).forEach((e=>{r.push({identifier:t.identifier,isCW:t.isCW,point:e})}))})),r.sort(((e,t)=>e.point.x-t.point.x)),r}let d=0,u=999999999,p=-999999999,f=[];this.subPaths.forEach((e=>{let t=e.getPoints(),i=-999999999,n=999999999,r=-999999999,s=999999999;for(let a=0;a<t.length;a++){let e=t[a];e.y>i&&(i=e.y),e.y<n&&(n=e.y),e.x>r&&(r=e.x),e.x<s&&(s=e.x)}p<=r&&(p=r+1),u>=s&&(u=s-1),t.length&&f.push({curves:e.curves,points:t,isCW:ac.isClockWise(t),identifier:d++,boundingBox:new Ih(new pi(s,n),new pi(r,i))})}));let m=f.map((e=>function(e,t,i,n,r){(null==r||""===r)&&(r="nonzero");let s=new pi;e.boundingBox.getCenter(s);let a=h([new pi(i,s.y),new pi(n,s.y)],e.boundingBox,t);a.sort(((e,t)=>e.point.x-t.point.x));let o=[],l=[];a.forEach((t=>{t.identifier===e.identifier?o.push(t):l.push(t)}));let c=o[0].point.x,d=[],u=0;for(;u<l.length&&l[u].point.x<c;)d.length>0&&d[d.length-1]===l[u].identifier?d.pop():d.push(l[u].identifier),u++;if(d.push(e.identifier),"evenodd"===r){let t=d.length%2===0,i=d[d.length-2];return{identifier:e.identifier,isHole:t,for:i}}if("nonzero"===r){let i=!0,n=null,r=null;for(let e=0;e<d.length;e++){let s=d[e];t[s]&&(i?(r=t[s].isCW,i=!1,n=s):r!==t[s].isCW&&(r=t[s].isCW,i=!0))}return{identifier:e.identifier,isHole:i,for:n}}console.warn('fill-rule: "'+r+'" is currently not implemented.')}(e,f,u,p,this.userData?.style.fillRule))),g=[];return f.forEach((e=>{let t=m[e.identifier];if(t&&!t.isHole){let t=new Ll;t.curves=e.curves,m.filter((t=>t?.isHole&&t.for===e.identifier)).forEach((e=>{if(e){let i=f[e.identifier],n=new Tl;n.curves=i.curves,t.holes.push(n)}})),g.push(t)}})),g}},aD=!1,oD=new Promise((e=>{iD=e})),lD=!1;function cD(){if(aD=!0,!lD)return nD||(nD=async function(){let e=await i.e(946).then(i.bind(i,8946));iD(e),lD=!0}(),nD)}var hD=new class{async load(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},{load:n}=await oD;n(e,((e,n)=>{e||!n?i(e??"Something went wrong"):t(n)}))}async parse(e){let{parse:t,Bidi:i}=await oD;try{let n=t(e),r=new i,s=e=>n.charToGlyphIndex(e.char);return r.registerModifier("glyphIndex",null,s),r.applyFeatures(n,n.defaultRenderOptions.features),{font:n,bidi:r}}catch(oA){console.error(oA)}}};async function dD(e){let t,i,n=!1;if(e.url?(t=await async function(e){return await(await fetch(e)).arrayBuffer()}(e.url),i=e.url,n=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t){if(!aD)return{font:void 0,url:i,intercepted:n,arr:t,bidi:null};{let e=await hD.parse(t);if(e)return{font:e.font,url:i,intercepted:n,arr:t,bidi:e.bidi}}}}function uD(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var pD=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=dD(e).then((e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)}))}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=dD(e).then((e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)}))}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let n=this._bidi;n.getTextGlyphs(t);let r=n.tokenizer.tokens,s=[],a=0,o=i.length===r.length;for(let l=0;l<i.length;l++){let n=i[l].index,c=String.fromCharCode(i[l].unicode),h=r[a];if(uD(n,h)||o)s.push({char:c,index:n,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let i=h.char,r="",o=[h.state.glyphIndex],l=[],d=!1;for(;!d;)a++,r=t.charAt(a),i+=r,o.push(e.charToGlyphIndex(r)),l=e.stringToGlyphs(i),1===l.length&&l[0].index===n&&(d=!0),a>t.length&&(d=!0);s.push({char:c,index:n,replacements:o,replacementChars:Array.from(i)}),a++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let i,n=this.font,r=t.fontSize/this.unitsPerEm,s=t.fontSize*t.lineHeight,a=e.map((e=>this.getTextWidth(e,t))),o=t.width,l=this.getCharWidth("\n",t),c=1===t.horizontalAlign?l:0,h=this.computeSpaceWidthForLine(e,0,t),d=this.getLineInitialOffsetX(a[0],o,t.horizontalAlign,e[0],l),u=this.getLineInitialOffsetY(s,e.length,t.height,r,t.verticalAlign),p=[],f=e.map((e=>[])),m=e.map((e=>[]));for(let y=0;y<e.length;y++){let g=e[y],b={features:{liga:!0}},A=[];try{A=n.stringToGlyphs(g,b)}catch(v){console.warn(v)}d=this.getLineInitialOffsetX(a[y],o,t.horizontalAlign,g,l);let x=[];try{x=this.reverseLigaturesTable(n,g,A)}catch(v){console.warn(v)}h=this.computeSpaceWidthForLine(e,y,t);for(let e=0;e<A.length;e++){let s=A[e],a=0===s.index?"\n":s.unicode?String.fromCharCode(s.unicode):void 0,o=x[e],l=0,g=0;0===e&&2===t.horizontalAlign&&void 0!==s.leftSideBearing&&(g=-s.leftSideBearing*r),i&&(l=n.getKerningValue(s,i)*r),d+=g+l;let v=0;if("\n"===a)v=c;else if(" "===a)v=h;else{let e=this.createPath(s,r,d,u,t);e&&(v=e.offsetX-(l+g),p.push(e.path))}if(1===o.replacements.length)m[y].push([d,u]),f[y].push(v);else{let e=o.replacements.map((e=>(n.glyphs.get(e).advanceWidth??0)*r)),t=e.reduce(((e,t)=>e+t),0),i=e.map((e=>e/t)),s=d;for(let n=0;n<i.length;n++){let e=v*i[n];m[y].push([s,u]),f[y].push(e),s+=e}}d+=v,i=s}u-=s}let g=[];for(let y=0,b=p.length;y<b;y++)g.push(...p[y].toShapes());return{shapes:g,charWidths:f,lineWidths:a,charCoords:m}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){return this.font?.ascender??0}get descender(){return this.font?.descender??0}get familyName(){return this.font?.names.fontFamily??""}get subfamilyName(){return this.font?.names.fontSubfamily??""}get unitsPerEm(){return this.font?.unitsPerEm??1}getLineInitialOffsetX(e,t,i,n,r){return(3===i||2===i)&&n.indexOf("\n")>=0&&(e-=r),3===i?.5*t-.5*e:2===i?t-e:0}getLineInitialOffsetY(e,t,i,n,r){let s=t*e,a=e-Math.abs(this.ascender-this.descender)*n,o=-this.ascender*n-a/2;return 3===r?-(i-s-o):2===r?-(.5*i-.5*s-o):o}createPath(e,t,i,n,r){let s=e.getPath(i,-n,r.fontSize,{kerning:!1,letterSpacing:r.letterSpacing});if(!s)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");let a=new sD,o=(e.advanceWidth??1)*t;if(e)for(let l of s.commands){let e=a.currentPath?.currentPoint;if(!e||"Z"===l.type||e.x!==l.x||-e.y!==l.y)switch(l.type){case"M":a.moveTo(l.x,-l.y);break;case"L":a.lineTo(l.x,-l.y);break;case"Q":a.quadraticCurveTo(l.x1,-l.y1,l.x,-l.y);break;case"C":a.bezierCurveTo(l.x1,-l.y1,l.x2,-l.y2,l.x,-l.y)}}return a.subPaths.forEach((e=>{let t=function(e){if(e.length){let t=e[0];if(t instanceof wl)return t.v1;if(t instanceof Al||t instanceof _l)return t.v0}}(e.curves);void 0!==t&&e.currentPoint.distanceTo(t)>0&&e.lineTo(t.x,t.y)})),{offsetX:o+r.fontSize*r.letterSpacing,path:a}}getCharWidth(e,t){return this.font?.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing})??0}getTextWidth(e,t){return this.font?.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing})??0}computeSpaceWidthForLine(e,t,i){let n=this.getCharWidth(" ",i),r=e[t];if(r){let s=this.countSpaces(r.trimEnd());if(4===i.horizontalAlign&&t<e.length-1&&s){return(i.width-(this.getTextWidth(r,i)-s*n))/s}}return n}countSpaces(e){return(e.match(/ /g)||[]).length}};var fD=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let n=this.objects.get(e);return void 0===n?(n=this.createObject(e,t,i),this.objects.set(e,n)):n.isShared=!0,n}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&!0!==i.isShared)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){t===this.objects.get(e)&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach((e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)})),this.unreachable.clear()}dispose(){this.objects.forEach((e=>{this.disposeObject(e)})),this.objects.clear()}},mD=class extends fD{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let n=bM(e,t,this.flatShading,i);return n.computeBoundingSphere(),n}},gD={markNeedsUpdateRendererDirty:()=>{}},vD=1e3,yD=512e3;var bD="https://hooks.spline.design",AD=`${bD}/events?hashFile=`,xD=class{constructor(e,t){this.id=e,this.userWebhook=t,this.result=void 0,this._connected=!1,this.emitter=KC(),this.reconnectWaitFor=vD,this._onError=e=>{this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=e=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=vD,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=vD,this._connected=!1},this._onMessage=e=>{let t,i=e.data;try{t=JSON.parse(i)}catch(oA){console.error("Error parsing webhook message",oA)}if(t){let e=!1;this.userWebhook.parametersSchemas.forEach((i=>{let{data:n}=i;void 0!==t[n.name]&&function(e,t){let i=typeof e;return!!(("string"===t||"number"===t)&&i===t||"boolean"===t&&("true"===e||"false"===e||!0===e||!1===e)||"image"===t&&"string"===i&&e.startsWith("http"))}(t[n.name],n.type)&&(void 0===this.result&&(this.result={}),this.result[n.name]=t[n.name],e=!0)})),e&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(AD+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this.eventSource?.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>yD&&(this.reconnectWaitFor=yD),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout((()=>{this.scheduledReconnectHandle=void 0,this.connect()}),this.reconnectWaitFor)}update(e){this.userWebhook=e}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}getParametersKeys(){return this.userWebhook.parametersSchemas.map((e=>e.data.name))}getParameterValue(e){if(this.getParametersKeys().includes(e)){if(this.result)return this.result?.[e];for(let t of this.userWebhook.parametersSchemas)if(t.data.name===e)return Bx.defaultParameterValueByType(t.data.type)}}},wD=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],SD=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],_D=[],ED=[];for(let yH=1;yH<=8;yH++)for(let e=0;e<wD.length;e++){let t=wD[e];_D.push(t/Math.pow(2,8-yH)),ED.push(SD[e]+yH)}var CD=[32,2e3],MD=_D.filter(((e,t)=>_D[t]>CD[0]&&_D[t]<CD[1])),TD=ED.filter(((e,t)=>_D[t]>CD[0]&&_D[t]<CD[1])),ID=class{static getFrequencies(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"frequency",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-100,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-30;i||(i=new Float32Array(e.frequencyBinCount),e.getFloatFrequencyData(i));let a,o,l,c=t/2,h=1/i.length*c;if("music"===n||"voice"===n){let e="voice"===n?MD:_D,t=Array(e.length).fill(r);for(let n=0;n<i.length;n++){let r=n*h,s=i[n];for(let i=e.length-1;i>=0;i--)if(r>e[i]){t[i]=Math.max(t[i],s);break}}a=t,o="voice"===n?MD:_D,l="voice"===n?TD:ED}else a=Array.from(i),o=a.map(((e,t)=>h*t)),l=o.map((e=>`${e.toFixed(2)} Hz`));let d=a.map((e=>Math.max(0,Math.min((e-r)/(s-r),1))));return{values:new Float32Array(d),frequencies:o,labels:l}}};var PD=class{constructor(e){this.value=0,this.frequencies=new Float32Array(0);let t=new AudioContext;this.source=t.createMediaStreamSource(e),this.analyser=t.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=8192,this.analyser.smoothingTimeConstant=.1}getFrequencies(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-30;if(!this.analyser)throw new Error("Not connected, please call .connect() first");return ID.getFrequencies(this.analyser,44100,void 0,"voice",e,t)}update(){let e=this.getFrequencies(),t=e.values.reduce(((e,t)=>e+t),0)/e.values.length;this.value=t,this.frequencies=e.values}disconnect(){this.source.disconnect(),this.analyser.disconnect()}},DD=class{constructor(e,t,i){this.data=e,this.id=t,this.shared=i,this.emitter=KC(),this.rafId=0,this.voice=0,this.frequencies=new Float32Array([0]),this.events=[],this.isConnected=!1,this.isToolsAdded=!1,this.tools=[],this.onMessage=e=>{let t=JSON.parse(e.data);if(this.appendEvent(t),"session.created"===t.type&&this.onSessionCreated(),"response.done"===t.type&&t.response?.output)for(let i of t.response.output)if("function_call"===i.type)for(let[e,t]of this.tools)i.name===e.name&&(t(JSON.parse(i.arguments)),setTimeout((()=>{this.sendClientEvent({type:"response.create",response:{instructions:"notice the user about what you just did"}})})))},this.onSessionCreated=()=>{this.isToolsAdded||this.registerTools()},this.onOpen=()=>{this.events=[],this.isConnected=!0,this.sendClientEvent({type:"response.create",response:{instructions:"Say hi"}})},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected&&this.analyser){this.analyser.update();let e=this.analyser.value,t=this.analyser.frequencies;this.voice=e,this.frequencies=t,this.emitter.emit("voice",{value:e,frequencies:t})}}}update(e){this.data=e}setColorByName(e,t){let i=this.shared.getColorByName(e);if(i){let{id:e}=i,{r:n,g:r,b:s}=WC.hexStringToRgb(t)??{r:0,g:0,b:0};this.shared.updateColor(e,{r:n/255,g:r/255,b:s/255})}}async connect(){if(this.isConnected)return;let e=await async function(t){try{return(await(await fetch("https://relayserver.spline.design/session?uuidfile="+t)).json()).token}catch(e){console.error("Token generation error:",e)}}(this.data.integration.hash);this.pc=new RTCPeerConnection,this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.pc.ontrack=e=>{let t=e.streams[0];this.audioElement.srcObject=t,this.analyser=new PD(t)};let t=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc.addTrack(t.getTracks()[0]),this.dc=this.pc.createDataChannel("oai-events"),this.dc.addEventListener("message",this.onMessage),this.dc.addEventListener("open",this.onOpen);let i=await this.pc.createOffer();await this.pc.setLocalDescription(i);let n={type:"answer",sdp:await(await fetch("https://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview-2024-12-17",{method:"POST",body:i.sdp,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/sdp"}})).text()};await this.pc.setRemoteDescription(n),this.animate()}appendEvent(e){this.events=[e,...this.events]}sendClientEvent(e){this.dc?(e.event_id=e.event_id||crypto.randomUUID(),this.dc.send(JSON.stringify(e)),this.appendEvent(e)):console.error("Failed to send message - no data channel available",e)}registerTools(){this.isToolsAdded=!0,this.registerTool({type:"function",name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},(e=>{let{color:t}=e;this.setColorByName("Voice Assistant Color",t)}));let e=this.shared.getVariablesNames().join(", ");this.registerTool({type:"function",name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${e}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},(e=>{let{name:t,value:i}=e,n=this.shared.getVariableByName(t);if(n){let e,t=this.shared.getVariable(n.id);e="number"==typeof t?parseFloat(i):"boolean"==typeof t?"true"===i.toLowerCase():{textValue:i},this.shared.updateVariable(n.id,e)}}));let t=this.shared.getColorNames().join(", ");this.registerTool({type:"function",name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${t}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},(e=>{let{name:t,value:i}=e;this.setColorByName(t,i)}));let i=this.shared.scene,n=[];i.traverseEntity((e=>{e.data.events.forEach((e=>{if("AIAssistantTrigger"===e.data.type){let{description:t}=e.data;n.push(t)}}))})),this.registerTool({type:"function",name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(n)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},(e=>{let{description:t,direction:i}=e;this.emitter.emit("trigger_event",{description:t,direction:i})})),this.sendClientEvent({type:"session.update",session:{tools:this.tools.map((e=>{let[t]=e;return t}))}})}registerTool(e,t){this.tools.push([e,t])}disconnect(){cancelAnimationFrame(this.rafId),this.analyser?.disconnect(),this.voice=0,this.isConnected=!1,this.isToolsAdded=!1,this.dc?.removeEventListener("message",this.onMessage),this.dc?.removeEventListener("open",this.onOpen),this.dc?.close(),this.pc?.getSenders().forEach((e=>{e.track&&e.track.stop()})),this.pc?.close(),this.pc=void 0}computeAnalysisForListenerEvent(e){if("range"===e.analysis){let t=this.frequencies.slice(...e.analysisRange);return t.reduce(((e,t)=>e+t),0)/t.length}return"single"===e.analysis?this.frequencies[e.analysisSingle]:this.voice}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}};function RD(e){return"variable_"+e}var BD=class extends JI{constructor(e){super(),this.shared=e}create(e){return new ZI(e,this.shared)}},LD=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.data=e,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=n,this.geometryCache=new mD(!0),this.geometryCache2=new mD(!1),this.imageHolderCache=new BD(this),this.thisContext={scene:gD,shared:this},this.deletedMaterial=new QP(GA.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new $I(lw.emptyImage,this),this.deletedVideo=new $I(BA.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[r,s]of Object.entries(t.images))this.addImage(r,s);if(t.videos)for(let[r,s]of Object.entries(t.videos))this.addVideo(r,s);if(t.audios)for(let[r,s]of Object.entries(t.audios))this.addAudio(r,s);if(t.particles)for(let[r,s]of Object.entries(t.particles))this.addParticle(r,s);this.reset(e)}setRequestRender(e){this._requestRender=e}getImageLoadPromises(){return Object.values(this.images).map((e=>e.loadPromise))}setEntityOpContext(e){this.entityOpContext=e}reset(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.data=e,this.resetLib(e.lib);for(let{id:i,data:n}of e.variables)this.addVariableHolder(i,n),t&&this.updateVariableHolder(i,n);for(let[i,n]of Object.entries(e.userAPIs))this.addUserAPI(i,n);for(let[i,n]of Object.entries(e.userWebhooks))this.addUserWebhook(i,n);for(let[i,n]of Object.entries(e.images))this.addImage(i,n);for(let[i,n]of Object.entries(e.videos))this.addVideo(i,n);for(let[i,n]of Object.entries(e.colors))this.addColor(i,n);for(let[i,n]of Object.entries(e.materials))this.addMaterial(i,n);for(let[i,n]of Object.entries(e.audios))this.addAudio(i,n);for(let[i,n]of Object.entries(e.particles))this.addParticle(i,n);for(let[i,n]of Object.entries(e.fonts))this.addFont(i,n)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new QP(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return"string"==typeof e?this.getMaterialOrDeletedPlaceholder(e):null==e?(console.error("material is undefined or null"),this.deletedMaterial):new WP(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new $I(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return"string"==typeof e?this.getImage(e):this.imageHolderCache.load(e)}addUIBuffer(e,t){return this.uiBuffers[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[e].updateSrc(t),!0):(this.uiBuffers[e]=new $I(t,this),!1)}uiBuffer(e){return this.uiBuffers[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new $I(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return"string"==typeof e?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):(this.colors[e]=new PP(t.r,t.g,t.b,"a"in t?t.a:1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}getColorNames(){return Object.values(this.data.colors).map((e=>e.name))}getColorByName(e){for(let t in this.data.colors)if(this.data.colors[t].name===e)return{color:this.colors[t],id:t}}color(e){let t;if("string"!=typeof e)return new fT(e.r,e.g,e.b,"a"in e?e.a:1);{let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new fT(0,0,0,0))}return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof rD)return t;{let i=new rD({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof rD&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new pD(t),this.fonts[e].loadingPromise.then((()=>this.requestRender()))}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach((e=>this.deleteMaterial(e))),this._requestRender=void 0,Object.values(this.audios).forEach((e=>{e instanceof rD&&e.dispose()})),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){if(void 0===this.variables[e]){let i=t.value;if(this.enableLocalStorageForPersistentVariables&&t.persistent){let n=localStorage.getItem(RD(e));i=null!==n?JSON.parse(n):t.value}return this.variables[e]={value:i,locations:[],persistent:t.persistent},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0}return this.variables[e].value=t.value,!1}resetDynamicVariablePlayState(){for(let e in this.variables)void 0!==this.variables[e].dynamicVariablePlayState&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(void 0===this.variables[e])return!1;this.variables[e].value=t,this.enableLocalStorageForPersistentVariables&&this.variables[e].persistent&&localStorage.setItem(RD(e),JSON.stringify(t));let i=t;for(;"string"==typeof i;)i=this.variables[i].value;let n=this.entityOpContext.scene;for(let r=this.variables[e].locations.length-1;r>=0;r--){let t=this.variables[e].locations[r];if("material"===t[0]){let e=t[1],r=i,s={scene:n,shared:this},a=t.slice(2);n.traverseMaterial((t=>{let i=t.root??t;i.uuid===e&&i.onVariableUpdate(a,r,s)}));let o=this.materials[e];o&&o.onVariableUpdate(a,r,s)}else{let s=n.find(t[0]);if(void 0===s){this.variables[e].locations.splice(r,1);continue}if("geometry"!==t[1]&&"particles"!==t[1]){for(let e=1;e<t.length-1;e++)s=s[t[e]];"rotation"===t[1]?s[t[t.length-1]]=i*ui.DEG2RAD:s[t[t.length-1]]=i}if(s=n.find(t[0]),"ParticleEmitter"===s.type&&s.updateVariableState(i,t),d_.is(s))if("position"===t[1]||"rotation"===t[1]||"scale"===t[1])s.onVariableUpdate();else if("geometry"===t[1]){let e=s;s.component&&(e=s.component);let t=e.dataPatched;e.chooseGeoemtryCache(this).forceDelete(t.geometry),e.createGeometryDelayed(this.entityOpContext),e.onVariableUpdate(!0),e.invalidateDownstreamBooleanData(),e.instances.forEach((e=>{let t=e.dataPatched;e.chooseGeoemtryCache(this).forceDelete(t.geometry),e.createGeometryDelayed(this.entityOpContext),e.onVariableUpdate(!0),e.invalidateDownstreamBooleanData()}))}else"morphTargetInfluences"===t[1]&&s.updateMorphInfluences(t[2],i)}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){if(Array.isArray(e)){if("mouse"===e[0])return this.mouseProperty?.[e[1]]??0;if("raycast"===e[0])return this.raycastProperty?.[e[1]]??0;let t=this.entityOpContext.scene.find(e[0]);if("width"===e[1]||"height"===e[1]||"depth"===e[1])return t.geometry.userData.parameters[e[1]];for(let i=1;i<e.length;i++)t=t[e[i]];return"rotation"===e[1]&&(t*=ui.RAD2DEG),t}for(let i in this.variables){if(void 0===t)break;let e=this.variables[i],n=e.locations?.findIndex((e=>Kv.equal(e,t)));void 0!==n&&-1!==n&&e.locations.splice(n,1)}if("string"==typeof e){let i=e,n=e;do{if(n=i,void 0===this.variables[i])break;let e=this.variables[i].value;t&&void 0!==this.variables[n]&&this.variables[n].locations.push(t),i=e}while("string"==typeof i);return i}return e}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map((e=>e.data.name))}getVariableByName(e){for(let t of this.data.variables)if(t.data.name===e)return{variable:t.data,id:t.id}}getDynamicVariablePlayState(e){return this.variables[e]?.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){void 0!==this.variables[e]&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){return this.variables[e]?.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){void 0!==this.variables[e]&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){"images"===e.path[0]?1===e.path.length&&1===e.type?this.addImage(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteImage(e.id):"videos"===e.path[0]?1===e.path.length&&1===e.type?this.addVideo(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteVideo(e.id):"audios"===e.path[0]?1===e.path.length&&1===e.type?this.addAudio(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteAudio(e.id):"particles"===e.path[0]?1===e.path.length&&1===e.type?this.addParticle(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteParticle(e.id):"colors"===e.path[0]?1===e.path.length&&1===e.type?this.addColor(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteColor(e.id):"materials"===e.path[0]?1===e.path.length&&1===e.type?this.addMaterial(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteMaterial(e.id):"fonts"===e.path[0]?1===e.path.length&&1===e.type?this.addFont(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteFont(e.id):"variables"===e.path[0]?1===e.path.length&&1===e.type?this.addVariableHolder(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteVariable(e.id):"components"===e.path[0]&&t.updateByLibOp(e,this)}updateByOp(e,t,i){if(this.data=t,"images"===e.path[0])2===e.path.length&&0===e.type?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):1===e.path.length&&1===e.type?this.addImage(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteImage(e.id);else if("videos"===e.path[0])2===e.path.length&&0===e.type?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):1===e.path.length&&1===e.type?this.addVideo(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteVideo(e.id);else if("audios"===e.path[0])2===e.path.length&&0===e.type?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):1===e.path.length&&1===e.type?this.addAudio(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteAudio(e.id);else if("particles"===e.path[0])2===e.path.length&&0===e.type?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):1===e.path.length&&1===e.type?this.addParticle(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteParticle(e.id);else if("colors"===e.path[0])2===e.path.length&&0===e.type?this.updateColor(e.path[1],e.props):1===e.path.length&&1===e.type?this.addColor(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteColor(e.id);else if("materials"===e.path[0])1===e.path.length&&1===e.type?this.addMaterial(e.id,e.data):1===e.path.length&&2===e.type?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(Mv.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i});else if("fonts"===e.path[0])2===e.path.length&&0===e.type?this.updateFont(e.path[1],e,i):1===e.path.length&&1===e.type?this.addFont(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteFont(e.id);else if("variables"===e.path[0])2===e.path.length&&0===e.type?"value"in e.props?this.updateVariable(e.path[1],e.props.value):"persistent"in e.props&&(this.variables[e.path[1]].persistent=e.props.persistent):1===e.path.length&&4===e.type?this.addVariableHolder(e.id,e.data):1===e.path.length&&5===e.type&&this.deleteVariable(e.id);else if("userAPIs"===e.path[0]){if(1===e.path.length&&1===e.type)this.addUserAPI(e.id,e.data);else if(1===e.path.length&&2===e.type)this.deleteUserAPI(e.id);else if("string"==typeof e.path[1]){let i=t.userAPIs[e.path[1]];if(i){let t=0===e.type&&void 0===e.props.debounce,n=this.getUserAPI(e.path[1]);n instanceof DD?n.update(i):n?.update(i,this,t)}}}else if("userWebhooks"===e.path[0]){if(1===e.path.length&&1===e.type)this.addUserWebhook(e.id,e.data);else if(1===e.path.length&&2===e.type)this.deleteUserWebhook(e.id);else if("string"==typeof e.path[1]){let i=t.userWebhooks[e.path[1]];i&&this.getUserWebhook(e.path[1])?.update(i)}}else"lib"===e.path[0]&&this.updateLibByOp(Mv.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let n=this.getFont(e),r={...this.data.fonts[e],url:t.props.url};n.update(r),n.loadingPromise.then((()=>this.requestRender())),i.updateFont(e,this)}}addUserAPI(e,t){return this.userAPIs[e]?(this.userAPIs[e].update(t,this),!0):this.openAIRealtime?.id===e?(this.openAIRealtime.update(t),!0):"VoiceAssistant"===t.integration?.type?(this.openAIRealtime=new DD(t,e,this),!1):(this.userAPIs[e]=new JC(e,t,this),!1)}getUserAPI(e){return this.openAIRealtime?.id===e?this.openAIRealtime:this.userAPIs[e]}getUserAPIs(){return this.userAPIs}deleteUserAPI(e){let t=this.userAPIs[e];t&&(t.dispose(),delete this.userAPIs[e])}addUserWebhook(e,t){return this.userWebhooks[e]?(this.userWebhooks[e].update(t),!0):(this.userWebhooks[e]=new xD(e,t),!1)}getUserWebhook(e){return this.userWebhooks[e]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(e){let t=this.userWebhooks[e];t&&(t.dispose(),delete this.userWebhooks[e])}get scene(){return this.entityOpContext.scene}},OD=(new LD(zx.emptyData()),class extends sT{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),null!==function(e,t){let i=[];if(t.length!==e.length)return null;for(var n=0;n<e.length;){if("*"===t[n])i.push(e[n]);else if(e[n]!==t[n])return null;n+=1}return i}(e.path,["materials"])&&0===e.type&&Array.isArray(this.material))for(let[n,r]of Object.entries(e.props)){let e=i.shared.material(r);this.material[Number(n)]=e}else if(iy(e.path,["material"])&&this.material instanceof GP)"material"in t&&"string"!=typeof t.material&&this.material.updateByOp(Mv.drop(e,1),t.material,i);else if(iy(e.path,["materials","*"])&&Array.isArray(this.material)){let n=e.path[1];if("materials"in t&&n<this.material.length){let r=t.materials[n];"string"!=typeof r&&this.material[n].updateByOp(Mv.drop(e,2),r,i)}}}get needsAO(){return void 0!==this.material&&(Array.isArray(this.material)?this.material[0]:this.material).hasAO}updateState(e,t){super.updateState(e,t),void 0!==e.castShadow&&(this.castShadow=e.castShadow),void 0!==e.receiveShadow&&(this.receiveShadow=e.receiveShadow);let i,n=this.dataPatched;if("Mesh"===this.dataPatched.type&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9),"Mesh"===this.dataPatched.type&&"ShapeBlendGeometry"===this.dataPatched.geometry.type&&(i={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),"NonParametricGeometry"!==e.geometry?.type&&"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(n.flatShading,n.side,n.wireframe,i),t.scene.markNeedsUpdateRendererDirty()),("NonParametricGeometry"===e.geometry?.type||"materials"in e)&&("materials"in e&&void 0!==e.materials?(this.disposeMaterial(),this.material=e.materials.map((e=>t.shared.material(e).getFlavor(n.flatShading,n.side,n.wireframe))),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(n.flatShading,n.side,n.wireframe)],t.scene.markNeedsUpdateRendererDirty())),void 0!==e.flatShading||void 0!==e.wireframe||void 0!==e.side)if(Array.isArray(this.material))for(let r=0;r<this.material.length;r++)this.material[r]=this.material[r].getFlavor(n.flatShading,n.side,n.wireframe);else this.material=this.material.getFlavor(n.flatShading,n.side,n.wireframe,i)}disposeMaterial(){this.material&&Wg(this.material).forEach((e=>{e instanceof GP&&(e instanceof QP||e.nodeMaterialDispose())}))}dispose(){this.disposeMaterial(),super.dispose()}}),ND=new Vi,kD=new ki,FD=new ki,UD=new Vi,zD=new bn,jD=class extends OD{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=(new bn).fromArray(t.bindMatrix),this.bindMatrixInverse=new bn)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof yr&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(void 0!==this.localGeometry)return this.localGeometry;if(this.geometryCreateDeleyed instanceof LD){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return KA.is2DParametricMesh(e.type)&&0===e.depth}get is2DType(){return KA.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return"NonParametricGeometry"===this.geometry.userData.type}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),iy(e.path,["geometry"])&&this.updateByPatchedOpGeometry(Mv.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){this.localGeometry?.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if("NonParametricGeometry"===i||"SubdivGeometry"===i){let i,n,r,s=e;if(void 0===this.localGeometry){let e={...this.data.geometry,...s};this.localGeometry=bM(e,t,this.data.flatShading,this)}s.scaleBaked?[i,n,r]=s.scaleBaked:({width:i,height:n,depth:r}=s);let a=this.localGeometry.userData;void 0!==a.sxPrev&&xM(this.localGeometry.attributes,i/a.sxPrev,n/a.syPrev,r/a.szPrev),a.sxPrev=i,a.syPrev=n,a.szPrev=r}else{let i={...this.data.geometry,...e};this.localGeometry?.dispose(),this.localGeometry=bM(i,t,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let e of this.attachedSurfaceCloners)e.update()}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand((()=>t.updateShape()))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){let n=!1;0===e.type&&0===e.path.length&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof TM&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(n=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),n||(i.scene?.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){void 0!==e.geometry&&this.updateGeometryOnStateUpdate(e.geometry,t);let i=e.morphTargetInfluences;if(i){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:e,value:n}}of i)this.updateMorphInfluences(e,t.shared.getVariable(n,[this.uuid,"morphTargetInfluences",e]))}super.updateState(e,t)}updateMorphInfluences(e,t){if(void 0===this.morphTargetDictionary)return;let i=this.morphTargetDictionary[e];void 0!==i&&(this.morphTargetInfluences[i]=t)}updateGeometryGroupsIfNeeded(){Array.isArray(this.material)&&0===this.geometry.groups.length&&this.geometry.addGroup(0,Math.max(this.geometry.getIndex()?.count??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,.5*i.depth):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):i.centerOffset?e.fromArray(i.centerOffset):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new ki,i=this.geometry.attributes.skinWeight;for(let n=0,r=i.count;n<r;n++){t.fromBufferAttribute(i,n);let e=1/t.manhattanLength();e!==1/0?t.multiplyScalar(e):t.set(1,0,0,0),i.setXYZW(n,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(void 0===i)return;let n=this.geometry;kD.fromBufferAttribute(n.attributes.skinIndex,e),FD.fromBufferAttribute(n.attributes.skinWeight,e),ND.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){let e=FD.getComponent(r);if(0!==e){let n=kD.getComponent(r);zD.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),t.addScaledVector(UD.copy(ND).applyMatrix4(zD),e)}}return t.applyMatrix4(this.bindMatrixInverse)}};function VD(e){if(Array.isArray(e.material)){for(let t of e.material)if(0===t.getLayersOfType("outline").length)return}else if(!(e.material instanceof GP)||0===e.material.getLayersOfType("outline").length)return;e instanceof jD&&e.is2DAndNoDepth?function(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),n=new Vi;for(let r=0;r<t.length;r+=3)n.set(t[r],t[r+1],t[r+2]).normalize(),i[r]=n.x,i[r+1]=n.y,i[r+2]=n.z;e.geometry.setAttribute("extrudeNormal",new hr(i,3))}(e):function(e){if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,n=i.position.array,r=i.normal.array,s=new Float32Array(n.length);for(let a=0;a<n.length;a+=3){let e=`${n[a]}_${n[a+1]}_${n[a+2]}`,i=new Vi(r[a],r[a+1],r[a+2]);t.has(e)?t.get(e)?.normals.push(i):t.set(e,{normals:[i],result:new Vi})}t.forEach(((e,t)=>{for(let i of e.normals)e.result.add(i);e.result.divideScalar(e.normals.length)}));for(let a=0;a<n.length;a+=3){let e=`${n[a]}_${n[a+1]}_${n[a+2]}`,i=t.get(e)?.result;i&&(s[a]=i.x,s[a+1]=i.y,s[a+2]=i.z)}e.geometry.setAttribute("extrudeNormal",new hr(s,3))}(e)}function GD(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),n=parseInt(e.uuid.replace(/\D/g,"")),r=[ui.seededRandom(n),ui.seededRandom(n+1e4),ui.seededRandom(n+2e4)];for(let s=0;s<t.length;s++)i[s]=r[s%3];e.geometry.setAttribute("randomColor",new or(i,3))}var HD=new Wi,WD=new Vi;function QD(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{"Mesh"===i.type&&"SubdivGeometry"===i.geometry.type&&(t=!0)})),t}var qD=class extends jD{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new bn,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return void 0!==this.localGeometry?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return void 0!==this.localGeometry?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){if(!0===this.skipReactionUpdate)return;let t=this.localGeometry?.uuid,{originalGeometry:i,subdividedGeometry:n,subdivPointer:r}=TM.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=r,void 0!==i&&(this.originalGeometry?.dispose(),this.originalGeometry=i),void 0!==n&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=n??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,VD(this),GD(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),void 0!==e.flatShading){let i=this.material;this.material=Array.isArray(i)?i.map((e=>e.getFlavor(!1,e.side,e.wireframe))):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];TM.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&TM.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=TM.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=TM.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,sT.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new hn,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;HD.setFromBufferAttribute(t),HD.getCenter(i),e.boundingSphere.radius=i.distanceTo(HD.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),HD.getSize(WD),this.hasNonUniformScale&&WD.divide(this.scale);let n={width:WD.x,height:WD.y,depth:WD.z};return this.geometry.userData.parameters=n,n}updateBoundingSphere(e){let t=this.originalGeometry;HD.min.set(e[0],e[2],e[4]),HD.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(HD.min.applyMatrix4(this.shearScaleInv),HD.max.applyMatrix4(this.shearScaleInv)),null===t.boundingSphere&&(t.boundingSphere=new hn);let i=t.boundingSphere.center;HD.getCenter(i),t.boundingSphere.radius=i.distanceTo(HD.max)}freeSubdivPointer(){this.subdivPointer&&(TM.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,this.originalGeometry?.dispose(),this.subdividedGeometry?.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},XD={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},YD={polygon_center:0,edge:1,vertex:2},KD=(e,t)=>(i,n)=>t&&0!==i&&0!==e?e*n/100:0,JD=(e,t)=>{let i=Math.abs(t),n=-1*i;return(e- -1)*(i-n)/2+n},ZD=new Vi,$D=new Vi,eR=new Vi,tR=new Vi;function iR(e,t){let i=eR.fromArray(e),n=tR.fromArray(t);$D.copy(n).sub(i);let r=$D.length();return $D.normalize().multiplyScalar(.5*r),ZD.copy(i).add($D).toArray()}var nR=new tr,rR=new Vi,sR=new Vi,aR=new Vi;var oR=e=>.5*(1-Math.cos(e*Math.PI)),lR=class{constructor(){this.perlin=new Array(4096)}noise(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null==this.perlin){this.perlin=new Array(4096);for(let e=0;e<4096;e++)this.perlin[e]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let n,r,s,a,o,l=Math.floor(e),c=Math.floor(t),h=Math.floor(i),d=e-l,u=t-c,p=i-h,f=0,m=.5;for(let g=0;g<4;g++){let e=l+(c<<4)+(h<<8);n=oR(d),r=oR(u),s=this.perlin[4095&e],s+=n*(this.perlin[e+1&4095]-s),a=this.perlin[e+16&4095],a+=n*(this.perlin[e+16+1&4095]-a),s+=r*(a-s),e+=256,a=this.perlin[4095&e],a+=n*(this.perlin[e+1&4095]-a),o=this.perlin[e+16&4095],o+=n*(this.perlin[e+16+1&4095]-o),a+=r*(o-a),s+=oR(p)*(a-s),f+=s*m,m*=.5,l<<=1,d*=2,c<<=1,u*=2,h<<=1,p*=2,d>=1&&(l++,d--),u>=1&&(c++,u--),p>=1&&(h++,p--)}return f}noiseSeed(e){let t=(()=>{let e,t;return{setSeed(i){t=e=(i??4294967296*Math.random())>>>0},getSeed:()=>e,rand:()=>(t=(1664525*t+1013904223)%4294967296,t/4294967296)}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},cR=new Vi,hR=new bn,dR=new yn;function uR(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{"Mesh"===i.type&&("TextGeometry"===i.geometry.type||"InputGeometry"===i.geometry.type)&&(t=!0)})),t}var pR,fR,mR,gR,vR=class extends jD{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){let e=this.dataPatched;return this.font?.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign)??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){return(this.font?.ascender??1)*this.fontScale}get descender(){return(this.font?.descender??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!isNaN(e.ray.origin.x)&&0!==this.scale.x&&0!==this.scale.y&&0!==this.scale.z&&(hR.copy(i).invert(),dR.copy(e.ray).applyMatrix4(hR),dR.intersectBox(this.singleBBox,cR))){let n=cR.applyMatrix4(i),r=e.ray.origin.distanceTo(n);t.push({distance:r,point:n.clone(),object:this})}}},yR=1e-4,bR=new Vi,AR=new Vi;mM.then((e=>{fR=[(pR=e).get_face_center,pR.get_edge_midpoint,pR.get_vertex_position],mR=[pR.get_face_normal,pR.get_edge_normal,pR.get_vertex_normal],gR=[pR.face_count,pR.edge_count,pR.vertex_count]}));var xR=new bn,wR=new bn,SR=new Vi,_R=new Vi,ER=new Vi,CR=new Vi,MR=new Vi,TR=new Vi,IR=class{constructor(e,t){this.data=e,this.is3D=t,this.perlin=new lR,"perlin"===e.noiseType?(this.perlin.noiseSeed(e.seed),this.noise=t?(e,t,i)=>this.perlin.noise(e,t,i):e=>this.perlin.noise(e)):this.noise=t?function(){let e=n_(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random),t=new Float64Array(e).map((e=>i_[e%12*3])),i=new Float64Array(e).map((e=>i_[e%12*3+1])),n=new Float64Array(e).map((e=>i_[e%12*3+2]));return function(r,s,a){let o,l,c,h,d,u,p,f,m,g,v=(r+s+a)*ZS,y=e_(r+v),b=e_(s+v),A=e_(a+v),x=(y+b+A)*$S,w=r-(y-x),S=s-(b-x),_=a-(A-x);w>=S?S>=_?(d=1,u=0,p=0,f=1,m=1,g=0):w>=_?(d=1,u=0,p=0,f=1,m=0,g=1):(d=0,u=0,p=1,f=1,m=0,g=1):S<_?(d=0,u=0,p=1,f=0,m=1,g=1):w<_?(d=0,u=1,p=0,f=0,m=1,g=1):(d=0,u=1,p=0,f=1,m=1,g=0);let E=w-d+$S,C=S-u+$S,M=_-p+$S,T=w-f+2*$S,I=S-m+2*$S,P=_-g+2*$S,D=w-1+.5,R=S-1+.5,B=_-1+.5,L=255&y,O=255&b,N=255&A,k=.6-w*w-S*S-_*_;if(k<0)o=0;else{let r=L+e[O+e[N]];k*=k,o=k*k*(t[r]*w+i[r]*S+n[r]*_)}let F=.6-E*E-C*C-M*M;if(F<0)l=0;else{let r=L+d+e[O+u+e[N+p]];F*=F,l=F*F*(t[r]*E+i[r]*C+n[r]*M)}let U=.6-T*T-I*I-P*P;if(U<0)c=0;else{let r=L+f+e[O+m+e[N+g]];U*=U,c=U*U*(t[r]*T+i[r]*I+n[r]*P)}let z=.6-D*D-R*R-B*B;if(z<0)h=0;else{let r=L+1+e[O+1+e[N+1]];z*=z,h=z*z*(t[r]*D+i[r]*R+n[r]*B)}return 32*(o+l+c+h)}}((0,YS.default)(e.seed)):function(){let e=n_(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random),t=new Float64Array(e).map((e=>t_[e%12*2])),i=new Float64Array(e).map((e=>t_[e%12*2+1]));return function(n,r){let s,a,o=0,l=0,c=0,h=(n+r)*KS,d=e_(n+h),u=e_(r+h),p=(d+u)*JS,f=n-(d-p),m=r-(u-p);f>m?(s=1,a=0):(s=0,a=1);let g=f-s+JS,v=m-a+JS,y=f-1+2*JS,b=m-1+2*JS,A=255&d,x=255&u,w=.5-f*f-m*m;if(w>=0){let n=A+e[x];w*=w,o=w*w*(t[n]*f+i[n]*m)}let S=.5-g*g-v*v;if(S>=0){let n=A+s+e[x+a];S*=S,l=S*S*(t[n]*g+i[n]*v)}let _=.5-y*y-b*b;if(_>=0){let n=A+1+e[x+1];_*=_,c=_*_*(t[n]*y+i[n]*b)}return 70*(o+l+c)}}((0,YS.default)(e.seed))}},PR=class extends(u_(Hn)){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(null===this.parent)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof f_&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse((t=>{t instanceof f_&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)}))}onObjUpdateMatrix(){"toObject"!==this.parameters.type&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(t=void 0!==e?e:"grid"===this.parameters.type?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,"toObject"===this.parameters.type)if(this.parameters.toObject.object){if(void 0===e&&"random"!==this.parameters.toObject.spreadType)return}else t=0;if("toObject"===this.parameters.type&&this.objectForSample){let e=this.children;if(e.length===t)return;if(e.length<t)for(let i=0,n=t-e.length;i<n;++i){let e=new f_(this.object);e.expand(),this.add(e)}else for(let i=0,n=e.length-t;i<n;++i)this.remove(e[i])}else{if(this.children.length===t)return;if(this.children.length<t)for(let e=0,i=t-this.children.length;e<i;++e){let e=new f_(this.object);e.expand(),this.add(e)}else for(let e=0,i=this.children.length-t;e<i;++e)this.remove(this.children[e])}}getRandom(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(null===this.random||this.random.data.seed!==e.seed||this.random.is3D!==t)&&(this.random=new IR(e,t)),this.random}_updateRadial(e){let t,i=e.radial,n=i.start*ui.DEG2RAD,r=n-i.end*ui.DEG2RAD,s=new In(i.rotation[0],i.rotation[1],i.rotation[2]);switch(i.axis){case"z":t=new Vi(0,0,1);break;case"y":t=new Vi(0,1,0);break;default:t=new Vi(1,0,0)}let a=e.randomnessObject??bA.defaultData([1,1,1]).randomnessObject,o=this.getRandom(a),l=KD(a.strength,this.parameters.randomness);for(let[c,h]of this.children.entries()){let d=c*(a.freqScale/10)+a.movement,u=o.noise(d,d,d),p=c+1;h.scale.x=i.scale[0]+l(p,JD(u,a.scale[0]))||yR,h.scale.y=i.scale[1]+l(p,JD(u,a.scale[1]))||yR,h.scale.z=i.scale[2]+l(p,JD(u,a.scale[2]))||yR,h.position.setScalar(0);let f=r/e.count*c-n;switch(i.axis){case"x":h.rotation.set(0,f,0);break;case"y":h.rotation.set(0,0,f);break;case"z":h.rotation.set(f,0,0)}h.translateOnAxis(t,i.radius),h.position.x+=i.position[0]+l(p,JD(u,a.position[0])),h.position.y+=i.position[1]+l(p,JD(u,a.position[1])),h.position.z+=i.position[2]+l(p,JD(u,a.position[2]));let m=l(p,JD(u,a.rotation[0])),g=l(p,JD(u,a.rotation[1])),v=l(p,JD(u,a.rotation[2]));!0===i.alignment?(h.rotation.x+=s.x+m,h.rotation.y+=s.y+g,h.rotation.z+=s.z+v):h.rotation.set(s.x+m,s.y+g,s.z+v)}}_updateLinear(e){if("linear"!==e.type)throw new Error;let t=e.linear,i=new In(t.rotation[0],t.rotation[1],t.rotation[2]),n=e.randomnessObject??bA.defaultData([1,1,1]).randomnessObject,r=this.getRandom(n),s=KD(n.strength,this.parameters.randomness);for(let[a,o]of this.children.entries()){let e=a*(n.freqScale/10)+n.movement,l=r.noise(e,e,e),c=a+1,h=s(c,JD(l,n.rotation[0])),d=s(c,JD(l,n.rotation[1])),u=s(c,JD(l,n.rotation[2]));o.scale.x=1+(t.scale[0]-1)*a+s(c,JD(l,n.scale[0]))||yR,o.scale.y=1+(t.scale[1]-1)*a+s(c,JD(l,n.scale[1]))||yR,o.scale.z=1+(t.scale[2]-1)*a+s(c,JD(l,n.scale[2]))||yR,o.rotation.x=i.x*a+h,o.rotation.y=i.y*a+d,o.rotation.z=i.z*a+u,o.position.x=t.position[0]*a+s(c,JD(l,n.position[0])),o.position.y=t.position[1]*a+s(c,JD(l,n.position[1])),o.position.z=t.position[2]*a+s(c,JD(l,n.position[2]))}}_updateGrid(e){let t=0,i=e.grid,n=e.randomnessObject??bA.defaultData([1,1,1]).randomnessObject,r=this.getRandom(n,!0),s=KD(n.strength,this.parameters.randomness);if(!0===i.useCenter){let e={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},a=new Vi(i.size[0]*(i.count[0]-e.x)*.5,i.size[1]*(i.count[1]-e.y)*.5,i.size[2]*(i.count[2]-e.z)*.5);for(let o=0;o<i.count[0];o++)for(let e=0;e<i.count[1];e++)for(let l=0;l<i.count[2];l++){let c=r.noise((o+1)*(n.freqScale/10)+n.movement,(e+1)*(n.freqScale/10)+n.movement,(l+1)*(n.freqScale/10)+n.movement),h=this.children[t++];h.scale.x=1+s(t,JD(c,n.scale[0]))||yR,h.scale.y=1+s(t,JD(c,n.scale[1]))||yR,h.scale.z=1+s(t,JD(c,n.scale[2]))||yR;let d=s(t,JD(c,n.rotation[0])),u=s(t,JD(c,n.rotation[1])),p=s(t,JD(c,n.rotation[2]));h.rotation.set(d,u,p),h.position.x=i.size[0]*o-a.x+s(t,JD(c,n.position[0])),h.position.y=i.size[1]*e-a.y+s(t,JD(c,n.position[1])),h.position.z=i.size[2]*l-a.z+s(t,JD(c,n.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let e=0;e<i.count[1];e++)for(let o=0;o<i.count[2];o++){let l=r.noise((a+1)*(n.freqScale/10)+n.movement,(e+1)*(n.freqScale/10)+n.movement,(o+1)*(n.freqScale/10)+n.movement),c=this.children[t++];c.scale.x=1+s(t,JD(l,n.scale[0]))||yR,c.scale.y=1+s(t,JD(l,n.scale[1]))||yR,c.scale.z=1+s(t,JD(l,n.scale[2]))||yR;let h=s(t,JD(l,n.rotation[0])),d=s(t,JD(l,n.rotation[1])),u=s(t,JD(l,n.rotation[2]));c.rotation.set(h,d,u),c.position.x=i.size[0]*a+s(t,JD(l,n.position[0])),c.position.y=-i.size[1]*e+s(t,JD(l,n.position[1])),c.position.z=-i.size[2]*o+s(t,JD(l,n.position[2]))}}_updateToObject(e){if("toObject"!==e.type)throw new Error;let{toObject:t}=e,i=new In(t.rotation[0],t.rotation[1],t.rotation[2]),n=e.randomnessObject??bA.defaultData([1,1,1]).randomnessObject,r=this.getRandom(n),s=KD(n.strength,this.parameters.randomness);if(!t.object){for(let[,e]of this.children.entries())e.position.set(0,0,0),e.scale.setScalar(1),e.rotation.set(0,0,0);return void(this.objectForSample=void 0)}if(!this.objectForSample)return;if(this.objectForSample instanceof vR){if(!this.objectForSample.font?.isLoaded||void 0===this.objectForSample.geometry.attributes.position)return void(this._pendingMediaLoad=!0);this._pendingMediaLoad=!1}if(void 0===this.objectForSample.geometry&&this.objectForSample.isAncestorOf(this.object.uuid))return void console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);let a=this.getSubdivData();if(a.length>0){let e=Math.round(a.length*t.count/100);this._updateCount(e)}else{let e=this.objectForSample.geometry.getAttribute("position");if(!e||isNaN(e.count)||0===e.count)return void console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`)}this.objectForSample.updateMatrixWorld();let o=new a_(this.objectForSample).build(),l=XD[t.axis],c=this.children;o.setRandomGenerator((0,YS.default)(this.object.uuid+t.seed));for(let[h,d]of c.entries()){let e=h*(n.freqScale/10)+n.movement,c=r.noise(e,e,e),u=h+1,p=s(u,JD(c,n.rotation[0])),f=s(u,JD(c,n.rotation[1])),m=s(u,JD(c,n.rotation[2]));"random"===t.spreadType?o.sample(ER,CR):(a.length&&(ER.fromArray(a[h].pos),CR.fromArray(a[h].norm)),this.objectForSample instanceof qD&&ER.applyMatrix4(xR.copy(this.objectForSample.matrixWorld).invert())),ER.applyMatrix4(this.object.hiddenMatrix.clone().invert()),d.position.copy(ER),SR.fromArray(l);let g="normal"===t.align?CR:this.object.getWorldDirection(TR),v=_R.fromArray(t.position);_R.x+=s(u,JD(c,n.position[0])),_R.y+=s(u,JD(c,n.position[1])),_R.z+=s(u,JD(c,n.position[2]));let y=Math.acos(g.dot(SR)),b=MR.crossVectors(SR,g).normalize(),A=wR.makeRotationAxis(b,y),x=g.clone().cross(this.object.up).normalize(),w=x.clone().cross(g).normalize(),S=(new bn).makeBasis(x,g,w),_=new Vi(SR.y,SR.z,SR.x).normalize(),E=_.clone().cross(SR).normalize(),C=(new bn).makeBasis(_,SR,E).invert(),M=(new bn).multiplyMatrices(S,C);d.rotation.setFromRotationMatrix(M),v.applyMatrix4(A),d.position.add(v),d.rotation.x=d.rotation.x+i.x+p,d.rotation.y=d.rotation.y+i.y+f,d.rotation.z=d.rotation.z+i.z+m,d.scale.setScalar(1),d.scale.x=d.scale.x+t.scale[0]+s(u,JD(c,n.scale[0]))||yR,d.scale.y=d.scale.y+t.scale[1]+s(u,JD(c,n.scale[1]))||yR,d.scale.z=d.scale.z+t.scale[2]+s(u,JD(c,n.scale[2]))||yR,d.scale.multiply(this.object.scale),d.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType,t=new Map,i=(e,i)=>{let n=Math.round(1e4*e[0])+"_"+Math.round(1e4*e[1])+"_"+Math.round(1e4*e[2]),r=t.get(n);r?(r.pos[0]+=e[0],r.pos[1]+=e[1],r.pos[2]+=e[2],r.norm[0]+=i[0],r.norm[1]+=i[1],r.norm[2]+=i[2],r.count+=1):t.set(n,{pos:[...e],norm:[...i],count:1})};if("random"===e)return[];if(this.objectForSample instanceof qD){let t=this.objectForSample,n=YD[e],r=gR[n],s=fR[n],a=mR[n],o=r(t.subdivPointerNew);for(let e=0;e<=o-1;e++){let n=s(t.subdivPointerNew,e),r=a(t.subdivPointerNew,e);bR.fromArray(n).applyMatrix4(t.matrixWorld),AR.fromArray(r),i(bR.toArray(),AR.toArray())}}else(this.objectForSample.geometry.index?function(e){let t=[];for(let i=0;i<=e.index.count;i++)if(rR.fromArray(e.index.array,3*i),nR.setFromAttributeAndIndices(e.attributes.position,rR.x,rR.y,rR.z),nR.getNormal(sR),nR.getMidpoint(aR),!(isNaN(aR.x)||isNaN(aR.y)||isNaN(aR.z))){let{a:e,b:i,c:n}=nR,r=e.toArray(),s=i.toArray(),a=n.toArray(),o=e.distanceTo(i),l=i.distanceTo(n),c=n.distanceTo(e),h=iR(r,s),d=iR(s,a),u=iR(a,r),p=[o,l,c],f=Math.max(...p),m=p.filter((e=>Math.round(e)===Math.round(f))).length>1,g=[],v=nR.getMidpoint(aR).toArray();f===o&&!m&&(g=[d,u,u],v=h),f===l&&!m&&(g=[h,u,u],v=d),f===c&&!m&&(g=[h,d,d],v=u),m&&(g=[h,d,u]),t.push({vertices:[r,s,a],faceCenters:g,midpoint:v,norm:nR.getNormal(sR).toArray()})}return t}(this.objectForSample.geometry):function(e){let t=[],{position:i}=e.attributes;for(let n=0;n<i.count;n++){nR.setFromAttributeAndIndices(i,3*n,3*n+1,3*n+2),nR.getNormal(sR),nR.getMidpoint(aR);let e=nR.a.toArray(),r=nR.b.toArray(),s=nR.c.toArray();t.push({vertices:[e,r,s],faceCenters:[iR(e,r),iR(r,s),iR(s,e)],midpoint:aR.toArray(),norm:sR.toArray()})}return t}(this.objectForSample.geometry)).forEach(((t,n)=>{"polygon_center"===e&&i(t.midpoint,t.norm),"vertex"===e&&(i(t.vertices[0],t.norm),i(t.vertices[1],t.norm),i(t.vertices[2],t.norm)),"edge"===e&&(i(t.faceCenters[0],t.norm),i(t.faceCenters[1],t.norm),i(t.faceCenters[2],t.norm))}));let n=Array.from(t.values());for(let r of n)r.pos[0]/=r.count,r.pos[1]/=r.count,r.pos[2]/=r.count,r.norm[0]/=r.count,r.norm[1]/=r.count,r.norm[2]/=r.count;return n}updateState(e,t){if(this.parameters=Qm(e),"toObject"!==this.parameters.type)(null===this.parent||this.parent!==this.object)&&(this.removeFromParent(),this.object.parent?.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(null===this.parent||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let e=t.find(this.parameters.toObject.object);this.objectForSample=e instanceof sT?e:void 0,this.matrix=new bn,this.hiddenMatrix=new bn,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,e&&e.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},DR=e=>{var t;return(t=class extends e{}).geometryHelper=new Lr(30,30,30),t},RR=new yn,BR=new hn,LR=new bn,OR=function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,a=t,o=s.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),BR.copy(a.boundingSphere),BR.applyMatrix4(o),!1===i.ray.intersectsSphere(BR)||(LR.copy(o).invert(),RR.copy(i.ray).applyMatrix4(LR),null!==a.boundingBox&&!1===RR.intersectsBox(a.boundingBox)))return;let l,c,h,d,u,p,f=a.index,m=a.attributes.position,g=a.drawRange;if(!1===r){for(u=Math.max(0,g.start),p=Math.min(f.count,g.start+g.count);u<p;u+=3)if(c=f.getX(u),h=f.getX(u+1),d=f.getX(u+2),l=v(e,i,RR,m,c,h,d),l)return l.faceIndex=Math.floor(u/3),void n.push(l)}else{let t=a.attributes.position,r=new Vi,o=new Vi,l=new Vi,c=new Vi,h=2,d=1/((s.scale.x+s.scale.y+s.scale.z)/3),u=d*d;for(let a=Math.max(0,g.start),p=Math.min(t.count,g.start+g.count)-1;a<p;a+=h){if(r.fromBufferAttribute(t,a),o.fromBufferAttribute(t,a+1),RR.distanceSqToSegment(r,o,c,l)>u)continue;c.applyMatrix4(s.matrixWorld);let h=i.ray.origin.distanceTo(c);h<i.near||h>i.far||n.push({distance:h,point:l.clone().applyMatrix4(s.matrixWorld),object:e})}}function v(e,t,i,n,r,s,a){let o=new Vi,l=new Vi,c=new Vi,h=new Vi,d=new Vi;if(o.fromBufferAttribute(n,r),l.fromBufferAttribute(n,s),c.fromBufferAttribute(n,a),null===i.intersectTriangle(o,l,c,!1,h))return null;d.copy(h),d.applyMatrix4(e.matrixWorld);let u=t.ray.origin.distanceTo(d);return u<t.near||u>t.far?null:{faceIndex:1,distance:u,point:d.clone(),object:e}}},NR=new Vi,kR=new zr,FR=class extends ol{constructor(e){let t=new yr,i=new Zo({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={},a=new Pi(15711266),o=new Pi(15711266),l=new Pi(2857471);function c(e,t,i){h(e,i),h(t,i)}function h(e,t){n.push(0,0,0),r.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(n.length/3-1)}c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l),t.setAttribute("position",new hr(n,3)),t.setAttribute("color",new hr(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;kR.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=.8;UR("n1",t,e,kR,-1,-1,i),UR("n2",t,e,kR,1,-1,i),UR("n3",t,e,kR,-1,1,i),UR("n4",t,e,kR,1,1,i);let n=i;UR("f1",t,e,kR,-1,-1,n),UR("f2",t,e,kR,1,-1,n),UR("f3",t,e,kR,-1,1,n),UR("f4",t,e,kR,1,1,n);let r=n;UR("u1",t,e,kR,.35,1.1,r),UR("u2",t,e,kR,-.35,1.1,r),UR("u3",t,e,kR,0,1.55,r),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function UR(e,t,i,n,r,s,a){NR.set(r,s,a).unproject(n);let o=t[e];if(void 0!==o){let e=i.getAttribute("position");for(let t=0,i=o.length;t<i;t++)e.setXYZ(o[t],NR.x,NR.y,NR.z)}}var zR,jR=class extends(DR(FR)){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){OR(this.object,this.geometry,e,t,!0)}};(e=>{e.is=e=>"objectHelper"in e})(zR||(zR={}));var VR=(e,t)=>class extends(L_(e)){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(e,t){this.objectHelper.raycast(e,t)}showGizmos(){for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Hh&&(t.visible=!0)}}updateEntityBoxSize(e,t){this.objectHelper.visible&&this.geometryHelper instanceof Lr?(e.setScalar(0),t.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(e,t)}hideGizmos(){for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Hh&&(t.visible=!1)}}},GR=new Vi,HR=new Vi,WR=new ji,QR=new Vi,qR=new Vi,XR=new Vi,YR=class extends(VR(zr,jR)){constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{...yx.defaultData,name:""};super(),this._cameraType="OrthographicCamera",this.targetOffset=yA.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new bn,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,n=this.height;this.orthoCamera=new us(-.5*i,.5*i,.5*n,-.5*n,-5e4,1e4),this.perspCamera=new jr(45,i/n,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return"PerspectiveCamera"===this.cameraType}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){"PerspectiveCamera"===e?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&("PerspectiveCamera"===e?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){"PerspectiveCamera"===e?this.toPerspective():"OrthographicCamera"===e&&this.toOrthographic()}get near(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near}set near(e){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){"number"==typeof e&&(e=new Vi(e,t,i)),super.lookAt(e),this.getWorldPosition(GR),this.targetOffset=GR.distanceTo(e)}getTarget(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vi;return this.getWorldDirection(HR),this.getWorldPosition(GR),HR.multiplyScalar(this.targetOffset),e.copy(GR).add(HR),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(GR),GR.distanceTo(e)}updateUp(){this.getWorldQuaternion(WR),QR.set(0,0,1).applyQuaternion(WR),qR.copy(Hn.DEFAULT_UP),this.isUpVectorFlipped&&qR.negate(),qR.applyQuaternion(WR),XR.copy(Hn.DEFAULT_UP).projectOnPlane(QR),this.angleOffsetFromUp=XR.angleTo(qR),this.angleOffsetFromUp*=XR.cross(qR).dot(QR)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new Vi),i=e.getWorldDirection(new Vi).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new Vi).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new Vi;e.getWorldPosition(t);return this.getViewToTarget(t)}setViewplaneSize(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.aspect=e/t,i){let i=e>t?this.aspect:1,n=e>t?1:this.aspect;this.left=-395*i,this.right=395*i,this.top=1/n*395,this.bottom=1/n*-395}else this.left=.5*-e,this.right=.5*e,this.top=.5*t,this.bottom=.5*-t;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,n,r,s){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(e,t,i,n,r,s):this.orthoCamera.setViewOffset(e,t,i,n,r,s)}clearViewOffset(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=null===e.view?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return Ig(t,e)}updateCameraSubtype(e,t){let i="perspective"===e?"PerspectiveCamera":"OrthographicCamera";void 0!==t.zoom&&this.setZoom(i,t.zoom),void 0!==t.near&&this.setNear(i,t.near),void 0!==t.fov&&"PerspectiveCamera"===i&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),void 0!==e.far&&(this.far=e.far),void 0!==e.orthographic&&this.updateCameraSubtype("orthographic",e.orthographic),void 0!==e.perspective&&this.updateCameraSubtype("perspective",e.perspective),void 0!==e.type&&(this.cameraType=e.type),void 0!==e.up&&this.up.fromArray(e.up),void 0!==e.targetOffset&&(this.targetOffset=e.targetOffset),void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),1===e.path.length&&0===e.type&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},KR=new bn,JR=new bn;function ZR(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{"BooleanGeometry"===i.geometry?.type&&(t=!0)})),t}var $R,eB=class extends OD{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new yr,this.onAfterRender=(e,t,i,n,r,s)=>{super.onAfterRender(e,t,i,n,r,s),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&void 0!==e.props.operation&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(-1!==this.booleanMeshSetAddress&&!e)return;for(let n=0;n<this.children.length;n++){let i=this.children[n];i instanceof eB&&!0===i.dataPatched.visible&&i.recomputeBoolean(!0===e,t)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let i=this.children[n];if(i instanceof sT&&!0===i.dataPatched.visible&&i.geometry.attributes.position?.count>0&&i.geometry.drawRange.count>0&&0!==i.booleanMeshSetAddress){KR.multiplyMatrices(i.hiddenMatrix,i.matrix);try{if(-1===i.booleanMeshSetAddress){if((i.geometry.index??i.geometry.getAttribute("position")).count/3<15e5&&(i.booleanMeshSetAddress=NM.getMeshSet(i.geometry,!0===e,t)),-1===i.booleanMeshSetAddress)return;NM.transformMeshSet(i.booleanMeshSetAddress,KR),i.booleanMatrixInvOld.copy(KR).invert(),i.booleanWasTransformed=!1}else i instanceof eB&&!0===i.needsTransformForDownstream?(NM.transformMeshSet(i.booleanMeshSetAddress,KR),i.needsTransformForDownstream=!1):!0===i.booleanWasTransformed&&(NM.transformMeshSet(i.booleanMeshSetAddress,JR.multiplyMatrices(KR,i.booleanMatrixInvOld)),i.booleanMatrixInvOld.copy(KR).invert(),i.booleanWasTransformed=!1)}catch(nA){console.error(nA),i.booleanMeshSetAddress=0,i.geometry.userData.booleanOperationDidFail=!0;continue}!1===NM.hasOpenEdges(i.booleanMeshSetAddress)||n===this.children.length-1&&2===this.booleanOp?(this.meshSetAddresses.push(i.booleanMeshSetAddress),i.geometry.userData.booleanOperationDidFail=!1):i.geometry.userData.booleanOperationDidFail="openEdges"}}if(0===this.meshSetAddresses.length)return this.geometry.setAttribute("position",new hr([],0)),void this.geometry.setDrawRange(0,0);if(!0===e)return NM.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new yr,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=NM.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(gA){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(gA)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,VD(this),GD(this)}dispose(){super.dispose(),this.geometry.dispose()}};(e=>{e.is=function(e){return d_.is(e)&&e instanceof Gc}})($R||($R={}));var tB=(e,t)=>class extends(VR(e,t)){updateState_Light(e,t){this.updateState_Entity(e,t),void 0!==e.color&&(this.color=t.shared.color(e.color)),void 0!==e.intensity&&(this.intensity=e.intensity),void 0!==e.depth&&(this.shadow.camera.far=e.depth,this.shadow.needsUpdate=!0),void 0!==e.shadows&&(this.castShadow=e.shadows)}},iB=e=>e instanceof sT,nB=e=>null!==e&&e instanceof eB,rB=e=>zR.is(e),sB=new Vi(1,1,1),aB=new Vi,oB=new Vi,lB=new ji,cB=class extends(DR(Wh)){constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:15),this.object=e,this.dummy=new Mo,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){OR(this.object,cB.geometryHelper,e,t,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(e){this.object.matrixWorld.decompose(aB,lB,oB),this.matrix.compose(aB,lB,sB),super.updateMatrixWorld(e)}updateWorldMatrix(e,t){}},hB=class extends(VR(Mo,cB)){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&1===Object.keys(e).length&&t.scene.reloadSplats()}},dB=class extends(VR(Mo,cB)){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},uB=0,pB=1,fB="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",mB=class extends Ur{constructor(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super({name:"BokehMaterial",defines:{PASS:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"2":"1"},uniforms:{kernel64:new Sh(null),kernel16:new Sh(null),inputBuffer:new Sh(null),cocBuffer:new Sh(null),texelSize:new Sh(new pi),scale:new Sh(1)},blending:O,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){\n#ifdef FOREGROUND\nvec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;\n#else\nfloat CoC=texture2D(cocBuffer,vUv).g*scale;\n#endif\nif(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{\n#ifdef FOREGROUND\nvec2 step=texelSize*max(CoC,CoCNearFar.g*scale);\n#else\nvec2 step=texelSize*CoC;\n#endif\nvec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}",vertexShader:fB}),this.toneMapped=!1,e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=new Float32Array(128),t=new Float32Array(32),i=0,n=0;for(let a=0;a<80;++a){let r=2.39996323*a,s=Math.sqrt(a)/Math.sqrt(80),o=s*Math.cos(r),l=s*Math.sin(r);a%5===0?(t[n++]=o,t[n++]=l):(e[i++]=o,e[i++]=l)}let r=[],s=[];for(let a=0;a<128;)r.push(new ki(e[a++],e[a++],e[a++],e[a++]));for(let a=0;a<32;)s.push(new ki(t[a++],t[a++],t[a++],t[a++]));this.uniforms.kernel64.value=r,this.uniforms.kernel16.value=s}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function gB(e,t,i){return e*(t-i)-t}function vB(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var yB=class extends Ur{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Sh(null),focusDistance:new Sh(0),focusRange:new Sh(0),cameraNear:new Sh(.3),cameraFar:new Sh(1e3)},blending:O,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}void main(){float depth=readDepth(vUv);\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);\n#else\nfloat linearDepth=depth;\n#endif\nfloat signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}",vertexShader:fB}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vt;this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-gB(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=vB(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-gB(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=vB(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof jr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},bB=class extends Ur{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pi;super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Sh(null),texelSize:new Sh(new pi),halfTexelSize:new Sh(new pi),kernel:new Sh(0),scale:new Sh(1)},blending:O,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <encodings_fragment>\n#include <dithering_fragment>\n}",vertexShader:"uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},AB=class extends Ur{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Sh(null),opacity:new Sh(1)},blending:O,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <encodings_fragment>\n}",vertexShader:fB}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},xB={DEPTH:0,LUMA:1,COLOR:2},wB={DISABLED:0,DEPTH:1,CUSTOM:2},SB=class extends Ur{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xB.COLOR;super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:x.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Sh(null),depthBuffer:new Sh(null),predicationBuffer:new Sh(null),texelSize:new Sh(e)},blending:O,depthWrite:!1,depthTest:!1,fragmentShader:"varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\n#if EDGE_DETECTION_MODE == 1\n#include <common>\n#endif\n#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}\n#elif PREDICATION_MODE == 2\nuniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}\n#endif\n#if PREDICATION_MODE != 0\nvec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}\n#endif\n#if EDGE_DETECTION_MODE != 0\nuniform sampler2D inputBuffer;\n#endif\nvoid main(){\n#if EDGE_DETECTION_MODE == 0\nconst vec2 threshold=vec2(DEPTH_THRESHOLD);\n#elif PREDICATION_MODE != 0\nvec2 threshold=calculatePredicatedThreshold();\n#else\nconst vec2 threshold=vec2(EDGE_THRESHOLD);\n#endif\n#if EDGE_DETECTION_MODE == 0\nvec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 1\nfloat l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 2\nvec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#endif\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\nvoid main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);\n#if EDGE_DETECTION_MODE != 0\nvUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vt;this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(.1*e).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},_B="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if THREE_REVISION >= 137\nvec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <encodings_fragment>\n#endif\n#include <dithering_fragment>\n}",EB={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},CB=class extends Ur{constructor(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super({name:"EffectMaterial",defines:{THREE_REVISION:x.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Sh(null),depthBuffer:new Sh(null),resolution:new Sh(new pi),texelSize:new Sh(new pi),cameraNear:new Sh(.3),cameraFar:new Sh(1e3),aspect:new Sh(1),time:new Sh(0)},blending:O,depthWrite:!1,depthTest:!1,dithering:r}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(n)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vt;this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=_B.replace(EB.FRAGMENT_HEAD,e.get(EB.FRAGMENT_HEAD)).replace(EB.FRAGMENT_MAIN_UV,e.get(EB.FRAGMENT_MAIN_UV)).replace(EB.FRAGMENT_MAIN_IMAGE,e.get(EB.FRAGMENT_MAIN_IMAGE)),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}".replace(EB.VERTEX_HEAD,e.get(EB.VERTEX_HEAD)).replace(EB.VERTEX_MAIN_SUPPORT,e.get(EB.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof jr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return EB}},MB=class extends Ur{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super({name:"LuminanceMaterial",defines:{THREE_REVISION:x.replace(/\D+/g,"")},uniforms:{inputBuffer:new Sh(null),threshold:new Sh(0),smoothing:new Sh(1),range:new Sh(null)},blending:O,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l);\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*l,l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:fB}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return null!==this.luminanceRange}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){null!==e?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},TB=0,IB=1,PB=class extends Ur{constructor(){super({name:"MaskMaterial",uniforms:{maskTexture:new Sh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),inputBuffer:new Sh(null),strength:new Sh(1)},blending:O,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef MASK_PRECISION_HIGH\nuniform mediump sampler2D maskTexture;\n#else\nuniform lowp sampler2D maskTexture;\n#endif\n#if MASK_FUNCTION != 0\nuniform float strength;\n#endif\nvarying vec2 vUv;void main(){\n#if COLOR_CHANNEL == 0\nfloat mask=texture2D(maskTexture,vUv).r;\n#elif COLOR_CHANNEL == 1\nfloat mask=texture2D(maskTexture,vUv).g;\n#elif COLOR_CHANNEL == 2\nfloat mask=texture2D(maskTexture,vUv).b;\n#else\nfloat mask=texture2D(maskTexture,vUv).a;\n#endif\n#if MASK_FUNCTION == 0\n#ifdef INVERTED\nmask=step(mask,0.0);\n#else\nmask=1.0-step(mask,0.0);\n#endif\n#else\nmask=clamp(mask*strength,0.0,1.0);\n#ifdef INVERTED\nmask=1.0-mask;\n#endif\n#endif\n#if MASK_FUNCTION == 2\ngl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);\n#else\ngl_FragColor=mask*texture2D(inputBuffer,vUv);\n#endif\n}",vertexShader:fB}),this.toneMapped=!1,this.setColorChannel(uB),this.setMaskFunction(TB)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==Le&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return void 0!==this.defines.INVERTED}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},DB=class extends Ur{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pi,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pi;super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Sh(null),searchTexture:new Sh(null),areaTexture:new Sh(null),resolution:new Sh(t),texelSize:new Sh(e)},blending:O,depthWrite:!1,depthTest:!1,fragmentShader:"#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)\n#if __VERSION__ < 300\n#define round(v) floor(v + 0.5)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);\n#endif\n}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);\n#endif\n}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){\n#if !defined(DISABLE_DIAG_DETECTION)\nweights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){\n#endif\nvec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);\n#if !defined(DISABLE_DIAG_DETECTION)\n}else{e.r=0.0;}\n#endif\n}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}",vertexShader:"uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return void 0===this.defines.DISABLE_DIAG_DETECTION}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return void 0===this.defines.DISABLE_CORNER_DETECTION}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},RB=new zr,BB=null;var LB=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Pass",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new No,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:RB;this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();null!==t&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;null!==t?t.material=e:(t=new Rr(function(){if(null===BB){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);void 0!==(BB=new yr).setAttribute?(BB.setAttribute("position",new or(e,3)),BB.setAttribute("uv",new or(t,2))):(BB.addAttribute("position",new or(e,3)),BB.addAttribute("uv",new or(t,2)))}return BB}(),e),t.frustumCulled=!1,null===this.scene&&(this.scene=new No),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e){}render(e,t,i,n,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(null!==t&&"object"==typeof t&&"function"==typeof t.dispose){if(t instanceof No||t===this.renderer)continue;this[e].dispose()}}}},OB=class extends LB{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super("CopyPass"),this.fullscreenMaterial=new AB,this.needsSwap=!1,this.renderTarget=e,void 0===e&&(this.renderTarget=new Fi(1,1,{minFilter:De,magFilter:De,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,n,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){void 0!==i&&(this.renderTarget.texture.type=i,i!==Le?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===jt&&(this.renderTarget.texture.encoding=jt))}},NB=class extends LB{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,n,r){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},kB=new Pi,FB=class extends LB{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,n,r){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=null!==s,c=a>=0;l?(kB.copy(e.getClearColor(kB)),e.setClearColor(s,c?a:o)):c&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(kB,o):c&&e.setClearAlpha(o)}},UB=-1,zB=class extends Zt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:UB,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:UB,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.resizable=e,this.base=new pi(1,1),this.preferred=new pi(t,i),this.target=this.preferred,this.s=n}get width(){let e,{base:t,preferred:i,scale:n}=this;return e=i.width!==UB?i.width:i.height!==UB?Math.round(i.height*(t.width/Math.max(t.height,1))):Math.round(t.width*n),e}set width(e){this.preferredWidth=e}get height(){let e,{base:t,preferred:i,scale:n}=this;return e=i.height!==UB?i.height:i.width!==UB?Math.round(i.width/Math.max(t.width/Math.max(t.height,1),1)):Math.round(t.height*n),e}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(UB),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return UB}},jB=!1,VB=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case L:t=this.materialsFlatShadedDoubleSide;break;case B:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded}else switch(e.material.side){case L:t=this.materialsDoubleSide;break;case B:t=this.materialsBackSide;break;default:t=this.materials}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,null!==e){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=R;t[2].skinning=!0,this.materialsBackSide=t.map((t=>{let i=t.clone();return i.uniforms=Object.assign({},e.uniforms),i.side=B,i})),this.materialsDoubleSide=t.map((t=>{let i=t.clone();return i.uniforms=Object.assign({},e.uniforms),i.side=L,i})),this.materialsFlatShaded=t.map((t=>{let i=t.clone();return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i})),this.materialsFlatShadedBackSide=t.map((t=>{let i=t.clone();return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=B,i})),this.materialsFlatShadedDoubleSide=t.map((t=>{let i=t.clone();return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=L,i}))}}render(e,t,i){let n=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,jB){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let e of n)e[0].material=e[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=n}disposeMaterials(){if(null!==this.material){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return jB}static set workaroundEnabled(e){jB=e}},GB=class extends LB{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new FB,this.overrideMaterialManager=null===i?null:new VB(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return null!==e?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new VB(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,n,r){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=s.background,h=e.shadowMap.autoUpdate,d=this.renderToScreen?null:t;null!==o&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(d),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=h}},HB=class extends LB{constructor(e,t){let{resolutionScale:i=1,width:n=zB.AUTO_SIZE,height:r=zB.AUTO_SIZE,renderTarget:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super("DepthPass"),this.needsSwap=!1,this.renderPass=new GB(e,t,new yo({depthPacking:Gt}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new Pi(16777215),o.overrideClearAlpha=1,this.renderTarget=s,void 0===this.renderTarget&&(this.renderTarget=new Fi(1,1,{minFilter:Te,magFilter:Te,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new zB(this,n,r,i);l.addEventListener("change",(e=>this.setSize(l.baseWidth,l.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,r){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},WB=(new Float32Array([255/256/256**3,255/256/65536,255/256/256,255/256]),{SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18}),QB=new Map([[WB.SKIP,null],[WB.ADD,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}"],[WB.ALPHA,"vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}"],[WB.AVERAGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}"],[WB.COLOR_BURN,"float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[WB.COLOR_DODGE,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[WB.DARKEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}"],[WB.DIFFERENCE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}"],[WB.EXCLUSION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}"],[WB.LIGHTEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}"],[WB.MULTIPLY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}"],[WB.DIVIDE,"float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[WB.NEGATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}"],[WB.NORMAL,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}"],[WB.OVERLAY,"float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[WB.REFLECT,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[WB.SCREEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}"],[WB.SOFT_LIGHT,"float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[WB.SUBTRACT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}"]]),qB=class extends Zt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.f=e,this.opacity=new Sh(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return QB.get(this.blendFunction)}},XB={NONE:0,DEPTH:1,CONVOLUTION:2},YB=class extends Zt{constructor(e,t){let{attributes:i=XB.NONE,blendFunction:n=WB.SCREEN,defines:r=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=r,this.uniforms=s,this.extensions=a,this.blendMode=new qB(n),this.blendMode.addEventListener("change",(e=>this.setChanged()))}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(null!==t&&"object"==typeof t&&"function"==typeof t.dispose){if(t instanceof No||t===this.renderer)continue;this[e].dispose()}}}};function KB(e,t,i){for(let n of t){let t="$1"+e+n.charAt(0).toUpperCase()+n.slice(1),r=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(let e of i.entries())null!==e[1]&&i.set(e[0],e[1].replace(r,t))}}function JB(e,t,i,n,r,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=void 0!==o.get("fragment")&&/mainImage/.test(o.get("fragment")),c=void 0!==o.get("fragment")&&/mainUv/.test(o.get("fragment")),h=[],d=[],u=!1,p=!1;if(void 0===o.get("fragment"))console.error("Missing fragment shader",t);else if(c&&0!==(a&XB.CONVOLUTION))console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(l||c){let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=CB.Section;if(c){let t=`\t${e}MainUv(UV);\n`;i.set(m.FRAGMENT_MAIN_UV,i.get(m.FRAGMENT_MAIN_UV)+t),u=!0}if(null!==o.get("vertex")&&/mainSupport/.test(o.get("vertex"))){let t=`\t${e}MainSupport(`;t+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?"vUv);\n":");\n",i.set(m.VERTEX_MAIN_SUPPORT,i.get(m.VERTEX_MAIN_SUPPORT)+t),h=h.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map((e=>e[1]))),d=d.concat(h).concat([...o.get("vertex").matchAll(f)].map((e=>e[1])))}d=d.concat([...o.get("fragment").matchAll(f)].map((e=>e[1]))),d=d.concat([...t.defines.keys()].map((e=>e.replace(/\([\w\s,]*\)/g,"")))),d=d.concat([...t.uniforms.keys()]),t.uniforms.forEach(((t,i)=>s.set(e+i.charAt(0).toUpperCase()+i.slice(1),t))),t.defines.forEach(((t,i)=>r.set(e+i.charAt(0).toUpperCase()+i.slice(1),t))),KB(e,d,r),KB(e,d,o);let g=t.blendMode;if(n.set(g.blendFunction,g),l){let t=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,n=`${e}MainImage(color0, UV, `;0!==(a&XB.DEPTH)&&t.test(o.get("fragment"))&&(n+="depth, ",p=!0),n+="color1);\n\t";let r=e+"BlendOpacity";s.set(r,g.opacity),n+=`color0 = blend${g.blendFunction}(color0, color1, ${r});\n\n\t`,i.set(m.FRAGMENT_MAIN_IMAGE,i.get(m.FRAGMENT_MAIN_IMAGE)+n),n=`uniform float ${r};\n\n`,i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+n)}i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+o.get("fragment")+"\n"),null!==o.get("vertex")&&i.set(m.VERTEX_HEAD,i.get(m.VERTEX_HEAD)+o.get("vertex")+"\n")}else console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);return{varyings:h,transformedUv:u,readDepth:p}}var ZB=class extends LB{constructor(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];super("EffectPass"),this.fullscreenMaterial=new CB(null,null,null,e),this.effects=i.sort(((e,t)=>t.attributes-e.attributes)),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=CB.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,n=new Map,r=new Map,s=new Set,a=0,o=0,l=0,c=!1,h=!1;for(let u of this.effects)if(u.blendMode.blendFunction===WB.SKIP)l|=u.getAttributes()&XB.DEPTH;else if(0!==(l&u.getAttributes()&XB.CONVOLUTION))console.error("Convolution effects cannot be merged",u);else{l|=u.getAttributes();let e=JB("e"+a++,u,t,i,n,r,l);if(o+=e.varyings.length,c=c||e.transformedUv,h=h||e.readDepth,null!==u.extensions)for(let t of u.extensions)s.add(t)}let d=/\bblend\b/g;for(let u of i.values()){let i=u.getShaderCode().replace(d,`blend${u.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+i+"\n")}if(0!==(l&XB.DEPTH)){if(h){let i="float depth = readDepth(UV);\n\n\t";t.set(e.FRAGMENT_MAIN_IMAGE,i+t.get(e.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=null===this.getDepthTexture()}else this.needsDepthTexture=!1;if(c){let i="vec2 transformedUv = vUv;\n";t.set(e.FRAGMENT_MAIN_UV,i+t.get(e.FRAGMENT_MAIN_UV)),n.set("UV","transformedUv")}else n.set("UV","vUv");t.forEach(((e,t,i)=>i.set(t,e.trim().replace(/^#/,"\n#")))),this.uniformCount=r.size,this.varyingCount=o,this.skipRendering=0===a,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(r).setDefines(n)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vt;this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,n,r){for(let s of this.effects)s.update(e,t,n);if(!this.skipRendering||this.renderToScreen){let r=this.fullscreenMaterial;r.inputBuffer=t.texture,r.time+=n,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let n of this.effects)n.initialize(e,t,i),n.addEventListener("change",(e=>this.handleEvent(e)));this.updateMaterial(),this.verifyResources(),void 0!==i&&i!==Le&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){if("change"===e.type)this.recompile()}},$B=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],eL=class extends LB{constructor(){let{resolutionScale:e=.5,width:t=zB.AUTO_SIZE,height:i=zB.AUTO_SIZE,kernelSize:n=aL.LARGE}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("KawaseBlurPass"),this.renderTargetA=new Fi(1,1,{minFilter:De,magFilter:De,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let r=this.resolution=new zB(this,t,i,e);r.addEventListener("change",(e=>this.setSize(r.baseWidth,r.baseHeight))),this.blurMaterial=new bB,this.ditheredBlurMaterial=new bB,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=n}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,r){let s,a,o=this.scene,l=this.camera,c=this.renderTargetA,h=this.renderTargetB,d=$B[this.kernelSize],u=this.blurMaterial,p=t;for(this.fullscreenMaterial=u,s=0,a=d.length-1;s<a;++s){let t=0===(1&s)?c:h;u.kernel=d[s],u.inputBuffer=p.texture,e.setRenderTarget(t),e.render(o,l),p=t}this.dithering&&(u=this.ditheredBlurMaterial,this.fullscreenMaterial=u),u.kernel=d[s],u.inputBuffer=p.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(o,l)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let n=i.width,r=i.height;this.renderTargetA.setSize(n,r),this.renderTargetB.setSize(n,r),this.blurMaterial.setSize(n,r),this.ditheredBlurMaterial.setSize(n,r)}initialize(e,t,i){void 0!==i&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==Le?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===jt&&(this.renderTargetA.texture.encoding=jt,this.renderTargetB.texture.encoding=jt))}static get AUTO_SIZE(){return zB.AUTO_SIZE}},tL=class extends LB{constructor(){let{width:e=zB.AUTO_SIZE,height:t=zB.AUTO_SIZE,renderTarget:i,luminanceRange:n,colorOutput:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("LuminancePass"),this.fullscreenMaterial=new MB(r,n),this.needsSwap=!1,this.renderTarget=i,void 0===this.renderTarget&&(this.renderTarget=new Fi(1,1,{minFilter:De,magFilter:De,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new zB(this,e,t);s.addEventListener("change",(e=>this.setSize(s.baseWidth,s.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,n,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){void 0!==i&&i!==Le&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},iL=class extends LB{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new FB(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,n,r){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,h=this.inverted?0:1,d=1-h;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,h,4294967295),a.stencil.setClear(d),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},nL=class extends LB{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"inputBuffer";super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,null!==this.fullscreenMaterial){let t=this.fullscreenMaterial.uniforms;void 0!==t&&void 0!==t[e]&&(this.inputBufferUniform=t[e])}}render(e,t,i,n,r){null!==this.inputBufferUniform&&null!==t&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){void 0!==i&&i!==Le&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},rL=.001,sL=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*rL}getFixedDelta(){return this.fixedDelta*rL}setFixedDelta(e){return this.fixedDelta=1e3*e,this}getElapsed(){return this.elapsed*rL}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=void 0!==e?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},aL={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},oL=class extends YB{constructor(){let{blendFunction:e=WB.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:n=.5,intensity:r=1,width:s=zB.AUTO_SIZE,height:a=zB.AUTO_SIZE,kernelSize:o=aL.LARGE}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("BloomEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}",{blendFunction:e,uniforms:new Map([["map",new Sh(null)],["intensity",new Sh(r)]])}),this.renderTarget=new Fi(1,1,{minFilter:De,magFilter:De,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new tL({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new eL({resolutionScale:n,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",(e=>this.setSize(l.baseWidth,l.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let n=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,n),this.blurPass.render(e,n,n)):this.blurPass.render(e,t,n)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),void 0!==i&&(this.renderTarget.texture.type=i,e.outputEncoding===jt&&(this.renderTarget.texture.encoding=jt))}},lL=class extends YB{constructor(){let{blendFunction:e=WB.NORMAL,brightness:t=0,contrast:i=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("BrightnessContrastEffect","uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",{blendFunction:e,uniforms:new Map([["brightness",new Sh(t)],["contrast",new Sh(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},cL=class extends YB{constructor(){super("ColorAverageEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",{blendFunction:arguments.length>0&&void 0!==arguments[0]?arguments[0]:WB.NORMAL})}},hL=class extends YB{constructor(){let{blendFunction:e=WB.NORMAL,offset:t=new pi(.001,5e-4)}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("ChromaticAberrationEffect","varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",{vertexShader:"uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",blendFunction:e,attributes:XB.CONVOLUTION,uniforms:new Map([["offset",new Sh(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},dL=class extends YB{constructor(e){let{blendFunction:t=WB.NORMAL,worldFocusDistance:i,worldFocusRange:n,focusDistance:r=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=zB.AUTO_SIZE,height:c=zB.AUTO_SIZE}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super("DepthOfFieldEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;\n#else\nuniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;\n#endif\nuniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}",{blendFunction:t,attributes:XB.DEPTH,uniforms:new Map([["nearColorBuffer",new Sh(null)],["farColorBuffer",new Sh(null)],["nearCoCBuffer",new Sh(null)],["scale",new Sh(1)]])}),this.camera=e,this.renderTarget=new Fi(1,1,{minFilter:De,magFilter:De,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new nL(new yB(e));let h=this.cocMaterial;h.focusDistance=r,h.focusRange=a,void 0!==i&&(h.worldFocusDistance=i),void 0!==n&&(h.worldFocusRange=n),this.blurPass=new eL({kernelSize:aL.MEDIUM,width:l,height:c});let d=this.blurPass.getResolution();d.addEventListener("change",(e=>this.setSize(d.getBaseWidth(),d.getBaseHeight()))),this.maskPass=new nL(new PB(this.renderTargetCoC.texture));let u=this.maskPass.fullscreenMaterial;u.maskFunction=IB,u.colorChannel=pB,this.bokehNearBasePass=new nL(new mB(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new nL(new mB(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new nL(new mB(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new nL(new mB(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera;return vB(-t.position.distanceTo(e),t.near,t.far)}setDepthTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vt;this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let n=this.renderTarget,r=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(null!==this.target){let e=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=e}this.cocPass.render(e,null,r),this.blurPass.render(e,r,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,n),this.bokehFarFillPass.render(e,n,this.renderTargetFar),this.bokehNearBasePass.render(e,t,n),this.bokehNearFillPass.render(e,n,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let n=i.width,r=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach((i=>i.setSize(e,t))),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach((e=>e.setSize(n,r))),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((e=>e.fullscreenMaterial.setSize(n,r)))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((n=>n.initialize(e,t,i))),this.blurPass.initialize(e,t,Le),void 0!==i&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===jt&&(this.renderTarget.texture.encoding=jt,this.renderTargetNear.texture.encoding=jt,this.renderTargetFar.texture.encoding=jt,this.renderTargetMasked.texture.encoding=jt))}},uL=(new Vi,new bn,class extends YB{constructor(){let{blendFunction:e=WB.NORMAL,hue:t=0,saturation:i=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("HueSaturationEffect","uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",{blendFunction:e,uniforms:new Map([["hue",new Sh(new Vi)],["saturation",new Sh(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((3*e.x-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}}),pL=(new Pi,class extends YB{constructor(){let{blendFunction:e=WB.SCREEN,premultiply:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("NoiseEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));\n#ifdef PREMULTIPLY\noutputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);\n#else\noutputColor=vec4(noise,inputColor.a);\n#endif\n}",{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}}),fL=class extends YB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;super("PixelationEffect","uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",{uniforms:new Map([["active",new Sh(!1)],["d",new Sh(new pi)]])}),this.resolution=new pi,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}},mL=(Math.PI,new Vi,new Vi,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC"),gL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",vL={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},yL=class extends YB{constructor(){let e,t,{preset:i=vL.MEDIUM,edgeDetectionMode:n=xB.COLOR,predicationMode:r=wB.DISABLED}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("SMAAEffect","uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",{vertexShader:"varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",blendFunction:WB.NORMAL,attributes:XB.CONVOLUTION|XB.DEPTH,uniforms:new Map([["weightMap",new Sh(null)]])}),arguments.length>1&&(e=arguments[0],t=arguments[1],arguments.length>2&&(i=arguments[2]),arguments.length>3&&(n=arguments[3])),this.renderTargetEdges=new Fi(1,1,{minFilter:De,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new FB(!0,!1,!1),this.clearPass.overrideClearColor=new Pi(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new nL(new SB),this.edgeDetectionMaterial.edgeDetectionMode=n,this.edgeDetectionMaterial.predicationMode=r,this.weightsPass=new nL(new DB);let s=new Oc;s.onLoad=()=>{let i=new Ni(e);i.name="SMAA.Search",i.magFilter=Te,i.minFilter=Te,i.generateMipmaps=!1,i.needsUpdate=!0,i.flipY=!0,this.weightsMaterial.searchTexture=i;let n=new Ni(t);n.name="SMAA.Area",n.magFilter=De,n.minFilter=De,n.generateMipmaps=!1,n.needsUpdate=!0,n.flipY=!1,this.weightsMaterial.areaTexture=n,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),void 0!==e&&void 0!==t?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(e=new Image,t=new Image,e.addEventListener("load",(()=>s.itemEnd("search"))),t.addEventListener("load",(()=>s.itemEnd("area"))),e.src=mL,t.src=gL),this.applyPreset(i)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case vL.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case vL.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case vL.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case vL.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0}}setDepthTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vt;this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;null!==e&&null!==t&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return mL}static get areaImageDataURL(){return gL}},bL={DEFAULT:0,ESKIL:1},AL=class extends YB{constructor(){let{blendFunction:e=WB.NORMAL,technique:t=bL.DEFAULT,eskil:i=!1,offset:n=.5,darkness:r=.5}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("VignetteEffect","uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;\n#if VIGNETTE_TECHNIQUE == 0\nfloat d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));\n#else\nvec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));\n#endif\noutputColor=vec4(color,inputColor.a);}",{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new Sh(n)],["darkness",new Sh(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===bL.ESKIL}set eskil(e){this.technique=e?bL.ESKIL:bL.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}};new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array(2),new Float32Array(2),new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]),new Map([[wL(0,0,0,0),new Float32Array([0,0,0,0])],[wL(0,0,0,1),new Float32Array([0,0,0,1])],[wL(0,0,1,0),new Float32Array([0,0,1,0])],[wL(0,0,1,1),new Float32Array([0,0,1,1])],[wL(0,1,0,0),new Float32Array([0,1,0,0])],[wL(0,1,0,1),new Float32Array([0,1,0,1])],[wL(0,1,1,0),new Float32Array([0,1,1,0])],[wL(0,1,1,1),new Float32Array([0,1,1,1])],[wL(1,0,0,0),new Float32Array([1,0,0,0])],[wL(1,0,0,1),new Float32Array([1,0,0,1])],[wL(1,0,1,0),new Float32Array([1,0,1,0])],[wL(1,0,1,1),new Float32Array([1,0,1,1])],[wL(1,1,0,0),new Float32Array([1,1,0,0])],[wL(1,1,0,1),new Float32Array([1,1,0,1])],[wL(1,1,1,0),new Float32Array([1,1,1,0])],[wL(1,1,1,1),new Float32Array([1,1,1,1])]]);function xL(e,t,i){return e+(t-e)*i}function wL(e,t,i,n){let r=xL(e,t,.75),s=xL(i,n,.75);return xL(r,s,.875)}var SL=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(e){this.effect.blendMode.opacity.value=e},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(e){this.effect.blendMode.setBlendFunction(Number(e))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=WB.NORMAL}},_L=class extends SL{constructor(){super(oL),this.blendFunction=WB.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},EL=class extends SL{constructor(){super(lL)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},CL=class extends SL{constructor(){super(hL),this.effect.offset=new pi(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[1e3*this.effect.offset.x,1e3*this.effect.offset.y]}},ML=class extends SL{constructor(){super(cL)}},TL=class extends SL{constructor(){super(uL),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},IL=class extends SL{constructor(){super(pL),this.blendFunction=WB.OVERLAY}},PL=class extends SL{constructor(){super(AL)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},DL=class extends SL{constructor(e){super(dL)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&!1===this.isPerspectiveCamera||!e.isPerspectiveCamera&&!0===this.isPerspectiveCamera)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},RL=class extends SL{constructor(){super(fL)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},BL=class extends Ur{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new Sh(null)},blending:O,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}",fragmentShader:"#define GLSLIFY 1\nlayout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},LL=class extends LB{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new BL,this.resolutionVector=new pi,this.resolveMaterial=new Ur({name:"TAAResolveMaterial",uniforms:{inputBuffer:new Sh(null),historyBuffer:new Sh(null),velocityBuffer:new Sh(null),depthBuffer:new Sh(null),resolution:new Sh(new pi)},blending:O,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\n#include <common>\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;\n#define USE_YCOCG\n#define USE_CATMULL_ROM\nconst float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){\n#ifdef USE_YCOCG\nvec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);\n#else\nreturn texture(tex,uv);\n#endif\n}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){\n#ifdef CHOOSE_LONGEST_MOTION_VECTOR\nfloat longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;\n#else\nfloat closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;\n#endif\n}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);\n#ifdef USE_CATMULL_ROM\nvec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);\n#else\nvec4 previousColor=sample_color(historyBuffer,previousPixelPos);\n#endif\n#ifdef USE_YCOCG\npreviousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);\n#endif\nvec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);\n#ifdef USE_YCOCG\nvec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;\n#endif\nvec4 previousColorClipped=clamp(previousColor,cmin,cmax);\n#ifdef LUMINANCE_DIFFERENCES\n#ifdef USE_YCOCG\nfloat lum0=currentColor.r;float lum1=previousColorClipped.r;\n#else\nfloat lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);\n#endif\nfloat unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));\n#else\nconst float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);\n#endif\n#ifdef USE_YCOCG\ngl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);\n#else\ngl_FragColor=result;\n#endif\n}"}),this.historyRenderTarget=new Fi(1024,1024,{minFilter:De,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Fi(1024,1024,{minFilter:De,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},OL=class extends LB{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new HB(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new BL,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new BL,this.depthPass=new HB(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let n=this.camera.layers.mask,r=e;r.setRenderTarget(r.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],r.clear(),r.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),r.shadowMap.needsUpdate=!1,r.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=n}},NL=new No,kL=new Ur({transparent:!0,vertexShader:"\n        void main() {\n            gl_Position = vec4(0.0);\n        }\n    ",fragmentShader:"\n        layout(location = 1) out vec4 gVelocity;\n\n        void main() {\n            gl_FragColor = vec4(0.0);\n\t\t\tgVelocity = vec4(0.0);\n        }\n    "}),FL=class extends LB{constructor(e,t,i){super("OpaquePass",t??NL,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??NL}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse((e=>{e.layers.isEnabled(3)&&e instanceof sT&&(this.originalMaterials.push([e,e.material]),e.material=kL)})),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((e=>{e[0].material=e[1]}))}},UL=class{constructor(e){let{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:n=0,frameBufferType:r=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.renderer=e,this.helperStartIndex=0,this.copyPass=new OB,this.depthTexture=null,this.timer=new sL,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,r,n,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,r,n,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,r,n,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,null!==e){let t=e.getSize(new pi),i=e.getContext().getContextAttributes()?.alpha??!1,n=this.inputBuffer.texture[0].type;n===Le&&e.outputEncoding===jt&&(this.inputBuffer.texture[0].encoding=jt,this.outputBuffer.texture[0].encoding=jt,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(t.width,t.height,!1);for(let r of this.passes)r.initialize(e,i,n)}}replaceRenderer(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.renderer,n=i.domElement.parentNode;return this.setRenderer(e),t&&null!==n&&(n.removeChild(i.domElement),n.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new Po(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=Ke,e.type=He):e.type=Ue,e}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,n,r,s){let a,o=this.renderer,l=null===o?new pi:o.getDrawingBufferSize(new pi),c={minFilter:De,magFilter:De,wrapS:Ce,wrapT:Ce,stencilBuffer:t,depthBuffer:e};return n>0?(a=new Fi(l.width,l.height,c),a.samples=n):(r?(a=new zi(l.width,l.height,2,c),a.texture[1].type=je):a=new Fi(l.width,l.height,c),a.depthTexture=new Po(2048,2048),a.depthTexture.type=ze),i===Le&&null!==o&&o.outputEncoding===jt&&(Array.isArray(a.texture)?a.texture.forEach((e=>e.encoding=jt)):a.texture.encoding=jt),Array.isArray(a.texture)?a.texture.forEach(((e,t)=>{e.name=`EffectComposer.Buffer ${r} ${t}`,e.generateMipmaps=!1})):(a.texture.name=`EffectComposer.Buffer ${r}`,a.texture.generateMipmaps=!1),a.name=s,a}addPass(e,t){let i,n=this.passes,r=this.renderer,s=r.getDrawingBufferSize(new pi),a=r.getContext().getContextAttributes()?.alpha??!1;if(e.MRTCompatible&&(i=this.inputBuffer.texture[0].type),e.MRTCompatible||(i=this.inputBuffer.texture.type),e.setRenderer(r),e.setSize(s.width,s.height),e.initialize(r,a,i),this.autoRenderToScreen&&(n.length>0&&(n[n.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==t?n.splice(t,0,e):n.push(e),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){let t=this.createDepthTexture();for(e of n)e.setDepthTexture(t)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(-1!==i&&t.splice(i,1).length>0){if(null!==this.depthTexture){let i=(e,t)=>e||t.needsDepthTexture;t.reduce(i,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t,i,n,r,s=this.renderer,a=this.copyPass,o=this.inputBuffer,l=this.outputBuffer,c=this.inputBufferSingle,h=this.outputBufferSingle,d=!1;void 0===e&&(e=this.timer.update().getDelta());for(let u of this.passes)u.enabled&&(u.MRTCompatible?u.render(s,o,l,e,d):u.render(s,c,h,e,d),u.needsSwap&&(d&&(a.renderToScreen=u.renderToScreen,t=s.getContext(),i=s.state.buffers.stencil,i.setFunc(t.NOTEQUAL,1,4294967295),a.render(s,o,l,e,d),i.setFunc(t.EQUAL,1,4294967295)),n=o,r=c,o=l,c=h,l=n,h=r),u instanceof iL?d=!0:u instanceof NB&&(d=!1))}setSize(e,t,i){let n=this.renderer;if(this._width=e,this._height=t,void 0===e||void 0===t){let i=n.getSize(new pi);e=i.width,t=i.height}n.setSize(e,t,i);let r=n.getDrawingBufferSize(new pi);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height),this.inputBufferSingle.setSize(r.width,r.height),this.outputBufferSingle.setSize(r.width,r.height);for(let s of this.passes)s.setSize(r.width,r.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),null!==this.inputBufferSingle&&this.inputBufferSingle.dispose(),null!==this.outputBufferSingle&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},zL=new Ur({name:"CombineMaterial",uniforms:{inputBufferA:new Sh(null),inputBufferB:new Sh(null)},blending:O,depthWrite:!1,depthTest:!1,vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    gl_Position = vec4(position.xy, 1.0, 1.0);\n    vUv = position.xy * 0.5 + 0.5;\n}\n",fragmentShader:"\n    varying vec2 vUv;\n    uniform sampler2D inputBufferA;\n    uniform sampler2D inputBufferB;\n\n    // TODO: Why do we need these when postpro of framemode is enabled???\n    layout(location = 1) out vec4 gVelocity;\n\n    void main() {\n\tvec4 resA = texture2D(inputBufferA, vUv);\n\tvec4 resB = texture2D(inputBufferB, vUv);\n    float a = resA.a + resB.a * ( 1.0 - resA.a );\n\n\tvec4 res;\n\tres.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));\n\tres.a = resA.a + resB.a * (1.0 - resA.a);\n\tgl_FragColor = res;\n    gVelocity = vec4(0.0);\n    }\n"}),jL=class extends LB{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=zL,this.helperPass=new FL(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new FL(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new yL({preset:vL.LOW,edgeDetectionMode:xB.COLOR});this.effectPass=new ZB(this.camera,t),this.rt=new Fi(10,10,{minFilter:De,magFilter:De,wrapS:Ce,wrapT:Ce,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let n=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(n),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},VL=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],GL=new Ur({vertexShader:"#define GLSLIFY 1\n#include <skinning_pars_vertex>\n#include <morphtarget_pars_vertex>\nout vec3 n;void main(){\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\nvec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}",fragmentShader:"#define GLSLIFY 1\nin vec3 n;void main(){gl_FragColor=vec4(n,1.0);}"}),HL=new Ur({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){\n#ifdef DEBUG\nfloat d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);\n#else\nvec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;\n#endif\n}",uniforms:{texture_ao_lrez:new Sh(null),texture_depth_lrez:new Sh(null),texture_depth_hrez:new Sh(null),near:new Sh(null),far:new Sh(null)}}),WL=class extends LB{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,n=1024;this.gBuffer=new Fi(i,n,{type:zg?je:ze,depthTexture:new Po(i,n),minFilter:De,magFilter:De}),this.depthBufferHighRes=new Fi(i,n,{depthTexture:new Po(i,n)}),this.aoBuffer=new Fi(i,n,{minFilter:De,magFilter:De}),this.splineScene=e,this.splineCamera=t;let r=new Float32Array(2*VL.length);for(let a=0;a<VL.length;a++){let e=2*a;r[e+0]=VL[a][0],r[e+1]=VL[a][1]}this.blueNoiseInDiskTexture=new jo(r,VL.length,1,$e,ze),this.blueNoiseInDiskTexture.wrapS=Ee,this.blueNoiseInDiskTexture.wrapT=Ee,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Ur({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}\n#define USE_GBUFFER_NORMALS\nvoid main(){vec3 view_space_p=get_view_position(v_uv);\n#ifdef USE_GBUFFER_NORMALS\nvec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;\n#else\nvec3 view_space_n=-rebuild_normal(v_uv,view_space_p);\n#endif\nfloat radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}",uniforms:{near:new Sh(null),far:new Sh(null),fov:new Sh(null),proj_info:new Sh(new ki),is_ortho:new Sh(!1),resolution:new Sh(new pi),radius_of_influence:new Sh(8),radius_in_screen_space:new Sh(1),exponent:new Sh(1),ao_color:new Sh(new Vi),bias:new Sh(.5),texture_depth:new Sh(null),texture_normals:new Sh(null),texture_blue_noise:new Sh(null),texture_blue_noise_in_disk:new Sh(this.blueNoiseInDiskTexture),frame_index:new Sh(0),fog_enabled:new Sh(!1),fog_near:new Sh(1),fog_far:new Sh(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Fi(i,n,{minFilter:De,magFilter:De,wrapS:Ce,wrapT:Ce,depthBuffer:!1,type:ze});let s=new yL({preset:vL.ULTRA,edgeDetectionMode:xB.COLOR});this.effectPass=new ZB(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,n=e*i,r=t*i;this.gBuffer.setSize(n,r),this.aoBuffer.setSize(n,r),this.hbaoMaterial.uniforms.resolution.value.set(n,r),this.aaBuffer.setSize(n,r),this.effectPass.setSize(n,r)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,HL.uniforms.texture_depth_hrez.value=e,HL.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=GL;let n=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=n,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let e=this.splineCamera.perspCamera.projectionMatrix.elements,t=2/e[0],i=2/e[5],n=-(1-e[8])/e[0],r=-(1+e[9])/e[5];this.hbaoMaterial.uniforms.proj_info.value.set(t,i,n,r);let s=this.splineCamera.perspCamera.fov*(Math.PI/180),a=this.hbaoMaterial.uniforms.resolution.value.y/(2*Math.tan(.5*s)),o=.5*this.hbaoMaterial.uniforms.radius_of_influence.value*a;this.hbaoMaterial.uniforms.radius_in_screen_space.value=o,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let e=this.splineCamera.orthoCamera.projectionMatrix.elements,t=2/e[0],i=2/e[5],n=-(1+e[12])/e[0],r=-(1-e[13])/e[5];this.hbaoMaterial.uniforms.proj_info.value.set(t,i,n,r);let s=this.hbaoMaterial.uniforms.resolution.value.y/i*.5,a=this.hbaoMaterial.uniforms.radius_of_influence.value*s;this.hbaoMaterial.uniforms.radius_in_screen_space.value=a,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=HL,HL.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,HL.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,HL.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},QL=class extends nL{constructor(){super(new Ur({vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tInput;\nuniform sampler2D tMap;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nuniform vec2 uResolution;\nuniform vec2 uCoords;\n\n// Draws a rectangle at center <st> with size <size>\nfloat rectangle(vec2 st, vec2 size) {\n    size = vec2(0.5) - size * 0.5;\n    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));\n    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));\n\n    return uv.x * uv.y;\n}\n\nuniform vec2 uSize;\nuniform float uScale;\nuniform float uDPR;\nuniform float uCurrent;\nuniform vec3 uSceneColor;\n\nvoid main() {\n    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n    screenUv *= 1.0 / uDPR;\n\n    vec2 center = vec2(0.5, -0.5);\n    vec2 outsideUv = screenUv;\n    outsideUv += center;\n    outsideUv -= uCoords.xy / uResolution.xy;\n    outsideUv = (outsideUv - 0.5) + 0.5;\n    outsideUv -= center;\n    vec2 s = (uSize / uResolution) * uScale;\n    float isOutside = 1.0 - rectangle(outsideUv, s);\n    \n    vec2 mid = vec2(0.5);\n    vec2 insideUv = (screenUv - mid + s * mid) / s;\n    vec4 background = texture2D(tInput, screenUv);\n    vec4 image = texture2D(tMap, insideUv);\n    gl_FragColor = mix(image, background, isOutside);\n}\n",uniforms:{tInput:new Sh(null),tMap:new Sh(null),uResolution:new Sh(new pi),uSize:new Sh(new pi),uCoords:new Sh(new pi),uScale:new Sh(1),uSceneColor:new Sh(new Pi(16711680)),uDPR:new Sh(1),uCurrent:new Sh(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},qL=[],XL=class extends nL{constructor(){super(new Ur({vertexShader:"\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D toScene;\nuniform sampler2D fromScene;\nuniform vec2 resolution;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nuniform float mixRatio;\nuniform sampler2D tMixTexture;\nuniform int useTexture;\nuniform float threshold;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( fromScene, screenUv );\n\tvec4 texel2 = texture2D( toScene, screenUv );\n\n\tif (useTexture==1) {\n\t\t\n\t\tvec4 transitionTexel = texture2D( tMixTexture, screenUv );\n\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t} else {\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixRatio );\n\t\t\n\t}\n}\n",uniforms:{toScene:new Sh(null),fromScene:new Sh(null),uResolution:new Sh(new pi),uDPR:new Sh(1),mixRatio:new Sh(0),threshold:new Sh(.1),useTexture:new Sh(0),tMixTexture:{value:qL[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},YL=class extends nL{constructor(){super(new Ur({vertexShader:"\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D inputBuffer;\nuniform sampler2D blurredInputBuffer;\nuniform sampler2D overlay;\nuniform float blurIntensity;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( overlay, screenUv );\n\tvec4 texel2 = texture2D( inputBuffer, screenUv );\n\tvec4 texel3 = texture2D( blurredInputBuffer, screenUv );\n\n\tfloat blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;\n    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );\n}\n",uniforms:{inputBuffer:new Sh(null),blurredInputBuffer:new Sh(null),overlay:new Sh(null),uResolution:new Sh(new pi),uDPR:new Sh(1),blurIntensity:new Sh(0)}})),this._blurEnabled=!1,this.blurTarget=new Fi(1,1,{minFilter:De,magFilter:De,wrapS:Ce,wrapT:Ce}),this.blurPass=new eL({width:window.innerWidth,height:window.innerHeight,kernelSize:aL.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let e=t.data.backgroundBlur,i=e.radius;this._blurEnabled=e.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=i/3}}render(e,t,i,n,r){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,n,r)),super.render(e,t,i,n,r)}},KL=class extends nL{constructor(){super(new Ur({vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tInput;\nuniform sampler2D tOverlayImage;\nvarying vec2 vUv;\nuniform vec2 uResolution;\nuniform vec2 uRightBottom;\nuniform vec2 uImageSize;\nuniform float uScale;\nuniform float uDPR;\n\nvec3 blendNormal(vec3 base, vec3 blend) {\n\treturn blend;\n}\n\nvec3 blendNormal(vec3 base, vec3 blend, float opacity) {\n\treturn (blendNormal(base, blend) * opacity + base * (1.0 - opacity));\n}\n\nvec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {\n\tvec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);\n\tif (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {\n\t\treturn vec4(0.0);\n\t}\n\treturn texture2D(image, uv);\n}\n\nvoid main() {\n    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);\n\tvec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);\n    vec4 background = texture2D(tInput, screenUV);\n    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);\n    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));\n}\n",uniforms:{tInput:new Sh(null),tOverlayImage:new Sh(null),uResolution:new Sh(new pi),uImageSize:new Sh(new pi),uRightBottom:new Sh(new pi(20,20)),uScale:new Sh(.25),uDPR:new Sh(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(e){this.uniforms.tOverlayImage.value=e,this.uniforms.uImageSize.value.set(e.image.width,e.image.height)}};function JL(e,t){return t&&t.enabled&&e.push(t.effect),e}var ZL=e=>Object.values(WB).includes(e)?e:WB.NORMAL,$L=class extends Zt{constructor(e,t){super(),this._needsDOFResize=t,this.postprocessingState=ix.defaultData,this._scene=new No,this._camera=new YR,this.effects=new Map,this.blueNoiseTexture=new jo,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new ah,this.renderer=e,this.debug=!1,this.effects.set("bloom",new _L),this.effects.set("chromaticAberration",new CL),this.effects.set("vignette",new PL),this.effects.set("noise",new IL),this.effects.set("colorAverage",new ML),this.effects.set("hueSaturation",new TL),this.effects.set("brightnessContrast",new EL),this.effects.set("depthOfField",new DL),this.effects.set("pixelation",new RL),this.effectComposer=new UL(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new FL(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new OL(this.scene,this.camera,this.renderer),this.aoPass=new WL(this.scene,this.camera),this.taaPass=new LL,this.taaPass.renderToScreen=!1,this.helperPass=new jL(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new QL,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new YL,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new KL,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new XL,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){void 0!==e?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];!0!==i.enabled||e||!this._renderToScreen?i.renderToScreen=!1:(i.renderToScreen=!0,e=!0)}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new jo(e,128,128),this.blueNoiseTexture.wrapS=Ee,this.blueNoiseTexture.wrapT=Ee,this.blueNoiseTexture.minFilter=Te,this.blueNoiseTexture.magFilter=Te,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,n,r,s,a,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=n,this.aoPass.fogEnabled=r,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){if(this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let e=[this.effects.get("pixelation")].reduce(JL,[]);e.length>0&&(this.uvEffectPass=new ZB(this.camera,...e),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let t=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(JL,[]);if(t.length>0&&(this.effectPass=new ZB(this.camera,...t),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&this.effects.get("depthOfField")?.enabled&&void 0!==window)){let e=this.renderer.viewportWidth,t=this.renderer.viewportHeight;this.renderer.setSize(e-1,t-1),this.renderer.setSize(e,t)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let e=new pi;this.renderer.getDrawingBufferSize(e),this._rt=new Fi(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:Ee,wrapT:Ee}),this._rt.samples=0,this._savePass=new OB(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new OB(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(!0===e?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(null!==e?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}setWatermark(e){this.logoOverlayPass.enabled=null!==e,e&&(this.logoOverlayPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,n=!1;t!==this.postprocessingState.enabled&&(n=!0);for(let r of Object.entries(i)){let e=r[1],t=this.effects.get(r[0]);if(t){t.enabled!==e.enabled&&(n=!0),t.enabled=e.enabled;for(let[i,n]of Object.entries(e))"blendFunction"===i?t.blendFunction=ZL(n):t[i]=n}}this.postprocessingState=e,n&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,n){e instanceof ki?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,n),this.effectComposer.outputBuffer.scissor.set(e,t,i,n));let r=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(r),this.effectComposer.outputBuffer.scissor.multiplyScalar(r),this.renderer.setScissor(e,t,i,n)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,n){e instanceof ki?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,n),this.effectComposer.outputBuffer.viewport.set(e,t,i,n))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let i=this.renderer.getPixelRatio();this._rt.setSize(e*i,t*i)}}dispose(){this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.dispose()}},eO=is.lights_fragment_begin,tO=is.shadowmask_pars_fragment,iO=null,nO=new Ur({vertexShader:"\nattribute vec3 randomColor;\nvarying vec3 vNormal;\nflat out vec3 vColor;\n#include <skinning_pars_vertex>\n#include <morphtarget_pars_vertex>\n\t\nvoid main()\n{\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\nvec3 transformed = vec3(position);\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n\nvNormal = normal;\nvColor = randomColor;\ngl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));\n}\n",fragmentShader:"\nuniform float depthContrast;\nvarying vec3 vNormal;\nflat in vec3 vColor;\nvoid main()\n{\nvec3 normal = (normalize(vNormal)).rgb;\n\nfloat contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;\n\nvec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);\ngl_FragColor = vec4(resultColor, vColor.r);\ngl_FragColor = vec4(resultColor, vColor.r);\n}\n",uniforms:{depthContrast:{value:1}}}),rO=new Ni,sO=new pi,aO=class extends Lo{constructor(e){var t;super(e),t=this,this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new pi,this.dummyCamera=new YR,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.getContext(),s=0;e&&(s|=r.COLOR_BUFFER_BIT),i&&(s|=r.DEPTH_BUFFER_BIT),n&&(s|=r.STENCIL_BUFFER_BIT),r.clear(s),r.clearBufferfv(r.COLOR,1,[0,0,0,1])},this.pipeline=new $L(this,e?.needsDOFResize??!1),this.autoClear=!1;let i=this.setPixelRatio.bind(this),n=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=I,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(Xb){console.warn(Xb)}this.setPixelRatio=e=>{this._pixelRatio!==e&&(this._pixelRatio=e,i(e))},this.setSize=function(e,i){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(t.viewportWidth!==e||t.viewportHeight!==i)&&(t.viewportWidth=e,t.viewportHeight=i,n(e,i,r),t.normalRenderTarget?.setSize(e*t._pixelRatio,i*t._pixelRatio),t._resizeTransmission(e,i),t.transmissionDepthTarget?.setSize(e*t._pixelRatio/2,i*t._pixelRatio/2),t.pipeline.resize(e,i,r))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){void 0===this.aoRenderTarget&&(this.aoRenderTarget=new Fi(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:De,magFilter:De,wrapS:Ce,wrapT:Ce,depthBuffer:!1}))}_resizeTransmission(e,t){this.transmissionRenderTarget?.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),this.aoRenderTarget?.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return 1===UI.transmissionLod.value}set hdTransmission(e){UI.transmissionLod.value=!0===e?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){void 0===this.transmissionRenderTarget&&(this.transmissionRenderTarget=new Fi(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:Be,magFilter:De,wrapS:Ce,wrapT:Ce,depthBuffer:!1}),this.transmissionDepthTarget=new Fi(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Te,magFilter:Te,depthBuffer:!1}))}createNormalRenderTarget(){void 0===this.normalRenderTarget&&(this.normalRenderTarget=new Fi(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Te,magFilter:Te,type:ze,depthTexture:new Po(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity((e=>{e.layers.isEnabled(8)&&(e.copyPreviousMatrix=!1)})),this.setRenderTarget(this.normalRenderTarget),this.clear(),nO.uniforms.depthContrast.value=i instanceof YR?(i.far-i.near)/1e4:1,t.overrideMaterial=nO,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?Dk:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity((e=>{e.layers.isEnabled(8)&&(e.copyPreviousMatrix=!0)})))}renderSplineSceneWithDummyCamera(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let n=t.height,r=t.width,s=this.viewportWidth/this.viewportHeight;r<n?r=n*s:n=r/s,this.dummyCamera.setViewplaneSize(r,n);for(let a=0;a<i;a++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t){let{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:n=this.sceneHelpersOnTop,overrideTransmission:r,overrideNormal:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e instanceof Bk?e.activePage:e,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(!1===this.isXRCopyPassSet&&null!==this.getRenderTarget()&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach(((e,t)=>{UI.penumbraSize.value[t]=e})),UI.pixelRatioNode.value=this.getPixelRatio(),0!==this.resolution.x&&0!==this.resolution.y?UI.resolution.value.set(this.resolution.x,this.resolution.y):UI.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),void 0!==s?(UI.normalRenderTarget.value=s,UI.normalRenderTargetDepth.value=rO):l.needsNormal()&&(this.createNormalRenderTarget(),UI.normalRenderTarget.value=this.normalRenderTarget.texture,UI.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,t));let c=a.data.ao,h=c.occlusion;if(h&&(this.createAORenderTarget(),UI.aoRenderTarget.value=this.aoRenderTarget.texture),UI.aoEnabled.value=h,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,a.aoColor,null!==a.fog,a.backupFog.near,a.backupFog.far,c.aoFullRes&&!zg),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&a.uiCanvas?.enabled&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let e=this.getSize(sO),t=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==t)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},t),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(e.x,e.y,t),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let e=this.getSize(sO),t=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(e.x,e.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=t}let d=!1;if(void 0!==r)UI.transmissionRenderTarget.value=r,UI.transmissionRenderTargetDepth.value=rO,this.pipeline.setTransmissionPassEnabled(!1);else{let e=l.needsTransmission();e&&(void 0===this.transmissionRenderTarget&&(d=!0),this.createTransmissionRenderTarget(),UI.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,UI.aspectRatio.value=function(e,t){return e>=t?new pi(t/e,1):new pi(1,e/t)}(this.viewportWidth,this.viewportHeight),UI.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(e)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=n,this.pipeline.scene=a,this.pipeline.camera=t,d&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!n&&this.pipeline.disableHelpers()),void 0!==this.clearAlphaOverride&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach((e=>{e.onBeforeShadowPass(this)})),a.overrideMaterial=l.wireframeState?Dk:null,this.pipeline.render(),UI.frameIndex.value=(UI.frameIndex.value+1)%16,t instanceof YR&&t.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let n=this.pipeline.sceneTransitionPass.uniforms;n.uDPR.value=window.devicePixelRatio,n.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){this._superDispose(),this.pipeline.dispose(),this.aoRenderTarget?.dispose(),this.transmissionRenderTarget?.dispose(),this.transmissionDepthTarget?.dispose(),this.normalRenderTarget?.dispose(),this.normalRenderTarget?.depthTexture?.dispose()}},oO=class extends(DR(Uh)){constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,arguments.length>2&&void 0!==arguments[2]?arguments[2]:10066329),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){OR(this.object,oO.geometryHelper,e,t)}},lO=class extends(DR(Oh)){constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,arguments.length>2&&void 0!==arguments[2]?arguments[2]:6710886),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){OR(this.object,lO.geometryHelper,e,t)}},cO=class extends(DR(Lh)){constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:6710886),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){OR(this.object,cO.geometryHelper,e,t)}update(){if(void 0!==this.object){let e=cO._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let n=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(let r=0,s=this.cone.material.length;r<s;r++)this.cone.material[r].color.set(n);else this.cone.material.color.set(n)}}},hO=cO;hO._vector=new Vi;var dO=class extends Mo{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new Rr(new ts(1,1),new rr({transparent:!0,opacity:0,side:L})),this.add(this.caretMesh),this.selectionMesh=new Rr(new ts(1,1),new rr({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:L})),this.add(this.selectionMesh),this.hide()}get caretHeight(){return this.object?.AD??0}show(e){this.visible=!0,this.object=e,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=.5*-this.caretHeight,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(void 0===this.object)return;this.updateHelperMatrix();let{depth:e}=this.object.geometry.userData.parameters;this.caretMesh.position.z=e,this.selectionMesh.position.z=e}updateHelperMatrix(){if(void 0===this.object)return;let e=this.object,t=e.parent;null!==t&&t.updateWorldMatrix(!0,!1),e.matrixAutoUpdate&&e.updateMatrix(),null!==t?(this.matrixWorld.multiplyMatrices(t.matrixWorld,e.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,e.matrix)):this.matrixWorld.multiplyMatrices(e.hiddenMatrix,e.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);e.updateWorldMatrix(!0,!0)}setCaretColor(e){let t=this.caretMesh.material;t.color.setRGB(e.r,e.g,e.b);let i=this._caretVisibleAlpha===t.opacity;this._caretVisibleAlpha=e.a,i&&(t.opacity=this._caretVisibleAlpha)}setSelectionColor(e){this.selectionMesh.material.color.setRGB(e.r,e.g,e.b)}setCaretPosition(e){if(void 0===this.object)return;this.caretIndex=e;let t=this.object.wrappedText,[i,n]=pO(t,e),[r,s]=e>0?pO(t,e-1):[null,null];"\n"===(e>0&&t.length?t[r].charAt(s):null)&&(i++,n=0),this.current.start=e,this.current.end=void 0;let[a,o]=uO(this.object,i,n),{AD:l,descender:c}=this.object,h=c+.5*l,{width:d,height:u,depth:p}=this.object.geometry.userData.parameters,f="string"==typeof d?0:d,m="string"==typeof u?0:u;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(a-.5*f,o+h+.5*m,p),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(e,t){if(void 0===this.object)return;let i=this.object.wrappedText;this.current.start=e,this.current.end=t;let n=[],r=[],s=function(e,t,i){let[n,r]=pO(e,t),[s,a]=pO(e,i),o=[];r>=e[n].length&&(n++,r=0);for(let l=n;l<=s;l++){let t=e[l],i=l===n?r:0,c=l===s?a:t.length;o.push([l,i,c])}return o}(i,e,t),{lineHeight:a,AD:o,descender:l}=this.object,c=l+.5*o-.5*a;for(let[g,v,y]of s)if(v!==y){let[e,t]=uO(this.object,g,v),[i,s]=uO(this.object,g,y);t+=c,s+=c,s+=a;let o=n.length/3;n.push(e,t,0),n.push(i,t,0),n.push(i,s,0),n.push(e,s,0),r.push(o+0,o+1,o+2),r.push(o+2,o+3,o+0)}let h=new yr;h.setIndex(r),h.setAttribute("position",new hr(n,3));let{width:d,height:u,depth:p}=this.object.geometry.userData.parameters,f="string"==typeof d?0:d,m="string"==typeof u?0:u;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=h,this.selectionMesh.position.x=.5*-f,this.selectionMesh.position.y=.5*m,this.selectionMesh.position.z=p,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"previous";if(void 0===this.object||void 0===this.object.font)return;let n=this.object.wrappedText,r=n.length,s=this.object.lineHeight,a=r*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,c="string"==typeof o?0:o,h=0;3===l?h=c-a:2===l&&(h=.5*c-.5*a);let d=Math.min(Math.floor(Math.max(Math.min(-t-h,a),0)/s),r-1),u=this.object.charCoords[d],p=this.object.charWidths[d],f=0,m=!1;if("previous"===i){for(let g=0;g<u.length;g++)if(u[g][0]+.5*p[g]-e>0){f=g,m=!0;break}}else if("closest"===i){let t=1/0;for(let i=0;i<u.length;i++){let n=u[i][0]+.5*p[i],r=Math.abs(n-e);r<t&&(t=r,f=i,m=!0)}}else for(let g=0;g<u.length;g++){let t=u[g][0],i=u[g][0]+p[g];if(e>=t&&e<i){f=g,m=!0;break}}return m||(f=u.length),{index:this.getGlobalIndexFromLineAndCharIndexes(n,d,f),lineIndex:d,characterIndex:f}}getGlobalIndexFromLineAndCharIndexes(e,t,i){return e.slice(0,t).reduce(((e,t)=>e+t.length),0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function uO(e,t,i){let{charCoords:n,charWidths:r,initialOffsetY:s,lineHeight:a}=e;if(n[t]&&0===n[t].length||0===n.length){let i=0,{horizontalAlign:n}=e.data.geometry,r=e.wrappedText,{width:o}=e.geometry.userData.parameters;return 1===r.length&&0===r[0].length&&(3===n?i=.5*o:2===n&&(i=o)),[i,s-a*t]}let o=n[t];if(void 0===o||0===o.length)return[0,0];let[l,c]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=r[t][i-1]),[l,c]}function pO(e,t){let i=0;for(let n=0;n<e.length;n++){let r=e[n],s=t-i;if(s<=r.length)return[n,s];i+=r.length}return[Math.max(0,e.length-1),e[e.length-1]?.length??0]}function fO(e,t){return"string"==typeof e?t.data.colors[e]:e}function mO(e){return e.colors[0]}var gO,vO=class extends(tB(nh,oO)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.top=1250,n.bottom=-1250,n.right=1250,n.left=-1250,n.near=-1e4,n.far=2500;let r=new Vh(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Vh&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=void 0!==e.depth&&e.depth!==this.shadow.camera.far||void 0!==e.size&&e.size/2!==this.shadow.camera.right;void 0!==e.size&&function(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}(this,e.size),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),void 0!==e.penumbraSize&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},yO=new Vi,bO=new Vi,AO=new ji,xO=class extends(tB(Kc,hO)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=2*ui.RAD2DEG*this.angle,n.aspect=1,n.near=100,n.far=2500;let r=new Vh(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof Vh&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),bO.setFromMatrixPosition(this.matrixWorld),AO.setFromRotationMatrix(this.matrixWorld),yO.copy(this.up).applyQuaternion(AO).negate().multiplyScalar(this.distance),this.target.position.copy(bO).add(yO),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.angle&&(this.angle=e.angle),void 0!==e.penumbra&&(this.penumbra=e.penumbra),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.penumbraSize&&t.scene.markPenumbraSizeDirty(),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function wO(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function SO(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function _O(e){let[t,i,n]=function(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,n=(e[1][0]+e[0][1])/2,r=(e[1][0]-e[0][1])/2,s=Math.sqrt(t*t+r*r),a=Math.sqrt(i*i+n*n),o=s+a,l=s-a,c=Math.atan2(n,i),h=Math.atan2(r,t),d=(h-c)/2,u=(h+c)/2,p=[[Math.cos(u),Math.sin(u)],[-Math.sin(u),Math.cos(u)]],f=[[o,0],[0,l]],m=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]];return p[0][0]*=-1,p[0][1]*=-1,m[0][0]*=-1,m[1][0]*=-1,[p,f,m]}(e),r=wO(t,SO(n)),s=wO(wO(n,i),SO(n));return{rotation:Math.atan2(r[1][0],r[0][0]),scale:[s[0][0],s[1][1]],shear:[s[0][1]/s[1][1],s[1][0]/s[0][0]]}}(e=>{function t(e){return[e[0],e[3],e[1],e[4],e[2],e[5]]}e.identity=function(){return[1,0,0,0,1,0,0,0,1]},e.copy=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.identity();for(let e=0,n=t.length;e<n;e++)i[e]=t[e];return i},e.create=function(t,i,n,r,s,a){return e.setAbcdef(e.identity(),t,i,n,r,s,a)},e.setAbcdef=function(e,t,i,n,r,s,a){return e[0]=t,e[1]=n,e[2]=s,e[3]=i,e[4]=r,e[5]=a,e},e.append=function(i,n){let[r,s,a,o,l,c]=t(i),[h,d,u,p,f,m]=t(n),g=h*r+d*a,v=h*s+d*o,y=u*r+p*a,b=u*s+p*o,A=f*r+m*a+l,x=f*s+m*o+c;return e.create(g,v,y,b,A,x)},e.prepend=function(i,n){let[r,s,a,o,l,c]=t(i),[h,d,u,p,f,m]=t(n),g=r,v=s,y=a,b=o;(1!==h||0!==d||0!==u||1!==p)&&(g=r*h+s*u,v=r*d+s*p,y=a*h+o*u,b=a*d+o*p);let A=l*h+c*u+f,x=l*d+c*p+m;return e.create(g,v,y,b,A,x)},e.getAbcdef=t,e.invert=function(t){let[i,n,r,s,a,o]=e.getAbcdef(t),l=i*s-n*r,c=s/l,h=-n/l,d=-r/l,u=i/l,p=(r*o-s*a)/l,f=-(i*o-n*a)/l;return e.create(c,h,d,u,p,f)},e.apply=function(t,i){let[n,r]=t,[s,a,o,l,c,h]=e.getAbcdef(i);return[s*n+o*r+c,a*n+l*r+h]},e.applyInverse=function(t,i){let[n,r,s,a,o,l]=e.getAbcdef(i),c=1/(n*a+s*-r),[h,d]=t;return[a*c*h+-s*c*d+(l*s-o*a)*c,n*c*d+-r*c*h+(-l*n+o*r)*c]},e.scale=function(t,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i,[r,s,a,o,l,c]=e.getAbcdef(t);return e.setAbcdef(t,r*i,s*n,a*i,o*n,l*i,c*n),t},e.rotate=function(t,i){let n=Math.cos(i),r=Math.sin(i),[s,a,o,l,c,h]=e.getAbcdef(t);return e.setAbcdef(t,s*n-a*r,s*r+a*n,o*n-l*r,o*r+l*n,c*n-h*r,c*r+h*n),t},e.rotateAround=function(t,i,n){let[r,s]=n,a=e.translate(t,-r,-s);return a=e.rotate(a,i),a=e.translate(a,r,s),a},e.translate=function(t,i,n){let[r,s,a,o,l,c]=e.getAbcdef(t);return e.setAbcdef(t,r,s,a,o,l+i,c+n),t},e.setTranslate=function(t,i,n){let[r,s,a,o]=e.getAbcdef(t);return e.setAbcdef(t,r,s,a,o,i,n),t},e.setPosition=function(t,i,n){let[r,s,a,o]=e.getAbcdef(t);return e.setAbcdef(t,r,s,a,o,i,n),t},e.getScale=function(t){let[i,n,r,s]=e.getAbcdef(t);return[Math.sqrt(i*i+n*n),Math.sqrt(r*r+s*s)]},e.getPosition=function(t){let[,,,,i,n]=e.getAbcdef(t);return[i,n]},e.getRotation=function(t,i){return e.decompose(t,i).rotation},e.decompose=function(t,i){let[n,r,s,a,o,l]=e.getAbcdef(t),{rotation:c,scale:h,shear:d}=_O([[n,s],[r,a]]);return{position:[o+(i[0]*n+i[1]*s)-i[0],l+(i[0]*r+i[1]*a)-i[1]],scale:h,rotation:c,shear:d,pivot:i}},e.compose=function(t,i,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],[a,o]=t,[l,c]=r,[h,d,u,p]=function(e){let{rotation:t,scale:i,shear:n}=e,r=Math.cos(t),s=Math.sin(t),a=wO([[r,-s],[s,r]],[[i[0],n[0]*i[1]],[n[1]*i[0],i[1]]]);return[a[0][0],a[1][0],a[0][1],a[1][1]]}({rotation:n,scale:i,shear:s}),f=a-(l*h+c*u)+l,m=o-(l*d+c*p)+c;return e.create(h,d,u,p,f,m)}})(gO||(gO={}));var EO=Math.PI/180;Math.PI;var CO=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=gO.identity(),this.worldMatrix=gO.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new NO,this._recursiveBBox=new NO,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=KC(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=gO.append(t.worldMatrix,i)),gO.applyInverse(e,i)}intersects(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),n)}intersectsInLocalSpace(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{min:n,max:r}=i?this.recursiveBBox:this.singleBBox;return e>=n[0]&&e<=r[0]&&t>=n[1]&&t<=r[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=gO.compose(this.position,this.scale,function(e){return e*EO}(this.rotation),Ew.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let n=this.parent;t&&null!==n&&void 0!==n&&n.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=gO.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=gO.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return Ew.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((e=>{e.resetBBoxNeedsUpdateSelf()}))}updateTransformState(e){let t=!1;void 0!==e.position&&(t=!0,this.position=e.position),void 0!==e.rotation&&(t=!0,this.rotation=e.rotation),void 0!==e.scale&&(t=!0,this.scale=e.scale),void 0!==e.shear&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){0===e.type&&void 0!==e.props.visible&&(this.visible=e.props.visible),this.data=t,this.data=t;let n=e,r=iy(e.path,["states","*"]);if(null!==r){if(0===e.type){let[t]=r;if(this?.stateSelection===t){let t={...e.props};if(delete t.name,Object.values(e.props).some((e=>void 0===e))){let i=this.data;if(void 0!==i){let n=Kv.zoom(i,e.path.slice(2));if(n)for(let i in e.props)void 0===e.props[i]&&i in n&&(t[i]=n[i])}}n={...e,props:t,path:e.path.slice(2)}}}}else if(0===e.type){let t=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==t){if(void 0!==e.props.name&&t.name){let{name:e,...i}=t;t=i}let i=Kv.removeOverridden(e.path,e.props,t);n={...e,props:i}}}this.updateByPatchedOpBase(n,fw.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this.data.states.length||i){for(let e of this.data.states)fw.toOps(this.data,e.data).forEach((e=>{let i=Cv.replaceProps(e,this.data);this.dataPatched=this.data,this.updateByPatchedOp(i,this.data,t)}));if(null!==e){let i=this.data.states.data(e);i&&(this.dataPatched=fw.patch(this.data,i),fw.toOps(this.data,i).forEach((e=>{this.updateByPatchedOp(e,this.dataPatched,t)})))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){void 0!==e.name&&(this.name=e.name),void 0!==e.visible&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){0===e.path.length&&0===e.type&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors((t=>{"frame2d"===t.data.type&&e(t)}))}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors((e=>{e.requestRender()}))}clone(e){let t=new CO(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,{...e,target:e.target??this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof CO&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},MO=class extends CO{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof MO&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(!0!==t)for(let i of this.children)i instanceof MO?i.traverse(e):t=e(i)}intersectsChildrenHelper(e,t,i,n,r){for(let s of this.children)if(s.intersects(e,t,i,!1)&&(r.push(s),n)||s instanceof MO&&s.intersectsChildrenHelper(e,t,i,n,r))return!0;return!1}intersectsChildren(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.intersectsChildrenHelper(e,t,i,n,r),r}intersectsChildrenHelperReverse(e,t,i,n,r){for(let s of this.children)if(s instanceof MO&&s.intersectsChildrenHelperReverse(e,t,i,n,r)||s.intersects(e,t,i,!1)&&(r.push(s),n))return!0;return!1}intersectsChildrenReverse(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.intersectsChildrenHelperReverse(e,t,i,n,r),r}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let n of this.children)n.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse((i=>{i.uuid===e&&(t=i)})),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse((e=>{e.resetBBoxNeedsUpdateSelf()}))}clone(e){let t=new MO(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},TO=class extends MO{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new TO(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function IO(e,t){let[[i,n],[r,s]]=e,[[a,o],[l,c]]=t,h=(i-r)*(o-c)-(n-s)*(a-l);if(0===h)return!1;let d=((i-a)*(o-c)-(n-o)*(a-l))/h,u=-((i-r)*(n-o)-(n-s)*(i-a))/h;return d>=0&&d<=1&&u>=0&&u<=1}var PO,DO,RO,BO,LO=[[-1,1],[-1,-1],[1,-1],[1,1]],OO=(e,t,i)=>{let n=e.getCenter(),r=e.getHalfSize(),s=gO.append(t,e.worldMatrix);0===r[0]&&0===r[1]?i.push(gO.apply(n,s)):LO.forEach((e=>{let t=[e[0]*r[0]+n[0],e[1]*r[1]+n[1]];i.push(gO.apply(t,s))}))},NO=class{constructor(){this.matrix=gO.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(),this.makeEmpty(),gO.copy(e.worldMatrix,this.matrix);let i=gO.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t){let i=[];!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2])&&e instanceof MO?e.traverse((e=>{e.visible&&OO(e,t,i)})):OO(e,t,i),this.setFromPoints(i)}setFromSize(e,t,i){this.makeEmpty(),gO.copy(i,this.matrix),this.expandBySize(e,t,i)}expandBySize(e,t,i){[gO.apply([0,0],i),gO.apply([0,t],i),gO.apply([e,t],i),gO.apply([e,0],i)].forEach((e=>this.expandByPoint(e)))}getCenter(){let[e,t]=this.min,[i,n]=this.getHalfSize();return gO.apply([e+i,t+n],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[.5*(this.max[0]-this.min[0]),.5*(this.max[1]-this.min[1])]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[n,r,s,a]=gO.getAbcdef(this.matrix),o=gO.create(n,r,s,a,i[0],i[1]);this.vertices=LO.map((i=>{let[n,r]=i;return gO.apply([n*e,r*t],o)}))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=gO.append(t.worldMatrix,i)),gO.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:n}=this;return e>=i[0]&&e<=n[0]&&t>=i[1]&&t<=n[1]}containsPoint(e){let[t,i]=e,[n,r]=this.min,[s,a]=this.max;return t>=n&&t<=s&&i>=r&&i<=a}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let i=this.edges[t];for(let t=0,n=e.edges.length;t<n;t++){if(IO(i,e.edges[t]))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let i=e.vertices[t];if(this.containsPoint(i))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],gO.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new NO;return e.copy(this),e}},kO=new Promise((e=>{PO=e})),FO=!1;function UO(){if(!FO)return DO||(DO=async function(){let e=await i.e(160).then(i.bind(i,1160));PO(e.default??e),FO=!0}(),DO)}function zO(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{("Mesh"===i.type&&"UIGeometry"===i.geometry.type||"Page"===i.type&&void 0!==i.uiFrame)&&(t=!0)})),t}var jO=gO.identity(),VO=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=hA.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=hA.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=jO,this._currentTransform=new Float32Array(jO)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}async init(){if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await async function(e){let t=await kO;RO||(BO||(BO=t({locateFile:()=>e})),RO=await BO)}(this.wasmURL),this._surface=RO.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas(),this._paint=new RO.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(RO.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(RO.PaintStyle.Stroke),this.ctx?.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let i=await(await fetch(e)).arrayBuffer();this.registerFont(i,t)}registerFont(e,t){if(this._fonts.has(t))return;let i=RO.FontMgr.FromData(e);if(!i)throw new Error("Invalid font data for "+t);this._fonts.set(t,i)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(HO(e),RO.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(HO(e),RO.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth("center"===this._strokeMode?e:2*e)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){this.ctx?.clear(RO.TRANSPARENT)}save(){this.ctx?.save()}restore(){this.ctx?.restore()}beginPath(){this._currentPath?.delete(),this._currentPath=new RO.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=RO.XYWHRect(e,t,i,n);if(0===r&&0===s&&0===o&&0===a)this.ctx?.clipRect(l,RO.ClipOp.Intersect,!0);else{let e=RO.RRectXY(l,r,r);e[4]=e[5]=r,e[6]=e[7]=s,e[8]=e[9]=a,e[10]=e[11]=o,this.ctx?.clipRRect(e,RO.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=gO.invert(this.currentTransform);this.ctx.concat(e);let t=gO.translate(gO.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.ctx&&this._currentPath){let n,r=!1;if(i&&this._hasDropShadow()){let i,n=e.copy();n.setColor(HO(this._dropShadowColor)),this._dropShadowBlur>0&&(i=RO.MaskFilter.MakeBlur(RO.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(this.camera?.scale??1),!1),n.setMaskFilter(i)),this.ctx.save(),this.ctx.clipPath(this._currentPath,RO.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(n),this.ctx.restore(),n.delete(),i?.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,RO.ClipOp.Intersect,!0);let t=RO.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,RO.TileMode.Clamp,null),i=e.copy();i.setImageFilter(t),i.setAlphaf(1);let n=this._currentPath.computeTightBounds();this.ctx.saveLayer(i,n,null,RO.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),i.delete(),t.delete(),r=!0}if(this._layerBlur>0){let i=e.copy();n=RO.MaskFilter.MakeBlur(RO.BlurStyle.Normal,this._layerBlur*this.dpr*(this.camera?.scale??1),!1),i.setMaskFilter(n),t(i),i.delete(),n.delete(),r=!0}if(r||t(e),i&&this._hasInnerShadow()){let e,t=new RO.Paint;t.setAntiAlias(!0),t.setStyle(RO.PaintStyle.Fill),t.setColor(HO(this._innerShadowColor)),this._innerShadowBlur>0&&(e=RO.MaskFilter.MakeBlur(RO.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(this.camera?.scale??1),!1),t.setMaskFilter(e));let i=this._currentPath.computeTightBounds(),[n,r,s,a]=i,o=s-n,l=a-r;this.ctx.save(),this.ctx.clipPath(this._currentPath,RO.ClipOp.Intersect,!0),this.ctx.saveLayer(t,i,null,RO.SaveLayerInitWithPrevious),this.ctx?.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(RO.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+o+Math.abs(2*this._innerShadowOffsetX),2e3+l+Math.abs(2*this._innerShadowOffsetY)),t),t.setBlendMode(RO.BlendMode.Clear),this.ctx.drawPath(this._currentPath,t),this.ctx.restore(),this.ctx.restore(),t.delete(),e?.delete()}}}_paintInner(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.ctx&&this._currentPath&&e){let i=this.ctx,n=this._currentPath;this._applyEffectsToPaint(e,(e=>{let r=!1;!t&&"center"!==this._strokeMode&&(i.save(),i.clipPath(n,"outside"===this._strokeMode?RO.ClipOp.Difference:RO.ClipOp.Intersect,!0),r=!0),i.drawPath(n,e),r&&i.restore()}),t)}}_hasDropShadow(){return this._dropShadowColor?.a>0}_hasInnerShadow(){return this._innerShadowColor?.a>0}path(e){this._currentPath?.addPath(RO.Path.MakeFromSVGString(e))}ellipse(e,t,i,n,r,s,a,o){if(!GO([e,t,i,n])||!this._currentPath)return;if(i<0||n<0)throw Error("radii cannot be negative");let l=RO.XYWHRect(e-i,t-n,2*i,2*n);this._currentPath?.addOval(l)}rect(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=RO.XYWHRect(e,t,i,n);if(GO(l))if(0===r&&0===s&&0===o&&0===a)this._currentPath?.addRect(l);else{let e=RO.RRectXY(l,r,r);e[4]=e[5]=r,e[6]=e[7]=s,e[8]=e[9]=a,e[10]=e[11]=o,this._currentPath?.addRRect(e)}}getHorizontalAlign(e){switch(e){case 2:return RO.TextAlign.Right;case 3:return RO.TextAlign.Center;case 4:return RO.TextAlign.Justify;default:return RO.TextAlign.Left}}drawTextInner(e,t,i,n,r,s){let[a,o,l,c]=n,h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],d=0,{ctx:u}=this;if(!u)return d;let p=s.copy(),f=s.copy();return f.setAlphaf(0),this._applyEffectsToPaint(p,(n=>{t.pushPaintStyle(i,n,f),t.addText(e);let s=t.build();s.layout(l);let h=o;2===r?h+=(c-s.getHeight())/2:3===r&&(h+=c-s.getHeight()),u.drawParagraph(s,a,h),d=s.getHeight(),t.reset(),s.delete()}),h),p.delete(),f.delete(),d}drawText(e,t){let i=0,n=this._fonts.get(t.font),{ctx:r,_paintFill:s,_paintStroke:a}=this;if(n&&r){let r=new RO.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),o=new RO.ParagraphStyle({textStyle:r,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),l=RO.XYWHRect(t.x,t.y,t.width,t.height),c=RO.ParagraphBuilder.Make(o,n);s&&(i=this.drawTextInner(e,c,r,l,t.verticalAlign,s,!0)),a&&(i=this.drawTextInner(e,c,r,l,t.verticalAlign,a,!1)),c.delete()}return{height:i}}render(){this._surface?.flush()}moveTo(e,t){this._currentPath?.moveTo(e,t)}lineTo(e,t){this._currentPath?.lineTo(e,t)}bezierCurveTo(e,t,i,n,r,s){this._currentPath?.cubicTo(e,t,i,n,r,s)}quadraticCurveTo(e,t,i,n){this._currentPath?.quadTo(e,t,i,n)}setTransform(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),n=gO.invert(i);if(n&&this.ctx.concat(n),this.ctx?.scale(this.dpr,this.dpr),this.camera?.enabled&&(this.ctx?.concat(this.camera.worldMatrix),t)){let e=gO.getScale(this.camera.worldMatrix);this.ctx?.scale(1/e[0],1/e[1])}this.ctx?.concat(e),this.currentTransform=e}transform(e){this.ctx?.concat(e)}setSize(e,t){!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=RO.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas()))}};function GO(e){for(let t=0;t<e.length;t++)if(void 0!==e[t]&&!Number.isFinite(e[t]))return!1;return!0}function HO(e){let{r:t,g:i,b:n,a:r}=e;return RO.Color4f(t,i,n,r)}var WO,QO,qO,XO=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=hA.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){void 0!==e.color&&(this.color=e.color),void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.blurRadius&&(this.blurRadius=e.blurRadius),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.spread&&(this.spread=e.spread)}},YO=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.radius&&(this.radius=e.radius)}},KO=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=hA.transparent,this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.color&&(this.color=e.color)}},JO=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=hA.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.color&&(this.color=e.color),void 0!==e.thickness&&(this.thickness=e.thickness),void 0!==e.mode&&(this.mode=e.mode)}},ZO=class extends CO{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new KO(e+"-fill",t.fill,i),this.stroke=new JO(e+"-stroke",t.stroke,i),this.dropShadow=new XO(e+"-dropShadow",t.dropShadow,i),this.innerShadow=new XO(e+"-innerShadow",t.innerShadow,i),this.backgroundBlur=new YO(e+"-backgroundBlur",t.backgroundBlur,i),this.layerBlur=new YO(e+"-layerBlur",t.layerBlur,i)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:hA.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:hA.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){this.layerBlur.enabled?e.layerBlur=5*this.layerBlur.radius:e.layerBlur=0,this.backgroundBlur.enabled?e.backgroundBlur=5*this.backgroundBlur.radius:e.backgroundBlur=0,this.dropShadow.enabled?(e.dropShadowBlur=5*this.dropShadow.blurRadius,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=hA.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=5*this.innerShadow.blurRadius,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=hA.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),0===e.type&&(iy(e.path,["fill"])?this.fill.update(e.props):iy(e.path,["stroke"])?this.stroke.update(e.props):iy(e.path,["dropShadow"])?this.dropShadow.update(e.props):iy(e.path,["innerShadow"])?this.innerShadow.update(e.props):iy(e.path,["layerBlur"])?this.layerBlur.update(e.props):iy(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),void 0!==e.fill&&this.fill.update(e.fill),void 0!==e.stroke&&this.stroke.update(e.stroke),void 0!==e.dropShadow&&this.dropShadow.update(e.dropShadow),void 0!==e.innerShadow&&this.innerShadow.update(e.innerShadow),void 0!==e.layerBlur&&this.layerBlur.update(e.layerBlur),void 0!==e.backgroundBlur&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new ZO(this.uuid,this.data,e);return t.parent=void 0,t}},$O=class extends ZO{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(.5*this.width,.5*this.height,.5*this.width,.5*this.height,0,0,2*Math.PI)}intersectsInLocalSpace(e,t){return function(e,t,i,n,r,s){let a=e-i,o=t-n;return a*a/(r*r)+o*o/(s*s)<=1}(e,t,.5*this.width,.5*this.height,.5*this.width,.5*this.height)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new $O(this.uuid,this.data,e);return t.parent=void 0,t}},eN=class extends ZO{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(e){void 0!==e.cornerRadius&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new eN(this.uuid,this.data,e);return t.parent=void 0,t}},tN=class extends ZO{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:hA.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:hA.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){this._fontHolder?.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),n=2===t?i.toUpperCase():3===t?i.toLowerCase():i,{height:r}=e.drawText(n,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=r}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,t){let{shared:i}=t;void 0!==e.font&&(this._fontHolder=i.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then((()=>{this.requestRender()})))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new tN(this.uuid,this.data,e);return t.parent=void 0,t}},iN=class extends ZO{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){0===this.curves.length&&this.computeCurves();let e=this.curves.map((e=>WO.extremas(e))),t=[1/0,1/0],i=[-1/0,-1/0];for(let n=0,r=e.length;n<r;n++){let r=e[n];r[0][0]<t[0]&&(t[0]=r[0][0]),r[0][1]<t[1]&&(t[1]=r[0][1]),r[1][0]>i[0]&&(i[0]=r[1][0]),r[1][1]>i[1]&&(i[1]=r[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,n=this.data.points.length;i<n;i++){let e=this.data.points[i].data,t=this.data.points[i-1].data,n={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(n)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,n]=this.getHalfSize();return[e+i,t+n]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[.5*(t[0]-e[0]),.5*(t[1]-e[1])]}innerDraw(e){for(let n=0,r=this.data.points.length;n<r;n++){let t=this.data.points[n].data;if(0===n){let[i,n]=t.position;e.moveTo(i,n)}else{let i=this.data.points[n-1].data,[r,s]=i.controlNext.position,[a,o]=t.controlPrevious.position,[l,c]=t.position,h={start:i.position,cp1:i.controlNext.position,cp2:t.controlPrevious.position,end:t.position};WO.derive(h),e.bezierCurveTo(r,s,a,o,l,c)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[n,r]=i.controlNext.position,[s,a]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(n,r,s,a,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new iN(this.uuid,this.data,e);return t.parent=void 0,t}};(e=>{function t(e,t,i){let n=e-2*t+i;if(0!==n){let r=-Math.sqrt(Math.abs(t*t-e*i)),s=-e+t;return[-(r+s)/n,-(-r+s)/n]}return t!==i&&0===n?[(2*t-i)/(2*(t-i))]:[]}e.derive=function(e){let t=e.start,i=e.cp1,n=e.cp2,r=e.end,s={start:[3*(i[0]-t[0]),3*(i[1]-t[1])],cp:[3*(n[0]-i[0]),3*(n[1]-i[1])],end:[3*(r[0]-n[0]),3*(r[1]-n[1])]};return e.derivative=s,s.derivative=QO.derive(s),s},e.droot=function(i){let n=i.derivative??e.derive(i),r=n.start,s=n.cp,a=n.end;return[t(r[0],s[0],a[0]),t(r[1],s[1],a[1])]},e.extremas=function(t){let[i,n]=e.droot(t),r=[t.start[0],t.end[0]],s=[t.start[1],t.end[1]];for(let a of i)r.push(e.compute(t,Math.min(1,Math.max(0,a)))[0]);for(let a of n)s.push(e.compute(t,Math.min(1,Math.max(0,a)))[1]);return r.sort(((e,t)=>e-t)),s.sort(((e,t)=>e-t)),[[r[0],s[0]],[r[r.length-1],s[s.length-1]]]},e.compute=function(e,t){if(0===t)return[...e.start];if(1===t)return[...e.end];let i=1-t,n=i*i,r=t*t,s=n*i,a=n*t*3,o=i*r*3,l=t*r;return[s*e.start[0]+a*e.cp1[0]+o*e.cp2[0]+l*e.end[0],s*e.start[1]+a*e.cp1[1]+o*e.cp2[1]+l*e.end[1]]}})(WO||(WO={})),(e=>{e.derive=function(e){let t=e.start,i=e.cp,n=e.end,r={start:[2*(i[0]-t[0]),2*(i[1]-t[1])],end:[2*(n[0]-i[0]),2*(n[1]-i[1])]};return r.derivative=qO.derive(r),e.derivative=r,r},e.droot=function(t){let i=t.derivative??e.derive(t),n=i.start,r=i.end;return[n[0]!==r[0]?n[0]/(n[0]-r[0]):0,n[1]!==r[1]?n[1]/(n[1]-r[1]):0]},e.compute=function(e,t){if(0===t)return[...e.start];if(1===t)return[...e.end];let i=1-t,n=i*i,r=i*t*2,s=t*t;return[n*e.start[0]+r*e.cp[0]+s*e.end[0],n*e.start[1]+r*e.cp[1]+s*e.end[1]]}})(QO||(QO={})),(e=>{e.derive=function(e){let t=e.start,i=e.end,n=[i[0]-t[0],i[1]-t[1]];return e.derivative=n,e.derivative},e.compute=function(e,t){if(0===t)return[...e.start];if(1===t)return[...e.end];let i=e.start,n=e.end;return[i[0]+(n[0]-i[0])*t,i[1]+(n[1]-i[1])*t]}})(qO||(qO={}));var nN=class extends MO{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new eN(e+"-background",bw.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){super.updateLocalMatrix(),this.background?.updateLocalMatrix()}updateWorldMatrix(e,t,i){super.updateWorldMatrix(e,t,i),this.background?.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(e){void 0!==e.cornerRadius&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),void 0!==e.fill&&this.fill.update(e.fill),void 0!==e.stroke&&this.stroke.update(e.stroke),void 0!==e.dropShadow&&this.dropShadow.update(e.dropShadow),void 0!==e.innerShadow&&this.innerShadow.update(e.innerShadow),void 0!==e.layerBlur&&this.layerBlur.update(e.layerBlur),void 0!==e.backgroundBlur&&this.backgroundBlur.update(e.backgroundBlur),void 0!==e.clipped&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),0===e.type&&(iy(e.path,["fill"])?this.fill.update(e.props):iy(e.path,["stroke"])?this.stroke.update(e.props):iy(e.path,["dropShadow"])?this.dropShadow.update(e.props):iy(e.path,["innerShadow"])?this.innerShadow.update(e.props):iy(e.path,["layerBlur"])?this.layerBlur.update(e.props):iy(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new nN(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},rN=u(b(),1),sN=class extends ZO{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),void 0!==e.path&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new sN(this.uuid,this.data,e);return t.parent=void 0,t}};var aN=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new TO(aN.GROUP_ID,{...Sw.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,n,r,s){let a=function(e,t,i){switch(t.type){case"ellipse2d":return new $O(e,t,i);case"rectangle2d":return new eN(e,t,i);case"text2d":return new tN(e,t,i);case"vector2d":return new iN(e,t,i);case"path2d":return new sN(e,t,i);case"frame2d":return new nN(e,t,i);default:return new TO(e,t,i)}}(e,t,s);a&&(n.add(a),n.children.splice(r,0,n.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof TO||a instanceof nN)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(e,t,i){let n=0;for(let r of e)this.createObject(r.id,r.data,r.children,t,n,i),n+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,n){let r=this.find(e);if(r)try{r.updateByOp(t,i,{shared:n})}catch(Xb){console.error(Xb)}}updateTreeByOp(e,t){if(0===e.path.length&&7===e.type){let i=null===e.parent?this.group:this.find(e.parent);void 0!==i&&i instanceof MO&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(0===e.path.length&&8===e.type){let t=this.find(e.id);if(void 0!==t&&void 0!==t.parent&&t.parent instanceof MO){let e=t.parent;t.resetBBoxNeedsUpdate(),e?.remove(t),e?.requestRender()}}else if(0===e.path.length&&9===e.type){let t=this.find(e.id);if(void 0!==t){let i=t.parent,n=null===e.parent?this:this.find(e.parent);if(n instanceof MO||n===this){n.add(t);let r=e.localIndex;n.children.splice(r,0,n.children.pop()),t.updateWorldMatrix(!0,!1,!0),i?.requestRender(),t.requestRender()}t.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse((t=>{t!==this.group&&e(t)}))}intersectsChildren(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.group.intersectsChildren(e,t,i,n,r,!0)}intersectsChildrenReverse(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.group.intersectsChildrenReverse(e,t,i,n,r,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(void 0===t)return;let i=[],n=t;for(;n!==this.group;){let e=n;n=n.parent;let t=n.children.indexOf(e);i.splice(0,0,t)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let e=this.getWithSortKey(i.id);void 0!==e&&t.push(e)}return t.sort(((e,t)=>Qg(e.sortKey,t.sortKey))),t.map((e=>e.entity))}},oN=aN;function lN(e){let{constraints:t,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:l}=e,{horizontalConstraint:c,verticalConstraint:h}=t,d=i-r,u=n-s,p=a,f=o,m=l[0],g=l[1];if(0!==c)if(1===c)m+=d;else if(3===c)m+=d/2;else if(2===c)p=Math.max(1,p+d);else if(4===c){let e=i/r;p*=e,m*=e}if(0!==h)if(1===h)g+=u;else if(3===h)g+=u/2;else if(2===h)f=Math.max(1,f+u);else if(4===h){let e=n/s;f*=e,g*=e}return{width:p,height:f,position:[m,g]}}oN.GROUP_ID="scene2d";u(b(),1);var cN=new us(-1,1,1,-1,0,1),hN=new class extends yr{constructor(){super(),this.setAttribute("position",new hr([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new hr([0,2,0,0,2,0],2))}},dN=new Ur({defines:{},uniforms:{tDiffuse:new Sh(null)},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}",fragmentShader:"\n\tuniform sampler2D tDiffuse;\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\tgl_FragColor = texel;\n\t}"}),uN=new class{constructor(e){this._mesh=new Rr(hN,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,cN)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}(dN),pN=null,fN=null,mN=gO.identity(),gN=class{constructor(e,t,i,n){this.uuid=e,this.width=t,this.height=i,this.context=n,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let e=this.width,t=this.height,i=this.dpr;this.renderer.dpr=this.isScreenSpace?i:Math.floor(2048/Math.max(e,t)),this.renderer.setSize(e,t)},this.onFrameOverrideObjectEvent=e=>{if(void 0!==e.target?.uuid){let t=this.frameRoot?.find(e.target.uuid);t&&t.dispatchEvent({...e,target:t})}},this.scene2d=new oN(ui.generateUUID(),Cw.defaultData,{dpr:window.devicePixelRatio,shared:n.shared}),this.canvas=(null===pN&&(pN=document.createElement("canvas")),pN),this.renderer=(e=>(null===fN&&(fN=new VO(e)),fN))(this.canvas),this.promise=this.init(),this.renderTarget=new Fi(1,1,{type:je,stencilBuffer:!1,depthBuffer:!1}),n.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=n.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new cl(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof VO&&(this.renderer.wasmURL=jI.skiaWasmUrl),await this.renderer.init()}render(e){if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),this.frameOverride?.draw(this.renderer),this.renderer.render(),dN.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let t=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.clear(),uN.render(e),e.setRenderTarget(t),this.textureHolder?.setNeedsUpdate(!0)}}updateEntity2DByOp(e,t,i,n){this.scene2d.updateEntityByOp(e,t,i,n),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=e?.width??this.width,i=e?.height??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=mN,this.isScreenSpace&&(this.frameOverride.fill.color=hA.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:t,height:i},vN({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.devicePixelRatio,i=Math.max(1,e?.width??this.width),n=Math.max(1,e?.height??this.height);this.dpr=t,this.width=i,this.height=n,this._innerApplySize();let r=1;(i*t<512||n*t<512)&&(r=Math.max(512/(i*t),512/(n*t))),this.renderTarget.setSize(i*t*r,n*t*r),this._canvasTexture?.dispose(),this._canvasTexture=void 0,this.applyOverrides(e),this.frameOverride?.requestRender()}applyFrame(e){let t=this.context.scene.find2D(e);if(t&&t instanceof nN)return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),this.frame?.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse((e=>{e.addEventListener("beginState",this.onFrameOverrideObjectEvent)})),this.frameOverride.traverse((e=>{e.addEventListener("completeState",this.onFrameOverrideObjectEvent)})),this.frame?.requestRender(),t}get frame(){return this.frameOverride}get frameId(){return this.frame?.uuid}find(e){return this.scene2d.find(e)}get texture(){return this.textureHolder?.getTexture(1001)}disposeFrameOverride(){this.frameOverride?.removeEventListener("render",this.onRenderRequestedDownstream),this.frameOverride?.traverse((e=>{e.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)})),this.frameOverride?.traverse((e=>{e.removeEventListener("completeState",this.onFrameOverrideObjectEvent)})),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function vN(e){let{objectOverride:t,objectRoot:i,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a}=e;if(t instanceof nN&&i instanceof nN||t instanceof TO&&i instanceof TO)for(let o=0,l=t.children.length;o<l;o++){let e=t.children[o],l=i.children[o];e&&l&&e.uuid===l.uuid&&yN({objectOverride:e,objectRoot:l,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a})}}function yN(e){let{objectOverride:t,objectRoot:i,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a}=e,[o,l]=function(e){if(AN(e))return[e.width,e.height];if(e instanceof sN){let[t,i]=e.getHalfSize();return[2*t,2*i]}if(e instanceof TO){let[t,i]=e.recursiveBBox.getHalfSize();return[2*t,2*i]}return[0,0]}(i),{width:c,height:h,position:d}=lN({constraints:t.data,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:o,objectInitialHeight:l,objectInitialPosition:i.position});if(t.position=d,t.data={...t.data,position:d},t.states)for(let u in t.states)bN({stateId:u,objectOverride:t,objectRoot:i,newParentWidth:n,newParentHeight:r,initialParentWidth:s,initialParentHeight:a});if(AN(t)||t instanceof TO)AN(t)&&(t.width=c,t.height=h,t.data={...t.data,width:c,height:h}),vN({objectOverride:t,objectRoot:i,newParentWidth:c,newParentHeight:h,initialParentWidth:o,initialParentHeight:l});else if(t instanceof sN){let e=i,n=0!==o?c/o:1,r=0!==l?h/l:1;t.path=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(t<=0||i<=0)return e;let n=(0,rN.parseSVG)(e).map((e=>{let n={...e};return"x"in n&&(n.x=n.x*t),"y"in n&&(n.y=n.y*i),"x1"in n&&(n.x1=n.x1*t),"x2"in n&&(n.x2=n.x2*t),"y1"in n&&(n.y1=n.y1*i),"y2"in n&&(n.y2=n.y2*i),"rx"in n&&(n.rx=n.rx*t),"ry"in n&&(n.ry=n.ry*i),n}));return function(e){let t,i=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"];return e.map((e=>{let n=[];i.forEach((t=>{if(t in e){let i=1*e[t];n.length&&i>=0&&n.push(","),n.push(i)}}));let r=(t===e.code?n[0]<0?"":",":e.code)+n.join("");return t=e.code,r})).join("")}(n)}(e.path,n,r),t.data={...t.data,path:t.path}}}function bN(e){let{stateId:t,objectOverride:i,objectRoot:n,newParentWidth:r,newParentHeight:s,initialParentWidth:a,initialParentHeight:o}=e,l=i.states?.[t],c=n.states?.[t];if(l&&c){let{width:e,height:n,position:h}=lN({constraints:i.data,newParentWidth:r,newParentHeight:s,initialParentWidth:a,initialParentHeight:o,objectInitialWidth:Ew.isResizeable(c)?c.width:0,objectInitialHeight:Ew.isResizeable(c)?c.height:0,objectInitialPosition:c.position});Object.assign(i.states[t],{position:h}),Ew.isResizeable(l)&&Object.assign(i.states[t],{width:e,height:n})}}function AN(e){return e instanceof eN||e instanceof nN||e instanceof $O||e instanceof tN}var xN=class extends(L_(No)){constructor(e,t,i){super(),this.data=t,this.bgColor=new fT(1,1,1,1),this.fog=null,this.backupFog=new Oo(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new Pi,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new YR(xA,{...yx.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new Hc(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new oN((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){return this.uiCanvas?.frame}createUICanvas(e,t){this.uiCanvas=new gN(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then((()=>{this.uiCanvas?.applyFrame(e),this.uiCanvas?.applySize()}))}updateVisible(){}setBackgroundColor(e){this.bgColor=e,!0===this.fogUseBGColor&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){void 0!==e.color&&(this.ambientLight.color=EP(e.color,t)),void 0!==e.intensity&&(this.ambientLight.intensity=e.intensity),void 0!==e.enabled&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity((e=>{e instanceof eB&&e.recomputeBoolean()})),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity((e=>{if(e instanceof OD)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()}))}updateShadow(e){void 0!==e.softShadowQuality&&this.isActive&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"medium";if(iO===e)return!1;iO=e;let t=(e=>{switch(e){case"low":return 8;case"medium":default:return 16;case"high":return 32}})(e);is.shadowmap_pars_fragment=(e=>`\n\n// PCSS implementation based on:\n// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/\n// NOTE: This number affects how big the shadow blur can\n// possibly get. Bigger number == bigger blur, but less precise results\n\nconst float  gPenumbraFilterSize = 80.0;\nconst int   gPenumbraSamples = ${e};\nconst int gShadowSamples = ${e};\nconst float gShadowSamplesRpc = 1.0f / float(gShadowSamples);\n\n#ifdef USE_SHADOWMAP\n    #if NUM_DIR_LIGHT_SHADOWS > 0\n\n        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n        struct DirectionalLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_SPOT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n        struct SpotLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_POINT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n        struct PointLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n            float shadowCameraNear;\n            float shadowCameraFar;\n        };\n\n        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n    #endif\n\n    /*\n    #if NUM_RECT_AREA_LIGHTS > 0\n\n        // TODO (abelnation): create uniforms for area light shadows\n\n    #endif\n    */\n\nfloat computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)\n{\n    float penumbra = 1.0;\n    float blockerDepthAvg = 0.0;\n    float blockerCount = 0.0;\n\n    #pragma unroll_loop_start\n    for(int i = 0; i < gPenumbraSamples; i ++)\n    {\n        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;\n        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );\n\n        if(depth < compare + 0.0001)\n        {\n            blockerDepthAvg += depth;\n            blockerCount++;\n        }\n    }\n    #pragma unroll_loop_end\n\n    if (blockerCount > 0.0)\n    {\n        blockerDepthAvg /= blockerCount;\n\n        // Compute penumbra\n        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);\n        penumbra *= penumbra;\n        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows\n\n        return clamp(penumbra, 0.00, 1.0);\n    }\n    return 0.0;\n}\n\nfloat vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)\n{\n    float shadow         = 0.0f;\n\n    // NOTE: When using TAA, we should use screen space interleaved gradient noise\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);\n    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);\n    if (penumbra == -1.0) {\n        return 1.0;\n    }\n\n    #pragma unroll_loop_start\n    for (int i = 0; i < gShadowSamples; i++)\n    {\n        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n        // Overall blurring offset\n        vec2 offset = vogelSample * (shadowRadius * 2.);\n\n        // Penumbra offset\n        offset += vogelSample * (penumbra * texelScalar);\n\n        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    }\n    #pragma unroll_loop_end\n\n    return shadow * gShadowSamplesRpc;\n}\n\n\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n    }\n\n    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n        return unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n    }\n\n    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n        float occlusion = 1.0;\n\n        vec2 distribution = texture2DDistribution( shadow, uv );\n\n        float hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n        if (hard_shadow != 1.0 ) {\n\n            float distance = compare - distribution.x ;\n            float variance = max( 0.00000, distribution.y * distribution.y );\n            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n        }\n        return occlusion;\n\n    }\n\n    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n        float shadow = 1.0;\n\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += shadowBias;\n\n        // if ( something && something ) breaks ATI OpenGL shader compiler\n        // if ( all( something, something ) ) using this instead\n\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n        bool frustumTest = all( frustumTestVec );\n\n        if ( frustumTest ) {\n\n        #if defined( SHADOWMAP_TYPE_PCF )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            float dx = texelSize.x;\n            float dy = texelSize.y;\n\n            vec2 uv = shadowCoord.xy;\n            vec2 f = fract( uv * shadowMapSize + 0.5 );\n            uv -= f * texelSize;\n\n            shadow = (\n                texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n                          f.x ),\n                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n                          f.x ),\n                     f.y )\n            ) * ( 1.0 / 9.0 );\n\n        #elif defined( SHADOWMAP_TYPE_VSM )\n\n            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #else // no percentage-closer filtering:\n\n            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #endif\n\n        }\n\n        return shadow;\n\n    }\n\n    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n    // vector suitable for 2D texture mapping. This code uses the following layout for the\n    // 2D texture:\n    //\n    // xzXZ\n    //  y Y\n    //\n    // Y - Positive y direction\n    // y - Negative y direction\n    // X - Positive x direction\n    // x - Negative x direction\n    // Z - Positive z direction\n    // z - Negative z direction\n    //\n    // Source and test bed:\n    // https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n    vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n        // Number of texels to avoid at the edge of each square\n\n        vec3 absV = abs( v );\n\n        // Intersect unit cube\n\n        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n        absV *= scaleToCube;\n\n        // Apply scale to avoid seams\n\n        // two texels less per square (one texel will do for NEAREST)\n        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n        // Unwrap\n\n        // space: -1 ... 1 range for each square\n        //\n        // #X##         dim    := ( 4 , 2 )\n        //  # #         center := ( 1 , 1 )\n\n        vec2 planar = v.xy;\n\n        float almostATexel = 1.5 * texelSizeY;\n        float almostOne = 1.0 - almostATexel;\n\n        if ( absV.z >= almostOne ) {\n\n            if ( v.z > 0.0 )\n                planar.x = 4.0 - v.x;\n\n        } else if ( absV.x >= almostOne ) {\n\n            float signX = sign( v.x );\n            planar.x = v.z * signX + 2.0 * signX;\n\n        } else if ( absV.y >= almostOne ) {\n\n            float signY = sign( v.y );\n            planar.x = v.x + 2.0 * signY + 2.0;\n            planar.y = v.z * signY - 2.0;\n\n        }\n\n        // Transform to UV space\n\n        // scale := 0.5 / dim\n        // translate := ( center + 0.5 ) / dim\n        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n    }\n\n    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n        float shadow = 1.0;\n        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n        // for point lights, the uniform @vShadowCoord is re-purposed to hold\n        // the vector from the light to the world-space position of the fragment.\n        vec3 lightToPosition = shadowCoord.xyz;\n\n        // dp = normalized distance from light to fragment position\n        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n        compare += shadowBias;\n\n        // bd3D = base direction 3D\n        vec3 bd3D = normalize( lightToPosition );\n\n        vec2 halton = haltonSequence[frameIndex];\n        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n        float temporalAngle  = temporalOffset * PI2;\n\n        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )\n            for (int i = 0; i < gShadowSamples; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                // NOTE: Removed for now\n                // Penumbra offset\n                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * gShadowSamplesRpc;\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n            for (int i = 0; i < 16; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * (1.0 / 16.0);\n        #else // no percentage-closer filtering\n\n            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );\n\n        #endif\n\n    }\n\n#endif\n`)(t);let i=eO.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),is.lights_fragment_begin=i;let n=tO.slice();return n=n.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),is.shadowmask_pars_fragment=n,!0}(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){this.scene.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=EP(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){void 0!==e.aoColor&&(this.aoColor=EP(e.aoColor,t))}updateByOp(e,t,i,n){let r=this.data.uiFrame;super.updateByOp(e,t,i,n);let s=t;iy(e.path,["fog"])?this.updateFog(s.fog,i.shared):iy(e.path,["ao"])?this.updateAo(s.ao,i.shared):iy(e.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):iy(e.path,["shadow"])?this.updateShadow(s.shadow):0===e.type&&0===e.path.length&&(void 0!==e.props.uiFrame||r!==s.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),void 0!==e.backgroundColor&&this.setBackgroundColor(EP(e.backgroundColor,t.shared)),void 0!==e.fog&&this.updateFog(e.fog,t.shared),void 0!==e.ambient&&this.updateAmbientLight(e.ambient,t.shared),void 0!==e.ao&&this.updateAo(e.ao,t.shared),void 0!==e.shadow&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){return this.scene?.find(this.data.publish.playCamera)??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return null===this.penumbraSizeArrayCache&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity((i=>{if(!i.visible)return!0;i instanceof vO&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize??.5,e+=1),i instanceof xO&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize??.5,t+=1)}))}raycastWithClones(e){let t=[],i=n=>{for(let r of n.children){let n=r.cloner;d_.is(r)&&(r.visible||n?.object.data.visible)&&((iB(r)||rB(r)&&this.scene.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),mk(r,e,t,!0)),i(r))}};return i(this),t}updateEntity2DByOp(e,t,i,n){this.uiCanvas?.updateEntity2DByOp(e,t,i,n)}},wN=class extends(tB(th,lO)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=90,n.aspect=1,n.near=100,n.far=2500;let r=new Vi(-n.far+this.position.x,-n.far+this.position.y,-n.far+this.position.z),s=new Vi(n.far+this.position.x,n.far+this.position.y,n.far+this.position.z),a=new Wi(r,s),o=new Hh(a,new Pi(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof Hh){let e=this.shadow.camera,i=new Vi(-e.far+this.position.x,-e.far+this.position.y,-e.far+this.position.z),n=new Vi(e.far+this.position.x,e.far+this.position.y,e.far+this.position.z);t.box.set(i,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},SN=class extends jD{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?iT(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},_N=class extends jD{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape(),this.refreshAttachedCloners(t)}updateShape(){let e,t={...this.data.geometry.extrusion.shape};for(let n in t)"string"==typeof t[n]&&(t[n]=this._context.shared.getVariable(t[n],[this.uuid,"geometry","extrusion","shape",n]));if("Custom"===t.type){let i=t.shapeId;if(i!==this._shapeId&&this.detachShape(),i){this._shapeId=i;let t=this._context.scene.find(i);t?.data&&(t.attachedPaths.add(this),e=t.geometry.userData?.shape),e||this._context.scene.addPendingCommand((()=>this.updateShape()))}}else{let i;switch(t.type){case"Rectangle":i=VC;break;case"Ellipse":i=oC;break;case"Polygon":i=kC;break;case"Star":i=HC;break;default:throw new Error(`Unknown shape type: ${t.type}`)}e=i.create({parameters:t}).userData.shape}let i=this.geometry;e&&i.inputs&&(i.inputs.shapeData=e,i.build())}detachShape(){null!==this._shapeId&&this._context.scene.find(this._shapeId)?.attachedPaths.delete(this)}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?iT(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},EN=class extends vR{constructor(e,t,i){super(e,t,i),this.data=t}},CN=class extends(VR(Mo,cB)){constructor(e,t,i){super(),"Instance"===t.type&&"string"==typeof e&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return"Component"===this.data.type&&"string"==typeof this.identity}get isInstanceRoot(){return"Instance"===this.data.type&&"string"==typeof this.identity}transformAssignData(e,t){let i=ow.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let t,n;for(let r of xx.rootOverrideProps)void 0===e[r]?(void 0===t&&(t={...e}),t[r]=i.data[r]):(void 0===n&&(n={}),n[r]=e[r],void 0===t&&(t={...e}),t[r]=_v.apply(i.data[r],e[r]));return this.overrideData=n,t}return{...ux.defaultData,...e,...Lg(ux.defaultData,xx.rootOverrideProps)}}updateByOp(e,t,i,n){let r;if(this.isInstanceRoot&&!n)if(t=this.transformAssignData(t,i),0===e.type&&0===e.path.length&&this.component)for(let s of xx.rootOverrideProps)s in e.props&&void 0===e.props[s]&&(void 0===r&&(r={...e,props:{...e.props}}),r.props[s]=this.component.data[s]);else if(0===e.type&&e.path.length>0&&xx.rootOverrideProps.includes(e.path[0])){let i=e.path[0];void 0===r&&(r={...e,path:[],props:{[i]:t[i]}})}super.updateByOp(r??e,t,i,n)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(void 0===this.component){let i=e.scene.find(t.component)??null,n=!1;if(i!==this.oldComponent){if(this.oldComponent){let t=0;for(let i of this.children){if(!d_.is(i))break;e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(i),MN(i),t+=1}this.children.splice(0,t)}n=!0}if(i){let r={};IN(e,[this.uuid],t.overrides,this,i,i,0,n,r);for(let t of this.children)if(d_.is(t)){let i=t.data;"Empty"===i.type&&i.animations&&t.traverseEntity((t=>{let i=t.dataPatched;if(t instanceof jD&&i.bones&&i.boneInverses){let i=t.dataPatched;if(i.bones&&i.boneInverses){let n=i.bones.map((t=>e.scene.find(r[t]))),s=i.boneInverses.map((e=>(new bn).fromArray(e))),a=new Ho(n,s);t.bind(a,t.bindMatrix)}}else t.matrixAutoUpdate=!0}))}}this.oldComponent=this.component}}};function MN(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)d_.is(i)&&MN(i)}}function TN(e,t,i,n){return e.component===t&&Sg(e.identity,n)?e.overrideData===i?2:1:0}function IN(e,t,i,n,r,s,a,o,l){if(a>50)return!1;if(n.component!==r){if(n.component){let e=n.component.instances.indexOf(n);e>=0&&n.component.instances.splice(e,1)}r.instances.find((e=>e===n))||r.instances.push(n),n.component=r}r instanceof CN&&r.isInstanceRoot&&r.expandInstanceChildren(e);let c=0;for(let h of r.children)if(d_.is(h)){let r=[...t,..."string"==typeof h.identity?[h.identity]:h.identity],d=Ax.resolve(i,r,1);null==d||d instanceof Iv||(Object.setPrototypeOf(d,Iv.prototype),console.error("wrong prototype"));let u,p=null;if(!o){let t=n.children[c];if(p=d_.is(t)?t:null,null!==p){let e=TN(p,h,d,r);u=e>=1?p.stateSelection:void 0,2!==e&&(p=null)}if(null===p&&(p=e.scene.findInstance(r)??null,null!==p)){let t=TN(p,h,d,r);if(u=t>=1?p.stateSelection:void 0,2!==t)p=null;else{let t=p.parent.children.indexOf(p);p.parent.children.splice(t,1),n.children.splice(c,0,p),p.parent===n?t<=c&&console.error("not possible"):(p.parent=n,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),e.pendingDeletes.delete(p))}}}if(null===p){let t=d?_v.apply(h.data,d):h.data;vA.is(t.type)&&(t={...t,type:"Empty"}),p=S_.createEntity(r,t,e),p.overrideData=d,n.add(p),n.children.splice(n.children.length-1,1),n.children.splice(c,0,p),p.updateState(p.data,e),u&&p.changeSelectedState(u,e),e.scene.registerInstanceAndSetUuid(p)}if(p.isBone){l[p.identity[p.identity.length-1]]=p.uuid}c+=1,IN(e,t,i,p,h,s,a+1,o,l)}if(!o){let t=c;for(;;){let t=n.children[c];if(!d_.is(t))break;e.pendingDeletes.add(t),c+=1}n.children.splice(t,c-t)}return!0}var PN=class extends(VR(zo,cB)){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},DN=class extends jD{constructor(e,t,i){super(e,t,i),this.onBeforeRender=e=>{this.uiCanvas.render(e)},this.uiCanvas=new gN(e+"-canvas",t.geometry.width,t.geometry.height,i),this.uiCanvas.promise.then((()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)}))}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),0===e.type&&(void 0!==e.props.frame&&this.applyFrame(e.props.frame,i.shared),(void 0!==e.props.width||void 0!==e.props.height)&&this.applySize(e.props,i.shared))}applySize(e,t){let i=e?.width??this.dataPatched.geometry.width,n=e?.height??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:n}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){let t=this.frame;t&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),this.localGeometry?.dispose(),this.localGeometry=bM(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let i=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,i,n){this.uiCanvas.updateEntity2DByOp(e,t,i,n),e===this.frameId&&0===t.type&&(void 0!==t.props.cornerRadius?this.applyGeometryParametersFromFrame(n):iy(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:n}))}get frame(){return this.uiCanvas.frame}get frameId(){return this.frame?.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t)}},RN=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let n=ze,r=new No,s=new zr;s.position.z=1;let a={passThruTexture:{value:null}},o=h("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",a),l=new Rr(new ts(2,2),o);function c(i){i.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function h(e,t){let i=new Ur({uniforms:t=t||{},vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return c(i),i}r.add(l),this.setDataType=function(e){return n=e,this},this.addVariable=function(e,t,i){let n={name:e,initialValueTexture:i,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:Te,magFilter:Te};return this.variables.push(n),n},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!1===i.capabilities.isWebGL2&&!1===i.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===i.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let i=0;i<this.variables.length;i++){let n=this.variables[i];n.renderTargets[0]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),n.renderTargets[1]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),this.renderTexture(n.initialValueTexture,n.renderTargets[0]),this.renderTexture(n.initialValueTexture,n.renderTargets[1]);let r=n.material,s=r.uniforms;if(null!==n.dependencies)for(let e=0;e<n.dependencies.length;e++){let t=n.dependencies[e];if(t.name!==n.name){let e=!1;for(let i=0;i<this.variables.length;i++)if(t.name===this.variables[i].name){e=!0;break}if(!e)return"Variable dependency not found. Variable="+n.name+", dependency="+t.name}s[t.name]={value:null},r.fragmentShader="\nuniform sampler2D "+t.name+";\n"+r.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0;for(let i=0,n=this.variables.length;i<n;i++){let n=this.variables[i];if(null!==n.dependencies){let t=n.material.uniforms;for(let i=0,r=n.dependencies.length;i<r;i++){let r=n.dependencies[i];t[r.name].value=r.renderTargets[e].texture}}this.doRenderTarget(n.material,n.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let e=this.variables;for(let t=0;t<e.length;t++){let i=e[t];i.initialValueTexture&&i.initialValueTexture.dispose();let n=i.renderTargets;for(let e=0;e<n.length;e++)n[e].dispose()}},this.addResolutionDefine=c,this.createShaderMaterial=h,this.createRenderTarget=function(i,r,s,a,o,l){return new Fi(i=i||e,r=r||t,{wrapS:s=s||Ce,wrapT:a=a||Ce,minFilter:o=o||Te,magFilter:l=l||Te,format:Qe,type:n,depthBuffer:!1})},this.createTexture=function(){let i=new Float32Array(e*t*4),n=new jo(i,e,t,Qe,ze);return n.needsUpdate=!0,n},this.renderTexture=function(e,t){a.passThruTexture.value=e,this.doRenderTarget(o,t),a.passThruTexture.value=null},this.doRenderTarget=function(e,t){let n=i.getRenderTarget(),a=i.xr.enabled,c=i.shadowMap.autoUpdate,h=i.outputEncoding,d=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=zt,i.toneMapping=fe,l.material=e,i.setRenderTarget(t),i.render(r,s),l.material=o,i.xr.enabled=a,i.shadowMap.autoUpdate=c,i.outputEncoding=h,i.toneMapping=d,i.setRenderTarget(n)}}},BN=new tr,LN=new Vi,ON=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let n=1;t&&(n=t.getX(r)+t.getX(r+1)+t.getX(r+2)),BN.a.fromBufferAttribute(e,r),BN.b.fromBufferAttribute(e,r+1),BN.c.fromBufferAttribute(e,r+2),n*=BN.getArea(),i[r/3]=n}this.distribution=new Float32Array(e.count/3);let n=0;for(let r=0;r<i.length;r++)n+=i[r],this.distribution[r]=n;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let n=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*n);return this.sampleFace(r,e,t,i)}binarySearch(e){let t=this.distribution,i=0,n=t.length-1,r=-1;for(;i<=n;){let s=Math.ceil((i+n)/2);if(0===s||t[s-1]<=e&&t[s]>e){r=s;break}e<t[s]?n=s-1:i=s+1}return r}sampleFace(e,t,i,n){let r=this.randomFunction(),s=this.randomFunction();return r+s>1&&(r=1-r,s=1-s),BN.a.fromBufferAttribute(this.positionAttribute,3*e),BN.b.fromBufferAttribute(this.positionAttribute,3*e+1),BN.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(BN.a,r).addScaledVector(BN.b,s).addScaledVector(BN.c,1-(r+s)),void 0!==i&&BN.getNormal(i),void 0!==n&&void 0!==this.colorAttribute&&(BN.a.fromBufferAttribute(this.colorAttribute,3*e),BN.b.fromBufferAttribute(this.colorAttribute,3*e+1),BN.c.fromBufferAttribute(this.colorAttribute,3*e+2),LN.set(0,0,0).addScaledVector(BN.a,r).addScaledVector(BN.b,s).addScaledVector(BN.c,1-(r+s)),n.r=LN.x,n.g=LN.y,n.b=LN.z),this}};function NN(e,t){let i=e,n=new Float32Array(4*t*t);for(let s=0;s<t*t;s++)n[4*s]=i[3*s],n[4*s+1]=i[3*s+1],n[4*s+2]=i[3*s+2],n[4*s+3]=0;let r=new jo(n,t,t,Qe,ze);return r.needsUpdate=!0,r}var kN="\n\n  // Linear Fade In\n  float linearFadeIn(float t) {\n    return t;\n  }\n\n\n  // linear fade out\n  float linearFadeOut(float t) {\n    return 1.0 - t;\n  }\n  \n  float linearInOut(float t) {\n    return t < 0.5 ? t :  (1.0 - t);  \n  }\n\n    // lerp\n    float lerp(float a, float b, float t) {\n      return a + (b - a) * t;\n    }\n\n  // Ease In Out Quart\n  float exponentialInOut(float t) {\n    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :\n    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :\n    1.0;\n   }\n\n  // constant\n  float constant(float t) {\n    return 1.0;\n  } \n",FN=`\n  uniform sampler2D uPosition;\n  uniform float uSize;\n  uniform float uSizeEnd;\n  uniform vec3 uWorldOffset;\n  uniform vec4 uWorldQuaternion;\n  // Billboard Behavior - Currently at Zero, but we can change that\n  uniform float uRotation;\n  uniform float uRotationEnd;\n  uniform vec2 center;\n\n  // Randomness\n  uniform float uRandScaleFactor;\n  uniform float uRandRotationFactor;\n\n  attribute vec2 ref;\n\n  varying float v_LifeLeft;    // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  \n\nfloat rand(vec3 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n    \n  return acceleration;\n}\n\n  ${kN}\n`,UN="\n  uniform vec4 uColor;                // start color\n  uniform vec4 uColor2;               // end color\n  uniform sampler2D uTexture;         // texture\n  varying float v_LifeLeft;   // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  float random(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n  }\n  "+kN+"  \n  \nvec3 rgb2xyz (in vec3 rgb) {\n    float r = rgb.r;\n\tfloat g = rgb.g;\n\tfloat b = rgb.b;\n\n\tr = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);\n\tg = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);\n\tb = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);\n\n\tfloat x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);\n\tfloat y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);\n\tfloat z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);\n    \n    vec3 xyz = vec3(\n        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,\n        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,\n        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0\n    );\n    return(xyz);\n}\n\nvec3 xyz2lab (in vec3 xyz) {\n\tfloat x = xyz.x / 95.047;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 108.883;\n\n\tx = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);\n\ty = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);\n\tz = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);\n\n    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));\n    return(lab);\n}\n\nvec3 rgb2lab(in vec3 rgb) {\n    vec3 xyz = rgb2xyz(rgb);\n    vec3 lab = xyz2lab(xyz);\n    return(lab);\n}\n\nvec3 xyz2rgb (in vec3 xyz) {\n\tfloat x = xyz.x / 100.0;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 100.0;\n\t\n    \n\tfloat r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);\n\tfloat g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);\n\tfloat b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);\n\n\tr = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;\n\tg = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;\n\tb = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;\n\n\tr = min(max(0.0, r), 1.0);\n\tg = min(max(0.0, g), 1.0);\n\tb = min(max(0.0, b), 1.0);\n\n\treturn(vec3(r, g, b));\n}\n\nvec3 lab2xyz (in vec3 lab) {\n    float l = lab.x;\n\tfloat a = lab.y;\n\tfloat b = lab.z;\n\n  \tfloat y = (l + 16.0) / 116.0;\n\tfloat x = a / 500.0 + y;\n\tfloat z = y - b / 200.0;\n\n\tfloat y2 = pow(y, 3.0);\n\tfloat x2 = pow(x, 3.0);\n\tfloat z2 = pow(z, 3.0);\n\n  \ty = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;\n\tx = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;\n\tz = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;\n\n\tx *= 95.047;\n\ty *= 100.0;\n\tz *= 108.883;\n\n\treturn(vec3(x, y, z));\n}\nvec3 lab2rgb (in vec3 lab) {\n    vec3 xyz = lab2xyz(lab);\n    vec3 rgb = xyz2rgb(xyz);\n    return(rgb);\n}\n\n\n\n",zN=class extends Ur{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],oT.startContext(oT.globalContext),this.lightLayer=new UP(0,"",{...VA.defaultData("light","phong"),visible:!1},new VI,{},t.shared),oT.endContext(oT.globalContext),this.build()}updateState(e){void 0!==e.coloring&&(this.isColoringRandom="random"===e.coloring),void 0!==e.color&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),void 0!==e.color2&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),void 0!==e.size&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),void 0!==e.ease&&(this.easeOpacity=e.ease,this.build()),void 0!==e.easeSize&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new KT;return e.needsJitter=this.needsJitter,e.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n"),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode("\n    // Discard fully transparent pixels \n    if (gl_FragColor.a <= 0.0) discard;\n\n    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);\n"),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(FN),e.addFragmentParsCode(UN),e.addVertexFinalCode((e=>{let{easeSize:t="linearFadeOut"}=e;return`\n  vUv = uv;  \n  vRef = ref;\n  // Normalized LifeTime 1 to 0\n  float lifeLeft = texture2D(uPosition, ref).w;\n  v_LifeLeft = lifeLeft;\n  // Position From DataTexture Simulation\n  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;\n  // Apply World Quaternion\n  pos = applyQuaternionToVector(uWorldQuaternion, pos);  \n            \n  #ifdef  USE_SIZE_END\n    // Scaled Over Time\n    float t = 1. - lifeLeft;\n    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd\n    vec3 scaledPosition = position * vec3(currentSize);\n  #else\n    // Change Size Behavior over LifeTime\n    float easeSize = ${t}(1. - lifeLeft);\n    // Scaled Over Time\n    vec3 scaledPosition = position * vec3(uSize * easeSize);\n  #endif\n\n  // Billboard Behavior\n  vec2 scale;\n  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    \n  // Randomness \n  float randRef = rand(ref);\n  scale *= (1.0 - (uRandScaleFactor * randRef));\n  // Rotation\n  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);\n  float originalRotation = (1.0 - uRotation) * 2.0 * PI;\n  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;\n  // OverTime\n  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);\n\n  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;\n  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;\n  \n  mat4 instanceMatrix = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(pos.x, pos.y, pos.z, 1.0)\n  );  \n\n  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n  mvPosition.xy += rotatedPosition;\n  gl_Position = projectionMatrix  * mvPosition;   \n`})({easeSize:this.easeSize})),e.addFragmentFinalCode((e=>{let{easeOpacity:t="linearFadeOut"}=e;return`  \n  // if Particle is dead, hide it\n  if (v_LifeLeft <= 0.005 ) {\n    discard;\n  }\n\n  #ifdef USE_RANDOM_COLORING\n    float randVal = random(vRef); // Generate a random value based on the reference\n    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors\n  #else\n    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);\n  #endif\n\n  // Opacity over Life Time\n  float finalAlpha = ${t}(1. - v_LifeLeft);  \n  vec4 textureColor = texture2D(uTexture, vUv).rgba; \n  finalColor = textureColor.rgb * color.rgb;\n  finalAlpha = color.a * textureColor.a * finalAlpha;\n  \n  gl_FragColor = vec4(finalColor, finalAlpha);     \n\n`})({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach((e=>e.dispose())),super.dispose()}},jN=class{constructor(e,t,i,n){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=function(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}(t);this.targetMesh="Mesh"===n?.type&&n?n:this.getMesh(i,1);let{positions:r,dataTexture:s,dataTextureNormals:a}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,1));this.positionsTexture=s,this.positionsAttribute=r,this.directionsTexture=a}createPositions(e,t){let{positions:i,normals:n}=function(e,t){let i=new Rr(e.geometry,e.material),n=[],r=[],s=new Vi,a=new Vi;null!==i.geometry.index&&(i.geometry=i.geometry.toNonIndexed());let o=new ON(i).build();for(let l=0;l<t;l++)o.sample(s,a),n.push(s.x,s.y,s.z),r.push(a.x,a.y,a.z);return{positions:new Float32Array(n),normals:new Float32Array(r)}}(t,e*e);return{dataTexture:NN(i,e),positions:i,dataTextureNormals:NN(n,e)}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":i=new hc(.5*t,32,32);break;case"TorusEmitterShape":i=new dc(.5*t,.3,15,40);break;case"ConeEmitterShape":i=new Dl(t,t,15);break;case"BoxEmitterShape":i=new Lr(t,t,t);break;case"PlaneEmitterShape":i=new ts(t,t),i.rotateX(-Math.PI/2);break;default:i=new hc(t,32,32)}return new Rr(i,new rr({color:16711680}))}applyToShader(e,t){this.size=(new Vi).fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function VN(e){let t={...e},i=MA.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let n={...i.shape,...t.shape},r={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:n,renderMaterial:r}}var GN=class extends Hn{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new Vc,this.currentWorldPosition=new Vi,this.systemQuaternion=new ji,this.worldGravity=new Vi(0,0,0),this.directionAxis=new Vi(0,0,0),this.colliderV3=new Vi(0,0,0),this.colliderQuaternion=new ji(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new zN(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new Vi(0,0,0)},uEmissionData:{value:new Vi(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new Vi(0,0,0)},uWorldQuaternion:{value:new ki(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if("string"==typeof t){let i=this.shared.image(t),n=new Ni(i.img);return n.needsUpdate=!0,void(e.uTexture.value=n)}if("string"!=typeof i){let t=new Image;t.onload=()=>{let i=new Ni(t);i.needsUpdate=!0,e.uTexture.value=i};let n=new Blob([i],{type:"image/*"}),r=URL.createObjectURL(n);t.src=r}}updateGeometryAttributes(e,t){let i=function(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let n=0;n<e;n++){let r=i*e+n;t[2*r+0]=i/(e-1),t[2*r+1]=n/(e-1)}return t}(t);!this.emitterShape?.positionsAttribute||e.geometry.setAttribute("ref",new Wo(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset)return void this.reset();this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,n=this.targetFPS/i,r=this.previousRatio+(n-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=r,this.previousRatio=r;let s=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT)?.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0],t=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(e.destroyedInAction&&t&&this.init(VN({...this.system.data,colliderEntityId:null})),!e||e.destroyedInAction)return;e.getWorldPosition(this.colliderV3),0===this.colliderV3.y&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=e.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;"size"===t[2]&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),"sizeEnd"===t[2]&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(e,t)=>{let i=[...this.system.data.shape.size];i[e]=t,this.updateParticleState({shape:{...this.system.data.shape,size:i}})};"shape_size_0"===t[2]&&i(0,e),"shape_size_1"===t[2]&&i(1,e),"shape_size_2"===t[2]&&i(2,e),"speed"===t[2]&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/10),"gravity"===t[2]&&this.worldGravity.set(0,e/100,0),"noiseStrength"===t[2]&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),"noiseScale"===t[2]&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),"direction_x"===t[2]&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),"direction_y"===t[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),"direction_z"===t[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){if(this.positionSimRT&&this.velocitySimRT){if(this.shouldReInitGPUCompute(e)&&this.init(VN(this.system.data)),void 0!==e.life&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),void 0!==e.speed&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/10),void 0!==e.collisionBounce&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),void 0!==e.noiseStrength&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),void 0!==e.noiseScale&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),void 0!==e.noiseSeed&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),void 0!==e.randomMass&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),void 0!==e.renderMaterial?.size){let t=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(t)}if(void 0!==e.renderMaterial?.spriteRotation&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),void 0!==e.shape){let t=e.shape.size??this.system.data.shape.size,i=[Number(this.shared.getVariable(t[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t[2],[this.uuid,"particles","shape_size_2"]))],n={...VN(this.system.data).shape,size:i};this.emitterShape?.applyToShader(this.positionSimRT.material.uniforms,n)}if(void 0!==e.gravity&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),void 0!==e.direction){let t=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(t),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}void 0!==e.randomRotation&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),void 0!==e.randomScale&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(void 0!==e.forceIntensity&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),void 0!==e.forceDambing&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*ui.DEG2RAD,Number(e[1])*ui.DEG2RAD,Number(e[2])*ui.DEG2RAD],i=new In(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:n,shape:r,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=e;return void 0!==t||void 0!==i||n||null===n||void 0!==a||void 0!==r||void 0!==o||void 0!==s||void 0!==l||void 0!==c}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:"infinity"===e.emitTimeCycle?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval((()=>{if(this.emitterShape){if(isNaN(this.emitterShape.positionsTexture.source.data.data[0]))return void this.init(e);clearInterval(t)}}),100);if(!this.emitterShape)return;let i=new RN(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),n=this.updateSimulationDefinition(e),r=i.addVariable("uCurrentPosition",n+"\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform float uTime;\nuniform float uSpeed;     // update speed of the particles\nuniform vec3 uWorldOffset;    \nuniform vec4 uWorldQuaternion;\nuniform float uMaxLifeTime;\nuniform vec3 uEmitterSize;\nuniform float uFPSRatio;     // 1  for 60 FPS\n\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy,\n        vec2(12.9898,78.233)))*\n        43758.5453123);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n    vec3 acceleration = force / mass;\n    \n    return acceleration;\n  }\n  \n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted\n    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);\n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided\n    float lifeTime = uMaxLifeTime;\n\n    // Calculate the position adjustment based on collision\n    //     if (collisionFlag > .5) {  \n    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0\n    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise\n    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);\n\n    // Update position based on collision or normal movement\n    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);\n    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);\n\n    // EMISSION RATE - BIRTH\n    // if (isSpawning == 1.0) {\n    // Better Approach to avoid If statement\n    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;\n    originalPosition = mix(originalPosition, newPosition, isSpawning);\n    position = mix(position, originalPosition, isSpawning);;\n    timeStart = mix(timeStart, uTime, isSpawning);\n\n    // Calculate timeLeft for life normalization\n    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);\n    float life_Normalize = timeLeft / lifeTime;\n\n    // Use isActive to blend between the calculated color and black\n    vec4 activeColor = vec4(position, life_Normalize);\n    // if (isActive == 1.0) {\n    gl_FragColor = mix(vec4(0.0), activeColor, isActive);\n\n}\n",this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",n+"\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform sampler2D uDirections;     \nuniform vec3 uDirectionsAxis;\nuniform vec4 uWorldQuaternion;\nuniform vec3 uGravity;        \nuniform float uNoiseStrength;     // Variation of the noise\nuniform float uNoiseScale;        // Scale of the noise\nuniform float uNoiseSeed;         // Seed of the noise\nuniform float particleSize;\nuniform float uSpeed;     // update speed of the particles\nuniform float uRandomMassFactor;\n\n// COLLIDER\nuniform vec3 uColliderPos;                // Collider Position\nuniform vec3 uColliderSize;               // Collider Dimension\nuniform vec4 uColliderQuaternion;         // Collider Rotation\nuniform vec4 uColliderQuaternionInvert;   // Collider Rotation\nuniform float uBounce;                    // Bounce factor\nuniform float uForceDamping;\nuniform float uForceIntensity;\n\n\n\n\n    vec3 mod289(vec3 x) {\n      return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 mod289(vec4 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 permute(vec4 x) {\n        return mod289(((x*34.0)+1.0)*x);\n    }\n    \n    vec4 taylorInvSqrt(vec4 r)\n    {\n    return 1.79284291400159 - 0.85373472095314 * r;\n    }\n    \n    vec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n    float snoise(vec3 v)\n    {\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n    \n    // Permutations\n    i = mod289(i);\n    vec4 p = permute( permute( permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n    \n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857; // 1.0/7.0\n    vec3  ns = n_ * D.wyz - D.xzx;\n    \n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n    \n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n    \n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n    \n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n    \n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n    \n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n    \n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n    \n    //Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    \n    // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                  dot(p2,x2), dot(p3,x3) ) );\n    }\n    \n    vec3 snoiseVec3( vec3 x ){\n    \n      float s  = snoise(vec3( x ));\n      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n      vec3 c = vec3( s , s1 , s2 );\n      return c;\n    \n    }\n    \n      \n    vec3 curlNoise( vec3 p, float seed){\n      p += seed;\n      const float e = .1;\n      vec3 dx = vec3( e   , 0.0 , 0.0 );\n      vec3 dy = vec3( 0.0 , e   , 0.0 );\n      vec3 dz = vec3( 0.0 , 0.0 , e   );\n    \n      vec3 p_x0 = snoiseVec3( p - dx );\n      vec3 p_x1 = snoiseVec3( p + dx );\n      vec3 p_y0 = snoiseVec3( p - dy );\n      vec3 p_y1 = snoiseVec3( p + dy );\n      vec3 p_z0 = snoiseVec3( p - dz );\n      vec3 p_z1 = snoiseVec3( p + dz );\n    \n      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n    \n      const float divisor = 1.0 / ( 2.0 * e );\n      return normalize( vec3( x , y , z ) * divisor );\n    \n    }\n\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n\n\nvec3 fbm_vec3(vec3 p, float frequency, float offset)\n{\n  return vec3(\n    cnoise((p+vec3(offset))*frequency),\n    cnoise((p+vec3(offset+20.0))*frequency),\n    cnoise((p+vec3(offset-30.0))*frequency)\n  );\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n } \nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n  \n  return acceleration;\n}\n\nvec4 conjugate(vec4 q) {\n  return vec4(q.w, -q.x, -q.y, -q.z);\n}\n\n// Function to compute the normal of the ellipsoid at a given point\nvec3 ellipsoidNormal(vec3 p, vec3 radii) {\n  return normalize(p / (radii * radii));\n}\n\nfloat friction = .3;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    vec3 directions = texture2D( uDirections, vUv ).xyz;    \n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float mass = rand(originalPosition.xy) * 0.5 + 0.5;\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active\n    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision\n\n    // Randomness Mass\n    mass = (1.0 - (uRandomMassFactor * mass));\n    \n    if (isActive == 1.0) {\n      // **************************************************************\n      // FORCES NOISES\n      // **************************************************************\n      #ifdef USE_CURL_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {\n          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;\n        }\n      #endif\n      // **************************************************************\n      #ifdef USE_SIMPLEX_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {\n          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);\n        }\n      #endif\n      // ************************************************************** \n      #ifdef USE_FBM_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      \n          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;\n        }\n      #endif\n\n      // COLLIDER\n      \n  #ifdef USE_COLLIDER\n    float restitution = max(uBounce * 2., .01); // Energy Loss\n    // SPHERE COLLIDER\n    // **************************************************************\n    #ifdef USE_SPHERE_COLLIDER       \n      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n      vec3 radii = uColliderSize;\n      // Adjust position relative to collider\n      vec3 relPos = position - uColliderPos;\n      // Apply rotation of the collider to the relative position\n      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n      // Scale relative position by radii (for ellipsoid collision detection)\n      vec3 scaledPos = relPos / radii;\n      // Calculate ellipsoidal distance\n      float dist = length(scaledPos); // Distance in terms of ellipsoid\n      \n      // Check for collision\n      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {\n          // Compute the normal at the collision point, accounting for particle size\n        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          \n        // Compute the normal at the collision point\n        vec3 normal = ellipsoidNormal(adjustedPos, radii);\n        // Rotate the normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);\n        // Reflect the velocity vector off the normal\n        velocity = reflect(velocity, normal) * restitution;\n\n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif\n\n    // BOX COLLIDER or PLANE COLLIDER \n    // **************************************************************\n    #ifdef USE_BOX_COLLIDER\n      // Box dimensions and repulsion variables\n      vec3 boxHalfSize = uColliderSize / 2.0;\n      // Convert world position to box's local space\n      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n      // Collision detection\n      vec3 localDistance = abs(localPos) - boxHalfSize;\n      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    \n\n      // Collision Detected\n      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      \n        // Find the nearest face normal for bounce direction\n        vec3 normal;\n        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {\n            normal = vec3(sign(localPos.x), 0.0, 0.0);\n        } else if (localDistance.y > localDistance.z) {\n            normal = vec3(0.0, sign(localPos.y), 0.0);\n        } else {\n            normal = vec3(0.0, 0.0, sign(localPos.z));\n        }            \n        // Rotate normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);      \n        // Reflect velocity and apply repulsion force\n        velocity = reflect(velocity, normal) * restitution;\n        \n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif      \n  #endif      \n  // END COLLIDER    \n\n      // ATTRACTION\n      \n  #ifdef USE_ATTRACTOR\n\n      #ifdef USE_SPHERE_COLLIDER      \n        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n        vec3 radii = uColliderSize;\n        // Adjust position relative to collider\n        vec3 relPos = position - uColliderPos;\n        // Apply rotation of the collider to the relative position\n        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n        // Scale relative position by radii (for ellipsoid collision detection)\n        vec3 scaledPos = relPos / radii;\n        // Calculate ellipsoidal distance\n        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid\n        float insideCheck = 1.0;\n\n      #endif\n\n\n      #ifdef USE_BOX_COLLIDER\n        // Box dimensions\n        vec3 boxHalfSize = uColliderSize / 2.0;\n        // Convert world position to box's local space\n        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n        vec3 localDistance = abs(localPos) - boxHalfSize;\n        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n        float insideCheck = particleSize;\n      #endif      \n  \n      // Apply vortex force inside the Helper\n      #ifdef USE_FORCE_LOCAL_SPACE\n        if (distToSurface <= insideCheck ) {    \n            // Define parameters for the attractor field\n            #ifdef USE_SPHERE_COLLIDER      \n              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed\n            #endif\n\n            #ifdef USE_BOX_COLLIDER\n              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed\n              #endif\n\n            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)\n          \n            // Use the same radii calculation code as for the collider\n            vec3 attractorRadii = uColliderSize;\n            // Adjust position relative to attractor center\n            vec3 relPos = position - uColliderPos;\n            // Apply rotation of the collider to the relative position\n            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n            // Scale relative position by radii (for ellipsoid attraction)\n            vec3 scaledPos = relPos / attractorRadii;\n\n            // Calculate ellipsoidal distance as attractor radius\n            float attractorRadius = length(scaledPos);\n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * attractorStrength;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= attractorDamping;\n        }\n      #else \n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= uForceDamping;\n      #endif    \n  #endif      \n  \n      // VORTEX\n      \n  #ifdef USE_VORTEX\n    // Box dimensions\n    vec3 boxHalfSize = uColliderSize / 2.0;\n    // Convert world position to box's local space\n    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n    vec3 localDistance = abs(localPos) - boxHalfSize;\n    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n\n    // Apply vortex force inside the box\n    if (distToSurface <= particleSize) {\n      float vortexStrength = uForceIntensity;\n      vec3 localTopCenter = vec3(0.0, 0., 0.0);\n\n      // Transform the local top center to the world space\n      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);\n      // Calculate the vector from particle to vortex center\n      vec3 vortexVector = vortexCenter - position;\n\n      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector\n      // Note: important to add a tiny z component to the up vector to avoid instability\n      vec3 upVector = vec3(0.0, 1.0, 0.01);\n      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));\n      rotationAxis = normalize(rotationAxis);\n\n      // Add rotational component to velocity\n      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; \n\n      vec3 rotationVelocity = rotationAxis * rotationSpeed;\n      // velocity += rotationVelocity * 0.005 ;\n      velocity = rotationVelocity * 0.005 ;\n\n      // Calculate vortex force\n      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;\n      // Apply the vortex force to the particle\n      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);\n      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);\n    }\n  #endif      \n\n    } \n    // End isActive\n\n    // SPAWN BIRTH \n    // **************************************************************\n    // if (isSpawning == 1.)\n    #ifdef USE_NORMALS\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);\n    #else\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    \n    #endif\n    \n    // if (collisionFlag == 0.0)\n    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);\n\n    gl_FragColor = vec4(velocity, collisionFlag);\n}\n",this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate","\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\n\nuniform sampler2D uIndex; // Texture with corresponding index\nuniform float uLastIndexEmitted; // Last emitted index\nuniform float uParticlesToEmit; // Number of particles to emit on that frame\nuniform float uTime;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    float particleIndex = texture(uIndex, vUv).x;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;\n\n\n    // ********** Detect Colision to Create a flag and use it in position **********\n    // We are doing this here, so\n\n    // ********** Emit Particles **********\n    // X = isSpawning 0.0 or 1.0\n    // Y = isActive 0.0 or 1.0\n    // Check if the vertex index is between the first value and the last value\n    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {\n    //     // Emit a particle by writing 1 to the red channel of the color output\n    //     // r: 1. == emit the particle\n    //     // g: 1. == particle is now active\n    //     timeStart = uTime;\n    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);\n    // } else {\n    //     // The Particle is either already emitted or not in the range of the particles to emit\n    //     // Do not emit a particle by writing 0 to the red channel of the color output        \n    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);\n    // }\n    // Determine if the particle is within the emission range\n    float emitLowerBound = step(uLastIndexEmitted, particleIndex);\n    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);\n    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise\n\n    // Set timeStart and color\n    timeStart = mix(timeStart, uTime, emitParticle);\n    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);\n\n\n}\n",function(e){let t=new Float32Array(4*e*e);for(let n=0;n<e*e;n++)t[4*n]=0,t[4*n+1]=0,t[4*n+2]=0,t[4*n+3]=0;let i=new jo(t,e,e,Qe,ze);return i.needsUpdate=!0,i}(this.emitterShape.textureSize));i.setVariableDependencies(r,[r,s,a]),i.setVariableDependencies(s,[r,s,a]),i.setVariableDependencies(a,[r,s,a]);let o=function(e){let{size:t}=e,i=new Float32Array(4*t*t);for(let r=0;r<t*t;r++)i[4*r]=r,i[4*r+1]=0,i[4*r+2]=0,i[4*r+3]=0;let n=new jo(i,t,t,Qe,ze);return n.needsUpdate=!0,n}({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new Vi(0,0,0)},uWorldQuaternion:{value:new ki(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new Vi(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};r.material.uniforms=l;let c=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let h=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),d={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new ki(0,0,0,1)},uColliderPos:{value:new Vi(0,0,0)},uColliderSize:{value:new Vi(0,0,0)},uForceIntensity:{value:h?h.forceIntensity:0},uForceDamping:{value:h?h.forceDambing:0},uColliderQuaternion:{value:new ki(0,0,0,1)},uColliderQuaternionInvert:{value:new ki(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/10}};s.material.uniforms=d;let u={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=u;let p=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],f={...VN(this.system.data).shape,size:p};this.emitterShape.applyToShader(r.material.uniforms,f),i.init(),this.gpuCompute=i,this.positionSimRT=r,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){return[Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]))]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let t=this.system.getColliderData(e.colliderEntityId);switch(t?.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0}let i=t?.colliderType;"sphere"===i&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),"box"===i&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),"helper"===t?.forceRange&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}"normals"===e.directionMode&&(this.simFeaturesDefinition.USE_NORMALS=!0),"curl"===e.noiseType&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),"simplex"===e.noiseType&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),"fbm"===e.noiseType&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,n]of Object.entries(this.simFeaturesDefinition))n&&(t+=`#define ${i}\n`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new Vi(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if("MeshEmitterShape"===e.type){let n=null;return this.system.context.scene.traverseEntity((t=>{t.uuid===e.fromMeshId&&(n=t)})),n?new jN(i,t,e.type,n):new jN(i,t,"SphereEmitterShape")}return new jN(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new Jo(new ts(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount(e){let{birthRatePerSecond:t,particleMaxLifeTime:i,loopDuration:n=0}=e;return Math.ceil(t*(i+n))}dispose(){!this.gpuCompute||(this.rootObject?.parent?.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),this.emitterShape?.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,n=1/t;if(i>=n){let t=Math.max(1,Math.floor(i/n));return this.lastEmitTime=e,this.emittedParticlesAmount+t>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=t,t}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(VN(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},HN=class extends sT{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new yr,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=e=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(e))},this.context=i,this.data={...t,...VN(t)},this.geometry.setAttribute("position",new hr([],3)),this.material=new rr({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new GN(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t="one_time"===this.data.emitTimeCycle;if(("loop"===this.data.emitTimeCycle||t)&&this.currentLoopTime>1e3*this.data.emitTimeDuration&&(this.stopped||(this.stop(),t||this.start(1e3*this.data.emitTimeDelay))),this.emitter&&this.started){let t=this.actualTime/1e3;this.emitter.update(t,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some((t=>t.identity===e))}getColliderData(e){let t=this.colliderEntities.find((t=>t.identity===e));return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),iy(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...Mv.drop(e,1).props}}),iy(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...Mv.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(void 0!==e.colliderEntityId&&null!==e.colliderEntityId){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}null===e.colliderEntityId&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.currentLoopTime=0,e?this.timeoutId=window.setTimeout((()=>{this.start(0)}),e):(this.started=!0,this.stopped=!1,this.isFrozen=!1,this.emitter?.startEmitting(this.actualTime/1e3))}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){this.stopped=!0,this.currentLoopTime=0,this.emitter?.stopEmitting(),clearTimeout(this.timeoutId)}reset(){this.started=!1,this.stopped=!1,this.emitter?.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};var WN=function(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch{}}();function QN(e,t,i){return console.assert(void 0!==t.type),"Mesh"===t.type?function(e,t,i){let n;return void 0!==WN&&(t?.geometry?.subdivisions??0)>WN&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=WN),"TextGeometry"===t.geometry.type?new vR(e,t,i):"InputGeometry"===t.geometry.type?new EN(e,t,i):(n="SubdivGeometry"===t.geometry.type?new qD(e,t,i):"PathGeometry"===t.geometry.type?new _N(e,t,i):"VectorGeometry"===t.geometry.type?new SN(e,t,i):"BooleanGeometry"===t.geometry.type?new eB(e,t,i):"ShapeBlendGeometry"===t.geometry.type?new $N(e,t,i):"UIGeometry"===t.geometry.type?new DN(e,t,i):new jD(e,t,i),n)}(e,t,i):"Empty"===t.type?new hB(e,t):"Particle"===t.type?new HN(e,t,i):"ParticleCollider"===t.type?new dB(e,t,i):"Splat"===t.type?new hB(e,t):"Bone"===t.type?new PN(e,t):"Page"===t.type?new xN(e,t,i):"PointLight"===t.type?new wN(e,t,i):"SpotLight"===t.type?new xO(e,t,i):"DirectionalLight"===t.type?new vO(e,t,i):"Component"===t.type||"Instance"===t.type?new CN(e,t,i):vA.is(t.type)?new YR(e,t):(console.error(t),new hB(e,t))}S_.createEntity=QN,S_.changeEntityProptotype=function(e,t,i){let n=QN(e.identity,t,i),r=e.children,s=e.attachedPaths,a=e.parent,o=e.component,l=e.instances,c=e.overrideData,h=e.uuid,d=e.stateSelection;e.dispose();for(let u of Object.keys(e))delete e[u];Object.setPrototypeOf(e,Object.getPrototypeOf(n));for(let u of Object.keys(n))e[u]=n[u];e.children=[...e.children,...r],e.attachedPaths=s,e.parent=a,e.component=o,e.instances=l,e.uuid=h,e.overrideData=c,e.updateState(e.data,i),d&&e.changeSelectedState(d,i),e.resetBBoxNeedsUpdate()},S_.Cloner=PR;var qN=new yr;qN.setAttribute("position",new or(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var XN=class extends pc{constructor(e){super({...e,depthTest:!1,depthWrite:!1,glslVersion:Kt,vertexShader:"\n\t\t\t\tprecision highp float;\n\t\t\t\tin vec3 position;\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_Position = vec4(position, 1);\n\t\t\t\t}\n\t\t\t"})}customProgramCacheKey(){return""}};var YN=new zr,KN=96,JN={shapeInput:()=>"\n\t\t\tconst float posRowCoord = 0.1;  // vec4: px py pz opType\n\t\t\tconst float quatRowCoord = 0.3;  // vec4: qx qy qz qw\n\t\t\tconst float param1RowCoord = 0.5;// vec4: type param1 param2 param3\n\t\t\tconst float param2RowCoord = 0.7;// vec4: blendRange roundness scale param4\n\t\t\tconst float colorRowCoord = 0.9; // vec4: r g b a\n\t\t\tuniform sampler2D shapesDataTexture;\n\t\t\tvec4 shapePos(float iin) { \n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeQuat(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeParams1(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeParams2(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeColor(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t",getxyzi:"\n\t\t\t// this code must complement lookup\n\t\t\tfloat xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);\n\t\t\tfloat yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);\n\t\t\tfloat zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;\n\t\t",lookup:"\n\t\t\tuniform sampler2D potentialPassTexture;\n\t\t\tuniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)\n\t\t\t\n\t\t\t// box or marching cube lookup value in value texture, integer box coord inputs\n\t\t\t// this code must complement codebits.getxyzi\n\t\t\tvec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc\n\t\t\t\tvec2 uv = vec2(\n\t\t\t\t\tmod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,\n\t\t\t\t\tfloor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION\n\t\t\t\t); \n\t\t\t\tuv /= Z_LAYERS_PER_ROW;\n\t\t\t\treturn texture(rt, uv);\n\t\t\t}\n\t\t",getpart:"\n\t\t\tfloat getpart(inout float a, float b) {\n\t\t\t\tfloat t = floor(a/b);\n\t\t\t\tfloat r = a - t*b;\n\t\t\t\ta = t;\n\t\t\t\treturn r;\n\t\t\t}\n\t\t",triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])},ZN=class extends jD{constructor(e,t,i){super(e,t,i),this.data=t,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new No,this.potentialPassScene=new No,this.voxelPassScene=new No,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new yr,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new Rr(qN,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let n=new jo(JN.triTable,16,256,Je,ze);n.needsUpdate=!0;let r=new jo(JN.numTrisTable,256,1,Je,ze);r.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:r}},this.voxelMesh=new Rr(qN,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new Rr(qN,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:n},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=e=>{if(lk.call(this),0===this.npart)return void(this.geometry.drawRange.count=0);let t=this.material.root;if(t.shadersPatchedForShapeBlend){if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new Ur({vertexShader:t.vertexShader,fragmentShader:"\n\t\t\t\t\t\t#include <packing>\n\t\t\t\t\t\tvoid main()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n\t\t\t\t\t\t}\n\t\t\t\t\t",uniforms:t.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new Ur({vertexShader:t.vertexShader,fragmentShader:"\n\t\t\t\t\t#include <common>\n\t\t\t\t\t#include <packing>\n\t\t\t\t\tuniform vec3 referencePosition;\n\t\t\t\t\tuniform float nearDistance;\n\t\t\t\t\tuniform float farDistance;\n\t\t\t\t\t// World-space position\n\t\t\t\t\tvarying vec3 vWPosition;\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tfloat dist = length(vWPosition - referencePosition);\n\t\t\t\t\t\tdist = (dist - nearDistance) / (farDistance - nearDistance);\n\t\t\t\t\t\tdist = saturate(dist);\n\t\t\t\t\t\t// Required by Three.js for this to work\n\t\t\t\t\t\tgl_FragColor = packDepthToRGBA( dist );\n\t\t\t\t\t}",uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new Vi},opacity:{value:0},...t.uniforms},defines:this.material.defines});let e=this.customDistanceMaterial;e.referencePosition=new Vi,e.nearDistance=0,e.farDistance=0,e.opacity=1,e.isMeshDistanceMaterial=!0}}else this.patchVertexShaderForShapeBlend(t),t.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let e=this.pyramidLevelSizes.length%2===0?0:1,t=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[e].texture,this.marchPassUniforms.pyramidTexture2Size.value=new pi(this.pyramidRenderTarget[e].width,this.pyramidRenderTarget[e].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[t].texture,this.marchPassUniforms.pyramidTexture1Size.value=new pi(this.pyramidRenderTarget[t].width,this.pyramidRenderTarget[t].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let i=e.shadowMap.enabled;e.shadowMap.enabled=!1;let n=e.getRenderTarget();e.setRenderTarget(this.spatialPassRenderTarget),e.render(this.spatialscene,YN),e.setRenderTarget(this.potentialPassRenderTarget),e.render(this.potentialPassScene,YN),e.setRenderTarget(this.voxelPassRenderTarget),e.render(this.voxelPassScene,YN),ZN.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,e,this.voxelPassRenderTarget,this.pyramidRenderTarget).then((e=>{this.material.wireframe&&(3*e>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new yr,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new or(new Float32Array(3*e*2),3)),(3*e>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=3*Math.floor(1.2*e)),this.drawRangeNeedsForceUpdate=!1})),e.shadowMap.enabled=i,e.setRenderTarget(n)}}set npart(e){e!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=e,this.spatialn=Math.ceil(e/96))}get npart(){return this._npart}set resolutionLevel(e){let t=Math.min(8,Math.max(5,e));if(t!==this._resolutionLevel){switch(this._resolutionLevel=t,this.resolution=Math.pow(2,t),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=496,this.bboxOffset=-8;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=504,this.bboxOffset=-4;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=508,this.bboxOffset=-2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=510,this.bboxOffset=-1}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let e=this.pyramidLevelSizes.length-2;e>=0;e--)(this.pyramidLevelSizes.length-2)%2===e%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[e]:this.pyramidTexture2Width+=this.pyramidLevelSizes[e];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let e=this._spatialPassRenderTargets[this.resolutionLevel];return e||(e=new Fi(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:Qe,type:ze,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Te,magFilter:Te}),this._spatialPassRenderTargets[this.resolutionLevel]=e),e}get potentialPassRenderTarget(){let e=this._potentialPassRenderTargets[this.resolutionLevel];return e||(e=new Fi(this.basePyramidSize,this.basePyramidSize,{format:Qe,type:ze,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Te,magFilter:Te}),this._potentialPassRenderTargets[this.resolutionLevel]=e),e}get voxelPassRenderTarget(){let e=this._voxelPassRenderTargets[this.resolutionLevel];return e||(e=new zi(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:Te,magFilter:Te}),e.texture[0].format=Qe,e.texture[0].type=ze,e.texture[1].format=Je,e.texture[1].type=ze,this._voxelPassRenderTargets[this.resolutionLevel]=e),e}get pyramidRenderTarget(){let e=this._pyramidRenderTargets[this.resolutionLevel];if(!e){e=[new Fi(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:Qe,type:ze,stencilBuffer:!1,depthBuffer:!1,magFilter:Te,minFilter:Te}),new Fi(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:Qe,type:ze,stencilBuffer:!1,depthBuffer:!1,magFilter:Te,minFilter:Te})],this._pyramidRenderTargets[this.resolutionLevel]=e}return e}updateState(e,t){let i=this.material;super.updateState(e,t),i!==this.material&&(this.needsRebuild=!0),e.geometry&&(this.resolutionLevel=e.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),e.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new or(new Float32Array(3*this.geometry.drawRange.count),3)):!e.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let e=`\n\t\t\tprecision highp float;\n\t\t\tout vec4 pc_FragColor;\n\t\t\tconst float spatialDivisions = ${this.spatialDivisions}.;\n\t\t\tuniform float span;\n\t\t\tuniform float npart;\n\t\t\tuniform float spatialn;\n\t\t\t${JN.shapeInput()}\n\n\t\t\tvec3 low, high;     // range of current div; subset of -1 .. 1 with span border\n\n\t\t\t// lookup one element/channel's worth of spheres for current division\n\t\t\t// stating with low sphere number lowi\n\t\t\t// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)\n\t\t\tfloat spatialKey(float lowi) {\n\t\t\t\tfloat t = 0.;\n\t\t\t\tfor (float ii = 23.; ii >= 0.; ii--) {\n\t\t\t\t\tfloat i = ii + lowi;\n\t\t\t\t\tfloat iin = (i + 0.5) / 96.;\n\t\t\t\t\tvec4 shape = shapePos(iin);\n\t\t\t\t\tvec3 d = shape.xyz;\n\t\t\t\t\tfloat op = shape.w;\n\t\n\t\t\t\t\tt *= 2.;\n\t\t\t\t\tt += (\n\t\t\t\t\t\tlow.x < d.x && d.x < high.x &&\n\t\t\t\t\t\tlow.y < d.y && d.y < high.y &&\n\t\t\t\t\t\tlow.z < d.z && d.z < high.z &&\n\t\t\t\t\t\ti < npart || op == -2. // always include if op is -2, which is the intersection operation\n\t\t\t\t\t) ? 1. : 0.;\n\t\t\t\t}\n\t\t\t\treturn t;\n\t\t\t}\n\n\t\t\t${JN.getpart}\n\n\t\t\tvoid main() {               // spatialial fragment shader\n\t\t\t\t// find active div\n\t\t\t\tvec3 div;                               // which div is current\n\t\t\t\t// out holds x=> x, lowi faster moving and y=> z, y faster moving\n\t\t\t\tfloat yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving\n\t\t\t\tdiv.y = getpart(yz, spatialDivisions);\n\t\t\t\tdiv.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart\n\n\t\t\t\tfloat lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving\n\t\t\t\tfloat lowi = getpart(lx, spatialn) * 96.;\n\t\t\t\tdiv.x = lx;\n\n\t\t\t\tlow = div / spatialDivisions * 2. - 1. - span;\n\t\t\t\thigh = (div+1.) / spatialDivisions * 2. - 1. + span;\n\n\t\t\t\t// find active range of spheres\n\t\t\t\tpc_FragColor.x = spatialKey(lowi);\n\t\t\t\tpc_FragColor.y = spatialKey(lowi+24.);\n\t\t\t\tpc_FragColor.z = spatialKey(lowi+48.);\n\t\t\t\tpc_FragColor.w = spatialKey(lowi+72.);\n\t\t\t}\n\t\t`;return new XN({name:"Spatial Pass",fragmentShader:e,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let e=`\n\t\t\tprecision highp float;\n\t\t\tout vec4 pc_FragColor;\n\n\t\t\t${JN.shapeInput()}\n\t\t\tuniform sampler2D spatialPassTexture;\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\n\t\t\tuniform float npart;\n\t\t\tuniform float spatialn;\n\t\t\tconst float spatialDivisions = ${this.spatialDivisions}.;\n\t\t\tconst float spatialDivisions2 = spatialDivisions * spatialDivisions;\n\t\t\tconst float spatialDivisionsSub1 = spatialDivisions - 1.;\n\n\t\t\t${JN.getpart}\n\n\t\t\tvec3 packRGBAToVec3(vec4 color) {\n\t\t\t\tuint r = uint(color.r * 255.);\n\t\t\t\tuint g = uint(color.g * 255.);\n\t\t\t\tuint combined = (r << 8) | g; \n\t\t\t\treturn vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535\n\t\t\t}\n\n\t\t\tvoid applyQuaternionToVector(in vec4 q, inout vec3 v) {\n\t\t\t\tv += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)\n\t\t\t */\n\n\t\t\t// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference\n\t\t\tfloat smoothOperation(float op, float sdf, float d, float k) {\n\t\t\t  //        union: op =  1 => signSubtract =  1, signIntersection =  1\n\t\t\t  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1\n\t\t\t\t// intersection: op = -2 => signSubtract = -1, signIntersection = -1\n\n\t\t\t\tfloat signSubtract = clamp(op, -1., 1.);\n\t\t\t\tfloat signIntersection = 2. * (op - signSubtract) + 1.;\n\t\t\t\tfloat h = clamp(\n\t\t\t\t\t0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,\n\t\t\t\t\t0.0,\n\t\t\t\t\t1.0\n\t\t\t\t);\n\t\t\t\treturn mix(sdf, signSubtract * signIntersection * d, h) - \n\t\t\t\t\t\t\t signSubtract * k * h * (1.0 - h);\n\t\t\t}\n\n\t\t\tfloat sdSphere( vec3 p, float s )\n\t\t\t{\n\t\t\t\treturn length(p)-s;\n\t\t\t}\n\n\t\t\tfloat sdEllipsoid( vec3 p, vec3 r )\n\t\t\t{\n\t\t\t\tfloat k0 = length(p/r);\n\t\t\t\tfloat k1 = length(p/(r*r));\n\t\t\t\treturn k0*(k0-1.0)/k1;\n\t\t\t}\n\n\t\t\tfloat sdBox( vec3 p, vec3 b )\n\t\t\t{\n\t\t\t\tvec3 q = abs(p) - b;\n\t\t\t\treturn length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\n\t\t\t}\n\n\t\t\tfloat sdTorus( vec3 p, vec2 t )\n\t\t\t{\n\t\t\t\tvec2 q = vec2(length(p.xy)-t.x,p.z);\n\t\t\t\treturn length(q)-t.y;\n\t\t\t}\n\n\t\t\tfloat sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)\n\t\t\t{\n\t\t\t\tp.x = abs(p.x);\n\t\t\t\tfloat k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);\n\t\t\t\treturn sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;\n\t\t\t}\n\n\t\t\tfloat dot2( in vec2 v ) { return dot(v,v); }\n\t\t\tfloat sdCappedCone( vec3 p, float h, float r1, float r2 )\n\t\t\t{\n\t\t\t\tvec2 q = vec2( length(p.xz), p.y );\n\t\t\t\tvec2 k1 = vec2(r2,h);\n\t\t\t\tvec2 k2 = vec2(r2-r1,2.0*h);\n\t\t\t\tvec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);\n\t\t\t\tvec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );\n\t\t\t\tfloat s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;\n\t\t\t\treturn s*sqrt( min(dot2(ca),dot2(cb)) );\n\t\t\t}\n\n\t\t\tfloat sdCappedCylinder( vec3 p, float h, float r )\n\t\t\t{\n\t\t\t\tvec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);\n\t\t\t\treturn min(max(d.x,d.y),0.0) + length(max(d,0.0));\n\t\t\t}\n\n\t\t\tfloat maxBlend = 0.0;\n\t\t\t// compute potential from A (=24) spheres, using the bit flags in 'activeKey'\n\t\t\t// to avoid lookup/compute for inactive spheres\n\t\t\t// return field potential, side effect updates track,\n\t\t\t// compute and return +ve and -ve values separately\n\t\t\tvoid fillSpatialInner(\n\t\t\t\tfloat ii,\n\t\t\t\tfloat activeKey,\n\t\t\t\tvec3 corner,\n\t\t\t\tinout float sdf,\n\t\t\t\tinout float colorDivisor,\n\t\t\t\tinout vec4 trackColor\n\t\t\t) {\n\t\t\t\tfor (float i = 0.; i < 24.; i++) {\n\t\t\t\t\tif (activeKey < 1.) break; // activeKey exhausted, no more active spheres\n\t\t\t\t\tactiveKey *= 0.5;\n\t\t\t\t\tif (fract(activeKey) < 0.5) continue;\n\n\t\t\t\t\tfloat iin = (i + ii + 0.5) * ${1/KN};\n\t\t\t\t\tvec4 shape = shapePos(iin);\n\t\t\t\t\tvec4 quat = shapeQuat(iin);\n\t\t\t\t\tvec4 params1 = shapeParams1(iin);\n\t\t\t\t\tvec4 params2 = shapeParams2(iin);\n\n\t\t\t\t\tvec3 p = corner - shape.xyz;\n\t\t\t\t\tapplyQuaternionToVector(quat, p);\n\t\t\t\t\tp /= params2.z; // scale\n\t\t\t\t\tfloat d; // d in -1..1 coordinates\n\t\t\t\t\tswitch (int(params1.x)) {\n\t\t\t\t\t\tcase 0: d = sdSphere(p, params1.y); break;\n\t\t\t\t\t\tcase 1: d = sdEllipsoid(p, params1.yzw); break;\n\t\t\t\t\t\tcase 2: d = sdBox(p, params1.yzw); break;\n\t\t\t\t\t\tcase 3: d = sdCappedCylinder(p, params1.y, params1.z); break;\n\t\t\t\t\t\tcase 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;\n\t\t\t\t\t\tcase 5: d = sdTorus(p, params1.yz); break;\n\t\t\t\t\t\tcase 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;\n\t\t\t\t\t}\n\t\t\t\t\td -= params2.y; // rounded edge\n\t\t\t\t\td *= params2.z; // scale\n\n\t\t\t\t\tfloat k = params2.x;\n\t\t\t\t\tfloat op = shape.w;\n\n\t\t\t\t\tsdf = smoothOperation(shape.w, sdf, d, k);\n\n\t\t\t\t\tfloat isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise\n\t\t\t\t\tfloat colorCull = smoothstep(maxBlend, 0., -d);\n\t\t\t\t\tfloat cullFactor = mix(1.0, colorCull, isNegativeOne);\n\t\t\t\t\ttrackColor *= cullFactor;\n\t\t\t\t\tcolorDivisor *= cullFactor;\n\n\t\t\t\t\tmaxBlend = max(maxBlend, k);\n\n\t\t\t\t\tk += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k\n\t\t\t\t\tfloat nearness = smoothstep(k, 0., d);\n\n\t\t\t\t\tvec4 color = shapeColor(iin);\n\t\t\t\t\tnearness *= float(color.a >= 0.);\n\n\t\t\t\t\tcolorDivisor += nearness;\n\t\t\t\t\ttrackColor += color * nearness;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvec3 div;\n\t\t\t// compute potential from all spheres; collect +ve and =ve values separately\n\t\t\t// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values\n\t\t\t// TODO check if extra vec3 output useful, not really used at present\n\t\t\tfloat fillSpatial(vec3 corner, inout vec4 trackColor) {\n\t\t\t\tfloat sdf = 1e3; // hack: initialize to large value\n\t\t\t\tfloat colorDivisor = 0.;\n\t\t\t\t// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving\n\t\t\t\tfloat divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);\n\t\t\t\tfor (float ii = 0.; ii < spatialn; ii++) {\n\t\t\t\t\tfloat i = ii * 96.;\n\n\t\t\t\t\tvec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));\n\t\t\t\t\tfillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+24., activeKey.y, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+48., activeKey.z, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+72., activeKey.w, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t}\n\n\t\t\t\ttrackColor /= colorDivisor;\n\t\t\t\treturn mix(sdf, 0.0, step(1e20 - 0.1, sdf));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\t${JN.getxyzi}    // get xi yi zi from 2d position\n\n\t\t\t\tvec3 xyzi = vec3(xi,yi,zi);\n\t\t\t\tvec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords\n\n\t\t\t\tdiv = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);\n\n\t\t\t\tvec4 c = vec4(0.);\n\t\t\t\tfloat t = fillSpatial(corner, c);\n\n\t\t\t\tpc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture\n\t\t\t}\n\t\t`;return new XN({name:"PotentialPass",fragmentShader:e,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let e=`\n\t\t\tprecision highp float;\n\t\t\tlayout(location = 0) out vec4 pc_FragColor;\n\t\t\tlayout(location = 1) out vec4 numTris;\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; \n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\t\t\tuniform sampler2D numTrisTable; // 256 x 1\n\n\t\t\tfloat keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {\n\t\t\t\treturn (float(f000 < 0.) * 1.) +\n\t\t\t\t\t\t\t (float(f100 < 0.) * 2.) +\n\t\t\t\t\t\t\t (float(f010 < 0.) * 8.) +\n\t\t\t\t\t\t\t (float(f110 < 0.) * 4.) +\n\t\t\t\t\t\t\t (float(f001 < 0.) * 16.) +\n\t\t\t\t\t\t\t (float(f101 < 0.) * 32.) +\n\t\t\t\t\t\t\t (float(f011 < 0.) * 128.) +\n\t\t\t\t\t\t\t (float(f111 < 0.) * 64.);\n\t\t\t}\n\n\t\t\t${JN.lookup}\n\n\t\t\tvec3 compNormi(float xi, float yi, float zi) {\n\t\t\t\tfloat dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;\n\t\t\t\tfloat dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;\n\t\t\t\tfloat dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;\n\t\t\t\t// if we allow (common) 0,0,0 case through then NaN can spread\n\t\t\t\t// eg r = vec4(compNorm i(???), 1.) will pollute r.w\n\t\t\t\tif (dx == 0.0 && dy == 0.0 && dz == 0.0) {\n\t\t\t\t\treturn vec3(0.199, 0.299, 0.399);\n\t\t\t\t}\n\t\t\t\treturn normalize(vec3(dx, dy, dz));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\t${JN.getxyzi}    // get xi yi zi from 2d\n\n\t\t\t\tvec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel\n\n\t\t\t\tif (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {\n\t\t\t\t\tpc_FragColor = vec4(normal, 0.);\n\t\t\t\t\tnumTris = vec4(0.);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfloat\n\t\t\t\t\tf000 = look(xi, yi, zi, potentialPassTexture).r,\n\t\t\t\t\tf100 = look(xi+1., yi, zi, potentialPassTexture).r,\n\t\t\t\t\tf010 = look(xi, yi+1., zi, potentialPassTexture).r,\n\t\t\t\t\tf110 = look(xi+1., yi+1., zi, potentialPassTexture).r,\n\t\t\t\t\tf001 = look(xi, yi, zi+1., potentialPassTexture).r,\n\t\t\t\t\tf101 = look(xi+1., yi, zi+1., potentialPassTexture).r,\n\t\t\t\t\tf011 = look(xi, yi+1., zi+1., potentialPassTexture).r,\n\t\t\t\t\tf111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;\n\t\t\t\tfloat key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);\n\n\t\t\t\tpc_FragColor = vec4(normal, key);\n\n\t\t\t\tnumTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));\n\t\t\t}\n\t\t`;return new XN({name:"VoxelPass",fragmentShader:e,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(e){let t=`\n\t\t#ifdef SHAPEBLEND \n\t\t\tprecision highp sampler2D;\n\n\t\t\tuniform float isol;\n\n\t\t\tuniform sampler2D triTable;     // 256 x 16\n\t\t\tuniform sampler2D pyramidTexture1;\n\t\t\tuniform vec2 pyramidTexture1Size;\n\t\t\tuniform sampler2D pyramidTexture2;\n\t\t\tuniform vec2 pyramidTexture2Size;\n\n\t\t\tconst vec2 halfPixelOffset = vec2(0.5, 0.5);\n\n\t\t\tconst vec2 rShift = vec2(0., 1.);\n\t\t\tconst vec2 gShift = vec2(1., 1.);\n\t\t\tconst vec2 bShift = vec2(1., 0.);\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\n\t\t\tconst float scale_factor = 2.;\n\n\t\t\t#if SHAPEBLEND == 5\n\t\t\t\tconst float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);\n\t\t\t\tconst float scale = 8. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(16.);\n\t\t\t#elif SHAPEBLEND == 7\n\t\t\t\tconst float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); \n\t\t\t\tconst float scale = 2. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(64.);\n\t\t\t#elif SHAPEBLEND == 8\n\t\t\t\tconst float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);\n\t\t\t\tconst float scale = scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(128.);\n\t\t\t#else\n\t\t\t\tconst float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);\n\t\t\t\tconst float scale = 4. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(32.);\n\t\t\t#endif\n\n\t\t\t${JN.lookup}\n\n\t\t\tconst vec3 offsets[24] = vec3[](\n\t\t\t\tvec3(0., 0., 0.), vec3(1., 0., 0.),\n\t\t\t\tvec3(1., 0., 0.), vec3(1., 1., 0.),\n\t\t\t\tvec3(0., 1., 0.), vec3(1., 1., 0.),\n\t\t\t\tvec3(0., 0., 0.), vec3(0., 1., 0.),\n\t\t\t\tvec3(0., 0., 1.), vec3(1., 0., 1.),\n\t\t\t\tvec3(1., 0., 1.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 1., 1.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 0., 1.), vec3(0., 1., 1.),\n\t\t\t\tvec3(0., 0., 0.), vec3(0., 0., 1.),\n\t\t\t\tvec3(1., 0., 0.), vec3(1., 0., 1.),\n\t\t\t\tvec3(1., 1., 0.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 1., 0.), vec3(0., 1., 1.)\n\t\t\t);\n\n\t\t\tvec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {\n\t\t\t\tvec2 xyShifted = xy;\n\t\t\t\txyShifted.x += levelOriginX;\n\t\t\t\treturn (xyShifted + halfPixelOffset) / pyramidTexture1Size;\n\t\t\t}\n\n\t\t\tvec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {\n\t\t\t\tvec2 xyShifted = xy;\n\t\t\t\txyShifted.x += levelOriginX;\n\t\t\t\treturn (xyShifted + halfPixelOffset) / pyramidTexture2Size;\n\t\t\t}\n\n\t\t\tvec4 unpackVec3ToRGBA(vec3 vec) {\n\t\t\t\tuint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding\n\t\t\t\tfloat g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255\n\t\t\t\tfloat r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; \n\t\t\n\t\t\t\treturn vec4(r, g, vec.y, vec.z);\n\t\t\t}\n\n\t\t\tout vec4 marchColor;\n\t\t\t// end of marchvertPre\n\t\t#endif\n\t\t`;e.vertexShader=t+e.vertexShader.replace("#include <project_vertex>","\n\t\t#ifdef SHAPEBLEND\n\t\t\tfloat triIndex = floor(float(gl_VertexID/3));\n\t\t\tfloat vertexIndex = float(gl_VertexID);\n\t\t\t\n\t\t\t// Initial pyramid lookup\n\t\t\tfloat levelOriginX1 = pyramidTexture1Size.x - 2.;\n\t\t\tfloat levelOriginX2 = pyramidTexture2Size.x - 1.;\n\t\t\tvec2 xy = vec2(0.);\n\t\t\tvec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));\n\t\t\t\n\t\t\t// Early exit check\n\t\t\tif (triIndex >= lookUp.r) return;\n\t\t\t\n\t\t\t// Optimize loop variables\n\t\t\tfloat start = 0.;\n\t\t\tvec4 triIndexVec = vec4(triIndex);\n\t\t\t\n\t\t\t// Main position computation loop\n\t\t\tfor (int i = 0; i < LOOP;) {\n\t\t\t\t// Compute boundaries\n\t\t\t\tvec4 ends = lookUp + vec4(start);\n\t\t\t\tvec4 starts = vec4(ends.gba, start);\n\t\t\t\tvec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * \n\t\t\t\t\t\t\t\t\t\t\tvec4(lessThan(triIndexVec, ends));\n\t\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t\tlevelOriginX2 -= levelShiftX[i];\n\t\t\t\t\n\t\t\t\t// Update lookup\n\t\t\t\tlookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));\n\t\t\t\ti++;\n\n\t\t\t\tends = lookUp + vec4(start);\n\t\t\t\tstarts = vec4(ends.gba, start);\n\t\t\t\tcheck = vec4(greaterThanEqual(triIndexVec, starts)) * \n\t\t\t\t\t\t\t\t\t\t\tvec4(lessThan(triIndexVec, ends));\n\t\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t\tlevelOriginX1 -= levelShiftX[i];\n\t\t\t\t\n\t\t\t\t// Update lookup\n\t\t\t\tlookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));\n\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t#if HALF == 1\n\t\t\t\tvec4 ends = lookUp + vec4(start);\n\t\t\t\tvec4 starts = vec4(ends.gba, start);\n\t\t\t\tvec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));\n\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t#endif\n\t\t\t\n\t\t\t// Compute final coordinates\n\t\t\tvec3 gridPos;\n\t\t\tgridPos.x = mod(xy.x, VOXEL_RESOLUTION);\n\t\t\tgridPos.y = mod(xy.y, VOXEL_RESOLUTION);\n\t\t\tgridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + \n\t\t\t\t\t\t\t\t\tfloor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;\n\t\t\t\n\t\t\t// Vertex key computation\n\t\t\tvertexIndex -= start * 3.;\n\t\t\tfloat vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32\n\t\t\t\n\t\t\t// Voxel lookup and edge computation\n\t\t\tvec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);\n\t\t\tfloat key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256\n\t\t\t\n\t\t\t// Edge lookup and offset computation\n\t\t\tfloat edgeNum = texture(triTable, vec2(vk, key)).x;\n\t\t\tint edgeIndex = int(edgeNum) * 2;\n\t\t\t\n\t\t\t// Compute edge positions\n\t\t\tvec3 p1 = gridPos + offsets[edgeIndex];\n\t\t\tvec3 p2 = gridPos + offsets[edgeIndex + 1];\n\t\t\t\n\t\t\t// Compute potentials and normals\n\t\t\tvec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);\n\t\t\tvec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);\n\t\t\t\n\t\t\t// Final position and normal computation\n\t\t\tfloat mu = potential1.r / (potential1.r - potential2.r);\n\n\t\t\tmarchColor = mix(\n\t\t\t\tunpackVec3ToRGBA(potential1.gba),\n\t\t\t\tunpackVec3ToRGBA(potential2.gba),\n\t\t\t\tmu\n\t\t\t);\n\n\t\t\ttransformed = p1 + (p2 - p1) * mu;\n\t\t\ttransformed -= originOffset;\n\t\t\ttransformed *= scale;\n\t\t\tvec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);\n\t\t\tvec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);\n\t\t\tobjectNormal = normalize(mix(data1.xyz, data2.xyz, mu));\n\t\t\ttransformedNormal = normalMatrix * objectNormal;\n\t\t\t#ifndef FLAT_SHADED\n\t\t\t\tvNormal = transformedNormal;\n\t\t\t#endif\n\t\t#endif\n\t\t\n#include <project_vertex>");let i=e.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!i)return;let n=`\n\t\t#ifdef SHAPEBLEND_C\n\t\t\t#if SHAPEBLEND_C == 1\n\t\t\t\t${i[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}\n\t\t\t#else\n\t\t\t\t${i[0]}\n\t\t\t#endif\n\t\t#else\n\t\t\t${i[0]}\n\t\t#endif\n\t\t`;e.fragmentShader="in vec4 marchColor;\n"+e.fragmentShader.replace(i[0],n),Object.assign(e.uniforms,this.marchPassUniforms)}initDebugPass(e){console.log("fboToDebug.width",e.width,e.height),this.geometry=new ts(e.width,e.height),this.geometry.userData={parameters:{width:4,height:4}};let t={inputTexture:{value:Array.isArray(e.texture)?e.texture[1]:e.texture},pyramidTextureSize:{value:void 0}},i=e=>{e.vertexShader="\n\t\t\t\tprecision highp float;\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\t\tvUv = uv;\n\t\t\t\t}\n\t\t\t",e.fragmentShader="\n\t\t\t\tlayout(location = 1) out vec4 gVelocity;\n\n\t\t\t\tprecision highp float;\n\t\t\t\t\n\t\t\t\tuniform sampler2D inputTexture;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tuniform vec2 pyramidTextureSize;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\t\t// Sample the input texture using UV coordinates\n\t\t\t\t\t\tgl_FragColor = texture(inputTexture, vUv);\n\t\t\t\t\t\tgVelocity = vec4(0.0);\n\t\t\t\t}\n\t\t\t",t.pyramidTextureSize.value=new pi(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(e.uniforms,t)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},$N=ZN;$N.streamCompaction=new class{constructor(){this.pyramidPassScene=new No,this.pyramidPassMaterial=new XN({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);this.pyramidPassMaterial.fragmentShader="\n\t\t\tprecision highp float;\n\t\t\tprecision highp sampler2D;\n\t\t\tlayout(location = 0) out vec4 pc_FragColor;\n\t\t\tuniform sampler2D inputTexture;\n\t\t\tuniform float inputWidth;\n\t\t\tuniform float inputHeight;\n\t\t\tuniform float inputShiftX;\n\t\t\tuniform float outputShiftX;\n\t\t\tconst vec2 half_unit_coord = vec2(0.5);\n\t\t\tconst vec4 one = vec4(1.0);\n\t\t\tvoid main() {\n\t\t\t\tvec2 inputSize = vec2(inputWidth, inputHeight);\n\t\t\t\tvec2 input_pixel_uv = 1. / inputSize;\n\t\t\t\tvec2 coord = gl_FragCoord.xy - half_unit_coord;\n\t\t\t\tcoord.x -= outputShiftX;\n\t\t\t\tcoord = coord * 2. + half_unit_coord;\n\t\t\t\tcoord.x += inputShiftX;\n\n\t\t\t\t// sample bottom left corner\n\t\t\t\tvec2 input_uv = coord / inputSize;\n\t\t\t\tfloat bl = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample bottom right corner\n\t\t\t\tinput_uv.x += input_pixel_uv.x;\n\t\t\t\tfloat br = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample top right corner\n\t\t\t\tinput_uv.y += input_pixel_uv.y;\n\t\t\t\tfloat tr = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample top left corner\n\t\t\t\tinput_uv.x -= input_pixel_uv.x;\n\t\t\t\tfloat tl = texture(inputTexture, input_uv).r;\n\n\t\t\t\tpc_FragColor.a = bl;\n\t\t\t\tpc_FragColor.b = pc_FragColor.a + br;\n\t\t\t\tpc_FragColor.g = pc_FragColor.b + tr;\n\t\t\t\tpc_FragColor.r = pc_FragColor.g + tl; \n\t\t\t}\n\t\t",this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let e=new Rr(qN,this.pyramidPassMaterial);e.frustumCulled=!1,this.pyramidPassScene.add(e)}renderPyramid(e,t,i,n,r){(new Ih).min.setScalar(0);let s=t.length-1,a=new ki;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let c=o;c>=0;c--){let s=c%2===o%2?r[0]:r[1],a=c===o?n:c%2===o%2?r[1]:r[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(a.texture)?a.texture[1]:a.texture,this.pyramidPassUniforms.inputWidth.value=a.width,this.pyramidPassUniforms.inputHeight.value=a.height,i.setRenderTarget(s);let l=t[c],h=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/h,0,l/h,l/h),2===c&&e%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/h,0,3/h,3/h),i.render(this.pyramidPassScene,YN);let d=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=d,c<o&&(this.pyramidPassUniforms.outputShiftX.value+=t[c+1])}i.setViewport(a);let l=t.length%2===0?0:1;return i.readRenderTargetPixelsAsync(r[l],r[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then((()=>this.pyramidTopLevelReadPixelBuffer[0]))}};var ek=new bn,tk=new bn,ik=new ji,nk=new Vi,rk=new Vi,sk=new ji;function ak(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.children.length;for(;i--;){let n=this.children[i];r_.is(n)&&ok.call(n,e,t+1)}}function ok(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t)){let i=this.children.length;for(;i--;){let n=this.children[i];r_.is(n)&&ok.call(n,e,t+1)}}}function lk(){if(void 0===this.shapesDataTexture.value){let e=new jo(new Float32Array(1920),KN,5,Qe,ze);this.shapesDataTexture.value=e}let e=this.shapesDataTexture.value,t=e.image.data;e.needsUpdate=!0;let i=0,n=this.data.geometry.blendRange,r=ek.copy(this.matrixWorld).invert(),s=0;ak.call(this,(e=>{if(!1===e.visible)return!0;let a;if(e instanceof PR)return;if(e instanceof dB||e instanceof HN)return;a=e instanceof f_?e.object:e;let o=e.data?.cloner;if(d_.is(e)&&o&&!o.hideBase&&"radial"!==o.type&&!0!==o.disabled||!(a instanceof jD))return;let l=a.geometry.userData.parameters,c=l.shapeBlendNode;if(void 0===c)return;if(tk.multiplyMatrices(r,e.matrixWorld).decompose(rk,ik,nk),"TorusGeometry"===l.type&&360!==l.arc){let e=l.arc*Math.PI/180;e/=4,ik.multiply(sk.set(0,0,Math.sin(e),Math.cos(e)))}let h=c.overrideGlobalBlend?c.blendRange:n;h=h/this.bboxSize*2,t[4*s]=(rk.x-this.bboxOffset)/this.bboxSize*2,t[4*s+1]=(rk.y-this.bboxOffset)/this.bboxSize*2,t[4*s+2]=(rk.z-this.bboxOffset)/this.bboxSize*2,t[4*s+3]=0===c.operation?1:2===c.operation?-1:-2,t[384+4*s]=-ik.x,t[384+4*s+1]=-ik.y,t[384+4*s+2]=-ik.z,t[384+4*s+3]=ik.w;let d=new Float32Array(4),u=0;if("SphereGeometry"===l.type)l.width===l.height&&l.width===l.depth?d[0]=0:d[0]=1,d[1]=l.width/this.bboxSize,d[2]=l.height/this.bboxSize,d[3]=l.depth/this.bboxSize,i=Math.max(i,d[1]*nk.x+h,d[2]*nk.x+h,d[3]*nk.x+h);else if("CubeGeometry"===l.type){u=l.cornerRadius;let e=l.width,t=l.height,n=l.depth;d[0]=2,d[1]=(e-2*u)/this.bboxSize,d[2]=(t-2*u)/this.bboxSize,d[3]=(n-2*u)/this.bboxSize,i=Math.max(i,Math.sqrt(e**2+t**2+n**2)/this.bboxSize*nk.x+h)}else if("CylinderGeometry"===l.type){u=l.cornerRadius;let e=l.height,t=l.radiusBottom,n=l.radiusTop;if(n>=t){let i=Math.atan2(n-t,e),r=(Math.PI/2-i)/2;n-=u/Math.tan(r),t-=u*Math.tan(r)}else if(t>n){let i=Math.atan2(t-n,e),r=(Math.PI/2-i)/2;n-=u*Math.tan(r),t-=u/Math.tan(r)}d[1]=(l.height-2*u)/this.bboxSize,t===n?(d[0]=3,d[2]=t/this.bboxSize*2):(d[0]=4,d[2]=t/this.bboxSize*2,d[3]=n/this.bboxSize*2),i=Math.max(i,4*d[1]*nk.x+h)}else if("TorusGeometry"===l.type){if(d[0]=5,d[1]=(l.width-l.depth)/this.bboxSize,d[2]=l.depth/this.bboxSize,360!==l.arc){d[0]=6,d[3]=d[1],t[1152+4*s+3]=d[2];let e=2*Math.atan2(d[2]/2,d[1]),i=l.arc*Math.PI/180/2-e;d[1]=Math.sin(i),d[2]=Math.cos(i)}i=Math.max(i,l.width*nk.x/this.bboxSize+h)}t.set(d,768+4*s),t[1152+4*s]=h,t[1152+4*s+1]=u/this.bboxSize*2,t[1152+4*s+2]=nk.x;let p=a.material,f=p.uniforms.nodeU0.node.value,m=p.uniforms.nodeU1.value;0!==c.operation&&!c.useColor&&(m=-1),t[1536+4*s]=f.r,t[1536+4*s+1]=f.g,t[1536+4*s+2]=f.b,t[1536+4*s+3]=m,m<1&&1===this.material.defines.SHAPEBLEND_C&&(this.material.transparent=!0),s++})),this.npart=s,this.spatialPassUniforms.span.value=1.4*i}var ck=512;function hk(e,t){let i=!1,n=e.layers.mask&ck,r=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),r.length>0&&e.layers.enable(3),i=!0,GD(e),VD(e)),0===r.length&&0===s.length&&e.layers.set(0),n&&e.layers.set(9),e instanceof OD&&e.needsAO&&e.layers.enable(5),i}function dk(e,t){if(!t.layers)return!1;let i=e.layers.mask&ck,n=!1,r=t.getLayersOfType("transmission").filter((e=>e.data.visible)),s=t.getLayersOfType("outline").filter((e=>e.data.visible));return r.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),n=!0),0===r.length&&0===s.length&&e.layers.set(0),i&&e.layers.set(9),e.needsAO&&e.layers.enable(5),n}var uk=new _h,pk=new bn,fk=new yn;function mk(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=e.cloner;if(r)for(let s of r.children){let r=pk.copy(s.matrixWorld).invert(),a=fk.copy(t.ray).applyMatrix4(r),o=e.matrixWorld;a.applyMatrix4(o);let l=uk;l.set(a.origin,a.direction),l.near=t.near,l.far=t.far;let c=l.intersectObject(e,!1);c.length>0&&i.push({...c[0],object:n?s:e})}}var gk=class{constructor(){this._constraints=new Map}setConstraint(e,t){null===t?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach(((i,n)=>{let r=[n,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),r.includes(s)){console.warn(`circular dependency detected: ${r.join(" -> ")}`);break}t.has(s)||r.push(s)}for(let a=r.length-2;a>=0;a--)if(!t.has(r[a])){let i=e.find(r[a]);i?i.applyPathSnapping(e):console.warn(`missing entity ${r[a]}`),t.add(r[a])}}))}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},vk=class{};function yk(e){let t,i,n,r,s,a,o,l,c,h,d,u,p,f,m,g;function v(e,t,a){let o=new Float32Array(h,s,3*i);n=0;let l=new Uint32Array(h,r,i);for(let i=0;i<a.length-1;i++){let r=t[i],s=e[i].elements,c=r.filter((e=>e.enabled&&"Include"===e.mode)).map((e=>"Box"===e.type?b(e):x(e))),h=r.filter((e=>e.enabled&&"Exclude"===e.mode)).map((e=>"Box"===e.type?b(e):x(e)));for(let e=a[i];e<a[i+1];e++){let t=p[3*e],i=p[3*e+1],r=p[3*e+2];if((0===c.length||y(t,i,r,c))&&(0===h.length||!y(t,i,r,h))){let a=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);o[3*n]=(s[0]*t+s[4]*i+s[8]*r+s[12])*a,o[3*n+1]=(s[1]*t+s[5]*i+s[9]*r+s[13])*a,o[3*n+2]=(s[2]*t+s[6]*i+s[10]*r+s[14])*a,l[n]=e,n++}}}}function y(e,t,i,n,r){return n["Intersect"===r?"every":"some"]((n=>{let r=function(e,t,i,n,r){let s=e-r[0],a=t-r[1],o=i-r[2],l=1/(n[3]*s+n[7]*a+n[11]*o+n[15]);return{x:(n[0]*s+n[4]*a+n[8]*o+n[12])*l+r[0],y:(n[1]*s+n[5]*a+n[9]*o+n[13])*l+r[1],z:(n[2]*s+n[6]*a+n[10]*o+n[14])*l+r[2]}}(e,t,i,n.invRotationMatrix,n.cropCenter);return Array.isArray(n)?function(e,t,i,n){return e>=n[0]&&e<=n[3]&&t>=n[1]&&t<=n[4]&&i>=n[2]&&i<=n[5]}(r.x,r.y,r.z,n):function(e,t,i,n){let r=(e-n.cropCenter[0])*n.invRadiusX,s=(t-n.cropCenter[1])*n.invRadiusY,a=(i-n.cropCenter[2])*n.invRadiusZ;return r*r+s*s+a*a<=1}(r.x,r.y,r.z,n)}))}function b(e){let t=e.cropSize[0]/2,i=e.cropSize[1]/2,n=e.cropSize[2]/2,r=[e.cropCenter[0]-t,e.cropCenter[1]-i,e.cropCenter[2]-n,e.cropCenter[0]+t,e.cropCenter[1]+i,e.cropCenter[2]+n],s=A(e.cropRotation);return Object.assign(r,{invRotationMatrix:s,cropCenter:e.cropCenter})}function A(e){let t=[],i=e[0]*Math.PI/180,n=e[1]*Math.PI/180,r=e[2]*Math.PI/180,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r),d=s*c,u=s*h,p=a*c,f=a*h;return t[0]=o*c,t[1]=-o*h,t[2]=l,t[4]=u+p*l,t[5]=d-f*l,t[6]=-a*o,t[8]=f-d*l,t[9]=p+u*l,t[10]=s*o,t[12]=0,t[13]=0,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,t}function x(e){let t=2/e.cropSize[0],i=2/e.cropSize[1],n=2/e.cropSize[2],r=A(e.cropRotation);return{invRadiusX:t,invRadiusY:i,invRadiusZ:n,cropCenter:e.cropCenter,invRotationMatrix:r}}e.onmessage=A=>{if(A.data.getCroppedIndexes){let t=new Uint32Array(function(e,t){let i=[],n=t.filter((e=>e.enabled&&"Include"===e.mode)).map((e=>"Box"===e.type?b(e):x(e))),r=t.filter((e=>e.enabled&&"Exclude"===e.mode)).map((e=>"Box"===e.type?b(e):x(e))),s=e.length;for(let a=0;a<s;a+=3){let t=e[a],s=e[a+1],o=e[a+2];(0===n.length||y(t,s,o,n))&&(0===r.length||!y(t,s,o,r))||i.push(a/3)}return i}(new Float32Array(A.data.positions),A.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:t},[t])}else if(A.data.positions)d=A.data.positions,p=new Float32Array(d),m=A.data.meshMatrixWorlds,g=A.data.cropsArray,f=A.data.meshIndexIntervals,v(m,g,f),e.postMessage({sortSetupComplete:!0});else if(A.data.sort||A.data.newMatrixWorlds||A.data.newCropsArray)(A.data.newMatrixWorlds||A.data.newCropsArray)&&(g=A.data.newCropsArray||g,m=A.data.newMatrixWorlds||m,v(m,g,f)),function(d){let p,f=new Float64Array(h,a,16);for(let e=0;e<16;e++)f[e]=d[e];if(n>1){t.exports.sortIndexes(r,s,c,a,o,l,u.DepthMapRange,n);let e=new Uint32Array(n);p=e.buffer,e.set(new Uint32Array(h,l,n))}else if(1===n){let e=new Uint32Array(n);e[0]=new Uint32Array(h,r,i)[0],p=e.buffer}else p=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:p},[p])}(A.data.sort.view,A.data.sort.cameraPosition);else if(A.data.init){u=A.data.init.Constants,i=A.data.init.splatCount;let n=u.BytesPerInt,d=3*u.BytesPerFloat,p=new Uint8Array(A.data.init.sorterWasmBytes),f=i*(n+d)+(i*u.BytesPerInt*2+u.DepthMapRange*u.BytesPerInt*2)+32*u.MemoryPageSize,m=Math.floor(f/u.MemoryPageSize)+1,g={module:{},env:{memory:new WebAssembly.Memory({initial:2*m,maximum:3*m,shared:!0})}};WebAssembly.compile(p).then((e=>WebAssembly.instantiate(e,g))).then((p=>{t=p,r=0,s=i*n,a=s+i*d,c=a+16*u.BytesPerFloat*2,o=c+i*u.BytesPerInt,l=o+u.DepthMapRange*u.BytesPerInt,h=g.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})}))}}}p(vk,"DepthMapRange",65536),p(vk,"MemoryPageSize",65536),p(vk,"BytesPerFloat",4),p(vk,"BytesPerInt",4);var bk=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),Ak=function(e,t,i,n){return e+(t<<8)+(i<<16)+(n<<24)},xk=new pi;function wk(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{if(!1===i.visible)return!0;"Splat"===i.type&&(t=!0)})),t}var Sk,_k,Ek,Ck=class extends Rr{constructor(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0;super(i,n),this.splatCount=t,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=i,this.material=n,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=r,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,a=Ck.buildGeomtery(t),o=Ck.buildMaterial(r);return new Ck(e,t,a,o,i,n,r,s)}static buildMaterial(e){let t={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new pi},viewport:{type:"v2",value:new pi},basisViewport:{type:"v2",value:new pi},debugColor:{type:"v3",value:new Pi},covariancesTextureSize:{type:"v2",value:new pi(1024,1024)},centersColorsTextureSize:{type:"v2",value:new pi(1024,1024)},orthoZoom:{type:"f",value:-1}};return new Ur({uniforms:t,vertexShader:"\n            precision highp float;\n            #include <common>\n\n            attribute uint splatIndex;\n\n            uniform highp sampler2D covariancesTexture;\n            uniform highp usampler2D centersColorsTexture;\n            uniform vec2 focal;\n            uniform vec2 viewport;\n            uniform vec2 basisViewport;\n            uniform vec2 covariancesTextureSize;\n            uniform vec2 centersColorsTextureSize;\n\t\t\t\t\t\tuniform highp sampler2D meshMatrixWorldsTexture;\n\t\t\t\t\t\tuniform uint meshIndexIntervals[257];\n\t\t\t\t\t\tuniform float orthoZoom;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\n            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\n            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));\n            const uvec4 shift4 = uvec4(0, 8, 16, 24);\n            vec4 uintToRGBAVec (uint u) {\n               uvec4 urgba = mask4 & u;\n               urgba = urgba >> shift4;\n               vec4 rgba = vec4(urgba) * encodeNorm4;\n               return rgba;\n            }\n\n            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {\n                vec2 samplerUV = vec2(0.0, 0.0);\n                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;\n                samplerUV.y = float(floor(d)) / dimensions.y;\n                samplerUV.x = fract(d);\n                return samplerUV;\n            }\n\n            void main () {\n                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));\n                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));\n                vColor = uintToRGBAVec(sampledCenterColor.r);\n\n                vPosition = position.xy * 2.0;\n\n\t\t\t\t\t\t\t\tuint meshIndex;\n\t\t\t\t\t\t\t\tfor (int i = 1; i < 257; i++) {\n\t\t\t\t\t\t\t\t\tif (splatIndex < meshIndexIntervals[i]) {\n\t\t\t\t\t\t\t\t\t\tmeshIndex = uint(i - 1);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat strideMulmeshIndex = float(4u*meshIndex);\n\t\t\t\t\t\t\t\tfloat meshMatrixWorldsTextureLength = float(256*4);\n\n\t\t\t\t\t\t\t\tmat4 modelMat = mat4(\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmat4 modelViewMat = viewMatrix * modelMat;\n\t\t\t\t\t\t\t\tvec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); \n                vec4 clipCenter = projectionMatrix * viewCenter;\n\n                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;\n\n                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);\n                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);\n\n                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix\n                mat3 Vrk = mat3(\n                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,\n                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,\n                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z\n                );\n                float s = 1.0 / (viewCenter.z * viewCenter.z);\n\n                mat3 W = transpose(mat3(modelViewMat));\n                mat3 T = orthoZoom > 0.0 ? W : W * mat3(\n\t\t\t\t\t\t\t\t\tfocal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,\n\t\t\t\t\t\t\t\t\t0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,\n\t\t\t\t\t\t\t\t\t0., 0., 0.\n\t\t\t\t\t\t\t\t);\n                mat3 cov2Dm = transpose(T) * Vrk * T;\n                cov2Dm[0][0] += 0.3;\n                cov2Dm[1][1] += 0.3;\n\n                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because\n                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],\n                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't\n                // need cov2Dm[1][0] because it is a symetric matrix.\n                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);\n\n                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;\n\n                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix\n                // so that we can determine the 2D basis for the splat. This is done using the method described\n                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html\n                //\n                // This is a different approach than in the original work at INRIA. In that work they compute the\n                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle\n                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance\n                // matrix (called 'conic') to determine fragment opacity.\n                float a = cov2Dv.x;\n                float d = cov2Dv.z;\n                float b = cov2Dv.y;\n                float D = a * d - b * b;\n                float trace = a + d;\n                float traceOver2 = 0.5 * trace;\n                float term2 = sqrt(trace * trace / 4.0 - D);\n                float eigenValue1 = traceOver2 + term2;\n\t\t\t\t\t\t\t\tfloat eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value\n\n                const float maxSplatSize = 1024.0;\n                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));\n                // since the eigen vectors are orthogonal, we derive the second one from the first\n                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);\n                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);\n                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);\n\n                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;\n\n\t\t\t\t\t\t\t\tif (orthoZoom > 0.0) {\n\t\t\t\t\t\t\t\t\tndcOffset *= orthoZoom;\n\t\t\t\t\t\t\t\t}\n\n                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);\n            }",fragmentShader:"\n            precision highp float;\n            #include <common>\n\n            uniform vec3 debugColor;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\t\t\t\t\t\tlayout(location = 1) out vec4 gVelocity; \n\n            void main () {\n                // compute the negative squared distance from the center of the splat to the\n                // current fragment in the splat's local space.\n                float A = -dot(vPosition, vPosition);\n                if (A < -4.0) discard;\n                vec3 color = vColor.rgb;\n                A = exp(A) * vColor.a;\n                gl_FragColor = vec4(color.rgb, A);\n\t\t\t\t\t\t\t\tgVelocity = vec4(0.0); // so it is ignored by TAA\n            }",transparent:!0,alphaTest:1,blending:N,depthTest:!0,depthWrite:!1,side:L})}static buildGeomtery(e){let t=new yr;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(12),n=new or(i,3);t.setAttribute("position",n),n.setXYZ(0,-1,-1,0),n.setXYZ(1,-1,1,0),n.setXYZ(2,1,1,0),n.setXYZ(3,1,-1,0),n.needsUpdate=!0;let r=(new rh).copy(t),s=new Uint32Array(e),a=new Wo(s,1,!1);return a.setUsage(35048),r.setAttribute("splatIndex",a),r.instanceCount=e,r}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach((e=>e.buildPreComputedBuffers())),this.covariances=new Float32Array(6*this.splatCount),this.colors=new Uint8Array(4*this.splatCount),this.centers=new Float32Array(3*this.splatCount);let e=0,t=0,i=0;for(let n of this.splatBuffers){let r=n.nsplats;this.colors.subarray(e,e+4*r).set(n.colorsA),e+=4*r,this.centers.subarray(t,t+3*r).set(n.decoded.xyz.denormDequant().data),t+=3*r,this.covariances.subarray(i,i+6*r).set(new Float32Array(n.precomputedCovarianceBufferData)),i+=6*r}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new pi(4096,1024);for(;t.x*t.y*2<6*e;)t.y*=2;let i,n,r=new pi(4096,1024);for(;r.x*r.y*4<4*e;)r.y*=2;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(t.x*t.y*2);for(let e=0;e<this.covariances.length;e++)n[e]=qh.toHalfFloat(this.covariances[e]);i=new jo(n,t.x,t.y,$e,je)}else n=new Float32Array(t.x*t.y*2),n.set(this.covariances),i=new jo(n,t.x,t.y,$e,ze);i.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=i,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(r.x*r.y*4);for(let c=0;c<e;c++){let e=4*c,t=3*c,i=4*c;s[i]=Ak(this.colors[e],this.colors[e+1],this.colors[e+2],this.colors[e+3]),s[i+1]=bk(this.centers[t]),s[i+2]=bk(this.centers[t+1]),s[i+3]=bk(this.centers[t+2])}let a=new jo(s,r.x,r.y,tt,Ue);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(r);let o=new Float32Array(4096);for(let c=0;c<this.meshMatrixWorlds.length;c++)o.set(this.meshMatrixWorlds[c].elements,16*c);let l=new jo(o,1024,1,Qe,ze);l.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=l,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:i,size:t},centerColors:{data:s,texture:a,size:r},meshMatrixWorlds:{data:o,texture:l}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,n){this.splatCount>0&&(xk.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(xk),this.material.uniforms.basisViewport.value.set(2/xk.x,2/xk.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=n,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},Mk=new Promise((e=>{Sk=e})),Tk=!1;function Ik(){if(!Tk)return _k||(_k=async function(){let e=await i.e(23).then(i.bind(i,5023));Sk(e),Tk=!0}(),_k)}Mk.then((e=>Ek=e));var Pk=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p(this,"updateView",function(){let e=new bn,t=[],i=new Vi(0,0,-1),n=new Vi(0,0,-1),r=new Vi,s=new Vi;return function(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1?arguments[1]:void 0,l=this.updateMatrixWorldsInWorkerIfNeeded(),c=this.cropsChanged();if(!a){n.set(0,0,-1).applyQuaternion(o.quaternion);let e=!1,t=!1;if(n.dot(i)<=.95&&(e=!0),s.copy(o.position).sub(r).length()>=1&&(t=!0),!e&&!t&&!l&&!c&&!this.needsInitialRender)return}this.needsInitialRender=!1,r.copy(o.position),i.copy(n),e.copy(o.matrixWorld).invert(),e.premultiply(this.dummyPerspectiveMatrix),t[0]=o.position.x,t[1]=o.position.y,t[2]=o.position.z;let h={sort:{view:e.elements,cameraPosition:t,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...l?{newMatrixWorlds:this.meshMatrixWorlds}:{},...c?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=(new bn).makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new pi;null!==this.splatMesh&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.activePage=this.scene.activePage,e.position&&(e.position=(new Vi).fromArray(e.position)),e.orientation&&(e.orientation=(new ji).fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity((e=>{"Splat"===e.data.type&&t.push(e)})),this.splatMesh&&this.splatMesh.dispose(),0===t.length)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map((e=>e.matrixWorld)),this.meshMatrixWorldsOld=t.map((e=>e.matrixWorld.clone())),this.cropsArray=t.map((e=>e.data.crops.map((e=>e.data))));let i=t.map((e=>new Ek.GSplineBuffer(new Uint8Array(e.data.buffer).buffer))),n=0,r=[0];for(let s of i)n+=s.getSplatCount(),r.push(n);return this.setupSplatMesh(i,n,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,r,this.meshMatrixWorlds),this.setupSortWorker(n),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,16*t);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,!this.meshMatrixWorlds.every(((e,t)=>e.equals(this.meshMatrixWorldsOld[t])))&&(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map((e=>e.clone())),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach(((t,i)=>{t.data.crops.forEach(((t,n)=>{void 0===this.cropsArray[i][n]?(e=!0,this.cropsArray[i][n]=t.data):Object.entries(t.data).forEach((t=>{let[r,s]=t;(Array.isArray(s)&&s.some(((e,t)=>e!==this.cropsArray[i][n][r][t]))||s!==this.cropsArray[i][n]?.[r])&&(e=!0,this.cropsArray[i][n][r]=s)}))})),t.data.crops.length!==this.cropsArray[i]?.length&&(this.cropsArray[i].length=t.data.crops.length,e=!0)})),e}setupSplatMesh(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Vi,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ji,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0;this.splatMesh=Ck.buildMesh(e,t,r,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(n),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(e,t,i)=>this.update(e,i)}setupSortWorker(e){this.sortWorker=function(e){let t=new Worker(URL.createObjectURL(new Blob(["(",yk.toString(),")(self)"],{type:"application/javascript"}))),i=atob("AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL"),n=new Uint8Array(i.length);for(let r=0;r<i.length;r++)n[r]=i.charCodeAt(r);return t.postMessage({init:{sorterWasmBytes:n.buffer,splatCount:e,Constants:{BytesPerFloat:vk.BytesPerFloat,BytesPerInt:vk.BytesPerInt,DepthMapRange:vk.DepthMapRange,MemoryPageSize:vk.MemoryPageSize}}}),t}(e),this.sortWorker.onmessage=e=>{e.data.sortDone?(this.sortRunning=!1,this.splatMesh?.updateIndexes(new Uint32Array(e.data.indexesBuffer)),this.lastSortTime=e.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):e.data.sortCanceled?this.sortRunning=!1:e.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):e.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){null!==this.splatMesh&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},Dk=new rr;Dk.wireframe=!0;var Rk=new Vi,Bk=class extends No{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new gk,this.invisibleObjects=new hB("jflkdsafjasdifjaslk",{...px.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new xN("fdasfa",{...wx.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=function(e){let t=!1;return e.traverseEntity((e=>{if(e instanceof OD)if(Array.isArray(e.material))for(let i=0;i<e.material.length;i++)dk(e,e.material[i])&&(t=!0);else dk(e,e.material)&&(t=!0)})),t}(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=function(e){let t=!1;return e.traverseEntity((e=>{if(e instanceof OD)if(Array.isArray(e.material))for(let i=0;i<e.material.length;i++)hk(e,e.material[i])&&(t=!0);else hk(e,e.material)&&(t=!0)})),t}(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof xN&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(void 0===t)return;let i=[],n=t;for(;n!==this;){let e=n;n=n.parent;let t=n.children.indexOf(e);i.splice(0,0,t)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let e=this.getWithSortKey(i.id);void 0!==e&&t.push(e)}return t.sort(((e,t)=>Qg(e.sortKey,t.sortKey))),t.map((e=>e.entity))}nonExistOrDescendantOf(e,t){let i=this.find(e);if(void 0===i)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if("f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera"===e)return this.activePage.personalCamera;if(e===xA)return this.activePage.personalCamera}if(""===e||void 0===e)return;let t=this.entityByUuid[e];return void 0===t?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof xN&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof xN&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity((i=>{void 0===t&&i instanceof DN&&(t=i.uiCanvas.find(e))})),t}traverse2D(e){for(let t of this.children)t instanceof xN&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);t?Array.isArray(t.identity)&&void 0===this.findInstance(t.identity)&&console.error("not found instance"):console.error("not found")}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors((e=>{this.toExpandCloner.add(e)}))}doPendingExpandCloner(){this.toExpandCloner.forEach((e=>{e.expandCloner(this)})),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach((e=>{e.cloner?.update()})),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach((e=>e())),this.pendingCommands.length=0}updateByLibOp(e,t){1===e.path.length&&"components"===e.path[0]&&1===e.type&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){if(0===e.path.length&&7===e.type){let i=null===e.parent?this:this.find(e.parent);if(void 0===i)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,i,e.localIndex,t);n.updateVisible(this),n.resetBBoxNeedsUpdate(),iB(n)&&nB(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(0===e.path.length&&8===e.type){let t=this.find(e.id);if(void 0===t)throw new Error("unexpected");t.traverseEntity((e=>{e instanceof $N&&(this.shapeBlendIntances=this.shapeBlendIntances.filter((t=>t!==e)))})),this.markToExpandCloner(t),t.resetBBoxNeedsUpdate(),this.unregisterObject(t);let i=t.parent;this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(t),this.markPenumbraSizeDirty(),t.parent.remove(t),nB(t.parent)&&(t.parent.invalidateUpstreamBooleanData(),t.parent.invalidateDownstreamBooleanData().recomputeBoolean()),iB(t)&&(t.freeBooleanPointer(),i instanceof eB&&i.invalidateDownstreamBooleanData().recomputeBoolean()),t instanceof _N&&t.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(t),this.pathConstraints.removeDependencies(t.uuid),t.updatePathSnapping()}else if(0===e.path.length&&9===e.type){let t=this.find(e.id);if(void 0===t)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(t);let i=t.parent;this.markNeedsRecomputeInstancesForAncessors(i),t.cloner?.resetOnMove(),this.markToExpandCloner(t);let n=null===e.parent?this:this.find(e.parent);if(void 0===n)throw new Error("unexpected");n.add(t),this.markNeedsRecomputeInstancesForAncessors(n),this.markToExpandCloner(t),t.invalidateClonerTransform(t),t.updateVisible(this),t.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let r=e.localIndex;n.children.splice(r,0,n.children.pop()),iB(t)&&(t.invalidateUpstreamBooleanData(),nB(t.parent)?t.parent.invalidateDownstreamBooleanData().recomputeBoolean():i instanceof eB&&i.invalidateDownstreamBooleanData().recomputeBoolean()),t.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let t of this.children)t instanceof xN&&(t.visible=t.uuid===e,t.visible&&(this.activePage=t,this.activePage.onActive(this)));this.activePage!==this.splatViewer?.activePage&&this.reloadSplats()}updateEntityByOp(e,t,i,n){if(0===t.type){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:e}=t.props;t={...t,props:e},this.markNeedsRecomputeInstances()}"pathSnapping"===t.path[0]&&void 0!==t.props.pathId&&this.pathConstraints.setConstraint(e,t.props.pathId)}let r=this.find(e);if(r)try{(function(e,t,i,n){e.updateByOp(t,i,n,!1)})(r,t,i,{scene:this,shared:n}),r instanceof jD&&r.updateGeometryGroupsIfNeeded()}catch(nA){console.error(nA)}}updateEntity2DByOp(e,t,i,n,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];e.updateEntityByOp(t,i,n,r),this.traverseEntity((e=>{(e instanceof DN||e instanceof xN)&&(s.includes(e.frameId??"")||e.frameId===t)&&e.updateEntity2DByOp(t,i,n,r)}))}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map(((e,t)=>({data:e[1].asset.data,children:e[1].asset.children,id:e[0],fi:t})));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity((e=>{e instanceof YR&&e.updateUp()})),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity((e=>{("Component"===e.data.type||"Instance"===e.data.type)&&this.markNeedsRecomputeInstances()}))}markNeedsRecomputeInstancesForAncessors(e){d_.is(e)&&("Component"===e.data.type&&this.markNeedsRecomputeInstances(),e.traverseAncestors((e=>{d_.is(e)&&"Component"===e.data.type&&this.markNeedsRecomputeInstances()})))}relativeizeInner(e,t,i,n,r,s,a){if(e){let o=n.find(e);o&&o!==n&&r.forInstancesRec((n=>{n.data=ey(n.data,(r=>{let o=r.events.data(a.id),l=n.goUp(s);if(l){let n=[...Wg(l.identity),e].join("-"),r=this.entityIdentityToEntity[n];if(r){let e=r.uuid;Kv.zoom(o,t)[i]=e}else console.warn("cannot find instance")}})).data}))}}rewriteActions(e,t,i,n,r,s){e.forEach((e=>{"Transition"===e.data.type||"Animation"===e.data.type?this.relativeizeInner(e.data.object,[...t,e.id],"object",i,n,r,s):"Conditional"===e.data.type&&(this.rewriteActions(e.data.ifActions,[...t,e.id,"ifActions"],i,n,r,s),this.rewriteActions(e.data.elseActions,[...t,e.id,"elseActions"],i,n,r,s))}))}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity((e=>{if(e instanceof CN&&"string"==typeof e.identity&&"Component"===e.data.type)return e.traverseEntity(((t,i)=>{t.data.events.forEach((n=>{if("GameControl"===n.data.type){let r=!1;if(t.forInstancesRec((e=>{e.data=ey(e.data,(t=>{e.isInstanceRoot||(t.events.delete(n.id),r=!0)})).data})),!1===r)for(let s of jx.list)this.rewriteActions(n.data.gameActions[s],["gameActions",s],e,t,i,n)}else"Conditional"===n.data.type?("Distance"===n.data.condition.type?(this.relativeizeInner(n.data.condition.fromObject,["condition"],"fromObject",e,t,i,n),this.relativeizeInner(n.data.condition.toObject,["condition"],"toObject",e,t,i,n)):"State"===n.data.condition.type?this.relativeizeInner(n.data.condition.object,["condition"],"object",e,t,i,n):"Comparison"===n.data.condition.type&&("Property"===n.data.condition.lOperand.type&&this.relativeizeInner(n.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,n),"Property"===n.data.condition.rOperand.type&&this.relativeizeInner(n.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,n)),this.rewriteActions(n.data.inActions,["inActions"],e,t,i,n),this.rewriteActions(n.data.outActions,["outActions"],e,t,i,n)):"actions"in n.data&&this.rewriteActions(n.data.actions,["actions"],e,t,i,n)}))})),!0}))}expandInstances(e,t,i){let n=new Set;this.traverseEntity((r=>{if(r instanceof CN&&r.isInstanceRoot)return r.expandInstanceChildren({scene:this,shared:e,pendingDeletes:n}),t||r.resetBBoxNeedsUpdate(),i&&r.traverseEntity((e=>{i.addClip(e)})),!0}));for(let r of n)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),MN(r)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity((e=>{e instanceof CN&&e.isInstanceRoot&&(e.component=void 0)})),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity((e=>{let t="string"==typeof e.identity?e.identity:e.identity.join("-");this.entityIdentityToEntity[t]===e&&(delete this.entityByUuid[e.uuid],delete this.entityIdentityToEntity[t]),e.dispose()}))}clearScene(){for(let e of this.children)d_.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],n=r=>{for(let s of r.children){let r=s.cloner;if(d_.is(s)&&!s.raycastLock&&(s.visible||r?.object.data.visible))if(!0===t&&s.isInstanceRoot){let t=[];if(e.intersectObject(s,!0,t),t.length){let e=t[0];e.object=s,e.point.applyMatrix4(e.object.matrixWorld);let n=s.matrixWorld.clone().invert();e.point.applyMatrix4(n),i.push(e)}}else(iB(s)||rB(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,i),mk(s,e,i)),n(s)}};return n(this.activePage),i}raycastWithClones(e){let t=[],i=n=>{for(let r of n.children){let n=r.cloner;d_.is(r)&&(r.visible||n?.object.data.visible)&&((iB(r)||rB(r)&&this.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),mk(r,e,t,!0)),i(r))}};return i(this),t}forEachEntity(e){for(let t of this.children)d_.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)d_.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)d_.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity((i=>{if(i instanceof jD&&"Mesh"===i.data.type&&("TextGeometry"===i.data.geometry.type||"InputGeometry"===i.data.geometry.type)&&i.data.geometry.font===e){let n=i.geometry,r=i.data.geometry;n.updateFont(e,t).then((()=>{n.update(r);let e=i.invalidateDownstreamBooleanData();nB(e)&&e.recomputeBoolean()}))}}))}traverseObject(e){for(let t of this.children)r_.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)d_.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let n=0;for(let r of e)this.createObject(r.id,r.data,r.children,t,n,i),n+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,n,r,s){let a={scene:this,shared:s},o=QN(e,t,a);return o instanceof $N&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[e]=o,n.add(o),n.children.splice(r,0,n.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(t,a),o instanceof jD&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),t.pathSnapping?.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),"Empty"===t.type&&t.animations&&o.traverseEntity((e=>{let t=e.dataPatched;if(e instanceof jD&&t.bones&&t.boneInverses){let i=t.bones.map((e=>this.find(e))),n=t.boneInverses.map((e=>(new bn).fromArray(e))),r=new Ho(i,n);e.bind(r,e.bindMatrix)}else e.matrixAutoUpdate=!0})),o}getCenter(e){let t=[];for(let n=0,r=e.length;n<r;++n){let{id:i,recursive:r}=e[n],s=this.find(i),a=r?s.recursiveBBox:s.singleBBox;t.push(...a.vertices)}let i=new Wi;return i.setFromPoints(t),i.getCenter(Rk),Rk}copyMatrixWorld(e,t){if(null===e)return void t.identity();let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){if(null===e)return void t.identity();let i=this.find(e)?.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity((t=>{if(t instanceof sT)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof GP&&e(t.material[i]);else t.material instanceof GP&&e(t.material)}))}updateViewPlaneSize(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.traverseConcreteEntity((n=>{n instanceof YR&&n.setViewplaneSize(e,t,i)}))}initializeSplatViewer(){this.splatViewer=new Pk({scene:this}),this.reloadSplats()}reloadSplats(){this.splatViewer?.loadSplat()}},Lk=(e,t)=>{let i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},Ok=e=>e*(Math.PI/180),Nk=e=>e*(180/Math.PI),kk=new Map,Fk=e=>{kk.has(e)&&clearTimeout(kk.get(e)),kk.set(e,setTimeout(e,100))},Uk=(e,t,i)=>{let n,r=t.split(/[ ,]+/g);for(let s=0;s<r.length;s+=1)n=r[s],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},zk=(e,t,i)=>{let n,r=t.split(/[ ,]+/g);for(let s=0;s<r.length;s+=1)n=r[s],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},jk=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),Vk=()=>{if(typeof window>"u")return;return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Gk=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},Hk=(e,t,i)=>{let n=Wk(e);for(let r in n)if(n.hasOwnProperty(r))if("string"==typeof t)n[r]=t+" "+i;else{let e="";for(let n=0,r=t.length;n<r;n+=1)e+=t[n]+" "+i+", ";n[r]=e.slice(0,-2)}return n},Wk=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach((function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""})),t},Qk=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},qk=(e,t)=>{if(e.length)for(let i=0,n=e.length;i<n;i+=1)t(e[i]);else t(e)};typeof window<"u"&&(Xk="ontouchstart"in window,Yk=!!window.PointerEvent,Kk=!!window.MSPointerEvent);var Xk,Yk,Kk,Jk,Zk={start:"mousedown",move:"mousemove",end:"mouseup"},$k={};function eF(){}Yk?Jk={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Kk?Jk={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:Xk?(Jk={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},$k=Zk):Jk=Zk,eF.prototype.on=function(e,t){var i,n=this,r=e.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var s=0;s<r.length;s+=1)i=r[s],n._handlers_[i]=n._handlers_[i]||[],n._handlers_[i].push(t);return n},eF.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},void 0===e?i._handlers_={}:void 0===t?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i},eF.prototype.trigger=function(e,t){var i,n=this,r=e.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var s=0;s<r.length;s+=1)i=r[s],n._handlers_[i]&&n._handlers_[i].length&&n._handlers_[i].forEach((function(e){e.call(n,{type:i,target:n},t)}))},eF.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=((e,t)=>{let i={};for(let n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i})(t.options,e))},eF.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){"function"==typeof i["on"+t]?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},Uk(e,Jk[t],i._domHandlers_[t]),$k[t]&&Uk(e,$k[t],i._domHandlers_[t]),i},eF.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},zk(e,Jk[t],i._domHandlers_[t]),$k[t]&&zk(e,$k[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var tF=eF;function iF(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=iF.id,iF.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}iF.prototype=new tF,iF.constructor=iF,iF.id=0,iF.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},iF.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=((e,t)=>{let i=Wk(e);for(let n in i)i.hasOwnProperty(n)&&(i[n]=t);return i})("borderRadius","50%"),i=Hk("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},Qk(n.el,i),"circle"===this.options.shape&&Qk(n.back,t),Qk(n.front,t),this.applyStyles(n),this},iF.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this},iF.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},iF.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},iF.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},iF.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout((function(){t.ui.el.style.opacity=1}),0),t.showTimeout=setTimeout((function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)}),t.options.fadeTime)),t},iF.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout((function(){var i="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=i,"function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)}),t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,n={};n.x=!0===i||!1!==i.x?0:t.instance.frontPosition.x,n.y=!0===i||!1!==i.y?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t},iF.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var n=i.options.fadeTime+"ms",r={};r.front=Hk("transition",["top","left"],n);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(r),i.applyStyles(s),i.restTimeout=setTimeout((function(){"function"==typeof e&&e.call(i),i.restCallback()}),i.options.fadeTime)},iF.prototype.restCallback=function(){var e=this,t={};t.front=Hk("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)},iF.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},iF.prototype.computeDirection=function(e){var t,i,n,r=e.angle.radian,s=Math.PI/4,a=Math.PI/2;if(r>s&&r<3*s&&!e.lockX?t="up":r>-s&&r<=s&&!e.lockY?t="left":r>3*-s&&r<=-s&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(i=r>-a&&r<a?"left":"right"),e.lockX||(n=r>0?"up":"down"),e.force>this.options.threshold){var o,l={};for(o in this.direction)this.direction.hasOwnProperty(o)&&(l[o]=this.direction[o]);var c={};for(o in this.direction={x:i,y:n,angle:t},e.direction=this.direction,l)l[o]===this.direction[o]&&(c[o]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+i,e),c.y||this.trigger("plain:"+n,e),c.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e};var nF=iF;function rF(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=rF.id,rF.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),("static"===i.options.mode||"semi"===i.options.mode)&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let n=getComputedStyle(i.options.zone.parentElement);return n&&"flex"===n.display&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}rF.prototype=new tF,rF.constructor=rF,rF.id=0,rF.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(e){if(void 0===e)return t[0];for(var i=0,n=t.length;i<n;i+=1)if(t[i].identifier===e)return t[i];return!1}},rF.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"},rF.prototype.begin=function(){var e=this,t=e.options;if("static"===t.mode){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}},rF.prototype.createNipple=function(e,t){var i=this,n=i.manager.scroll,r={},s=i.options,a=i.parentIsFlex?n.x:n.x+i.box.left,o=i.parentIsFlex?n.y:n.y+i.box.top;if(e.x&&e.y)r={x:e.x-a,y:e.y-o};else if(e.top||e.right||e.bottom||e.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=e.top,l.style.right=e.right,l.style.bottom=e.bottom,l.style.left=e.left,l.style.position="absolute",s.zone.appendChild(l);var c=l.getBoundingClientRect();s.zone.removeChild(l),r=e,e={x:c.left+n.x,y:c.top+n.y}}var h=new nF(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(Gk(h.ui.el,r),Gk(h.ui.front,h.frontPosition)),i.nipples.push(h),i.trigger("added "+h.identifier+":added",h),i.manager.trigger("added "+h.identifier+":added",h),i.bindNipple(h),h},rF.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},rF.prototype.bindNipple=function(e){var t,i=this,n=function(e,n){t=e.type+" "+n.id+":"+e.type,i.trigger(t,n)};e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},rF.prototype.pressureFn=function(e,t,i){var n=this,r=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval(function(){var i=e.force||e.pressure||e.webkitForce||0;i!==r&&(t.trigger("pressure",i),n.trigger("pressure "+t.identifier+":pressure",i),r=i)}.bind(n),100)},rF.prototype.onstart=function(e){var t=this,i=t.options,n=e;e=jk(e),t.updateBox();return qk(e,(function(r){t.actives.length<i.maxNumberOfNipples?t.processOnStart(r):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach((function(i){if(Object.values(n.touches).findIndex((function(e){return e.identifier===i}))<0){var r=[e[0]];r.identifier=i,t.processOnEnd(r)}})),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(r))})),t.manager.bindDocument(),!1},rF.prototype.processOnStart=function(e){var t,i=this,n=i.options,r=i.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=i.getOrCreate(r,a);o.identifier!==r&&i.manager.removeIdentifier(o.identifier),o.identifier=r;var l=function(t){t.trigger("start",t),i.trigger("start "+t.id+":start",t),t.show(),s>0&&i.pressureFn(e,t,t.identifier),i.processOnMove(e)};if((t=i.idles.indexOf(o))>=0&&i.idles.splice(t,1),i.actives.push(o),i.ids.push(o.identifier),"semi"!==n.mode)l(o);else{if(!(Lk(a,o.position)<=n.catchDistance))return o.destroy(),void i.processOnStart(e);l(o)}return o},rF.prototype.getOrCreate=function(e,t){var i,n=this,r=n.options;return/(semi|static)/.test(r.mode)?(i=n.idles[0])?(n.idles.splice(0,1),i):"semi"===r.mode?n.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):i=n.createNipple(t,e)},rF.prototype.processOnMove=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),s=t.manager.scroll;if((e=>isNaN(e.buttons)?0!==e.pressure:0!==e.buttons)(e)){if(!r)return console.error("Found zombie joystick with ID "+n),void t.manager.removeIdentifier(n);if(i.dynamicPage){var a=r.el.getBoundingClientRect();r.position={x:s.x+a.left,y:s.y+a.top}}r.identifier=n;var o=r.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=r.position.y),i.lockY&&(l.x=r.position.x);var c,h,d=Lk(l,r.position),u=((e,t)=>{let i=t.x-e.x,n=t.y-e.y;return Nk(Math.atan2(n,i))})(l,r.position),p=Ok(u),f=d/o,m={distance:d,position:l};if("circle"===r.options.shape?(c=Math.min(d,o),h=((e,t,i)=>{let n={x:0,y:0};return i=Ok(i),n.x=e.x-t*Math.cos(i),n.y=e.y-t*Math.sin(i),n})(r.position,c,u)):(h=((e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)}))(l,r.position,o),c=Lk(h,r.position)),i.follow){if(d>o){let e=l.x-h.x,i=l.y-h.y;r.position.x+=e,r.position.y+=i,r.el.style.top=r.position.y-(t.box.top+s.y)+"px",r.el.style.left=r.position.x-(t.box.left+s.x)+"px",d=Lk(l,r.position)}}else l=h,d=c;var g=l.x-r.position.x,v=l.y-r.position.y;r.frontPosition={x:g,y:v},i.dataOnly||Gk(r.ui.front,r.frontPosition);var y={identifier:r.identifier,position:l,force:f,pressure:e.force||e.pressure||e.webkitForce||0,distance:d,angle:{radian:p,degree:u},vector:{x:g/o,y:-v/o},raw:m,instance:r,lockX:i.lockX,lockY:i.lockY};(y=r.computeDirection(y)).angle={radian:Ok(180-u),degree:180-u},r.trigger("move",y),t.trigger("move "+r.id+":move",y)}else this.processOnEnd(e)},rF.prototype.processOnEnd=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),s=t.manager.removeIdentifier(r.identifier);!r||(i.dataOnly||r.hide((function(){"dynamic"===i.mode&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())})),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),t.ids.indexOf(r.identifier)>=0&&t.ids.splice(t.ids.indexOf(r.identifier),1),t.actives.indexOf(r)>=0&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(i.mode)?t.idles.push(r):t.nipples.indexOf(r)>=0&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))},rF.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()},rF.prototype.destroy=function(){var e=this;for(var t in e.unbindEvt(e.options.zone,"start"),e.nipples.forEach((function(e){e.destroy()})),e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var sF=rF;function aF(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=Vk(),t.config(e),t.prepareCollections();var i=function(){var e;t.collections.forEach((function(i){i.forEach((function(i){e=i.el.getBoundingClientRect(),i.position={x:t.scroll.x+e.left,y:t.scroll.y+e.top}}))}))};if(typeof window>"u")return t.collections;Uk(window,"resize",(function(){Fk(i)}));var n=function(){t.scroll=Vk()};return Uk(window,"scroll",(function(){Fk(n)})),t.collections}aF.prototype=new tF,aF.constructor=aF,aF.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every((function(e){return!(i=e.get(t))})),i}},aF.prototype.create=function(e){return this.createCollection(e)},aF.prototype.createCollection=function(e){var t=this,i=new sF(t,e);return t.bindCollection(i),t.collections.push(i),i},aF.prototype.bindCollection=function(e){var t,i=this,n=function(e,n){t=e.type+" "+n.id+":"+e.type,i.trigger(t,n)};e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},aF.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)},aF.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||!0===e)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)},aF.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},aF.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t},aF.prototype.onmove=function(e){return this.onAny("move",e),!1},aF.prototype.onend=function(e){return this.onAny("end",e),!1},aF.prototype.oncancel=function(e){return this.onAny("end",e),!1},aF.prototype.onAny=function(e,t){var i,n=this,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=jk(t);var s=function(e,t,i){i.ids.indexOf(t)>=0&&(i[r](e),e._found_=!0)};return qk(t,(function(e){i=n.getIdentifier(e),qk(n.collections,s.bind(null,e,i)),e._found_||n.removeIdentifier(i)})),!1},aF.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach((function(e){e.destroy()})),e.off()},aF.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var oF=new aF,lF=function(e){return oF.create(e)},cF=new Map,hF=new Map,dF=class{constructor(e,t,i,n){this.data=t;let{audio:r,volume:s,delay:a,loop:o}=t;if(!r)throw new Error("Missing property");let l="string"==typeof r?n.getAudio(r).src:r.data;this.audioPlayer=new rD({src:l,volume:s,delay:a,loop:o}),hF.has(i.uuid)?hF.get(i.uuid).push(this):hF.set(i.uuid,[this]),cF.set(e,this)}playByToggle(){"stop"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):"pause"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},uF=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=cF.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()}),this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=hF.get(e);!t?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t.forEach((e=>e.audioPlayer[this.data.interaction]())),this.disposeDelay()}),this.data.delay)):t.forEach((e=>e.audioPlayer[this.data.interaction]())))}pauseAllAudios(){let e=[...hF.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{e.forEach((e=>{e.forEach((e=>{e.audioPlayer[this.data.interaction]()}))})),this.disposeDelay()}),this.data.delay)):e.forEach((e=>{e.forEach((e=>{e.audioPlayer[this.data.interaction]()}))})))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},pF=class{constructor(e,t,i,n,r){if(this.data=t,this.shared=n,this.condition=r,"play"===t.interaction)this.interaction=new dF(e,t,i,n);else{if("pause"!==t.interaction&&"stop"!==t.interaction)throw new Error("Missing property");this.interaction=new uF(t)}}dispatchBasic(){if(!1===bz(this.shared,this.condition))return!1;this.interaction instanceof dF?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===bz(this.shared,this.condition))return!1;this.interaction instanceof dF?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(!1===bz(this.shared,this.condition))return!1;this.interaction instanceof dF&&("start"===e?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},fF=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.delay=0,this.emission=e.emission,void 0!==e.delay&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.start(0),this.clearDelay()}),e):this.particleSystem.start()}stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.stop(0),this.clearDelay()}),e):this.particleSystem.stop()}freeze(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.freeze(0),this.clearDelay()}),e):this.particleSystem.froze()}unFreeze(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.unFreeze(0),this.clearDelay()}),e):this.particleSystem.unFroze()}reset(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.reset(0),this.clearDelay()}),e):this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze()}}dispatchBasic(){if(!1===bz(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay)}}dispatchConditional(){if(!1===bz(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay)}}dispatchGameControl(e){if(!1===bz(this.shared,this.condition)||!this.particleSystem)return!1;"start"===e?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},mF=(e,t)=>t.some((t=>t instanceof RegExp?t.test(e):t===e));function gF(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return((e,t)=>{let{stripHash:i}=t,n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!n)throw new Error(`Invalid URL: ${e}`);let{type:r,data:s,hash:a}=n.groups,o=r.split(";");a=i?"":a;let l=!1;"base64"===o[o.length-1]&&(o.pop(),l=!0);let c=(o.shift()||"").toLowerCase(),h=[...o.map((e=>{let[t,i=""]=e.split("=").map((e=>e.trim()));return"charset"===t&&(i=i.toLowerCase(),"us-ascii"===i)?"":`${t}${i?`=${i}`:""}`})).filter(Boolean)];return l&&h.push("base64"),(h.length>0||c&&"text/plain"!==c)&&h.unshift(c),`data:${h.join(";")},${l?s.trim():s}${a?`#${a}`:""}`})(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let n=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&"https:"===n.protocol&&(n.protocol="http:"),t.forceHttps&&"http:"===n.protocol&&(n.protocol="https:"),t.stripAuthentication&&(n.username="",n.password=""),t.stripHash?n.hash="":t.stripTextFragment&&(n.hash=n.hash.replace(/#?:~:text.*?$/i,"")),n.pathname){let e=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,t=0,i="";for(;;){let r=e.exec(n.pathname);if(!r)break;let s=r[0],a=r.index;i+=n.pathname.slice(t,a).replace(/\/{2,}/g,"/"),i+=s,t=a+s.length}i+=n.pathname.slice(t,n.pathname.length).replace(/\/{2,}/g,"/"),n.pathname=i}if(n.pathname)try{n.pathname=decodeURI(n.pathname)}catch{}if(!0===t.removeDirectoryIndex&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let e=n.pathname.split("/"),i=e[e.length-1];mF(i,t.removeDirectoryIndex)&&(e=e.slice(0,-1),n.pathname=e.slice(1).join("/")+"/")}if(n.hostname&&(n.hostname=n.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(n.hostname)&&(n.hostname=n.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...n.searchParams.keys()])mF(s,t.removeQueryParameters)&&n.searchParams.delete(s);if(!0===t.removeQueryParameters&&(n.search=""),t.sortQueryParameters){n.searchParams.sort();try{n.search=decodeURIComponent(n.search)}catch{}}t.removeTrailingSlash&&(n.pathname=n.pathname.replace(/\/$/,""));let r=e;return e=n.toString(),!t.removeSingleSlash&&"/"===n.pathname&&!r.endsWith("/")&&""===n.hash&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||"/"===n.pathname)&&""===n.hash&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var vF=class{constructor(e,t,i,n){let{url:r,context:s}=e;if(this.controlsManager=t,this.shared=i,this.condition=n,!r)throw new Error("Missing property");this.url=r.startsWith("mailto:")?r:gF(r,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=s??"tab"}dispatch(){if(!1===bz(this.shared,this.condition))return!1;zg?window.location.assign(this.url):("tab"===this.context||Fg&&"none"===this.context?window.open(this.url,"_blank"):"window"===this.context?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),this.controlsManager.orbitControls?.onPointerUp(Xg[0]),Xg.splice(0,Xg.length))}},yF=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.controlsManager=i,this.shared=n,this.condition=r,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=e=>{this.timeoutIdQueue.shift();let t=this.page.scene.find(e);if(void 0===t)return;let i=this.controlsManager.sharedGameControlGlobals.rapierWorld,n=!i||t.dataPatched.physics?.fusedBody;if(t.cloner){for(let e of t.cloner.children)n?(e.playModeVisible=!1,e.rigidBody&&"positioned"===t.dataPatched.physics?.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),i.removeRigidBody(e.rigidBody),e.rigidBody=void 0),e.bvhGeometry&&(e.bvhGeometry=void 0)):void 0===this.clone||this.clone===e?(e.playModeVisible=!1,e.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),i.removeRigidBody(e.rigidBody),e.rigidBody=void 0)):void 0===e.playModeVisible&&(e.playModeVisible=!0);(n||void 0===this.clone||!1===this.clone)&&(t.visible=!1,t.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(t.rigidBody.collider(0).handle),i.removeRigidBody(t.rigidBody),t.rigidBody=void 0),t.bvhGeometry&&(t.bvhGeometry=void 0))}else t.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(t.rigidBody.collider(0).handle),i.removeRigidBody(t.rigidBody),t.rigidBody=void 0),t.bvhGeometry&&(t.bvhGeometry=void 0),t.visible=!1;this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=void 0===i?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter((e=>void 0!==e.bvhGeometry)):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter((e=>void 0!==e.rigidBody)),t.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(!1===bz(this.shared,this.condition))return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()}dispatchFromStart(){if(!1===bz(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))}dispose(){this.timeoutIdQueue.forEach((e=>window.clearTimeout(e)))}},bF=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.shared=i,this.eventManager=n,this.condition=r,this.shared=i}dispatch(){if(!1===bz(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout((()=>{this.shared.reset(this.shared.data,!0),ZU(this.page,this.shared,!0),this.eventManager.reset(),this.eventManager.controlsManager.gameControl?.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId}),1e3*(this.data.delay??0))}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},AF={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},xF={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},wF=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],SF={CSS:{},springs:{}};function _F(e,t,i){return Math.min(Math.max(e,t),i)}function EF(e,t){return e.indexOf(t)>-1}function CF(e,t){return e.apply(null,t)}var MF={arr:function(e){return Array.isArray(e)},obj:function(e){return EF(Object.prototype.toString.call(e),"Object")},pth:function(e){return MF.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||MF.svg(e))},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return MF.hex(e)||MF.rgb(e)||MF.hsl(e)},key:function(e){return!AF.hasOwnProperty(e)&&!xF.hasOwnProperty(e)&&"targets"!==e&&"keyframes"!==e}};function TF(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map((function(e){return parseFloat(e)})):[]}function IF(e,t){var i=TF(e),n=_F(MF.und(i[0])?1:i[0],.1,100),r=_F(MF.und(i[1])?100:i[1],.1,100),s=_F(MF.und(i[2])?10:i[2],.1,100),a=_F(MF.und(i[3])?0:i[3],.1,100),o=Math.sqrt(r/n),l=s/(2*Math.sqrt(r*n)),c=l<1?o*Math.sqrt(1-l*l):0,h=1,d=l<1?(l*o-a)/c:-a+o;function u(e){var i=t?t*e/1e3:e;return i=l<1?Math.exp(-i*l*o)*(h*Math.cos(c*i)+d*Math.sin(c*i)):(h+d*i)*Math.exp(-i*o),0===e||1===e?e:1-i}return t?u:function(){var t=SF.springs[e];if(t)return t;for(var i=1/6,n=0,r=0;;)if(1===u(n+=i)){if(++r>=16)break}else r=0;var s=n*i*1e3;return SF.springs[e]=s,s}}function PF(e){return void 0===e&&(e=10),function(t){return Math.ceil(_F(t,1e-6,1)*e)*(1/e)}}var DF=function(){var e=.1;function t(e,t){return 1-3*t+3*e}function i(e,t){return 3*t-6*e}function n(e){return 3*e}function r(e,r,s){return((t(r,s)*e+i(r,s))*e+n(r))*e}function s(e,r,s){return 3*t(r,s)*e*e+2*i(r,s)*e+n(r)}return function(t,i,n,a){if(0<=t&&t<=1&&0<=n&&n<=1){var o=new Float32Array(11);if(t!==i||n!==a)for(var l=0;l<11;++l)o[l]=r(l*e,t,n);return function(e){return t===i&&n===a||0===e||1===e?e:r(c(e),i,a)}}function c(i){for(var a=0,l=1;10!==l&&o[l]<=i;++l)a+=e;--l;var c=a+(i-o[l])/(o[l+1]-o[l])*e,h=s(c,t,n);return h>=.001?function(e,t,i,n){for(var a=0;a<4;++a){var o=s(t,i,n);if(0===o)return t;t-=(r(t,i,n)-e)/o}return t}(i,c,t,n):0===h?c:function(e,t,i,n,s){var a,o,l=0;do{(a=r(o=t+(i-t)/2,n,s)-e)>0?i=o:t=o}while(Math.abs(a)>1e-7&&++l<10);return o}(i,a,a+e,t,n)}}}(),RF=function(){var e={linear:function(){return function(e){return e}}},t={Sine:function(){return function(e){return 1-Math.cos(e*Math.PI/2)}},Circ:function(){return function(e){return 1-Math.sqrt(1-e*e)}},Back:function(){return function(e){return e*e*(3*e-2)}},Bounce:function(){return function(e){for(var t,i=4;e<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}},Elastic:function(e,t){void 0===e&&(e=1),void 0===t&&(t=.5);var i=_F(e,1,10),n=_F(t,.1,2);return function(e){return 0===e||1===e?e:-i*Math.pow(2,10*(e-1))*Math.sin((e-1-n/(2*Math.PI)*Math.asin(1/i))*(2*Math.PI)/n)}}};return["Quad","Cubic","Quart","Quint","Expo"].forEach((function(e,i){t[e]=function(){return function(e){return Math.pow(e,i+2)}}})),Object.keys(t).forEach((function(i){var n=t[i];e["easeIn"+i]=n,e["easeOut"+i]=function(e,t){return function(i){return 1-n(e,t)(1-i)}},e["easeInOut"+i]=function(e,t){return function(i){return i<.5?n(e,t)(2*i)/2:1-n(e,t)(-2*i+2)/2}}})),e}();function BF(e,t){if(MF.fnc(e))return e;var i=e.split("(")[0],n=RF[i],r=TF(e);switch(i){case"spring":return IF(e,t);case"cubicBezier":return CF(DF,r);case"steps":return CF(PF,r);default:return CF(n,r)}}function LF(e){try{return document.querySelectorAll(e)}catch{return}}function OF(e,t){for(var i=e.length,n=arguments.length>=2?arguments[1]:void 0,r=[],s=0;s<i;s++)if(s in e){var a=e[s];t.call(n,a,s,e)&&r.push(a)}return r}function NF(e){return e.reduce((function(e,t){return e.concat(MF.arr(t)?NF(t):t)}),[])}function kF(e){return MF.arr(e)?e:(MF.str(e)&&(e=LF(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function FF(e,t){return e.some((function(e){return e===t}))}function UF(e){var t={};for(var i in e)t[i]=e[i];return t}function zF(e,t){var i=UF(e);for(var n in e)i[n]=t.hasOwnProperty(n)?t[n]:e[n];return i}function jF(e,t){var i=UF(e);for(var n in t)i[n]=MF.und(e[n])?t[n]:e[n];return i}function VF(e){return MF.rgb(e)?function(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}(e):MF.hex(e)?function(e){var t=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,i,n){return t+t+i+i+n+n})),i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return"rgba("+parseInt(i[1],16)+","+parseInt(i[2],16)+","+parseInt(i[3],16)+",1)"}(e):MF.hsl(e)?function(e){var t,i,n,r=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),s=parseInt(r[1],10)/360,a=parseInt(r[2],10)/100,o=parseInt(r[3],10)/100,l=r[4]||1;function c(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}if(0==a)t=i=n=o;else{var h=o<.5?o*(1+a):o+a-o*a,d=2*o-h;t=c(d,h,s+1/3),i=c(d,h,s),n=c(d,h,s-1/3)}return"rgba("+255*t+","+255*i+","+255*n+","+l+")"}(e):void 0}function GF(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function HF(e,t){return MF.fnc(e)?e(t.target,t.id,t.total):e}function WF(e,t){return e.getAttribute(t)}function QF(e,t,i){if(FF([i,"deg","rad","turn"],GF(t)))return t;var n=SF.CSS[t+i];if(!MF.und(n))return n;var r=document.createElement(e.tagName),s=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;s.appendChild(r),r.style.position="absolute",r.style.width=100+i;var a=100/r.offsetWidth;s.removeChild(r);var o=a*parseFloat(t);return SF.CSS[t+i]=o,o}function qF(e,t,i){if(t in e.style){var n=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=e.style[t]||getComputedStyle(e).getPropertyValue(n)||"0";return i?QF(e,r,i):r}}function XF(e,t){return MF.dom(e)&&!MF.inp(e)&&(WF(e,t)||MF.svg(e)&&e[t])?"attribute":MF.dom(e)&&FF(wF,t)?"transform":MF.dom(e)&&"transform"!==t&&qF(e,t)?"css":null!=e[t]?"object":void 0}function YF(e){if(MF.dom(e)){for(var t,i=e.style.transform||"",n=/(\w+)\(([^)]*)\)/g,r=new Map;t=n.exec(i);)r.set(t[1],t[2]);return r}}function KF(e,t,i,n){var r=EF(t,"scale")?1:0+function(e){return EF(e,"translate")||"perspective"===e?"px":EF(e,"rotate")||EF(e,"skew")?"deg":void 0}(t),s=YF(e).get(t)||r;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),n?QF(e,s,n):s}function JF(e,t,i,n){switch(XF(e,t)){case"transform":return KF(e,t,n,i);case"css":return qF(e,t,i);case"attribute":return WF(e,t);default:return e[t]||0}}function ZF(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var n=GF(e)||0,r=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return r+s+n;case"-":return r-s+n;case"*":return r*s+n}}function $F(e,t){if(MF.col(e))return VF(e);if(/\s/g.test(e))return e;var i=GF(e),n=i?e.substr(0,e.length-i.length):e;return t?n+t:n}function eU(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function tU(e){for(var t,i=e.points,n=0,r=0;r<i.numberOfItems;r++){var s=i.getItem(r);r>0&&(n+=eU(t,s)),t=s}return n}function iU(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return function(e){return 2*Math.PI*WF(e,"r")}(e);case"rect":return function(e){return 2*WF(e,"width")+2*WF(e,"height")}(e);case"line":return function(e){return eU({x:WF(e,"x1"),y:WF(e,"y1")},{x:WF(e,"x2"),y:WF(e,"y2")})}(e);case"polyline":return tU(e);case"polygon":return function(e){var t=e.points;return tU(e)+eU(t.getItem(t.numberOfItems-1),t.getItem(0))}(e)}}function nU(e,t){var i=t||{},n=i.el||function(e){for(var t=e.parentNode;MF.svg(t)&&MF.svg(t.parentNode);)t=t.parentNode;return t}(e),r=n.getBoundingClientRect(),s=WF(n,"viewBox"),a=r.width,o=r.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:n,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function rU(e,t){function i(i){void 0===i&&(i=0);var n=t+i>=1?t+i:0;return e.el.getPointAtLength(n)}var n=nU(e.el,e.svg),r=i(),s=i(-1),a=i(1);switch(e.property){case"x":return(r.x-n.x)*n.w;case"y":return(r.y-n.y)*n.h;case"angle":return 180*Math.atan2(a.y-s.y,a.x-s.x)/Math.PI}}function sU(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,n=$F(MF.pth(e)?e.totalLength:e,t)+"";return{original:n,numbers:n.match(i)?n.match(i).map(Number):[0],strings:MF.str(e)||t?n.split(i):[]}}function aU(e){return OF(e?NF(MF.arr(e)?e.map(kF):kF(e)):[],(function(e,t,i){return i.indexOf(e)===t}))}function oU(e){var t=aU(e);return t.map((function(e,i){return{target:e,id:i,total:t.length,transforms:{list:YF(e)}}}))}function lU(e,t){var i=UF(t);if(/^spring/.test(i.easing)&&(i.duration=IF(i.easing)),MF.arr(e)){var n=e.length;2===n&&!MF.obj(e[0])?e={value:e}:MF.fnc(t.duration)||(i.duration=t.duration/n)}var r=MF.arr(e)?e:[e];return r.map((function(e,i){var n=MF.obj(e)&&!MF.pth(e)?e:{value:e};return MF.und(n.delay)&&(n.delay=i?0:t.delay),MF.und(n.endDelay)&&(n.endDelay=i===r.length-1?t.endDelay:0),n})).map((function(e){return jF(e,i)}))}function cU(e,t){var i=[],n=t.keyframes;for(var r in n&&(t=jF(function(e){for(var t=OF(NF(e.map((function(e){return Object.keys(e)}))),(function(e){return MF.key(e)})).reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]),i={},n=function(n){var r=t[n];i[r]=e.map((function(e){var t={};for(var i in e)MF.key(i)?i==r&&(t.value=e[i]):t[i]=e[i];return t}))},r=0;r<t.length;r++)n(r);return i}(n),t)),t)MF.key(r)&&i.push({name:r,tweens:lU(t[r],e)});return i}function hU(e,t){var i;return e.tweens.map((function(n){var r=function(e,t){var i={};for(var n in e){var r=HF(e[n],t);MF.arr(r)&&(r=r.map((function(e){return HF(e,t)})),1===r.length&&(r=r[0])),i[n]=r}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}(n,t),s=r.value,a=MF.arr(s)?s[1]:s,o=GF(a),l=JF(t.target,e.name,o,t),c=i?i.to.original:l,h=MF.arr(s)?s[0]:c,d=GF(h)||GF(l),u=o||d;return MF.und(a)&&(a=c),r.from=sU(h,u),r.to=sU(ZF(a,h),u),r.start=i?i.end:0,r.end=r.start+r.delay+r.duration+r.endDelay,r.easing=BF(r.easing,r.duration),r.isPath=MF.pth(s),r.isColor=MF.col(r.from.original),r.isColor&&(r.round=1),i=r,r}))}var dU={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,n,r){if(n.list.set(t,i),t===n.last||r){var s="";n.list.forEach((function(e,t){s+=t+"("+e+") "})),e.style.transform=s}}};function uU(e,t){oU(e).forEach((function(e){for(var i in t){var n=HF(t[i],e),r=e.target,s=GF(n),a=JF(r,i,s,e),o=ZF($F(n,s||GF(a)),a),l=XF(r,i);dU[l](r,i,o,e.transforms,!0)}}))}function pU(e,t){return OF(NF(e.map((function(e){return t.map((function(t){return function(e,t){var i=XF(e.target,t.name);if(i){var n=hU(t,e),r=n[n.length-1];return{type:i,property:t.name,animatable:e,tweens:n,duration:r.end,delay:n[0].delay,endDelay:r.endDelay}}}(e,t)}))}))),(function(e){return!MF.und(e)}))}function fU(e,t){var i=e.length,n=function(e){return e.timelineOffset?e.timelineOffset:0},r={};return r.duration=i?Math.max.apply(Math,e.map((function(e){let t=e.startOnceDelay??0,i=e.pingPongDelayCorrection??0,r=e.pingPongEndDelayCorrection??0;return n(e)+t+i+r+e.duration*(e.loop??1)}))):t.duration,r.delay=i?Math.min.apply(Math,e.map((function(e){let t=e.startOnceDelay??0,i=e.pingPongDelayCorrection??0;return n(e)+t+i+e.delay}))):t.delay,r.endDelay=i?r.duration-Math.max.apply(Math,e.map((function(e){let t=e.startOnceDelay??0,i=e.pingPongDelayCorrection??0,r=e.pingPongEndDelayCorrection??0;return n(e)+t+i+e.duration*(e.loop??1)-e.endDelay-r}))):t.endDelay,r}var mU=0;var gU,vU=[],yU=[],bU=function(){function e(){gU=requestAnimationFrame(t)}function t(t){var i=vU.length;if(i){for(var n=0;n<i;){var r=vU[n];r.paused?(vU.splice(n,1),i-=1):(r.tick(t),n++)}e()}else gU=cancelAnimationFrame(gU)}return e}();function AU(e){void 0===e&&(e={});var t,i,n=0,r=0,s=0,a=0,o=null;function l(e){var t=window.Promise&&new Promise((function(e){return o=e}));return e.finished=t,t}var c=function(e){var t=zF(AF,e),i=zF(xF,e),n=cU(i,e),r=oU(e.targets),s=pU(r,n),a=fU(s,i),o=mU;return mU++,jF(t,{id:o,children:[],animatables:r,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}(e);l(c);function h(){var e=c.direction;"alternate"!==e&&(c.direction="normal"!==e?"normal":"reverse"),c.reversed=!c.reversed,i.forEach((function(e){(1===e.loop||e.loop%2===0)&&(e.reversed=c.reversed)}))}function d(e){return c.reversed?c.duration-e:e}function u(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t&&(c.reversed?t.seek(t.duration*t.loop-(e-t.timelineOffset-t.pingPongDelayCorrection),i):t.seek(e-t.timelineOffset-t.startOnceDelay-t.pingPongDelayCorrection,i))}function p(e){var t=0,i=c.animations,n=i.length;for("alternate"!==c.direction&&"alternate"===c.parent?.direction?!1===c.parent?.rewind&&!0===c.reversePlayback&&!1===c.rewind&&(e=c.parent?.reversed&&"alternate"===c.direction?c.duration-c.delay+c.endDelay-e:c.duration+c.delay-c.endDelay-e):g(!1,c.parent?.rewind,c.rewind,c.parent?.reversePlayback,c.reversePlayback)&&(e=c.parent?.reversed&&"alternate"===c.direction?c.duration-c.delay+c.endDelay-e:c.duration+c.delay-c.endDelay-e);t<n;){var r=i[t],s=r.animatable,a=r.tweens,o=a.length-1,l=a[o];let n;o&&(l=OF(a,(function(t){return e<t.end}))[0]||l),n=c.parent?.reversed&&"alternate"===c.direction?_F(e-l.start-l.endDelay,0,l.duration)/l.duration:_F(e-l.start-l.delay,0,l.duration)/l.duration;for(var h=isNaN(n)?1:l.easing(n),d=l.to.strings,u=l.round,p=[],f=l.to.numbers.length,m=void 0,v=0;v<f;v++){var y=void 0;let e,t;"alternate"!==c.direction?!1===c.parent?.rewind&&!0===c.reversePlayback&&!1===c.rewind?(e=l.to.numbers[v],t=l.from.numbers[v]||0):(t=l.to.numbers[v],e=l.from.numbers[v]||0):g(!0,c.parent?.rewind,c.rewind,c.parent?.reversePlayback,c.reversePlayback)?(e=l.to.numbers[v],t=l.from.numbers[v]||0):(t=l.to.numbers[v],e=l.from.numbers[v]||0),y=l.isPath?rU(l.value,h*t):e+h*(t-e),u&&(l.isColor&&v>2||(y=Math.round(y*u)/u)),p.push(y)}var b=d.length;if(b){m=d[0];for(var A=0;A<b;A++){d[A];var x=d[A+1],w=p[A];isNaN(w)||(m+=x?w+x:w+" ")}}else m=p[0];dU[r.type](s.target,r.property,m,s.transforms),r.currentValue=m,t++}}function f(e){c[e]&&!c.passThrough&&c[e](c)}let m={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function g(e,t,i,n,r){return m[e<<4|t<<3|i<<2|n<<1|r]}function v(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var r=c.duration;let s=c.delay,m=r-c.endDelay;c.parent?.reversed&&"alternate"===c.direction&&(s=c.endDelay,m=r-c.delay);var g=d(e);if(c.progress=_F(g/r*100,0,100),t||(c.reversePlayback=g<c.currentTime),a&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(c.reversed)for(var n=a;n--;)u(e,i[n],t);else for(var r=0;r<a;r++)u(e,i[r],t)}(g,t),!c.began&&c.currentTime>=0&&(c.began=!0,f("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,f("loopBegin")),(c.reversed||g>=0)&&g<=s&&0!==c.currentTime&&(p(0),f("change")),(g>=m&&c.currentTime!==r+c.pingPongDelayCorrection||!r)&&(p(r),f("change")),g>s&&g<m?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,f("changeBegin")),p(g),f("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,f("change"),a&&f("timelineChangeComplete")):c.began&&g>m&&f("changeComplete"),c.currentTime=_F(g,0,r+c.pingPongDelayCorrection),c.began&&f("update"),e>=r)if(c.remaining&&!0!==c.remaining&&c.remaining--,c.remaining){n+=a?c.duration/AU.speed:c.duration;for(let e of i)e.setStartTime(0),e.remaining=e.loop;f("loopComplete"),c.loopBegan=!1,"alternate"===c.direction?h():a&&(c.direction="normal",c.reversed=!1,i.forEach((function(e){return e.reversed=!1})))}else c.paused=!0,c.completed||(c.completed=!0,f("loopComplete"),f("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)))}return c.reset=function(){var e=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed="reverse"===e,c.remaining=c.loop,i=c.children;for(var t=a=i.length;t--;)c.children[t].reset();p(c.reversed?c.duration:0)},c.setStartTime=function(e){n=e},c.set=function(e,t){return uU(e,t),c},c.tick=function(e){s=e,n||(n=s),v((s+(r-n))*AU.speed)},c.seek=function(e){v(e-n,arguments.length>1&&void 0!==arguments[1]&&arguments[1])},c.pause=function(e){c.paused=!0,a&&(t=e??performance.now())},c.play=function(e){!c.paused||(c.completed&&c.reset(),c.paused=!1,vU.push(c),a&&void 0!==t&&(n+=(e??performance.now())-t),gU||bU())},c.reverse=function(){h(),c.completed=!c.reversed,n=0,r=d(c.currentTime)*(1/AU.speed)},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function xU(e,t){for(var i=t.length;i--;)FF(e,t[i].animatable.target)&&t.splice(i,1)}typeof document<"u"&&document.addEventListener("visibilitychange",(function(e){document.hidden?(vU.forEach((function(t){return t.pause(e.timeStamp)})),yU=vU.slice(0),AU.running=vU=[]):yU.forEach((function(t){return t.play(e.timeStamp)}))})),AU.version="3.2.0",AU.speed=1,AU.running=vU,AU.remove=function(e){for(var t=aU(e),i=vU.length;i--;){var n=vU[i],r=n.animations,s=n.children;xU(t,r);for(var a=s.length;a--;){var o=s[a],l=o.animations;xU(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!r.length&&!s.length&&n.pause()}},AU.get=JF,AU.set=uU,AU.convertPx=QF,AU.path=function(e,t){var i=MF.str(e)?LF(e)[0]:e,n=t||100;return function(e){return{property:e,el:i,svg:nU(i),totalLength:iU(i)*(n/100)}}},AU.setDashoffset=function(e){var t=iU(e);return e.setAttribute("stroke-dasharray",t),t},AU.stagger=function(e,t){void 0===t&&(t={});var i=t.direction||"normal",n=t.easing?BF(t.easing):null,r=t.grid,s=t.axis,a=t.from||0,o="first"===a,l="center"===a,c="last"===a,h=MF.arr(e),d=parseFloat(h?e[0]:e),u=h?parseFloat(e[1]):0,p=GF(h?e[1]:e)||0,f=t.start||0+(h?d:0),m=[],g=0;return function(e,t,v){if(o&&(a=0),l&&(a=(v-1)/2),c&&(a=v-1),!m.length){for(var y=0;y<v;y++){if(r){var b=l?(r[0]-1)/2:a%r[0],A=l?(r[1]-1)/2:Math.floor(a/r[0]),x=b-y%r[0],w=A-Math.floor(y/r[0]),S=Math.sqrt(x*x+w*w);"x"===s&&(S=-x),"y"===s&&(S=-w),m.push(S)}else m.push(Math.abs(a-y));g=Math.max.apply(Math,m)}n&&(m=m.map((function(e){return n(e/g)*g}))),"reverse"===i&&(m=m.map((function(e){return s?e<0?-1*e:-e:Math.abs(g-e)})))}return f+(h?(u-d)/g:d)*(Math.round(100*m[t])/100)+p}},AU.timeline=function(e){void 0===e&&(e={});var t=AU(e);return t.duration=0,t.add=function(i,n){var r=vU.indexOf(t),s=t.children;function a(e){e.passThrough=!0}r>-1&&vU.splice(r,1);for(var o=0;o<s.length;o++)a(s[o]);var l=jF(i,zF(xF,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=MF.und(n)?c:ZF(n,c),a(t);var h=AU(l);a(h),s.push(h),h.parent=t;var d=fU(s,e);return t.delay=d.delay,t.endDelay=d.endDelay,t.duration=d.duration,!0===h.loop&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t},AU.easing=BF,AU.penner=RF,AU.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var wU=AU,SU=new Vi,_U=new Vi,EU=new ji;function CU(e,t,i,n,r,s){let a=void 0!==i[e]?i[e]:void 0,o=n[e];if(null==o)return;let l=null!=a?"string"==typeof a?Number(r.getVariable(a)??0):a:t[e],c="string"==typeof o?Number(r.getVariable(o)??0):o;return l!==c?{update:i=>{let n=ui.lerp(l,c,i);t[e]=s?Math.trunc(n):n},start:()=>{t[e]=l},end:()=>{t[e]=c}}:void 0}function MU(e,t,i,n,r,s){let a=i[e]?i[e]:void 0,o=n[e];if(!o)return;let l=t[e],c=[...a??l].map((e=>"string"==typeof e?Number(r.getVariable(e)??0):e)),h=[...o].map((e=>"string"==typeof e?Number(r.getVariable(e)??0):e));return c.length!==h.length||Sg(c,h)?void 0:{update:i=>{c.forEach(((n,r)=>{let a=ui.lerp(n,h[r],i);t[e][r]=s?Math.trunc(a):a}))},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],h)}}}function TU(e,t,i){return t.forEach(((t,n)=>{e.setComponent(n,"string"==typeof t?Number(i.getVariable(t)??0):t)})),e}function IU(e,t,i,n,r){let s=i[e]?i[e]:void 0,a=n[e];if(!a)return;let o=t[e],l=s?TU(new Vi,s,r):o.clone(),c=TU(new Vi,a,r);return l.equals(c)?void 0:{update:e=>{o.lerpVectors(l,c,e)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function PU(e,t,i){return t.forEach(((t,n)=>{e.setComponent(n,"string"==typeof t?Number(i.getVariable(t)??0):t)})),e}function DU(e,t,i,n,r){let s=i[e]?i[e]:void 0,a=n[e];if(!a)return;let o=t[e],l=!(o instanceof pi),c=o instanceof pi?o:(new pi).fromArray(o),h=s?PU(new pi,s,r):c.clone(),d=PU(new pi,a,r);return h.equals(d)?void 0:{update:i=>{c.lerpVectors(h,d,i),l&&(t[e]=c.toArray())},start:()=>{c.copy(h),l&&(t[e]=c.toArray())},end:()=>{c.copy(d),l&&(t[e]=c.toArray())}}}function RU(e,t,i,n,r){let s=i[e]?i[e]:void 0,a=n[e];if(!a)return;let o=t[e],l=new fT(o.r,o.g,o.b,o.a),c=s?"string"==typeof s?r.getColor(s).clone():new fT(s.r,s.g,s.b,s.a):l.clone(),h="string"==typeof a?r.getColor(a).clone():new fT(a.r,a.g,a.b,a.a);return c.equals(h)?void 0:{update:i=>{l.lerpColors(c,h,i);let n=ui.lerp(c.a,h.a,i);l.a=n,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(h)}}}function BU(e,t,i,n,r){return"number"==typeof t[e]?CU(e,t,i??{},n,r):Array.isArray(t[e])?MU(e,t,i??{},n,r):void 0}function LU(e,t,i,n){let r=[];if(!("geometry"in i))return r;let s=e.geometry.userData.parameters,a="geometry"in t?t.geometry:{},o=i.geometry;if(e instanceof qD){let t=function(e,t,i,n){if(void 0===i.scaleBaked)return;let r=(t.scaleBaked??e.data.geometry.scaleBaked).map((e=>"string"==typeof e?Number(n.getVariable(e)??0):e)),s=i.scaleBaked.map((e=>"string"==typeof e?Number(n.getVariable(e)??0):e));if(iA.isEqual(r,s))return;let a=[];return a.push({update:t=>{e.updateGeometryInteractions({scaleBaked:[ui.lerp(r[0],s[0],t),ui.lerp(r[1],s[1],t),ui.lerp(r[2],s[2],t)]},n),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},start:()=>{e.updateGeometryInteractions({scaleBaked:r},n),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},n),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()}}),a}(e,a,o,n);t&&r.push(...t)}else{let t={};if(Object.assign(t,Lg(s,Gx),Lg(a,Gx)),Gx.forEach((e=>{let i=BU(e,t,a,o,n);i&&r.push(i)})),e instanceof _N){Object.assign(t,{extrusion:{...s.extrusion}});let e=function(e,t,i,n){if(!i.extrusion)return;let r=e.extrusion,s=t.extrusion??{},a=i.extrusion,o=[];return ex.forEach((e=>{let t=BU(e,r,s,a,n);t&&o.push(t)})),o}(t,a,o,n);e&&r.push(...e)}r.length&&r.push({update:i=>{e.updateGeometryInteractions(t,n),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},start:i=>{e.updateGeometryInteractions(t,n),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},end:i=>{e.updateGeometryInteractions(t,n),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()}})}return r}function OU(e,t,i,n){let r=[];if(void 0!==i.intensity){let s=CU("intensity",e,t,i,n);s&&r.push(s)}if(void 0!==i.color){let s=function(e,t,i,n,r){let s=i[e]?i[e]:void 0,a=n[e];if(!a)return;let o=t[e],l=s?"string"==typeof s?r.getColor(s).clone():(new Pi).setRGB(s.r,s.g,s.b):o.clone(),c="string"==typeof a?r.getColor(a).clone():(new Pi).setRGB(a.r,a.g,a.b);if(l.equals(c))return;let h=o.clone();return{update:i=>{h.lerpColors(l,c,i),t[e]?.copy?.(h)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}("color",e,t,i,n);s&&r.push(s)}return r}function NU(e,t,i,n){let r=[],s=VP(i,n)||!!t.layers&&VP(t,n);r.push(function(e,t){return{update:()=>{e.transparent=t}}}(e,s));for(let a of e.layers){let e=t.layers?.data(a.uuid),s=i.layers.data(a.uuid);if(!s||"light"!==a.type&&(!(a.visible??1)||!(s.visible??1)))continue;let o=a.getNames().filter((e=>!QA.some((t=>e.includes(t)))));for(let t of o)try{let i,o=a.getValue(t);if("colors"===t)i=GU(a,e,s,t);else if(Array.isArray(o))"steps"===t&&(i=VU(a,e,s,t));else if("number"==typeof o)i=kU(a,e,s,t,n);else{if("boolean"==typeof o)continue;o instanceof pi?i=FU(a,e,s,t):o instanceof Vi?i=UU(a,e,s,t,n):o instanceof fT?i=jU(a,e,s,t,n):o instanceof Pi?i=zU(a,e,s,t,n):"isTexture"in o&&(i=HU(a,e,s,t))}i&&(Array.isArray(i)?r.push(...i):r.push(i))}catch(cA){console.error(`lerpMaterial: unexpected material layer for ${t}`,cA)}}return r}function kU(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=t?t[n]:e.getValue(n),a=i[n],o="string"==typeof s?Number(r.getVariable(s)??0):s,l="string"==typeof a?Number(r.getVariable(a)??0):a;return o!==l?{update:t=>{e.setValue(n,ui.lerp(o,l,t))},start:()=>{e.setValue(n,o)},end:()=>{e.setValue(n,l)}}:void 0}function FU(e,t,i,n){if(!e.hasValue(n)||!(n in i))return;let r=e.getValue(n),s=t?(new pi).fromArray(t[n]):r.clone(),a=(new pi).fromArray(i[n]);return s.equals(a)?void 0:{update:e=>{r.lerpVectors(s,a,e)},start:()=>{r.copy(s)},end:()=>{r.copy(a)}}}function UU(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=e.getValue(n),a=t?t[n]:void 0,o=i[n],l=a?TU(new Vi,a,r):s.clone(),c=TU(new Vi,o,r);return l.equals(c)?void 0:{update:e=>{s.lerpVectors(l,c,e)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function zU(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=t?t[n]:void 0,a=i[n],o=e.getValue(n),l=s?"string"==typeof s?r.getColor(s).clone():(new Pi).setRGB(s.r,s.g,s.b):o.clone(),c="string"==typeof a?r.getColor(a).clone():(new Pi).setRGB(a.r,a.g,a.b);if(l.equals(c))return;let h=o.clone();return{update:t=>{e.getValue(n)!==h&&e.setValue(n,h),h.lerpColors(l,c,t)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function jU(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let s=t?t[n]:void 0,a=i[n],o=e.getValue(n),l=s?"string"==typeof s?r.getColor(s).clone():(new Pi).setRGB(s.r,s.g,s.b):o.clone(),c="string"==typeof a?r.getColor(a).clone():new fT(a.r,a.g,a.b,a.a);if(l.equals(c))return;let h=o.clone();return{update:t=>{e.getValue(n)!==h&&e.setValue(n,h),h.lerpColors(l,c,t)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function VU(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(!e.hasValue(n)||!(n in i))return;let r=[],s=e.getValue(n),a=t?t[n]:s,o=i[n];return Sg(a,o)||r.push({update:t=>{let i=[...s];for(let e=0;e<s.length;++e){let n=a[e],r=o[e];i[e]=ui.lerp(n,r,t)}e.setValue(n,i)},start:()=>{e.setValue(n,a)},end:()=>{e.setValue(n,o)}}),r.length?r:void 0}function GU(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"colors";if(!e.hasValue(n)||!(n in i))return;let r=[],s=e.getValue(n),a=t?t[n]:s.map((e=>e.toArray())),o=i[n];for(let l=0;l<s.length;++l){let e=[...a[l]],t=[...o[l]];rA.isEqual(e,t)||r.push({update:i=>{s[l].fromArray(rA.lerp(e,t,i))},start:()=>{s[l].fromArray(e)},end:()=>{s[l].fromArray(t)}})}return r.length?r:void 0}function HU(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"texture";if(!e.hasValue(n)||!(n in i))return;let r=e.getNode("rotation"),s=t?.[n]?.rotation??0,a=i[n]?.rotation??0;if(r&&s!==a)return{update:e=>{r.value=ui.lerp(s,a,e)*ui.DEG2RAD},start:()=>{r.value=s*ui.DEG2RAD},end:()=>{r.value=a*ui.DEG2RAD}};let o=e.getNode("mat");if(!o)return;let l=t?t[n]:o,c=i[n],h=[...l.repeat],d=[...l.offset],u=[...c.repeat],p=[...c.offset],f=l.rotation??0,m=c.rotation??0;return tA.isEqual(h,u)&&tA.isEqual(d,p)&&f===m?void 0:{update:e=>{o.repeat=tA.lerp(h,u,e),o.offset=tA.lerp(d,p,e),o.rotation=ui.lerp(f,m,e),o.updateMatrix()},start:()=>{o.repeat=[...h],o.offset=[...d],o.rotation=f,o.updateMatrix()},end:()=>{o.repeat=[...u],o.offset=[...p],o.rotation=m,o.updateMatrix()}}}var WU=new Vi,QU=new In;function qU(e,t,i,n,r){let s,a,o,l,c,h,d,u,p=[];if(e instanceof CO?(s=DU("position",e,t,i,r),s&&p.push(s),o=CU("rotation",e,t,i,r),o&&p.push(o),l=DU("shear",e,t,i,r),l&&p.push(l)):(u={slide:t.pathSnapping?.slide??e.updatedPathSnapping?.slide??e.dataPatched.pathSnapping?.slide??0,offset:t.pathSnapping?.offset??e.updatedPathSnapping?.offset??e.dataPatched.pathSnapping?.offset??0},h=CU("slide",u,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,r),h&&p.push(h),d=CU("offset",u,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,r),d&&p.push(d),!h&&!d&&(s=IU("position",e,t,i,r),s&&p.push(s),a=IU("scale",e,t,i,r),a&&p.push(a),o=function(e,t,i,n,r){let s=t?.rotation?t.rotation.map((e=>("string"==typeof e?Number(r.getVariable(e)??0):e)*ui.DEG2RAD)):void 0,a=i.rotation?.map((e=>("string"==typeof e?Number(r.getVariable(e)??0):e)*ui.DEG2RAD));if(!a)return;let o=s?(new Vi).fromArray(s):(new Vi).setFromEuler(e.rotation),l=(new Vi).fromArray(a);if(o.equals(l))return;let c=WU.subVectors(l,o);if(n&&c.toArray().every((e=>Math.abs(e)<2*Math.PI))){let t=(new ji).setFromEuler(QU.setFromVector3(o)),i=(new ji).setFromEuler(QU.setFromVector3(l));return{update:n=>{!function(e,t,i,n){if(0===n)return i.copy(e);if(1===n)return i.copy(t);let r=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(r>=1)return i.copy(e);let s=1-r*r;if(s<=Number.EPSILON){let r=1-n;return i.w=r*e.w+n*t.w,i.x=r*e.x+n*t.x,i.y=r*e.y+n*t.y,i.z=r*e.z+n*t.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,r),l=Math.sin((1-n)*o)/a,c=Math.sin(n*o)/a;i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c}(t,i,e.quaternion,n)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}return{update:t=>{WU.lerpVectors(o,l,t),e.rotation.setFromVector3(WU)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}(e,t,i,n,r),o&&p.push(o),c=function(e,t,i,n){let r=i[e]?i[e]:void 0,s=n[e];if(!s)return;let a=t[e],o=r?(new bn).fromArray(r):a.clone(),l=new Vi,c=new ji,h=new Vi;o.decompose(l,c,h);let d=(new bn).fromArray(s),u=new Vi,p=new ji,f=new Vi;return d.decompose(u,p,f),o.equals(d)?void 0:{update:e=>{EU.slerpQuaternions(c,p,e),SU.lerpVectors(l,u,e),_U.lerpVectors(h,f,e),a.compose(SU,EU,_U)},start:()=>{a.compose(l,c,h)},end:()=>{a.compose(u,p,f)}}}("hiddenMatrix",e,t,i),c&&p.push(c))),s||a||o||c||h||d){let i=e instanceof CO?()=>{e.updateWorldMatrix(!0,!1,!0),e.resetBBoxNeedsUpdate()}:()=>{e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),e.parent?.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),iB(e)&&nB(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,u))};p.push({update:i,start:i,end:i})}return p}function XU(e,t,i,n){let r=[];if(!("cloner"in i)||!e.cloner)return r;let s=e.cloner,a="cloner"in t?t.cloner:{},o=i.cloner;NA.forEach((e=>{let t;t="count"===e?CU("count",s.parameters,a,o,n,!0):BU(e,s.parameters,a??{},o,n),t&&r.push(t)}));let l=function(e,t,i,n){if("radial"!==e.parameters.type)return;let r=t.radial,s=i.radial;if(!s)return;let a=e.parameters.radial,o=[];return kA.forEach((e=>{let t=BU(e,a,r??{},s,n);t&&o.push(t)})),o}(s,a,o,n);l?.length&&r.push(...l);let c=function(e,t,i,n){if("linear"!==e.parameters.type)return;let r=t.linear,s=i.linear;if(!s)return;let a=[],o=e.parameters.linear;return FA.forEach((e=>{let t=BU(e,o,r??{},s,n);t&&a.push(t)})),a}(s,a,o,n);c?.length&&r.push(...c);let h=function(e,t,i,n){if("grid"!==e.parameters.type)return;let r=t.grid,s=i.grid;if(!s)return;let a=[],o=e.parameters.grid;return UA.forEach((e=>{let t;t="count"===e?MU(e,o,r??{},s,n,!0):BU(e,o,r??{},s,n),t&&a.push(t)})),a}(s,a,o,n);h?.length&&r.push(...h);let d=function(e,t,i,n){if("toObject"!==e.parameters.type)return;let r=t.toObject,s=i.toObject;if(!s)return;let a=[],o=e.parameters.toObject;return zA.forEach((e=>{let t;t="count"===e?CU(e,o,r??{},s,n,!0):BU(e,o,r??{},s,n),t&&a.push(t)})),a}(s,a,o,n);d?.length&&r.push(...d);let u=function(e,t,i,n){if(!e.parameters.randomness)return;let r=t.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=e.parameters.randomnessObject;return jA.forEach((e=>{let t=BU(e,o,r??{},s,n);t&&a.push(t)})),a}(s,a,o,n);return u?.length&&r.push(...u),r.length&&r.push({update:()=>{s.update()}}),r}function YU(e,t,i,n,r){let s,a,o,l,c,h,d,u,p,f,m,g,v,y,b,A=[];if("width"in e&&(s=CU("width",e,t,i,r),s&&A.push(s)),"height"in e&&(a=CU("height",e,t,i,r),a&&A.push(a)),e instanceof ZO||e instanceof nN){let n={...t.fill},s={...i.fill};void 0!==n.enabled&&n.enabled!==s.enabled&&(A.push(function(e,t){return{update:()=>{e instanceof ZO&&(e.fill.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),s.enabled||Object.assign(s,{enabled:!0,color:{...s.color,a:0}})),o=RU("color",e.fill,n,s,r),o&&A.push(o)}if(e instanceof ZO){let n={...t.stroke},s={...i.stroke};(n.enabled||s.enabled)&&(A.push(function(e,t){return{update:()=>{e instanceof ZO&&(e.stroke.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),s.enabled||Object.assign(s,{enabled:!0,color:{...s.color,a:0}})),l=RU("color",e.stroke,n,s,r),l&&A.push(l),c=CU("thickness",e.stroke,n,s,r),c&&A.push(c)}if(e instanceof ZO){let n={...t.dropShadow},s={...i.dropShadow};(n.enabled||s.enabled)&&(A.push(function(e,t){return{update:()=>{e instanceof ZO&&(e.dropShadow.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),s.enabled||Object.assign(s,{enabled:!0,color:{...s.color,a:0}})),h=RU("color",e.dropShadow,n,s,r),h&&A.push(h),d=CU("blurRadius",e.dropShadow,n,s,r),d&&A.push(d),p=CU("spread",e.dropShadow,n,s,r),p&&A.push(p),u=DU("offset",e.dropShadow,n,s,r),u&&A.push(u)}if(e instanceof ZO){let n={...t.innerShadow},s={...i.innerShadow};(n.enabled||s.enabled)&&(A.push(function(e,t){return{update:()=>{e instanceof ZO&&(e.innerShadow.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),s.enabled||Object.assign(s,{enabled:!0,color:{...s.color,a:0}})),f=RU("color",e.innerShadow,n,s,r),f&&A.push(f),m=CU("blurRadius",e.innerShadow,n,s,r),m&&A.push(m),v=CU("spread",e.innerShadow,n,s,r),v&&A.push(v),g=DU("offset",e.innerShadow,n,s,r),g&&A.push(g)}if(e instanceof ZO||e instanceof nN){let n={...t.backgroundBlur},s={...i.backgroundBlur};(n.enabled||s.enabled)&&(A.push(function(e,t){return{update:()=>{e instanceof ZO&&(e.backgroundBlur.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,radius:0}),s.enabled||Object.assign(s,{enabled:!0,radius:0})),y=CU("radius",e.backgroundBlur,n,s,r),y&&A.push(y)}if(e instanceof ZO){let n={...t.layerBlur},s={...i.layerBlur};(n.enabled||s.enabled)&&(A.push(function(e,t){return{update:()=>{e instanceof ZO&&(e.layerBlur.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,radius:0}),s.enabled||Object.assign(s,{enabled:!0,radius:0})),b=CU("radius",e.layerBlur,n,s,r),b&&A.push(b)}if(e instanceof nN||e instanceof eN){let n=MU("cornerRadius",e,t,i,r);n&&A.push(n)}return A}function KU(e,t,i,n,r){let s=[];return e.data.visible&&s.push(...qU(e,t,i,r,n)),e instanceof CO?s.push(...YU(e,t,i,0,n)):(e.data.visible&&s.push(...XU(e,t,i,n)),iB(e)?(e instanceof jD&&e.data.visible&&s.push(...LU(e,t,i,n)),e.data.visible&&s.push(...function(e,t,i,n){let r=[];if(Array.isArray(e.material)){if(!("materials"in i)||!i.materials)return r;let s="materials"in t&&t.materials?t.materials:[],a=i.materials;e.material.forEach(((e,t)=>{if(!a[t])return;let i=s[t]??{},o=a[t];"string"==typeof i||"string"==typeof o||r.push(...NU(e,i,o,n))}))}else{if(!("material"in i)||!i.material)return r;let s="material"in t&&t.material?t.material:{},a=i.material;if("string"==typeof s||"string"==typeof a)return r;r.push(...NU(e.material,s,a,n))}return r}(e,t,i,n))):(e=>$R.is(e))(e)?e.data.visible&&s.push(...OU(e,t,i,n)):(e=>e instanceof YR)(e)&&s.push(...function(e,t,i,n){let r=[],s="OrthographicCamera"===e.cameraType?t.orthographic?.zoom:t.perspective?.zoom,a="OrthographicCamera"===e.cameraType?i.orthographic?.zoom:i.perspective?.zoom;if(void 0!==a){let t=s??e.zoom,i=a;t!==i&&r.push({update:n=>{e.zoom=ui.lerp(t,i,n),e.updateProjectionMatrix()},start:()=>{e.zoom=t,e.updateProjectionMatrix()},end:()=>{e.zoom=i,e.updateProjectionMatrix()}})}if(void 0!==i.targetOffset){let s=CU("targetOffset",e,t,i,n);s&&r.push(s)}return r}(e,t,i,n))),s.length?{update:e=>{s.forEach((t=>t.update(e)))},start:e=>{s.forEach((t=>t.start?.(e)))},end:e=>{s.forEach((t=>t.end?.(e)))}}:void 0}var JU=new Vi;function ZU(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[],r=i=>{let n=i.data;delete i.states,i.currentState=null,i.reversibleToState=null,i.currentTransitionEvent=null;for(let e of n.states){let t={...e.data};i.states||(i.states={}),i.states[e.id]=fw.patch(n,t)}ez(e.scene,i,null,t,void 0!==n.events.find((e=>"Follow"===e.data.type||"LookAt"===e.data.type))),$U(e)};e.scene.traverse2D(r),e.traverseChildren((s=>{if(i&&(s.rigidBody?.setTranslation(s.position0,!0),s.rigidBody?.setRotation(s.rotation0,!0),s.rigidBody?.setLinvel(JU,!0),s.rigidBody?.setAngvel(JU,!0)),!d_.is(s))return;let a=s.uuid,o=s.data;if(delete s.states,s.uuid===xA)return;let l=!1;n.some((t=>e.scene.find(a)?.isDescendantOf(t)))?l=!0:!0===o.physics?.fusedBody&&"dynamic"===o.physics.rigidBody&&n.push(a),s.data=o,s.currentState=null,s.reversibleToState=null,s.currentTransitionEvent=null;for(let t of o.states){let i={...t.data};!0===e.data.globalPhysics.usePhysics&&o.physics&&("dynamic"===o.physics.rigidBody||l)&&(void 0!==t.data.position&&delete i.position,void 0!==t.data.rotation&&delete i.rotation,void 0!==t.data.hiddenMatrix&&delete i.hiddenMatrix),s.states||(s.states={}),s.states[t.id]=_x.patch(o,i)}ez(e.scene,s,null,t,void 0!==o.events.find((e=>"Follow"===e.data.type||"LookAt"===e.data.type))),s instanceof DN&&s.frame&&(s.frame.traverse((e=>r(e))),s.uiCanvas?.applySize())})),$U(e),e.frame&&(e.frame.traverse((e=>r(e))),e.uiCanvas?.applySize())}function $U(e){e.traverseEntity((t=>{for(let i of t.data.events){let t=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":t.push(...i.data.actions);break;case"GameControl":for(let e of Object.values(i.data.gameActions))t.push(...e);break;case"DragDrop":t.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":t.push(...i.data.inActions,...i.data.outActions)}for(let i of t)if("Create"===i.data.type&&"Yes"===i.data.hideBase){let t=e.scene.find(i.data.object);t&&(t.visible=!1)}}}))}function ez(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t instanceof jD&&!(t instanceof $N)&&t.removeInteractionGeometry(n),t instanceof CO?t.changeSelectedState(i,{shared:n},r):t.changeSelectedState(i,{scene:e,shared:n},r),t instanceof jD&&t.updateGeometryGroupsIfNeeded(),t instanceof YR&&t.updateCameraState(t.dataPatched,{scene:e,shared:n}),!(t instanceof CO)){if(t.cloner)for(let e of t.cloner.children)e.playModeVisible=void 0;t.updateVisible()}}function tz(e){let t;if(5===e.easing){let{control1:i,control2:n}=e;t=`cubicBezier(\n\t\t\t${i[0]}, ${i[1]}, ${n[0]}, ${n[1]}\n\t\t)`}else if(6===e.easing){let{mass:i,stiffness:n,damping:r,velocity:s}=e;t=`spring( ${i}, ${n}, ${r}, ${s} )`}else{let i;switch(e.easing){case 0:default:i=mA.linear;break;case 1:i=mA.ease;break;case 2:i=mA.easeIn;break;case 3:i=mA.easeOut;break;case 4:i=mA.easeInOut}let[n,r,s,a]=i;t=`cubicBezier( ${n}, ${r}, ${s}, ${a} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function iz(e){let t={delay:0,loop:-1===e.repeat||e.repeat+1};if(0===e.repeat)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay}return"alternate"===t.direction&&(t.delay/=2,t.endDelay/=2,"start"===e.delayDirection?(t.pingPongDelayCorrection=t.delay,"number"==typeof t.loop&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):"end"===e.delayDirection?"number"==typeof t.loop&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):"start-end"===e.delayDirection&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var nz={type:"beginState"},rz={type:"completeState",isfromEntity:!1},sz=class{constructor(e,t,i,n,r,s){if(this.object=e,this.data=n,this.sharedAssets=r,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),0===this.targets.t||1===this.targets.t?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let e=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=e,this.object.dispatchEvent({type:"beginState",state:e}),this.object instanceof CO||this.object.traverseEntity((e=>{e!==this.object&&e instanceof YR&&e.dispatchEvent(nz)}))},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let e=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=e,this.object.dispatchEvent({type:"completeState",state:e}),this.object instanceof CO||this.object.traverseEntity((e=>{e!==this.object&&e instanceof YR&&e.dispatchEvent(rz)}))},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=KU(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},void 0===t){let e=oz(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!e)throw new Error("Missing property");this.from=e}else{let e=oz(this.object,t);if(!e)throw new Error("Missing property");this.from=e}if(void 0===i)throw new Error("Missing property");{let e=oz(this.object,i);if(!e)throw new Error("Missing property");this.to=e}this.useCurrentState=void 0===t||void 0===i,this.params={targets:this.targets,t:1,autoplay:!1,...iz(n),...tz(n),change:this.onChange},this.callback=KU(this.object,void 0===t?{}:this.from.data,void 0===i?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},az=class extends Zt{constructor(e,t,i,n,r){if(super(),this.eventType=e,this.data=t,this.page=i,this.shared=n,this.condition=r,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{"normal"!==this.data.tweens[0].data.direction&&(this.toggleIsForward=!this.toggleIsForward),!1!==this.timelineNeedsRebuild&&(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let s=this.page.scene.find(t.object)??this.page.uiCanvas?.find(t.object)??this.page.scene.find2DInUIObjects(t.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay="start-once"===t.tweens[0].data.delayDirection?t.tweens[0].data.delay:0,this.init()}get playing(){return!1===this.timeline?.paused}get changeBegan(){return this.tweens.some((e=>e.changeBegan))??!1}init(){this.initialCurrentState=oz(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return"Toggle"===this.data.runMode&&Bb(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline(){let{isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let n=iz(this.data.tweens[0].data);i&&"number"==typeof n.loop&&n.loop--,this.timeline?.pause(),this.timeline=wU.timeline({autoplay:!1,...n,...!0===n.loop||n.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let r=this.tweens.findIndex((e=>e?.changeBegan));if(!0===t&&(this.timelineNeedsRebuild=!0),e){let e=-1===r?0:r;for(let t=e;t<this.data.tweens.length-1;t++){let i,s=this.data.tweens[t],a=this.data.tweens[t+1];t!==e||!0!==this.object.wasMovedByUser&&!0!==this.object.previousAction?.changeBegan?i=void 0===s.data.state?this.currentState:s.data.state:(i=void 0,this.object instanceof YR&&(this.object.wasMovedByUser=!1));let o=new sz(this.object,i,void 0===a.data.state?this.currentState:a.data.state,a.data,this.shared,this.data.allowSlerp??!1);-1!==r&&t===e&&Object.assign(o.params,{startOnceDelay:0}),this.tweens[t]=o,this.timeline.add(o.params,this.timeline.duration+(t===e?n.delay:0))}this.timeline.duration+=n.endDelay}else{let e=-1===r?this.data.tweens.length-1:r+1;for(let t=e;t>0;t--){let i,s=this.data.tweens[t],a=this.data.tweens[t-1];t!==e||!0!==this.object.wasMovedByUser&&!0!==this.object.previousAction?.changeBegan?i=void 0===s.data.state?this.currentState:s.data.state:(i=void 0,this.object instanceof YR&&(this.object.wasMovedByUser=!1));let o=new sz(this.object,i,void 0===a.data.state?this.currentState:a.data.state,s.data,this.shared,this.data.allowSlerp??!1);-1!==r&&t===e&&Object.assign(o.params,{startOnceDelay:0}),this.tweens[t-1]=o,this.timeline.add(o.params,this.timeline.duration+(t===e?n.endDelay:0))}this.timeline.duration+=n.delay}}catch(gA){gA instanceof Error&&console.error(gA.message)}!0===this.object.previousAction?.playing&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(!1===bz(this.shared,this.condition)||Bb(this.eventType)&&"Once"===this.data.runMode&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let e=iz(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout((()=>{try{this.buildTimeline(),this.timeline.play()}catch(Ev){Ev instanceof Error&&console.error(Ev.message)}}),this.startOnceDelay+e)}pause(){this.timeline?.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=void 0===this.data.tweens[0].data.state?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof CO?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){if(!1===bz(this.shared,this.condition))return!1;void 0===this.timeline&&this.buildTimeline(),this.timeline?.seek(e*this.timeline.duration,!0)}toggle(e){if(!1===bz(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout((()=>{this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()}),this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function oz(e,t){let i,n;if("string"==typeof t?(i=t,n=e.states?.[i]):null===t&&(i=null,n=e.data),void 0!==i&&void 0!==n)return{id:i,data:n}}var lz={type:"beginState"},cz={type:"completeState",isfromEntity:!1},hz={type:"requestRender"},dz=class extends Zt{constructor(e,t,i,n){super(),this.data=e,this.page=t,this.shared=i,this.condition=n,this.toggleIsForward=!1,this.posStart=new Vi,this.posEnd=new Vi,this.qStart=new ji,this.qEnd=new ji,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(){if(!this.data.animate)return;let e=this.page.scene.find(this.data.targetCamera);if(!e||!e.visible)throw new ReferenceError("Target camera not founded or not visible");let t={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=wU({targets:t,t:1,...tz(this.data),update:()=>{0===t.t&&("Toggle"!==this.data.runMode||this.toggleIsForward?(this.posEnd.copy(e.position),this.qEnd.copy(e.quaternion),this.zoomEnd=e.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(e.uuid)):this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)),this.page.activeCamera.dispatchEvent(lz));let i=this.page.activeCamera;i.position.lerpVectors(this.posStart,this.posEnd,t.t),i.quaternion.slerpQuaternions(this.qStart,this.qEnd,t.t),i.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*t.t,i.wasMovedBySwitchCameraAction=!0,i.updateMatrix(),i.updateMatrixWorld(),i.updateProjectionMatrix(),i.dispatchEvent(hz),1===t.t&&i.dispatchEvent(cz)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(!1===bz(this.shared,this.condition))return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{delete this.timeoutId,this.data.animate?(this.buildAnimation(),this.animation?.play()):this.switchCamera(this.data.targetCamera)}),1e3*this.data.delay)}catch{}}pause(){this.animation?.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){if(!1===bz(this.shared,this.condition))return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,e!==this.toggleIsForward)try{this.playing?(this.animation?.pause(),this.toggleIsForward=e??!this.toggleIsForward,this.buildAnimation(!0),this.animation?.play()):this.timeoutId=window.setTimeout((()=>{this.toggleIsForward=e??!this.toggleIsForward,this.data.animate?(this.animation?.pause(),this.buildAnimation(),this.animation?.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(cz),this.page.activeCamera.dispatchEvent(hz))}),1e3*this.data.delay)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function uz(e){let t=e?.tracks.filter((e=>"vector"===e.ValueTypeName||"quaternion"===e.ValueTypeName)).map((e=>e.times.length));if(t?.length){let e=Eg(t);return e&&e>2?e:2}return 2}var pz=class extends Zt{constructor(e,t,i,n,r){super(),this.data=e,this.page=t,this.animationControls=i,this.shared=n,this.condition=r,this.startOnceDelay=0,this.toggleIsForward=!1;let s=e.object,a=t.scene.find(e.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...e,object:s};let o=this.animationControls.clipIdToAction[e.clipId+"/"+s];if(this.duration=o?.getClip()?.duration??1,this.data.crop2){let e=uz(o?.getClip());this.leftFrameTime=this.data.crop2[0]/(e-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(e-1)*this.duration}else{let e=o?.getClip()?.tracks[0]?.times.length;e&&e>1?(this.leftFrameTime=this.data.crop[0]/e*this.duration,this.rightFrameTime=this.data.crop[1]/e*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=e.delay}get playing(){return this.threeAnimAction?.isRunning()??!1}play(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===bz(this.shared,this.condition))return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach((i=>{let[n,r]=i,s=n.split("/")[1];this.threeAnimAction!==r&&s===t&&r.isRunning()&&(e?r.fadeOut(.2):r.stop())})),e&&this.threeAnimAction?.fadeIn(.2)}),this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){this.threeAnimAction?.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=ui.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1===bz(this.shared,this.condition))return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout((()=>{if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let e=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach((i=>{let[n,r]=i,s=n.split("/")[1];this.threeAnimAction!==r&&s===e&&r.isRunning()&&(t?r.fadeOut(.2):r.stop())})),t&&this.threeAnimAction?.fadeIn(.2)}}),this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){let e=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object]?.getClip();e&&(e.duration=this.duration),this.pause()}},fz=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.eventManager=i,this.shared=n,this.condition=r,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(!1===bz(this.shared,this.condition))return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout((()=>{this.play()}),1e3*this.data.delay))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every((e=>e.uuid!==this.data.target||e.data.uiScene)))return;"fade"===this.data.transition&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,1e3*this.data.duration),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity((e=>{"ParticleSystem"===e.type&&(e.sleep(),e.wakeUp(),e.data.autoPlay?e.start():e.stop())})),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),ZU(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},mz=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=bz(this.shared,this.condition)}dispatch(){if(!1===this.evaluatedCondition)return!1;let e=this.shared.getVariable(this.data.variableId),t=sM(this.data.expression,this.shared,Ox.typeOfVariable(e));void 0!==t&&this.shared.updateVariable(this.data.variableId,"string"==typeof t?{textValue:t}:t)}dispose(){}},gz=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.timeoutId=null}dispatchInner(){if(!1===bz(this.shared,this.condition))return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if("PlayPause"===this.data.mode)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"===e?"Paused":"Playing");else if("Play"===this.data.mode&&"Playing"!==e)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if("Stop"===this.data.mode&&"Stopped"!==e)this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if("Pause"===this.data.mode&&"Paused"!==e)this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if("Restart"===this.data.mode)this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if("Toggle"===this.data.mode){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);"Playing"===e?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,void 0!==t&&!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);"PlayPause"===this.data.mode&&"Playing"===t&&(e=this.data.pauseDelay),0!==e?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{this.timeoutId=null,this.dispatchInner()}),e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},vz=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n}dispatch(){if(!1===bz(this.shared,this.condition))return!1;("single"===this.data.target?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach((e=>{this.shared.getVariable(e);let t=this.shared.data.variables.data(e)?.value;void 0!==t&&this.shared.updateVariable(e,t),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(RD(e))}))}dispose(){}},yz=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n}dispatch(){if(!1===bz(this.shared,this.condition))return!1;this.data.userAPIId&&this.shared.getUserAPI(this.data.userAPIId)?.callUserAPI(this.shared)}dispose(){}};function bz(e,t){if(void 0===t)return!0;if(0===t.expression.length)return!1;let i=sM(t.expression,e,"boolean");return t.negate?!i:!!i}function Az(e,t,i,n,r,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=t=>l=>{let{id:c,data:h}=l;try{"Audio"===h.type?eA[e.type].includes("Audio")&&a.Audio.push(new pF(c,h,s,n,t)):"Video"!==h.type||s instanceof CO?"Particles"===h.type?eA[e.type].includes("Particles")&&a.Particles.push(new fF(h,i,n,t)):"Link"===h.type?eA[e.type].includes("Link")&&a.Link.push(new vF(h,r.controlsManager,n,t)):"Create"===h.type?eA[e.type].includes("Create")&&a.Create.push(new Rz(h,i,r.controlsManager,n,t)):"Destroy"===h.type?eA[e.type].includes("Destroy")&&a.Destroy.push(new yF(h,i,r.controlsManager,n,t)):"Reset"===h.type?eA[e.type].includes("Reset")&&a.Reset.push(new bF(h,i,n,r,t)):"Transition"===h.type?eA[e.type].includes("Transition")&&a.Transition.push(new az(e.type,h,i,n,t)):"SwitchCamera"===h.type?eA[e.type].includes("SwitchCamera")&&a.SwitchCamera.push(new dz(h,i,n,t)):"SceneTransition"===h.type?eA[e.type].includes("SceneTransition")&&a.SceneTransition.push(new fz(h,i,r,n,t)):"Animation"===h.type?eA[e.type].includes("Animation")&&a.Animation.push(new pz(h,i,r.animationControls,n,t)):"SetVariable"===h.type?eA[e.type].includes("SetVariable")&&a.SetVariable.push(new mz(h,i,n,t)):"DynamicVariablePlay"===h.type?eA[e.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new gz(h,i,n,t)):"Conditional"===h.type?eA[e.type].includes("Conditional")&&(h.ifActions.forEach(o({expression:h.condition,negate:!1})),h.elseActions.forEach(o({expression:h.condition,negate:!0}))):"ClearLocalStorage"===h.type?eA[e.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new vz(h,i,n,t)):"UserAPI"===h.type&&eA[e.type].includes("UserAPI")&&a.UserAPI.push(new yz(h,i,n,t)):eA[e.type].includes("Video")&&a.Video.push(new Cz(c,h,s,n,t))}catch(cA){}};return t.forEach(o()),a}function xz(e){Object.values(e).forEach((e=>{e.forEach((e=>{(e instanceof pF||e instanceof Cz||e instanceof fF||e instanceof pz||e instanceof az||e instanceof Rz||e instanceof yF||e instanceof dz||e instanceof fz||e instanceof bF||e instanceof mz||e instanceof gz)&&e.dispose()}))}))}var wz=new Map,Sz=new Map,_z=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:n,loop:r,volume:s,delay:a}=t;if(this.object=i,void 0===n)throw new Error("Missing property");let o=function(e,t){let i;if("material"in e){let n=e.material;i=Array.isArray(n)?e.material[0].layers.find((e=>e.uuid===t)):e.material.layers.find((e=>e.uuid===t))}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}(i,n);o&&(this.videoElement=o,this.videoElement.loop=r===1/0,zg&&(this.videoElement.autoplay=!0),void 0!==s&&(this.videoElement.volume=s)),void 0!==a&&(this.delay=a),Sz.has(i.uuid)?Sz.get(i.uuid).push(this):Sz.set(i.uuid,[this]),wz.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout((()=>{this.unMute()}),100)):this.unMute(),this.delayTimerId=window.setTimeout((()=>{if(!this.videoElement)return;let e=this.videoElement.play();void 0!==e&&e.then((e=>{})).catch((e=>{this.play()})),this.clearDelay()}),this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){"stop"===this.data.toggle?"playing"===this.status?this.stop():(this.stop(),this.play()):"pause"===this.data.toggle?"playing"===this.status?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},Ez=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=wz.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t[this.data.interaction](),this.disposeDelay()}),this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=Sz.get(e);!t?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t.forEach((e=>e[this.data.interaction]())),this.disposeDelay()}),this.data.delay)):t.forEach((e=>e[this.data.interaction]())))}pauseAllVideos(){let e=[...Sz.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{e.forEach((e=>{e.forEach((e=>{e[this.data.interaction]()}))})),this.disposeDelay()}),this.data.delay)):e.forEach((e=>{e.forEach((e=>{e[this.data.interaction]()}))})))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Cz=class{constructor(e,t,i,n,r){if(this.data=t,this.shared=n,this.condition=r,"play"===t.interaction)this.interaction=new _z(e,t,i);else{if("pause"!==t.interaction&&"stop"!==t.interaction)throw new Error("Missing property");this.interaction=new Ez(t)}}dispatchBasic(){if(!1===bz(this.shared,this.condition))return!1;this.interaction instanceof _z?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===bz(this.shared,this.condition))return!1;this.interaction instanceof _z?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},Mz=(()=>{let e,t,i,n;function r(i){!e&&!Tz()&&t?.sharedGameControlGlobals.createdObjects.length>0&&(e=requestAnimationFrame(s)),i&&(t=i,n=i.requestRender)}function s(r){let a=i?r-i:0,o=t.sharedGameControlGlobals.createdObjects,l=t.sharedGameControlGlobals.nCreatedPerAction,c=o.length,h=0;for(;h<c;){let e=o[h];void 0===e.userData.createdTime&&(e.userData.createdTime=r),void 0===e.userData.lifetime&&void 0===e.userData.quantity||e.userData.lifetime&&r-e.userData.createdTime<e.userData.lifetime||e.userData.quantity&&l[e.userData.actionId]<=e.userData.quantity?(e.userData.velocity&&(e.position.addScaledVector(e.userData.velocity,a/1e3),e.updateMatrix(),n()),h++):(l[e.userData.actionId]>e.userData.quantity&&l[e.userData.actionId]--,o.splice(h,1),e.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&e.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(e.rigidBody)):(e.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter((e=>void 0!==e.bvhGeometry))),c--,n())}e=h>0?requestAnimationFrame(s):void 0,i=h>0?r:void 0}return typeof document<"u"&&document.addEventListener("visibilitychange",(function(){Tz()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):r()})),r})();function Tz(){return!!document&&document.hidden}var Iz=new ji,Pz=new Vi,Dz=new Vi,Rz=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.controlsManager=i,this.shared=n,this.condition=r,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=ui.generateUUID(),this.dispatch=()=>{if(!1===bz(this.shared,this.condition))return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()},this.dispatchFromStart=()=>{if(!1===bz(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))},this.dispatchThrottled=Og(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{null===this.intervalId&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let e=new f_(this.object);if(e.playModeVisible=!0,e.expand(),"world"!==this.data.coordinateSystem){let t=this.data.coordinateSystem,i=this.page.scene.find(t);i&&(i.updateMatrixWorldSVD(),e.hiddenMatrix.copy(i.matrixWorldRigid))}e.scale.copy(this.object.scale),e.position.fromArray(this.data.position),e.rotation.fromArray(this.data.rotation),e.updateMatrix(),this.page.add(e);let t=this.controlsManager.sharedGameControlGlobals;t.createdObjects.push(e),void 0===t.nCreatedPerAction[this.uniqueId]?t.nCreatedPerAction[this.uniqueId]=1:t.nCreatedPerAction[this.uniqueId]++,e.updateWorldMatrix(!0,!0),e.traverseObject(this.traverseObjectCB),Mz(),this.controlsManager.requestRender()},this.traverseObjectCB=e=>{let t;if(e.hasNonUniformScale&&e.updateMatrixWorldSVD(),this.controlsManager.sharedGameControlGlobals.rapierWorld){if(e instanceof PR){if(!e.objectForSample)return!0===e.object.dataPatched.physics.fusedBody&&"dynamic"===e.object.dataPatched.physics.rigidBody||void 0;if(e.objectForSample.dataPatched.physics.fusedBody)return;t=e.object}else if(e instanceof f_)t=e.object;else if(t=e,t.dataPatched.cloner?.hideBase)return!0}else{if(e instanceof PR)return;t=e instanceof f_?e.object:e}"Time"===this.data.destroy?e.userData.lifetime=1e3*this.data.lifetime:"Quantity"===this.data.destroy&&(e.userData.quantity=this.data.destroyAfterQuantity,e.userData.actionId=this.uniqueId);let i=(new Vi).fromArray(this.data.velocity),n=t.dataPatched;if(!("visibility"===n.physics.enabled?!n.visible:!n.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(e,t,{fromCreate:!0,dynamic:this.data.dynamic}),"Collision"===this.data.destroy&&(e.rigidBody?.collider(0).setActiveEvents(1),e.userData.hasCollisionDestroy=!0),e.matrixWorld.decompose(Pz,Iz,Dz),i.applyQuaternion(Iz),this.data.velocity.some((e=>0!==e))&&this.data.dynamic&&e.rigidBody?.setLinvel(i.divideScalar(this.controlsManager.pixelsPerMeter),!0)):("geometry"in e.object&&this.controlsManager.addBoundsTree(e),this.data.velocity.some((e=>0!==e))&&this.data.dynamic&&(e.userData.velocity=i)),!0===t.dataPatched.physics?.fusedBody))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,"world"!==this.data.coordinateSystem&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");Mz(i)}dispose(){null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach((e=>window.clearTimeout(e))),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},Bz=.02,Lz=(new Vi,new Vi),Oz=new Vi,Nz=new Vi,kz=new Vi,Fz=new Vi,Uz=new Vi,zz=new bn,jz=new bn,Vz=new bn,Gz=(new bn,new ji),Hz=new ji,Wz=new In(0,0,0,"YXZ"),Qz=new Vi(1,0,0),qz=new Vi(0,1,0),Xz=new Vi(0,0,1),Yz=new Vi(1,1,1),Kz=(new hn,new Rh),Jz=new Wi,Zz={type:"requestRender"},$z={type:"updateMatrix"},ej=Math.PI/6,tj=class extends Zt{constructor(e,t,i,n,r,s,a,o,l){super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=n,this.controlsManager=r,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new bn,this.target0=new Vi,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=200,this.euler0=new In(0,0,0,"YXZ"),this.position0Cam=new Vi,this.quat0Cam=new ji,this.scale0Cam=new Vi,this.hiddenMatrix0Cam=new bn,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Rh(new Vi(0,-40,0),new Vi(0,40,0)),matrix:new bn,position:new Vi,rotation:new ji},this.euler=new In(0,0,0,"YXZ"),this.eulerDelta=new Vi,this.lastPosition=new Vi,this.lastCameraQuaternion=new ji,this.lastCameraPosition=new Vi,this.PI_2=Math.PI/2,this.prevMouse=new pi,this.velocityTarget=new Vi,this.velocity=new Vi,this.directionXZ=new Vi,this.rotVelocityStick=new Vi,this.rotVelocityTarget=new Vi,this.rotVelocity=new Vi,this.rotDirection=new Vi,this.nonColliderRotOffset=new bn,this.nonColliderPosOffset=new bn,this.firstPointerId=-1,this.rot=new Vi,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new bn,this.objectToTarget=new Vi,this.objectToTarget0=new Vi,this.objectToCamXZ=new Vi,this.objectToCamXZ0=new Vi,this.targetToCamera=new Vi,this.targetToCamera0=new Vi,this.cameraPolarAxis0=new Vi,this.targetPos=new Vi,this.targetQuat=new ji,this.lerpFactorPos=(new Vi).setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new ji,this.objXZQuatInv=new ji,this.objXZRotMat=new bn,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new Vi,this.pushedVelocity=new Vi,this.groundYRotation=0,this.objectRealQuat=new ji,this.colliderWorldQuat=new ji,this.groundNormal=new Vi,this.groundTilt=new ji,this.groundTiltInv=new ji,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new Vi,this.quaternion=new ji,this.scale=new Vi,this.initialAction=!0,this.onPointerDown=e=>{!(e.target===this.domElement||e.target instanceof HTMLElement&&"SPLINE-VIEWER"===e.target.tagName&&e.target.shadowRoot?.contains(this.domElement))||-1!==this.firstPointerId||(this.firstPointerId=e.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),"keys"!==this.rotBy&&!Vg&&!Gg&&this.domElement.requestPointerLock(),this.prevMouse.set(e.clientX,e.clientY))},this.onPointerUp=e=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),"mouse"===e.pointerType&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=e=>{if(e.pointerId!==this.firstPointerId)return;let t=e.clientX-this.prevMouse.x,i=e.clientY-this.prevMouse.y;this.prevMouse.set(e.clientX,e.clientY),"mouse"===e.pointerType&&"keys"!==this.rotBy&&(Gg&&Hg<15.5&&!Vg?(this.eulerDelta.y=-t*this.mouseOrbitSensitivity,this.eulerDelta.x=-i*this.mouseOrbitSensitivity):(this.eulerDelta.y=-e.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-e.movementY*this.mouseOrbitSensitivity)),"mouse"!==e.pointerType&&"drag"===this.rotByTouch&&(this.eulerDelta.y=-t*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-i*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=e=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?tj.isLocked=!0:tj.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document?.hidden)for(let e in this.movementState)this.movementState[e]=0},this.onKeyDown=e=>{!(e.target instanceof HTMLInputElement)&&("ArrowLeft"===e.code||"ArrowUp"===e.code||"ArrowRight"===e.code||"ArrowDown"===e.code||"Space"===e.code)&&e.preventDefault();for(let t of this.keyAssignments)if(e.key.toUpperCase()===t[1]||e.key===t[1]){this.movementState[t[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=e=>{for(let t of this.keyAssignments)if(e.key.toUpperCase()===t[1]||e.key===t[1]||e.code.slice(3,e.code.length).toUpperCase()===t[1]){this.movementState[t[0]]=0;break}},this.copyVRGamePadValues=(e,t)=>{for(let i=2;i<4;i++){let n=e.axes[i];0===t?2===i?this.movementState.movePosX=n:this.movementState.movePosZ=n:(e.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,2===i?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(n)>=.3&&(this.vrEulerYOffset+=n<0?1:-1),this.movementState.rotPosY=n):"fly"===this.moveMode&&(this.movementState.moveNegY=n))}},this.sharedGameControlGlobals=r.sharedGameControlGlobals,e===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),h=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,h,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||!0===this.cameraFollow)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),!0===this.cameraFollow){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy(this.camera?.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let e,t,i=new Vi(0,0,-1).applyQuaternion(this.camera.quaternion),n=(new Vi).subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(n),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ),Math.abs(i.y)<1e-6?(n.y=0,i.y=0,t=n.projectOnVector(i)):t=n.y/i.y>0?i.multiplyScalar(n.y/i.y):i.multiplyScalar(n.length()),this.targetToCamera0.copy(t).negate(),e=this.camera.position.clone().add(t),this.objectToTarget0.subVectors(e,this.position);let r=(new In).setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-r.x,r.x=0,r.z=0,r.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(r)}if(this.object instanceof YR&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=1*(i.speedTranslate??250),this.speedOrbit=.025*(i.speedRotate??100),this.mouseOrbitSensitivity=16e-6*(i.speedRotate??100),this.keyAssignments=i.keyAssignments.map((e=>{let t=[e[0],e[1]];return"\u25b2"===t[1]?t[1]="ArrowUp":"\u25c0"===t[1]?t[1]="ArrowLeft":"\u25bc"===t[1]?t[1]="ArrowDown":"\u25b6"===t[1]?t[1]="ArrowRight":"\u21e7"===t[1]?t[1]="Shift":"\u21b5"===t[1]?t[1]="Enter":"Space"===t[1]?t[1]=" ":"\u2318"===t[1]?t[1]="Meta":"Ctrl"===t[1]?t[1]="Control":"Esc"===t[1]&&(t[1]="Escape"),t})),"mouse"===i.rotBy){let e;e=this.keyAssignments.findIndex((e=>"rotNegX"===e[0])),-1!==e&&(this.keyAssignments[e][1]=""),e=this.keyAssignments.findIndex((e=>"rotPosX"===e[0])),-1!==e&&(this.keyAssignments[e][1]=""),e=this.keyAssignments.findIndex((e=>"rotPosY"===e[0])),-1!==e&&(this.keyAssignments[e][1]=""),e=this.keyAssignments.findIndex((e=>"rotNegY"===e[0])),-1!==e&&(this.keyAssignments[e][1]="")}this.lerpFactorPosStart=1-.02**(1/(60*(i.delayPos[0]??.3))),this.lerpFactorPosEnd=1-.02**(1/(60*(i.delayPos[1]??.3))),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/(60*(i.delayRot[0]??.3))),this.lerpFactorRotEnd=1-.02**(1/(60*(i.delayRot[1]??.3))),this.lerpFactorPosCamera=1-.02**(1/(60*(i.delayPosCamera??.3))),this.lerpFactorRotCamera=1-.02**(1/(60*(i.delayRotCamera??.3))),this.gravity=12*(this.gloabalPhysics.gravity??ax.defaultData.gravity),this.usePhysics=this.gloabalPhysics.usePhysics??ax.defaultData.usePhysics,this.jumpPower=20*i.jumpPower,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??Vx.defaultDataThirdPerson.orientWith,this.slopeThresh=65*Math.PI/180,"capsule"===i.collider.type?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*Bz/this.pixelsPerMeter,this.stepThresh=.3*i.collider.height/this.pixelsPerMeter,this.colliderHeight=i.collider.height):"sphere"===i.collider.type?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*Bz/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*.3/this.pixelsPerMeter,this.colliderHeight=2*i.collider.radius):(this.offset=i.collider.height*Bz/this.pixelsPerMeter,this.stepThresh=.3*i.collider.height/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let d=(new Vi).fromArray(i.collider.position),u=(new ji).setFromEuler((new In).fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(d).multiply(this.scale),this.collider.rotation.copy(u),this.collider.matrix.compose(d,u,Yz),void 0!==i.cameraXAxis&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let p=2*i.navmesh.destinationHelperRadius;if(p>0){let e=new wv;e.push({fi:0,data:{...VA.defaultData("light","phong"),alpha:0},id:"layer1"}),e.push({fi:0,data:{...VA.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let t=new WP({layers:e},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new Rr(O_.create({parameters:{width:p,height:p/10,hollow:.7}}),t),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let e=(new In).setFromQuaternion(this.quaternion,"YXZ"),t=e.y;this.objectRealQuat.copy(this.quaternion),e.y=0,this.quaternion.setFromEuler(e),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),e.set(0,t,0),this.quaternion.setFromEuler(e),this.rot.setFromEuler(e),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof YR?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();!0===this.cameraFollow&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){this.deactivate(),this.navMeshPathDest?.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;void 0!==e.gameActions&&(this.actions={},jx.list.forEach((i=>{this.actions[i]=Az({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)}))),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),xz(this.actions.idle),xz(this.actions.move),xz(this.actions.run),xz(this.actions.jump)}dispatchStartEvent(e){void 0!==this.actions[e]&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach((e=>{e.play()})),this.actions[e].Animation.forEach((e=>{e.play(!1===this.initialAction)})),this.actions[e].Create.forEach((e=>{e.dispatchStart()})),this.actions[e].Audio.forEach((e=>{e.dispatchGameControl("start")})),this.actions[e].Particles.forEach((e=>{e.dispatchGameControl("start")}))))}dispatchStopEvent(e){void 0!==this.actions[e]&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})})),this.actions[e].Create.forEach((e=>{e.dispatchStop()})),this.actions[e].Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.actions[e].Particles.forEach((e=>{e.dispatchGameControl("stop")}))))}get colliderWorldPosition(){return kz.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let n=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let r=60*n,s=!1;if(this.usePhysics&&this.collisionEnabled){let e=Fz.set(0,(0===this.velocity.y?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/120,1)*(this.gravity>0?1:-1):this.velocity.y)*n,0).divideScalar(this.pixelsPerMeter),t=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,e,this.object.rigidBody?.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(t){this.onObject=!0,this.groundNormal.set(t.normal2.x,t.normal2.y,t.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),0===t.collider.parent()?.bodyType()&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let e=t.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(t.rigidBody===e&&t.userData.isFollowingObj!==this.object.uuid){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(kz,Hz,Fz),this.groundVelocity.subVectors(kz,t.prevT),this.object.getWorldPosition(Fz).add(this.collider.position).sub(kz),this.groundYRotation=Wz.setFromQuaternion(Hz).y-t.prevR.y,Uz.copy(Fz).applyAxisAngle(qz,this.groundYRotation),this.groundVelocity.add(Uz.sub(Fz)).divideScalar(n);break}}else this.onObject=!1}if("walk"===this.moveMode&&this.collisionEnabled&&(1===this.movementState.jump&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*r),"fly"===this.moveMode&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,"+z"===this.forwardDir&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let e=this.navMeshPathDest.material;if("walk"===this.moveMode&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let t=kz.subVectors(this.path[1],this.position),i=Fz.subVectors(this.path[1],this.path[0]);t.dot(i)<0?this.path.shift():(this.directionXZ.x=i.x,this.directionXZ.z=i.z),e.opacity=e.userData.opacity0}else e.opacity-=.05*e.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,("walk"===this.moveMode?this.velocityTarget.x+this.velocityTarget.z===0:0===this.velocityTarget.manhattanLength())?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),"walk"===this.moveMode&&(this.lerpFactorPos.y=1),!1===this.didHit&&0===this.pushedVelocity.manhattanLength()||!1===this.usePhysics?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**r),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**r),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**r)):this.velocity.copy(this.velocityTarget),("walk"===this.moveMode?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=Nz.copy(this.velocity);if("none"!==this.orientMode&&!1===this.isFirstPerson){let e=Fz.copy(a);e.y=0,a.set(0,a.y,e.length()*("+z"===this.forwardDir?1:-1))}if(this.directionXZ.manhattanLength()>0&&"none"!==this.orientMode&&!1===this.isFirstPerson)if("camera"===this.orientWith&&this.path.length<=1){let e=kz;this.camera.getWorldDirection(e);let t=Uz.copy(qz).multiplyScalar(e.dot(qz));e.sub(t);let i=Fz.copy(this.directionXZ);i.x*=-1,this.rot.y=e.angleTo(i)*(e.cross(i).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*("+z"===this.forwardDir?1:-1);if(Wz.setFromVector3(this.rot),"walk"===this.moveMode&&(Wz.x=0),a.applyEuler(Wz),s&&(Hz.setFromUnitVectors(qz,this.groundNormal),a.applyQuaternion(Hz)),i){let e=Wz.set(0,this.vrEulerYOffset*ej,0);i.applyEuler(e),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*n}if(!0===this.usePhysics){let e=Fz;this.pushedVelocity.set(0,0,0);for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){let i=Uz.setFromMatrixPosition(t.matrixWorld).sub(t.prevT).divideScalar(n).divideScalar(this.pixelsPerMeter),r=t.rigidBody.collider(0).castCollider(i,this.object.rigidBody.collider(0),kz.copy(a).divideScalar(this.pixelsPerMeter),n,!1);i.multiplyScalar(this.pixelsPerMeter);let s=d_.is(t)?t:t.object;if(null!==r&&this.lastHitObj!==s){let e;t instanceof f_&&(e=t);let i=this.sharedGameControlGlobals.entityToCollisionEvents[s.uuid];if(i)for(let t of i)"character"===t.data.target&&(t.dispatch(e),s.dispatchEvent(EG));this.lastHitObj=s}if(null!==r){this.pushedVelocity.copy(i),e.copy(r.normal1).applyQuaternion(t.quaternion);break}}if(0!==this.pushedVelocity.manhattanLength()){let t=e.dot(a);t<0&&a.addScaledVector(e,-t),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),"normal"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)||"steer"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||"walk"===this.moveMode)?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,"normal"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)||"steer"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(n),this.rotVelocityStick),0===this.rotVelocityTarget.manhattanLength()?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**r):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**r),this.euler.x+=this.rotVelocity.x*n,this.euler.y+=this.rotVelocity.y*n+this.groundYRotation,0===this.rotVelocityTarget.y&&0===this.directionXZ.manhattanLength()?this.rotationAccumWhenOrientWithCamera=0:(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*n),!1===this.isFirstPerson&&"none"!==this.orientMode&&this.directionXZ.manhattanLength()>0){if("radial"===this.orientMode){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(qz,this.euler.y-this.euler0.y);let e=Fz.copy(this.objectToCamXZ).normalize(),t=Uz.copy(a).multiplyScalar(n);t.y=0;let i=t.sub(kz.copy(e).multiplyScalar(t.dot(e))).cross(e).y;this.euler.y-=Math.atan2(i,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*n+this.groundYRotation,0!==this.rotVelocityTarget.y&&(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.euler.y=this.rot.y);if(!0===this.cameraFollow&&("walk"===this.moveMode?"Limit"===this.cameraXAxis?this.euler.x=ui.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=ui.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):"Limit"===this.cameraXAxis&&(this.euler.x=ui.clamp(this.euler.x,-this.PI_2,this.PI_2))),"fly"===this.moveMode?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(Wz.copy(t),Wz.y=0):(Wz.copy(this.euler),Wz.y=0),this.nonColliderRotOffset.makeRotationFromEuler(Wz)),t&&("walk"===this.moveMode?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*ej),Gz.setFromAxisAngle(Qz,this.rot.x),Hz.setFromAxisAngle(qz,this.rot.y),Hz.multiply(Gz),Gz.setFromAxisAngle(Xz,this.rot.z),Hz.multiply(Gz),this.quaternion.copy(Hz),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let e=Fz.copy(a).multiplyScalar(n/this.pixelsPerMeter),t=null;this.didHit=!1;let i=new Vi;for(let n=0;n<5;n++){let r=e.length(),s=Uz.copy(e).normalize();if(t=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(i),this.colliderWorldQuat,s,this.object.rigidBody?.collider(0).shape,r,!1,24,void 0,void 0,this.object.rigidBody),null===t){0===n&&0!==this.directionXZ.manhattanLength()&&(this.lastHitObj=null),i.add(e);break}{this.didHit=!0;let a=this.sharedGameControlGlobals.colliderToEntity.get(t.collider.handle);if(a!==this.lastHitObj&&0===n){this.lastHitObj=a;let e=this.sharedGameControlGlobals.entityToCollisionEvents[a?.uuid];if(e)for(let i of e)if("character"===i.data.target){let e,n=(this.sharedGameControlGlobals.rapierWorld?.getCollider(t.collider.handle))._parent;if(a.cloner)for(let t of a.cloner.children)if(t.rigidBody===n){e=t;break}i.dispatch(e),a.dispatchEvent(EG)}}let o=Lz.set(t.normal2.x,t.normal2.y,t.normal2.z).applyQuaternion(this.colliderWorldQuat),l=Oz.copy(s).multiplyScalar(t.toi).dot(o),c=t.toi;if(0===c&&(this.position.y+=this.offset*this.pixelsPerMeter),l>this.offset&&(c=t.toi*(l-this.offset)/l,i.addScaledVector(s,c)),e.copy(s).multiplyScalar(r-c),Math.acos(-o.y)>this.slopeThresh){let n=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(i),r=Uz.copy(t.witness2).applyQuaternion(this.colliderWorldQuat);r.y=0;let s=n.add(r);s.y+=this.stepThresh;let a=this.sharedGameControlGlobals.rapierWorld.castShape(s,this.colliderWorldQuat,e,this.object.rigidBody?.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);null!==a&&0===a.toi&&(o.y=0,o.normalize())}e.addScaledVector(o,-e.dot(o))}}this.position.addScaledVector(i,this.pixelsPerMeter),this.object.rigidBody?.setTranslation(kz.copy(this.position).divideScalar(this.pixelsPerMeter),!0),this.object.rigidBody?.setRotation(Gz.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let e=this.onObject?1:5,t=a.multiplyScalar(n/e);for(let i=0;i<e;i++)this.position.add(t),this.collisionAdjustment(n/e)}else this.position.addScaledVector(a,n);if("walk"===this.moveMode&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),!0===this.cameraFollow){this.updateFollowArms();let e=this.objectToTarget.add(this.position),t=this.targetToCamera.add(e);zz.lookAt(t,e,qz).setPosition(t),zz.decompose(this.targetPos,this.targetQuat,kz),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**r),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**r),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),"Limit"===this.cameraYAxis&&"cartesian"===this.orientMode&&(this.euler.y=ui.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=ui.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent($z),(!(this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(void 0===this.camera||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate))||"fly"!==this.moveMode&&!0!==this.onObject&&!1!==this.collisionEnabled||!(null===this.navMeshPathDest||this.navMeshPathDest.material.opacity<-.04*this.navMeshPathDest?.material?.userData.opacity0))&&(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(Zz),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e,t=Gz.setFromAxisAngle(qz,"Limit"===this.cameraYAxis&&"radial"!==this.orientMode?ui.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&this.objectToTarget.applyQuaternion(t),e="Limit"===this.cameraXAxis?ui.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):ui.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=kz.copy(this.cameraPolarAxis0);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&i.applyQuaternion(t);let n=Hz.setFromAxisAngle(i,e);"Locked"!==this.cameraYAxis&&this.targetToCamera.applyQuaternion(t),"Locked"!==this.cameraXAxis&&this.targetToCamera.applyQuaternion(n)}groundTiltAdjustment(e){180*qz.angleTo(e)/Math.PI<15||180*qz.angleTo(e)/Math.PI>85?Gz.identity():Gz.setFromUnitVectors(qz,e),this.groundTilt.slerp(Gz,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){let t=Oz.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=zz.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(kz,Gz,Fz).compose(kz,Gz,Yz);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach((e=>{if(e===this.object||e.isDescendantOf(this.object))return;Jz.makeEmpty(),e.updateMatrixWorldSVD();let n=e.matrixWorldRigid,r=jz.copy(n).invert(),s=Vz.copy(jz).multiply(i);Kz.copy(this.collider.segment),Kz.start.applyMatrix4(s),Kz.end.applyMatrix4(s);let a=Lz.copy(this.position).applyMatrix4(r);Jz.expandByPoint(Kz.start),Jz.expandByPoint(Kz.end),Jz.min.addScalar(-this.collider.radius),Jz.max.addScalar(this.collider.radius),e.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder:e=>e.distanceToPoint(Kz.end),intersectsBounds:e=>e.intersectsBox(Jz),intersectsTriangle:e=>{let i=kz,r=Fz,s=e.closestPointToSegment(Kz,i,r);if(s<this.collider.radius){let e=this.collider.radius-s,o=r.sub(i).normalize(),l=Uz.copy(a);l.addScaledVector(o,e);let c=l.applyMatrix4(n).sub(this.position);t.add(c),Kz.start.addScaledVector(o,e),Kz.end.addScaledVector(o,e)}}})})),Jz.makeEmpty(),Kz.copy(this.collider.segment),Kz.start.applyMatrix4(i),Kz.end.applyMatrix4(i),Jz.expandByPoint(Kz.start),Jz.expandByPoint(Kz.end),Jz.min.addScalar(-this.collider.radius),Jz.max.addScalar(this.collider.radius),this.sharedGameControlGlobals.staticMeshBVH?.shapecast({traverseBoundsOrder:e=>e.distanceToPoint(Kz.end),intersectsBounds:e=>e.intersectsBox(Jz),intersectsTriangle:e=>{let i=kz,n=Fz,r=e.closestPointToSegment(Kz,i,n);if(r<this.collider.radius){let e=this.collider.radius-r,s=n.sub(i).normalize();this.alignToGround&&this.groundTiltAdjustment(s),t.addScaledVector(s,e),Kz.start.addScaledVector(s,e),Kz.end.addScaledVector(s,e)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let n=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(n),this.position.add(t)}},ij=tj;ij.isLocked=!1;var nj=u(m());function rj(e){let t=e.elements,i=t[0]**2+t[1]**2+t[2]**2,n=t[4]**2+t[5]**2+t[6]**2,r=t[8]**2+t[9]**2+t[10]**2,s=t[0]**2+t[4]**2+t[8]**2,a=t[1]**2+t[5]**2+t[9]**2,o=t[2]**2+t[6]**2+t[10]**2,l=1e-8;return i<l||n<l||r<l||s<l||a<l||o<l}function sj(e,t){let i=new yr;if(t&&rj(t))return i.setAttribute("position",new hr([],3)),i.setIndex([]),i;if(!e.getAttribute("position"))return i.setAttribute("position",new hr([],3)),i.setIndex([]),i;let{positions:n,triIndices:r}=PM(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new hr(n,3)),i.setIndex(r),t&&i.applyMatrix4(t),i}var aj=new bn,oj=new bn,lj=[[0,0,0],[0,0,0],[0,0,0]];function cj(e){let t=e.elements;lj[0][0]=t[0],lj[0][1]=t[4],lj[0][2]=t[8],lj[1][0]=t[1],lj[1][1]=t[5],lj[1][2]=t[9],lj[2][0]=t[2],lj[2][1]=t[6],lj[2][2]=t[10];let{u:i,v:n}=(0,nj.SVD)(lj),r=aj.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=oj.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1);return r.multiply(s.transpose())}var hj=class extends _h{constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.forEach((e=>{e.visible&&this.intersectObject(e,t,i)})),i}createRaycastLineHelper(){let e=new Zo({color:65280,linewidth:10}),t=new Vi(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new Vi(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),n=this.camera.far-this.camera.near,r=(new Vi).addVectors(t,i.multiplyScalar(n)),s=new yr;return s.setFromPoints([t,r]),new rl(s,e)}},dj=e=>e instanceof hB||e instanceof CN;function uj(e,t){return e.distance-t.distance}function pj(e,t,i){if(I_(t)&&t.visible){iB(t)&&t.raycast(e,i);for(let n of t.children)pj(e,n,i)}}function fj(e,t,i){if(!(arguments.length>3&&void 0!==arguments[3]&&arguments[3])&&!i.some((t=>void 0!==vj(e,t))))return[];let n=[];return t.children.forEach((t=>pj(e,t,n))),n.sort(uj),n}function mj(e){let t=[];if(e.length){let i=e[0].object;I_(i)&&t.push(i);let n=i.parent;for(;n;)dj(n)&&t.push(n),n=n.parent}return t}function gj(e,t,i,n){let r=e.frame;if(r){let e=t[0]*r.width,s=(1-t[1])*r.height;for(let t of i){let i=t===r.uuid?r:r.find(t);if(i?.intersects(e,s))return n(i),!0}}return!1}function vj(e,t){if(iB(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(dj(t))return yj(e,t)}function yj(e,t){if(I_(t)&&t.visible){if(iB(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let t=yj(e,i);if(t)return t}}}var bj=class{constructor(e,t,i,n,r,s,a,o){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=n,this.sharedAssets=r,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new hj,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents="window"===t.mouseEventTarget,this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){let{pageX:t,pageY:i}=e.touches?.length>0?e.touches[0]:e;this.pointerWorld=function(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-(t-(i.top+window.scrollY))/i.height*2+1}}(t,i,this._domRect),this.pointerScreen=function(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},Aj=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},xj=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],wj=e=>xj.find((t=>{let[i,n]=t;return n===e}))?.[0],Sj=e=>xj.find((t=>{let[i]=t;return i===e}))?.[1],_j=(e,t)=>{let i=wj(e);if(i){let e=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(e,"target",{writable:!1,value:t}),e}},Ej=class extends Aj{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{if(!e.eventName||!e.target||"Scroll"===e.eventName)return;let t=this.splineEvents[wj(e.eventName)]?.[e.target.uuid];if(!t)return;"Scroll"===e.eventName&&void 0!==e.deltaY&&Object.assign(t,{deltaY:e.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(t)}}connect(){let{page:e}=this.eventContext;e.traverseEntity((e=>{if(e.data?.events.length)for(let[t,i]of xj)if(e.data.events.some((e=>e.data.type===i&&!e.data.disabled))){this.objectsPerEvents.has(t)?this.objectsPerEvents.get(t)?.push(e):this.objectsPerEvents.set(t,[e]);let n={id:e.uuid,name:e.name},r=_j(i,n),s=this.splineEvents[t];s?s[e.uuid]=r:this.splineEvents[t]={[e.uuid]:r}}})),this.objectsPerEvents.forEach((e=>{e.forEach((e=>{e.addEventListener("beginEvent",this.onBeginEvent)}))}))}disconnect(){this.objectsPerEvents.forEach((e=>{e.forEach((e=>{e.removeEventListener("beginEvent",this.onBeginEvent)}))}))}},Cj=class{constructor(e,t,i,n,r,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,("KeyDown"===t.type||"KeyUp"===t.type||"KeyPress"===t.type)&&!t.key)throw new Error("Missing property");this.actions=Az(t,t.actions,n,r,s,i)}disconnect(){xz(this.actions)}dispatchHeld(e){this.actions.Create.forEach((t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()}))}dispatch(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),"MousePress"===this.data.type||"KeyPress"===this.data.type?this.entered||(this.entered=!0,this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent())),this.actions.Create.forEach((e=>e.dispatchStart()))):(this.actions.Transition.some((e=>e.playing&&"Toggle"!==e.data.runMode))||this.actions.Transition.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.SwitchCamera.some((e=>e.playing&&"Toggle"!==e.data.runMode))||this.actions.SwitchCamera.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.Animation.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()}))),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),!1===e&&this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Particles.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent())),this.actions.Create.forEach((e=>e.dispatchStop())))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent()))),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}},Mj=class extends Aj{constructor(e,t,i){super(e),this.eventManager=t,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=e=>{if(!0===this.useForRaycastProperty&&null===this.sceneInterects){this.eventContext.updateRaycaster(e);let{raycaster:t,page:i}=this.eventContext,n=fj(t,i,[],!0);this.sceneInterects=n,n.length&&(this.eventContext.sharedAssets.raycastProperty={x:n[0].point.x,y:n[0].point.y,z:n[0].point.z,objX:n[0].object.matrixWorld.elements[12],objY:n[0].object.matrixWorld.elements[13],objZ:n[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=e=>{(e.target===this.eventContext.domElement||"SPLINE-VIEWER"===e.target.tagName)&&this.canvasMouseEvents.forEach((t=>{("MouseDown"===t.data.type||"MousePress"===t.data.type)&&(this.onCanvasRaycast(e),t.dispatch())}))},this.onCanvasMouseUp=e=>{(e.target===this.eventContext.domElement||"SPLINE-VIEWER"===e.target.tagName)&&this.canvasMouseEvents.forEach((t=>{"MouseUp"===t.data.type?(this.onCanvasRaycast(e),t.dispatch()):"MousePress"===t.data.type&&t.dispatchRelease()}))},this.onMouseDown=e=>{Xg.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseEvent("MouseDown"))},this.onMouseUp=e=>{Xg.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=e=>{Xg.length>1||(this.eventContext.updateRaycaster(e),this.handleMousePressEvent())},this.onMousePressRelease=e=>{Xg.length>1||(this.eventContext.updateRaycaster(e),this.handleMousePressEvent(!0))},this.onKeyDown=e=>{this.heldKeys[e.key]||(this.handleKeyEvent(e,"KeyDown"),this.handleKeyEventHeld(e,"KeyDown",!0)),this.heldKeys[e.key]=!0},this.onKeyUp=e=>{this.handleKeyEvent(e,"KeyUp"),this.handleKeyEventHeld(e,"KeyUp",!0)},this.onKeyPressDown=e=>{this.heldKeysPress[e.key]?this.handleKeyEventHeld(e,"KeyPress"):(this.handleKeyEvent(e,"KeyPress"),this.handleKeyEventHeld(e,"KeyPress",!0)),this.heldKeysPress[e.key]=!0},this.onKeyPressUp=e=>{this.handleKeyEvent(e,"KeyPress",!0)},this.releaseHeldKey=e=>{delete this.heldKeys[e.key]},this.releaseHeldKeyPress=e=>{delete this.heldKeysPress[e.key]},this._onUserEvent=e=>{let{eventName:t,target:i,reverse:n}=e;if(!t||!i)return;let r=Sj(t);r&&("MouseDown"===r||"MouseUp"===r||"MousePress"===r?(i.dispatchEvent({type:"beginEvent",eventName:r}),this.eventsPerObjects[r]?.[i.uuid]?.forEach((e=>{e.dispatchUserEvent(n)}))):("KeyDown"===r||"KeyUp"===r||"KeyPress"===r)&&(i.dispatchEvent({type:"beginEvent",eventName:r}),this.eventsPerObjects[r]?.[i.uuid]?.forEach((e=>{e.dispatchUserEvent()}))))}}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext,n=(i,n)=>{if(!i.data?.events.length)return;let r=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let s of r){let r=this.eventsPerObjects[s];if(i.data.events.filter((e=>{let{data:t}=e;return t.type===s&&!0!==t.disabled})).forEach((n=>{let{id:s,data:a}=n;try{let n=new Cj(s,a,i,e,t,this.eventManager);n.actions.Video.length&&(this.hasVideoAction=!0),"MouseDown"!==a.type&&"MouseUp"!==a.type&&"MousePress"!==a.type||"Canvas"!==a.mode&&"Window"!==a.mode?(r[i.uuid]?r[i.uuid].some((e=>e.id===n.id))||r[i.uuid].push(n):r[i.uuid]=[n],i instanceof $N&&i.traverseChildren((e=>{if(!e.visible)return!0;e instanceof jD&&2!==e.data.geometry.shapeBlendNode?.operation&&(r[e.uuid]?r[e.uuid].push(n):r[e.uuid]=[n])}))):this.canvasMouseEvents.push(n)}catch(o){}})),r[i.uuid]?.length&&(this.objectsPerTypes[s].push(i instanceof CO&&("MouseDown"===s||"MouseUp"===s||"MousePress"===s)?n:i),i instanceof $N)){let e=this.objectsPerTypes[s];i.traverseChildren((t=>{if(!t.visible)return!0;t instanceof jD&&-1===e.indexOf(t)&&e.push(t)}))}}};e.traverseEntity((e=>{(e instanceof DN||e instanceof xN)&&e.frame?.traverse((t=>{n(t,e)})),n(e)})),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),(this.objectsPerTypes.MouseDown?.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),this.objectsPerTypes.MouseUp?.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),this.objectsPerTypes.MousePress?.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),this.objectsPerTypes.KeyDown?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),this.objectsPerTypes.KeyUp?.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),this.objectsPerTypes.KeyPress?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach((e=>{let[t,i]=e;i.forEach((e=>{e.addEventListener("userEvent",this._onUserEvent)}))}))}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach((e=>{Object.values(e).forEach((e=>{e.forEach((e=>{e.disconnect()}))}))})),this.canvasMouseEvents.forEach((e=>{e.disconnect()})),Object.entries(this.objectsPerTypes).forEach((e=>{let[t,i]=e;i.forEach((e=>{e.removeEventListener("userEvent",this._onUserEvent)}))}))}handleMouseEvent(e){let{stopRaycast:t,raycaster:i,page:n,pointerScreen:r}=this.eventContext,s=this.objectsPerTypes[e],a=s.filter((e=>!(e instanceof CO)));if((s.length||this.useForRaycastProperty)&&(!n.uiCanvas||!gj(n,[r.x,r.y],Object.keys(this.eventsPerObjects[e]),(t=>{this.handleObjectMouseEventDispatch(t,e)})))){if(t||this.useForRaycastProperty){let r;if(null===this.sceneInterects?r=fj(i,n,a,this.useForRaycastProperty):(r=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&r.length&&(this.eventContext.sharedAssets.raycastProperty={x:r[0].point.x,y:r[0].point.y,z:r[0].point.z,objX:r[0].object.matrixWorld.elements[12],objY:r[0].object.matrixWorld.elements[13],objZ:r[0].object.matrixWorld.elements[14]}),t){let t=[r[0]?.uv?.x??0,r[0]?.uv?.y??0];mj(r).forEach((i=>{i instanceof DN&&gj(i,t,Object.keys(this.eventsPerObjects[e]),(t=>{this.handleObjectMouseEventDispatch(t,e)})),this.eventsPerObjects[e][i.uuid]&&this.handleObjectMouseEventDispatch(i,e)}))}}t||a.forEach((t=>{let n=vj(i,t);n&&(this.handleObjectMouseEventDispatch(t,e),t instanceof DN&&gj(t,[n?.uv?.x??0,n?.uv?.y??0],Object.keys(this.eventsPerObjects[e]),(t=>{this.handleObjectMouseEventDispatch(t,e)})))}))}}handleMousePressEvent(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="MousePress",i=this.objectsPerTypes[t],n=i.filter((e=>!(e instanceof CO))),r=[];if(i.length){if(!e){let{stopRaycast:e,raycaster:i,page:s,pointerScreen:a}=this.eventContext,o=!1;if(s.uiCanvas&&(o=gj(s,[a.x,a.y],Object.keys(this.eventsPerObjects[t]),(e=>{r.push(e)}))),e&&!o){let e=fj(i,s,n);r=mj(e),e.forEach((e=>{e.object instanceof DN&&gj(e.object,[e?.uv?.x??0,e?.uv?.y??0],Object.keys(this.eventsPerObjects[t]),(e=>{r.push(e)}))}))}else n.forEach((e=>{let n=vj(i,e);n&&(r.push(e),e instanceof DN&&gj(e,[n?.uv?.x??0,n?.uv?.y??0],Object.keys(this.eventsPerObjects[t]),(e=>{r.push(e)})))}))}this._prevObjects.length&&this._prevObjects.forEach((e=>{r.includes(e)||this.handleObjectMouseEventDispatchRelease(e,t)})),r.length&&r.forEach((e=>{this.handleObjectMouseEventDispatch(e,t)})),this._prevObjects=r}}handleObjectMouseEventDispatch(e,t){e.dispatchEvent({type:"beginEvent",eventName:t}),this.eventsPerObjects[t]?.[e.uuid]?.forEach((e=>{e.dispatch()}))}handleObjectMouseEventDispatchRelease(e,t){e.dispatchEvent({type:"beginEvent",eventName:t}),this.eventsPerObjects[t]?.[e.uuid]?.forEach((e=>{e.dispatchRelease()}))}handleKeyEvent(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.objectsPerTypes[t].forEach((n=>{let r=this.eventsPerObjects[t][n.uuid];r.some((t=>{let{data:i}=t;return"key"in i&&i.key===e.key}))&&n.dispatchEvent({type:"beginEvent",eventName:t}),r.forEach((t=>{"key"in t.data&&t.data.key===e.key&&(i?t.dispatchRelease():t.dispatch(!0))}))}))}handleKeyEventHeld(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.objectsPerTypes[t].forEach((n=>{this.eventsPerObjects[t][n.uuid].forEach((t=>{"key"in t.data&&t.data.key===e.key&&t.dispatchHeld(i)}))}))}},Tj=new Vi,Ij=new Vi,Pj=class{constructor(e,t,i,n,r){this.actionsIn=Az(e,e.inActions,i,n,r,t),this.actionsOut=Az(e,e.outActions,i,n,r,t)}disconnect(){xz(this.actionsIn),xz(this.actionsOut)}},Dj=class extends Pj{constructor(e,t,i,n,r,s){super(t,i,n,r,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let n of this.objects)if(!n.visible)return;let e=Tj.setFromMatrixPosition(this.objects[0].matrixWorld),t=Ij.setFromMatrixPosition(this.objects[1].matrixWorld),i=e.distanceTo(t)<=this.distance?"in":"out";if(this.stage!==i){this.stage=i;let e="in"===i?this.actionsIn:this.actionsOut;e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Link.forEach((e=>e.dispatch())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}};let{distance:a,fromObject:o,toObject:l}=t.condition;this.distance=a;for(let c of[o,l]){if(!c)throw new Error("Missing property");let e=n.find(c);if(!e)throw new Error("Missing property");this.objects.push(e)}}connect(){window.setTimeout((()=>{this.objects.forEach((e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})),this.onUpdateMatrixWorld()}),0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach((e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}))}},Rj=class extends Pj{constructor(e,t,i,n,r,s){super(t,i,n,r,s),this.id=e,this.data=t,this.object=i,this.onBegin=e=>{let{target:t,state:i}=e;this.toState!==i&&(this.actionsOut.Audio.forEach((e=>e.dispatchConditional())),this.actionsOut.Particles.forEach((e=>e.dispatchConditional())),this.actionsOut.Video.forEach((e=>e.dispatchConditional())),this.actionsOut.Link.forEach((e=>e.dispatch())),this.actionsOut.Create.forEach((e=>e.dispatch())),this.actionsOut.Destroy.forEach((e=>e.dispatch())),this.actionsOut.Reset.forEach((e=>e.dispatch())),this.actionsIn.Transition.forEach((e=>e.pause())),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach((e=>e.play())),this.actionsOut.Animation.forEach((e=>e.play())),this.actionsIn.SwitchCamera.forEach((e=>e.pause())),this.actionsOut.SwitchCamera.forEach((e=>e.play())),this.actionsOut.SceneTransition.forEach((e=>e.dispatch())),this.actionsOut.SetVariable.forEach((e=>e.checkConditions())),this.actionsOut.SetVariable.forEach((e=>e.dispatch())),this.actionsOut.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actionsOut.ClearLocalStorage.forEach((e=>e.dispatch())),this.actionsOut.UserAPI.forEach((e=>e.dispatch())))},this.onComplete=e=>{let{target:t,state:i}=e;this.toState===i&&(this.actionsIn.Audio.forEach((e=>e.dispatchConditional())),this.actionsIn.Particles.forEach((e=>e.dispatchConditional())),this.actionsIn.Video.forEach((e=>e.dispatchConditional())),this.actionsIn.Link.forEach((e=>e.dispatch())),this.actionsIn.Create.forEach((e=>e.dispatch())),this.actionsIn.Destroy.forEach((e=>e.dispatch())),this.actionsIn.Reset.forEach((e=>e.dispatch())),this.actionsOut.Transition.forEach((e=>e.pause())),this.actionsOut.Transition.forEach((e=>e.pause())),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach((e=>e.play())),this.actionsIn.Animation.forEach((e=>e.play())),this.actionsOut.SwitchCamera.forEach((e=>e.pause())),this.actionsIn.SwitchCamera.forEach((e=>e.play())),this.actionsIn.SceneTransition.forEach((e=>e.dispatch())),this.actionsIn.SetVariable.forEach((e=>e.checkConditions())),this.actionsIn.SetVariable.forEach((e=>e.dispatch())),this.actionsIn.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actionsOut.ClearLocalStorage.forEach((e=>e.dispatch())),this.actionsOut.UserAPI.forEach((e=>e.dispatch())))};let{condition:a}=t;if(!a.object)throw new Error("Missing property");let o=n.find(a.object)??n.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!this.toObject.states?.[a.state])throw new Error("Missing property");this.toState=a.state}connect(){Tp(this.actionsOut).forEach((e=>{this.actionsOut[e]?.length&&this.toObject.addEventListener("beginState",this.onBegin)})),Tp(this.actionsIn).forEach((e=>{this.actionsIn[e]?.length&&this.toObject.addEventListener("completeState",this.onComplete)}))}disconnect(){super.disconnect(),Tp(this.actionsOut).forEach((e=>{this.actionsIn[e]?.length&&this.toObject.removeEventListener("beginState",this.onBegin)})),Tp(this.actionsIn).forEach((e=>{this.actionsIn[e]?.length&&this.toObject.removeEventListener("completeState",this.onComplete)}))}},Bj=class extends Aj{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity((i=>{if(i.data?.events.length)for(let{id:n,data:r}of i.data.events)if(!r.disabled&&"Conditional"===r.type)try{let s;"Comparison"===r.condition.type||("Distance"===r.condition.type?s=new Dj(n,r,i,e,t,this.eventManager):"State"===r.condition.type&&(s=new Rj(n,r,i,e,t,this.eventManager))),s&&(this.eventsPerConditions[r.condition.type].push(s),(s.actionsIn.Video.length||s.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch(nA){}})),Object.values(this.eventsPerConditions).forEach((e=>e.forEach((e=>e.connect()))))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach((e=>e.forEach((e=>e.disconnect()))))}},Lj=new Vi,Oj=new Vi,Nj=new Vi,kj=new Yr,Fj=new Vi,Uj=new Vi,zj=new Vi,jj=new ji,Vj=new In,Gj=new bn,Hj=new fi,Wj=new Vi,Qj=new Vi,qj=.2;function Xj(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var Yj=function(){let e=new bn;return(t,i,n)=>{let r=t.obj;e.copy(r.hiddenMatrix),null!==r.parent&&e.premultiply(r.parent.matrixWorld),e.invert(),r.position.copy(i),"global"===t.reference&&Xj(r.position,t.limits),r.position.applyMatrix4(e),"parent"===t.reference?Xj(r.position,t.limits):"local"===t.reference&&(jj.copy(t.quat0).invert(),r.position.sub(t.position0),r.position.applyQuaternion(jj),Xj(r.position,t.limits),jj.invert(),r.position.applyQuaternion(jj),r.position.add(t.position0)),e.multiply(n??r.matrixWorld).decompose(Fj,r.quaternion,Uj),r.updateMatrix(),r.hasNonUniformScale&&(r.updateMatrixWorld(),r.updateMatrixWorldSVD()),r instanceof sT&&nB(r.parent)&&r.invalidateDownstreamBooleanData(!0)}}(),Kj=class{constructor(e,t,i,n,r,s,a){this.object=e,this.id=t,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=0===this.data.resetSpeed?1:8/this.data.resetSpeed+1,this.snapDampingFactor=0===this.data.snapSpeed?1:8/this.data.snapSpeed+1,this.actionsDrag=Az(i,i.dragDropActions.drag,n,r,s,this.object),this.actionsDrop=Az(i,i.dragDropActions.drop,n,r,s,this.object);let o=[];this.data.objects.forEach((e=>{let t=n.find(e);!t||!1!==t.data.visible&&(o.push(t),a[t.uuid]&&a[t.uuid].forEach((e=>{let t=n.find(e);!t||!1!==t.data.visible&&o.push(t)})))})),this.data.dropDestinations.forEach((e=>{let t=n.find(e);!t||!1!==t.data.visible&&(this.dropDestIds.push(t.uuid),a[t.uuid]&&a[t.uuid].forEach((e=>{let t=n.find(e);!t||!1!==t.data.visible&&this.dropDestIds.push(t.uuid)})))})),this.dragItems=o.map((e=>("locked"===this.data.planeMode&&(e.userData.lockedPlane=!0),e.userData.worldPosition0=(new Vi).setFromMatrixPosition(e.matrixWorld),{obj:e,fromPosition:(new Vi).setFromMatrixPosition(e.matrixWorld),pointStart:new Vi,pointEnd:new Vi,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:(new Vi).copy(e.position),quat0:(new ji).copy(e.quaternion),snapped:!1,orientationMatrix:new bn,limits:this.data.limits,reference:this.data.referenceFrame})))}get activeDragItem(){return null!==this.activeIdx?this.dragItems[this.activeIdx]:null}dispose(){xz(this.actionsDrag),xz(this.actionsDrop),this.dragItems.forEach((e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()}))}},Jj=class extends Aj{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=e=>{if(Xg.length>1)return;this.eventContext.updateRaycaster(e);let{raycaster:t,page:i}=this.eventContext,n=i.raycastWithClones(t);if(this.lastDropDestination=null,0!==n.length){for(let e of this.events){let t=0;for(let{obj:i,pointEnd:r,pointStart:s}of e.dragItems){if(i===n[0].object||i===n[0].object.object||d_.is(i)&&i.isAncestorOf(n[0].object.uuid)){if(e.activeIdx=t,e.activeDragItem.reset=!1,e.activeDragItem.currentDampingFactor=e.data.dampingFactor,e.activeDragItem.snapped=!1,"hand"===e.data.cursor&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){e.activeDragItem.obj.rigidBody&&e.activeDragItem.obj.rigidBody.setBodyType(2,!0);let t=e.activeDragItem.obj;i.hasNonUniformScale&&i.updateMatrixWorldSVD(),(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(Fj,jj,Uj),Vj.setFromQuaternion(jj),void 0===t.prevR?(t.prevR=Vj.clone(),t.prevT=Fj.clone()):(t.prevR.copy(Vj),t.prevT.copy(Fj)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(e.activeDragItem.obj)}return this.calcPlaneIntersectPos(i,s,e.data.plane,e.data.referenceFrame),r.copy(s),(this.eventManager.controlsManager.usePhysics&&"dynamic"===i.data.physics?.rigidBody||!1===e.data.drop||!1===e.data.resetOnSnapFail)&&e.activeDragItem.fromPosition.setFromMatrixPosition(e.activeDragItem.obj.matrixWorld),this.activeEvent=e,void(this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1))}t++}}this.activeEvent=null}else this.activeEvent=null},this.onPointerMove=e=>{if(Xg.length>1)return;this.eventContext.updateRaycaster(e);let{raycaster:t,page:i}=this.eventContext,n=i.raycastWithClones(t);if(0!==Xg.length){if(this.activeEvent&&this.activeEvent.activeDragItem){let e,t=this.activeEvent.activeDragItem;if(t.snapped=!1,this.activeEvent.data.drop&&(e=n.filter((e=>t.obj!==e.object&&!t.obj.isAncestorOf(e.object.uuid)&&!(e.object instanceof hB)&&("all"===this.activeEvent.data.dropOn||this.activeEvent.dropDestIds.some((t=>t===e.object.uuid||i.scene.find(t).isAncestorOf(e.object.uuid))))))[0]),e){let i=zj.copy(e.face.normal).applyMatrix3(Hj.getNormalMatrix(e.object.matrixWorld));if("center"===this.activeEvent.data.snapTo)t.fromPosition.setFromMatrixPosition(e.object.matrixWorld);else if("surface"===this.activeEvent.data.snapTo){if(t.fromPosition.copy(e.point),"bbox"===this.activeEvent.data.snapSurfaceMode){Fj.copy(i).applyMatrix3(Hj.setFromMatrix4(t.obj.matrixWorld).transpose());let e=t.obj;Fj.x>qj?Uj.x=-e.recursiveBBox.min.x:Fj.x<-qj&&(Uj.x=-e.recursiveBBox.max.x),Fj.y>qj?Uj.y=-e.recursiveBBox.min.y:Fj.y<-qj&&(Uj.y=-e.recursiveBBox.max.y),Fj.z>qj?Uj.z=-e.recursiveBBox.min.z:Fj.z<-qj&&(Uj.z=-e.recursiveBBox.max.z),Uj.applyMatrix3(Hj.invert())}else Uj.copy(i).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);t.fromPosition.add(Uj)}this.activeEvent.data.autoOrient&&(Fj.set(0,1,0).cross(i),Fj.length()<1e-4&&Fj.set(-1,0,0).cross(i),Uj.crossVectors(zj,Fj),t.orientationMatrix.makeBasis(Fj,Uj,i)),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart),t.currentDampingFactor=this.activeEvent.snapDampingFactor,t.snapped=!0,this.lastDropDestination!==e.object&&(this.lastDropDestination=e.object,this.activeEvent.actionsDrop.Transition.forEach((e=>{e.play()})),this.activeEvent.actionsDrop.Animation.forEach((e=>{e.play()})),this.activeEvent.actionsDrop.Audio.forEach((e=>{e.dispatchGameControl("start")})),this.activeEvent.actionsDrop.Particles.forEach((e=>{e.dispatchGameControl("start")})),this.activeEvent.actionsDrop.Create.forEach((e=>{e.dispatchThrottled()})))}else t.orientationMatrix.makeRotationFromQuaternion(t.quat0),this.lastDropDestination=null,t.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(t.obj,t.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrop.Animation.forEach((e=>{e.stop()})),this.activeEvent.actionsDrop.Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrop.Particles.forEach((e=>{e.dispatchGameControl("stop")}));this.activeEvent.actionsDrag.Create.forEach((e=>{e.dispatchThrottled()})),this.activeEvent.actionsDrag.SetVariable.forEach((e=>e.checkConditions())),this.activeEvent.actionsDrag.SetVariable.forEach((e=>e.dispatch())),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach((e=>e.dispatch())),this.activeEvent.actionsDrag.ClearLocalStorage.forEach((e=>e.dispatch())),this.activeEvent.actionsDrag.UserAPI.forEach((e=>e.dispatch())),!1===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach((e=>{e.play()})),this.activeEvent.actionsDrag.Animation.forEach((e=>{e.play()})),this.activeEvent.actionsDrag.Audio.forEach((e=>{e.dispatchGameControl("start")})),this.activeEvent.actionsDrag.Particles.forEach((e=>{e.dispatchGameControl("start")}))),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout((()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Particles.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrag.Animation.forEach((e=>{e.stop()})))}),500),this.updateDragItem(t),t.obj.dispatchEvent({type:"requestRender"})}}else{let e=!1;for(let t of this.events){for(let{obj:i}of t.dragItems)if(i===n[0]?.object||i===n[0]?.object?.object||d_.is(i)&&i.isAncestorOf(n[0]?.object.uuid)){switch(e=!0,t.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move")}break}if(e)break}e||this.setCursor("default")}},this.onPointerUp=e=>{if(this.activeEvent&&this.activeEvent.activeDragItem){"hand"===this.activeEvent.data.cursor&&this.setCursor("grab");let e="dynamic"===this.activeEvent.activeDragItem.obj.data.physics?.rigidBody;!1===this.activeEvent.activeDragItem.snapped&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(!1===this.eventManager.controlsManager.usePhysics||!e)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&e&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),!0===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrag.Animation.forEach((e=>{e.stop()})),this.activeEvent.actionsDrag.Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Particles.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrop.SetVariable.forEach((e=>e.checkConditions())),this.activeEvent.actionsDrop.SetVariable.forEach((e=>e.dispatch())),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach((e=>e.dispatch())),this.activeEvent.actionsDrop.ClearLocalStorage.forEach((e=>e.dispatch())),this.activeEvent.actionsDrop.UserAPI.forEach((e=>e.dispatch()))),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity((t=>{t.component&&(e[t.component.uuid]?e[t.component.uuid].push(t.uuid):e[t.component.uuid]=[t.uuid])})),this.eventContext.page.traverseEntity((t=>{t.data?.events.filter((e=>"DragDrop"===e.data.type&&!e.data.disabled)).forEach((i=>{this.events.push(new Kj(t,i.id,i.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))}))})),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach((e=>e.dispose()))}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,n){let{getCamera:r,raycaster:s}=this.eventContext;r().getWorldDirection(Oj),Oj.negate();let a=jj.identity();switch("parent"===n?Gj.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(Fj,a,Uj):"local"===n&&e.matrixWorld.decompose(Fj,a,Uj),i){case"x":Fj.set(1,0,0).applyQuaternion(a),Wj.copy(Oj).cross(Fj),Qj.copy(Fj).cross(Wj);break;case"y":Fj.set(0,1,0).applyQuaternion(a),Wj.copy(Oj).cross(Fj),Qj.copy(Fj).cross(Wj);break;case"z":Fj.set(0,0,1).applyQuaternion(a),Wj.copy(Oj).cross(Fj),Qj.copy(Fj).cross(Wj);break;case"xy":Qj.set(0,0,1).applyQuaternion(a);break;case"yz":Qj.set(1,0,0).applyQuaternion(a);break;case"xz":Qj.set(0,1,0).applyQuaternion(a);break;case"adaptive":Oj.angleTo(Uj.set(0,1,0))>Math.PI/6?(Fj.crossVectors(Uj.set(0,1,0),Oj),Qj.crossVectors(Fj,Uj)):Qj.set(0,1,0);break;default:Qj.copy(Oj)}Nj.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:Nj;if(kj.setFromNormalAndCoplanarPoint(Qj,o),s.ray.intersectPlane(kj,t)&&("x"===i||"y"===i||"z"===i)){let e=Uj.subVectors(t,o).dot(Fj);t.copy(o).addScaledVector(Fj,e)}}updateDragItem(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Nj.setFromMatrixPosition(e.obj.matrixWorld),"current"===e.reset?Lj.subVectors(e.fromPosition,Nj).divideScalar(e.currentDampingFactor):"original"===e.reset?(Lj.subVectors(e.obj.userData.worldPosition0,Nj).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):Lj.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(Nj).divideScalar(e.currentDampingFactor),e.paused=!(e.currentDampingFactor>1)||Lj.length()<.01,(this.activeEvent&&1===this.activeEvent.data.dampingFactor||t)&&Yj(e,Lj.add(Nj),this.activeEvent?.data.drop&&this.activeEvent?.data.autoOrient?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},Zj=new Vi,$j=new Vi,eV=new Vi,tV=new Vi,iV=new Yr,nV={type:"requestRender"},rV=function(){let e=new Vi,t=new Vi;return(i,n,r)=>r>0?(e.subVectors(i,n),e.length()<=r?i:t.copy(n).add(e.normalize().multiplyScalar(r))):n}(),sV=function(){let e=new bn;return(t,i)=>{t.position.copy(i),null!==t.parent&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof sT&&nB(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),aV=class{constructor(e,t,i,n,r,s){this.data=e,this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new Vi,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...zb.defaultData,...e,...void 0===e.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===e.target||"cursor"===e.target||(this.target=n.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=Az(e,e.actions,n,r,s,i)}},oV=class extends Aj{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=e=>{if(!(Xg.length>1)){this.eventContext.updateRaycaster(e);for(let e of this.events)void 0===e.target&&this.updateSingleEvent(e)}},this.onMouseEnter=e=>{for(let t of this.events)void 0===t.target&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)void 0===t.target&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity((t=>{let i=t.data?.events.find((e=>"Follow"===e.data.type&&!e.data.disabled));i&&(!e.data.globalPhysics.usePhysics||"dynamic"!==t.dataPatched.physics?.rigidBody)&&this.events.push(new aV(i.data,i.id,t,e,this.eventContext.sharedAssets,this.eventManager))})),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),Vg&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let n of this.events)if(void 0!==n.target){let e=n.target,t=this.onTargetChange(n);this.pairOfEventListeners.push([e,t]),e.addEventListener("requestRender",t)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Vg&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let i of this.events)i.paused=!0,i.isReset=!1,xz(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.events.forEach((e=>{e.actions.Create.forEach((e=>{e.dispatchThrottled()}))}));let{plane:i,limitDistance:n,limitDistanceEnabled:r}=e.data;if(e.object.getWorldPosition(eV),e.isReset)tV.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(tV);else{let{getCamera:e,raycaster:t}=this.eventContext;if("custom"===i?(e().getWorldDirection($j),$j.negate(),Zj.copy($j)):"xy"===i?Zj.set(0,0,1):"xz"===i?Zj.set(0,1,0):"yz"===i&&Zj.set(1,0,0),iV.setFromNormalAndCoplanarPoint(Zj,eV),!t.ray.intersectPlane(iV,tV))return}if(!e.isReset)if(tV.distanceTo(e.worldPosition0)>n&&r&&e.target){if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&null!==e.timeoutId&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,!e.data.resetAfterDistanceLimit)return;tV.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor}else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout((()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)}),1e3*e.data.snapDelay)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),!1===e.delayFinished)return;!1===e.data.enabledTranslation[0]&&(tV.x=eV.x),!1===e.data.enabledTranslation[1]&&(tV.y=eV.y),!1===e.data.enabledTranslation[2]&&(tV.z=eV.z);let s=rV(eV,tV,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let i=Zj.subVectors(s,eV).divideScalar(e.currentDampingFactor);eV.add(i),t&&sV(e.object,eV),e.paused=i.length()<.01}else sV(e.object,s),e.paused=!0;e.object?.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(nV)}},lV=new Vi,cV=new Vi,hV=new bn,dV=new ji,uV=new ji,pV=new Vi,fV=new Vi,mV=new Vi,gV=new Vi,vV=new Yr,yV={type:"requestRender"},bV={type:"changeRotation"},AV=function(){let e=new bn;return function(t,i){null!==t.parent?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(cj(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof sT&&nB(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),xV=class{constructor(e,t,i,n){this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new ji,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...jb.defaultData,...e,...void 0===e.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===e.target||"cursor"===e.target||(this.target=n.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},wV=class extends Aj{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!(Xg.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let e of this.events)void 0===e.target&&this.updateSingleEvent(e)}},this.onMouseEnter=e=>{for(let t of this.events)void 0===t.target&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)void 0===t.target&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let e=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(e)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>t=>{let{eventName:i,target:n}=t;if(!i||!n)return;let r=Sj(i);r&&"LookAt"===r&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity((t=>{let i=t.data?.events.find((e=>"LookAt"===e.data.type&&!e.data.disabled));i&&(!e.data.globalPhysics.usePhysics||"dynamic"!==t.dataPatched.physics?.rigidBody)&&this.events.push(new xV(i.data,i.id,t,e))})),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),Vg&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let n of this.events){if(void 0!==n.target){let e=this.onTargetChange(n),t=n.target;this.pairOfEventListeners.push([t,e]),t.addEventListener("requestRender",e)}let e=this.createUserEventListener(n),t=n.object;this.pairOfUserEventListeners.push([t,e]),t.addEventListener("userEvent",e)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Vg&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let[i,n]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",n);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){let{tilt:t,axis:i,distance:n,plane:r,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=e.data,{getCamera:l,raycaster:c}=this.eventContext,{object:h,target:d}=e;if(h.getWorldPosition(pV),!e.isReset)if(e.target)e.target.getWorldPosition(fV);else{if("custom"===r?(l().getWorldDirection(cV),cV.negate(),vV.setFromNormalAndCoplanarPoint(cV,pV)):("xy"===r?lV.set(0,0,1):"xz"===r?lV.set(0,1,0):"yz"===r&&lV.set(1,0,0),vV.setFromNormalAndCoplanarPoint(lV,pV)),!c.ray.intersectPlane(vV,fV))return;n>0&&("custom"===r||void 0===r)&&fV.addScaledVector(cV,n)}if(e.isReset||(d?"target"===t?mV.copy(d.up).applyMatrix4(hV.extractRotation(d.matrixWorld)).normalize():a.some((e=>!1===e))?("x"===i?(gV.set(0,0,1),!1===a[2]&&gV.set(0,1,0)):"y"===i?(gV.set(1,0,0),!1===a[0]&&gV.set(0,0,1)):(gV.set(0,1,0),!1===a[1]&&gV.set(1,0,0)),mV.copy(gV).applyQuaternion(e.worldQuaternion0).normalize()):mV.set(0,1,0):"custom"===r?mV.set(0,1,0):mV.copy(lV)),e.isReset)uV.copy(e.worldQuaternion0);else if(pV.distanceTo(fV)>s&&o&&d){if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&null!==e.timeoutId&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,!e.data.resetAfterDistanceLimit)return;uV.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor}else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout((()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)}),1e3*e.data.snapDelay)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),!1===e.delayFinished)return;(function(e,t,i,n,r,s){let a=e.elements;EV.subVectors(t,i),0===EV.lengthSq()&&(EV.z=1),EV.normalize(),_V.crossVectors(n,EV),0===_V.lengthSq()&&(1===Math.abs(n.z)?EV.x+=1e-4:EV.z+=1e-4,EV.normalize(),_V.crossVectors(n,EV)),_V.normalize(),SV.crossVectors(EV,_V),"x"===r?1===s.z?[_V,SV,EV]=[EV,_V,SV]:(_V.negate(),[_V,EV]=[EV,_V]):"y"===r?1===s.x?[_V,SV,EV]=[SV,EV,_V]:(_V.negate(),[SV,EV]=[EV,SV]):1===s.x&&(_V.negate(),[_V,SV]=[SV,_V]),a[0]=_V.x,a[4]=SV.x,a[8]=EV.x,a[1]=_V.y,a[5]=SV.y,a[9]=EV.y,a[2]=_V.z,a[6]=SV.z,a[10]=EV.z})(hV,fV,pV,mV,i,gV),uV.setFromRotationMatrix(hV),dV.setFromUnitVectors(gV.applyQuaternion(uV),mV),a.some((e=>!1===e))&&"target"!==t&&uV.premultiply(dV).normalize()}e.currentDampingFactor>1?(h.updateWorldMatrix(!0,!1),dV.setFromRotationMatrix(cj(h.matrixWorld)),dV.slerp(uV,1/e.currentDampingFactor),AV(h,hV.makeRotationFromQuaternion(dV)),e.paused=8*(1-dV.dot(uV))<1e-6):(AV(h,hV.makeRotationFromQuaternion(uV)),e.paused=!0),e.object?.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),h.dispatchEvent(yV),h.dispatchEvent(bV)}},SV=new Vi,_V=new Vi,EV=new Vi;var CV=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=Az(t,t.actions,n,r,s,i)}disconnect(){xz(this.actions)}dispatchEnter(){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.entered||(this.entered=!0,this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.play())),this.actions.Create.forEach((e=>e.dispatchStart())),this.actions.Particles.forEach((e=>e.dispatchBasic())),this.actions.Destroy.forEach((e=>e.dispatch())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent())),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch())))}dispatchLeave(){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.entered&&(this.entered=!1,this.actions.Create.forEach((e=>e.dispatchStop())),this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Particles.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent())))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Particles.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.Create.forEach((e=>e.dispatch())),this.actions.Particles.forEach((e=>e.dispatchBasic())),this.actions.Destroy.forEach((e=>e.dispatch())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent()))),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}},MV=class extends Aj{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=e=>{Xg.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseHoverEvent())},this.onMouseUp=e=>{Xg.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=e=>{Xg.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseHoverEvent())},this.onUserEvent=e=>{let{eventName:t,target:i,reverse:n}=e;if(!t||!i)return;let r=Sj(t);r&&"MouseHover"===r&&(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach((e=>e.dispatchUserEvent(n))))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,i=(i,n)=>{if(i.visible&&i.data?.events.length){for(let{id:n,data:s}of i.data.events)if(!s.disabled&&"MouseHover"===s.type)try{let r=new CV(n,s,i,e,t,this.eventManager);this.eventsPerObjects[i.uuid]?this.eventsPerObjects[i.uuid].push(r):this.eventsPerObjects[i.uuid]=[r]}catch(r){}this.eventsPerObjects[i.uuid]?.length&&this.objects.push(i instanceof CO?n:i)}};if(e.traverseEntity((e=>{(e instanceof DN||e instanceof xN)&&e.frame?.traverse((t=>{i(t,e)})),i(e)})),!this.objects.length)return;let{domElement:n}=this.eventContext;this.domEventsNeeded.clear(),Vg&&(this.domEventsNeeded.add("pointerdown"),n.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),n.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),n.addEventListener("pointermove",this.onMouseMove),this.objects.forEach((e=>{e.addEventListener("userEvent",this.onUserEvent)}))}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),Vg&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach((e=>{e.forEach((e=>{e.disconnect()}))})),this.objects.forEach((e=>{e.removeEventListener("userEvent",this.onUserEvent)}))}handleMouseHoverEvent(){let e=[];if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){let{stopRaycast:t,raycaster:i,page:n,pointerScreen:r}=this.eventContext,s=!1;if(n.uiCanvas&&(s=gj(n,[r.x,r.y],Object.keys(this.eventsPerObjects),(t=>{e.push(t)}))),t&&!s){let t=fj(i,n,this.objects);e=mj(t),t.forEach((t=>{t.object instanceof DN&&gj(t.object,[t?.uv?.x??0,t?.uv?.y??0],Object.keys(this.eventsPerObjects),(t=>{e.push(t)}))}))}else this.objects.forEach((t=>{let n=vj(i,t);n&&(e.push(t),t instanceof DN&&gj(t,[n?.uv?.x??0,n?.uv?.y??0],Object.keys(this.eventsPerObjects),(t=>{e.push(t)})))}))}this._prevObjects.length&&this._prevObjects.forEach((t=>{e.includes(t)||(t.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[t.uuid]?.forEach((e=>e.dispatchLeave())))})),e.length&&e.forEach((e=>{e.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[e.uuid]?.forEach((e=>e.dispatchEnter()))})),this._prevObjects=e}},TV=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=Az(t,t.actions,n,r,s,i)}connect(){this.scrollCounter=0}disconnect(){xz(this.actions)}dispatch(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}));let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach((e=>e.seek(i))),this.actions.Animation.forEach((e=>e.seek(t))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>{e.playFromCurrent()})),this.actions.Animation.forEach((e=>{e.playFromCurrent()}))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}},IV=class{constructor(e,t,i,n,r,s,a){this.id=e,this.data=t,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=Az(t,t.actions,n,r,a,i)}getStickyParentElement(){let e=this.domElement;for(;e;){if("sticky"===window.getComputedStyle(e).position)return e;e=e.parentElement}return null}computeScrollBounds(){let e=this.getStickyParentElement(),t=e?.parentElement,i=this.domElement.getBoundingClientRect(),n={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(t){let r=t.getBoundingClientRect(),s=window.getComputedStyle(e),a=parseFloat(s.marginTop)+parseFloat(s.marginBottom),o=parseFloat(s.top),l=parseFloat(s.bottom),c=r.height-a;if(isNaN(o)){if(!isNaN(l)){let e=document.body.clientHeight??window.innerHeight,t=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===e-l?(n.top+=r.top-i.height+l+t,n.bottom+=r.top-i.height+l+t):i.bottom<e-l&&(n.top-=c-i.height,n.bottom-=c-i.height)}}else i.top===o?(n.top+=r.top-o,n.bottom+=r.top-o):i.top<0&&(n.top-=c-i.height,n.bottom-=c-i.height)}let r=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||r.scrollTop,o=s.clientTop||r.clientTop||0,l=Math.round(n.top+a-o);if("enter"===this.data.startFrom){let e=window.innerHeight,t=n.height,i=this.data.enterAnchor,r="top"===i?e:"bottom"===i?e-t:e-.5*t;this.scrollStart=l-r}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=n,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){xz(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return void 0===this.box||0===this.box.width&&0===this.box.height&&0===this.box.top&&0===this.box.bottom}computeScroll(e){let{x:t,y:i}=e;this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}));let n=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(i-this.scrollStart)/n));this.actions.Transition.forEach((e=>e.seek(r))),this.actions.Animation.forEach((e=>e.seek(r))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>{e.playFromCurrent()})),this.actions.Animation.forEach((e=>{e.playFromCurrent()}))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}},PV=class extends Aj{constructor(e,t){super(e),this.managers=t,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach((e=>{let[t,i]=e;i.forEach((e=>e.handleResize()))}))},this.onScroll=e=>{if(!this.isInview)return;let t={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach((e=>{let[i,n]=e;i.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:t}),n.forEach((e=>e.dispatch(t)))}))},this.onWheel=e=>{!this.isInview||e.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach((t=>{let[i,n]=t;i.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:e.deltaY}),n.forEach((t=>t.dispatch(e.deltaY)))}))},this.onUserEvent=e=>{let{eventName:t,target:i,reverse:n}=e;if(!t||!i)return;let r=Sj(t);r&&"Scroll"===r&&(i.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),this.wheelEventsPerObject.get(i)?.forEach((e=>{e.dispatchUserEvent(n)})))}}connect(){let{page:e,sharedAssets:t,domElement:i,isExport:n}=this.eventContext,r=r=>{if(r.data?.events.length)for(let{id:s,data:a}of r.data.events)if(!a.disabled&&"Scroll"===a.type)if("load"!==a.trigger&&n){let n=new IV(s,a,r,e,t,i,this.managers);this.scrollEventsPerObject.has(r)?this.scrollEventsPerObject.get(r)?.push(n):this.scrollEventsPerObject.set(r,[n])}else{let i=new TV(s,a,r,e,t,this.managers);this.wheelEventsPerObject.has(r)?this.wheelEventsPerObject.get(r)?.push(i):this.wheelEventsPerObject.set(r,[i])}};e.traverseEntity((e=>{(e instanceof DN||e instanceof xN)&&e.frame?.traverse((e=>{r(e)})),r(e)})),this.intersectionObserver=new IntersectionObserver((e=>{let t=e[0];t&&(this.isInview=t.isIntersecting)}),{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach((e=>{let[t,i]=e;i.forEach((e=>e.connect())),t.addEventListener("userEvent",this.onUserEvent)})),[...this.scrollEventsPerObject.entries()].forEach((e=>{let[t,i]=e;i.forEach((e=>e.connect())),t.addEventListener("userEvent",this.onUserEvent)})),[...this.wheelEventsPerObject.values()].some((e=>e.length))&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some((e=>e.length))&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach((e=>{let[t,i]=e;i.forEach((e=>e.disconnect())),t.removeEventListener("userEvent",this.onUserEvent)})),[...this.scrollEventsPerObject.entries()].forEach((e=>{let[t,i]=e;i.forEach((e=>e.disconnect())),t.removeEventListener("userEvent",this.onUserEvent)}))}},DV=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=Az(t,t.actions,n,r,s,i)}disconnect(){xz(this.actions)}dispatch(){this.actions.Transition.forEach((e=>{e.play()})),this.actions.Animation.forEach((e=>{e.play()})),this.actions.SwitchCamera.forEach((e=>{e.play()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch())),this.actions.Create.forEach((e=>{e.dispatchFromStart()})),this.actions.Destroy.forEach((e=>{e.dispatchFromStart()}))}dispatchAfter(e){this.actions.Audio.forEach((t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof dF?t.interaction.audioPlayer.play():t.interaction instanceof uF&&t.interaction.dispatch())})),this.actions.Video.forEach((t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof _z?t.interaction.play("autoplay"===i):t.interaction instanceof Ez&&t.interaction.dispatch())})),this.actions.Particles.forEach((t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()}))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent()))),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.Reset.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch())),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch()})),this.actions.Audio.forEach((e=>{e.interaction instanceof dF?e.interaction.audioPlayer.play():e.interaction instanceof uF&&e.interaction.dispatch()})),this.actions.Video.forEach((e=>{e.interaction instanceof _z?e.interaction.play():e.interaction instanceof Ez&&e.interaction.dispatch()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()}))}},RV=class extends Aj{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>{e.dispatchAfter("mouseDown")}))}))},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>{e.dispatchAfter("keyDown")}))}))},this.onAny=()=>{let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>{e.dispatchAfter("any")}))}))},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>{e.actions.Audio.forEach((e=>{e.interaction instanceof dF&&e.interaction.audioPlayer.play()})),e.actions.Video.forEach((e=>{let t=e.interaction.data.triggerAfter??"autoplay";e.interaction instanceof _z&&e.interaction.play("autoplay"===t)})),e.actions.Particles.forEach((e=>{e.dispatchBasic()}))}))}))},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>{e.dispatchAfter("autoplay")}))}))},this.onUserEvent=e=>{let{eventName:t,target:i,reverse:n}=e;if(!t||!i)return;let r=Sj(t);r&&"Start"===r&&(i instanceof CO||i.dispatchEvent({type:"beginEvent",eventName:"Start"}),this.eventsPerObject.get(i)?.forEach((e=>{e.dispatchUserEvent(n)})),this.eventsAfterPerObject.get(i)?.forEach((e=>{e.dispatchUserEvent(n)})))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=i=>{if(i.data?.events.length)for(let{id:n,data:r}of i.data.events){if(r.disabled||"Start"!==r.type)continue;let s=new DV(n,r,i,t,e,this.eventManager);(s.actions.Transition.length||s.actions.Animation.length||s.actions.SwitchCamera.length||s.actions.Create.length||s.actions.Destroy.length||s.actions.SceneTransition.length||s.actions.Reset.length||s.actions.SetVariable.length||s.actions.DynamicVariablePlay.length||s.actions.ClearLocalStorage.length||s.actions.UserAPI.length)&&(this.eventsPerObject.has(i)?this.eventsPerObject.get(i)?.push(s):this.eventsPerObject.set(i,[s])),s.actions.Audio.length&&(this.eventsAfterPerObject.has(i)?this.eventsAfterPerObject.get(i)?.push(s):this.eventsAfterPerObject.set(i,[s])),s.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(i)?this.eventsAfterPerObject.get(i)?.push(s):this.eventsAfterPerObject.set(i,[s])),s.actions.Particles.length&&(this.eventsAfterPerObject.has(i)?this.eventsAfterPerObject.get(i)?.push(s):this.eventsAfterPerObject.set(i,[s]))}};if(t.traverseEntity((e=>{(e instanceof DN||e instanceof xN)&&e.frame?.traverse((e=>{i(e)})),i(e)})),[...this.eventsAfterPerObject.values()].some((e=>e.length))){if(0===this.eventManager.activateCount){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.addEventListener("pointerdown",this.onMouseDown,{once:!0}),i.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),i.addEventListener("pointerdown",this.onAny),i.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.addEventListener("userEvent",this.onUserEvent)}))}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>e.dispatch())),t.addEventListener("userEvent",this.onUserEvent)}))}disconnect(){if([...this.eventsAfterPerObject.values()].some((e=>e.length))){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.removeEventListener("userEvent",this.onUserEvent),i.forEach((e=>e.disconnect()))}))}[...this.eventsPerObject.entries()].forEach((e=>{let[t,i]=e;t.removeEventListener("userEvent",this.onUserEvent),i.forEach((e=>e.disconnect()))})),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},BV=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.initialDisabled=!1,this.actions=Az(t,t.actions,n,r,s,i),this.target=t.target}disconnect(){xz(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.Animation.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((t=>{t.dispatch(e??!1)})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch())))}},LV=class extends Aj{constructor(e,t,i,n,r){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=n,this.needsRaycast=r,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=e=>{let t=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let i=new Date,n=[],r=[];for(let o=0;o<this.propertiesToWatch.length;o++){let{objectId:e,property:t,prevValue:i}=this.propertiesToWatch[o],n=this.eventContext.scene.find(e),s=Yb.propertyPaths[t];if("width"===s[0]||"height"===s[0]||"depth"===s[0])n=n.geometry.userData.parameters[s[0]];else for(let r=0;r<s.length;r++)n=n[s[r]];null===i?this.propertiesToWatch[o].prevValue=n instanceof Vi?n.clone():n:(n instanceof Vi?!n.equals(i):i!==n)&&(r.push({objId:e,property:t}),n instanceof Vi?this.propertiesToWatch[o].prevValue.copy(n):this.propertiesToWatch[o].prevValue=n)}for(let o=0;o<this.variablesToWatch.length;o++){let{id:e,prevValue:i}=this.variablesToWatch[o],r=t.getVariable(e);r!==i&&(n.push(e),this.variablesToWatch[o].prevValue=r)}for(let o=0;o<this.dynamicVars.length;o++){let{id:r,expectedTime:s,last:a,data:l,timerSeconds:c,startValue:h}=this.dynamicVars[o],d=1e3;if("timer"!==l.dynamicVariableType&&"stopwatch"!==l.dynamicVariableType||"number3decimal"!==l.format?"counter"===l.dynamicVariableType?d=l.updateInterval:"random"===l.dynamicVariableType&&(d=l.isStatic?1/0:l.updateInterval):d=1,-1!==s){if("Stopped"!==t.getDynamicVariablePlayState(r)&&"Restarted"!==t.getDynamicVariablePlayState(r)||(this.dynamicVars[o].last=e,this.dynamicVars[o].expectedTime=e+d,"counter"===l.dynamicVariableType&&t.getVariable(r)!==h&&(t.updateVariable(r,h),this.eventManager.requestRender()),("timer"===l.dynamicVariableType||"stopwatch"===l.dynamicVariableType)&&this.dynamicVars[o].timerSeconds!==h&&(this.dynamicVars[o].timerSeconds=h,t.updateVariable(r,zx.getFormattedTimerTime(h,l)),this.eventManager.requestRender()),"Restarted"===t.getDynamicVariablePlayState(r)&&t.setDynamicVariablePlayState(r,"Playing"),"Stopped"!==t.getDynamicVariablePlayState(r))){if("Paused"===t.getDynamicVariablePlayState(r)){void 0===this.dynamicVars[o].deltaToExpectedTime&&(this.dynamicVars[o].deltaToExpectedTime=Math.max(this.dynamicVars[o].expectedTime-e,0)),this.dynamicVars[o].last=e-(d-this.dynamicVars[o].deltaToExpectedTime),this.dynamicVars[o].expectedTime=e+this.dynamicVars[o].deltaToExpectedTime;continue}if(this.dynamicVars[o].deltaToExpectedTime=void 0,e>=s)if(this.dynamicVars[o].last=e,this.dynamicVars[o].expectedTime+=d,"random"===l.dynamicVariableType){let e=l.min+Math.random()*(l.max-l.min),i=l.decimals;e=Math.round(e*Math.pow(10,i))/Math.pow(10,i),t.updateVariable(r,e),n.push(r),this.eventManager.requestRender()}else if("counter"===l.dynamicVariableType){let e=t.getVariable(r),i=t.getDynamicVariableToggleIsForward(r)??!0,s=t.getVariable(r)+l.increment*(i?1:-1);l.hasEnd&&(s=l.increment>0?ui.clamp(s,h,l.endValue):ui.clamp(s,l.endValue,h),s===h&&t.setDynamicVariableToggleIsForward(r,void 0),l.repeat?s===l.endValue&&(s=h):(s===h||s===l.endValue)&&t.setDynamicVariablePlayState(r,"Paused")),s!==e&&(n.push(r),t.updateVariable(r,s),this.eventManager.requestRender())}else if("time"===l.dynamicVariableType){let e=t.getVariable(r),s=CP(i,l);if("object"==typeof e&&"textValue"in e&&"object"==typeof s&&"textValue"in s){if(Array.isArray(e.textValue)&&Array.isArray(s.textValue)){if(e.textValue.every(((e,t)=>e===s.textValue[t])))continue}else if(e.textValue===s.textValue)continue}else if(e===s)continue;t.updateVariable(r,s),n.push(r),this.eventManager.requestRender()}else{let i=Ox.isTextValue(l.endValue)?NV(l.endValue.textValue):l.endValue,s=t.getDynamicVariableToggleIsForward(r)??!0,d=c+(e-a)/1e3*("timer"===l.dynamicVariableType?-1:1)*(s?1:-1);d=Math.max(d,0),l.hasEnd&&(d="stopwatch"===l.dynamicVariableType?ui.clamp(d,h,i):ui.clamp(d,i,h),d===h&&t.setDynamicVariableToggleIsForward(r,void 0),l.repeat?Math.abs(d-i)<("number3decimal"===l.format?1e-4:.1)&&(d=h):(Math.abs(d-h)<("number3decimal"===l.format?1e-4:.1)||Math.abs(d-i)<("number3decimal"===l.format?1e-4:.1))&&t.setDynamicVariablePlayState(r,"Paused")),d!==c&&(n.push(r),this.dynamicVars[o].timerSeconds=d,t.updateVariable(r,zx.getFormattedTimerTime(d,l)),this.eventManager.requestRender())}}}else this.dynamicVars[o].last=e,this.dynamicVars[o].expectedTime=e+d}let s=!1;t.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=t.mouseProperty,s=!0);let a=!1;t.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=t.raycastProperty,a=!0),this.events.forEach((e=>{(n.includes(e.data.variableId)||r.find((t=>t.objId===e.data.objectId&&t.property===e.data.property))||"mouseProperty"===e.data.variableId&&s||"raycastProperty"===e.data.variableId&&a)&&(e.dispatch(),this.eventManager.requestRender())}))},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity((e=>{e.data?.events.filter((e=>"VariableChange"===e.data.type&&!e.data.disabled)).forEach((t=>{this.events.push(new OV(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.propertiesToWatch=this.events.filter((e=>"objectProperty"===e.data.variableId&&null!==e.data.objectId)).map((e=>({objectId:e.data.objectId,property:e.data.property,prevValue:null})));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach((t=>{let i,{id:n,data:r}=t;if("dynamicVariableType"in r)if("timer"===r.dynamicVariableType||"stopwatch"===r.dynamicVariableType){let e;if(Ox.isTextValue(r.value)&&Array.isArray(r.value.textValue)){let t=r.value.textValue;e=3===t.length?t[2]+60*t[1]+3600*t[0]:t[1]+60*t[0]}else e=r.value;i=e,this.dynamicVars.push({id:n,last:-1,expectedTime:-1,data:r,timerSeconds:e,startValue:i})}else"time"===r.dynamicVariableType&&e.updateVariable(n,CP(new Date,r)),"counter"===r.dynamicVariableType&&(i=Ox.isTextValue(r.value)?NV(r.value.textValue):r.value),this.dynamicVars.push({id:n,last:-1,expectedTime:-1,data:r,startValue:i});else this.events.find((e=>e.data.variableId===n))&&this.variablesToWatch.push({id:n,prevValue:e.getVariable(n)})})),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach((e=>e.dispose()))}},OV=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=Az(t,t.actions,n,r,s,i)}dispatch(){let e=this.actions;e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}dispose(){xz(this.actions)}};function NV(e){return 3===e.length?e[2]+60*e[1]+3600*e[0]:e[1]+60*e[0]}var kV,FV,UV,zV={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1};av.then((e=>{kV=e,FV=new e.Vec3,UV=new e.Vec3}));var jV=new Vi,VV=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.usePhysics=e,this.isExport=t,this.onPointerDown=e=>{if(1!==Xg.length)return;let{raycaster:t,page:i}=this.eventContext;this.eventContext.updateRaycaster(e);let n=i.raycastWithClones(t);if(0!==n.length){if(this.gameControl){let e=jV.copy(this.gameControl.colliderWorldPosition);e.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(e,n[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(e,t)=>i=>{let n;if(i instanceof PR){if(!i.objectForSample)return!0===i.object.dataPatched.physics.fusedBody&&"dynamic"===i.object.dataPatched.physics.rigidBody||void 0;if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else if(i instanceof f_)n=i.object;else if(n=i,!1===n.dataPatched.cloner?.disabled&&n.dataPatched.cloner?.hideBase&&!0!==n.dataPatched.physics?.fusedBody)return!0;if(t&&!n.userData.navmesh)return;let r=n.dataPatched;if(!r.visible&&!0!==r.physics?.enabled)return!0;i.updateMatrixWorldSVD();let s=MG(r),a=n.userData.hasDestroy,o=n.userData.hasDrag,l=!1,c=!1;for(let e of r.events)!0!==e.data.disabled&&("GameControl"===e.data.type?l=!0:"Follow"===e.data.type&&(c=!0));if(l||s||c||a||o)return!0;if(this.usePhysics&&"dynamic"===r.physics?.rigidBody){if(this.usePhysics&&r.physics?.fusedBody)return!0}else if("geometry"in i&&i.geometry&&e.push(sj(i.geometry,i.matrixWorld)),this.usePhysics&&r.physics?.fusedBody)return i.traverseObject(((t,i)=>{if(0===i)return;let n;if(t instanceof PR){if(!t.objectForSample)return!0===t.object.dataPatched.physics.fusedBody&&"dynamic"===t.object.dataPatched.physics.rigidBody||void 0;if(t.objectForSample.dataPatched.physics.fusedBody)return;n=t.object}else if(t instanceof f_)n=t.object;else if(n=t,t.dataPatched.cloner?.hideBase)return!0;let r=n.dataPatched;if(!r.visible&&!0!==r.physics?.enabled)return!0;"geometry"in t&&t.geometry&&e.push(sj(t.geometry,t.matrixWorld))})),!0},this.traverseNoPhysics=(e,t)=>i=>{let n;if(i instanceof PR)return;n=i instanceof f_?i.object:i;let r=n.dataPatched;if("visibility"===r.physics.enabled?!r.visible:!r.physics.enabled)return!0;if(t&&!n.userData.navmesh)return;let s=i.geometry,a=!0===n.userData.hasDestroy,o=!0===n.userData.hasDrag;if(MG(r)||a||o||n.dataPatched.events.some((e=>!0!==e.data.disabled&&"GameControl"===e.data.type)))return!0;s&&e.push(sj(s,i.matrixWorld))},this.navmeshWasm=kV,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?"\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport('https://unpkg.com/@splinetool/runtime@1.9.87/build/' + 'navmesh.js'),\n\t\tfetch('https://unpkg.com/@splinetool/navmesh-wasm@1.9.87/build/' + 'navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n":"\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport(self.location.origin + '/_libraries/navmesh.js'),\n\t\tfetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n")+"\n\nonmessage = function(messageEvent) {\n\tconst meshData = messageEvent.data;\n\tconst positions = meshData[0];\n\tconst offset = meshData[1];\n\tconst indices = meshData[2];\n\tconst indicesLength = meshData[3];\n\tconst parameters = meshData[4];\n\n\tconst module = self.module;\n\tconst rc = new module.rcConfig();\n\trc.cs = parameters.cs;\n\trc.ch = parameters.ch;\n\trc.borderSize = parameters.borderSize ? parameters.borderSize : 0;\n\trc.tileSize = parameters.tileSize ? parameters.tileSize : 0;\n\trc.walkableSlopeAngle = parameters.walkableSlopeAngle;\n\trc.walkableHeight = parameters.walkableHeight;\n\trc.walkableClimb = parameters.walkableClimb;\n\trc.walkableRadius = parameters.walkableRadius;\n\trc.maxEdgeLen = parameters.maxEdgeLen;\n\trc.maxSimplificationError = parameters.maxSimplificationError;\n\trc.minRegionArea = parameters.minRegionArea;\n\trc.mergeRegionArea = parameters.mergeRegionArea;\n\trc.maxVertsPerPoly = parameters.maxVertsPerPoly;\n\trc.detailSampleDist = parameters.detailSampleDist;\n\trc.detailSampleMaxError = parameters.detailSampleMaxError;\n\n\tif (!self.navMesh) {\n\t\tself.navMesh = new module.NavMesh();\n\t}\n\tself.navMesh.build(positions, offset, indices, indicesLength, rc);\n\n\tconst navmeshData = navMesh.getNavmeshData();\n\tconst arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);\n\tconst ret = new Uint8Array(navmeshData.size);\n\tret.set(arrView);\n\tnavMesh.freeNavmeshData(navmeshData);\n\n\tpostMessage(ret);\n}\n"])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent((new Vi).setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,(e=>{this.buildFromNavmeshData(e.data)}))},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach((t=>{let i=e.scene.find(t);i.traverseEntity((e=>{e.userData.navmesh=!0})),i.cloner?.traverseObject((e=>{e.userData.navmesh=!0}))}));let n=[],r=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(n,"custom"===t.zones);if(e.traverseChildren(r),t.objects.forEach((t=>{let i=e.scene.find(t);i.traverseEntity((e=>{e.userData.navmesh=void 0})),i.cloner?.traverseObject((e=>{e.userData.navmesh=void 0}))})),0===n.length)return!1;let s=Dw(n),{positions:a,triIndices:o}=PM(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...zV,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),n=i.getTriangleCount(),r=new Uint32Array(3*n),s=new Float32Array(3*n*3);for(e=0;e<3*n;e++)r[e]=e;for(e=0;e<n;e++)for(t=0;t<3;t++){let n=i.getTriangle(e).getPoint(t);s[9*e+3*t+0]=n.x,s[9*e+3*t+1]=n.y,s[9*e+3*t+2]=n.z}let a=new yr;return a.setIndex(new or(r,1)),a.setAttribute("position",new or(s,3)),a}getClosestPoint(e){return FV.x=e.x,FV.y=e.y,FV.z=e.z,this.navMesh.getClosestPoint(FV)}getClosestPointToRef(e,t){FV.x=e.x,FV.y=e.y,FV.z=e.z;let i=this.navMesh.getClosestPoint(FV);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return FV.x=e.x,FV.y=e.y,FV.z=e.z,this.navMesh.getRandomPointAround(FV,t)}getRandomPointAroundToRef(e,t,i){FV.x=e.x,FV.y=e.y,FV.z=e.z;let n=this.navMesh.getRandomPointAround(FV,t);i.set(n.x,n.y,n.z)}moveAlong(e,t){return FV.x=e.x,FV.y=e.y,FV.z=e.z,UV.x=t.x,UV.y=t.y,UV.z=t.z,this.navMesh.moveAlong(FV,UV)}moveAlongToRef(e,t,i){return FV.x=e.x,FV.y=e.y,FV.z=e.z,UV.x=t.x,UV.y=t.y,UV.z=t.z,this.navMesh.moveAlong(FV,UV)}computePath(e,t){let i=this.getClosestPoint(t);if(UV.x=i.x,UV.y=i.y,UV.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let n=this.navMesh.computePath(FV,UV),r=n.getPointCount(),s=[];for(let a=0;a<r;a++){let e=n.getPoint(a);s.push(new Vi(e.x,e.y,e.z))}return s}createCrowd(e,t){return new GV(this,e,t)}setDefaultQueryExtent(e){FV.x=e.x,FV.y=e.y,FV.z=e.z,this.navMesh.setDefaultQueryExtent(FV)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),n=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);n.set(e);let r=new this.navmeshWasm.NavmeshData;r.dataPointer=n.byteOffset,r.size=e.length,this.navMesh.buildFromNavmeshData(r),this.navmeshWasm._free(n.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),this.eventContext?.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return FV.x=e.x,FV.y=e.y,FV.z=e.z,this.navMesh.addCylinderObstacle(FV,t,i)}addBoxObstacle(e,t,i){return FV.x=e.x,FV.y=e.y,FV.z=e.z,UV.x=t.x,UV.y=t.y,UV.z=t.z,this.navMesh.addBoxObstacle(FV,UV,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return void 0!==this.navmeshWasm}},GV=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let n=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;n.radius=t.radius,n.height=t.height,n.maxAcceleration=t.maxAcceleration,n.maxSpeed=t.maxSpeed,n.collisionQueryRange=t.collisionQueryRange,n.pathOptimizationRange=t.pathOptimizationRange,n.separationWeight=t.separationWeight,n.updateFlags=7,n.obstacleAvoidanceType=0,n.queryFilterType=0,n.userData=0;let r=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),n);return this.transforms.push(i),this.agents.push(r),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new Vi(0,0,0)),r}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);void 0!==t.radius&&(i.radius=t.radius),void 0!==t.height&&(i.height=t.height),void 0!==t.maxAcceleration&&(i.maxAcceleration=t.maxAcceleration),void 0!==t.maxSpeed&&(i.maxSpeed=t.maxSpeed),void 0!==t.collisionQueryRange&&(i.collisionQueryRange=t.collisionQueryRange),void 0!==t.pathOptimizationRange&&(i.pathOptimizationRange=t.pathOptimizationRange),void 0!==t.separationWeight&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=.001)return;let t=1/60;{let i=Math.floor(e/t);i>10&&(i=10),i<1&&(i=1);let n=e/i;for(let e=0;e<i;e++)this.crowd.update(n)}for(let i=0;i<this.agents.length;i++){let e=this.agents[i],t=this.getAgentPosition(e);if(this.transforms[i].copy(t),this._agentDestinationArmed[i]){let n=t.x-this._agentDestination[i].x,r=t.z-this._agentDestination[i].z,s=this.reachRadii[i],a=this._agentDestination[i].y-this.reachRadii[i],o=this._agentDestination[i].y+this.reachRadii[i],l=n*n+r*r;t.y>a&&t.y<o&&l<s*s&&(this.onReachTarget(e,this._agentDestination[i]),this._agentDestinationArmed[i]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),n=i.getPointCount(),r=[];for(t=0;t<n;t++){let e=i.getPoint(t);r.push(new Vi(e.x,e.y,e.z))}return r}dispose(){this.crowd.destroy()}};function HV(e){let t=!1;return e.scene.objects.forEach((i=>{"Page"===i.data.type&&!t&&i.data.publish.gameControlObject&&Px.traverseModuleInstances(e,i.id,((e,i,n)=>{for(let r of n)"GameControl"===r.data.type&&r.data.navmesh.enabled&&(t=!0)}))})),t}var WV={type:"change"},QV={type:"changeZoom"},qV={type:"changePan"},XV={type:"start"},YV={type:"end",changed:!0},KV={type:"end",changed:!1},JV=new ji,ZV=new pi,$V=2*Math.PI,eG=new Vi,tG=new pi,iG=new Vi,nG=new ji,rG=new bn,sG={type:"requestRender"},aG=class extends Zt{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isPlayMode:!1,isExport:!1};super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,E,S],this.offset=new Vi,this.eye=new Vi,this.lastPosition=new Vi,this.lastQuaternion=new ji,this.current=new pi,this.overShoot=new pi,this.overRatio=new pi,this.spherical=new Mh,this.sphericalDelta=new Mh,this.panOffset=new Vi,this.panLeftV=new Vi,this.panUpV=new Vi,this.panV=new Vi,this.rotateStart=new pi,this.rotateEnd=new pi,this.rotateDelta=new pi,this.panStart=new pi,this.panEnd=new pi,this.panDelta=new pi,this.dollyStart=new pi,this.dollyEnd=new pi,this.dollyDelta=new pi,this.rotationRangeFactor=new pi,this.panRangeFactor=new pi,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=e=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=e.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(iG,nG,eG),this.offset.copy(iG).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&-1===this.state&&this.rotateLeft((!0===this.autoRotateClockwise?1:-1)*this.getAutoRotationAngle()),0!==this.rotationLimitsMode&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),2!==this.rotationLimitsMode&&(this.spherical.phi+=this.sphericalDelta.phi),(1!==this.rotationLimitsMode||!0===this.autoRotate)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),0!==this.panLimitsMode&&(this.target.applyQuaternion(JV.copy(nG).invert()),this.panOffset.applyQuaternion(JV),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(nG),this.panOffset.applyQuaternion(nG)),2===this.panLimitsMode&&(this.panOffset.y=0),1===this.panLimitsMode&&(this.panOffset.x=0),-1!==this.state||this.gesture?(this.target.add(this.panOffset),this.panOffset.set(0,0,0)):(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)),this.offset.setFromSpherical(this.spherical),iG.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(rG.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(rG));let e=this.spherical.phi%$V;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(Hn.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),e>0&&e>Math.PI||e<0&&e>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),-1===this.state||!0===this.enableDamping){let e=1===this.hoverRotatePanMode?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-e,this.sphericalDelta.phi*=1-e}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>.01||8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-8?(this.dispatchEvent(WV),this.object.dispatchEvent(sG),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=e=>{!1!==this.enabled&&("touch"===e.pointerType||"pen"===e.pointerType&&Vg?this.onPointerDownTouch(e):this.onPointerDownMouse(e),-1!==this.state&&(this.isPointerDown=!0,this.dispatchEvent(XV),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),e.stopPropagation(),"touch"===e.pointerType||"pen"===e.pointerType&&Vg||this.domElement.setPointerCapture(e.pointerId)))},this.onPointerLeave=e=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(1===this.hoverRotatePanMode?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,eG.subVectors(this.position0,this.target0),this.spherical.setFromVector3(eG),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):2===this.hoverRotatePanMode&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=e},this.onPointerEnter=e=>{this.resetHoverEffectOnPointerLeave||void 0===this.pointerLeaveEvent?tG.set(e.clientX-this.domElement.clientWidth/2,e.clientY-this.domElement.clientHeight/2):tG.set(e.clientX-this.pointerLeaveEvent.clientX,e.clientY-this.pointerLeaveEvent.clientY),1===this.hoverRotatePanMode?(this.rotateDelta.copy(tG).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(ZV,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(e.clientX,e.clientY)):2===this.hoverRotatePanMode&&(this.panDelta.copy(tG).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(e.clientX,e.clientY)),this.update()},this.onPointerMove=e=>{!1!==this.enabled&&(this.checkRaycastLock()||("touch"===e.pointerType||"pen"===e.pointerType&&Vg?this.onPointerMoveTouch(e):this.onPointerMoveMouse(e),e.stopPropagation()))},this.onPointerUp=e=>{this.isPointerDown=!1,0===Xg.length&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Xg.length>1&&e.preventDefault(),this.hasChange?this.dispatchEvent(YV):this.dispatchEvent(KV),this.state=-1,e&&(e.stopPropagation(),"touch"===e.pointerType||"pen"===e.pointerType&&Vg||this.domElement.releasePointerCapture(e.pointerId))},this.onPointerDownMouse=e=>{let t;switch(t=this.useKeyEvents?this.mouseButtons[e.button]:this.mouseButtonsPlay[e.button],t){case 0:if(!0!==e.altKey||e.shiftKey||qg(e)){if(" "===this.key){if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2}}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=0}break;case 4:if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2;break;case 3:if(qg(e)||e.shiftKey){if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=0}break;case 5:if(qg(e)||e.shiftKey){if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=0}else{if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=e=>{switch(this.state){case 0:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(e);break;case 1:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(e);break;case 2:if(!1===this.enablePan)return;this.handleMouseMovePan(e)}this.object.wasMovedByUser=!0},this.onPointerDownTouch=e=>{switch(Xg.length>1&&e.preventDefault(),this.touches[Xg.length-1]){case w:if(!1===this.enableRotate)return void(this.state=-1);this.handleTouchStartRotate(),this.state=3;break;case S:if(!1===this.enablePan)return void(this.state=-1);this.handleTouchStartPan(),this.state=4;break;case _:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchStartDollyPan(),this.state=5;break;case E:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=e=>{switch(Xg.length>1&&e.preventDefault(),this.state){case 3:if(!1===this.enableRotate)return;this.handleTouchMoveRotate(e),this.update();break;case 4:if(!1===this.enablePan)return;this.handleTouchMovePan(e),this.update();break;case 5:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchMoveDollyPan(e),this.update();break;case 6:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchMoveDollyRotate(e),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=bg((()=>this.dispatchEvent(YV)),33),this.onMouseWheel=e=>{!1===this.enabled||!1===this.enableZoom&&!1===this.enablePan||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&e.preventDefault(),this.dispatchEvent(XV),this.handleMouseWheel(e),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=e=>{if(e.preventDefault(),!1!==this.enabled&&!this.checkRaycastLock()&&!zg)if("gesturechange"===e.type){if(!1===this.enableZoom||!1===this.isTouchZoom)return;this.dispatchEvent(XV),e.scale>this.prevScale?this.dollyIn(this.getZoomScale()):e.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=e.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(YV)},this.onContextMenu=e=>{e.preventDefault()},this.onTouchEnd=e=>{e.preventDefault()},this.onKeyDown=e=>{!1!==this.enabled&&(this.key=e.key," "===e.key&&this.dispatchEvent(XV))},this.onKeyUp=e=>{!1!==this.enabled&&(this.key=void 0,-1!==this.state&&"Alt"===e.key&&this.onPointerUp(Xg[0])," "===e.key&&this.dispatchEvent(YV))},this.onPointerHover=e=>{"mouse"!==e.pointerType||!1===this.enabled||-1!==this.state||2===this.hoverRotatePanMode&&this.isPanOverShoot||1===this.hoverRotatePanMode&&this.isRotateOverShoot||(this.isPointerDown=!0,2===this.hoverRotatePanMode?this.handleMouseMovePan(e,this.hoverRotatePanStrength):1===this.hoverRotatePanMode&&this.handleMouseMoveRotate(e,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=e=>{e.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(e){"start"===e.type?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents="window"===t,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let n=this.object.getTarget().applyQuaternion(JV.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+n.y,this.maxV=e.panVerticalOffset.max+n.y,this.minH=-e.panHorizontalOffset.min+n.x,this.maxH=e.panHorizontalOffset.max+n.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=oG(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=oG(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=oG(oG(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=oG(oG(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,1===e.orbitTouches&&(this.touches[0]=w),1===e.panTouches&&(this.touches[0]=S),2===e.orbitTouches&&(this.touches[1]=E),2===e.panTouches&&(this.touches[1]=_),3===e.orbitTouches&&(this.touches[2]=w),3===e.panTouches&&(this.touches[2]=S),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,n,r,s,a,o){let l,c,h;this.overShoot.set(0,0),e instanceof Vi?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),h=!0):(l=e.theta,c=e.phi,this.current.set(oG(this.spherical.theta),oG(this.spherical.phi)),h=!1),0===i&&(this.current.x+=l,this.current.y+=c),(3===t||2===t)&&(!h&&this.isThetaFlipped?this.current.x>n&&this.current.x<0?this.overShoot.x=n-this.current.x:this.current.x<r&&this.current.x>0&&(this.overShoot.x=r-this.current.x):this.current.x>n?this.overShoot.x=n-this.current.x:this.current.x<r&&(this.overShoot.x=r-this.current.x)),(3===t||1===t)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),h||(this.overShoot.x=oG(this.overShoot.x),this.overShoot.y=oG(this.overShoot.y)),0!==i?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),1===i&&(this.overRatio.x=lG(Math.abs(this.overRatio.x)),this.overRatio.y=lG(Math.abs(this.overRatio.y))),this.isPointerDown||1===i?2===i&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):2===i&&(!h&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||h&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=.05*this.overShoot.x),this.phiIsFree||(c=.05*this.overShoot.y),h?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):h?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof Vi?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=!0===e?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let n=this.object.position;this.panV.copy(n).sub(this.target);let r=this.panV.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*r/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*r/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(qV)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(QV)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(QV)}zoomOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getZoomScale();this.dispatchEvent(XV),this.dollyOut(e),this.dispatchEvent(YV)}zoomIn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getZoomScale();this.dispatchEvent(XV),this.dollyIn(e),this.dispatchEvent(YV)}setZoom(e){if(this.dispatchEvent(XV),this.object.isPerspectiveCamera){let t=this.initialSphericalRadius/e/this.spherical.radius;this.scale=t}else this.object.isOrthographicCamera&&(this.object.zoom=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(YV)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;void 0!==e.movementX?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(ZV,-this.object.angleOffsetFromUp);let i=this.domElement,n=this.useWindowEvents?window.innerHeight:i.clientHeight,r=2*Math.PI*this.rotateDelta.x/n,s=2*Math.PI*this.rotateDelta.y/n;this.rotateLeft(r),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;void 0!==e.movementX?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(!1===jg&&!1===qg(e)&&!0===function(e){return 0===e.wheelDeltaY||0===e.deltaY?!(Ug&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120)&&(e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:0===e.deltaMode):e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:0===e.deltaMode}(e)){if(!1===this.enablePan)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout((()=>{this.gesture=!1,this.isPointerDown=!1}),30)}else{if(!1===this.enableZoom||this.gesture)return;0===e.deltaY?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(2===Xg.length){let e=.5*(Xg[0].pageX+Xg[1].pageX),t=.5*(Xg[0].pageY+Xg[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(Xg[0].pageX,Xg[0].pageY)}handleTouchStartPan(){if(2===Xg.length){let e=.5*(Xg[0].pageX+Xg[1].pageX),t=.5*(Xg[0].pageY+Xg[1].pageY);this.panStart.set(e,t)}else this.panStart.set(Xg[0].pageX,Xg[0].pageY)}handleTouchStartDolly(){let e=Xg[0].pageX-Xg[1].pageX,t=Xg[0].pageY-Xg[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(2===Xg.length){let t=tv(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this.rotateEnd.set(i,n)}else{if(e.pointerId!==Xg[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(2===Xg.length){let t=tv(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this.panEnd.set(i,n)}else{if(e.pointerId!==Xg[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=tv(e),i=e.pageX-t.x,n=e.pageY-t.y,r=Math.sqrt(i*i+n*n);this.dollyEnd.set(0,r),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let e=this.options?.showCameraLock;return e&&e(),!0}}return!1}};function oG(e){let t=2*Math.PI;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function lG(e){return 1-Math.pow(1-e,4)}var cG,hG=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.page=n,this.currentIntersectedObjects=[],this.actions=Az(t,t.actions,n,r,s,i),this.target=t.target,this.triggeringObjects=[];for(let a of t.triggeringObjects){let e=n.scene.find(a);e&&this.triggeringObjects.push(e)}}isValidTriggeringObject(e){return"all"===this.target||this.triggeringObjects.some((t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid)))}disconnect(){xz(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.SwitchCamera.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch(!1)})),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch())))}};hv.then((e=>cG=e));var dG=new Vi,uG=new ji,pG=new Vi,fG=new In(0,0,0,"YXZ"),mG=new In(0,0,0,"XYZ"),gG=new Vi,vG=new Vi,yG=new Vi(1,1,1),bG=new ji,AG=new bn,xG=new bn,wG={type:"updateMatrix"},SG=new ji,_G=new hn,EG={type:"beginEvent",eventName:"Collision"},CG={type:"beginEvent",eventName:"Trigger"};var MG=e=>e.states.some((e=>void 0!==e.data.position||void 0!==e.data.rotation||void 0!==e.data.hiddenMatrix||void 0!==e.data.cloner||void 0!==e.data.pathSnapping)),TG=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=e=>{if(e.bodyType()!==cG.RigidBodyType.Dynamic)return;e.isSleeping()||this.nActiveRigidBodies++;let[t,i,n]=this.rigidBodyToMesh.get(e.handle);if(dG.copy(e.translation()).multiplyScalar(this.pixelsPerMeter),uG.copy(e.rotation()),t.matrixWorld.compose(dG,uG,i),t.hasNonUniformScale&&t.matrixWorld.multiply(t.shearScale),t.dispatchEvent(wG),n){let e=t.cloner;if(e&&void 0===e.objectForSample){e.matrixWorld.copy(t.matrixWorld);for(let t of e.children)t.updateMatrixWorld(!0)}for(let i of t.children)i.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(e,t,i)=>{if(!1===i)return;let n,r;if(this.sensorToTriggerEvent[e]?(n=this.sensorToTriggerEvent[e],r=this.sharedGameControlGlobals.colliderToEntity.get(t)):this.sensorToTriggerEvent[t]&&(n=this.sensorToTriggerEvent[t],r=this.sharedGameControlGlobals.colliderToEntity.get(e)),n&&r&&n.isValidTriggeringObject(r))n.dispatch();else{for(let i=this.sharedGameControlGlobals.createdObjects.length-1;i>=0;i--){let n=this.sharedGameControlGlobals.createdObjects[i];if(n.userData.hasCollisionDestroy&&(n.rigidBody?.collider(0).handle===e||n.rigidBody?.collider(0).handle===t)){this.sharedGameControlGlobals.createdObjects.splice(i,1),n.removeFromParent(),requestAnimationFrame((()=>this.sharedGameControlGlobals.rapierWorld?.removeRigidBody(n.rigidBody)));break}}if(void 0!==this.gameControl?.object&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(e)){let e=this.sharedGameControlGlobals.colliderToEntity.get(t),i=this.sharedGameControlGlobals.entityToCollisionEvents[e.uuid];if(void 0===i)return;for(let n of i)"character"===n.data.target&&this.dispatchCollisionEvent(n,e,t)}else if(void 0!==this.gameControl?.object&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let t=this.sharedGameControlGlobals.colliderToEntity.get(e),i=this.sharedGameControlGlobals.entityToCollisionEvents[t.uuid];if(void 0===i)return;for(let n of i)"character"===n.data.target&&this.dispatchCollisionEvent(n,t,e)}else{let i=this.sharedGameControlGlobals.colliderToEntity.get(e),n=this.sharedGameControlGlobals.entityToCollisionEvents[i.uuid];if(void 0!==n)for(let t of n)"scene"===t.data.target&&this.dispatchCollisionEvent(t,i,e);let r=this.sharedGameControlGlobals.colliderToEntity.get(t),s=this.sharedGameControlGlobals.entityToCollisionEvents[r?.uuid];if(void 0!==s)for(let e of s)"scene"===e.data.target&&this.dispatchCollisionEvent(e,r,t)}}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=200,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach((e=>{e.addEventListener("connected",(e=>{"gamepad"in e.data&&"axes"in e.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(e.data.gamepad)}))}))}markIsDestroyTarget(){this.page.traverseVisibleEntity((e=>{let t=e.dataPatched;for(let i of t.events){if(!0===i.data.disabled)continue;let e=i.data.actions?.find((e=>"Destroy"===e.data.type))?.data;if(e)for(let t of e.objects){let e=this.page.scene.find(t);e&&(e.userData.hasDestroy=!0)}}}))}markIsDragObject(){this.page.traverseVisibleEntity((e=>{let t=e.dataPatched;for(let i of t.events)if(!0!==i.data.disabled&&"DragDrop"===i.data.type)for(let e of i.data.objects){let t=this.page.scene.find(e);t&&(t.userData.hasDrag=!0)}}))}initBVH(){let e=[];if(this.page.traverseChildren((t=>{let i;if(t instanceof PR||t instanceof dB||t instanceof HN)return;i=t instanceof f_?t.object:t;let n=i.dataPatched;if("visibility"===n.physics?.enabled?!n.visible:!n.physics?.enabled)return!0;let r=t.geometry,s=!0===i.userData.hasDestroy,a=!0===i.userData.hasDrag;if(MG(n)||s||a||i.dataPatched.events.some((e=>!0!==e.data.disabled&&("GameControl"===e.data.type||"Follow"===e.data.type))))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;r&&e.push(sj(r,t.matrixWorld))})),e.length>0){let t=Dw(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new XS(t)}}addRigidBody(e,t,i){if(rj(e.matrixWorld))return;let n=[],r="geometry"in e?e.geometry:void 0,s=t.dataPatched;if(void 0!==r?.getAttribute("position")&&n.push(sj(r,e.shearScale)),s.physics.fusedBody){let t=this.gatherChildrenGeom(e,n);e.traverseObject(t),e.children.forEach((e=>e.updateMatrixWorld(!0)));let i=e.cloner;i&&void 0===i.objectForSample&&"dynamic"===s.physics.rigidBody&&(i.traverseObject(t),i.children.forEach((e=>e.updateMatrixWorld(!0))))}if(n.length>0){let o,l=!i.fromCreate&&"dynamic"===s.physics.rigidBody||i.fromCreate&&i.dynamic;l?(o=cG.RigidBodyDesc.dynamic(),o.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(o=cG.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):o=cG.RigidBodyDesc.fixed();let c=Dw(n);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(dG,uG,pG),e.position0=dG.clone().divideScalar(this.pixelsPerMeter),e.rotation0=uG.clone(),dG.divideScalar(this.pixelsPerMeter),o.setTranslation(dG.x,dG.y,dG.z).setRotation(uG),r?c?.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):c?.scale(pG.x/this.pixelsPerMeter,pG.y/this.pixelsPerMeter,pG.z/this.pixelsPerMeter);let h=this.sharedGameControlGlobals.rapierWorld.createRigidBody(o);l&&this.rigidBodyToMesh.set(h.handle,[e,pG.clone(),s.physics.fusedBody]);let d=!(void 0===s.geometry||"SubdivGeometry"===s.geometry.type||"NonParametricGeometry"===s.geometry.type||"BooleanGeometry"===s.geometry.type||"VectorGeometry"===s.geometry.type||"StarGeometry"===s.geometry.type||"RectangleGeometry"===s.geometry.type||"EllipseGeometry"===s.geometry.type||"TriangleGeometry"===s.geometry.type||"TorusGeometry"===s.geometry.type||"HelixGeometry"===s.geometry.type);try{this.addCollider(h,s.physics,c,t,d)}catch{try{this.addCollider(h,s.physics,c,t,!1)}catch(a){console.error(a)}}e.rigidBody=h}}addBoundsTree(e){let t=[];if(void 0!==e.geometry?.getAttribute("position")&&e.geometry?.getAttribute("position").count>0&&t.push(sj(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach((e=>e.updateMatrixWorld(!0))),t.length>0){let i=Dw(t,!1);e.bvhGeometry=i,i.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new XS(i),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,i,n){let r,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(0===i?.getAttribute("position").count||0===i?.getIndex()?.count)return;i&&(r="trimesh"===t.colliderType?cG.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):cG.ColliderDesc.convexMesh(i.getAttribute("position").array,s?i.getIndex().array:void 0)),r.setFrictionCombineRule(cG.CoefficientCombineRule.Average).setRestitutionCombineRule(cG.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(r,e);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,n),this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid]?.some((e=>"scene"===e.target))&&a.setActiveEvents(cG.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,n)=>{if(0===n)return;let r;if(i instanceof PR){if(!i.objectForSample)return!0===i.object.dataPatched.physics.fusedBody&&"dynamic"===i.object.dataPatched.physics.rigidBody||void 0;if(i.objectForSample.dataPatched.physics.fusedBody)return;r=i.object}else if(i instanceof f_)r=i.object;else if(r=i,r.dataPatched.cloner?.hideBase)return!0;let s=r.dataPatched;if("visibility"===s.physics.enabled?!s.visible:!s.physics.enabled)return!0;1===n?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;void 0!==a?.getAttribute("position")&&t.push(sj(a,i.matrixWorld))}}activate(e){if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,n=5,r=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=null!==o?this.page.find(o):null,c=null;if(l)for(let u of l.data.events){if(u.data.disabled||"GameControl"!==u.data.type)continue;let e=l;for(;this.usePhysics&&null!==(e=e.parent)?.parent;)e.data.physics;u.data.collisionEnabled&&(this.needsCollisionDetection=!0),null===c&&(c=u.data)}if(this.page.traverseEntity((e=>{for(let t of e.dataPatched.events)if(!1===t.data.disabled&&"Trigger"===t.data.type)return this.needsCollisionDetection=!0,!0})),l&&c&&(!0===l.data.visible||!0===l.data.physics.enabled)){i=i||c.camera===t.uuid||l.uuid===t.uuid;let e=new ij(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&c.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=e,n=c.joystickPosLoc,r=c.joystickRotLoc,s=c.jumpTouchButtonLoc,a=c.rotByTouch,Vg&&c.touchControl&&(this.joystickToGameControls[n]="pos","walk"===c.moveMode&&(this.joystickToGameControls[s]="jmp"),"joystick"===a&&(this.joystickToGameControls[r]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let e=this.gameControl.data;if(!this.navigationMeshWrapper){let t;this.navigationMeshWrapper=new VV(this.usePhysics,this.isExport),t="sphere"===e.collider.type?2*e.collider.radius:e.collider.height,t=Math.floor(t/e.navmesh.ch-1),this.navigationMeshWrapper.init({...e.navmesh,walkableHeight:t},this.gameControl,this.eventContext)}}if(!1===i){let{enableRotate:e,enablePan:i,enableZoom:n,autoRotate:r,hoverRotatePanMode:s}=this.eventManager.publish.orbitControls;(e||i||n||r||0!==s)&&(this.orbitControls=new aG(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let h=this.renderer.domElement.width/this.renderer.getPixelRatio(),d=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach(((e,t)=>{let i=document.body.appendChild(document.createElement("div")),[n,r,s]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[t],a=(h-5*n)/4+n,o={},l="jmp"===e,c=l?0:n;t<10?(t<5?o.top=c/2:o.bottom=c/2,o.left=c/2+t%5*a):10===t?(o.left=c/2,o.top=d/2):(o.right=c/2,o.top=d/2),o.top?o.top-=r[1]:o.bottom+=r[1],o.left?o.left+=r[0]:o.right-=r[0];for(let h in o)o[h]+="px";if(l){let e=i.appendChild(document.createElement("div"));Object.assign(e.style,o,{position:"absolute",width:n+"px",height:n+"px",backgroundColor:`rgba(255,255,255,${"show"===s?.4:0})`,zIndex:"9999",borderRadius:n+"px",border:"show"===s?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let r=n/16*16*.4;return"show"===s&&(e.innerHTML=`\n\t\t\t\t\t\t<svg width="${r}" height="${.4*n}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t`),e.addEventListener("pointerdown",(()=>{this.gameControl.movementState.jump=1,this.requestRender()})),e.addEventListener("touchend",(e=>e.preventDefault())),void(this.joysticks[t]=[void 0,i])}let u={zone:i,mode:"static",position:o,size:n};"hide"===s&&(u.restOpacity=0);let p=lF(u);p.on("move",((t,i)=>{let n=this.gameControl;"pos"===e?i.force<.2?n.moveForce=0:(n.movementState.movePosZ=Math.sin(-i.angle.radian),n.movementState.movePosX=Math.cos(-i.angle.radian),i.force>1.2?n.movementState.run=1:n.movementState.run=0,i.force<.3?n.moveForce=(i.force-.2)/.1:n.moveForce=1):"rot"===e&&(i.force<.2?n.rotForce=0:(n.movementState.rotPosX=i.vector.y,n.movementState.rotPosY=-i.vector.x,i.force<.3?n.rotForce=(i.force-.2)/.1:n.rotForce=1)),this.requestRender()})),p.on("end",((t,i)=>{let n=this.gameControl;"pos"===e?(n.movementState.movePosZ=0,n.movementState.movePosX=0,n.moveForce=1):"rot"===e&&(n.movementState.rotPosX=0,n.movementState.rotPosY=0,n.rotForce=1)})),this.joysticks[t]=[p,i]})),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout((()=>{this.collisionEvents.forEach((e=>e.initialDisabled=!1))}),80)}initPhysics(){this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=new cG.World(new cG.Vector3(0,this.gravity,0)),this.events=new cG.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren((i=>{let n;if(i instanceof PR){if(!i.objectForSample)return!0===i.object.dataPatched.physics.fusedBody&&"dynamic"===i.object.dataPatched.physics.rigidBody||void 0;if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else if(i instanceof f_)n=i.object;else{if(i instanceof HN||i instanceof dB)return;if(n=i,!1===n.dataPatched.cloner?.disabled&&n.dataPatched.cloner?.hideBase&&!0!==n.dataPatched.physics?.fusedBody)return!0}let r,s=n.dataPatched;for(let e of s.events)!0!==e.data.disabled&&"GameControl"===e.data.type&&(r=e.data);if(!s.physics||("visibility"===s.physics.enabled?!s.visible:!s.physics.enabled))return!0;i.updateMatrixWorldSVD();let a=MG(s),o=!1,l=n.userData.hasDestroy,c=n.userData.hasDrag,h=!1;for(let e of s.events)if(!0!==e.data.disabled)if("Collision"===e.data.type){o=!0;let t=new BV(e.id,e.data,n,this.page,this.sharedAssets,this.eventManager);t.initialDisabled=!0,this.collisionEvents.push(t),this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid].every((t=>t.id!==e.id))?this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid].push(t):this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid]=[t]}else if("Follow"===e.data.type){h=!0;let t=e.data.target;i.traverseVisible((e=>{e.userData.isFollowingObj=t}))}"dynamic"===s.physics.rigidBody&&!1===s.physics.fusedBody&&(i.matrixWorldFusedFalse=i.matrixWorld.clone());let d=i.geometry;if(void 0!==r){let e=cG.RigidBodyDesc.kinematicPositionBased();(i.hasNonUniformScale?i.matrixWorldRigid:i.matrixWorld).decompose(dG,uG,pG),i.position0=dG.clone().divideScalar(this.pixelsPerMeter),i.rotation0=uG.clone(),dG.divideScalar(this.pixelsPerMeter),e.setTranslation(dG.x,dG.y,dG.z).setRotation(uG);let t,a=this.sharedGameControlGlobals.rapierWorld.createRigidBody(e);i.rigidBody=a,t="sphere"===r.collider.type?cG.ColliderDesc.ball(r.collider.radius/this.pixelsPerMeter):"capsule"===r.collider.type?cG.ColliderDesc.capsule((r.collider.height/2-r.collider.radius)/this.pixelsPerMeter,r.collider.radius/this.pixelsPerMeter):cG.ColliderDesc.cuboid(r.collider.width/this.pixelsPerMeter/2,r.collider.height/this.pixelsPerMeter/2,r.collider.depth/this.pixelsPerMeter/2),t.setFrictionCombineRule(cG.CoefficientCombineRule.Average).setRestitutionCombineRule(cG.CoefficientCombineRule.Average).setDensity(s.physics.density).setFriction(s.physics.friction).setRestitution(s.physics.restitution);let o=this.sharedGameControlGlobals.rapierWorld.createCollider(t,a);this.sharedGameControlGlobals.colliderToEntity.set(o.handle,n),dG.fromArray(r.collider.position).multiply(pG.setFromMatrixScale(n.matrixWorld)).divideScalar(this.pixelsPerMeter),o.setTranslationWrtParent(dG);let l=(new ji).setFromEuler((new In).setFromVector3((new Vi).fromArray(r.collider.rotation)));o.setRotationWrtParent(l),o.setActiveEvents(cG.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(n,!0)}else"dynamic"===s.physics.rigidBody||a||h||l||c||o?(this.addRigidBody(i,n,{hasFollow:h,hasTransformAnim:a,hasDrag:c}),this.generateSensorColliderDescs(n,s.physics.fusedBody)):(d&&e.push(sj(d,i.matrixWorld)),s.physics.fusedBody&&i.traverseObject(((t,i)=>{if(0===i)return;let n;if(t instanceof PR){if(!t.objectForSample)return!0===t.object.dataPatched.physics.fusedBody&&"dynamic"===t.object.dataPatched.physics.rigidBody||void 0;if(t.objectForSample.dataPatched.physics.fusedBody)return;n=t.object}else{if(t instanceof HN||t instanceof dB)return;if(t instanceof f_)n=t.object;else if(n=t,n.dataPatched.cloner?.hideBase)return!0}let r=n.dataPatched;if("visibility"===r.physics.enabled?!r.visible:!r.physics.enabled)return!0;let s=t.geometry;void 0!==s?.getAttribute("position")&&e.push(sj(s,t.matrixWorld))})),this.generateSensorColliderDescs(n,s.physics.fusedBody,t));return!(!0!==s.physics?.fusedBody&&!r)||void 0})),0===e.length)return;let i=Dw(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let n=cG.RigidBodyDesc.fixed(),r=this.sharedGameControlGlobals.rapierWorld.createRigidBody(n),s=cG.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(cG.CoefficientCombineRule.Multiply).setRestitutionCombineRule(cG.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,r);for(let[a,o]of t){let e=this.sharedGameControlGlobals.rapierWorld.createCollider(a,r);this.sensorToTriggerEvent[e.handle]=o}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity((e=>{for(let t of e.dataPatched.events)if("Trigger"===t.data.type&&!0!==t.data.disabled){let i=new hG(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),n=(new bn).compose(gG.fromArray(t.data.position),bG.setFromEuler(mG.fromArray(t.data.rotation)),yG);if("box"===t.data.triggerZone){let r=new Wi;r.min.fromArray(t.data.size).multiplyScalar(-.5),r.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([r,n,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,n,e,i])}})),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach((e=>e.disconnect())),this.sharedGameControlGlobals.triggers.forEach((e=>e[3].disconnect())),this.sharedGameControlGlobals.triggers.length=0}deactivate(){if(this.isEnabled){this.isEnabled=!1,this.page.traverse((e=>{let t=e;t.matrixWorldFusedFalse&&(t.matrixWorldFusedFalse=void 0),t.rigidBody&&(t.rigidBody=void 0),t.position0&&(t.position0=void 0),t.rotation0&&(t.rotation0=void 0)})),this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),this.gameControl?.reset(),this.gameControl?.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach((e=>{let[t,i]=e;t?.destroy(),i.remove()})),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),this.navigationMeshWrapper?.dispose(),this.navigationMeshWrapper=void 0;for(let e of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))e.forEach((e=>e.disconnect()));this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let n=!0;if(void 0!==this.orbitControls&&this.orbitControls.needsUpdate&&(n=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,n=!1):2===this.initializationCounter&&this.gameControl&&(n=!this.gameControl.update(e,t,i)&&n),!1===this.usePhysics&&this.checkTrigger(),this.usePhysics){let t=.016666666666666666;if(0===e)n=this.stepPhysics()&&n;else{let i=e/1e3;i<t&&i>.55*t&&(i=t),this.accumulator+=i;let r=performance.now(),s=0,a=6;for(;this.accumulator>=t&&s<a&&(n=this.stepPhysics()&&n,this.accumulator-=t,s++,!(performance.now()-r>1e3*t)););this.accumulator=this.accumulator%t}}return n}stepPhysics(){for(let e of this.sharedGameControlGlobals.entitiesWithTransformAnim){(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(dG,uG,pG),fG.setFromQuaternion(uG);let t=e;void 0===t.prevR?(t.prevR=fG.clone(),t.prevT=dG.clone()):(t.prevR.copy(fG),t.prevT.copy(dG)),e.rigidBody&&(e.rigidBody.setNextKinematicTranslation(dG.divideScalar(this.pixelsPerMeter)),e.rigidBody.setNextKinematicRotation(uG))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),this.events?.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){let n,r=(this.sharedGameControlGlobals.rapierWorld?.getCollider(i))._parent;if(t.cloner)for(let s of t.cloner.children)if(s.rigidBody===r){n=s;break}e.dispatch(n),t.dispatchEvent(EG)}updateUseWindowEvents(e){this.orbitControls?.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let n=xG.copy(e.matrixWorld).invert();e.traverseEntity(((r,s)=>{if(!1===t&&1===s)return!0;for(let t of r.dataPatched.events)if("Trigger"===t.data.type&&!0!==t.data.disabled){let s,a=new hG(t.id,t.data,r,this.page,this.sharedAssets,this.eventManager);if(s="box"===t.data.triggerZone?cG.ColliderDesc.cuboid(...t.data.size.map((e=>e/(2*this.pixelsPerMeter)))):cG.ColliderDesc.ball(t.data.radius/this.pixelsPerMeter),s.setDensity(0).setSensor(!0).setActiveEvents(cG.ActiveEvents.COLLISION_EVENTS),gG.fromArray(t.data.position),bG.setFromEuler(mG.fromArray(t.data.rotation)),AG.compose(gG,bG,yG).premultiply(r.matrixWorld),i?(AG.decompose(gG,bG,vG),s.setActiveCollisionTypes(cG.ActiveCollisionTypes.KINEMATIC_FIXED|cG.ActiveCollisionTypes.DYNAMIC_FIXED)):(AG.premultiply(n).decompose(gG,bG,vG),e.rigidBody.bodyType()===cG.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===cG.RigidBodyType.Fixed?s.setActiveCollisionTypes(cG.ActiveCollisionTypes.KINEMATIC_FIXED|cG.ActiveCollisionTypes.DYNAMIC_FIXED):s.setActiveCollisionTypes(cG.ActiveCollisionTypes.KINEMATIC_KINEMATIC|cG.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),gG.divideScalar(this.pixelsPerMeter),s.setTranslation(gG.x,gG.y,gG.z),s.setRotation(bG),i)i.push([s,a]);else{let t=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e.rigidBody);this.sensorToTriggerEvent[t.handle]=a}}}))}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,n,r,s]=this.sharedGameControlGlobals.triggers[t];for(let t=0;t<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;t++){let a=this.sharedGameControlGlobals.entitiesWithTransformAnim[t];if(r===a||!1===s.isValidTriggeringObject(d_.is(a)?a:a.object))continue;let o=xG.copy(r.matrixWorld).decompose(gG,SG,vG).compose(gG,SG,yG).multiply(n),l=AG.copy(a.matrixWorld).invert().multiply(o);i instanceof Wi?e=a.bvhGeometry.boundsTree.intersectsBox(i,l):(_G.radius=i,_G.center.setFromMatrixPosition(l),e=a.bvhGeometry.boundsTree.intersectsSphere(_G)),e?-1===s.currentIntersectedObjects.indexOf(a)&&(s.currentIntersectedObjects.push(a),s.dispatch(),r.dispatchEvent(CG)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter((e=>e!==a))}}}};function IG(e){let t=this._clip.duration,i=this._clip.start??0,n=this.loop,r=this.time+e,s=this._loopCount,a=n===Rt;if(0===e)return-1===s?r:a&&1===(1&s)?t-(r-i):r;if(2200===n){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===s&&(e>=0?(s=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=t||r<i){let n=Math.floor((r-i)/(t-i));r-=(t-i)*n,s+=Math.abs(n);let o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(r=e>0?t:i,1===this.repetitions&&(r=t)),this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){let t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(a&&1===(1&s))return t-(r-i)}return r}var PG,DG=!1,RG=class{constructor(e,t,i,n){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=n,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=e=>{"Empty"===e.data.type&&e.data.animations&&e.data.animations.forEach(((t,i)=>{let n=t[0]+"/";if(Array.isArray(e.identity)?n+=e.identity[0]:n+=e.uuid,this.clipIdToAction[n])return;let r=Rc.parse(JSON.parse(t[2]));e.animations[i]=r;let s=this.mixer.clipAction(r,e);!1===DG&&(Object.getPrototypeOf(s)._updateTime=IG,DG=!0),s.clampWhenFinished=!0,this.clipIdToAction[n]=s}))},this.mixer=new wh(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let n=i.animations.find((t=>t.uuid===e));if(!n)return;let r=this.clipIdToAction[e];!r||(r.stop(),this.mixer.uncacheClip(n),delete this.clipIdToAction[e],i.animations=i.animations.filter((t=>t.uuid!==e)))}get isPlaying(){return Object.values(this.clipIdToAction).some((e=>e.isRunning()))}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach((e=>{e.repetitions=1/0,e.loop=2201})),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),"pingpong"===e.direction&&0!==e.repeat&&(i.loop=Rt)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){if(this.needsUpdate)this.needsUpdate=!1;else if(!1===this.isPlaying||this.animationInspectorState?.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return uz(this.activeClip??void 0)}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(e/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},BG=new WeakMap,LG=class extends kc{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){let r=new zc(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{this.decodeDracoFile(e,t).catch(n)}),i,n)}decodeDracoFile(e,t,i,n){let r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(BG.has(e)){let t=BG.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n,r=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(r,s).then((i=>(n=i,new Promise(((i,s)=>{n._callbacks[r]={resolve:i,reject:s},n.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return a.catch((()=>!0)).then((()=>{n&&r&&this._releaseTask(n,r)})),BG.set(e,{key:i,promise:a}),a}_createGeometry(e){let t=new yr;e.index&&t.setIndex(new or(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let n=e.attributes[i],r=n.name,s=n.array,a=n.itemSize;t.setAttribute(r,new or(s,a))}return t}_loadLibrary(e,t){let i=new zc(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise(((t,n)=>{i.load(e,t,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{let i=t[0];e||(this.decoderConfig.wasmBinary=t[1]);let n=OG.toString(),r=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){let i=t.data;switch(i.type){case"decode":e._callbacks[i.id].resolve(i);break;case"error":e._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};function OG(){let e,t;function i(e,t,i,n,r,s){let a=s.num_components(),o=i.num_points()*a,l=o*r.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),h=e._malloc(l);t.GetAttributeDataArrayForAllPoints(i,s,c,l,h);let d=new r(e.HEAPF32.buffer,h,o).slice();return e._free(h),{name:n,array:d,itemSize:a}}onmessage=function(n){let r=n.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":let n=r.buffer,s=r.taskConfig;t.then((e=>{let t=e.draco,a=new t.Decoder,o=new t.DecoderBuffer;o.Init(new Int8Array(n),n.byteLength);try{let e=function(e,t,n,r){let s,a,o=r.attributeIDs,l=r.attributeTypes,c=t.GetEncodedGeometryType(n);if(c===e.TRIANGULAR_MESH)s=new e.Mesh,a=t.DecodeBufferToMesh(n,s);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");s=new e.PointCloud,a=t.DecodeBufferToPointCloud(n,s)}if(!a.ok()||0===s.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());let h={index:null,attributes:[]};for(let d in o){let n,a,c=self[l[d]];if(r.useUniqueIDs)a=o[d],n=t.GetAttributeByUniqueId(s,a);else{if(a=t.GetAttributeId(s,e[o[d]]),-1===a)continue;n=t.GetAttribute(s,a)}h.attributes.push(i(e,t,s,d,c,n))}return c===e.TRIANGULAR_MESH&&(h.index=function(e,t,i){let n=3*i.num_faces(),r=4*n,s=e._malloc(r);t.GetTrianglesUInt32Array(i,r,s);let a=new Uint32Array(e.HEAPF32.buffer,s,n).slice();return e._free(s),{array:a,itemSize:1}}(e,t,s)),e.destroy(s),h}(t,a,o,s),n=e.attributes.map((e=>e.array.buffer));e.index&&n.push(e.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:e},n)}catch(l){console.error(l),self.postMessage({type:"error",id:r.id,error:l.message})}finally{t.destroy(o),t.destroy(a)}}))}}}async function NG(e){if(PG){let t,i={attributeIDs:PG.defaultAttributeIDs,attributeTypes:PG.defaultAttributeTypes,useUniqueIDs:!1};try{t=await PG.decodeGeometry(new Int8Array(e).buffer,i)}catch(Ev){console.error(Ev)}if(t)return{index:t.index?{array:t.index.array}:void 0,attributes:Object.entries(t.attributes).map((e=>{let[t,i]=e;return{name:t,itemSize:i.itemSize,array:i.array}}))}}return null}var kG=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=e=>{let t=[e.clientX,e.clientY],i=(new Date).getTime();if(this._clickCount>0){let e=t[0]-this._lastPosition[0],i=t[1]-this._lastPosition[1];Math.sqrt(e*e+i*i)>this._distance&&(this._clickCount=0)}this._lastPosition=t,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=e=>{}}start(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this._target&&this.stop(),this.reset(),this._delay=t,this._distance=i,this._target=e,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},FG=class{constructor(e,t,i,n,r,s,a,o){this.eventId=e,this.id=t,this.data=i,this.dataEvent=n,this.object=r,this.stage=!1,this.actions=Az(n,i.actions,s,a,o,r)}disconnect(){xz(this.actions)}dispatchIn(){this.actions.Audio.forEach((e=>e.dispatchBasic())),this.actions.Particles.forEach((e=>e.dispatchBasic())),this.actions.Video.forEach((e=>e.dispatchBasic())),this.actions.Create.forEach((e=>e.dispatch())),this.actions.Destroy.forEach((e=>e.dispatch())),this.actions.Reset.forEach((e=>e.dispatch())),this.actions.Link.forEach((e=>e.dispatch())),this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.actions.Transition.forEach((e=>e.toggle())),this.actions.Animation.forEach((e=>e.play())),this.actions.SwitchCamera.forEach((e=>e.play())),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.ClearLocalStorage.forEach((e=>e.dispatch())),this.actions.UserAPI.forEach((e=>e.dispatch()))}dispatchOut(){this.actions.Transition.forEach((e=>{e.toggle()}))}},UG=class extends Aj{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(e,t)=>{this.breakpoints.forEach((i=>{let n,r=qb.deviceToSize(i.data.size),s="horizontal"===i.dataEvent.orientation?e:t;switch(i.data.operator){case"<":n=s<r[0];break;case">":n=s>r[0];break;case"<>":n=s>r[0]&&s<r[1]}i.stage!==n&&(i.stage=n,i.stage?i.dispatchIn():i.dispatchOut())}))},this.onResizeObserver=new ResizeObserver((e=>{for(let t of e){let{width:e,height:i}=t.contentRect;this.resize(e,i)}}))}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let n=i=>{if(i.visible&&i.data?.events.length)for(let{data:n,id:r}of i.data.events)n.disabled||"Resize"===n.type&&n.breakpoints.forEach((s=>{let{data:a,id:o}=s;try{let s=new FG(r,o,a,n,i,e,t,this.eventManager);this.breakpoints.push(s)}catch(cA){}}))};e.traverseEntity((e=>{(e instanceof DN||e instanceof xN)&&e.frame?.traverse((e=>{n(e)})),n(e)}))}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach((e=>{e.disconnect()})),this.breakpoints=[]}},zG=class extends Aj{constructor(e,t){super(e),this.eventManager=t,this.userAPIs={},this.events=[],this.onSuccess=e=>{let{userAPIId:t}=e;this.events.forEach((e=>{e.data.userAPIId===t&&e.dispatchSuccess()}))},this.onError=e=>{let{userAPIId:t}=e;this.events.forEach((e=>{e.data.userAPIId===t&&e.dispatchError()}))},this.userAPIs=e.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity((e=>{e.data?.events.filter((e=>"API"===e.data.type&&!e.data.disabled)).forEach((t=>{this.events.push(new jG(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),Object.entries(this.userAPIs).forEach((e=>{let[t,i]=e;i.on("success",this.onSuccess),i.on("error",this.onError),i.autostart&&i.callUserAPI(this.eventContext.sharedAssets)}))}disconnect(){Object.entries(this.userAPIs).forEach((e=>{let[t,i]=e;i.off("success",this.onSuccess),i.off("error",this.onError)}))}},jG=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.successActions=Az(t,t.successActions,n,r,s,i),this.errorActions=Az(t,t.errorActions,n,r,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(e){e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}},VG=class extends Aj{constructor(e,t){super(e),this.eventManager=t,this.userWebhooks={},this.events=[],this.onMessage=e=>{let{userWebhookId:t}=e;this.events.forEach((e=>{e.data.userWebhookId===t&&e.dispatch()}))},this.userWebhooks=e.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity((e=>{e.data?.events.filter((e=>"WEBHOOK"===e.data.type&&!e.data.disabled)).forEach((t=>{this.events.push(new GG(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),Object.entries(this.userWebhooks).forEach((e=>{let[t,i]=e;i.connect(),i.on("message",this.onMessage)}))}disconnect(){Object.entries(this.userWebhooks).forEach((e=>{let[t,i]=e;i.off("message",this.onMessage),i.disconnect()}))}},GG=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=Az(t,t.actions,n,r,s,i)}dispatch(){let e=this.actions;e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}};var HG=new Vi(0,0,1),WG=new Vi,QG=new Vi,qG=new fi,XG=class{constructor(e,t,i,n,r){this.containerScene=e,this.raycaster=t,this.sharedAssets=i,this.requestRender=n,this.onExit=r,this.htmlInput=null,this.virtualInput=null,this.helper=new dO,this.doubleClickHandler=new kG,this.isDragging=!1,this.plane=new Yr,this.caretInterval=0,this.planeIntersection=new Vi,this.projected=new pi,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{let e=this.virtualInput?.data;if(void 0!==this.virtualInput&&e){let t=e.material,i=function(e,t){let i=lA.fromHex(3223857),n=.8;for(let r of e.layers){if("light"===r.data.type||"displace"===r.data.type||"fresnel"===r.data.type||"matcap"===r.data.type||"texture"===r.data.type||"toon"===r.data.type||"outline"===r.data.type||"transmission"===r.data.type||"noise"===r.data.type)continue;let e="string"==typeof r.data.alpha?Number(t.getVariable(r.data.alpha)):r.data.alpha;if("color"===r.data.type&&e>.3){i=fO(r.data.color,t),n=e;break}if(("depth"===r.data.type||"gradient"===r.data.type)&&e>.3){let e=mO(r.data);i={r:e[0],g:e[1],b:e[2]},n="string"==typeof r.data.alpha?1:r.data.alpha;break}}return{...i,a:n}}("string"==typeof t?this.sharedAssets.data.materials[t]:t,this.sharedAssets);this.helper.setCaretColor(i)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval((()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()}),600))},this.handleCaretUpdate=e=>{if(!this.htmlInput||!this.virtualInput)return;let t=this.helper,i="ArrowLeft"===e?.key||"ArrowRight"===e?.key,n="ArrowUp"===e?.key||"ArrowDown"===e?.key;this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(t.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:i,verticalKeyMove:n}),this.startAnimateTextCursor()):t.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=function(){let e=document.createElement("textarea");return e.style.position="fixed",e.style.top="200px",e.style.left="400px",e.style.zIndex="-1",e.style.border="1px solid rgba(255,0,0,0.5)",e.style.width="10px",e.style.height="500px",e.style.color="white",e.style.opacity="0.5",e.style.background="transparent",e.style.display="none",e.style.margin="0px",e.style.padding="0px",e.style.boxSizing="content-box",e.style.pointerEvents="none",e}(),this.htmlInput}connect(){}disconnect(){this.stopAnimateTextCursor(),this.helper.hide(),this.htmlInput?.remove(),this.doubleClickHandler.stop()}handleMouseDown(){if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let e=this.doubleClickHandler.clickCount,{index:t,lineIndex:i,characterIndex:n}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,e>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};this.virtualInput?.wrappedText?.length&&"\n"===this.virtualInput.wrappedText[i][Math.max(0,n-1)]&&(t--,n--),this._lastIndex=t,this._isFirstDragMove=!0;let r=this.checkClickedObject();if(1===e){if(null===r)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=t,this.isDragging=!0,this.setInputSelection(t)}else r===this.virtualInput&&(2===e?this.selectClosestWord(i,n):e>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(e){if(this.virtualInput=e,this.updateTextInputStyles(),this.htmlInput)if(e){let e=this.data?.geometry.text;this.htmlInput.value="string"==typeof e?"":e?.textValue.toString()??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:e}=this;if(e)return e.dataPatched}applyRangeToTextInput(){if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let e=this.selectionOnDragStart,{index:t,lineIndex:i,characterIndex:n}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};void 0!==i&&void 0!==n&&"\n"===this.virtualInput?.wrappedText[i][n-1]&&t--,this.htmlInput.setSelectionRange(Math.min(e,t),Math.max(e,t))}checkClickedObject(){if(this.virtualInput){let e=this.raycaster.intersectObject(this.virtualInput,!1);if(e.length>0){let t=e[0];if(t.object instanceof EN)return t.object}}return null}selectClosestWord(e,t){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,n=i[e],r=t+1,s=t;" "!==n[t]&&(r=this.findNextCharOccurence(n,t,"forward"," "),s=this.findNextCharOccurence(n,t,"backward"," "),s>0&&s++,r>=n.length-1&&e===i.length-1&&r++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,e,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,e,r);this.setInputSelection(o,l)}findNextCharOccurence(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ",r=Math.max(0,e.length-1),s="forward"===i?r:0,a="forward"===i?1:-1,o=Math.max(Math.min(t,r),0);for(;o!==s;)if(o+=a,e.charAt(o)===n)return o;return s}getPointOnPlane(){let e=this.virtualInput?.data;if(this.virtualInput&&e&&this.raycaster.ray.intersectsPlane(this.plane)){null===this.planeIntersection&&(this.planeIntersection=new Vi);let t=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(t){this.planeIntersection.copy(this.virtualInput.worldToLocal(t));let i="number"==typeof e.geometry.width?e.geometry.width:1,n="number"==typeof e.geometry.height?e.geometry.height:1;this.projected.set(t.x+.5*i,t.y-.5*n)}}}updatePlane(){let e=this.virtualInput?.data;this.virtualInput&&e&&(qG.getNormalMatrix(this.virtualInput.matrixWorld),WG.copy(HG).applyMatrix3(qG).normalize(),this.virtualInput.localToWorld(QG.set(0,0,e.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(WG,QG))}setInputSelection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;this.htmlInput?.setSelectionRange(e,t),setTimeout((()=>{this.htmlInput?.focus()}))}updateTextInputStyles(){let e=this.virtualInput?.data;this.virtualInput&&e&&this.htmlInput&&(this.htmlInput.style.fontSize=e.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=e.geometry.letterSpacing*e.geometry.fontSize+"px",this.htmlInput.style.lineHeight=e.geometry.fontSize*e.geometry.lineHeight+"px",this.htmlInput.style.width=e.geometry.width+"px",this.htmlInput.style.height=e.geometry.height+"px",this.htmlInput.style.textAlign=function(e){return 4===e?"justify":2===e?"right":3===e?"center":"left"}(e.geometry.horizontalAlign))}};var YG=(e,t)=>{if("string"==typeof e){let i=t.data(e);if(i)return YG(i.value,t)}return Ox.getDisplayedValue(e)};function KG(e,t){let i=e.text,n="";if("string"==typeof i){let e=t.variables.data(n);e&&(n=YG(e.value,t.variables))}else n=i.textValue.toString();return n}var JG=class extends Aj{constructor(e,t){super(e),this.eventManager=t,this._textInputs=[],this.sceneHelpers=new No,this.helper=new dO,this._onMouseDownFocusIn=e=>{if(Xg.length>1)return;this.eventContext.updateRaycaster(e);let t=null;if(this.eventContext.raycaster)for(let i of this._textInputs)if(this.eventContext.raycaster.intersectObject(i,!0).length>0){t=i;break}this.focusOnTextInput(t),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(e),this._onMouseDown(e)},this.onExit=()=>{let{virtualInput:e}=this.textInputManager;if(null===e)return;let t=this.textInputManager.htmlInput;this.helper.hide(),t?.setSelectionRange(t.value.length,t.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:i}=this.eventContext;i.removeEventListener("pointerdown",this._onMouseDown,!1),i.removeEventListener("pointerup",this._onMouseUp,!1),i.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),i.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=e=>{this.eventContext.updateRaycaster(e),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=e=>{this.eventContext.updateRaycaster(e),this.textInputManager.handleMouseMove()},this._onTextEdit=e=>{let{htmlInput:t,virtualInput:i,helper:n}=this.textInputManager;if(!t||!i)return;let r=t.value;i.textGeometry.setText(r).then((()=>{this.eventContext.requestRender()}));let s=i.data;n.update();let a=s.geometry.text;if("string"==typeof a){let e=a;this.eventContext.sharedAssets.updateVariable(e,{textValue:r})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=e=>{this.textInputManager.handleCaretUpdate(e)},this._onKeyPress=e=>{"Escape"===e.key&&this.onExit()},this.textInputManager=new XG(this.sceneHelpers,e.raycaster,e.sharedAssets,e.requestRender,this.onExit)}connect(){let e=[];if(this.eventContext.scene.traverseEntity((t=>{t instanceof EN&&e.push(t)})),this._textInputs=e,0===e.length)return;let{domElement:t}=this.eventContext;t.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let e=this.textInputManager.htmlInput,{domElement:t}=this.eventContext;t.removeEventListener("pointerdown",this._onMouseDownFocusIn),e?.removeEventListener("keyup",this._onCaretUpdate),e?.removeEventListener("keydown",this._onCaretUpdate),e?.removeEventListener("beforeinput",this._onCaretUpdate),e?.removeEventListener("paste",this._onCaretUpdate),e?.removeEventListener("cut",this._onCaretUpdate),e?.removeEventListener("select",this._onCaretUpdate),e?.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach((e=>{let t=KG(e.data.geometry,this.eventContext.sharedAssets.data);e.textGeometry.setText(t)})),t.removeEventListener("pointerdown",this._onMouseDown,!1),t.removeEventListener("pointerup",this._onMouseUp,!1),t.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(e){this.textInputManager.focus(e),this.textInputManager.onTextMaterialChanged();let t=this.textInputManager.htmlInput;if(!t||null===e)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=KG(e.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);t.value=i,t.setSelectionRange(0,0),this.textInputManager.helper.show(e),t.style.display="block",t.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDownFocusIn),n.addEventListener("pointerdown",this._onMouseDown,!1),n.addEventListener("pointerup",this._onMouseUp,!1),n.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},ZG=class extends Aj{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onVoice=e=>{let{value:t,frequencies:i}=e;this.events.forEach((e=>{e.dispatch()}))}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity((e=>{e.data?.events.filter((e=>"AIAssistantListener"===e.data.type&&!e.data.disabled)).forEach((t=>{this.events.push(new $G(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){this.openAIRealtime?.off("voice",this.onVoice)}},$G=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=Az(t,t.actions,n,r,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(e){e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}},eH=class extends Aj{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onTriggerEvent=e=>{let{description:t,direction:i}=e,n=this.events.find((e=>e.data.description===t));n&&("backward"===i?n.dispatchReverse():n.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity((e=>{e.data?.events.filter((e=>"AIAssistantTrigger"===e.data.type&&!e.data.disabled)).forEach((t=>{this.events.push(new tH(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){this.openAIRealtime?.off("trigger_event",this.onTriggerEvent)}},tH=class{constructor(e,t,i,n,r,s){this.id=e,this.data=t,this.object=i,this.actions=Az(t,t.actions,n,r,s,i)}dispatch(){let e=this.actions;e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch())),e.ClearLocalStorage.forEach((e=>e.dispatch())),e.UserAPI.forEach((e=>e.dispatch()))}dispatchReverse(){let e=this.actions;e.Transition.forEach((e=>e.reverseFromCurrent())),e.Particles.forEach((e=>e.reverseFromCurrent())),e.Animation.forEach((e=>e.reverseFromCurrent())),e.SwitchCamera.forEach((e=>e.reverseFromCurrent())),e.Create.forEach((e=>e.dispatchStop()))}},iH=class{constructor(e,t,i,n,r){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=n,this.sharedVariables=r,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=e=>{let t=window.parent!==window,i=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(e.touches.length>1||this.preventTouchScroll||!1===t&&!1===i)&&e.preventDefault()},this.onMouseWheelPreventScroll=e=>{this.preventScroll&&e.preventDefault()},this.onMouseMove=e=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(e),pressed:e.buttons>0}},this.onMouseDown=e=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(e),pressed:!0}},this.onMouseUp=e=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(e),pressed:!1}},this.getMousePosition=e=>{let{domRect:t}=this.eventContext,{pageX:i,pageY:n}=e.touches?.length>0?e.touches[0]:e;return{x:i-(t.left+window.scrollX),y:n-(t.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=n.requestRender}activate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new Ej(this.eventContext),VariableChange:new LV(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new zG(this.eventContext,this),WEBHOOK:new VG(this.eventContext,this),AIAssistantListener:new ZG(this.eventContext,this),AIAssistantTrigger:new eH(this.eventContext,this),Conditional:new Bj(this.eventContext,this),Start:new RV(this.eventContext,this),Basic:new Mj(this.eventContext,this,this.needsRaycast),MouseHover:new MV(this.eventContext,this),Scroll:new PV(this.eventContext,this),Follow:new oV(this.eventContext,this),DragDrop:new Jj(this.eventContext,this),LookAt:new wV(this.eventContext),Resize:new UG(this.eventContext,this),Textfields:new JG(this.eventContext,this)};let{page:t,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),t.traverseEntity((e=>{e.addEventListener("requestRender",this.requestRender)})),Object.values(this.handlers).forEach((e=>e.connect())),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,e||this.eventContext.sharedAssets.openAIRealtime?.connect()}deactivate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:t,domElement:i}=this.eventContext;i.style.cursor="",Object.values(this.handlers).forEach((e=>e.disconnect())),this.controlsManager.gameControl?.disposeActions(),this.controlsManager.disconnectEvents(),t.traverseEntity((e=>{e.removeEventListener("requestRender",this.requestRender),e.destroyedInAction=!1})),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),e||this.eventContext.sharedAssets.openAIRealtime?.disconnect()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if("Conditional"===i.data.type&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),"Conditional"===i.data.type||"SetVariable"===i.data.type)for(let e of"Conditional"===i.data.type?i.data.condition:i.data.expression)"id"in e&&Array.isArray(e.id)&&("mouse"===e.id[0]&&(this.needsMouse=!0),"raycast"===e.id[0]&&(this.needsRaycast=!0));"DynamicVariablePlay"===i.data.type&&""!==i.data.variableId&&("Play"===i.data.mode||"PlayPause"===i.data.mode||"Toggle"===i.data.mode)&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity((e=>{if(e.data?.events.length)for(let i of e.data.events)if("VariableChange"===i.data.type&&("mouseProperty"===i.data.variableId&&(this.needsMouse=!0),"raycastProperty"===i.data.variableId&&(this.needsRaycast=!0)),"Conditional"===i.data.type)for(let e of["inActions","outActions"])i.data[e].forEach(t);else if("DragDrop"===i.data.type)for(let e of["drag","drop"])i.data.dragDropActions[e].forEach(t);else if("GameControl"===i.data.type)for(let e of["idle","move","jump","run"])i.data.gameActions[e].forEach(t);else if("Resize"===i.data.type)for(let e of i.data.breakpoints)e.data.actions.forEach(t);else"LookAt"===i.data.type||"API"===i.data.type||i.data.actions.forEach(t)}))}},nH=class{constructor(e,t,i,n,r){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=(new pi).copy(i),this._editorSize=(new pi).copy(n),this._aspect=t.aspect,this._fov=r??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||"PerspectiveCamera"!==this._camera.cameraType)return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._camera)if("PerspectiveCamera"===this._camera.cameraType){let t=this._frameSize.y,i=this._editorSize.y,n=this._fov;if(e&&t>i){let e=function(e,t,i,n,r){return(e-t)/(i-t)*(r-n)+n}(t,1080,2160,1,15)/100;n*=t/i,n*=1-e}this._camera.aspect=this._aspect,this._camera.fov=n,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};var rH=class{get sharedAssets(){return this.shared}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.shared=new LD(e.shared,t,!0,i),this.scene=new Bk(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof xN&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity((e=>{e instanceof jD&&e.markGeometryAsReachable(this.shared)})),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},sH=class{constructor(e){let{x:t=10,y:i=10}=e;this._startTime=0;let n=document.getElementById("spe-perfs");n?this.element=n:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${t}px`,this.element.style.top=`${i}px`}dispose(){this.element.parentElement?.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function aH(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function oH(e){return e instanceof qD?"SubdivObject":"NonParametricGeometry"===e.geometry.type?"NonParametric":"Mesh"}function lH(e,t){let i=function(e,t){let i={};return e.traverseEntity((e=>{if(!e.visible||!(e instanceof sT)||"Mesh"!==e.type||Array.isArray(e.material)||e.states&&Object.keys(e.states).length)return;let n=e.parent;for(;n;){if(n instanceof sT&&e.states&&Object.keys(e.states).length)return;n=n.parent}let r=e.material.uuid,s=t.shared.materials[r];if(s){if(!GA.isMergable(s))return}else{let i=t.scene.objects.get(e.uuid)?.data;if(i&&"material"in i&&"string"!=typeof i.material){if(!GA.isMergable(i.material))return;r=GA.getHash(i.material)}}i[r]||(i[r]={});let a=i[r][oH(e)];if(a){if(a.push(e),e.cloner)for(let t of e.cloner.children)a.push(t)}else if(i[r][oH(e)]=[e],e.cloner)for(let t of e.cloner.children)i[r][oH(e)].push(t)})),i}(t,e),n=function(e){let t=0;return Object.values(e).forEach((e=>{Object.values(e).forEach((e=>{let i=e.length;i>t&&(t=i)}))})),t}(i),r=new Array(n),s=0,a=new Array(n),o=0,l=new Array(n),c=0,h=new Array(n),d=0;for(let[u,p]of Object.entries(i))for(let e of Object.values(p)){if(o=0,c=0,e.forEach((e=>{e instanceof sT&&(a[o++]=e.geometry.clone(),l[c++]=e)})),c<2)continue;for(let e=0;e<c;e++)l[e].updateWorldMatrix(!0,!1),a[e].applyMatrix4(l[e].matrixWorld),l[e].matrixWorld.determinant()<0&&aH(a[e]);let n=Dw(a.slice(0,o),!1);if(n){let e;if("SubdivObject"===u)console.warn("Turning subdiv object into mesh"),e=new Rr(n,l[0].material);else e=new Rr(n,l[0].material);e.castShadow=l[0].castShadow,e.receiveShadow=l[0].receiveShadow,t.add(e);let a=e=>{d=0;for(let t of e)t.children&&a(t.children),t instanceof sT&&(Array.isArray(t.material)||i[t.material.uuid]&&i[t.material.uuid][oH(t)]&&i[t.material.uuid][oH(t)].length>1||(h[d++]=t));for(let i=0;i<d;i++)t.attach(h[i])};for(let t=0;t<c;t++){let e=l[t];a(e.children),r[s++]=e}}}for(let u=0;u<s;u++)r[u].removeFromParent()}var cH=u(A(),1),hH=new pi;var dH=class{constructor(e){let{renderOnDemand:t,renderMode:i="auto"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=e=>{if(this.time=e,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,this._perfs?.start(),this._renderer)if(this._isPaused||!("manual"===this.renderMode&&!this._renderRequested||"auto"===this.renderMode&&this._skipRender)){if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&(this._eventManager.handlers?.Start.hasVideoAction||this._eventManager.handlers?.Basic.hasVideoAction||this._eventManager.handlers?.Conditional.hasVideoAction)&&(this._skipRender=!1),this._animationControls?.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene?.traverseVisibleEntity((e=>{"ParticleSystem"===e.type&&(e.update(this.dt),this._skipRender=!1)})),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),this._eventManager?.isEnabled&&((this._eventManager.handlers?.Follow).onAnimationFrameDamping(),(this._eventManager.handlers?.LookAt).onAnimationFrameDamping(),(this._eventManager.handlers?.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let e=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=e,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),this._perfs?.end()}else this._perfs?.end();else this._perfs?.end()},this._resize=e=>{if(this._renderer){if(1===this._viewportMode&&this._frameView&&(this._frameView.frameSize=hH.set(this._viewportWidth,this._viewportHeight)),e){let e=this._viewportWidth,t=this._viewportHeight;this._renderer.setSize(e-1,t-1,!1),this._renderer.setSize(e,t,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=this._scene?.activeCamera,this._scene?.updateViewPlaneSize(this._frameView?.frameSize?.x??this._viewportWidth,this._frameView?.frameSize?.y??this._viewportHeight,this._frameView?.enableResponsive??!1),this._camera){let e=Object.values(this._data?.frames??{})[0].preset??"fullscreen";this._frameView?.setCamera(this._camera),this._frameView?.updateCamera("fullscreen"!==e),"PerspectiveCamera"===this._camera.cameraType&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=bg(this._resize,10),this._onScroll=e=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new sH({x:10,y:10})),function(e){e.addEventListener("pointerdown",Zg,!0),e.addEventListener("pointerdown",ev,!0),e.addEventListener("pointermove",ev,!0),e.addEventListener("pointerup",$g,!0),e.addEventListener("pointercancel",$g,!0),e.addEventListener("pointerleave",$g,!0),window.addEventListener("keydown",iv,!0),window.addEventListener("keyup",nv,!0)}(e)}async load(e,t,i){(function(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)})(e),this.disposed=!1;let n=await(await fetch(e,i)).arrayBuffer();await this.start(n,{variables:t})}async start(e){let{interactive:t=!0,variables:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.disposed)return;let n=await async function(e,t){let[i,n]=$v(xb.deserialize(new Uint8Array(e)));return Pw(i),t&&t(i),n.result().data}(e);this._data=n;let r=function(e){let t=[];return e.scene.objects.traverse(((e,i)=>{"Mesh"===i.type&&"NonParametricGeometry"===i.geometry.type&&void 0!==i.geometry.data.draco&&t.push(i)})),t}(n);n.version&&(0,cH.default)(n.version,"1.9.87")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([r.length&&(PG||(PG=new LG).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),PG.decoderPending),ZR(n)&&VM(),QD(n)&&vM(),Px.physicsEnabled(n.scene.objects)&&dv(),uR(n)&&cD(),wk(n)&&Ik(),tD(n)&&eD(),zO(n)&&UO(),HV(n)&&ov()].filter(Boolean)),r.length&&await async function(e){for(let t of e){let e=await NG(t.geometry.data.draco);if(e){let i=t.geometry.data;e.index&&(i.index={array:e.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};e.attributes.forEach((e=>{let{name:t,array:i,itemSize:r}=e;n[t]={array:i,itemSize:r,type:"Float32Array",normalized:!1}})),i.attributes=n,i.draco=void 0}}}(r),this._eventManager?.deactivate(),this._controls?.deactivate(),this._scene?.dispose();let s=new rH(n);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let e=performance.now();lH(n,s.scene);let t=performance.now();console.log("Merged geometries in ",t-e," ms")}ZR(n)&&this._scene.traverse((e=>{nB(e)&&e.recomputeBoolean()})),this._sharedAssetsManager.setRequestRender((()=>{this._requestRenderAutoMode(),this._scene?.traverse((e=>{e instanceof PR&&e.pendingMediaLoad&&e.update()}))})),this._scene?.traverse((e=>{"ParticleSystem"===e.type&&(e.wakeUp(),e.data.autoPlay?e.start():e.stop())}));let a=Object.keys(n.shared.fonts).map((e=>this._sharedAssetsManager.getFont(e).loadingPromise));if(Promise.all(a).then((()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()})),uR(n)&&function(e){if(Px.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse(((e,i)=>{if(i.events)if(Array.isArray(i.events)){for(let n of i.events)if(!0!==n.data.disabled&&"GameControl"===n.data.type&&n.data.collisionEnabled){t=!0;break}}else for(let n of Object.values(i.events))if(!0!==n.disabled&&"GameControl"===n.type&&n.collisionEnabled){t=!0;break}})),t}(n)&&await Promise.all(a),zO(n)){let e=[];this._scene.traverseEntity((t=>{(t instanceof DN||t instanceof xN)&&t.uiCanvas&&e.push(t.uiCanvas)})),await Promise.all(e.map((e=>e.promise)))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),ZU(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new aO({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=!0===n.scene.publish.hdTransmission,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),n.shared.images.SplineWatermark)){let e=this._sharedAssetsManager.getImage("SplineWatermark");await e.loadPromise;let t=e.getTexture(1001);this._renderer.pipeline.setWatermark(t)}wk(n)&&this._scene.initializeSplatViewer(),void 0!==n.scene.blueNoiseTextureData&&this._renderer.pipeline.updateBlueNoiseTexture(n.scene.blueNoiseTextureData);let o=Object.values(n.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):("fullscreen"===o.preset?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new nH(this._renderer,this._camera,new pi(this._viewportWidth,this._viewportHeight),new pi(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&"fullscreen"===o.preset),t){let e=new bj(this._renderer,this.data.scene.publish,this._scene,(()=>this._scene.activeCamera),this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new TG(e),this._animationControls=new RG(this._scene,this._requestRenderAutoMode),this._eventManager=new iH(n.scene.publish,this._controls,this._animationControls,e,n.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then((()=>{this._resize(!0)})),void 0!==i&&this.setVariables(i),0===this.dt&&(this.render(performance.now()),setTimeout((()=>{this._renderer?.setAnimationLoop(this.render)}),0)),this._resizeObserverTimeout=setTimeout((()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver((()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()})),this._resizeObserver.observe(this.canvas.parentElement))}),300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(void 0!==this._data){let t=Object.entries(e);for(let[e,i]of t)this.setVariable(e,i)}}setVariable(e,t){let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let e=t;"number"==typeof i.data.value?e="number"==typeof t?t:"boolean"==typeof t?!0===t?1:0:parseFloat(t):"boolean"==typeof i.data.value?e="number"==typeof t?!!t:"boolean"==typeof t?t:"false"!==t.toLocaleLowerCase()&&!!t:"string"!=typeof i.data.value&&void 0!==i.data.value.textValue&&(e=t.toString());let n="string"==typeof e?{textValue:e}:e;this._sharedAssetsManager?.updateVariable(i.id,n),this.requestRender(),this._requestRenderAutoMode()}else void 0===i?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach((t=>{void 0===e[t.data.name]&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))})),e}getVariable(e){let t=this._getVariableByName(e);if(t){let e=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(e)}}_getVariableValue(e){return"string"!=typeof e&&Ox.isTextValue(e)?Ox.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find((t=>t.data.name===e));return t&&this._variablesCache.set(e,t),t}}findObjectById(e){let t=this._scene?.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){let t=this._scene?.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){let e=[];return this._scene?.traverseEntity((t=>{if(t.uuid!==xA&&!this._scene.isInvisibleObjects(t)&&!(t instanceof xN)){let i=this._createProxyObject(t);i&&e.push(i)}})),e}getSplineEvents(){return(this._eventManager?.handlers?.Spline).splineEvents}emitEvent(e,t){(this.findObjectById(t)||this.findObjectByName(t))?.emitEvent(e)}emitEventReverse(e,t){(this.findObjectById(t)||this.findObjectByName(t))?.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){this._controls?.orbitControls instanceof aG&&this._controls?.orbitControls.setZoom(e)}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){let{r:t,g:i,b:n,a:r}={r:0,g:0,b:0,a:1},s=new fT(t,i,n,r);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}this._scene?.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){this.disposed=!0,this._eventManager?.deactivate(),this._scene?.dispose(),this._sharedAssetsManager?.dispose(),this._proxyObjectCache.forEach((e=>{Pd.unsubscribe(e)})),this._variablesCache.clear(),this._renderer?.setAnimationLoop(null),this._renderer?.dispose(),this._renderer=void 0,this._sharedAssetsManager?.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),void 0!==this._resizeObserverTimeout&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),this._controls?.deactivate(),this.dt=0,function(e){e.removeEventListener("pointerdown",Zg,!0),e.removeEventListener("pointerdown",ev,!0),e.removeEventListener("pointermove",ev,!0),e.removeEventListener("pointerup",$g,!0),e.removeEventListener("pointercancel",$g,!0),e.removeEventListener("pointerleave",$g,!0),window.removeEventListener("keydown",iv,!0),window.removeEventListener("keyup",nv,!0)}(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){this._isPaused||(this._renderer?.setAnimationLoop(null),this._isPaused=!0,this._eventManager?.pause(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){!this._isPaused||(this._isPaused=!1,this._eventManager?.resume(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!0),this._renderer?.setAnimationLoop(this.render))}setGlobalEvents(e){this._eventManager?.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){if(null==e)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors((e=>{e instanceof xN&&(t=e.name)}));let i={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof xN||e instanceof Bk?void 0:e.parent?.uuid,emitEvent(t){e.dispatchEvent({type:"userEvent",eventName:t})},emitEventReverse(t){e.dispatchEvent({type:"userEvent",eventName:t,reverse:!0})}},n=Pd(i,((t,i)=>{"object"!=typeof e[t]&&Object.getOwnPropertyDescriptor(e,t)?.writable&&(e[t]=i),this._requestRenderAutoMode(),e.updateMatrix()}));return this._proxyObjectCache.set(e.uuid,n),n}setUIWasmUrl(e){jI.skiaWasmUrl=e}},uH=i(446);function pH(e){return t=>{e.forEach((e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)}))}}const fH=[],mH={width:"100%",height:"100%"},gH=(0,r.forwardRef)((function(e,t){let{className:i,children:s,debounceTime:a=300,ignoreDimensions:o=fH,parentSizeStyles:l,enableDebounceLeadingCall:c=!0,resizeObserverPolyfill:h,...d}=e;const u=(0,r.useRef)(null),p=(0,r.useRef)(0),[f,m]=(0,r.useState)({width:0,height:0,top:0,left:0}),g=(0,r.useMemo)((()=>{const e=Array.isArray(o)?o:[o];return uH((t=>{m((i=>Object.keys(i).filter((e=>i[e]!==t[e])).every((t=>e.includes(t)))?i:t))}),a,{leading:c})}),[a,c,o]);return(0,r.useEffect)((()=>{const e=new(h||window.ResizeObserver)((e=>{e.forEach((e=>{const{left:t,top:i,width:n,height:r}=(null==e?void 0:e.contentRect)??{};p.current=window.requestAnimationFrame((()=>{g({width:n,height:r,top:i,left:t})}))}))}));return u.current&&e.observe(u.current),()=>{window.cancelAnimationFrame(p.current),e.disconnect(),g.cancel()}}),[g,h]),(0,n.jsx)("div",{style:{...mH,...l},ref:pH([t,u]),className:i,...d,children:s({...f,ref:u.current,resize:g})})})),vH=(0,r.forwardRef)(((e,t)=>{let{scene:i,style:s,onSplineMouseDown:a,onSplineMouseUp:o,onSplineMouseHover:l,onSplineKeyDown:c,onSplineKeyUp:h,onSplineStart:d,onSplineLookAt:u,onSplineFollow:p,onSplineScroll:f,onLoad:m,renderOnDemand:g=!0,children:v,...y}=e;const b=(0,r.useRef)(null),[A,x]=(0,r.useState)(!0),[w,S]=(0,r.useState)();if(w)throw w;return(0,r.useEffect)((()=>{let e;x(!0);const t=[{name:"mouseDown",cb:a},{name:"mouseUp",cb:o},{name:"mouseHover",cb:l},{name:"keyDown",cb:c},{name:"keyUp",cb:h},{name:"start",cb:d},{name:"lookAt",cb:u},{name:"follow",cb:p},{name:"scroll",cb:f}];if(b.current){async function n(){await e.load(i);for(let i of t)i.cb&&e.addEventListener(i.name,i.cb);x(!1),null==m||m(e)}e=new dH(b.current,{renderOnDemand:g}),n().catch((e=>{S(e)}))}return()=>{for(let i of t)i.cb&&e.removeEventListener(i.name,i.cb);e.dispose()}}),[i]),(0,n.jsx)(gH,{ref:t,parentSizeStyles:{overflow:"hidden",...s},debounceTime:50,...y,children:()=>(0,n.jsxs)(n.Fragment,{children:[A&&v,(0,n.jsx)("canvas",{ref:b,style:{display:A?"none":"block"}})]})})}))}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}i.m=e,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"===typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"===typeof n.then)return n}var s=Object.create(null);i.r(s);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&n;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>a[e]=()=>n[e]));return a.default=()=>n,i.d(s,a),s}})(),i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>"static/js/"+e+"."+{23:"d25be6c5",160:"ac343af7",208:"1e040775",293:"6d5e3ec8",516:"74989fed",519:"d5471612",917:"0fa270c1",946:"2704e283"}[e]+".chunk.js",i.miniCssF=e=>{},i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="fullstack-ecommerce:";i.l=(n,r,s,a)=>{if(e[n])e[n].push(r);else{var o,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+s){o=d;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",t+s),o.src=n),e[n]=[r];var u=(t,i)=>{o.onerror=o.onload=null,clearTimeout(p);var r=e[n];if(delete e[n],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((e=>e(i))),t)return t(i)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),i.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="/",(()=>{var e={792:0};i.f.j=(t,n)=>{var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var s=new Promise(((i,n)=>r=e[t]=[i,n]));n.push(r[2]=s);var a=i.p+i.u(t),o=new Error;i.l(a,(n=>{if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,r[1](o)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,s,a=n[0],o=n[1],l=n[2],c=0;if(a.some((t=>0!==e[t]))){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(l)l(i)}for(t&&t(n);c<a.length;c++)s=a[c],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0},n=self.webpackChunkfullstack_ecommerce=self.webpackChunkfullstack_ecommerce||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";var e={};i.r(e),i.d(e,{hasBrowserEnv:()=>_l,hasStandardBrowserEnv:()=>Cl,hasStandardBrowserWebWorkerEnv:()=>Ml,navigator:()=>El,origin:()=>Tl});var t,n=i(5043),r=i.t(n,2),s=i(4391);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},a.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(t||(t={}));const o="popstate";function l(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function c(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(th){}}}function h(e,t){return{usr:e.state,key:e.key,idx:t}}function d(e,t,i,n){return void 0===i&&(i=null),a({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?p(t):t,{state:i,key:t&&t.key||n||Math.random().toString(36).substr(2,8)})}function u(e){let{pathname:t="/",search:i="",hash:n=""}=e;return i&&"?"!==i&&(t+="?"===i.charAt(0)?i:"?"+i),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function p(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function f(e,i,n,r){void 0===r&&(r={});let{window:s=document.defaultView,v5Compat:c=!1}=r,p=s.history,f=t.Pop,m=null,g=v();function v(){return(p.state||{idx:null}).idx}function y(){f=t.Pop;let e=v(),i=null==e?null:e-g;g=e,m&&m({action:f,location:A.location,delta:i})}function b(e){let t="null"!==s.location.origin?s.location.origin:s.location.href,i="string"===typeof e?e:u(e);return i=i.replace(/ $/,"%20"),l(t,"No window.location.(origin|href) available to create URL for href: "+i),new URL(i,t)}null==g&&(g=0,p.replaceState(a({},p.state,{idx:g}),""));let A={get action(){return f},get location(){return e(s,p)},listen(e){if(m)throw new Error("A history only accepts one active listener");return s.addEventListener(o,y),m=e,()=>{s.removeEventListener(o,y),m=null}},createHref:e=>i(s,e),createURL:b,encodeLocation(e){let t=b(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,i){f=t.Push;let r=d(A.location,e,i);n&&n(r,e),g=v()+1;let a=h(r,g),o=A.createHref(r);try{p.pushState(a,"",o)}catch(l){if(l instanceof DOMException&&"DataCloneError"===l.name)throw l;s.location.assign(o)}c&&m&&m({action:f,location:A.location,delta:1})},replace:function(e,i){f=t.Replace;let r=d(A.location,e,i);n&&n(r,e),g=v();let s=h(r,g),a=A.createHref(r);p.replaceState(s,"",a),c&&m&&m({action:f,location:A.location,delta:0})},go:e=>p.go(e)};return A}var m;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(m||(m={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function g(e,t,i){return void 0===i&&(i="/"),v(e,t,i,!1)}function v(e,t,i,n){let r=D(("string"===typeof t?p(t):t).pathname||"/",i);if(null==r)return null;let s=y(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let i=e.length===t.length&&e.slice(0,-1).every(((e,i)=>e===t[i]));return i?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(s);let a=null;for(let o=0;null==a&&o<s.length;++o){let e=P(r);a=T(s[o],e,n)}return a}function y(e,t,i,n){void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===n&&(n="");let r=(e,r,s)=>{let a={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};a.relativePath.startsWith("/")&&(l(a.relativePath.startsWith(n),'Absolute route path "'+a.relativePath+'" nested under path "'+n+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(n.length));let o=N([n,a.relativePath]),c=i.concat(a);e.children&&e.children.length>0&&(l(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),y(e.children,t,c,o)),(null!=e.path||e.index)&&t.push({path:o,score:M(o,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var i;if(""!==e.path&&null!=(i=e.path)&&i.includes("?"))for(let n of b(e.path))r(e,t,n);else r(e,t)})),t}function b(e){let t=e.split("/");if(0===t.length)return[];let[i,...n]=t,r=i.endsWith("?"),s=i.replace(/\?$/,"");if(0===n.length)return r?[s,""]:[s];let a=b(n.join("/")),o=[];return o.push(...a.map((e=>""===e?s:[s,e].join("/")))),r&&o.push(...a),o.map((t=>e.startsWith("/")&&""===t?"/":t))}const A=/^:[\w-]+$/,x=3,w=2,S=1,_=10,E=-2,C=e=>"*"===e;function M(e,t){let i=e.split("/"),n=i.length;return i.some(C)&&(n+=E),t&&(n+=w),i.filter((e=>!C(e))).reduce(((e,t)=>e+(A.test(t)?x:""===t?S:_)),n)}function T(e,t,i){void 0===i&&(i=!1);let{routesMeta:n}=e,r={},s="/",a=[];for(let o=0;o<n.length;++o){let e=n[o],l=o===n.length-1,c="/"===s?t:t.slice(s.length)||"/",h=I({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),d=e.route;if(!h&&l&&i&&!n[n.length-1].route.index&&(h=I({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!h)return null;Object.assign(r,h.params),a.push({params:r,pathname:N([s,h.pathname]),pathnameBase:k(N([s,h.pathnameBase])),route:d}),"/"!==h.pathnameBase&&(s=N([s,h.pathnameBase]))}return a}function I(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[i,n]=function(e,t,i){void 0===t&&(t=!1);void 0===i&&(i=!0);c("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let n=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,i)=>(n.push({paramName:t,isOptional:null!=i}),i?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(n.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let s=new RegExp(r,t?void 0:"i");return[s,n]}(e.path,e.caseSensitive,e.end),r=t.match(i);if(!r)return null;let s=r[0],a=s.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:n.reduce(((e,t,i)=>{let{paramName:n,isOptional:r}=t;if("*"===n){let e=o[i]||"";a=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[i];return e[n]=r&&!l?void 0:(l||"").replace(/%2F/g,"/"),e}),{}),pathname:s,pathnameBase:a,pattern:e}}function P(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return c(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function D(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,n=e.charAt(i);return n&&"/"!==n?null:e.slice(i)||"/"}function R(e,t,i,n){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the `to."+i+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function B(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function L(e,t){let i=B(e);return t?i.map(((e,t)=>t===i.length-1?e.pathname:e.pathnameBase)):i.map((e=>e.pathnameBase))}function O(e,t,i,n){let r;void 0===n&&(n=!1),"string"===typeof e?r=p(e):(r=a({},e),l(!r.pathname||!r.pathname.includes("?"),R("?","pathname","search",r)),l(!r.pathname||!r.pathname.includes("#"),R("#","pathname","hash",r)),l(!r.search||!r.search.includes("#"),R("#","search","hash",r)));let s,o=""===e||""===r.pathname,c=o?"/":r.pathname;if(null==c)s=i;else{let e=t.length-1;if(!n&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}s=e>=0?t[e]:"/"}let h=function(e,t){void 0===t&&(t="/");let{pathname:i,search:n="",hash:r=""}="string"===typeof e?p(e):e,s=i?i.startsWith("/")?i:function(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?i.length>1&&i.pop():"."!==e&&i.push(e)})),i.length>1?i.join("/"):"/"}(i,t):t;return{pathname:s,search:F(n),hash:U(r)}}(r,s),d=c&&"/"!==c&&c.endsWith("/"),u=(o||"."===c)&&i.endsWith("/");return h.pathname.endsWith("/")||!d&&!u||(h.pathname+="/"),h}const N=e=>e.join("/").replace(/\/\/+/g,"/"),k=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),F=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",U=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function z(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const j=["post","put","patch","delete"],V=(new Set(j),["get",...j]);new Set(V),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},G.apply(this,arguments)}const H=n.createContext(null);const W=n.createContext(null);const Q=n.createContext(null);const q=n.createContext(null);const X=n.createContext({outlet:null,matches:[],isDataRoute:!1});const Y=n.createContext(null);function K(){return null!=n.useContext(q)}function J(){return K()||l(!1),n.useContext(q).location}function Z(e){n.useContext(Q).static||n.useLayoutEffect(e)}function $(){let{isDataRoute:e}=n.useContext(X);return e?function(){let{router:e}=ce(oe.UseNavigateStable),t=de(le.UseNavigateStable),i=n.useRef(!1);return Z((()=>{i.current=!0})),n.useCallback((function(n,r){void 0===r&&(r={}),i.current&&("number"===typeof n?e.navigate(n):e.navigate(n,G({fromRouteId:t},r)))}),[e,t])}():function(){K()||l(!1);let e=n.useContext(H),{basename:t,future:i,navigator:r}=n.useContext(Q),{matches:s}=n.useContext(X),{pathname:a}=J(),o=JSON.stringify(L(s,i.v7_relativeSplatPath)),c=n.useRef(!1);return Z((()=>{c.current=!0})),n.useCallback((function(i,n){if(void 0===n&&(n={}),!c.current)return;if("number"===typeof i)return void r.go(i);let s=O(i,JSON.parse(o),a,"path"===n.relative);null==e&&"/"!==t&&(s.pathname="/"===s.pathname?t:N([t,s.pathname])),(n.replace?r.replace:r.push)(s,n.state,n)}),[t,r,o,a,e])}()}function ee(e,t){let{relative:i}=void 0===t?{}:t,{future:r}=n.useContext(Q),{matches:s}=n.useContext(X),{pathname:a}=J(),o=JSON.stringify(L(s,r.v7_relativeSplatPath));return n.useMemo((()=>O(e,JSON.parse(o),a,"path"===i)),[e,o,a,i])}function te(e,i,r,s){K()||l(!1);let{navigator:a}=n.useContext(Q),{matches:o}=n.useContext(X),c=o[o.length-1],h=c?c.params:{},d=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let u,f=J();if(i){var m;let e="string"===typeof i?p(i):i;"/"===d||(null==(m=e.pathname)?void 0:m.startsWith(d))||l(!1),u=e}else u=f;let v=u.pathname||"/",y=v;if("/"!==d){let e=d.replace(/^\//,"").split("/");y="/"+v.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=g(e,{pathname:y});let A=ae(b&&b.map((e=>Object.assign({},e,{params:Object.assign({},h,e.params),pathname:N([d,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?d:N([d,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),o,r,s);return i&&A?n.createElement(q.Provider,{value:{location:G({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:t.Pop}},A):A}function ie(){let e=function(){var e;let t=n.useContext(Y),i=he(le.UseRouteError),r=de(le.UseRouteError);if(void 0!==t)return t;return null==(e=i.errors)?void 0:e[r]}(),t=z(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r};return n.createElement(n.Fragment,null,n.createElement("h2",null,"Unexpected Application Error!"),n.createElement("h3",{style:{fontStyle:"italic"}},t),i?n.createElement("pre",{style:s},i):null,null)}const ne=n.createElement(ie,null);class re extends n.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?n.createElement(X.Provider,{value:this.props.routeContext},n.createElement(Y.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function se(e){let{routeContext:t,match:i,children:r}=e,s=n.useContext(H);return s&&s.static&&s.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=i.route.id),n.createElement(X.Provider,{value:t},r)}function ae(e,t,i,r){var s;if(void 0===t&&(t=[]),void 0===i&&(i=null),void 0===r&&(r=null),null==e){var a;if(!i)return null;if(i.errors)e=i.matches;else{if(!(null!=(a=r)&&a.v7_partialHydration&&0===t.length&&!i.initialized&&i.matches.length>0))return null;e=i.matches}}let o=e,c=null==(s=i)?void 0:s.errors;if(null!=c){let e=o.findIndex((e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id])));e>=0||l(!1),o=o.slice(0,Math.min(o.length,e+1))}let h=!1,d=-1;if(i&&r&&r.v7_partialHydration)for(let n=0;n<o.length;n++){let e=o[n];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(d=n),e.route.id){let{loaderData:t,errors:n}=i,r=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||r){h=!0,o=d>=0?o.slice(0,d+1):[o[0]];break}}}return o.reduceRight(((e,r,s)=>{let a,l=!1,u=null,p=null;var f;i&&(a=c&&r.route.id?c[r.route.id]:void 0,u=r.route.errorElement||ne,h&&(d<0&&0===s?(f="route-fallback",!1||ue[f]||(ue[f]=!0),l=!0,p=null):d===s&&(l=!0,p=r.route.hydrateFallbackElement||null)));let m=t.concat(o.slice(0,s+1)),g=()=>{let t;return t=a?u:l?p:r.route.Component?n.createElement(r.route.Component,null):r.route.element?r.route.element:e,n.createElement(se,{match:r,routeContext:{outlet:e,matches:m,isDataRoute:null!=i},children:t})};return i&&(r.route.ErrorBoundary||r.route.errorElement||0===s)?n.createElement(re,{location:i.location,revalidation:i.revalidation,component:u,error:a,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}var oe=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(oe||{}),le=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(le||{});function ce(e){let t=n.useContext(H);return t||l(!1),t}function he(e){let t=n.useContext(W);return t||l(!1),t}function de(e){let t=function(){let e=n.useContext(X);return e||l(!1),e}(),i=t.matches[t.matches.length-1];return i.route.id||l(!1),i.route.id}const ue={};r.startTransition;function pe(e){l(!1)}function fe(e){let{basename:i="/",children:r=null,location:s,navigationType:a=t.Pop,navigator:o,static:c=!1,future:h}=e;K()&&l(!1);let d=i.replace(/^\/*/,"/"),u=n.useMemo((()=>({basename:d,navigator:o,static:c,future:G({v7_relativeSplatPath:!1},h)})),[d,h,o,c]);"string"===typeof s&&(s=p(s));let{pathname:f="/",search:m="",hash:g="",state:v=null,key:y="default"}=s,b=n.useMemo((()=>{let e=D(f,d);return null==e?null:{location:{pathname:e,search:m,hash:g,state:v,key:y},navigationType:a}}),[d,f,m,g,v,y,a]);return null==b?null:n.createElement(Q.Provider,{value:u},n.createElement(q.Provider,{children:r,value:b}))}function me(e){let{children:t,location:i}=e;return te(ge(t),i)}new Promise((()=>{}));n.Component;function ge(e,t){void 0===t&&(t=[]);let i=[];return n.Children.forEach(e,((e,r)=>{if(!n.isValidElement(e))return;let s=[...t,r];if(e.type===n.Fragment)return void i.push.apply(i,ge(e.props.children,s));e.type!==pe&&l(!1),e.props.index&&e.props.children&&l(!1);let a={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=ge(e.props.children,s)),i.push(a)})),i}var ve=i(579);const ye=n.lazy((()=>Promise.resolve().then(i.bind(i,1906)))),be=()=>(0,ve.jsx)("div",{className:"homeBannerContainer",children:(0,ve.jsx)("div",{className:"homeBannerSection",children:(0,ve.jsx)(n.Suspense,{fallback:(0,ve.jsx)("div",{children:"Loading..."}),children:(0,ve.jsx)(ye,{scene:"https://prod.spline.design/pry-Y-2U5rzeJAmc/scene.splinecode"})})})});var Ae=i(8587),xe=i(8168);function we(e){var t,i,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(i=we(e[t]))&&(n&&(n+=" "),n+=i)}else for(i in e)e[i]&&(n&&(n+=" "),n+=i);return n}const Se=function(){for(var e,t,i=0,n="",r=arguments.length;i<r;i++)(e=arguments[i])&&(t=we(e))&&(n&&(n+=" "),n+=t);return n};function _e(e,t){const i=(0,xe.A)({},t);return Object.keys(e).forEach((n=>{if(n.toString().match(/^(components|slots)$/))i[n]=(0,xe.A)({},e[n],i[n]);else if(n.toString().match(/^(componentsProps|slotProps)$/)){const r=e[n]||{},s=t[n];i[n]={},s&&Object.keys(s)?r&&Object.keys(r)?(i[n]=(0,xe.A)({},s),Object.keys(r).forEach((e=>{i[n][e]=_e(r[e],s[e])}))):i[n]=s:i[n]=r}else void 0===i[n]&&(i[n]=e[n])})),i}function Ee(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const n={};return Object.keys(e).forEach((r=>{n[r]=e[r].reduce(((e,n)=>{if(n){const r=t(n);""!==r&&e.push(r),i&&i[n]&&e.push(i[n])}return e}),[]).join(" ")})),n}var Ce=i(7266),Me=i(8052),Te=i(7868),Ie=i(9172),Pe=i(7758),De=i(8812),Re=i(8280);function Be(e,t){return(0,xe.A)({toolbar:{minHeight:56,[e.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[e.up("sm")]:{minHeight:64}}},t)}const Le={black:"#000",white:"#fff"},Oe={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},Ne={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},ke={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},Fe={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Ue={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},ze={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},je={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},Ve=["mode","contrastThreshold","tonalOffset"],Ge={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Le.white,default:Le.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},He={text:{primary:Le.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Le.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function We(e,t,i,n){const r=n.light||n,s=n.dark||1.5*n;e[t]||(e.hasOwnProperty(i)?e[t]=e[i]:"light"===t?e.light=(0,Ce.a)(e.main,r):"dark"===t&&(e.dark=(0,Ce.e$)(e.main,s)))}function Qe(e){const{mode:t="light",contrastThreshold:i=3,tonalOffset:n=.2}=e,r=(0,Ae.A)(e,Ve),s=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Ue[200],light:Ue[50],dark:Ue[400]}:{main:Ue[700],light:Ue[400],dark:Ue[800]}}(t),a=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Ne[200],light:Ne[50],dark:Ne[400]}:{main:Ne[500],light:Ne[300],dark:Ne[700]}}(t),o=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:ke[500],light:ke[300],dark:ke[700]}:{main:ke[700],light:ke[400],dark:ke[800]}}(t),l=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:ze[400],light:ze[300],dark:ze[700]}:{main:ze[700],light:ze[500],dark:ze[900]}}(t),c=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:je[400],light:je[300],dark:je[700]}:{main:je[800],light:je[500],dark:je[900]}}(t),h=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Fe[400],light:Fe[300],dark:Fe[700]}:{main:"#ed6c02",light:Fe[500],dark:Fe[900]}}(t);function d(e){return(0,Ce.eM)(e,He.text.primary)>=i?He.text.primary:Ge.text.primary}const u=e=>{let{color:t,name:i,mainShade:r=500,lightShade:s=300,darkShade:a=700}=e;if(t=(0,xe.A)({},t),!t.main&&t[r]&&(t.main=t[r]),!t.hasOwnProperty("main"))throw new Error((0,Te.A)(11,i?` (${i})`:"",r));if("string"!==typeof t.main)throw new Error((0,Te.A)(12,i?` (${i})`:"",JSON.stringify(t.main)));return We(t,"light",s,n),We(t,"dark",a,n),t.contrastText||(t.contrastText=d(t.main)),t},p={dark:He,light:Ge};return(0,Ie.A)((0,xe.A)({common:(0,xe.A)({},Le),mode:t,primary:u({color:s,name:"primary"}),secondary:u({color:a,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:u({color:o,name:"error"}),warning:u({color:h,name:"warning"}),info:u({color:l,name:"info"}),success:u({color:c,name:"success"}),grey:Oe,contrastThreshold:i,getContrastText:d,augmentColor:u,tonalOffset:n},p[t]),r)}const qe=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];const Xe={textTransform:"uppercase"},Ye='"Roboto", "Helvetica", "Arial", sans-serif';function Ke(e,t){const i="function"===typeof t?t(e):t,{fontFamily:n=Ye,fontSize:r=14,fontWeightLight:s=300,fontWeightRegular:a=400,fontWeightMedium:o=500,fontWeightBold:l=700,htmlFontSize:c=16,allVariants:h,pxToRem:d}=i,u=(0,Ae.A)(i,qe);const p=r/14,f=d||(e=>e/c*p+"rem"),m=(e,t,i,r,s)=>{return(0,xe.A)({fontFamily:n,fontWeight:e,fontSize:f(t),lineHeight:i},n===Ye?{letterSpacing:(a=r/t,Math.round(1e5*a)/1e5)+"em"}:{},s,h);var a},g={h1:m(s,96,1.167,-1.5),h2:m(s,60,1.2,-.5),h3:m(a,48,1.167,0),h4:m(a,34,1.235,.25),h5:m(a,24,1.334,0),h6:m(o,20,1.6,.15),subtitle1:m(a,16,1.75,.15),subtitle2:m(o,14,1.57,.1),body1:m(a,16,1.5,.15),body2:m(a,14,1.43,.15),button:m(o,14,1.75,.4,Xe),caption:m(a,12,1.66,.4),overline:m(a,12,2.66,1,Xe),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return(0,Ie.A)((0,xe.A)({htmlFontSize:c,pxToRem:f,fontFamily:n,fontSize:r,fontWeightLight:s,fontWeightRegular:a,fontWeightMedium:o,fontWeightBold:l},g),u,{clone:!1})}function Je(){return[`${arguments.length<=0?void 0:arguments[0]}px ${arguments.length<=1?void 0:arguments[1]}px ${arguments.length<=2?void 0:arguments[2]}px ${arguments.length<=3?void 0:arguments[3]}px rgba(0,0,0,0.2)`,`${arguments.length<=4?void 0:arguments[4]}px ${arguments.length<=5?void 0:arguments[5]}px ${arguments.length<=6?void 0:arguments[6]}px ${arguments.length<=7?void 0:arguments[7]}px rgba(0,0,0,0.14)`,`${arguments.length<=8?void 0:arguments[8]}px ${arguments.length<=9?void 0:arguments[9]}px ${arguments.length<=10?void 0:arguments[10]}px ${arguments.length<=11?void 0:arguments[11]}px rgba(0,0,0,0.12)`].join(",")}const Ze=["none",Je(0,2,1,-1,0,1,1,0,0,1,3,0),Je(0,3,1,-2,0,2,2,0,0,1,5,0),Je(0,3,3,-2,0,3,4,0,0,1,8,0),Je(0,2,4,-1,0,4,5,0,0,1,10,0),Je(0,3,5,-1,0,5,8,0,0,1,14,0),Je(0,3,5,-1,0,6,10,0,0,1,18,0),Je(0,4,5,-2,0,7,10,1,0,2,16,1),Je(0,5,5,-3,0,8,10,1,0,3,14,2),Je(0,5,6,-3,0,9,12,1,0,3,16,2),Je(0,6,6,-3,0,10,14,1,0,4,18,3),Je(0,6,7,-4,0,11,15,1,0,4,20,3),Je(0,7,8,-4,0,12,17,2,0,5,22,4),Je(0,7,8,-4,0,13,19,2,0,5,24,4),Je(0,7,9,-4,0,14,21,2,0,5,26,4),Je(0,8,9,-5,0,15,22,2,0,6,28,5),Je(0,8,10,-5,0,16,24,2,0,6,30,5),Je(0,8,11,-5,0,17,26,2,0,6,32,5),Je(0,9,11,-5,0,18,28,2,0,7,34,6),Je(0,9,12,-6,0,19,29,2,0,7,36,6),Je(0,10,13,-6,0,20,31,3,0,8,38,7),Je(0,10,13,-6,0,21,33,3,0,8,40,7),Je(0,10,14,-6,0,22,35,3,0,8,42,7),Je(0,11,14,-7,0,23,36,3,0,9,44,8),Je(0,11,15,-7,0,24,38,3,0,9,46,8)],$e=["duration","easing","delay"],et={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},tt={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function it(e){return`${Math.round(e)}ms`}function nt(e){if(!e)return 0;const t=e/36;return Math.round(10*(4+15*t**.25+t/5))}function rt(e){const t=(0,xe.A)({},et,e.easing),i=(0,xe.A)({},tt,e.duration);return(0,xe.A)({getAutoHeightDuration:nt,create:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{duration:r=i.standard,easing:s=t.easeInOut,delay:a=0}=n;(0,Ae.A)(n,$e);return(Array.isArray(e)?e:[e]).map((e=>`${e} ${"string"===typeof r?r:it(r)} ${s} ${"string"===typeof a?a:it(a)}`)).join(",")}},e,{easing:t,duration:i})}const st={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},at=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function ot(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{mixins:t={},palette:i={},transitions:n={},typography:r={}}=e,s=(0,Ae.A)(e,at);if(e.vars)throw new Error((0,Te.A)(18));const a=Qe(i),o=(0,Re.A)(e);let l=(0,Ie.A)(o,{mixins:Be(o.breakpoints,t),palette:a,shadows:Ze.slice(),typography:Ke(a,r),transitions:rt(n),zIndex:(0,xe.A)({},st)});l=(0,Ie.A)(l,s);for(var c=arguments.length,h=new Array(c>1?c-1:0),d=1;d<c;d++)h[d-1]=arguments[d];return l=h.reduce(((e,t)=>(0,Ie.A)(e,t)),l),l.unstable_sxConfig=(0,xe.A)({},Pe.A,null==s?void 0:s.unstable_sxConfig),l.unstable_sx=function(e){return(0,De.A)({sx:e,theme:this})},l}const lt=ot(),ct="$$material";const ht=function(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e},dt=e=>ht(e)&&"classes"!==e,ut=(0,Me.Ay)({themeId:ct,defaultTheme:lt,rootShouldForwardProp:dt}),pt=n.createContext(void 0);function ft(e){let{props:t,name:i}=e;return function(e){const{theme:t,name:i,props:n}=e;if(!t||!t.components||!t.components[i])return n;const r=t.components[i];return r.defaultProps?_e(r.defaultProps,n):r.styleOverrides||r.variants?n:_e(r,n)}({props:t,name:i,theme:{components:n.useContext(pt)}})}function mt(e){return ft(e)}function gt(e,t){"function"===typeof e?e(t):e&&(e.current=t)}function vt(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.useMemo((()=>t.every((e=>null==e))?null:e=>{t.forEach((t=>{gt(t,e)}))}),t)}const yt=vt,bt="undefined"!==typeof window?n.useLayoutEffect:n.useEffect;const At=function(e){const t=n.useRef(e);return bt((()=>{t.current=e})),n.useRef((function(){return(0,t.current)(...arguments)})).current},xt=At,wt={};const St=[];class _t{constructor(){this.currentId=null,this.clear=()=>{null!==this.currentId&&(clearTimeout(this.currentId),this.currentId=null)},this.disposeEffect=()=>this.clear}static create(){return new _t}start(e,t){this.clear(),this.currentId=setTimeout((()=>{this.currentId=null,t()}),e)}}function Et(){const e=function(e,t){const i=n.useRef(wt);return i.current===wt&&(i.current=e(t)),i}(_t.create).current;return function(e){n.useEffect(e,St)}(e.disposeEffect),e}let Ct=!0,Mt=!1;const Tt=new _t,It={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function Pt(e){e.metaKey||e.altKey||e.ctrlKey||(Ct=!0)}function Dt(){Ct=!1}function Rt(){"hidden"===this.visibilityState&&Mt&&(Ct=!0)}function Bt(e){const{target:t}=e;try{return t.matches(":focus-visible")}catch(i){}return Ct||function(e){const{type:t,tagName:i}=e;return!("INPUT"!==i||!It[t]||e.readOnly)||"TEXTAREA"===i&&!e.readOnly||!!e.isContentEditable}(t)}const Lt=function(){const e=n.useCallback((e=>{var t;null!=e&&((t=e.ownerDocument).addEventListener("keydown",Pt,!0),t.addEventListener("mousedown",Dt,!0),t.addEventListener("pointerdown",Dt,!0),t.addEventListener("touchstart",Dt,!0),t.addEventListener("visibilitychange",Rt,!0))}),[]),t=n.useRef(!1);return{isFocusVisibleRef:t,onFocus:function(e){return!!Bt(e)&&(t.current=!0,!0)},onBlur:function(){return!!t.current&&(Mt=!0,Tt.start(100,(()=>{Mt=!1})),t.current=!1,!0)},ref:e}};function Ot(e,t){return Ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ot(e,t)}function Nt(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Ot(e,t)}const kt=n.createContext(null);function Ft(e,t){var i=Object.create(null);return e&&n.Children.map(e,(function(e){return e})).forEach((function(e){i[e.key]=function(e){return t&&(0,n.isValidElement)(e)?t(e):e}(e)})),i}function Ut(e,t,i){return null!=i[t]?i[t]:e.props[t]}function zt(e,t,i){var r=Ft(e.children),s=function(e,t){function i(i){return i in t?t[i]:e[i]}e=e||{},t=t||{};var n,r=Object.create(null),s=[];for(var a in e)a in t?s.length&&(r[a]=s,s=[]):s.push(a);var o={};for(var l in t){if(r[l])for(n=0;n<r[l].length;n++){var c=r[l][n];o[r[l][n]]=i(c)}o[l]=i(l)}for(n=0;n<s.length;n++)o[s[n]]=i(s[n]);return o}(t,r);return Object.keys(s).forEach((function(a){var o=s[a];if((0,n.isValidElement)(o)){var l=a in t,c=a in r,h=t[a],d=(0,n.isValidElement)(h)&&!h.props.in;!c||l&&!d?c||!l||d?c&&l&&(0,n.isValidElement)(h)&&(s[a]=(0,n.cloneElement)(o,{onExited:i.bind(null,o),in:h.props.in,exit:Ut(o,"exit",e),enter:Ut(o,"enter",e)})):s[a]=(0,n.cloneElement)(o,{in:!1}):s[a]=(0,n.cloneElement)(o,{onExited:i.bind(null,o),in:!0,exit:Ut(o,"exit",e),enter:Ut(o,"enter",e)})}})),s}var jt=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},Vt=function(e){function t(t,i){var n,r=(n=e.call(this,t,i)||this).handleExited.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n));return n.state={contextValue:{isMounting:!0},handleExited:r,firstRender:!0},n}Nt(t,e);var i=t.prototype;return i.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},i.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(e,t){var i,r,s=t.children,a=t.handleExited;return{children:t.firstRender?(i=e,r=a,Ft(i.children,(function(e){return(0,n.cloneElement)(e,{onExited:r.bind(null,e),in:!0,appear:Ut(e,"appear",i),enter:Ut(e,"enter",i),exit:Ut(e,"exit",i)})}))):zt(e,s,a),firstRender:!1}},i.handleExited=function(e,t){var i=Ft(this.props.children);e.key in i||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var i=(0,xe.A)({},t.children);return delete i[e.key],{children:i}})))},i.render=function(){var e=this.props,t=e.component,i=e.childFactory,r=(0,Ae.A)(e,["component","childFactory"]),s=this.state.contextValue,a=jt(this.state.children).map(i);return delete r.appear,delete r.enter,delete r.exit,null===t?n.createElement(kt.Provider,{value:s},a):n.createElement(kt.Provider,{value:s},n.createElement(t,r,a))},t}(n.Component);Vt.propTypes={},Vt.defaultProps={component:"div",childFactory:function(e){return e}};const Gt=Vt;var Ht=i(3290);const Wt=function(e){const{className:t,classes:i,pulsate:r=!1,rippleX:s,rippleY:a,rippleSize:o,in:l,onExited:c,timeout:h}=e,[d,u]=n.useState(!1),p=Se(t,i.ripple,i.rippleVisible,r&&i.ripplePulsate),f={width:o,height:o,top:-o/2+a,left:-o/2+s},m=Se(i.child,d&&i.childLeaving,r&&i.childPulsate);return l||d||u(!0),n.useEffect((()=>{if(!l&&null!=c){const e=setTimeout(c,h);return()=>{clearTimeout(e)}}}),[c,l,h]),(0,ve.jsx)("span",{className:p,style:f,children:(0,ve.jsx)("span",{className:m})})},Qt=e=>e,qt=(()=>{let e=Qt;return{configure(t){e=t},generate:t=>e(t),reset(){e=Qt}}})(),Xt={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Yt(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const n=Xt[t];return n?`${i}-${n}`:`${qt.generate(e)}-${t}`}function Kt(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const n={};return t.forEach((t=>{n[t]=Yt(e,t,i)})),n}const Jt=Kt("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Zt=["center","classes","className"];let $t,ei,ti,ii,ni=e=>e;const ri=(0,Ht.i7)($t||($t=ni`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`)),si=(0,Ht.i7)(ei||(ei=ni`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`)),ai=(0,Ht.i7)(ti||(ti=ni`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`)),oi=ut("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),li=ut(Wt,{name:"MuiTouchRipple",slot:"Ripple"})(ii||(ii=ni`
  opacity: 0;
  position: absolute;

  &.${0} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  &.${0} {
    animation-duration: ${0}ms;
  }

  & .${0} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${0} {
    opacity: 0;
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  & .${0} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${0};
    animation-duration: 2500ms;
    animation-timing-function: ${0};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`),Jt.rippleVisible,ri,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),Jt.ripplePulsate,(e=>{let{theme:t}=e;return t.transitions.duration.shorter}),Jt.child,Jt.childLeaving,si,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),Jt.childPulsate,ai,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut})),ci=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiTouchRipple"}),{center:r=!1,classes:s={},className:a}=i,o=(0,Ae.A)(i,Zt),[l,c]=n.useState([]),h=n.useRef(0),d=n.useRef(null);n.useEffect((()=>{d.current&&(d.current(),d.current=null)}),[l]);const u=n.useRef(!1),p=Et(),f=n.useRef(null),m=n.useRef(null),g=n.useCallback((e=>{const{pulsate:t,rippleX:i,rippleY:n,rippleSize:r,cb:a}=e;c((e=>[...e,(0,ve.jsx)(li,{classes:{ripple:Se(s.ripple,Jt.ripple),rippleVisible:Se(s.rippleVisible,Jt.rippleVisible),ripplePulsate:Se(s.ripplePulsate,Jt.ripplePulsate),child:Se(s.child,Jt.child),childLeaving:Se(s.childLeaving,Jt.childLeaving),childPulsate:Se(s.childPulsate,Jt.childPulsate)},timeout:550,pulsate:t,rippleX:i,rippleY:n,rippleSize:r},h.current)])),h.current+=1,d.current=a}),[s]),v=n.useCallback((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const{pulsate:n=!1,center:s=r||t.pulsate,fakeElement:a=!1}=t;if("mousedown"===(null==e?void 0:e.type)&&u.current)return void(u.current=!1);"touchstart"===(null==e?void 0:e.type)&&(u.current=!0);const o=a?null:m.current,l=o?o.getBoundingClientRect():{width:0,height:0,left:0,top:0};let c,h,d;if(s||void 0===e||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)c=Math.round(l.width/2),h=Math.round(l.height/2);else{const{clientX:t,clientY:i}=e.touches&&e.touches.length>0?e.touches[0]:e;c=Math.round(t-l.left),h=Math.round(i-l.top)}if(s)d=Math.sqrt((2*l.width**2+l.height**2)/3),d%2===0&&(d+=1);else{const e=2*Math.max(Math.abs((o?o.clientWidth:0)-c),c)+2,t=2*Math.max(Math.abs((o?o.clientHeight:0)-h),h)+2;d=Math.sqrt(e**2+t**2)}null!=e&&e.touches?null===f.current&&(f.current=()=>{g({pulsate:n,rippleX:c,rippleY:h,rippleSize:d,cb:i})},p.start(80,(()=>{f.current&&(f.current(),f.current=null)}))):g({pulsate:n,rippleX:c,rippleY:h,rippleSize:d,cb:i})}),[r,g,p]),y=n.useCallback((()=>{v({},{pulsate:!0})}),[v]),b=n.useCallback(((e,t)=>{if(p.clear(),"touchend"===(null==e?void 0:e.type)&&f.current)return f.current(),f.current=null,void p.start(0,(()=>{b(e,t)}));f.current=null,c((e=>e.length>0?e.slice(1):e)),d.current=t}),[p]);return n.useImperativeHandle(t,(()=>({pulsate:y,start:v,stop:b})),[y,v,b]),(0,ve.jsx)(oi,(0,xe.A)({className:Se(Jt.root,s.root,a),ref:m},o,{children:(0,ve.jsx)(Gt,{component:null,exit:!0,children:l})}))})),hi=ci;function di(e){return Yt("MuiButtonBase",e)}const ui=Kt("MuiButtonBase",["root","disabled","focusVisible"]),pi=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],fi=ut("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${ui.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),mi=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiButtonBase"}),{action:r,centerRipple:s=!1,children:a,className:o,component:l="button",disabled:c=!1,disableRipple:h=!1,disableTouchRipple:d=!1,focusRipple:u=!1,LinkComponent:p="a",onBlur:f,onClick:m,onContextMenu:g,onDragLeave:v,onFocus:y,onFocusVisible:b,onKeyDown:A,onKeyUp:x,onMouseDown:w,onMouseLeave:S,onMouseUp:_,onTouchEnd:E,onTouchMove:C,onTouchStart:M,tabIndex:T=0,TouchRippleProps:I,touchRippleRef:P,type:D}=i,R=(0,Ae.A)(i,pi),B=n.useRef(null),L=n.useRef(null),O=yt(L,P),{isFocusVisibleRef:N,onFocus:k,onBlur:F,ref:U}=Lt(),[z,j]=n.useState(!1);c&&z&&j(!1),n.useImperativeHandle(r,(()=>({focusVisible:()=>{j(!0),B.current.focus()}})),[]);const[V,G]=n.useState(!1);n.useEffect((()=>{G(!0)}),[]);const H=V&&!h&&!c;function W(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d;return xt((n=>{t&&t(n);return!i&&L.current&&L.current[e](n),!0}))}n.useEffect((()=>{z&&u&&!h&&V&&L.current.pulsate()}),[h,u,z,V]);const Q=W("start",w),q=W("stop",g),X=W("stop",v),Y=W("stop",_),K=W("stop",(e=>{z&&e.preventDefault(),S&&S(e)})),J=W("start",M),Z=W("stop",E),$=W("stop",C),ee=W("stop",(e=>{F(e),!1===N.current&&j(!1),f&&f(e)}),!1),te=xt((e=>{B.current||(B.current=e.currentTarget),k(e),!0===N.current&&(j(!0),b&&b(e)),y&&y(e)})),ie=()=>{const e=B.current;return l&&"button"!==l&&!("A"===e.tagName&&e.href)},ne=n.useRef(!1),re=xt((e=>{u&&!ne.current&&z&&L.current&&" "===e.key&&(ne.current=!0,L.current.stop(e,(()=>{L.current.start(e)}))),e.target===e.currentTarget&&ie()&&" "===e.key&&e.preventDefault(),A&&A(e),e.target===e.currentTarget&&ie()&&"Enter"===e.key&&!c&&(e.preventDefault(),m&&m(e))})),se=xt((e=>{u&&" "===e.key&&L.current&&z&&!e.defaultPrevented&&(ne.current=!1,L.current.stop(e,(()=>{L.current.pulsate(e)}))),x&&x(e),m&&e.target===e.currentTarget&&ie()&&" "===e.key&&!e.defaultPrevented&&m(e)}));let ae=l;"button"===ae&&(R.href||R.to)&&(ae=p);const oe={};"button"===ae?(oe.type=void 0===D?"button":D,oe.disabled=c):(R.href||R.to||(oe.role="button"),c&&(oe["aria-disabled"]=c));const le=yt(t,U,B);const ce=(0,xe.A)({},i,{centerRipple:s,component:l,disabled:c,disableRipple:h,disableTouchRipple:d,focusRipple:u,tabIndex:T,focusVisible:z}),he=(e=>{const{disabled:t,focusVisible:i,focusVisibleClassName:n,classes:r}=e,s=Ee({root:["root",t&&"disabled",i&&"focusVisible"]},di,r);return i&&n&&(s.root+=` ${n}`),s})(ce);return(0,ve.jsxs)(fi,(0,xe.A)({as:ae,className:Se(he.root,o),ownerState:ce,onBlur:ee,onClick:m,onContextMenu:q,onFocus:te,onKeyDown:re,onKeyUp:se,onMouseDown:Q,onMouseLeave:K,onMouseUp:Y,onDragLeave:X,onTouchEnd:Z,onTouchMove:$,onTouchStart:J,ref:le,tabIndex:c?-1:T,type:D},oe,R,{children:[a,H?(0,ve.jsx)(hi,(0,xe.A)({ref:O,center:s},I)):null]}))})),gi=mi;const vi=i(7598).A;function yi(e){return Yt("MuiButton",e)}const bi=Kt("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]);const Ai=n.createContext({});const xi=n.createContext(void 0),wi=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],Si=e=>(0,xe.A)({},"small"===e.size&&{"& > *:nth-of-type(1)":{fontSize:18}},"medium"===e.size&&{"& > *:nth-of-type(1)":{fontSize:20}},"large"===e.size&&{"& > *:nth-of-type(1)":{fontSize:22}}),_i=ut(gi,{shouldForwardProp:e=>dt(e)||"classes"===e,name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,t[i.variant],t[`${i.variant}${vi(i.color)}`],t[`size${vi(i.size)}`],t[`${i.variant}Size${vi(i.size)}`],"inherit"===i.color&&t.colorInherit,i.disableElevation&&t.disableElevation,i.fullWidth&&t.fullWidth]}})((e=>{let{theme:t,ownerState:i}=e;var n,r;const s="light"===t.palette.mode?t.palette.grey[300]:t.palette.grey[800],a="light"===t.palette.mode?t.palette.grey.A100:t.palette.grey[700];return(0,xe.A)({},t.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":(0,xe.A)({textDecoration:"none",backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ce.X4)(t.palette.text.primary,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"text"===i.variant&&"inherit"!==i.color&&{backgroundColor:t.vars?`rgba(${t.vars.palette[i.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ce.X4)(t.palette[i.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"outlined"===i.variant&&"inherit"!==i.color&&{border:`1px solid ${(t.vars||t).palette[i.color].main}`,backgroundColor:t.vars?`rgba(${t.vars.palette[i.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ce.X4)(t.palette[i.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"contained"===i.variant&&{backgroundColor:t.vars?t.vars.palette.Button.inheritContainedHoverBg:a,boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2],backgroundColor:(t.vars||t).palette.grey[300]}},"contained"===i.variant&&"inherit"!==i.color&&{backgroundColor:(t.vars||t).palette[i.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[i.color].main}}),"&:active":(0,xe.A)({},"contained"===i.variant&&{boxShadow:(t.vars||t).shadows[8]}),[`&.${bi.focusVisible}`]:(0,xe.A)({},"contained"===i.variant&&{boxShadow:(t.vars||t).shadows[6]}),[`&.${bi.disabled}`]:(0,xe.A)({color:(t.vars||t).palette.action.disabled},"outlined"===i.variant&&{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`},"contained"===i.variant&&{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground})},"text"===i.variant&&{padding:"6px 8px"},"text"===i.variant&&"inherit"!==i.color&&{color:(t.vars||t).palette[i.color].main},"outlined"===i.variant&&{padding:"5px 15px",border:"1px solid currentColor"},"outlined"===i.variant&&"inherit"!==i.color&&{color:(t.vars||t).palette[i.color].main,border:t.vars?`1px solid rgba(${t.vars.palette[i.color].mainChannel} / 0.5)`:`1px solid ${(0,Ce.X4)(t.palette[i.color].main,.5)}`},"contained"===i.variant&&{color:t.vars?t.vars.palette.text.primary:null==(n=(r=t.palette).getContrastText)?void 0:n.call(r,t.palette.grey[300]),backgroundColor:t.vars?t.vars.palette.Button.inheritContainedBg:s,boxShadow:(t.vars||t).shadows[2]},"contained"===i.variant&&"inherit"!==i.color&&{color:(t.vars||t).palette[i.color].contrastText,backgroundColor:(t.vars||t).palette[i.color].main},"inherit"===i.color&&{color:"inherit",borderColor:"currentColor"},"small"===i.size&&"text"===i.variant&&{padding:"4px 5px",fontSize:t.typography.pxToRem(13)},"large"===i.size&&"text"===i.variant&&{padding:"8px 11px",fontSize:t.typography.pxToRem(15)},"small"===i.size&&"outlined"===i.variant&&{padding:"3px 9px",fontSize:t.typography.pxToRem(13)},"large"===i.size&&"outlined"===i.variant&&{padding:"7px 21px",fontSize:t.typography.pxToRem(15)},"small"===i.size&&"contained"===i.variant&&{padding:"4px 10px",fontSize:t.typography.pxToRem(13)},"large"===i.size&&"contained"===i.variant&&{padding:"8px 22px",fontSize:t.typography.pxToRem(15)},i.fullWidth&&{width:"100%"})}),(e=>{let{ownerState:t}=e;return t.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${bi.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${bi.disabled}`]:{boxShadow:"none"}}})),Ei=ut("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.startIcon,t[`iconSize${vi(i.size)}`]]}})((e=>{let{ownerState:t}=e;return(0,xe.A)({display:"inherit",marginRight:8,marginLeft:-4},"small"===t.size&&{marginLeft:-2},Si(t))})),Ci=ut("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.endIcon,t[`iconSize${vi(i.size)}`]]}})((e=>{let{ownerState:t}=e;return(0,xe.A)({display:"inherit",marginRight:-4,marginLeft:8},"small"===t.size&&{marginRight:-2},Si(t))})),Mi=n.forwardRef((function(e,t){const i=n.useContext(Ai),r=n.useContext(xi),s=mt({props:_e(i,e),name:"MuiButton"}),{children:a,color:o="primary",component:l="button",className:c,disabled:h=!1,disableElevation:d=!1,disableFocusRipple:u=!1,endIcon:p,focusVisibleClassName:f,fullWidth:m=!1,size:g="medium",startIcon:v,type:y,variant:b="text"}=s,A=(0,Ae.A)(s,wi),x=(0,xe.A)({},s,{color:o,component:l,disabled:h,disableElevation:d,disableFocusRipple:u,fullWidth:m,size:g,type:y,variant:b}),w=(e=>{const{color:t,disableElevation:i,fullWidth:n,size:r,variant:s,classes:a}=e,o=Ee({root:["root",s,`${s}${vi(t)}`,`size${vi(r)}`,`${s}Size${vi(r)}`,`color${vi(t)}`,i&&"disableElevation",n&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${vi(r)}`],endIcon:["icon","endIcon",`iconSize${vi(r)}`]},yi,a);return(0,xe.A)({},a,o)})(x),S=v&&(0,ve.jsx)(Ei,{className:w.startIcon,ownerState:x,children:v}),_=p&&(0,ve.jsx)(Ci,{className:w.endIcon,ownerState:x,children:p}),E=r||"";return(0,ve.jsxs)(_i,(0,xe.A)({ownerState:x,className:Se(i.className,w.root,c,E),component:l,disabled:h,focusRipple:!u,focusVisibleClassName:Se(w.focusVisible,f),ref:t,type:y},A,{classes:w,children:[S,a,_]}))})),Ti=Mi;var Ii={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Pi=n.createContext&&n.createContext(Ii),Di=["attr","size","title"];function Ri(e,t){if(null==e)return{};var i,n,r=function(e,t){if(null==e)return{};var i={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;i[n]=e[n]}return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function Bi(){return Bi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},Bi.apply(this,arguments)}function Li(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function Oi(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Li(Object(i),!0).forEach((function(t){Ni(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Li(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ni(e,t,i){return t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ki(e){return e&&e.map(((e,t)=>n.createElement(e.tag,Oi({key:t},e.attr),ki(e.child))))}function Fi(e){return t=>n.createElement(Ui,Bi({attr:Oi({},e.attr)},t),ki(e.child))}function Ui(e){var t=t=>{var i,{attr:r,size:s,title:a}=e,o=Ri(e,Di),l=s||t.size||"1em";return t.className&&(i=t.className),e.className&&(i=(i?i+" ":"")+e.className),n.createElement("svg",Bi({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,o,{className:i,style:Oi(Oi({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),a&&n.createElement("title",null,a),e.children)};return void 0!==Pi?n.createElement(Pi.Consumer,null,(e=>t(e))):t(Ii)}function zi(e){return Fi({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M295.6 163.7c-5.1 5-5.1 13.3-.1 18.4l60.8 60.9H124.9c-7.1 0-12.9 5.8-12.9 13s5.8 13 12.9 13h231.3l-60.8 60.9c-5 5.1-4.9 13.3.1 18.4 5.1 5 13.2 5 18.3-.1l82.4-83c1.1-1.2 2-2.5 2.7-4.1.7-1.6 1-3.3 1-5 0-3.4-1.3-6.6-3.7-9.1l-82.4-83c-4.9-5.2-13.1-5.3-18.2-.3z"},child:[]}]})(e)}function ji(e){return Fi({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm52.7 283.3L256 278.6l-52.7 52.7c-6.2 6.2-16.4 6.2-22.6 0-3.1-3.1-4.7-7.2-4.7-11.3 0-4.1 1.6-8.2 4.7-11.3l52.7-52.7-52.7-52.7c-3.1-3.1-4.7-7.2-4.7-11.3 0-4.1 1.6-8.2 4.7-11.3 6.2-6.2 16.4-6.2 22.6 0l52.7 52.7 52.7-52.7c6.2-6.2 16.4-6.2 22.6 0 6.2 6.2 6.2 16.4 0 22.6L278.6 256l52.7 52.7c6.2 6.2 6.2 16.4 0 22.6-6.2 6.3-16.4 6.3-22.6 0z"},child:[]}]})(e)}function Vi(e){return Fi({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M352 56h-1c-39.7 0-74.8 21-95 52-20.2-31-55.3-52-95-52h-1c-61.9.6-112 50.9-112 113 0 37 16.2 89.5 47.8 132.7C156 384 256 456 256 456s100-72 160.2-154.3C447.8 258.5 464 206 464 169c0-62.1-50.1-112.4-112-113zm41.6 229.2C351 343.5 286.1 397.3 256 420.8c-30.1-23.5-95-77.4-137.6-135.7C89.1 245.1 76 198 76 169c0-22.6 8.8-43.8 24.6-59.8 15.9-16 37-24.9 59.6-25.1H161.1c14.3 0 28.5 3.7 41.1 10.8 12.2 6.9 22.8 16.7 30.4 28.5 5.2 7.9 14 12.7 23.5 12.7s18.3-4.8 23.5-12.7c7.7-11.8 18.2-21.6 30.4-28.5 12.6-7.1 26.8-10.8 41.1-10.8h.9c22.5.2 43.7 9.1 59.6 25.1 15.9 16 24.6 37.3 24.6 59.8-.2 29-13.3 76.1-42.6 116.2z"},child:[]}]})(e)}function Gi(e){return Fi({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M432 176H80c-8.8 0-16-7.2-16-16s7.2-16 16-16h352c8.8 0 16 7.2 16 16s-7.2 16-16 16zM432 272H80c-8.8 0-16-7.2-16-16s7.2-16 16-16h352c8.8 0 16 7.2 16 16s-7.2 16-16 16zM432 368H80c-8.8 0-16-7.2-16-16s7.2-16 16-16h352c8.8 0 16 7.2 16 16s-7.2 16-16 16z"},child:[]}]})(e)}function Hi(e){return Fi({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M128 192l128 128 128-128z"},child:[]}]})(e)}function Wi(e){return Fi({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M349.6 64c-36.4 0-70.7 16.7-93.6 43.9C233.1 80.7 198.8 64 162.4 64 97.9 64 48 114.2 48 179.1c0 79.5 70.7 143.3 177.8 241.7L256 448l30.2-27.2C393.3 322.4 464 258.6 464 179.1 464 114.2 414.1 64 349.6 64zm-80.8 329.3l-4.2 3.9-8.6 7.8-8.6-7.8-4.2-3.9c-50.4-46.3-94-86.3-122.7-122-28-34.7-40.4-63.1-40.4-92.2 0-22.9 8.4-43.9 23.7-59.3 15.2-15.4 36-23.8 58.6-23.8 26.1 0 52 12.2 69.1 32.5l24.5 29.1 24.5-29.1c17.1-20.4 43-32.5 69.1-32.5 22.6 0 43.4 8.4 58.7 23.8 15.3 15.4 23.7 36.5 23.7 59.3 0 29-12.5 57.5-40.4 92.2-28.8 35.7-72.3 75.7-122.8 122z"},child:[]}]})(e)}function Qi(e){return null!==e&&"object"===typeof e&&"constructor"in e&&e.constructor===Object}function qi(e,t){void 0===e&&(e={}),void 0===t&&(t={}),Object.keys(t).forEach((i=>{"undefined"===typeof e[i]?e[i]=t[i]:Qi(t[i])&&Qi(e[i])&&Object.keys(t[i]).length>0&&qi(e[i],t[i])}))}const Xi={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector:()=>null,querySelectorAll:()=>[],getElementById:()=>null,createEvent:()=>({initEvent(){}}),createElement:()=>({children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName:()=>[]}),createElementNS:()=>({}),importNode:()=>null,location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function Yi(){const e="undefined"!==typeof document?document:{};return qi(e,Xi),e}const Ki={document:Xi,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle:()=>({getPropertyValue:()=>""}),Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia:()=>({}),requestAnimationFrame:e=>"undefined"===typeof setTimeout?(e(),null):setTimeout(e,0),cancelAnimationFrame(e){"undefined"!==typeof setTimeout&&clearTimeout(e)}};function Ji(){const e="undefined"!==typeof window?window:{};return qi(e,Ki),e}function Zi(e,t){return void 0===t&&(t=0),setTimeout(e,t)}function $i(){return Date.now()}function en(e,t){void 0===t&&(t="x");const i=Ji();let n,r,s;const a=function(e){const t=Ji();let i;return t.getComputedStyle&&(i=t.getComputedStyle(e,null)),!i&&e.currentStyle&&(i=e.currentStyle),i||(i=e.style),i}(e);return i.WebKitCSSMatrix?(r=a.transform||a.webkitTransform,r.split(",").length>6&&(r=r.split(", ").map((e=>e.replace(",","."))).join(", ")),s=new i.WebKitCSSMatrix("none"===r?"":r)):(s=a.MozTransform||a.OTransform||a.MsTransform||a.msTransform||a.transform||a.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),n=s.toString().split(",")),"x"===t&&(r=i.WebKitCSSMatrix?s.m41:16===n.length?parseFloat(n[12]):parseFloat(n[4])),"y"===t&&(r=i.WebKitCSSMatrix?s.m42:16===n.length?parseFloat(n[13]):parseFloat(n[5])),r||0}function tn(e){return"object"===typeof e&&null!==e&&e.constructor&&"Object"===Object.prototype.toString.call(e).slice(8,-1)}function nn(){const e=Object(arguments.length<=0?void 0:arguments[0]),t=["__proto__","constructor","prototype"];for(let n=1;n<arguments.length;n+=1){const r=n<0||arguments.length<=n?void 0:arguments[n];if(void 0!==r&&null!==r&&(i=r,!("undefined"!==typeof window&&"undefined"!==typeof window.HTMLElement?i instanceof HTMLElement:i&&(1===i.nodeType||11===i.nodeType)))){const i=Object.keys(Object(r)).filter((e=>t.indexOf(e)<0));for(let t=0,n=i.length;t<n;t+=1){const n=i[t],s=Object.getOwnPropertyDescriptor(r,n);void 0!==s&&s.enumerable&&(tn(e[n])&&tn(r[n])?r[n].__swiper__?e[n]=r[n]:nn(e[n],r[n]):!tn(e[n])&&tn(r[n])?(e[n]={},r[n].__swiper__?e[n]=r[n]:nn(e[n],r[n])):e[n]=r[n])}}}var i;return e}function rn(e,t,i){e.style.setProperty(t,i)}function sn(e){let{swiper:t,targetPosition:i,side:n}=e;const r=Ji(),s=-t.translate;let a,o=null;const l=t.params.speed;t.wrapperEl.style.scrollSnapType="none",r.cancelAnimationFrame(t.cssModeFrameID);const c=i>s?"next":"prev",h=(e,t)=>"next"===c&&e>=t||"prev"===c&&e<=t,d=()=>{a=(new Date).getTime(),null===o&&(o=a);const e=Math.max(Math.min((a-o)/l,1),0),c=.5-Math.cos(e*Math.PI)/2;let u=s+c*(i-s);if(h(u,i)&&(u=i),t.wrapperEl.scrollTo({[n]:u}),h(u,i))return t.wrapperEl.style.overflow="hidden",t.wrapperEl.style.scrollSnapType="",setTimeout((()=>{t.wrapperEl.style.overflow="",t.wrapperEl.scrollTo({[n]:u})})),void r.cancelAnimationFrame(t.cssModeFrameID);t.cssModeFrameID=r.requestAnimationFrame(d)};d()}function an(e){return e.querySelector(".swiper-slide-transform")||e.shadowRoot&&e.shadowRoot.querySelector(".swiper-slide-transform")||e}function on(e,t){void 0===t&&(t="");const i=[...e.children];return e instanceof HTMLSlotElement&&i.push(...e.assignedElements()),t?i.filter((e=>e.matches(t))):i}function ln(e){try{return void console.warn(e)}catch(KR){}}function cn(e,t){void 0===t&&(t=[]);const i=document.createElement(e);return i.classList.add(...Array.isArray(t)?t:function(e){return void 0===e&&(e=""),e.trim().split(" ").filter((e=>!!e.trim()))}(t)),i}function hn(e,t){return Ji().getComputedStyle(e,null).getPropertyValue(t)}function dn(e){let t,i=e;if(i){for(t=0;null!==(i=i.previousSibling);)1===i.nodeType&&(t+=1);return t}}function un(e,t){const i=[];let n=e.parentElement;for(;n;)t?n.matches(t)&&i.push(n):i.push(n),n=n.parentElement;return i}function pn(e,t,i){const n=Ji();return i?e["width"===t?"offsetWidth":"offsetHeight"]+parseFloat(n.getComputedStyle(e,null).getPropertyValue("width"===t?"margin-right":"margin-top"))+parseFloat(n.getComputedStyle(e,null).getPropertyValue("width"===t?"margin-left":"margin-bottom")):e.offsetWidth}function fn(e){return(Array.isArray(e)?e:[e]).filter((e=>!!e))}let mn,gn,vn;function yn(){return mn||(mn=function(){const e=Ji(),t=Yi();return{smoothScroll:t.documentElement&&t.documentElement.style&&"scrollBehavior"in t.documentElement.style,touch:!!("ontouchstart"in e||e.DocumentTouch&&t instanceof e.DocumentTouch)}}()),mn}function bn(e){return void 0===e&&(e={}),gn||(gn=function(e){let{userAgent:t}=void 0===e?{}:e;const i=yn(),n=Ji(),r=n.navigator.platform,s=t||n.navigator.userAgent,a={ios:!1,android:!1},o=n.screen.width,l=n.screen.height,c=s.match(/(Android);?[\s\/]+([\d.]+)?/);let h=s.match(/(iPad).*OS\s([\d_]+)/);const d=s.match(/(iPod)(.*OS\s([\d_]+))?/),u=!h&&s.match(/(iPhone\sOS|iOS)\s([\d_]+)/),p="Win32"===r;let f="MacIntel"===r;return!h&&f&&i.touch&&["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"].indexOf(`${o}x${l}`)>=0&&(h=s.match(/(Version)\/([\d.]+)/),h||(h=[0,1,"13_0_0"]),f=!1),c&&!p&&(a.os="android",a.android=!0),(h||u||d)&&(a.os="ios",a.ios=!0),a}(e)),gn}function An(){return vn||(vn=function(){const e=Ji(),t=bn();let i=!1;function n(){const t=e.navigator.userAgent.toLowerCase();return t.indexOf("safari")>=0&&t.indexOf("chrome")<0&&t.indexOf("android")<0}if(n()){const t=String(e.navigator.userAgent);if(t.includes("Version/")){const[e,n]=t.split("Version/")[1].split(" ")[0].split(".").map((e=>Number(e)));i=e<16||16===e&&n<2}}const r=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(e.navigator.userAgent),s=n();return{isSafari:i||s,needPerspectiveFix:i,need3dFix:s||r&&t.ios,isWebView:r}}()),vn}var xn={on(e,t,i){const n=this;if(!n.eventsListeners||n.destroyed)return n;if("function"!==typeof t)return n;const r=i?"unshift":"push";return e.split(" ").forEach((e=>{n.eventsListeners[e]||(n.eventsListeners[e]=[]),n.eventsListeners[e][r](t)})),n},once(e,t,i){const n=this;if(!n.eventsListeners||n.destroyed)return n;if("function"!==typeof t)return n;function r(){n.off(e,r),r.__emitterProxy&&delete r.__emitterProxy;for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];t.apply(n,s)}return r.__emitterProxy=t,n.on(e,r,i)},onAny(e,t){const i=this;if(!i.eventsListeners||i.destroyed)return i;if("function"!==typeof e)return i;const n=t?"unshift":"push";return i.eventsAnyListeners.indexOf(e)<0&&i.eventsAnyListeners[n](e),i},offAny(e){const t=this;if(!t.eventsListeners||t.destroyed)return t;if(!t.eventsAnyListeners)return t;const i=t.eventsAnyListeners.indexOf(e);return i>=0&&t.eventsAnyListeners.splice(i,1),t},off(e,t){const i=this;return!i.eventsListeners||i.destroyed?i:i.eventsListeners?(e.split(" ").forEach((e=>{"undefined"===typeof t?i.eventsListeners[e]=[]:i.eventsListeners[e]&&i.eventsListeners[e].forEach(((n,r)=>{(n===t||n.__emitterProxy&&n.__emitterProxy===t)&&i.eventsListeners[e].splice(r,1)}))})),i):i},emit(){const e=this;if(!e.eventsListeners||e.destroyed)return e;if(!e.eventsListeners)return e;let t,i,n;for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];"string"===typeof s[0]||Array.isArray(s[0])?(t=s[0],i=s.slice(1,s.length),n=e):(t=s[0].events,i=s[0].data,n=s[0].context||e),i.unshift(n);return(Array.isArray(t)?t:t.split(" ")).forEach((t=>{e.eventsAnyListeners&&e.eventsAnyListeners.length&&e.eventsAnyListeners.forEach((e=>{e.apply(n,[t,...i])})),e.eventsListeners&&e.eventsListeners[t]&&e.eventsListeners[t].forEach((e=>{e.apply(n,i)}))})),e}};const wn=(e,t,i)=>{t&&!e.classList.contains(i)?e.classList.add(i):!t&&e.classList.contains(i)&&e.classList.remove(i)};const Sn=(e,t,i)=>{t&&!e.classList.contains(i)?e.classList.add(i):!t&&e.classList.contains(i)&&e.classList.remove(i)};const _n=(e,t)=>{if(!e||e.destroyed||!e.params)return;const i=t.closest(e.isElement?"swiper-slide":`.${e.params.slideClass}`);if(i){let t=i.querySelector(`.${e.params.lazyPreloaderClass}`);!t&&e.isElement&&(i.shadowRoot?t=i.shadowRoot.querySelector(`.${e.params.lazyPreloaderClass}`):requestAnimationFrame((()=>{i.shadowRoot&&(t=i.shadowRoot.querySelector(`.${e.params.lazyPreloaderClass}`),t&&t.remove())}))),t&&t.remove()}},En=(e,t)=>{if(!e.slides[t])return;const i=e.slides[t].querySelector('[loading="lazy"]');i&&i.removeAttribute("loading")},Cn=e=>{if(!e||e.destroyed||!e.params)return;let t=e.params.lazyPreloadPrevNext;const i=e.slides.length;if(!i||!t||t<0)return;t=Math.min(t,i);const n="auto"===e.params.slidesPerView?e.slidesPerViewDynamic():Math.ceil(e.params.slidesPerView),r=e.activeIndex;if(e.params.grid&&e.params.grid.rows>1){const i=r,s=[i-t];return s.push(...Array.from({length:t}).map(((e,t)=>i+n+t))),void e.slides.forEach(((t,i)=>{s.includes(t.column)&&En(e,i)}))}const s=r+n-1;if(e.params.rewind||e.params.loop)for(let a=r-t;a<=s+t;a+=1){const t=(a%i+i)%i;(t<r||t>s)&&En(e,t)}else for(let a=Math.max(r-t,0);a<=Math.min(s+t,i-1);a+=1)a!==r&&(a>s||a<r)&&En(e,a)};var Mn={updateSize:function(){const e=this;let t,i;const n=e.el;t="undefined"!==typeof e.params.width&&null!==e.params.width?e.params.width:n.clientWidth,i="undefined"!==typeof e.params.height&&null!==e.params.height?e.params.height:n.clientHeight,0===t&&e.isHorizontal()||0===i&&e.isVertical()||(t=t-parseInt(hn(n,"padding-left")||0,10)-parseInt(hn(n,"padding-right")||0,10),i=i-parseInt(hn(n,"padding-top")||0,10)-parseInt(hn(n,"padding-bottom")||0,10),Number.isNaN(t)&&(t=0),Number.isNaN(i)&&(i=0),Object.assign(e,{width:t,height:i,size:e.isHorizontal()?t:i}))},updateSlides:function(){const e=this;function t(t,i){return parseFloat(t.getPropertyValue(e.getDirectionLabel(i))||0)}const i=e.params,{wrapperEl:n,slidesEl:r,size:s,rtlTranslate:a,wrongRTL:o}=e,l=e.virtual&&i.virtual.enabled,c=l?e.virtual.slides.length:e.slides.length,h=on(r,`.${e.params.slideClass}, swiper-slide`),d=l?e.virtual.slides.length:h.length;let u=[];const p=[],f=[];let m=i.slidesOffsetBefore;"function"===typeof m&&(m=i.slidesOffsetBefore.call(e));let g=i.slidesOffsetAfter;"function"===typeof g&&(g=i.slidesOffsetAfter.call(e));const v=e.snapGrid.length,y=e.slidesGrid.length;let b=i.spaceBetween,A=-m,x=0,w=0;if("undefined"===typeof s)return;"string"===typeof b&&b.indexOf("%")>=0?b=parseFloat(b.replace("%",""))/100*s:"string"===typeof b&&(b=parseFloat(b)),e.virtualSize=-b,h.forEach((e=>{a?e.style.marginLeft="":e.style.marginRight="",e.style.marginBottom="",e.style.marginTop=""})),i.centeredSlides&&i.cssMode&&(rn(n,"--swiper-centered-offset-before",""),rn(n,"--swiper-centered-offset-after",""));const S=i.grid&&i.grid.rows>1&&e.grid;let _;S?e.grid.initSlides(h):e.grid&&e.grid.unsetSlides();const E="auto"===i.slidesPerView&&i.breakpoints&&Object.keys(i.breakpoints).filter((e=>"undefined"!==typeof i.breakpoints[e].slidesPerView)).length>0;for(let C=0;C<d;C+=1){let n;if(_=0,h[C]&&(n=h[C]),S&&e.grid.updateSlide(C,n,h),!h[C]||"none"!==hn(n,"display")){if("auto"===i.slidesPerView){E&&(h[C].style[e.getDirectionLabel("width")]="");const r=getComputedStyle(n),s=n.style.transform,a=n.style.webkitTransform;if(s&&(n.style.transform="none"),a&&(n.style.webkitTransform="none"),i.roundLengths)_=e.isHorizontal()?pn(n,"width",!0):pn(n,"height",!0);else{const e=t(r,"width"),i=t(r,"padding-left"),s=t(r,"padding-right"),a=t(r,"margin-left"),o=t(r,"margin-right"),l=r.getPropertyValue("box-sizing");if(l&&"border-box"===l)_=e+a+o;else{const{clientWidth:t,offsetWidth:r}=n;_=e+i+s+a+o+(r-t)}}s&&(n.style.transform=s),a&&(n.style.webkitTransform=a),i.roundLengths&&(_=Math.floor(_))}else _=(s-(i.slidesPerView-1)*b)/i.slidesPerView,i.roundLengths&&(_=Math.floor(_)),h[C]&&(h[C].style[e.getDirectionLabel("width")]=`${_}px`);h[C]&&(h[C].swiperSlideSize=_),f.push(_),i.centeredSlides?(A=A+_/2+x/2+b,0===x&&0!==C&&(A=A-s/2-b),0===C&&(A=A-s/2-b),Math.abs(A)<.001&&(A=0),i.roundLengths&&(A=Math.floor(A)),w%i.slidesPerGroup===0&&u.push(A),p.push(A)):(i.roundLengths&&(A=Math.floor(A)),(w-Math.min(e.params.slidesPerGroupSkip,w))%e.params.slidesPerGroup===0&&u.push(A),p.push(A),A=A+_+b),e.virtualSize+=_+b,x=_,w+=1}}if(e.virtualSize=Math.max(e.virtualSize,s)+g,a&&o&&("slide"===i.effect||"coverflow"===i.effect)&&(n.style.width=`${e.virtualSize+b}px`),i.setWrapperSize&&(n.style[e.getDirectionLabel("width")]=`${e.virtualSize+b}px`),S&&e.grid.updateWrapperSize(_,u),!i.centeredSlides){const t=[];for(let n=0;n<u.length;n+=1){let r=u[n];i.roundLengths&&(r=Math.floor(r)),u[n]<=e.virtualSize-s&&t.push(r)}u=t,Math.floor(e.virtualSize-s)-Math.floor(u[u.length-1])>1&&u.push(e.virtualSize-s)}if(l&&i.loop){const t=f[0]+b;if(i.slidesPerGroup>1){const n=Math.ceil((e.virtual.slidesBefore+e.virtual.slidesAfter)/i.slidesPerGroup),r=t*i.slidesPerGroup;for(let e=0;e<n;e+=1)u.push(u[u.length-1]+r)}for(let n=0;n<e.virtual.slidesBefore+e.virtual.slidesAfter;n+=1)1===i.slidesPerGroup&&u.push(u[u.length-1]+t),p.push(p[p.length-1]+t),e.virtualSize+=t}if(0===u.length&&(u=[0]),0!==b){const t=e.isHorizontal()&&a?"marginLeft":e.getDirectionLabel("marginRight");h.filter(((e,t)=>!(i.cssMode&&!i.loop)||t!==h.length-1)).forEach((e=>{e.style[t]=`${b}px`}))}if(i.centeredSlides&&i.centeredSlidesBounds){let e=0;f.forEach((t=>{e+=t+(b||0)})),e-=b;const t=e>s?e-s:0;u=u.map((e=>e<=0?-m:e>t?t+g:e))}if(i.centerInsufficientSlides){let e=0;f.forEach((t=>{e+=t+(b||0)})),e-=b;const t=(i.slidesOffsetBefore||0)+(i.slidesOffsetAfter||0);if(e+t<s){const i=(s-e-t)/2;u.forEach(((e,t)=>{u[t]=e-i})),p.forEach(((e,t)=>{p[t]=e+i}))}}if(Object.assign(e,{slides:h,snapGrid:u,slidesGrid:p,slidesSizesGrid:f}),i.centeredSlides&&i.cssMode&&!i.centeredSlidesBounds){rn(n,"--swiper-centered-offset-before",-u[0]+"px"),rn(n,"--swiper-centered-offset-after",e.size/2-f[f.length-1]/2+"px");const t=-e.snapGrid[0],i=-e.slidesGrid[0];e.snapGrid=e.snapGrid.map((e=>e+t)),e.slidesGrid=e.slidesGrid.map((e=>e+i))}if(d!==c&&e.emit("slidesLengthChange"),u.length!==v&&(e.params.watchOverflow&&e.checkOverflow(),e.emit("snapGridLengthChange")),p.length!==y&&e.emit("slidesGridLengthChange"),i.watchSlidesProgress&&e.updateSlidesOffset(),e.emit("slidesUpdated"),!l&&!i.cssMode&&("slide"===i.effect||"fade"===i.effect)){const t=`${i.containerModifierClass}backface-hidden`,n=e.el.classList.contains(t);d<=i.maxBackfaceHiddenSlides?n||e.el.classList.add(t):n&&e.el.classList.remove(t)}},updateAutoHeight:function(e){const t=this,i=[],n=t.virtual&&t.params.virtual.enabled;let r,s=0;"number"===typeof e?t.setTransition(e):!0===e&&t.setTransition(t.params.speed);const a=e=>n?t.slides[t.getSlideIndexByData(e)]:t.slides[e];if("auto"!==t.params.slidesPerView&&t.params.slidesPerView>1)if(t.params.centeredSlides)(t.visibleSlides||[]).forEach((e=>{i.push(e)}));else for(r=0;r<Math.ceil(t.params.slidesPerView);r+=1){const e=t.activeIndex+r;if(e>t.slides.length&&!n)break;i.push(a(e))}else i.push(a(t.activeIndex));for(r=0;r<i.length;r+=1)if("undefined"!==typeof i[r]){const e=i[r].offsetHeight;s=e>s?e:s}(s||0===s)&&(t.wrapperEl.style.height=`${s}px`)},updateSlidesOffset:function(){const e=this,t=e.slides,i=e.isElement?e.isHorizontal()?e.wrapperEl.offsetLeft:e.wrapperEl.offsetTop:0;for(let n=0;n<t.length;n+=1)t[n].swiperSlideOffset=(e.isHorizontal()?t[n].offsetLeft:t[n].offsetTop)-i-e.cssOverflowAdjustment()},updateSlidesProgress:function(e){void 0===e&&(e=this&&this.translate||0);const t=this,i=t.params,{slides:n,rtlTranslate:r,snapGrid:s}=t;if(0===n.length)return;"undefined"===typeof n[0].swiperSlideOffset&&t.updateSlidesOffset();let a=-e;r&&(a=e),t.visibleSlidesIndexes=[],t.visibleSlides=[];let o=i.spaceBetween;"string"===typeof o&&o.indexOf("%")>=0?o=parseFloat(o.replace("%",""))/100*t.size:"string"===typeof o&&(o=parseFloat(o));for(let l=0;l<n.length;l+=1){const e=n[l];let c=e.swiperSlideOffset;i.cssMode&&i.centeredSlides&&(c-=n[0].swiperSlideOffset);const h=(a+(i.centeredSlides?t.minTranslate():0)-c)/(e.swiperSlideSize+o),d=(a-s[0]+(i.centeredSlides?t.minTranslate():0)-c)/(e.swiperSlideSize+o),u=-(a-c),p=u+t.slidesSizesGrid[l],f=u>=0&&u<=t.size-t.slidesSizesGrid[l],m=u>=0&&u<t.size-1||p>1&&p<=t.size||u<=0&&p>=t.size;m&&(t.visibleSlides.push(e),t.visibleSlidesIndexes.push(l)),wn(e,m,i.slideVisibleClass),wn(e,f,i.slideFullyVisibleClass),e.progress=r?-h:h,e.originalProgress=r?-d:d}},updateProgress:function(e){const t=this;if("undefined"===typeof e){const i=t.rtlTranslate?-1:1;e=t&&t.translate&&t.translate*i||0}const i=t.params,n=t.maxTranslate()-t.minTranslate();let{progress:r,isBeginning:s,isEnd:a,progressLoop:o}=t;const l=s,c=a;if(0===n)r=0,s=!0,a=!0;else{r=(e-t.minTranslate())/n;const i=Math.abs(e-t.minTranslate())<1,o=Math.abs(e-t.maxTranslate())<1;s=i||r<=0,a=o||r>=1,i&&(r=0),o&&(r=1)}if(i.loop){const i=t.getSlideIndexByData(0),n=t.getSlideIndexByData(t.slides.length-1),r=t.slidesGrid[i],s=t.slidesGrid[n],a=t.slidesGrid[t.slidesGrid.length-1],l=Math.abs(e);o=l>=r?(l-r)/a:(l+a-s)/a,o>1&&(o-=1)}Object.assign(t,{progress:r,progressLoop:o,isBeginning:s,isEnd:a}),(i.watchSlidesProgress||i.centeredSlides&&i.autoHeight)&&t.updateSlidesProgress(e),s&&!l&&t.emit("reachBeginning toEdge"),a&&!c&&t.emit("reachEnd toEdge"),(l&&!s||c&&!a)&&t.emit("fromEdge"),t.emit("progress",r)},updateSlidesClasses:function(){const e=this,{slides:t,params:i,slidesEl:n,activeIndex:r}=e,s=e.virtual&&i.virtual.enabled,a=e.grid&&i.grid&&i.grid.rows>1,o=e=>on(n,`.${i.slideClass}${e}, swiper-slide${e}`)[0];let l,c,h;if(s)if(i.loop){let t=r-e.virtual.slidesBefore;t<0&&(t=e.virtual.slides.length+t),t>=e.virtual.slides.length&&(t-=e.virtual.slides.length),l=o(`[data-swiper-slide-index="${t}"]`)}else l=o(`[data-swiper-slide-index="${r}"]`);else a?(l=t.filter((e=>e.column===r))[0],h=t.filter((e=>e.column===r+1))[0],c=t.filter((e=>e.column===r-1))[0]):l=t[r];l&&(a||(h=function(e,t){const i=[];for(;e.nextElementSibling;){const n=e.nextElementSibling;t?n.matches(t)&&i.push(n):i.push(n),e=n}return i}(l,`.${i.slideClass}, swiper-slide`)[0],i.loop&&!h&&(h=t[0]),c=function(e,t){const i=[];for(;e.previousElementSibling;){const n=e.previousElementSibling;t?n.matches(t)&&i.push(n):i.push(n),e=n}return i}(l,`.${i.slideClass}, swiper-slide`)[0],i.loop&&0===!c&&(c=t[t.length-1]))),t.forEach((e=>{Sn(e,e===l,i.slideActiveClass),Sn(e,e===h,i.slideNextClass),Sn(e,e===c,i.slidePrevClass)})),e.emitSlidesClasses()},updateActiveIndex:function(e){const t=this,i=t.rtlTranslate?t.translate:-t.translate,{snapGrid:n,params:r,activeIndex:s,realIndex:a,snapIndex:o}=t;let l,c=e;const h=e=>{let i=e-t.virtual.slidesBefore;return i<0&&(i=t.virtual.slides.length+i),i>=t.virtual.slides.length&&(i-=t.virtual.slides.length),i};if("undefined"===typeof c&&(c=function(e){const{slidesGrid:t,params:i}=e,n=e.rtlTranslate?e.translate:-e.translate;let r;for(let s=0;s<t.length;s+=1)"undefined"!==typeof t[s+1]?n>=t[s]&&n<t[s+1]-(t[s+1]-t[s])/2?r=s:n>=t[s]&&n<t[s+1]&&(r=s+1):n>=t[s]&&(r=s);return i.normalizeSlideIndex&&(r<0||"undefined"===typeof r)&&(r=0),r}(t)),n.indexOf(i)>=0)l=n.indexOf(i);else{const e=Math.min(r.slidesPerGroupSkip,c);l=e+Math.floor((c-e)/r.slidesPerGroup)}if(l>=n.length&&(l=n.length-1),c===s&&!t.params.loop)return void(l!==o&&(t.snapIndex=l,t.emit("snapIndexChange")));if(c===s&&t.params.loop&&t.virtual&&t.params.virtual.enabled)return void(t.realIndex=h(c));const d=t.grid&&r.grid&&r.grid.rows>1;let u;if(t.virtual&&r.virtual.enabled&&r.loop)u=h(c);else if(d){const e=t.slides.filter((e=>e.column===c))[0];let i=parseInt(e.getAttribute("data-swiper-slide-index"),10);Number.isNaN(i)&&(i=Math.max(t.slides.indexOf(e),0)),u=Math.floor(i/r.grid.rows)}else if(t.slides[c]){const e=t.slides[c].getAttribute("data-swiper-slide-index");u=e?parseInt(e,10):c}else u=c;Object.assign(t,{previousSnapIndex:o,snapIndex:l,previousRealIndex:a,realIndex:u,previousIndex:s,activeIndex:c}),t.initialized&&Cn(t),t.emit("activeIndexChange"),t.emit("snapIndexChange"),(t.initialized||t.params.runCallbacksOnInit)&&(a!==u&&t.emit("realIndexChange"),t.emit("slideChange"))},updateClickedSlide:function(e,t){const i=this,n=i.params;let r=e.closest(`.${n.slideClass}, swiper-slide`);!r&&i.isElement&&t&&t.length>1&&t.includes(e)&&[...t.slice(t.indexOf(e)+1,t.length)].forEach((e=>{!r&&e.matches&&e.matches(`.${n.slideClass}, swiper-slide`)&&(r=e)}));let s,a=!1;if(r)for(let o=0;o<i.slides.length;o+=1)if(i.slides[o]===r){a=!0,s=o;break}if(!r||!a)return i.clickedSlide=void 0,void(i.clickedIndex=void 0);i.clickedSlide=r,i.virtual&&i.params.virtual.enabled?i.clickedIndex=parseInt(r.getAttribute("data-swiper-slide-index"),10):i.clickedIndex=s,n.slideToClickedSlide&&void 0!==i.clickedIndex&&i.clickedIndex!==i.activeIndex&&i.slideToClickedSlide()}};var Tn={getTranslate:function(e){void 0===e&&(e=this.isHorizontal()?"x":"y");const{params:t,rtlTranslate:i,translate:n,wrapperEl:r}=this;if(t.virtualTranslate)return i?-n:n;if(t.cssMode)return n;let s=en(r,e);return s+=this.cssOverflowAdjustment(),i&&(s=-s),s||0},setTranslate:function(e,t){const i=this,{rtlTranslate:n,params:r,wrapperEl:s,progress:a}=i;let o,l=0,c=0;i.isHorizontal()?l=n?-e:e:c=e,r.roundLengths&&(l=Math.floor(l),c=Math.floor(c)),i.previousTranslate=i.translate,i.translate=i.isHorizontal()?l:c,r.cssMode?s[i.isHorizontal()?"scrollLeft":"scrollTop"]=i.isHorizontal()?-l:-c:r.virtualTranslate||(i.isHorizontal()?l-=i.cssOverflowAdjustment():c-=i.cssOverflowAdjustment(),s.style.transform=`translate3d(${l}px, ${c}px, 0px)`);const h=i.maxTranslate()-i.minTranslate();o=0===h?0:(e-i.minTranslate())/h,o!==a&&i.updateProgress(e),i.emit("setTranslate",i.translate,t)},minTranslate:function(){return-this.snapGrid[0]},maxTranslate:function(){return-this.snapGrid[this.snapGrid.length-1]},translateTo:function(e,t,i,n,r){void 0===e&&(e=0),void 0===t&&(t=this.params.speed),void 0===i&&(i=!0),void 0===n&&(n=!0);const s=this,{params:a,wrapperEl:o}=s;if(s.animating&&a.preventInteractionOnTransition)return!1;const l=s.minTranslate(),c=s.maxTranslate();let h;if(h=n&&e>l?l:n&&e<c?c:e,s.updateProgress(h),a.cssMode){const e=s.isHorizontal();if(0===t)o[e?"scrollLeft":"scrollTop"]=-h;else{if(!s.support.smoothScroll)return sn({swiper:s,targetPosition:-h,side:e?"left":"top"}),!0;o.scrollTo({[e?"left":"top"]:-h,behavior:"smooth"})}return!0}return 0===t?(s.setTransition(0),s.setTranslate(h),i&&(s.emit("beforeTransitionStart",t,r),s.emit("transitionEnd"))):(s.setTransition(t),s.setTranslate(h),i&&(s.emit("beforeTransitionStart",t,r),s.emit("transitionStart")),s.animating||(s.animating=!0,s.onTranslateToWrapperTransitionEnd||(s.onTranslateToWrapperTransitionEnd=function(e){s&&!s.destroyed&&e.target===this&&(s.wrapperEl.removeEventListener("transitionend",s.onTranslateToWrapperTransitionEnd),s.onTranslateToWrapperTransitionEnd=null,delete s.onTranslateToWrapperTransitionEnd,s.animating=!1,i&&s.emit("transitionEnd"))}),s.wrapperEl.addEventListener("transitionend",s.onTranslateToWrapperTransitionEnd))),!0}};function In(e){let{swiper:t,runCallbacks:i,direction:n,step:r}=e;const{activeIndex:s,previousIndex:a}=t;let o=n;if(o||(o=s>a?"next":s<a?"prev":"reset"),t.emit(`transition${r}`),i&&s!==a){if("reset"===o)return void t.emit(`slideResetTransition${r}`);t.emit(`slideChangeTransition${r}`),"next"===o?t.emit(`slideNextTransition${r}`):t.emit(`slidePrevTransition${r}`)}}var Pn={setTransition:function(e,t){const i=this;i.params.cssMode||(i.wrapperEl.style.transitionDuration=`${e}ms`,i.wrapperEl.style.transitionDelay=0===e?"0ms":""),i.emit("setTransition",e,t)},transitionStart:function(e,t){void 0===e&&(e=!0);const i=this,{params:n}=i;n.cssMode||(n.autoHeight&&i.updateAutoHeight(),In({swiper:i,runCallbacks:e,direction:t,step:"Start"}))},transitionEnd:function(e,t){void 0===e&&(e=!0);const i=this,{params:n}=i;i.animating=!1,n.cssMode||(i.setTransition(0),In({swiper:i,runCallbacks:e,direction:t,step:"End"}))}};var Dn={slideTo:function(e,t,i,n,r){void 0===e&&(e=0),void 0===i&&(i=!0),"string"===typeof e&&(e=parseInt(e,10));const s=this;let a=e;a<0&&(a=0);const{params:o,snapGrid:l,slidesGrid:c,previousIndex:h,activeIndex:d,rtlTranslate:u,wrapperEl:p,enabled:f}=s;if(!f&&!n&&!r||s.destroyed||s.animating&&o.preventInteractionOnTransition)return!1;"undefined"===typeof t&&(t=s.params.speed);const m=Math.min(s.params.slidesPerGroupSkip,a);let g=m+Math.floor((a-m)/s.params.slidesPerGroup);g>=l.length&&(g=l.length-1);const v=-l[g];if(o.normalizeSlideIndex)for(let A=0;A<c.length;A+=1){const e=-Math.floor(100*v),t=Math.floor(100*c[A]),i=Math.floor(100*c[A+1]);"undefined"!==typeof c[A+1]?e>=t&&e<i-(i-t)/2?a=A:e>=t&&e<i&&(a=A+1):e>=t&&(a=A)}if(s.initialized&&a!==d){if(!s.allowSlideNext&&(u?v>s.translate&&v>s.minTranslate():v<s.translate&&v<s.minTranslate()))return!1;if(!s.allowSlidePrev&&v>s.translate&&v>s.maxTranslate()&&(d||0)!==a)return!1}let y;a!==(h||0)&&i&&s.emit("beforeSlideChangeStart"),s.updateProgress(v),y=a>d?"next":a<d?"prev":"reset";const b=s.virtual&&s.params.virtual.enabled;if(!(b&&r)&&(u&&-v===s.translate||!u&&v===s.translate))return s.updateActiveIndex(a),o.autoHeight&&s.updateAutoHeight(),s.updateSlidesClasses(),"slide"!==o.effect&&s.setTranslate(v),"reset"!==y&&(s.transitionStart(i,y),s.transitionEnd(i,y)),!1;if(o.cssMode){const e=s.isHorizontal(),i=u?v:-v;if(0===t)b&&(s.wrapperEl.style.scrollSnapType="none",s._immediateVirtual=!0),b&&!s._cssModeVirtualInitialSet&&s.params.initialSlide>0?(s._cssModeVirtualInitialSet=!0,requestAnimationFrame((()=>{p[e?"scrollLeft":"scrollTop"]=i}))):p[e?"scrollLeft":"scrollTop"]=i,b&&requestAnimationFrame((()=>{s.wrapperEl.style.scrollSnapType="",s._immediateVirtual=!1}));else{if(!s.support.smoothScroll)return sn({swiper:s,targetPosition:i,side:e?"left":"top"}),!0;p.scrollTo({[e?"left":"top"]:i,behavior:"smooth"})}return!0}return s.setTransition(t),s.setTranslate(v),s.updateActiveIndex(a),s.updateSlidesClasses(),s.emit("beforeTransitionStart",t,n),s.transitionStart(i,y),0===t?s.transitionEnd(i,y):s.animating||(s.animating=!0,s.onSlideToWrapperTransitionEnd||(s.onSlideToWrapperTransitionEnd=function(e){s&&!s.destroyed&&e.target===this&&(s.wrapperEl.removeEventListener("transitionend",s.onSlideToWrapperTransitionEnd),s.onSlideToWrapperTransitionEnd=null,delete s.onSlideToWrapperTransitionEnd,s.transitionEnd(i,y))}),s.wrapperEl.addEventListener("transitionend",s.onSlideToWrapperTransitionEnd)),!0},slideToLoop:function(e,t,i,n){if(void 0===e&&(e=0),void 0===i&&(i=!0),"string"===typeof e){e=parseInt(e,10)}const r=this;if(r.destroyed)return;"undefined"===typeof t&&(t=r.params.speed);const s=r.grid&&r.params.grid&&r.params.grid.rows>1;let a=e;if(r.params.loop)if(r.virtual&&r.params.virtual.enabled)a+=r.virtual.slidesBefore;else{let e;if(s){const t=a*r.params.grid.rows;e=r.slides.filter((e=>1*e.getAttribute("data-swiper-slide-index")===t))[0].column}else e=r.getSlideIndexByData(a);const t=s?Math.ceil(r.slides.length/r.params.grid.rows):r.slides.length,{centeredSlides:i}=r.params;let o=r.params.slidesPerView;"auto"===o?o=r.slidesPerViewDynamic():(o=Math.ceil(parseFloat(r.params.slidesPerView,10)),i&&o%2===0&&(o+=1));let l=t-e<o;if(i&&(l=l||e<Math.ceil(o/2)),n&&i&&"auto"!==r.params.slidesPerView&&!s&&(l=!1),l){const n=i?e<r.activeIndex?"prev":"next":e-r.activeIndex-1<r.params.slidesPerView?"next":"prev";r.loopFix({direction:n,slideTo:!0,activeSlideIndex:"next"===n?e+1:e-t+1,slideRealIndex:"next"===n?r.realIndex:void 0})}if(s){const e=a*r.params.grid.rows;a=r.slides.filter((t=>1*t.getAttribute("data-swiper-slide-index")===e))[0].column}else a=r.getSlideIndexByData(a)}return requestAnimationFrame((()=>{r.slideTo(a,t,i,n)})),r},slideNext:function(e,t,i){void 0===t&&(t=!0);const n=this,{enabled:r,params:s,animating:a}=n;if(!r||n.destroyed)return n;"undefined"===typeof e&&(e=n.params.speed);let o=s.slidesPerGroup;"auto"===s.slidesPerView&&1===s.slidesPerGroup&&s.slidesPerGroupAuto&&(o=Math.max(n.slidesPerViewDynamic("current",!0),1));const l=n.activeIndex<s.slidesPerGroupSkip?1:o,c=n.virtual&&s.virtual.enabled;if(s.loop){if(a&&!c&&s.loopPreventsSliding)return!1;if(n.loopFix({direction:"next"}),n._clientLeft=n.wrapperEl.clientLeft,n.activeIndex===n.slides.length-1&&s.cssMode)return requestAnimationFrame((()=>{n.slideTo(n.activeIndex+l,e,t,i)})),!0}return s.rewind&&n.isEnd?n.slideTo(0,e,t,i):n.slideTo(n.activeIndex+l,e,t,i)},slidePrev:function(e,t,i){void 0===t&&(t=!0);const n=this,{params:r,snapGrid:s,slidesGrid:a,rtlTranslate:o,enabled:l,animating:c}=n;if(!l||n.destroyed)return n;"undefined"===typeof e&&(e=n.params.speed);const h=n.virtual&&r.virtual.enabled;if(r.loop){if(c&&!h&&r.loopPreventsSliding)return!1;n.loopFix({direction:"prev"}),n._clientLeft=n.wrapperEl.clientLeft}function d(e){return e<0?-Math.floor(Math.abs(e)):Math.floor(e)}const u=d(o?n.translate:-n.translate),p=s.map((e=>d(e)));let f=s[p.indexOf(u)-1];if("undefined"===typeof f&&r.cssMode){let e;s.forEach(((t,i)=>{u>=t&&(e=i)})),"undefined"!==typeof e&&(f=s[e>0?e-1:e])}let m=0;if("undefined"!==typeof f&&(m=a.indexOf(f),m<0&&(m=n.activeIndex-1),"auto"===r.slidesPerView&&1===r.slidesPerGroup&&r.slidesPerGroupAuto&&(m=m-n.slidesPerViewDynamic("previous",!0)+1,m=Math.max(m,0))),r.rewind&&n.isBeginning){const r=n.params.virtual&&n.params.virtual.enabled&&n.virtual?n.virtual.slides.length-1:n.slides.length-1;return n.slideTo(r,e,t,i)}return r.loop&&0===n.activeIndex&&r.cssMode?(requestAnimationFrame((()=>{n.slideTo(m,e,t,i)})),!0):n.slideTo(m,e,t,i)},slideReset:function(e,t,i){void 0===t&&(t=!0);const n=this;if(!n.destroyed)return"undefined"===typeof e&&(e=n.params.speed),n.slideTo(n.activeIndex,e,t,i)},slideToClosest:function(e,t,i,n){void 0===t&&(t=!0),void 0===n&&(n=.5);const r=this;if(r.destroyed)return;"undefined"===typeof e&&(e=r.params.speed);let s=r.activeIndex;const a=Math.min(r.params.slidesPerGroupSkip,s),o=a+Math.floor((s-a)/r.params.slidesPerGroup),l=r.rtlTranslate?r.translate:-r.translate;if(l>=r.snapGrid[o]){const e=r.snapGrid[o];l-e>(r.snapGrid[o+1]-e)*n&&(s+=r.params.slidesPerGroup)}else{const e=r.snapGrid[o-1];l-e<=(r.snapGrid[o]-e)*n&&(s-=r.params.slidesPerGroup)}return s=Math.max(s,0),s=Math.min(s,r.slidesGrid.length-1),r.slideTo(s,e,t,i)},slideToClickedSlide:function(){const e=this;if(e.destroyed)return;const{params:t,slidesEl:i}=e,n="auto"===t.slidesPerView?e.slidesPerViewDynamic():t.slidesPerView;let r,s=e.clickedIndex;const a=e.isElement?"swiper-slide":`.${t.slideClass}`;if(t.loop){if(e.animating)return;r=parseInt(e.clickedSlide.getAttribute("data-swiper-slide-index"),10),t.centeredSlides?s<e.loopedSlides-n/2||s>e.slides.length-e.loopedSlides+n/2?(e.loopFix(),s=e.getSlideIndex(on(i,`${a}[data-swiper-slide-index="${r}"]`)[0]),Zi((()=>{e.slideTo(s)}))):e.slideTo(s):s>e.slides.length-n?(e.loopFix(),s=e.getSlideIndex(on(i,`${a}[data-swiper-slide-index="${r}"]`)[0]),Zi((()=>{e.slideTo(s)}))):e.slideTo(s)}else e.slideTo(s)}};var Rn={loopCreate:function(e){const t=this,{params:i,slidesEl:n}=t;if(!i.loop||t.virtual&&t.params.virtual.enabled)return;const r=()=>{on(n,`.${i.slideClass}, swiper-slide`).forEach(((e,t)=>{e.setAttribute("data-swiper-slide-index",t)}))},s=t.grid&&i.grid&&i.grid.rows>1,a=i.slidesPerGroup*(s?i.grid.rows:1),o=t.slides.length%a!==0,l=s&&t.slides.length%i.grid.rows!==0,c=e=>{for(let n=0;n<e;n+=1){const e=t.isElement?cn("swiper-slide",[i.slideBlankClass]):cn("div",[i.slideClass,i.slideBlankClass]);t.slidesEl.append(e)}};if(o){if(i.loopAddBlankSlides){c(a-t.slides.length%a),t.recalcSlides(),t.updateSlides()}else ln("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");r()}else if(l){if(i.loopAddBlankSlides){c(i.grid.rows-t.slides.length%i.grid.rows),t.recalcSlides(),t.updateSlides()}else ln("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");r()}else r();t.loopFix({slideRealIndex:e,direction:i.centeredSlides?void 0:"next"})},loopFix:function(e){let{slideRealIndex:t,slideTo:i=!0,direction:n,setTranslate:r,activeSlideIndex:s,byController:a,byMousewheel:o}=void 0===e?{}:e;const l=this;if(!l.params.loop)return;l.emit("beforeLoopFix");const{slides:c,allowSlidePrev:h,allowSlideNext:d,slidesEl:u,params:p}=l,{centeredSlides:f}=p;if(l.allowSlidePrev=!0,l.allowSlideNext=!0,l.virtual&&p.virtual.enabled)return i&&(p.centeredSlides||0!==l.snapIndex?p.centeredSlides&&l.snapIndex<p.slidesPerView?l.slideTo(l.virtual.slides.length+l.snapIndex,0,!1,!0):l.snapIndex===l.snapGrid.length-1&&l.slideTo(l.virtual.slidesBefore,0,!1,!0):l.slideTo(l.virtual.slides.length,0,!1,!0)),l.allowSlidePrev=h,l.allowSlideNext=d,void l.emit("loopFix");let m=p.slidesPerView;"auto"===m?m=l.slidesPerViewDynamic():(m=Math.ceil(parseFloat(p.slidesPerView,10)),f&&m%2===0&&(m+=1));const g=p.slidesPerGroupAuto?m:p.slidesPerGroup;let v=g;v%g!==0&&(v+=g-v%g),v+=p.loopAdditionalSlides,l.loopedSlides=v;const y=l.grid&&p.grid&&p.grid.rows>1;c.length<m+v?ln("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled and not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):y&&"row"===p.grid.fill&&ln("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const b=[],A=[];let x=l.activeIndex;"undefined"===typeof s?s=l.getSlideIndex(c.filter((e=>e.classList.contains(p.slideActiveClass)))[0]):x=s;const w="next"===n||!n,S="prev"===n||!n;let _=0,E=0;const C=y?Math.ceil(c.length/p.grid.rows):c.length,M=(y?c[s].column:s)+(f&&"undefined"===typeof r?-m/2+.5:0);if(M<v){_=Math.max(v-M,g);for(let e=0;e<v-M;e+=1){const t=e-Math.floor(e/C)*C;if(y){const e=C-t-1;for(let t=c.length-1;t>=0;t-=1)c[t].column===e&&b.push(t)}else b.push(C-t-1)}}else if(M+m>C-v){E=Math.max(M-(C-2*v),g);for(let e=0;e<E;e+=1){const t=e-Math.floor(e/C)*C;y?c.forEach(((e,i)=>{e.column===t&&A.push(i)})):A.push(t)}}if(l.__preventObserver__=!0,requestAnimationFrame((()=>{l.__preventObserver__=!1})),S&&b.forEach((e=>{c[e].swiperLoopMoveDOM=!0,u.prepend(c[e]),c[e].swiperLoopMoveDOM=!1})),w&&A.forEach((e=>{c[e].swiperLoopMoveDOM=!0,u.append(c[e]),c[e].swiperLoopMoveDOM=!1})),l.recalcSlides(),"auto"===p.slidesPerView?l.updateSlides():y&&(b.length>0&&S||A.length>0&&w)&&l.slides.forEach(((e,t)=>{l.grid.updateSlide(t,e,l.slides)})),p.watchSlidesProgress&&l.updateSlidesOffset(),i)if(b.length>0&&S){if("undefined"===typeof t){const e=l.slidesGrid[x],t=l.slidesGrid[x+_]-e;o?l.setTranslate(l.translate-t):(l.slideTo(x+Math.ceil(_),0,!1,!0),r&&(l.touchEventsData.startTranslate=l.touchEventsData.startTranslate-t,l.touchEventsData.currentTranslate=l.touchEventsData.currentTranslate-t))}else if(r){const e=y?b.length/p.grid.rows:b.length;l.slideTo(l.activeIndex+e,0,!1,!0),l.touchEventsData.currentTranslate=l.translate}}else if(A.length>0&&w)if("undefined"===typeof t){const e=l.slidesGrid[x],t=l.slidesGrid[x-E]-e;o?l.setTranslate(l.translate-t):(l.slideTo(x-E,0,!1,!0),r&&(l.touchEventsData.startTranslate=l.touchEventsData.startTranslate-t,l.touchEventsData.currentTranslate=l.touchEventsData.currentTranslate-t))}else{const e=y?A.length/p.grid.rows:A.length;l.slideTo(l.activeIndex-e,0,!1,!0)}if(l.allowSlidePrev=h,l.allowSlideNext=d,l.controller&&l.controller.control&&!a){const e={slideRealIndex:t,direction:n,setTranslate:r,activeSlideIndex:s,byController:!0};Array.isArray(l.controller.control)?l.controller.control.forEach((t=>{!t.destroyed&&t.params.loop&&t.loopFix({...e,slideTo:t.params.slidesPerView===p.slidesPerView&&i})})):l.controller.control instanceof l.constructor&&l.controller.control.params.loop&&l.controller.control.loopFix({...e,slideTo:l.controller.control.params.slidesPerView===p.slidesPerView&&i})}l.emit("loopFix")},loopDestroy:function(){const e=this,{params:t,slidesEl:i}=e;if(!t.loop||e.virtual&&e.params.virtual.enabled)return;e.recalcSlides();const n=[];e.slides.forEach((e=>{const t="undefined"===typeof e.swiperSlideIndex?1*e.getAttribute("data-swiper-slide-index"):e.swiperSlideIndex;n[t]=e})),e.slides.forEach((e=>{e.removeAttribute("data-swiper-slide-index")})),n.forEach((e=>{i.append(e)})),e.recalcSlides(),e.slideTo(e.realIndex,0)}};var Bn={setGrabCursor:function(e){const t=this;if(!t.params.simulateTouch||t.params.watchOverflow&&t.isLocked||t.params.cssMode)return;const i="container"===t.params.touchEventsTarget?t.el:t.wrapperEl;t.isElement&&(t.__preventObserver__=!0),i.style.cursor="move",i.style.cursor=e?"grabbing":"grab",t.isElement&&requestAnimationFrame((()=>{t.__preventObserver__=!1}))},unsetGrabCursor:function(){const e=this;e.params.watchOverflow&&e.isLocked||e.params.cssMode||(e.isElement&&(e.__preventObserver__=!0),e["container"===e.params.touchEventsTarget?"el":"wrapperEl"].style.cursor="",e.isElement&&requestAnimationFrame((()=>{e.__preventObserver__=!1})))}};function Ln(e,t,i){const n=Ji(),{params:r}=e,s=r.edgeSwipeDetection,a=r.edgeSwipeThreshold;return!s||!(i<=a||i>=n.innerWidth-a)||"prevent"===s&&(t.preventDefault(),!0)}function On(e){const t=this,i=Yi();let n=e;n.originalEvent&&(n=n.originalEvent);const r=t.touchEventsData;if("pointerdown"===n.type){if(null!==r.pointerId&&r.pointerId!==n.pointerId)return;r.pointerId=n.pointerId}else"touchstart"===n.type&&1===n.targetTouches.length&&(r.touchId=n.targetTouches[0].identifier);if("touchstart"===n.type)return void Ln(t,n,n.targetTouches[0].pageX);const{params:s,touches:a,enabled:o}=t;if(!o)return;if(!s.simulateTouch&&"mouse"===n.pointerType)return;if(t.animating&&s.preventInteractionOnTransition)return;!t.animating&&s.cssMode&&s.loop&&t.loopFix();let l=n.target;if("wrapper"===s.touchEventsTarget&&!function(e,t){const i=t.contains(e);if(!i&&t instanceof HTMLSlotElement)return[...t.assignedElements()].includes(e);return i}(l,t.wrapperEl))return;if("which"in n&&3===n.which)return;if("button"in n&&n.button>0)return;if(r.isTouched&&r.isMoved)return;const c=!!s.noSwipingClass&&""!==s.noSwipingClass,h=n.composedPath?n.composedPath():n.path;c&&n.target&&n.target.shadowRoot&&h&&(l=h[0]);const d=s.noSwipingSelector?s.noSwipingSelector:`.${s.noSwipingClass}`,u=!(!n.target||!n.target.shadowRoot);if(s.noSwiping&&(u?function(e,t){return void 0===t&&(t=this),function t(i){if(!i||i===Yi()||i===Ji())return null;i.assignedSlot&&(i=i.assignedSlot);const n=i.closest(e);return n||i.getRootNode?n||t(i.getRootNode().host):null}(t)}(d,l):l.closest(d)))return void(t.allowClick=!0);if(s.swipeHandler&&!l.closest(s.swipeHandler))return;a.currentX=n.pageX,a.currentY=n.pageY;const p=a.currentX,f=a.currentY;if(!Ln(t,n,p))return;Object.assign(r,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),a.startX=p,a.startY=f,r.touchStartTime=$i(),t.allowClick=!0,t.updateSize(),t.swipeDirection=void 0,s.threshold>0&&(r.allowThresholdMove=!1);let m=!0;l.matches(r.focusableElements)&&(m=!1,"SELECT"===l.nodeName&&(r.isTouched=!1)),i.activeElement&&i.activeElement.matches(r.focusableElements)&&i.activeElement!==l&&i.activeElement.blur();const g=m&&t.allowTouchMove&&s.touchStartPreventDefault;!s.touchStartForcePreventDefault&&!g||l.isContentEditable||n.preventDefault(),s.freeMode&&s.freeMode.enabled&&t.freeMode&&t.animating&&!s.cssMode&&t.freeMode.onTouchStart(),t.emit("touchStart",n)}function Nn(e){const t=Yi(),i=this,n=i.touchEventsData,{params:r,touches:s,rtlTranslate:a,enabled:o}=i;if(!o)return;if(!r.simulateTouch&&"mouse"===e.pointerType)return;let l,c=e;if(c.originalEvent&&(c=c.originalEvent),"pointermove"===c.type){if(null!==n.touchId)return;if(c.pointerId!==n.pointerId)return}if("touchmove"===c.type){if(l=[...c.changedTouches].filter((e=>e.identifier===n.touchId))[0],!l||l.identifier!==n.touchId)return}else l=c;if(!n.isTouched)return void(n.startMoving&&n.isScrolling&&i.emit("touchMoveOpposite",c));const h=l.pageX,d=l.pageY;if(c.preventedByNestedSwiper)return s.startX=h,void(s.startY=d);if(!i.allowTouchMove)return c.target.matches(n.focusableElements)||(i.allowClick=!1),void(n.isTouched&&(Object.assign(s,{startX:h,startY:d,currentX:h,currentY:d}),n.touchStartTime=$i()));if(r.touchReleaseOnEdges&&!r.loop)if(i.isVertical()){if(d<s.startY&&i.translate<=i.maxTranslate()||d>s.startY&&i.translate>=i.minTranslate())return n.isTouched=!1,void(n.isMoved=!1)}else if(h<s.startX&&i.translate<=i.maxTranslate()||h>s.startX&&i.translate>=i.minTranslate())return;if(t.activeElement&&c.target===t.activeElement&&c.target.matches(n.focusableElements))return n.isMoved=!0,void(i.allowClick=!1);n.allowTouchCallbacks&&i.emit("touchMove",c),s.previousX=s.currentX,s.previousY=s.currentY,s.currentX=h,s.currentY=d;const u=s.currentX-s.startX,p=s.currentY-s.startY;if(i.params.threshold&&Math.sqrt(u**2+p**2)<i.params.threshold)return;if("undefined"===typeof n.isScrolling){let e;i.isHorizontal()&&s.currentY===s.startY||i.isVertical()&&s.currentX===s.startX?n.isScrolling=!1:u*u+p*p>=25&&(e=180*Math.atan2(Math.abs(p),Math.abs(u))/Math.PI,n.isScrolling=i.isHorizontal()?e>r.touchAngle:90-e>r.touchAngle)}if(n.isScrolling&&i.emit("touchMoveOpposite",c),"undefined"===typeof n.startMoving&&(s.currentX===s.startX&&s.currentY===s.startY||(n.startMoving=!0)),n.isScrolling||"touchmove"===c.type&&n.preventTouchMoveFromPointerMove)return void(n.isTouched=!1);if(!n.startMoving)return;i.allowClick=!1,!r.cssMode&&c.cancelable&&c.preventDefault(),r.touchMoveStopPropagation&&!r.nested&&c.stopPropagation();let f=i.isHorizontal()?u:p,m=i.isHorizontal()?s.currentX-s.previousX:s.currentY-s.previousY;r.oneWayMovement&&(f=Math.abs(f)*(a?1:-1),m=Math.abs(m)*(a?1:-1)),s.diff=f,f*=r.touchRatio,a&&(f=-f,m=-m);const g=i.touchesDirection;i.swipeDirection=f>0?"prev":"next",i.touchesDirection=m>0?"prev":"next";const v=i.params.loop&&!r.cssMode,y="next"===i.touchesDirection&&i.allowSlideNext||"prev"===i.touchesDirection&&i.allowSlidePrev;if(!n.isMoved){if(v&&y&&i.loopFix({direction:i.swipeDirection}),n.startTranslate=i.getTranslate(),i.setTransition(0),i.animating){const e=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});i.wrapperEl.dispatchEvent(e)}n.allowMomentumBounce=!1,!r.grabCursor||!0!==i.allowSlideNext&&!0!==i.allowSlidePrev||i.setGrabCursor(!0),i.emit("sliderFirstMove",c)}if((new Date).getTime(),n.isMoved&&n.allowThresholdMove&&g!==i.touchesDirection&&v&&y&&Math.abs(f)>=1)return Object.assign(s,{startX:h,startY:d,currentX:h,currentY:d,startTranslate:n.currentTranslate}),n.loopSwapReset=!0,void(n.startTranslate=n.currentTranslate);i.emit("sliderMove",c),n.isMoved=!0,n.currentTranslate=f+n.startTranslate;let b=!0,A=r.resistanceRatio;if(r.touchReleaseOnEdges&&(A=0),f>0?(v&&y&&n.allowThresholdMove&&n.currentTranslate>(r.centeredSlides?i.minTranslate()-i.slidesSizesGrid[i.activeIndex+1]-("auto"!==r.slidesPerView&&i.slides.length-r.slidesPerView>=2?i.slidesSizesGrid[i.activeIndex+1]+i.params.spaceBetween:0)-i.params.spaceBetween:i.minTranslate())&&i.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),n.currentTranslate>i.minTranslate()&&(b=!1,r.resistance&&(n.currentTranslate=i.minTranslate()-1+(-i.minTranslate()+n.startTranslate+f)**A))):f<0&&(v&&y&&n.allowThresholdMove&&n.currentTranslate<(r.centeredSlides?i.maxTranslate()+i.slidesSizesGrid[i.slidesSizesGrid.length-1]+i.params.spaceBetween+("auto"!==r.slidesPerView&&i.slides.length-r.slidesPerView>=2?i.slidesSizesGrid[i.slidesSizesGrid.length-1]+i.params.spaceBetween:0):i.maxTranslate())&&i.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:i.slides.length-("auto"===r.slidesPerView?i.slidesPerViewDynamic():Math.ceil(parseFloat(r.slidesPerView,10)))}),n.currentTranslate<i.maxTranslate()&&(b=!1,r.resistance&&(n.currentTranslate=i.maxTranslate()+1-(i.maxTranslate()-n.startTranslate-f)**A))),b&&(c.preventedByNestedSwiper=!0),!i.allowSlideNext&&"next"===i.swipeDirection&&n.currentTranslate<n.startTranslate&&(n.currentTranslate=n.startTranslate),!i.allowSlidePrev&&"prev"===i.swipeDirection&&n.currentTranslate>n.startTranslate&&(n.currentTranslate=n.startTranslate),i.allowSlidePrev||i.allowSlideNext||(n.currentTranslate=n.startTranslate),r.threshold>0){if(!(Math.abs(f)>r.threshold||n.allowThresholdMove))return void(n.currentTranslate=n.startTranslate);if(!n.allowThresholdMove)return n.allowThresholdMove=!0,s.startX=s.currentX,s.startY=s.currentY,n.currentTranslate=n.startTranslate,void(s.diff=i.isHorizontal()?s.currentX-s.startX:s.currentY-s.startY)}r.followFinger&&!r.cssMode&&((r.freeMode&&r.freeMode.enabled&&i.freeMode||r.watchSlidesProgress)&&(i.updateActiveIndex(),i.updateSlidesClasses()),r.freeMode&&r.freeMode.enabled&&i.freeMode&&i.freeMode.onTouchMove(),i.updateProgress(n.currentTranslate),i.setTranslate(n.currentTranslate))}function kn(e){const t=this,i=t.touchEventsData;let n,r=e;r.originalEvent&&(r=r.originalEvent);if("touchend"===r.type||"touchcancel"===r.type){if(n=[...r.changedTouches].filter((e=>e.identifier===i.touchId))[0],!n||n.identifier!==i.touchId)return}else{if(null!==i.touchId)return;if(r.pointerId!==i.pointerId)return;n=r}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(r.type)){if(!(["pointercancel","contextmenu"].includes(r.type)&&(t.browser.isSafari||t.browser.isWebView)))return}i.pointerId=null,i.touchId=null;const{params:s,touches:a,rtlTranslate:o,slidesGrid:l,enabled:c}=t;if(!c)return;if(!s.simulateTouch&&"mouse"===r.pointerType)return;if(i.allowTouchCallbacks&&t.emit("touchEnd",r),i.allowTouchCallbacks=!1,!i.isTouched)return i.isMoved&&s.grabCursor&&t.setGrabCursor(!1),i.isMoved=!1,void(i.startMoving=!1);s.grabCursor&&i.isMoved&&i.isTouched&&(!0===t.allowSlideNext||!0===t.allowSlidePrev)&&t.setGrabCursor(!1);const h=$i(),d=h-i.touchStartTime;if(t.allowClick){const e=r.path||r.composedPath&&r.composedPath();t.updateClickedSlide(e&&e[0]||r.target,e),t.emit("tap click",r),d<300&&h-i.lastClickTime<300&&t.emit("doubleTap doubleClick",r)}if(i.lastClickTime=$i(),Zi((()=>{t.destroyed||(t.allowClick=!0)})),!i.isTouched||!i.isMoved||!t.swipeDirection||0===a.diff&&!i.loopSwapReset||i.currentTranslate===i.startTranslate&&!i.loopSwapReset)return i.isTouched=!1,i.isMoved=!1,void(i.startMoving=!1);let u;if(i.isTouched=!1,i.isMoved=!1,i.startMoving=!1,u=s.followFinger?o?t.translate:-t.translate:-i.currentTranslate,s.cssMode)return;if(s.freeMode&&s.freeMode.enabled)return void t.freeMode.onTouchEnd({currentPos:u});const p=u>=-t.maxTranslate()&&!t.params.loop;let f=0,m=t.slidesSizesGrid[0];for(let A=0;A<l.length;A+=A<s.slidesPerGroupSkip?1:s.slidesPerGroup){const e=A<s.slidesPerGroupSkip-1?1:s.slidesPerGroup;"undefined"!==typeof l[A+e]?(p||u>=l[A]&&u<l[A+e])&&(f=A,m=l[A+e]-l[A]):(p||u>=l[A])&&(f=A,m=l[l.length-1]-l[l.length-2])}let g=null,v=null;s.rewind&&(t.isBeginning?v=s.virtual&&s.virtual.enabled&&t.virtual?t.virtual.slides.length-1:t.slides.length-1:t.isEnd&&(g=0));const y=(u-l[f])/m,b=f<s.slidesPerGroupSkip-1?1:s.slidesPerGroup;if(d>s.longSwipesMs){if(!s.longSwipes)return void t.slideTo(t.activeIndex);"next"===t.swipeDirection&&(y>=s.longSwipesRatio?t.slideTo(s.rewind&&t.isEnd?g:f+b):t.slideTo(f)),"prev"===t.swipeDirection&&(y>1-s.longSwipesRatio?t.slideTo(f+b):null!==v&&y<0&&Math.abs(y)>s.longSwipesRatio?t.slideTo(v):t.slideTo(f))}else{if(!s.shortSwipes)return void t.slideTo(t.activeIndex);t.navigation&&(r.target===t.navigation.nextEl||r.target===t.navigation.prevEl)?r.target===t.navigation.nextEl?t.slideTo(f+b):t.slideTo(f):("next"===t.swipeDirection&&t.slideTo(null!==g?g:f+b),"prev"===t.swipeDirection&&t.slideTo(null!==v?v:f))}}function Fn(){const e=this,{params:t,el:i}=e;if(i&&0===i.offsetWidth)return;t.breakpoints&&e.setBreakpoint();const{allowSlideNext:n,allowSlidePrev:r,snapGrid:s}=e,a=e.virtual&&e.params.virtual.enabled;e.allowSlideNext=!0,e.allowSlidePrev=!0,e.updateSize(),e.updateSlides(),e.updateSlidesClasses();const o=a&&t.loop;!("auto"===t.slidesPerView||t.slidesPerView>1)||!e.isEnd||e.isBeginning||e.params.centeredSlides||o?e.params.loop&&!a?e.slideToLoop(e.realIndex,0,!1,!0):e.slideTo(e.activeIndex,0,!1,!0):e.slideTo(e.slides.length-1,0,!1,!0),e.autoplay&&e.autoplay.running&&e.autoplay.paused&&(clearTimeout(e.autoplay.resizeTimeout),e.autoplay.resizeTimeout=setTimeout((()=>{e.autoplay&&e.autoplay.running&&e.autoplay.paused&&e.autoplay.resume()}),500)),e.allowSlidePrev=r,e.allowSlideNext=n,e.params.watchOverflow&&s!==e.snapGrid&&e.checkOverflow()}function Un(e){const t=this;t.enabled&&(t.allowClick||(t.params.preventClicks&&e.preventDefault(),t.params.preventClicksPropagation&&t.animating&&(e.stopPropagation(),e.stopImmediatePropagation())))}function zn(){const e=this,{wrapperEl:t,rtlTranslate:i,enabled:n}=e;if(!n)return;let r;e.previousTranslate=e.translate,e.isHorizontal()?e.translate=-t.scrollLeft:e.translate=-t.scrollTop,0===e.translate&&(e.translate=0),e.updateActiveIndex(),e.updateSlidesClasses();const s=e.maxTranslate()-e.minTranslate();r=0===s?0:(e.translate-e.minTranslate())/s,r!==e.progress&&e.updateProgress(i?-e.translate:e.translate),e.emit("setTranslate",e.translate,!1)}function jn(e){const t=this;_n(t,e.target),t.params.cssMode||"auto"!==t.params.slidesPerView&&!t.params.autoHeight||t.update()}function Vn(){const e=this;e.documentTouchHandlerProceeded||(e.documentTouchHandlerProceeded=!0,e.params.touchReleaseOnEdges&&(e.el.style.touchAction="auto"))}const Gn=(e,t)=>{const i=Yi(),{params:n,el:r,wrapperEl:s,device:a}=e,o=!!n.nested,l="on"===t?"addEventListener":"removeEventListener",c=t;r&&"string"!==typeof r&&(i[l]("touchstart",e.onDocumentTouchStart,{passive:!1,capture:o}),r[l]("touchstart",e.onTouchStart,{passive:!1}),r[l]("pointerdown",e.onTouchStart,{passive:!1}),i[l]("touchmove",e.onTouchMove,{passive:!1,capture:o}),i[l]("pointermove",e.onTouchMove,{passive:!1,capture:o}),i[l]("touchend",e.onTouchEnd,{passive:!0}),i[l]("pointerup",e.onTouchEnd,{passive:!0}),i[l]("pointercancel",e.onTouchEnd,{passive:!0}),i[l]("touchcancel",e.onTouchEnd,{passive:!0}),i[l]("pointerout",e.onTouchEnd,{passive:!0}),i[l]("pointerleave",e.onTouchEnd,{passive:!0}),i[l]("contextmenu",e.onTouchEnd,{passive:!0}),(n.preventClicks||n.preventClicksPropagation)&&r[l]("click",e.onClick,!0),n.cssMode&&s[l]("scroll",e.onScroll),n.updateOnWindowResize?e[c](a.ios||a.android?"resize orientationchange observerUpdate":"resize observerUpdate",Fn,!0):e[c]("observerUpdate",Fn,!0),r[l]("load",e.onLoad,{capture:!0}))};var Hn={attachEvents:function(){const e=this,{params:t}=e;e.onTouchStart=On.bind(e),e.onTouchMove=Nn.bind(e),e.onTouchEnd=kn.bind(e),e.onDocumentTouchStart=Vn.bind(e),t.cssMode&&(e.onScroll=zn.bind(e)),e.onClick=Un.bind(e),e.onLoad=jn.bind(e),Gn(e,"on")},detachEvents:function(){Gn(this,"off")}};const Wn=(e,t)=>e.grid&&t.grid&&t.grid.rows>1;var Qn={setBreakpoint:function(){const e=this,{realIndex:t,initialized:i,params:n,el:r}=e,s=n.breakpoints;if(!s||s&&0===Object.keys(s).length)return;const a=e.getBreakpoint(s,e.params.breakpointsBase,e.el);if(!a||e.currentBreakpoint===a)return;const o=(a in s?s[a]:void 0)||e.originalParams,l=Wn(e,n),c=Wn(e,o),h=e.params.grabCursor,d=o.grabCursor,u=n.enabled;l&&!c?(r.classList.remove(`${n.containerModifierClass}grid`,`${n.containerModifierClass}grid-column`),e.emitContainerClasses()):!l&&c&&(r.classList.add(`${n.containerModifierClass}grid`),(o.grid.fill&&"column"===o.grid.fill||!o.grid.fill&&"column"===n.grid.fill)&&r.classList.add(`${n.containerModifierClass}grid-column`),e.emitContainerClasses()),h&&!d?e.unsetGrabCursor():!h&&d&&e.setGrabCursor(),["navigation","pagination","scrollbar"].forEach((t=>{if("undefined"===typeof o[t])return;const i=n[t]&&n[t].enabled,r=o[t]&&o[t].enabled;i&&!r&&e[t].disable(),!i&&r&&e[t].enable()}));const p=o.direction&&o.direction!==n.direction,f=n.loop&&(o.slidesPerView!==n.slidesPerView||p),m=n.loop;p&&i&&e.changeDirection(),nn(e.params,o);const g=e.params.enabled,v=e.params.loop;Object.assign(e,{allowTouchMove:e.params.allowTouchMove,allowSlideNext:e.params.allowSlideNext,allowSlidePrev:e.params.allowSlidePrev}),u&&!g?e.disable():!u&&g&&e.enable(),e.currentBreakpoint=a,e.emit("_beforeBreakpoint",o),i&&(f?(e.loopDestroy(),e.loopCreate(t),e.updateSlides()):!m&&v?(e.loopCreate(t),e.updateSlides()):m&&!v&&e.loopDestroy()),e.emit("breakpoint",o)},getBreakpoint:function(e,t,i){if(void 0===t&&(t="window"),!e||"container"===t&&!i)return;let n=!1;const r=Ji(),s="window"===t?r.innerHeight:i.clientHeight,a=Object.keys(e).map((e=>{if("string"===typeof e&&0===e.indexOf("@")){const t=parseFloat(e.substr(1));return{value:s*t,point:e}}return{value:e,point:e}}));a.sort(((e,t)=>parseInt(e.value,10)-parseInt(t.value,10)));for(let o=0;o<a.length;o+=1){const{point:e,value:s}=a[o];"window"===t?r.matchMedia(`(min-width: ${s}px)`).matches&&(n=e):s<=i.clientWidth&&(n=e)}return n||"max"}};var qn={addClasses:function(){const e=this,{classNames:t,params:i,rtl:n,el:r,device:s}=e,a=function(e,t){const i=[];return e.forEach((e=>{"object"===typeof e?Object.keys(e).forEach((n=>{e[n]&&i.push(t+n)})):"string"===typeof e&&i.push(t+e)})),i}(["initialized",i.direction,{"free-mode":e.params.freeMode&&i.freeMode.enabled},{autoheight:i.autoHeight},{rtl:n},{grid:i.grid&&i.grid.rows>1},{"grid-column":i.grid&&i.grid.rows>1&&"column"===i.grid.fill},{android:s.android},{ios:s.ios},{"css-mode":i.cssMode},{centered:i.cssMode&&i.centeredSlides},{"watch-progress":i.watchSlidesProgress}],i.containerModifierClass);t.push(...a),r.classList.add(...t),e.emitContainerClasses()},removeClasses:function(){const{el:e,classNames:t}=this;e&&"string"!==typeof e&&(e.classList.remove(...t),this.emitContainerClasses())}};var Xn={checkOverflow:function(){const e=this,{isLocked:t,params:i}=e,{slidesOffsetBefore:n}=i;if(n){const t=e.slides.length-1,i=e.slidesGrid[t]+e.slidesSizesGrid[t]+2*n;e.isLocked=e.size>i}else e.isLocked=1===e.snapGrid.length;!0===i.allowSlideNext&&(e.allowSlideNext=!e.isLocked),!0===i.allowSlidePrev&&(e.allowSlidePrev=!e.isLocked),t&&t!==e.isLocked&&(e.isEnd=!1),t!==e.isLocked&&e.emit(e.isLocked?"lock":"unlock")}},Yn={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function Kn(e,t){return function(i){void 0===i&&(i={});const n=Object.keys(i)[0],r=i[n];"object"===typeof r&&null!==r?(!0===e[n]&&(e[n]={enabled:!0}),"navigation"===n&&e[n]&&e[n].enabled&&!e[n].prevEl&&!e[n].nextEl&&(e[n].auto=!0),["pagination","scrollbar"].indexOf(n)>=0&&e[n]&&e[n].enabled&&!e[n].el&&(e[n].auto=!0),n in e&&"enabled"in r?("object"!==typeof e[n]||"enabled"in e[n]||(e[n].enabled=!0),e[n]||(e[n]={enabled:!1}),nn(t,i)):nn(t,i)):nn(t,i)}}const Jn={eventsEmitter:xn,update:Mn,translate:Tn,transition:Pn,slide:Dn,loop:Rn,grabCursor:Bn,events:Hn,breakpoints:Qn,checkOverflow:Xn,classes:qn},Zn={};class $n{constructor(){let e,t;for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];1===n.length&&n[0].constructor&&"Object"===Object.prototype.toString.call(n[0]).slice(8,-1)?t=n[0]:[e,t]=n,t||(t={}),t=nn({},t),e&&!t.el&&(t.el=e);const s=Yi();if(t.el&&"string"===typeof t.el&&s.querySelectorAll(t.el).length>1){const e=[];return s.querySelectorAll(t.el).forEach((i=>{const n=nn({},t,{el:i});e.push(new $n(n))})),e}const a=this;a.__swiper__=!0,a.support=yn(),a.device=bn({userAgent:t.userAgent}),a.browser=An(),a.eventsListeners={},a.eventsAnyListeners=[],a.modules=[...a.__modules__],t.modules&&Array.isArray(t.modules)&&a.modules.push(...t.modules);const o={};a.modules.forEach((e=>{e({params:t,swiper:a,extendParams:Kn(t,o),on:a.on.bind(a),once:a.once.bind(a),off:a.off.bind(a),emit:a.emit.bind(a)})}));const l=nn({},Yn,o);return a.params=nn({},l,Zn,t),a.originalParams=nn({},a.params),a.passedParams=nn({},t),a.params&&a.params.on&&Object.keys(a.params.on).forEach((e=>{a.on(e,a.params.on[e])})),a.params&&a.params.onAny&&a.onAny(a.params.onAny),Object.assign(a,{enabled:a.params.enabled,el:e,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:()=>"horizontal"===a.params.direction,isVertical:()=>"vertical"===a.params.direction,activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:a.params.allowSlideNext,allowSlidePrev:a.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:a.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:a.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),a.emit("_swiper"),a.params.init&&a.init(),a}getDirectionLabel(e){return this.isHorizontal()?e:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[e]}getSlideIndex(e){const{slidesEl:t,params:i}=this,n=dn(on(t,`.${i.slideClass}, swiper-slide`)[0]);return dn(e)-n}getSlideIndexByData(e){return this.getSlideIndex(this.slides.filter((t=>1*t.getAttribute("data-swiper-slide-index")===e))[0])}recalcSlides(){const{slidesEl:e,params:t}=this;this.slides=on(e,`.${t.slideClass}, swiper-slide`)}enable(){const e=this;e.enabled||(e.enabled=!0,e.params.grabCursor&&e.setGrabCursor(),e.emit("enable"))}disable(){const e=this;e.enabled&&(e.enabled=!1,e.params.grabCursor&&e.unsetGrabCursor(),e.emit("disable"))}setProgress(e,t){const i=this;e=Math.min(Math.max(e,0),1);const n=i.minTranslate(),r=(i.maxTranslate()-n)*e+n;i.translateTo(r,"undefined"===typeof t?0:t),i.updateActiveIndex(),i.updateSlidesClasses()}emitContainerClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const t=e.el.className.split(" ").filter((t=>0===t.indexOf("swiper")||0===t.indexOf(e.params.containerModifierClass)));e.emit("_containerClasses",t.join(" "))}getSlideClasses(e){const t=this;return t.destroyed?"":e.className.split(" ").filter((e=>0===e.indexOf("swiper-slide")||0===e.indexOf(t.params.slideClass))).join(" ")}emitSlidesClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const t=[];e.slides.forEach((i=>{const n=e.getSlideClasses(i);t.push({slideEl:i,classNames:n}),e.emit("_slideClass",i,n)})),e.emit("_slideClasses",t)}slidesPerViewDynamic(e,t){void 0===e&&(e="current"),void 0===t&&(t=!1);const{params:i,slides:n,slidesGrid:r,slidesSizesGrid:s,size:a,activeIndex:o}=this;let l=1;if("number"===typeof i.slidesPerView)return i.slidesPerView;if(i.centeredSlides){let e,t=n[o]?Math.ceil(n[o].swiperSlideSize):0;for(let i=o+1;i<n.length;i+=1)n[i]&&!e&&(t+=Math.ceil(n[i].swiperSlideSize),l+=1,t>a&&(e=!0));for(let i=o-1;i>=0;i-=1)n[i]&&!e&&(t+=n[i].swiperSlideSize,l+=1,t>a&&(e=!0))}else if("current"===e)for(let c=o+1;c<n.length;c+=1){(t?r[c]+s[c]-r[o]<a:r[c]-r[o]<a)&&(l+=1)}else for(let c=o-1;c>=0;c-=1){r[o]-r[c]<a&&(l+=1)}return l}update(){const e=this;if(!e||e.destroyed)return;const{snapGrid:t,params:i}=e;function n(){const t=e.rtlTranslate?-1*e.translate:e.translate,i=Math.min(Math.max(t,e.maxTranslate()),e.minTranslate());e.setTranslate(i),e.updateActiveIndex(),e.updateSlidesClasses()}let r;if(i.breakpoints&&e.setBreakpoint(),[...e.el.querySelectorAll('[loading="lazy"]')].forEach((t=>{t.complete&&_n(e,t)})),e.updateSize(),e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),i.freeMode&&i.freeMode.enabled&&!i.cssMode)n(),i.autoHeight&&e.updateAutoHeight();else{if(("auto"===i.slidesPerView||i.slidesPerView>1)&&e.isEnd&&!i.centeredSlides){const t=e.virtual&&i.virtual.enabled?e.virtual.slides:e.slides;r=e.slideTo(t.length-1,0,!1,!0)}else r=e.slideTo(e.activeIndex,0,!1,!0);r||n()}i.watchOverflow&&t!==e.snapGrid&&e.checkOverflow(),e.emit("update")}changeDirection(e,t){void 0===t&&(t=!0);const i=this,n=i.params.direction;return e||(e="horizontal"===n?"vertical":"horizontal"),e===n||"horizontal"!==e&&"vertical"!==e||(i.el.classList.remove(`${i.params.containerModifierClass}${n}`),i.el.classList.add(`${i.params.containerModifierClass}${e}`),i.emitContainerClasses(),i.params.direction=e,i.slides.forEach((t=>{"vertical"===e?t.style.width="":t.style.height=""})),i.emit("changeDirection"),t&&i.update()),i}changeLanguageDirection(e){const t=this;t.rtl&&"rtl"===e||!t.rtl&&"ltr"===e||(t.rtl="rtl"===e,t.rtlTranslate="horizontal"===t.params.direction&&t.rtl,t.rtl?(t.el.classList.add(`${t.params.containerModifierClass}rtl`),t.el.dir="rtl"):(t.el.classList.remove(`${t.params.containerModifierClass}rtl`),t.el.dir="ltr"),t.update())}mount(e){const t=this;if(t.mounted)return!0;let i=e||t.params.el;if("string"===typeof i&&(i=document.querySelector(i)),!i)return!1;i.swiper=t,i.parentNode&&i.parentNode.host&&i.parentNode.host.nodeName===t.params.swiperElementNodeName.toUpperCase()&&(t.isElement=!0);const n=()=>`.${(t.params.wrapperClass||"").trim().split(" ").join(".")}`;let r=(()=>{if(i&&i.shadowRoot&&i.shadowRoot.querySelector){return i.shadowRoot.querySelector(n())}return on(i,n())[0]})();return!r&&t.params.createElements&&(r=cn("div",t.params.wrapperClass),i.append(r),on(i,`.${t.params.slideClass}`).forEach((e=>{r.append(e)}))),Object.assign(t,{el:i,wrapperEl:r,slidesEl:t.isElement&&!i.parentNode.host.slideSlots?i.parentNode.host:r,hostEl:t.isElement?i.parentNode.host:i,mounted:!0,rtl:"rtl"===i.dir.toLowerCase()||"rtl"===hn(i,"direction"),rtlTranslate:"horizontal"===t.params.direction&&("rtl"===i.dir.toLowerCase()||"rtl"===hn(i,"direction")),wrongRTL:"-webkit-box"===hn(r,"display")}),!0}init(e){const t=this;if(t.initialized)return t;if(!1===t.mount(e))return t;t.emit("beforeInit"),t.params.breakpoints&&t.setBreakpoint(),t.addClasses(),t.updateSize(),t.updateSlides(),t.params.watchOverflow&&t.checkOverflow(),t.params.grabCursor&&t.enabled&&t.setGrabCursor(),t.params.loop&&t.virtual&&t.params.virtual.enabled?t.slideTo(t.params.initialSlide+t.virtual.slidesBefore,0,t.params.runCallbacksOnInit,!1,!0):t.slideTo(t.params.initialSlide,0,t.params.runCallbacksOnInit,!1,!0),t.params.loop&&t.loopCreate(),t.attachEvents();const i=[...t.el.querySelectorAll('[loading="lazy"]')];return t.isElement&&i.push(...t.hostEl.querySelectorAll('[loading="lazy"]')),i.forEach((e=>{e.complete?_n(t,e):e.addEventListener("load",(e=>{_n(t,e.target)}))})),Cn(t),t.initialized=!0,Cn(t),t.emit("init"),t.emit("afterInit"),t}destroy(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);const i=this,{params:n,el:r,wrapperEl:s,slides:a}=i;return"undefined"===typeof i.params||i.destroyed||(i.emit("beforeDestroy"),i.initialized=!1,i.detachEvents(),n.loop&&i.loopDestroy(),t&&(i.removeClasses(),r&&"string"!==typeof r&&r.removeAttribute("style"),s&&s.removeAttribute("style"),a&&a.length&&a.forEach((e=>{e.classList.remove(n.slideVisibleClass,n.slideFullyVisibleClass,n.slideActiveClass,n.slideNextClass,n.slidePrevClass),e.removeAttribute("style"),e.removeAttribute("data-swiper-slide-index")}))),i.emit("destroy"),Object.keys(i.eventsListeners).forEach((e=>{i.off(e)})),!1!==e&&(i.el&&"string"!==typeof i.el&&(i.el.swiper=null),function(e){const t=e;Object.keys(t).forEach((e=>{try{t[e]=null}catch(th){}try{delete t[e]}catch(th){}}))}(i)),i.destroyed=!0),null}static extendDefaults(e){nn(Zn,e)}static get extendedDefaults(){return Zn}static get defaults(){return Yn}static installModule(e){$n.prototype.__modules__||($n.prototype.__modules__=[]);const t=$n.prototype.__modules__;"function"===typeof e&&t.indexOf(e)<0&&t.push(e)}static use(e){return Array.isArray(e)?(e.forEach((e=>$n.installModule(e))),$n):($n.installModule(e),$n)}}Object.keys(Jn).forEach((e=>{Object.keys(Jn[e]).forEach((t=>{$n.prototype[t]=Jn[e][t]}))})),$n.use([function(e){let{swiper:t,on:i,emit:n}=e;const r=Ji();let s=null,a=null;const o=()=>{t&&!t.destroyed&&t.initialized&&(n("beforeResize"),n("resize"))},l=()=>{t&&!t.destroyed&&t.initialized&&n("orientationchange")};i("init",(()=>{t.params.resizeObserver&&"undefined"!==typeof r.ResizeObserver?t&&!t.destroyed&&t.initialized&&(s=new ResizeObserver((e=>{a=r.requestAnimationFrame((()=>{const{width:i,height:n}=t;let r=i,s=n;e.forEach((e=>{let{contentBoxSize:i,contentRect:n,target:a}=e;a&&a!==t.el||(r=n?n.width:(i[0]||i).inlineSize,s=n?n.height:(i[0]||i).blockSize)})),r===i&&s===n||o()}))})),s.observe(t.el)):(r.addEventListener("resize",o),r.addEventListener("orientationchange",l))})),i("destroy",(()=>{a&&r.cancelAnimationFrame(a),s&&s.unobserve&&t.el&&(s.unobserve(t.el),s=null),r.removeEventListener("resize",o),r.removeEventListener("orientationchange",l)}))},function(e){let{swiper:t,extendParams:i,on:n,emit:r}=e;const s=[],a=Ji(),o=function(e,i){void 0===i&&(i={});const n=new(a.MutationObserver||a.WebkitMutationObserver)((e=>{if(t.__preventObserver__)return;if(1===e.length)return void r("observerUpdate",e[0]);const i=function(){r("observerUpdate",e[0])};a.requestAnimationFrame?a.requestAnimationFrame(i):a.setTimeout(i,0)}));n.observe(e,{attributes:"undefined"===typeof i.attributes||i.attributes,childList:t.isElement||("undefined"===typeof i.childList||i).childList,characterData:"undefined"===typeof i.characterData||i.characterData}),s.push(n)};i({observer:!1,observeParents:!1,observeSlideChildren:!1}),n("init",(()=>{if(t.params.observer){if(t.params.observeParents){const e=un(t.hostEl);for(let t=0;t<e.length;t+=1)o(e[t])}o(t.hostEl,{childList:t.params.observeSlideChildren}),o(t.wrapperEl,{attributes:!1})}})),n("destroy",(()=>{s.forEach((e=>{e.disconnect()})),s.splice(0,s.length)}))}]);const er=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function tr(e){return"object"===typeof e&&null!==e&&e.constructor&&"Object"===Object.prototype.toString.call(e).slice(8,-1)&&!e.__swiper__}function ir(e,t){const i=["__proto__","constructor","prototype"];Object.keys(t).filter((e=>i.indexOf(e)<0)).forEach((i=>{"undefined"===typeof e[i]?e[i]=t[i]:tr(t[i])&&tr(e[i])&&Object.keys(t[i]).length>0?t[i].__swiper__?e[i]=t[i]:ir(e[i],t[i]):e[i]=t[i]}))}function nr(e){return void 0===e&&(e={}),e.navigation&&"undefined"===typeof e.navigation.nextEl&&"undefined"===typeof e.navigation.prevEl}function rr(e){return void 0===e&&(e={}),e.pagination&&"undefined"===typeof e.pagination.el}function sr(e){return void 0===e&&(e={}),e.scrollbar&&"undefined"===typeof e.scrollbar.el}function ar(e){void 0===e&&(e="");const t=e.split(" ").map((e=>e.trim())).filter((e=>!!e)),i=[];return t.forEach((e=>{i.indexOf(e)<0&&i.push(e)})),i.join(" ")}function or(e){return void 0===e&&(e=""),e?e.includes("swiper-wrapper")?e:`swiper-wrapper ${e}`:"swiper-wrapper"}function lr(){return lr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},lr.apply(this,arguments)}function cr(e){return e.type&&e.type.displayName&&e.type.displayName.includes("SwiperSlide")}function hr(e){const t=[];return n.Children.toArray(e).forEach((e=>{cr(e)?t.push(e):e.props&&e.props.children&&hr(e.props.children).forEach((e=>t.push(e)))})),t}function dr(e){const t=[],i={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return n.Children.toArray(e).forEach((e=>{if(cr(e))t.push(e);else if(e.props&&e.props.slot&&i[e.props.slot])i[e.props.slot].push(e);else if(e.props&&e.props.children){const n=hr(e.props.children);n.length>0?n.forEach((e=>t.push(e))):i["container-end"].push(e)}else i["container-end"].push(e)})),{slides:t,slots:i}}function ur(e,t){return"undefined"===typeof window?(0,n.useEffect)(e,t):(0,n.useLayoutEffect)(e,t)}const pr=(0,n.createContext)(null),fr=(0,n.createContext)(null),mr=(0,n.forwardRef)((function(e,t){let{className:i,tag:r="div",wrapperTag:s="div",children:a,onSwiper:o,...l}=void 0===e?{}:e,c=!1;const[h,d]=(0,n.useState)("swiper"),[u,p]=(0,n.useState)(null),[f,m]=(0,n.useState)(!1),g=(0,n.useRef)(!1),v=(0,n.useRef)(null),y=(0,n.useRef)(null),b=(0,n.useRef)(null),A=(0,n.useRef)(null),x=(0,n.useRef)(null),w=(0,n.useRef)(null),S=(0,n.useRef)(null),_=(0,n.useRef)(null),{params:E,passedParams:C,rest:M,events:T}=function(e,t){void 0===e&&(e={}),void 0===t&&(t=!0);const i={on:{}},n={},r={};ir(i,Yn),i._emitClasses=!0,i.init=!1;const s={},a=er.map((e=>e.replace(/_/,""))),o=Object.assign({},e);return Object.keys(o).forEach((o=>{"undefined"!==typeof e[o]&&(a.indexOf(o)>=0?tr(e[o])?(i[o]={},r[o]={},ir(i[o],e[o]),ir(r[o],e[o])):(i[o]=e[o],r[o]=e[o]):0===o.search(/on[A-Z]/)&&"function"===typeof e[o]?t?n[`${o[2].toLowerCase()}${o.substr(3)}`]=e[o]:i.on[`${o[2].toLowerCase()}${o.substr(3)}`]=e[o]:s[o]=e[o])})),["navigation","pagination","scrollbar"].forEach((e=>{!0===i[e]&&(i[e]={}),!1===i[e]&&delete i[e]})),{params:i,passedParams:r,rest:s,events:n}}(l),{slides:I,slots:P}=dr(a),D=()=>{m(!f)};Object.assign(E.on,{_containerClasses(e,t){d(t)}});const R=()=>{Object.assign(E.on,T),c=!0;const e={...E};if(delete e.wrapperClass,y.current=new $n(e),y.current.virtual&&y.current.params.virtual.enabled){y.current.virtual.slides=I;const e={cache:!1,slides:I,renderExternal:p,renderExternalUpdate:!1};ir(y.current.params.virtual,e),ir(y.current.originalParams.virtual,e)}};v.current||R(),y.current&&y.current.on("_beforeBreakpoint",D);return(0,n.useEffect)((()=>()=>{y.current&&y.current.off("_beforeBreakpoint",D)})),(0,n.useEffect)((()=>{!g.current&&y.current&&(y.current.emitSlidesClasses(),g.current=!0)})),ur((()=>{if(t&&(t.current=v.current),v.current)return y.current.destroyed&&R(),function(e,t){let{el:i,nextEl:n,prevEl:r,paginationEl:s,scrollbarEl:a,swiper:o}=e;nr(t)&&n&&r&&(o.params.navigation.nextEl=n,o.originalParams.navigation.nextEl=n,o.params.navigation.prevEl=r,o.originalParams.navigation.prevEl=r),rr(t)&&s&&(o.params.pagination.el=s,o.originalParams.pagination.el=s),sr(t)&&a&&(o.params.scrollbar.el=a,o.originalParams.scrollbar.el=a),o.init(i)}({el:v.current,nextEl:x.current,prevEl:w.current,paginationEl:S.current,scrollbarEl:_.current,swiper:y.current},E),o&&!y.current.destroyed&&o(y.current),()=>{y.current&&!y.current.destroyed&&y.current.destroy(!0,!1)}}),[]),ur((()=>{!c&&T&&y.current&&Object.keys(T).forEach((e=>{y.current.on(e,T[e])}));const e=function(e,t,i,n,r){const s=[];if(!t)return s;const a=e=>{s.indexOf(e)<0&&s.push(e)};if(i&&n){const e=n.map(r),t=i.map(r);e.join("")!==t.join("")&&a("children"),n.length!==i.length&&a("children")}return er.filter((e=>"_"===e[0])).map((e=>e.replace(/_/,""))).forEach((i=>{if(i in e&&i in t)if(tr(e[i])&&tr(t[i])){const n=Object.keys(e[i]),r=Object.keys(t[i]);n.length!==r.length?a(i):(n.forEach((n=>{e[i][n]!==t[i][n]&&a(i)})),r.forEach((n=>{e[i][n]!==t[i][n]&&a(i)})))}else e[i]!==t[i]&&a(i)})),s}(C,b.current,I,A.current,(e=>e.key));return b.current=C,A.current=I,e.length&&y.current&&!y.current.destroyed&&function(e){let{swiper:t,slides:i,passedParams:n,changedParams:r,nextEl:s,prevEl:a,scrollbarEl:o,paginationEl:l}=e;const c=r.filter((e=>"children"!==e&&"direction"!==e&&"wrapperClass"!==e)),{params:h,pagination:d,navigation:u,scrollbar:p,virtual:f,thumbs:m}=t;let g,v,y,b,A,x,w,S;r.includes("thumbs")&&n.thumbs&&n.thumbs.swiper&&h.thumbs&&!h.thumbs.swiper&&(g=!0),r.includes("controller")&&n.controller&&n.controller.control&&h.controller&&!h.controller.control&&(v=!0),r.includes("pagination")&&n.pagination&&(n.pagination.el||l)&&(h.pagination||!1===h.pagination)&&d&&!d.el&&(y=!0),r.includes("scrollbar")&&n.scrollbar&&(n.scrollbar.el||o)&&(h.scrollbar||!1===h.scrollbar)&&p&&!p.el&&(b=!0),r.includes("navigation")&&n.navigation&&(n.navigation.prevEl||a)&&(n.navigation.nextEl||s)&&(h.navigation||!1===h.navigation)&&u&&!u.prevEl&&!u.nextEl&&(A=!0);const _=e=>{t[e]&&(t[e].destroy(),"navigation"===e?(t.isElement&&(t[e].prevEl.remove(),t[e].nextEl.remove()),h[e].prevEl=void 0,h[e].nextEl=void 0,t[e].prevEl=void 0,t[e].nextEl=void 0):(t.isElement&&t[e].el.remove(),h[e].el=void 0,t[e].el=void 0))};r.includes("loop")&&t.isElement&&(h.loop&&!n.loop?x=!0:!h.loop&&n.loop?w=!0:S=!0),c.forEach((e=>{if(tr(h[e])&&tr(n[e]))Object.assign(h[e],n[e]),"navigation"!==e&&"pagination"!==e&&"scrollbar"!==e||!("enabled"in n[e])||n[e].enabled||_(e);else{const t=n[e];!0!==t&&!1!==t||"navigation"!==e&&"pagination"!==e&&"scrollbar"!==e?h[e]=n[e]:!1===t&&_(e)}})),c.includes("controller")&&!v&&t.controller&&t.controller.control&&h.controller&&h.controller.control&&(t.controller.control=h.controller.control),r.includes("children")&&i&&f&&h.virtual.enabled?(f.slides=i,f.update(!0)):r.includes("virtual")&&f&&h.virtual.enabled&&(i&&(f.slides=i),f.update(!0)),r.includes("children")&&i&&h.loop&&(S=!0),g&&m.init()&&m.update(!0);v&&(t.controller.control=h.controller.control),y&&(!t.isElement||l&&"string"!==typeof l||(l=document.createElement("div"),l.classList.add("swiper-pagination"),l.part.add("pagination"),t.el.appendChild(l)),l&&(h.pagination.el=l),d.init(),d.render(),d.update()),b&&(!t.isElement||o&&"string"!==typeof o||(o=document.createElement("div"),o.classList.add("swiper-scrollbar"),o.part.add("scrollbar"),t.el.appendChild(o)),o&&(h.scrollbar.el=o),p.init(),p.updateSize(),p.setTranslate()),A&&(t.isElement&&(s&&"string"!==typeof s||(s=document.createElement("div"),s.classList.add("swiper-button-next"),s.innerHTML=t.hostEl.constructor.nextButtonSvg,s.part.add("button-next"),t.el.appendChild(s)),a&&"string"!==typeof a||(a=document.createElement("div"),a.classList.add("swiper-button-prev"),a.innerHTML=t.hostEl.constructor.prevButtonSvg,a.part.add("button-prev"),t.el.appendChild(a))),s&&(h.navigation.nextEl=s),a&&(h.navigation.prevEl=a),u.init(),u.update()),r.includes("allowSlideNext")&&(t.allowSlideNext=n.allowSlideNext),r.includes("allowSlidePrev")&&(t.allowSlidePrev=n.allowSlidePrev),r.includes("direction")&&t.changeDirection(n.direction,!1),(x||S)&&t.loopDestroy(),(w||S)&&t.loopCreate(),t.update()}({swiper:y.current,slides:I,passedParams:C,changedParams:e,nextEl:x.current,prevEl:w.current,scrollbarEl:_.current,paginationEl:S.current}),()=>{T&&y.current&&Object.keys(T).forEach((e=>{y.current.off(e,T[e])}))}})),ur((()=>{(e=>{!e||e.destroyed||!e.params.virtual||e.params.virtual&&!e.params.virtual.enabled||(e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.parallax&&e.params.parallax&&e.params.parallax.enabled&&e.parallax.setTranslate())})(y.current)}),[u]),n.createElement(r,lr({ref:v,className:ar(`${h}${i?` ${i}`:""}`)},M),n.createElement(fr.Provider,{value:y.current},P["container-start"],n.createElement(s,{className:or(E.wrapperClass)},P["wrapper-start"],E.virtual?function(e,t,i){if(!i)return null;const r=e=>{let i=e;return e<0?i=t.length+e:i>=t.length&&(i-=t.length),i},s=e.isHorizontal()?{[e.rtlTranslate?"right":"left"]:`${i.offset}px`}:{top:`${i.offset}px`},{from:a,to:o}=i,l=e.params.loop?-t.length:0,c=e.params.loop?2*t.length:t.length,h=[];for(let n=l;n<c;n+=1)n>=a&&n<=o&&h.push(t[r(n)]);return h.map(((t,i)=>n.cloneElement(t,{swiper:e,style:s,key:t.props.virtualIndex||t.key||`slide-${i}`})))}(y.current,I,u):I.map(((e,t)=>n.cloneElement(e,{swiper:y.current,swiperSlideIndex:t}))),P["wrapper-end"]),nr(E)&&n.createElement(n.Fragment,null,n.createElement("div",{ref:w,className:"swiper-button-prev"}),n.createElement("div",{ref:x,className:"swiper-button-next"})),sr(E)&&n.createElement("div",{ref:_,className:"swiper-scrollbar"}),rr(E)&&n.createElement("div",{ref:S,className:"swiper-pagination"}),P["container-end"]))}));mr.displayName="Swiper";const gr=(0,n.forwardRef)((function(e,t){let{tag:i="div",children:r,className:s="",swiper:a,zoom:o,lazy:l,virtualIndex:c,swiperSlideIndex:h,...d}=void 0===e?{}:e;const u=(0,n.useRef)(null),[p,f]=(0,n.useState)("swiper-slide"),[m,g]=(0,n.useState)(!1);function v(e,t,i){t===u.current&&f(i)}ur((()=>{if("undefined"!==typeof h&&(u.current.swiperSlideIndex=h),t&&(t.current=u.current),u.current&&a){if(!a.destroyed)return a.on("_slideClass",v),()=>{a&&a.off("_slideClass",v)};"swiper-slide"!==p&&f("swiper-slide")}})),ur((()=>{a&&u.current&&!a.destroyed&&f(a.getSlideClasses(u.current))}),[a]);const y={isActive:p.indexOf("swiper-slide-active")>=0,isVisible:p.indexOf("swiper-slide-visible")>=0,isPrev:p.indexOf("swiper-slide-prev")>=0,isNext:p.indexOf("swiper-slide-next")>=0},b=()=>"function"===typeof r?r(y):r;return n.createElement(i,lr({ref:u,className:ar(`${p}${s?` ${s}`:""}`),"data-swiper-slide-index":c,onLoad:()=>{g(!0)}},d),o&&n.createElement(pr.Provider,{value:y},n.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":"number"===typeof o?o:void 0},b(),l&&!m&&n.createElement("div",{className:"swiper-lazy-preloader"}))),!o&&n.createElement(pr.Provider,{value:y},b(),l&&!m&&n.createElement("div",{className:"swiper-lazy-preloader"})))}));function vr(e,t,i,n){return e.params.createElements&&Object.keys(n).forEach((r=>{if(!i[r]&&!0===i.auto){let s=on(e.el,`.${n[r]}`)[0];s||(s=cn("div",n[r]),s.className=n[r],e.el.append(s)),i[r]=s,t[r]=s}})),i}function yr(e){let{swiper:t,extendParams:i,on:n,emit:r}=e;function s(e){let i;return e&&"string"===typeof e&&t.isElement&&(i=t.el.querySelector(e),i)?i:(e&&("string"===typeof e&&(i=[...document.querySelectorAll(e)]),t.params.uniqueNavElements&&"string"===typeof e&&i&&i.length>1&&1===t.el.querySelectorAll(e).length?i=t.el.querySelector(e):i&&1===i.length&&(i=i[0])),e&&!i?e:i)}function a(e,i){const n=t.params.navigation;(e=fn(e)).forEach((e=>{e&&(e.classList[i?"add":"remove"](...n.disabledClass.split(" ")),"BUTTON"===e.tagName&&(e.disabled=i),t.params.watchOverflow&&t.enabled&&e.classList[t.isLocked?"add":"remove"](n.lockClass))}))}function o(){const{nextEl:e,prevEl:i}=t.navigation;if(t.params.loop)return a(i,!1),void a(e,!1);a(i,t.isBeginning&&!t.params.rewind),a(e,t.isEnd&&!t.params.rewind)}function l(e){e.preventDefault(),(!t.isBeginning||t.params.loop||t.params.rewind)&&(t.slidePrev(),r("navigationPrev"))}function c(e){e.preventDefault(),(!t.isEnd||t.params.loop||t.params.rewind)&&(t.slideNext(),r("navigationNext"))}function h(){const e=t.params.navigation;if(t.params.navigation=vr(t,t.originalParams.navigation,t.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!e.nextEl&&!e.prevEl)return;let i=s(e.nextEl),n=s(e.prevEl);Object.assign(t.navigation,{nextEl:i,prevEl:n}),i=fn(i),n=fn(n);const r=(i,n)=>{i&&i.addEventListener("click","next"===n?c:l),!t.enabled&&i&&i.classList.add(...e.lockClass.split(" "))};i.forEach((e=>r(e,"next"))),n.forEach((e=>r(e,"prev")))}function d(){let{nextEl:e,prevEl:i}=t.navigation;e=fn(e),i=fn(i);const n=(e,i)=>{e.removeEventListener("click","next"===i?c:l),e.classList.remove(...t.params.navigation.disabledClass.split(" "))};e.forEach((e=>n(e,"next"))),i.forEach((e=>n(e,"prev")))}i({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),t.navigation={nextEl:null,prevEl:null},n("init",(()=>{!1===t.params.navigation.enabled?u():(h(),o())})),n("toEdge fromEdge lock unlock",(()=>{o()})),n("destroy",(()=>{d()})),n("enable disable",(()=>{let{nextEl:e,prevEl:i}=t.navigation;e=fn(e),i=fn(i),t.enabled?o():[...e,...i].filter((e=>!!e)).forEach((e=>e.classList.add(t.params.navigation.lockClass)))})),n("click",((e,i)=>{let{nextEl:n,prevEl:s}=t.navigation;n=fn(n),s=fn(s);const a=i.target;let o=s.includes(a)||n.includes(a);if(t.isElement&&!o){const e=i.path||i.composedPath&&i.composedPath();e&&(o=e.find((e=>n.includes(e)||s.includes(e))))}if(t.params.navigation.hideOnClick&&!o){if(t.pagination&&t.params.pagination&&t.params.pagination.clickable&&(t.pagination.el===a||t.pagination.el.contains(a)))return;let e;n.length?e=n[0].classList.contains(t.params.navigation.hiddenClass):s.length&&(e=s[0].classList.contains(t.params.navigation.hiddenClass)),r(!0===e?"navigationShow":"navigationHide"),[...n,...s].filter((e=>!!e)).forEach((e=>e.classList.toggle(t.params.navigation.hiddenClass)))}}));const u=()=>{t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")),d()};Object.assign(t.navigation,{enable:()=>{t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")),h(),o()},disable:u,update:o,init:h,destroy:d})}function br(e){return void 0===e&&(e=""),`.${e.trim().replace(/([\.:!+\/])/g,"\\$1").replace(/ /g,".")}`}function Ar(e){let{swiper:t,extendParams:i,on:n,emit:r}=e;const s="swiper-pagination";let a;i({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:e=>e,formatFractionTotal:e=>e,bulletClass:`${s}-bullet`,bulletActiveClass:`${s}-bullet-active`,modifierClass:`${s}-`,currentClass:`${s}-current`,totalClass:`${s}-total`,hiddenClass:`${s}-hidden`,progressbarFillClass:`${s}-progressbar-fill`,progressbarOppositeClass:`${s}-progressbar-opposite`,clickableClass:`${s}-clickable`,lockClass:`${s}-lock`,horizontalClass:`${s}-horizontal`,verticalClass:`${s}-vertical`,paginationDisabledClass:`${s}-disabled`}}),t.pagination={el:null,bullets:[]};let o=0;function l(){return!t.params.pagination.el||!t.pagination.el||Array.isArray(t.pagination.el)&&0===t.pagination.el.length}function c(e,i){const{bulletActiveClass:n}=t.params.pagination;e&&(e=e[("prev"===i?"previous":"next")+"ElementSibling"])&&(e.classList.add(`${n}-${i}`),(e=e[("prev"===i?"previous":"next")+"ElementSibling"])&&e.classList.add(`${n}-${i}-${i}`))}function h(e){const i=e.target.closest(br(t.params.pagination.bulletClass));if(!i)return;e.preventDefault();const n=dn(i)*t.params.slidesPerGroup;if(t.params.loop){if(t.realIndex===n)return;const e=(r=t.realIndex,s=n,a=t.slides.length,(s%=a)===1+(r%=a)?"next":s===r-1?"previous":void 0);"next"===e?t.slideNext():"previous"===e?t.slidePrev():t.slideToLoop(n)}else t.slideTo(n);var r,s,a}function d(){const e=t.rtl,i=t.params.pagination;if(l())return;let n,s,h=t.pagination.el;h=fn(h);const d=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.slides.length,u=t.params.loop?Math.ceil(d/t.params.slidesPerGroup):t.snapGrid.length;if(t.params.loop?(s=t.previousRealIndex||0,n=t.params.slidesPerGroup>1?Math.floor(t.realIndex/t.params.slidesPerGroup):t.realIndex):"undefined"!==typeof t.snapIndex?(n=t.snapIndex,s=t.previousSnapIndex):(s=t.previousIndex||0,n=t.activeIndex||0),"bullets"===i.type&&t.pagination.bullets&&t.pagination.bullets.length>0){const r=t.pagination.bullets;let l,d,u;if(i.dynamicBullets&&(a=pn(r[0],t.isHorizontal()?"width":"height",!0),h.forEach((e=>{e.style[t.isHorizontal()?"width":"height"]=a*(i.dynamicMainBullets+4)+"px"})),i.dynamicMainBullets>1&&void 0!==s&&(o+=n-(s||0),o>i.dynamicMainBullets-1?o=i.dynamicMainBullets-1:o<0&&(o=0)),l=Math.max(n-o,0),d=l+(Math.min(r.length,i.dynamicMainBullets)-1),u=(d+l)/2),r.forEach((e=>{const t=[...["","-next","-next-next","-prev","-prev-prev","-main"].map((e=>`${i.bulletActiveClass}${e}`))].map((e=>"string"===typeof e&&e.includes(" ")?e.split(" "):e)).flat();e.classList.remove(...t)})),h.length>1)r.forEach((e=>{const r=dn(e);r===n?e.classList.add(...i.bulletActiveClass.split(" ")):t.isElement&&e.setAttribute("part","bullet"),i.dynamicBullets&&(r>=l&&r<=d&&e.classList.add(...`${i.bulletActiveClass}-main`.split(" ")),r===l&&c(e,"prev"),r===d&&c(e,"next"))}));else{const e=r[n];if(e&&e.classList.add(...i.bulletActiveClass.split(" ")),t.isElement&&r.forEach(((e,t)=>{e.setAttribute("part",t===n?"bullet-active":"bullet")})),i.dynamicBullets){const e=r[l],t=r[d];for(let n=l;n<=d;n+=1)r[n]&&r[n].classList.add(...`${i.bulletActiveClass}-main`.split(" "));c(e,"prev"),c(t,"next")}}if(i.dynamicBullets){const n=Math.min(r.length,i.dynamicMainBullets+4),s=(a*n-a)/2-u*a,o=e?"right":"left";r.forEach((e=>{e.style[t.isHorizontal()?o:"top"]=`${s}px`}))}}h.forEach(((e,s)=>{if("fraction"===i.type&&(e.querySelectorAll(br(i.currentClass)).forEach((e=>{e.textContent=i.formatFractionCurrent(n+1)})),e.querySelectorAll(br(i.totalClass)).forEach((e=>{e.textContent=i.formatFractionTotal(u)}))),"progressbar"===i.type){let r;r=i.progressbarOpposite?t.isHorizontal()?"vertical":"horizontal":t.isHorizontal()?"horizontal":"vertical";const s=(n+1)/u;let a=1,o=1;"horizontal"===r?a=s:o=s,e.querySelectorAll(br(i.progressbarFillClass)).forEach((e=>{e.style.transform=`translate3d(0,0,0) scaleX(${a}) scaleY(${o})`,e.style.transitionDuration=`${t.params.speed}ms`}))}"custom"===i.type&&i.renderCustom?(e.innerHTML=i.renderCustom(t,n+1,u),0===s&&r("paginationRender",e)):(0===s&&r("paginationRender",e),r("paginationUpdate",e)),t.params.watchOverflow&&t.enabled&&e.classList[t.isLocked?"add":"remove"](i.lockClass)}))}function u(){const e=t.params.pagination;if(l())return;const i=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.grid&&t.params.grid.rows>1?t.slides.length/Math.ceil(t.params.grid.rows):t.slides.length;let n=t.pagination.el;n=fn(n);let s="";if("bullets"===e.type){let n=t.params.loop?Math.ceil(i/t.params.slidesPerGroup):t.snapGrid.length;t.params.freeMode&&t.params.freeMode.enabled&&n>i&&(n=i);for(let i=0;i<n;i+=1)e.renderBullet?s+=e.renderBullet.call(t,i,e.bulletClass):s+=`<${e.bulletElement} ${t.isElement?'part="bullet"':""} class="${e.bulletClass}"></${e.bulletElement}>`}"fraction"===e.type&&(s=e.renderFraction?e.renderFraction.call(t,e.currentClass,e.totalClass):`<span class="${e.currentClass}"></span> / <span class="${e.totalClass}"></span>`),"progressbar"===e.type&&(s=e.renderProgressbar?e.renderProgressbar.call(t,e.progressbarFillClass):`<span class="${e.progressbarFillClass}"></span>`),t.pagination.bullets=[],n.forEach((i=>{"custom"!==e.type&&(i.innerHTML=s||""),"bullets"===e.type&&t.pagination.bullets.push(...i.querySelectorAll(br(e.bulletClass)))})),"custom"!==e.type&&r("paginationRender",n[0])}function p(){t.params.pagination=vr(t,t.originalParams.pagination,t.params.pagination,{el:"swiper-pagination"});const e=t.params.pagination;if(!e.el)return;let i;"string"===typeof e.el&&t.isElement&&(i=t.el.querySelector(e.el)),i||"string"!==typeof e.el||(i=[...document.querySelectorAll(e.el)]),i||(i=e.el),i&&0!==i.length&&(t.params.uniqueNavElements&&"string"===typeof e.el&&Array.isArray(i)&&i.length>1&&(i=[...t.el.querySelectorAll(e.el)],i.length>1&&(i=i.filter((e=>un(e,".swiper")[0]===t.el))[0])),Array.isArray(i)&&1===i.length&&(i=i[0]),Object.assign(t.pagination,{el:i}),i=fn(i),i.forEach((i=>{"bullets"===e.type&&e.clickable&&i.classList.add(...(e.clickableClass||"").split(" ")),i.classList.add(e.modifierClass+e.type),i.classList.add(t.isHorizontal()?e.horizontalClass:e.verticalClass),"bullets"===e.type&&e.dynamicBullets&&(i.classList.add(`${e.modifierClass}${e.type}-dynamic`),o=0,e.dynamicMainBullets<1&&(e.dynamicMainBullets=1)),"progressbar"===e.type&&e.progressbarOpposite&&i.classList.add(e.progressbarOppositeClass),e.clickable&&i.addEventListener("click",h),t.enabled||i.classList.add(e.lockClass)})))}function f(){const e=t.params.pagination;if(l())return;let i=t.pagination.el;i&&(i=fn(i),i.forEach((i=>{i.classList.remove(e.hiddenClass),i.classList.remove(e.modifierClass+e.type),i.classList.remove(t.isHorizontal()?e.horizontalClass:e.verticalClass),e.clickable&&(i.classList.remove(...(e.clickableClass||"").split(" ")),i.removeEventListener("click",h))}))),t.pagination.bullets&&t.pagination.bullets.forEach((t=>t.classList.remove(...e.bulletActiveClass.split(" "))))}n("changeDirection",(()=>{if(!t.pagination||!t.pagination.el)return;const e=t.params.pagination;let{el:i}=t.pagination;i=fn(i),i.forEach((i=>{i.classList.remove(e.horizontalClass,e.verticalClass),i.classList.add(t.isHorizontal()?e.horizontalClass:e.verticalClass)}))})),n("init",(()=>{!1===t.params.pagination.enabled?m():(p(),u(),d())})),n("activeIndexChange",(()=>{"undefined"===typeof t.snapIndex&&d()})),n("snapIndexChange",(()=>{d()})),n("snapGridLengthChange",(()=>{u(),d()})),n("destroy",(()=>{f()})),n("enable disable",(()=>{let{el:e}=t.pagination;e&&(e=fn(e),e.forEach((e=>e.classList[t.enabled?"remove":"add"](t.params.pagination.lockClass))))})),n("lock unlock",(()=>{d()})),n("click",((e,i)=>{const n=i.target,s=fn(t.pagination.el);if(t.params.pagination.el&&t.params.pagination.hideOnClick&&s&&s.length>0&&!n.classList.contains(t.params.pagination.bulletClass)){if(t.navigation&&(t.navigation.nextEl&&n===t.navigation.nextEl||t.navigation.prevEl&&n===t.navigation.prevEl))return;const e=s[0].classList.contains(t.params.pagination.hiddenClass);r(!0===e?"paginationShow":"paginationHide"),s.forEach((e=>e.classList.toggle(t.params.pagination.hiddenClass)))}}));const m=()=>{t.el.classList.add(t.params.pagination.paginationDisabledClass);let{el:e}=t.pagination;e&&(e=fn(e),e.forEach((e=>e.classList.add(t.params.pagination.paginationDisabledClass)))),f()};Object.assign(t.pagination,{enable:()=>{t.el.classList.remove(t.params.pagination.paginationDisabledClass);let{el:e}=t.pagination;e&&(e=fn(e),e.forEach((e=>e.classList.remove(t.params.pagination.paginationDisabledClass)))),p(),u(),d()},disable:m,render:u,update:d,init:p,destroy:f})}function xr(e){let t,i,{swiper:n,extendParams:r,on:s,emit:a,params:o}=e;n.autoplay={running:!1,paused:!1,timeLeft:0},r({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!1,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let l,c,h,d,u,p,f,m,g=o&&o.autoplay?o.autoplay.delay:3e3,v=o&&o.autoplay?o.autoplay.delay:3e3,y=(new Date).getTime();function b(e){n&&!n.destroyed&&n.wrapperEl&&e.target===n.wrapperEl&&(n.wrapperEl.removeEventListener("transitionend",b),m||e.detail&&e.detail.bySwiperTouchMove||E())}const A=()=>{if(n.destroyed||!n.autoplay.running)return;n.autoplay.paused?c=!0:c&&(v=l,c=!1);const e=n.autoplay.paused?l:y+v-(new Date).getTime();n.autoplay.timeLeft=e,a("autoplayTimeLeft",e,e/g),i=requestAnimationFrame((()=>{A()}))},x=e=>{if(n.destroyed||!n.autoplay.running)return;cancelAnimationFrame(i),A();let r="undefined"===typeof e?n.params.autoplay.delay:e;g=n.params.autoplay.delay,v=n.params.autoplay.delay;const s=(()=>{let e;if(e=n.virtual&&n.params.virtual.enabled?n.slides.filter((e=>e.classList.contains("swiper-slide-active")))[0]:n.slides[n.activeIndex],!e)return;return parseInt(e.getAttribute("data-swiper-autoplay"),10)})();!Number.isNaN(s)&&s>0&&"undefined"===typeof e&&(r=s,g=s,v=s),l=r;const o=n.params.speed,c=()=>{n&&!n.destroyed&&(n.params.autoplay.reverseDirection?!n.isBeginning||n.params.loop||n.params.rewind?(n.slidePrev(o,!0,!0),a("autoplay")):n.params.autoplay.stopOnLastSlide||(n.slideTo(n.slides.length-1,o,!0,!0),a("autoplay")):!n.isEnd||n.params.loop||n.params.rewind?(n.slideNext(o,!0,!0),a("autoplay")):n.params.autoplay.stopOnLastSlide||(n.slideTo(0,o,!0,!0),a("autoplay")),n.params.cssMode&&(y=(new Date).getTime(),requestAnimationFrame((()=>{x()}))))};return r>0?(clearTimeout(t),t=setTimeout((()=>{c()}),r)):requestAnimationFrame((()=>{c()})),r},w=()=>{y=(new Date).getTime(),n.autoplay.running=!0,x(),a("autoplayStart")},S=()=>{n.autoplay.running=!1,clearTimeout(t),cancelAnimationFrame(i),a("autoplayStop")},_=(e,i)=>{if(n.destroyed||!n.autoplay.running)return;clearTimeout(t),e||(f=!0);const r=()=>{a("autoplayPause"),n.params.autoplay.waitForTransition?n.wrapperEl.addEventListener("transitionend",b):E()};if(n.autoplay.paused=!0,i)return p&&(l=n.params.autoplay.delay),p=!1,void r();const s=l||n.params.autoplay.delay;l=s-((new Date).getTime()-y),n.isEnd&&l<0&&!n.params.loop||(l<0&&(l=0),r())},E=()=>{n.isEnd&&l<0&&!n.params.loop||n.destroyed||!n.autoplay.running||(y=(new Date).getTime(),f?(f=!1,x(l)):x(),n.autoplay.paused=!1,a("autoplayResume"))},C=()=>{if(n.destroyed||!n.autoplay.running)return;const e=Yi();"hidden"===e.visibilityState&&(f=!0,_(!0)),"visible"===e.visibilityState&&E()},M=e=>{"mouse"===e.pointerType&&(f=!0,m=!0,n.animating||n.autoplay.paused||_(!0))},T=e=>{"mouse"===e.pointerType&&(m=!1,n.autoplay.paused&&E())};s("init",(()=>{n.params.autoplay.enabled&&(n.params.autoplay.pauseOnMouseEnter&&(n.el.addEventListener("pointerenter",M),n.el.addEventListener("pointerleave",T)),Yi().addEventListener("visibilitychange",C),w())})),s("destroy",(()=>{n.el&&"string"!==typeof n.el&&(n.el.removeEventListener("pointerenter",M),n.el.removeEventListener("pointerleave",T)),Yi().removeEventListener("visibilitychange",C),n.autoplay.running&&S()})),s("_freeModeStaticRelease",(()=>{(d||f)&&E()})),s("_freeModeNoMomentumRelease",(()=>{n.params.autoplay.disableOnInteraction?S():_(!0,!0)})),s("beforeTransitionStart",((e,t,i)=>{!n.destroyed&&n.autoplay.running&&(i||!n.params.autoplay.disableOnInteraction?_(!0,!0):S())})),s("sliderFirstMove",(()=>{!n.destroyed&&n.autoplay.running&&(n.params.autoplay.disableOnInteraction?S():(h=!0,d=!1,f=!1,u=setTimeout((()=>{f=!0,d=!0,_(!0)}),200)))})),s("touchEnd",(()=>{if(!n.destroyed&&n.autoplay.running&&h){if(clearTimeout(u),clearTimeout(t),n.params.autoplay.disableOnInteraction)return d=!1,void(h=!1);d&&n.params.cssMode&&E(),d=!1,h=!1}})),s("slideChange",(()=>{!n.destroyed&&n.autoplay.running&&(p=!0)})),Object.assign(n.autoplay,{start:w,stop:S,pause:_,resume:E})}function wr(e,t){const i=an(t);return i!==t&&(i.style.backfaceVisibility="hidden",i.style["-webkit-backface-visibility"]="hidden"),i}function Sr(e,t,i){const n=`swiper-slide-shadow${i?`-${i}`:""}${e?` swiper-slide-shadow-${e}`:""}`,r=an(t);let s=r.querySelector(`.${n.split(" ").join(".")}`);return s||(s=cn("div",n.split(" ")),r.append(s)),s}function _r(e){let{swiper:t,extendParams:i,on:n}=e;i({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}});!function(e){const{effect:t,swiper:i,on:n,setTranslate:r,setTransition:s,overwriteParams:a,perspective:o,recreateShadows:l,getEffectParams:c}=e;let h;n("beforeInit",(()=>{if(i.params.effect!==t)return;i.classNames.push(`${i.params.containerModifierClass}${t}`),o&&o()&&i.classNames.push(`${i.params.containerModifierClass}3d`);const e=a?a():{};Object.assign(i.params,e),Object.assign(i.originalParams,e)})),n("setTranslate",(()=>{i.params.effect===t&&r()})),n("setTransition",((e,n)=>{i.params.effect===t&&s(n)})),n("transitionEnd",(()=>{if(i.params.effect===t&&l){if(!c||!c().slideShadows)return;i.slides.forEach((e=>{e.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach((e=>e.remove()))})),l()}})),n("virtualUpdate",(()=>{i.params.effect===t&&(i.slides.length||(h=!0),requestAnimationFrame((()=>{h&&i.slides&&i.slides.length&&(r(),h=!1)})))}))}({effect:"coverflow",swiper:t,on:n,setTranslate:()=>{const{width:e,height:i,slides:n,slidesSizesGrid:r}=t,s=t.params.coverflowEffect,a=t.isHorizontal(),o=t.translate,l=a?e/2-o:i/2-o,c=a?s.rotate:-s.rotate,h=s.depth,d=function(e){return t=>Math.abs(t)>0&&e.browser&&e.browser.need3dFix&&Math.abs(t)%90===0?t+.001:t}(t);for(let t=0,u=n.length;t<u;t+=1){const e=n[t],i=r[t],o=(l-e.swiperSlideOffset-i/2)/i,u="function"===typeof s.modifier?s.modifier(o):o*s.modifier;let p=a?c*u:0,f=a?0:c*u,m=-h*Math.abs(u),g=s.stretch;"string"===typeof g&&-1!==g.indexOf("%")&&(g=parseFloat(s.stretch)/100*i);let v=a?0:g*u,y=a?g*u:0,b=1-(1-s.scale)*Math.abs(u);Math.abs(y)<.001&&(y=0),Math.abs(v)<.001&&(v=0),Math.abs(m)<.001&&(m=0),Math.abs(p)<.001&&(p=0),Math.abs(f)<.001&&(f=0),Math.abs(b)<.001&&(b=0);const A=`translate3d(${y}px,${v}px,${m}px)  rotateX(${d(f)}deg) rotateY(${d(p)}deg) scale(${b})`;if(wr(0,e).style.transform=A,e.style.zIndex=1-Math.abs(Math.round(u)),s.slideShadows){let t=a?e.querySelector(".swiper-slide-shadow-left"):e.querySelector(".swiper-slide-shadow-top"),i=a?e.querySelector(".swiper-slide-shadow-right"):e.querySelector(".swiper-slide-shadow-bottom");t||(t=Sr("coverflow",e,a?"left":"top")),i||(i=Sr("coverflow",e,a?"right":"bottom")),t&&(t.style.opacity=u>0?u:0),i&&(i.style.opacity=-u>0?-u:0)}}},setTransition:e=>{t.slides.map((e=>an(e))).forEach((t=>{t.style.transitionDuration=`${e}ms`,t.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach((t=>{t.style.transitionDuration=`${e}ms`}))}))},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}gr.displayName="SwiperSlide";const Er=i.p+"static/media/banner5.2e89766a7fdf7d98d1a6.png";var Cr=i(1188);const Mr={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"},Tr=n.createContext();const Ir=()=>{const e=n.useContext(Tr);return null!=e&&e};let Pr=0;const Dr=r["useId".toString()];function Rr(e){if(void 0!==Dr){const t=Dr();return null!=e?e:t}return function(e){const[t,i]=n.useState(e),r=e||t;return n.useEffect((()=>{null==t&&(Pr+=1,i(`mui-${Pr}`))}),[t]),r}(e)}const Br=Rr;function Lr(e){let{controlled:t,default:i,name:r,state:s="value"}=e;const{current:a}=n.useRef(void 0!==t),[o,l]=n.useState(i);return[a?t:o,n.useCallback((e=>{a||l(e)}),[])]}const Or=Lr;function Nr(e){return Yt("MuiSvgIcon",e)}Kt("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const kr=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],Fr=ut("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,"inherit"!==i.color&&t[`color${vi(i.color)}`],t[`fontSize${vi(i.fontSize)}`]]}})((e=>{let{theme:t,ownerState:i}=e;var n,r,s,a,o,l,c,h,d,u,p,f,m;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:i.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:null==(n=t.transitions)||null==(r=n.create)?void 0:r.call(n,"fill",{duration:null==(s=t.transitions)||null==(s=s.duration)?void 0:s.shorter}),fontSize:{inherit:"inherit",small:(null==(a=t.typography)||null==(o=a.pxToRem)?void 0:o.call(a,20))||"1.25rem",medium:(null==(l=t.typography)||null==(c=l.pxToRem)?void 0:c.call(l,24))||"1.5rem",large:(null==(h=t.typography)||null==(d=h.pxToRem)?void 0:d.call(h,35))||"2.1875rem"}[i.fontSize],color:null!=(u=null==(p=(t.vars||t).palette)||null==(p=p[i.color])?void 0:p.main)?u:{action:null==(f=(t.vars||t).palette)||null==(f=f.action)?void 0:f.active,disabled:null==(m=(t.vars||t).palette)||null==(m=m.action)?void 0:m.disabled,inherit:void 0}[i.color]}})),Ur=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiSvgIcon"}),{children:r,className:s,color:a="inherit",component:o="svg",fontSize:l="medium",htmlColor:c,inheritViewBox:h=!1,titleAccess:d,viewBox:u="0 0 24 24"}=i,p=(0,Ae.A)(i,kr),f=n.isValidElement(r)&&"svg"===r.type,m=(0,xe.A)({},i,{color:a,component:o,fontSize:l,instanceFontSize:e.fontSize,inheritViewBox:h,viewBox:u,hasSvgAsChild:f}),g={};h||(g.viewBox=u);const v=(e=>{const{color:t,fontSize:i,classes:n}=e;return Ee({root:["root","inherit"!==t&&`color${vi(t)}`,`fontSize${vi(i)}`]},Nr,n)})(m);return(0,ve.jsxs)(Fr,(0,xe.A)({as:o,className:Se(v.root,s),focusable:"false",color:c,"aria-hidden":!d||void 0,role:d?"img":void 0,ref:t},g,p,f&&r.props,{ownerState:m,children:[f?r.props.children:r,d?(0,ve.jsx)("title",{children:d}):null]}))}));Ur.muiName="SvgIcon";const zr=Ur;function jr(e,t){function i(i,n){return(0,ve.jsx)(zr,(0,xe.A)({"data-testid":`${t}Icon`,ref:n},i,{children:e}))}return i.muiName=zr.muiName,n.memo(n.forwardRef(i))}const Vr=jr((0,ve.jsx)("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Gr=jr((0,ve.jsx)("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function Hr(e){return Yt("MuiRating",e)}const Wr=Kt("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]),Qr=["value"],qr=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function Xr(e,t){if(null==e)return e;const i=Math.round(e/t)*t;return Number(i.toFixed(function(e){const t=e.toString().split(".")[1];return t?t.length:0}(t)))}const Yr=ut("span",{name:"MuiRating",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[{[`& .${Wr.visuallyHidden}`]:t.visuallyHidden},t.root,t[`size${vi(i.size)}`],i.readOnly&&t.readOnly]}})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({display:"inline-flex",position:"relative",fontSize:t.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",width:"min-content",WebkitTapHighlightColor:"transparent",[`&.${Wr.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${Wr.focusVisible} .${Wr.iconActive}`]:{outline:"1px solid #999"},[`& .${Wr.visuallyHidden}`]:Mr},"small"===i.size&&{fontSize:t.typography.pxToRem(18)},"large"===i.size&&{fontSize:t.typography.pxToRem(30)},i.readOnly&&{pointerEvents:"none"})})),Kr=ut("label",{name:"MuiRating",slot:"Label",overridesResolver:(e,t)=>{let{ownerState:i}=e;return[t.label,i.emptyValueFocused&&t.labelEmptyValueActive]}})((e=>{let{ownerState:t}=e;return(0,xe.A)({cursor:"inherit"},t.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})})),Jr=ut("span",{name:"MuiRating",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.icon,i.iconEmpty&&t.iconEmpty,i.iconFilled&&t.iconFilled,i.iconHover&&t.iconHover,i.iconFocus&&t.iconFocus,i.iconActive&&t.iconActive]}})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({display:"flex",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),pointerEvents:"none"},i.iconActive&&{transform:"scale(1.2)"},i.iconEmpty&&{color:(t.vars||t).palette.action.disabled})})),Zr=ut("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:e=>ht(e)&&"iconActive"!==e,overridesResolver:(e,t)=>{const{iconActive:i}=e;return[t.decimal,i&&t.iconActive]}})((e=>{let{iconActive:t}=e;return(0,xe.A)({position:"relative"},t&&{transform:"scale(1.2)"})}));function $r(e){const t=(0,Ae.A)(e,Qr);return(0,ve.jsx)("span",(0,xe.A)({},t))}function es(e){const{classes:t,disabled:i,emptyIcon:r,focus:s,getLabelText:a,highlightSelectedOnly:o,hover:l,icon:c,IconContainerComponent:h,isActive:d,itemValue:u,labelProps:p,name:f,onBlur:m,onChange:g,onClick:v,onFocus:y,readOnly:b,ownerState:A,ratingValue:x,ratingValueRounded:w}=e,S=o?u===x:u<=x,_=u<=l,E=u<=s,C=u===w,M=Br(),T=(0,ve.jsx)(Jr,{as:h,value:u,className:Se(t.icon,S?t.iconFilled:t.iconEmpty,_&&t.iconHover,E&&t.iconFocus,d&&t.iconActive),ownerState:(0,xe.A)({},A,{iconEmpty:!S,iconFilled:S,iconHover:_,iconFocus:E,iconActive:d}),children:r&&!S?r:c});return b?(0,ve.jsx)("span",(0,xe.A)({},p,{children:T})):(0,ve.jsxs)(n.Fragment,{children:[(0,ve.jsxs)(Kr,(0,xe.A)({ownerState:(0,xe.A)({},A,{emptyValueFocused:void 0}),htmlFor:M},p,{children:[T,(0,ve.jsx)("span",{className:t.visuallyHidden,children:a(u)})]})),(0,ve.jsx)("input",{className:t.visuallyHidden,onFocus:y,onBlur:m,onChange:g,onClick:v,disabled:i,value:u,id:M,type:"radio",name:f,checked:C})]})}const ts=(0,ve.jsx)(Vr,{fontSize:"inherit"}),is=(0,ve.jsx)(Gr,{fontSize:"inherit"});function ns(e){return`${e} Star${1!==e?"s":""}`}const rs=n.forwardRef((function(e,t){const i=mt({name:"MuiRating",props:e}),{className:r,defaultValue:s=null,disabled:a=!1,emptyIcon:o=is,emptyLabelText:l="Empty",getLabelText:c=ns,highlightSelectedOnly:h=!1,icon:d=ts,IconContainerComponent:u=$r,max:p=5,name:f,onChange:m,onChangeActive:g,onMouseLeave:v,onMouseMove:y,precision:b=1,readOnly:A=!1,size:x="medium",value:w}=i,S=(0,Ae.A)(i,qr),_=Br(f),[E,C]=Or({controlled:w,default:s,name:"Rating"}),M=Xr(E,b),T=Ir(),[{hover:I,focus:P},D]=n.useState({hover:-1,focus:-1});let R=M;-1!==I&&(R=I),-1!==P&&(R=P);const{isFocusVisibleRef:B,onBlur:L,onFocus:O,ref:N}=Lt(),[k,F]=n.useState(!1),U=n.useRef(),z=yt(N,U,t),j=e=>{let t=""===e.target.value?null:parseFloat(e.target.value);-1!==I&&(t=I),C(t),m&&m(e,t)},V=e=>{0===e.clientX&&0===e.clientY||(D({hover:-1,focus:-1}),C(null),m&&parseFloat(e.target.value)===M&&m(e,null))},G=e=>{O(e),!0===B.current&&F(!0);const t=parseFloat(e.target.value);D((e=>({hover:e.hover,focus:t})))},H=e=>{if(-1!==I)return;L(e),!1===B.current&&F(!1);D((e=>({hover:e.hover,focus:-1})))},[W,Q]=n.useState(!1),q=(0,xe.A)({},i,{defaultValue:s,disabled:a,emptyIcon:o,emptyLabelText:l,emptyValueFocused:W,focusVisible:k,getLabelText:c,icon:d,IconContainerComponent:u,max:p,precision:b,readOnly:A,size:x}),X=(e=>{const{classes:t,size:i,readOnly:n,disabled:r,emptyValueFocused:s,focusVisible:a}=e;return Ee({root:["root",`size${vi(i)}`,r&&"disabled",a&&"focusVisible",n&&"readOnly"],label:["label","pristine"],labelEmptyValue:[s&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]},Hr,t)})(q);return(0,ve.jsxs)(Yr,(0,xe.A)({ref:z,onMouseMove:e=>{y&&y(e);const t=U.current,{right:i,left:n,width:r}=t.getBoundingClientRect();let s;s=T?(i-e.clientX)/r:(e.clientX-n)/r;let a=Xr(p*s+b/2,b);a=(0,Cr.A)(a,b,p),D((e=>e.hover===a&&e.focus===a?e:{hover:a,focus:a})),F(!1),g&&I!==a&&g(e,a)},onMouseLeave:e=>{v&&v(e);D({hover:-1,focus:-1}),g&&-1!==I&&g(e,-1)},className:Se(X.root,r,A&&"MuiRating-readOnly"),ownerState:q,role:A?"img":null,"aria-label":A?c(R):null},S,{children:[Array.from(new Array(p)).map(((e,t)=>{const i=t+1,n={classes:X,disabled:a,emptyIcon:o,focus:P,getLabelText:c,highlightSelectedOnly:h,hover:I,icon:d,IconContainerComponent:u,name:_,onBlur:H,onChange:j,onClick:V,onFocus:G,ratingValue:R,ratingValueRounded:M,readOnly:A,ownerState:q},r=i===Math.ceil(R)&&(-1!==I||-1!==P);if(b<1){const e=Array.from(new Array(1/b));return(0,ve.jsx)(Zr,{className:Se(X.decimal,r&&X.iconActive),ownerState:q,iconActive:r,children:e.map(((t,r)=>{const s=Xr(i-1+(r+1)*b,b);return(0,ve.jsx)(es,(0,xe.A)({},n,{isActive:!1,itemValue:s,labelProps:{style:e.length-1===r?{}:{width:s===R?(r+1)*b*100+"%":"0%",overflow:"hidden",position:"absolute"}}}),s)}))},i)}return(0,ve.jsx)(es,(0,xe.A)({},n,{isActive:r,itemValue:i}),i)})),!A&&!a&&(0,ve.jsxs)(Kr,{className:Se(X.label,X.labelEmptyValue),ownerState:q,children:[(0,ve.jsx)("input",{className:X.visuallyHidden,value:"",id:`${_}-empty`,type:"radio",name:_,checked:null==M,onFocus:()=>Q(!0),onBlur:()=>Q(!1),onChange:j}),(0,ve.jsx)("span",{className:X.visuallyHidden,children:l})]})]}))})),ss=rs;function as(e){return Fi({tag:"svg",attr:{version:"1.1",viewBox:"0 0 17 17"},child:[{tag:"g",attr:{},child:[]},{tag:"path",attr:{d:"M15.996 11.352l0.004 4.648-4.649-0.004 0.001-1 2.94 0.003-5.792-5.791-5.792 5.792 2.94-0.003 0.001 1-4.649 0.003 0.004-4.649 1 0.001-0.003 2.939 5.792-5.791-5.792-5.792 0.003 2.939-1 0.001-0.004-4.648 4.649 0.004-0.001 1-2.94-0.003 5.792 5.792 5.792-5.792-2.94 0.003-0.001-1 4.649-0.004-0.004 4.649-1-0.001 0.003-2.939-5.792 5.791 5.792 5.792-0.003-2.939 1-0.001z"},child:[]}]})(e)}function os(e){return Fi({tag:"svg",attr:{version:"1.1",viewBox:"0 0 17 17"},child:[{tag:"g",attr:{},child:[]},{tag:"path",attr:{d:"M1 1h3v3h-3v-3zM5 4h3v-3h-3v3zM9 4h3v-3h-3v3zM13 1v3h3v-3h-3zM1 8h3v-3h-3v3zM5 8h3v-3h-3v3zM9 8h3v-3h-3v3zM13 8h3v-3h-3v3zM1 12h3v-3h-3v3zM5 12h3v-3h-3v3zM9 12h3v-3h-3v3zM13 12h3v-3h-3v3zM1 16h3v-3h-3v3zM5 16h3v-3h-3v3zM9 16h3v-3h-3v3zM13 16h3v-3h-3v3z"},child:[]}]})(e)}var ls=i(1906);const cs=()=>{const[e,t]=(0,n.useState)(null);return(0,ve.jsx)("section",{className:"homeCat",children:(0,ve.jsxs)("div",{className:"wrapper12",children:[(0,ve.jsx)("h1",{className:"h1",children:"Exclusive Selections"}),(0,ve.jsx)("div",{className:"cols1",children:[{id:1,title:"Lace Knit Sweater ",img:"https://m.media-amazon.com/images/I/71vpMVzDHeL._AC_UL480_FMwebp_QL65_.jpg",description:"A cozy intricately designed sweater with delicate lace knit patterns"},{id:2,title:"Wide-Leg Jeans ",img:"https://shop.simon.com/cdn/shop/files/dd02328c48504858aaa1e2b075ccd432_360x.jpg?v=1736986755",description:"Trendy high-waisted jeans with a relaxed, cropped wide-leg fit"},{id:3,title:"Oversized Sweater",img:"https://m.media-amazon.com/images/I/71NQoj51TjL._AC_UL480_FMwebp_QL65_.jpg",description:"A warm and stylish oversized sweater with a classic cable knit texture"},{id:4,title:"High-Waist Jeans ",img:"https://shop.simon.com/cdn/shop/files/ab66362739ec4b409e4dd858b38aa170_360x.jpg?v=1738976379",description:"Edgy high-rise jeans featuring distressed details for a casual-chic look"},{id:5,title:"Fitted Crop Top",img:"https://shop.simon.com/cdn/shop/files/56c715bdf1524617b6990d88376129f0_5bdc43d7-b728-4538-bf7c-1b0c1f4db692_360x.jpg?v=1723890956",description:"A sleek, modern co-ord set with a fitted top and flared bottoms"},{id:6,title:"Washed Denim Jeans",img:"https://shop.simon.com/cdn/shop/files/b2b4463412954fbcbed6ff42fac5447d_360x.jpg?v=1736992462",description:"Classic straight-leg jeans with a vintage-inspired washed denim finish"},{id:7,title:"Classic Denim Jacket",img:"https://m.media-amazon.com/images/I/91cSZAc9RNL._AC_UL480_FMwebp_QL65_.jpg",description:"A timeless, versatile denim jacket perfect for layering"},{id:8,title:"White Flared Pants",img:"https://m.media-amazon.com/images/I/61mj3-lPlxL._AC_UL480_FMwebp_QL65_.jpg",description:"Elegant high-rise white pants with a flattering flared silhouette"},{id:9,title:"Long-Sleeve Top",img:"https://shop.simon.com/cdn/shop/files/fbea434ad25a49c4a93da6c1441fae8e_360x.jpg?v=1737152330",description:"A chic wrap-style top with a soft ribbed texture"},{id:10,title:"Flare Pants",img:"https://shop.simon.com/cdn/shop/files/adb06ce27d6d4af980b44dafee049c37_360x.jpg?v=1736898281",description:"Vintage-style corduroy pants with a stylish flared leg"}].map((i=>(0,ve.jsx)("div",{className:"col1 "+(e===i.id?"hover":""),onMouseEnter:()=>t(i.id),onMouseLeave:()=>t(null),children:(0,ve.jsxs)("div",{className:"container1",children:[(0,ve.jsx)("div",{className:"front",style:{backgroundImage:`url(${i.img})`},children:(0,ve.jsxs)("div",{className:"inner",children:[(0,ve.jsx)("p",{children:i.title}),(0,ve.jsx)("span",{className:"subtitle",children:i.subtitle})]})}),(0,ve.jsx)("div",{className:"back",children:(0,ve.jsx)("div",{className:"inner",children:(0,ve.jsx)("p",{children:i.description})})})]})},i.id)))})]})})};const hs=function(e){return"string"===typeof e};const ds=function(e,t,i){return void 0===e||hs(e)?t:(0,xe.A)({},t,{ownerState:(0,xe.A)({},t.ownerState,i)})};const us=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(void 0===e)return{};const i={};return Object.keys(e).filter((i=>i.match(/^on[A-Z]/)&&"function"===typeof e[i]&&!t.includes(i))).forEach((t=>{i[t]=e[t]})),i};const ps=function(e){if(void 0===e)return{};const t={};return Object.keys(e).filter((t=>!(t.match(/^on[A-Z]/)&&"function"===typeof e[t]))).forEach((i=>{t[i]=e[i]})),t};const fs=function(e){const{getSlotProps:t,additionalProps:i,externalSlotProps:n,externalForwardedProps:r,className:s}=e;if(!t){const e=Se(null==i?void 0:i.className,s,null==r?void 0:r.className,null==n?void 0:n.className),t=(0,xe.A)({},null==i?void 0:i.style,null==r?void 0:r.style,null==n?void 0:n.style),a=(0,xe.A)({},i,r,n);return e.length>0&&(a.className=e),Object.keys(t).length>0&&(a.style=t),{props:a,internalRef:void 0}}const a=us((0,xe.A)({},r,n)),o=ps(n),l=ps(r),c=t(a),h=Se(null==c?void 0:c.className,null==i?void 0:i.className,s,null==r?void 0:r.className,null==n?void 0:n.className),d=(0,xe.A)({},null==c?void 0:c.style,null==i?void 0:i.style,null==r?void 0:r.style,null==n?void 0:n.style),u=(0,xe.A)({},c,i,l,o);return h.length>0&&(u.className=h),Object.keys(d).length>0&&(u.style=d),{props:u,internalRef:c.ref}};const ms=function(e,t,i){return"function"===typeof e?e(t,i):e},gs=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];const vs=function(e){var t;const{elementType:i,externalSlotProps:n,ownerState:r,skipResolvingSlotProps:s=!1}=e,a=(0,Ae.A)(e,gs),o=s?{}:ms(n,r),{props:l,internalRef:c}=fs((0,xe.A)({},a,{externalSlotProps:o})),h=vt(c,null==o?void 0:o.ref,null==(t=e.additionalProps)?void 0:t.ref);return ds(i,(0,xe.A)({},l,{ref:h}),r)};function ys(e){return e&&e.ownerDocument||document}const bs=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function As(e){const t=[],i=[];return Array.from(e.querySelectorAll(bs)).forEach(((e,n)=>{const r=function(e){const t=parseInt(e.getAttribute("tabindex")||"",10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}(e);-1!==r&&function(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;const t=t=>e.ownerDocument.querySelector(`input[type="radio"]${t}`);let i=t(`[name="${e.name}"]:checked`);return i||(i=t(`[name="${e.name}"]`)),i!==e}(e))}(e)&&(0===r?t.push(e):i.push({documentOrder:n,tabIndex:r,node:e}))})),i.sort(((e,t)=>e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex)).map((e=>e.node)).concat(t)}function xs(){return!0}const ws=function(e){const{children:t,disableAutoFocus:i=!1,disableEnforceFocus:r=!1,disableRestoreFocus:s=!1,getTabbable:a=As,isEnabled:o=xs,open:l}=e,c=n.useRef(!1),h=n.useRef(null),d=n.useRef(null),u=n.useRef(null),p=n.useRef(null),f=n.useRef(!1),m=n.useRef(null),g=vt(t.ref,m),v=n.useRef(null);n.useEffect((()=>{l&&m.current&&(f.current=!i)}),[i,l]),n.useEffect((()=>{if(!l||!m.current)return;const e=ys(m.current);return m.current.contains(e.activeElement)||(m.current.hasAttribute("tabIndex")||m.current.setAttribute("tabIndex","-1"),f.current&&m.current.focus()),()=>{s||(u.current&&u.current.focus&&(c.current=!0,u.current.focus()),u.current=null)}}),[l]),n.useEffect((()=>{if(!l||!m.current)return;const e=ys(m.current),t=t=>{v.current=t,!r&&o()&&"Tab"===t.key&&e.activeElement===m.current&&t.shiftKey&&(c.current=!0,d.current&&d.current.focus())},i=()=>{const t=m.current;if(null===t)return;if(!e.hasFocus()||!o()||c.current)return void(c.current=!1);if(t.contains(e.activeElement))return;if(r&&e.activeElement!==h.current&&e.activeElement!==d.current)return;if(e.activeElement!==p.current)p.current=null;else if(null!==p.current)return;if(!f.current)return;let i=[];if(e.activeElement!==h.current&&e.activeElement!==d.current||(i=a(m.current)),i.length>0){var n,s;const e=Boolean((null==(n=v.current)?void 0:n.shiftKey)&&"Tab"===(null==(s=v.current)?void 0:s.key)),t=i[0],r=i[i.length-1];"string"!==typeof t&&"string"!==typeof r&&(e?r.focus():t.focus())}else t.focus()};e.addEventListener("focusin",i),e.addEventListener("keydown",t,!0);const n=setInterval((()=>{e.activeElement&&"BODY"===e.activeElement.tagName&&i()}),50);return()=>{clearInterval(n),e.removeEventListener("focusin",i),e.removeEventListener("keydown",t,!0)}}),[i,r,s,o,l,a]);const y=e=>{null===u.current&&(u.current=e.relatedTarget),f.current=!0};return(0,ve.jsxs)(n.Fragment,{children:[(0,ve.jsx)("div",{tabIndex:l?0:-1,onFocus:y,ref:h,"data-testid":"sentinelStart"}),n.cloneElement(t,{ref:g,onFocus:e=>{null===u.current&&(u.current=e.relatedTarget),f.current=!0,p.current=e.target;const i=t.props.onFocus;i&&i(e)}}),(0,ve.jsx)("div",{tabIndex:l?0:-1,onFocus:y,ref:d,"data-testid":"sentinelEnd"})]})};var Ss=i(7950),_s=i.t(Ss,2);const Es=n.forwardRef((function(e,t){const{children:i,container:r,disablePortal:s=!1}=e,[a,o]=n.useState(null),l=vt(n.isValidElement(i)?i.ref:null,t);if(bt((()=>{s||o(function(e){return"function"===typeof e?e():e}(r)||document.body)}),[r,s]),bt((()=>{if(a&&!s)return gt(t,a),()=>{gt(t,null)}}),[t,a,s]),s){if(n.isValidElement(i)){const e={ref:l};return n.cloneElement(i,e)}return(0,ve.jsx)(n.Fragment,{children:i})}return(0,ve.jsx)(n.Fragment,{children:a?Ss.createPortal(i,a):a})})),Cs=!1;var Ms="unmounted",Ts="exited",Is="entering",Ps="entered",Ds="exiting",Rs=function(e){function t(t,i){var n;n=e.call(this,t,i)||this;var r,s=i&&!i.isMounting?t.enter:t.appear;return n.appearStatus=null,t.in?s?(r=Ts,n.appearStatus=Is):r=Ps:r=t.unmountOnExit||t.mountOnEnter?Ms:Ts,n.state={status:r},n.nextCallback=null,n}Nt(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===Ms?{status:Ts}:null};var i=t.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(e){var t=null;if(e!==this.props){var i=this.state.status;this.props.in?i!==Is&&i!==Ps&&(t=Is):i!==Is&&i!==Ps||(t=Ds)}this.updateStatus(!1,t)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var e,t,i,n=this.props.timeout;return e=t=i=n,null!=n&&"number"!==typeof n&&(e=n.exit,t=n.enter,i=void 0!==n.appear?n.appear:t),{exit:e,enter:t,appear:i}},i.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===Is){if(this.props.unmountOnExit||this.props.mountOnEnter){var i=this.props.nodeRef?this.props.nodeRef.current:Ss.findDOMNode(this);i&&function(e){e.scrollTop}(i)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Ts&&this.setState({status:Ms})},i.performEnter=function(e){var t=this,i=this.props.enter,n=this.context?this.context.isMounting:e,r=this.props.nodeRef?[n]:[Ss.findDOMNode(this),n],s=r[0],a=r[1],o=this.getTimeouts(),l=n?o.appear:o.enter;!e&&!i||Cs?this.safeSetState({status:Ps},(function(){t.props.onEntered(s)})):(this.props.onEnter(s,a),this.safeSetState({status:Is},(function(){t.props.onEntering(s,a),t.onTransitionEnd(l,(function(){t.safeSetState({status:Ps},(function(){t.props.onEntered(s,a)}))}))})))},i.performExit=function(){var e=this,t=this.props.exit,i=this.getTimeouts(),n=this.props.nodeRef?void 0:Ss.findDOMNode(this);t&&!Cs?(this.props.onExit(n),this.safeSetState({status:Ds},(function(){e.props.onExiting(n),e.onTransitionEnd(i.exit,(function(){e.safeSetState({status:Ts},(function(){e.props.onExited(n)}))}))}))):this.safeSetState({status:Ts},(function(){e.props.onExited(n)}))},i.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},i.setNextCallback=function(e){var t=this,i=!0;return this.nextCallback=function(n){i&&(i=!1,t.nextCallback=null,e(n))},this.nextCallback.cancel=function(){i=!1},this.nextCallback},i.onTransitionEnd=function(e,t){this.setNextCallback(t);var i=this.props.nodeRef?this.props.nodeRef.current:Ss.findDOMNode(this),n=null==e&&!this.props.addEndListener;if(i&&!n){if(this.props.addEndListener){var r=this.props.nodeRef?[this.nextCallback]:[i,this.nextCallback],s=r[0],a=r[1];this.props.addEndListener(s,a)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},i.render=function(){var e=this.state.status;if(e===Ms)return null;var t=this.props,i=t.children,r=(t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef,(0,Ae.A)(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return n.createElement(kt.Provider,{value:null},"function"===typeof i?i(e,r):n.cloneElement(n.Children.only(i),r))},t}(n.Component);function Bs(){}Rs.contextType=kt,Rs.propTypes={},Rs.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Bs,onEntering:Bs,onEntered:Bs,onExit:Bs,onExiting:Bs,onExited:Bs},Rs.UNMOUNTED=Ms,Rs.EXITED=Ts,Rs.ENTERING=Is,Rs.ENTERED=Ps,Rs.EXITING=Ds;const Ls=Rs;var Os=i(4575);const Ns=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=n.useContext(Os.T);return t&&(i=t,0!==Object.keys(i).length)?t:e;var i},ks=(0,Re.A)();const Fs=function(){return Ns(arguments.length>0&&void 0!==arguments[0]?arguments[0]:ks)};function Us(){const e=Fs(lt);return e[ct]||e}const zs=e=>e.scrollTop;function js(e,t){var i,n;const{timeout:r,easing:s,style:a={}}=e;return{duration:null!=(i=a.transitionDuration)?i:"number"===typeof r?r:r[t.mode]||0,easing:null!=(n=a.transitionTimingFunction)?n:"object"===typeof s?s[t.mode]:s,delay:a.transitionDelay}}const Vs=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],Gs={entering:{opacity:1},entered:{opacity:1}},Hs=n.forwardRef((function(e,t){const i=Us(),r={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{addEndListener:s,appear:a=!0,children:o,easing:l,in:c,onEnter:h,onEntered:d,onEntering:u,onExit:p,onExited:f,onExiting:m,style:g,timeout:v=r,TransitionComponent:y=Ls}=e,b=(0,Ae.A)(e,Vs),A=n.useRef(null),x=yt(A,o.ref,t),w=e=>t=>{if(e){const i=A.current;void 0===t?e(i):e(i,t)}},S=w(u),_=w(((e,t)=>{zs(e);const n=js({style:g,timeout:v,easing:l},{mode:"enter"});e.style.webkitTransition=i.transitions.create("opacity",n),e.style.transition=i.transitions.create("opacity",n),h&&h(e,t)})),E=w(d),C=w(m),M=w((e=>{const t=js({style:g,timeout:v,easing:l},{mode:"exit"});e.style.webkitTransition=i.transitions.create("opacity",t),e.style.transition=i.transitions.create("opacity",t),p&&p(e)})),T=w(f);return(0,ve.jsx)(y,(0,xe.A)({appear:a,in:c,nodeRef:A,onEnter:_,onEntered:E,onEntering:S,onExit:M,onExited:T,onExiting:C,addEndListener:e=>{s&&s(A.current,e)},timeout:v},b,{children:(e,t)=>n.cloneElement(o,(0,xe.A)({style:(0,xe.A)({opacity:0,visibility:"exited"!==e||c?void 0:"hidden"},Gs[e],g,o.props.style),ref:x},t))}))})),Ws=Hs;function Qs(e){return Yt("MuiBackdrop",e)}Kt("MuiBackdrop",["root","invisible"]);const qs=["children","className","component","components","componentsProps","invisible","open","slotProps","slots","TransitionComponent","transitionDuration"],Xs=ut("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.invisible&&t.invisible]}})((e=>{let{ownerState:t}=e;return(0,xe.A)({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},t.invisible&&{backgroundColor:"transparent"})})),Ys=n.forwardRef((function(e,t){var i,n,r;const s=mt({props:e,name:"MuiBackdrop"}),{children:a,className:o,component:l="div",components:c={},componentsProps:h={},invisible:d=!1,open:u,slotProps:p={},slots:f={},TransitionComponent:m=Ws,transitionDuration:g}=s,v=(0,Ae.A)(s,qs),y=(0,xe.A)({},s,{component:l,invisible:d}),b=(e=>{const{classes:t,invisible:i}=e;return Ee({root:["root",i&&"invisible"]},Qs,t)})(y),A=null!=(i=p.root)?i:h.root;return(0,ve.jsx)(m,(0,xe.A)({in:u,timeout:g},v,{children:(0,ve.jsx)(Xs,(0,xe.A)({"aria-hidden":!0},A,{as:null!=(n=null!=(r=f.root)?r:c.Root)?n:l,className:Se(b.root,o,null==A?void 0:A.className),ownerState:(0,xe.A)({},y,null==A?void 0:A.ownerState),classes:b,ref:t,children:a}))}))})),Ks=Ys;function Js(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.reduce(((e,t)=>null==t?e:function(){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];e.apply(this,n),t.apply(this,n)}),(()=>{}))}function Zs(e){return ys(e).defaultView||window}function $s(e){const t=e.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}function ea(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function ta(e){return parseInt(Zs(e).getComputedStyle(e).paddingRight,10)||0}function ia(e,t,i,n,r){const s=[t,i,...n];[].forEach.call(e.children,(e=>{const t=-1===s.indexOf(e),i=!function(e){const t=-1!==["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(e.tagName),i="INPUT"===e.tagName&&"hidden"===e.getAttribute("type");return t||i}(e);t&&i&&ea(e,r)}))}function na(e,t){let i=-1;return e.some(((e,n)=>!!t(e)&&(i=n,!0))),i}function ra(e,t){const i=[],n=e.container;if(!t.disableScrollLock){if(function(e){const t=ys(e);return t.body===e?Zs(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}(n)){const e=$s(ys(n));i.push({value:n.style.paddingRight,property:"padding-right",el:n}),n.style.paddingRight=`${ta(n)+e}px`;const t=ys(n).querySelectorAll(".mui-fixed");[].forEach.call(t,(t=>{i.push({value:t.style.paddingRight,property:"padding-right",el:t}),t.style.paddingRight=`${ta(t)+e}px`}))}let e;if(n.parentNode instanceof DocumentFragment)e=ys(n).body;else{const t=n.parentElement,i=Zs(n);e="HTML"===(null==t?void 0:t.nodeName)&&"scroll"===i.getComputedStyle(t).overflowY?t:n}i.push({value:e.style.overflow,property:"overflow",el:e},{value:e.style.overflowX,property:"overflow-x",el:e},{value:e.style.overflowY,property:"overflow-y",el:e}),e.style.overflow="hidden"}return()=>{i.forEach((e=>{let{value:t,el:i,property:n}=e;t?i.style.setProperty(n,t):i.style.removeProperty(n)}))}}const sa=new class{constructor(){this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}add(e,t){let i=this.modals.indexOf(e);if(-1!==i)return i;i=this.modals.length,this.modals.push(e),e.modalRef&&ea(e.modalRef,!1);const n=function(e){const t=[];return[].forEach.call(e.children,(e=>{"true"===e.getAttribute("aria-hidden")&&t.push(e)})),t}(t);ia(t,e.mount,e.modalRef,n,!0);const r=na(this.containers,(e=>e.container===t));return-1!==r?(this.containers[r].modals.push(e),i):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblings:n}),i)}mount(e,t){const i=na(this.containers,(t=>-1!==t.modals.indexOf(e))),n=this.containers[i];n.restore||(n.restore=ra(n,t))}remove(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.modals.indexOf(e);if(-1===i)return i;const n=na(this.containers,(t=>-1!==t.modals.indexOf(e))),r=this.containers[n];if(r.modals.splice(r.modals.indexOf(e),1),this.modals.splice(i,1),0===r.modals.length)r.restore&&r.restore(),e.modalRef&&ea(e.modalRef,t),ia(r.container,e.mount,e.modalRef,r.hiddenSiblings,!1),this.containers.splice(n,1);else{const e=r.modals[r.modals.length-1];e.modalRef&&ea(e.modalRef,!1)}return i}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}};const aa=function(e){const{container:t,disableEscapeKeyDown:i=!1,disableScrollLock:r=!1,manager:s=sa,closeAfterTransition:a=!1,onTransitionEnter:o,onTransitionExited:l,children:c,onClose:h,open:d,rootRef:u}=e,p=n.useRef({}),f=n.useRef(null),m=n.useRef(null),g=vt(m,u),[v,y]=n.useState(!d),b=function(e){return!!e&&e.props.hasOwnProperty("in")}(c);let A=!0;"false"!==e["aria-hidden"]&&!1!==e["aria-hidden"]||(A=!1);const x=()=>(p.current.modalRef=m.current,p.current.mount=f.current,p.current),w=()=>{s.mount(x(),{disableScrollLock:r}),m.current&&(m.current.scrollTop=0)},S=At((()=>{const e=function(e){return"function"===typeof e?e():e}(t)||ys(f.current).body;s.add(x(),e),m.current&&w()})),_=n.useCallback((()=>s.isTopModal(x())),[s]),E=At((e=>{f.current=e,e&&(d&&_()?w():m.current&&ea(m.current,A))})),C=n.useCallback((()=>{s.remove(x(),A)}),[A,s]);n.useEffect((()=>()=>{C()}),[C]),n.useEffect((()=>{d?S():b&&a||C()}),[d,C,b,a,S]);const M=e=>t=>{var n;null==(n=e.onKeyDown)||n.call(e,t),"Escape"===t.key&&229!==t.which&&_()&&(i||(t.stopPropagation(),h&&h(t,"escapeKeyDown")))},T=e=>t=>{var i;null==(i=e.onClick)||i.call(e,t),t.target===t.currentTarget&&h&&h(t,"backdropClick")};return{getRootProps:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=us(e);delete i.onTransitionEnter,delete i.onTransitionExited;const n=(0,xe.A)({},i,t);return(0,xe.A)({role:"presentation"},n,{onKeyDown:M(n),ref:g})},getBackdropProps:function(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,xe.A)({"aria-hidden":!0},e,{onClick:T(e),open:d})},getTransitionProps:()=>({onEnter:Js((()=>{y(!1),o&&o()}),null==c?void 0:c.props.onEnter),onExited:Js((()=>{y(!0),l&&l(),a&&C()}),null==c?void 0:c.props.onExited)}),rootRef:g,portalRef:E,isTopModal:_,exited:v,hasTransition:b}};function oa(e){return Yt("MuiModal",e)}Kt("MuiModal",["root","hidden","backdrop"]);const la=["BackdropComponent","BackdropProps","classes","className","closeAfterTransition","children","container","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","onBackdropClick","onClose","onTransitionEnter","onTransitionExited","open","slotProps","slots","theme"],ca=ut("div",{name:"MuiModal",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,!i.open&&i.exited&&t.hidden]}})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0},!i.open&&i.exited&&{visibility:"hidden"})})),ha=ut(Ks,{name:"MuiModal",slot:"Backdrop",overridesResolver:(e,t)=>t.backdrop})({zIndex:-1}),da=n.forwardRef((function(e,t){var i,r,s,a,o,l;const c=mt({name:"MuiModal",props:e}),{BackdropComponent:h=ha,BackdropProps:d,className:u,closeAfterTransition:p=!1,children:f,container:m,component:g,components:v={},componentsProps:y={},disableAutoFocus:b=!1,disableEnforceFocus:A=!1,disableEscapeKeyDown:x=!1,disablePortal:w=!1,disableRestoreFocus:S=!1,disableScrollLock:_=!1,hideBackdrop:E=!1,keepMounted:C=!1,onBackdropClick:M,open:T,slotProps:I,slots:P}=c,D=(0,Ae.A)(c,la),R=(0,xe.A)({},c,{closeAfterTransition:p,disableAutoFocus:b,disableEnforceFocus:A,disableEscapeKeyDown:x,disablePortal:w,disableRestoreFocus:S,disableScrollLock:_,hideBackdrop:E,keepMounted:C}),{getRootProps:B,getBackdropProps:L,getTransitionProps:O,portalRef:N,isTopModal:k,exited:F,hasTransition:U}=aa((0,xe.A)({},R,{rootRef:t})),z=(0,xe.A)({},R,{exited:F}),j=(e=>{const{open:t,exited:i,classes:n}=e;return Ee({root:["root",!t&&i&&"hidden"],backdrop:["backdrop"]},oa,n)})(z),V={};if(void 0===f.props.tabIndex&&(V.tabIndex="-1"),U){const{onEnter:e,onExited:t}=O();V.onEnter=e,V.onExited=t}const G=null!=(i=null!=(r=null==P?void 0:P.root)?r:v.Root)?i:ca,H=null!=(s=null!=(a=null==P?void 0:P.backdrop)?a:v.Backdrop)?s:h,W=null!=(o=null==I?void 0:I.root)?o:y.root,Q=null!=(l=null==I?void 0:I.backdrop)?l:y.backdrop,q=vs({elementType:G,externalSlotProps:W,externalForwardedProps:D,getSlotProps:B,additionalProps:{ref:t,as:g},ownerState:z,className:Se(u,null==W?void 0:W.className,null==j?void 0:j.root,!z.open&&z.exited&&(null==j?void 0:j.hidden))}),X=vs({elementType:H,externalSlotProps:Q,additionalProps:d,getSlotProps:e=>L((0,xe.A)({},e,{onClick:t=>{M&&M(t),null!=e&&e.onClick&&e.onClick(t)}})),className:Se(null==Q?void 0:Q.className,null==d?void 0:d.className,null==j?void 0:j.backdrop),ownerState:z});return C||T||U&&!F?(0,ve.jsx)(Es,{ref:N,container:m,disablePortal:w,children:(0,ve.jsxs)(G,(0,xe.A)({},q,{children:[!E&&h?(0,ve.jsx)(H,(0,xe.A)({},X)):null,(0,ve.jsx)(ws,{disableEnforceFocus:A,disableAutoFocus:b,disableRestoreFocus:S,isEnabled:k,open:T,children:n.cloneElement(f,V)})]}))}):null})),ua=da,pa=e=>{let t;return t=e<1?5.11916*e**2:4.5*Math.log(e+1)+2,(t/100).toFixed(2)};function fa(e){return Yt("MuiPaper",e)}Kt("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const ma=["className","component","elevation","square","variant"],ga=ut("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,t[i.variant],!i.square&&t.rounded,"elevation"===i.variant&&t[`elevation${i.elevation}`]]}})((e=>{let{theme:t,ownerState:i}=e;var n;return(0,xe.A)({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow")},!i.square&&{borderRadius:t.shape.borderRadius},"outlined"===i.variant&&{border:`1px solid ${(t.vars||t).palette.divider}`},"elevation"===i.variant&&(0,xe.A)({boxShadow:(t.vars||t).shadows[i.elevation]},!t.vars&&"dark"===t.palette.mode&&{backgroundImage:`linear-gradient(${(0,Ce.X4)("#fff",pa(i.elevation))}, ${(0,Ce.X4)("#fff",pa(i.elevation))})`},t.vars&&{backgroundImage:null==(n=t.vars.overlays)?void 0:n[i.elevation]}))})),va=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiPaper"}),{className:n,component:r="div",elevation:s=1,square:a=!1,variant:o="elevation"}=i,l=(0,Ae.A)(i,ma),c=(0,xe.A)({},i,{component:r,elevation:s,square:a,variant:o}),h=(e=>{const{square:t,elevation:i,variant:n,classes:r}=e;return Ee({root:["root",n,!t&&"rounded","elevation"===n&&`elevation${i}`]},fa,r)})(c);return(0,ve.jsx)(ga,(0,xe.A)({as:r,ownerState:c,className:Se(h.root,n),ref:t},l))})),ya=va;function ba(e){return Yt("MuiDialog",e)}const Aa=Kt("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]);const xa=n.createContext({}),wa=["aria-describedby","aria-labelledby","BackdropComponent","BackdropProps","children","className","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onBackdropClick","onClick","onClose","open","PaperComponent","PaperProps","scroll","TransitionComponent","transitionDuration","TransitionProps"],Sa=ut(Ks,{name:"MuiDialog",slot:"Backdrop",overrides:(e,t)=>t.backdrop})({zIndex:-1}),_a=ut(ua,{name:"MuiDialog",slot:"Root",overridesResolver:(e,t)=>t.root})({"@media print":{position:"absolute !important"}}),Ea=ut("div",{name:"MuiDialog",slot:"Container",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.container,t[`scroll${vi(i.scroll)}`]]}})((e=>{let{ownerState:t}=e;return(0,xe.A)({height:"100%","@media print":{height:"auto"},outline:0},"paper"===t.scroll&&{display:"flex",justifyContent:"center",alignItems:"center"},"body"===t.scroll&&{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}})})),Ca=ut(ya,{name:"MuiDialog",slot:"Paper",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.paper,t[`scrollPaper${vi(i.scroll)}`],t[`paperWidth${vi(String(i.maxWidth))}`],i.fullWidth&&t.paperFullWidth,i.fullScreen&&t.paperFullScreen]}})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"}},"paper"===i.scroll&&{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"},"body"===i.scroll&&{display:"inline-block",verticalAlign:"middle",textAlign:"left"},!i.maxWidth&&{maxWidth:"calc(100% - 64px)"},"xs"===i.maxWidth&&{maxWidth:"px"===t.breakpoints.unit?Math.max(t.breakpoints.values.xs,444):`max(${t.breakpoints.values.xs}${t.breakpoints.unit}, 444px)`,[`&.${Aa.paperScrollBody}`]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+64)]:{maxWidth:"calc(100% - 64px)"}}},i.maxWidth&&"xs"!==i.maxWidth&&{maxWidth:`${t.breakpoints.values[i.maxWidth]}${t.breakpoints.unit}`,[`&.${Aa.paperScrollBody}`]:{[t.breakpoints.down(t.breakpoints.values[i.maxWidth]+64)]:{maxWidth:"calc(100% - 64px)"}}},i.fullWidth&&{width:"calc(100% - 64px)"},i.fullScreen&&{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${Aa.paperScrollBody}`]:{margin:0,maxWidth:"100%"}})})),Ma=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiDialog"}),r=Us(),s={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{"aria-describedby":a,"aria-labelledby":o,BackdropComponent:l,BackdropProps:c,children:h,className:d,disableEscapeKeyDown:u=!1,fullScreen:p=!1,fullWidth:f=!1,maxWidth:m="sm",onBackdropClick:g,onClick:v,onClose:y,open:b,PaperComponent:A=ya,PaperProps:x={},scroll:w="paper",TransitionComponent:S=Ws,transitionDuration:_=s,TransitionProps:E}=i,C=(0,Ae.A)(i,wa),M=(0,xe.A)({},i,{disableEscapeKeyDown:u,fullScreen:p,fullWidth:f,maxWidth:m,scroll:w}),T=(e=>{const{classes:t,scroll:i,maxWidth:n,fullWidth:r,fullScreen:s}=e;return Ee({root:["root"],container:["container",`scroll${vi(i)}`],paper:["paper",`paperScroll${vi(i)}`,`paperWidth${vi(String(n))}`,r&&"paperFullWidth",s&&"paperFullScreen"]},ba,t)})(M),I=n.useRef(),P=Rr(o),D=n.useMemo((()=>({titleId:P})),[P]);return(0,ve.jsx)(_a,(0,xe.A)({className:Se(T.root,d),closeAfterTransition:!0,components:{Backdrop:Sa},componentsProps:{backdrop:(0,xe.A)({transitionDuration:_,as:l},c)},disableEscapeKeyDown:u,onClose:y,open:b,ref:t,onClick:e=>{v&&v(e),I.current&&(I.current=null,g&&g(e),y&&y(e,"backdropClick"))},ownerState:M},C,{children:(0,ve.jsx)(S,(0,xe.A)({appear:!0,in:b,timeout:_,role:"presentation"},E,{children:(0,ve.jsx)(Ea,{className:Se(T.container),onMouseDown:e=>{I.current=e.target===e.currentTarget},ownerState:M,children:(0,ve.jsx)(Ca,(0,xe.A)({as:A,elevation:24,role:"dialog","aria-describedby":a,"aria-labelledby":P},x,{className:Se(T.paper,x.className),ownerState:M,children:(0,ve.jsx)(xa.Provider,{value:D,children:h})}))})}))}))})),Ta=Ma,Ia=e=>(0,ve.jsx)(ve.Fragment,{children:(0,ve.jsxs)(Ta,{open:!0,className:"Adidas",onClose:()=>e.closeAdidas(),children:[(0,ve.jsx)(Ti,{className:"close_",onClick:()=>e.closeAdidas(),children:(0,ve.jsx)(ji,{})}),(0,ve.jsx)("h2",{className:"mb-0",children:"White Grand Shoes"}),(0,ve.jsxs)("div",{className:"d-flex align-items-center",children:[(0,ve.jsxs)("div",{className:"d-flex align-items-center",children:[(0,ve.jsx)("span",{children:"Brands:"}),(0,ve.jsx)("span",{className:"ml-2",children:"Adidas"})]}),(0,ve.jsx)(ss,{name:"read-only",value:5,readOnly:!0})]})]})});function Pa(){return Pa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},Pa.apply(this,arguments)}function Da(e,t){if(null==e)return{};var i,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Ra=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"];try{window.__reactRouterVersion="6"}catch(th){}new Map;const Ba=r.startTransition;_s.flushSync,r.useId;function La(e){let{basename:t,children:i,future:r,window:s}=e,a=n.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:s,v5Compat:!0})&&(o={}),f((function(e,t){let{pathname:i,search:n,hash:r}=e.location;return d("",{pathname:i,search:n,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:u(t)}),null,o)));let l=a.current,[c,h]=n.useState({action:l.action,location:l.location}),{v7_startTransition:p}=r||{},m=n.useCallback((e=>{p&&Ba?Ba((()=>h(e))):h(e)}),[h,p]);return n.useLayoutEffect((()=>l.listen(m)),[l,m]),n.createElement(fe,{basename:t,children:i,location:c.location,navigationType:c.action,navigator:l,future:r})}const Oa="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Na=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ka=n.forwardRef((function(e,t){let i,{onClick:r,relative:s,reloadDocument:a,replace:o,state:c,target:h,to:d,preventScrollReset:p,unstable_viewTransition:f}=e,m=Da(e,Ra),{basename:g}=n.useContext(Q),v=!1;if("string"===typeof d&&Na.test(d)&&(i=d,Oa))try{let e=new URL(window.location.href),t=d.startsWith("//")?new URL(e.protocol+d):new URL(d),i=D(t.pathname,g);t.origin===e.origin&&null!=i?d=i+t.search+t.hash:v=!0}catch(th){}let y=function(e,t){let{relative:i}=void 0===t?{}:t;K()||l(!1);let{basename:r,navigator:s}=n.useContext(Q),{hash:a,pathname:o,search:c}=ee(e,{relative:i}),h=o;return"/"!==r&&(h="/"===o?r:N([r,o])),s.createHref({pathname:h,search:c,hash:a})}(d,{relative:s}),b=function(e,t){let{target:i,replace:r,state:s,preventScrollReset:a,relative:o,unstable_viewTransition:l}=void 0===t?{}:t,c=$(),h=J(),d=ee(e,{relative:o});return n.useCallback((t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,i)){t.preventDefault();let i=void 0!==r?r:u(h)===u(d);c(e,{replace:i,state:s,preventScrollReset:a,relative:o,unstable_viewTransition:l})}}),[h,c,d,r,s,i,e,a,o,l])}(d,{replace:o,state:c,target:h,preventScrollReset:p,relative:s,unstable_viewTransition:f});return n.createElement("a",Pa({},m,{href:i||y,onClick:v||a?r:function(e){r&&r(e),e.defaultPrevented||b(e)},ref:t,target:h}))}));var Fa,Ua;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Fa||(Fa={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Ua||(Ua={}));const za=()=>{const e=(0,n.useContext)(sU),t=t=>{e.setisOpenProductModal(!0)},[i,r]=(0,n.useState)(!1);return(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)(be,{}),(0,ve.jsx)(cs,{}),(0,ve.jsx)("section",{className:"homeProducts",children:(0,ve.jsx)("div",{className:"container",children:(0,ve.jsxs)("div",{className:"row",children:[(0,ve.jsx)("div",{className:"col-md-3",children:(0,ve.jsxs)("div",{className:"sticky",children:[(0,ve.jsxs)("div",{className:"banner",children:[(0,ve.jsx)("div",{className:"text1-overlay",children:(0,ve.jsx)("h3",{children:"Dropping Soon "})}),(0,ve.jsx)(ls.default,{scene:"https://prod.spline.design/zLQuOSWYRehS9oAe/scene.splinecode"})]}),(0,ve.jsxs)("div",{className:"banner1",children:[(0,ve.jsx)("div",{className:"text1-overlay",children:(0,ve.jsx)("h3",{children:"New Collection "})}),(0,ve.jsx)(ls.default,{scene:"https://prod.spline.design/j1bQF-xzsh4cf8-o/scene.splinecode"})]})]})}),(0,ve.jsxs)("div",{className:"col-md-9 productRow",children:[(0,ve.jsxs)("div",{className:"d-flex align-items-center",children:[(0,ve.jsxs)("div",{className:"info w-75",children:[(0,ve.jsx)("h3",{className:"mb-0 hd",children:"BEST SELLERS"}),(0,ve.jsx)("p",{className:"text-light text-sml mb-0",children:"Do not miss the current offers untill the end of March."})]}),(0,ve.jsxs)(Ti,{className:"viewAllBtn ml-auto",children:["VIEW ALL",(0,ve.jsx)(zi,{})]})]}),(0,ve.jsx)("div",{className:"product-row w-100 mt-4",children:(0,ve.jsxs)(mr,{slidesPerView:4,spaceBetween:20,navigation:!0,slidesPerGroup:2,modules:[yr],className:"mySwiper",children:[(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shoppremiumoutlets.com/cdn/shop/files/950fce14f35946359751f40cf5a9343d_3153fbf2-edb5-4aa1-8e33-b541dd225fdf_360x.jpg?v=1720843419",className:"w-100"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"20%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{onClick:()=>t(),children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Women's ultimate365 Jacket"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-10000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-7900"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/eb1608b11ee340d0a9bbc69f1c436e9d_360x.jpg?v=1711766667",className:"w-100"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"28%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{onClick:()=>{r(!0)},children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Johnny Was"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"0ut of Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-5600"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-2000"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/17f95bed89204cb3b1acbf6d744dd742_211156b3-1637-4b42-92e9-586817070fd9_360x.jpg?v=1714018379",className:"w-75 "}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"10%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{onClick:()=>t(),children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Black&White floral"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-6700"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-5000"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/f1380c71e8464267bda4e52f98ab8cde_720x.jpg?v=1739343147",className:"w-100"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"30%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{onClick:()=>t(),children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Aaron & Amber"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-2300 "}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-1400"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shoppremiumoutlets.com/cdn/shop/files/dc19778328db4332902260fa9dfca3c6_c9f89121-9533-47e0-91fd-f47f0fd8b6b5_360x.jpg?v=1722517257",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"28%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{onClick:()=>t(),children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Brown shaded Jacket"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-9000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-5000"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/10f741bbbc3f476f861c48053110f952_360x.jpg?v=1739229893",className:"w-100"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"13%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{onClick:()=>t(),children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Bayeas"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-3500"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-1000"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/b2bb26717aa545df8286faec3dd38de7_360x.jpg?v=1738037424",className:"w-100"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"18%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{onClick:()=>t(),children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"ANDREE BY UNIT"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-2000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-1400"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/5c4eeb480e68428cac8cf22a44433a76_ee5c893a-8c46-4cf2-bf8e-142505e88f9a_360x.jpg?v=1716249340",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"24%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{onClick:()=>t(),children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Gloria Vanderbilt"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-10000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-6000"})]})]})]})})]})}),(0,ve.jsxs)("div",{className:"d-flex align-items-center ",children:[(0,ve.jsxs)("div",{className:"info w-75 mt-5",children:[(0,ve.jsx)("h3",{className:"mb-0 hd",children:"NEW PRODUCTS"}),(0,ve.jsx)("p",{className:"text-light text-sml mb-0",children:"New products with updated stocks."})]}),(0,ve.jsx)(ka,{to:"/cat/:id",className:"ml-auto",style:{textDecoration:"none"},children:(0,ve.jsxs)(Ti,{className:"viewAllBtn",children:["VIEW ALL ",(0,ve.jsx)(zi,{})]})})]}),(0,ve.jsx)("div",{className:"product-row w-100 mt-4",children:(0,ve.jsxs)(mr,{slidesPerView:4,spaceBetween:20,navigation:!0,slidesPerGroup:2,modules:[yr],className:"mySwiper",children:[(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/608efc34247d4a47ab1c5a4c3ed79166_360x.jpg?v=1730241334",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"20%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Gergana Ivanova"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-1000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-790"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/7f41c7ad853741f3afe4fa7aa9cd4b1c_360x.jpg?v=1737590201",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"28%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"FASHNZFAB"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-5600"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-2000"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/1e049595b9cd4131bca3edfd84781842_b5df8227-5cbd-41eb-86f7-62402580a251_360x.jpg?v=1723779271",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"8%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"PISTOLA"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-6700"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-3400"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/33674bd636a24dfda1967bdafca3a019_360x.jpg?v=1738280916",className:"w-100 "}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"38%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Calvin Klein"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-2300"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-1400"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/bc953da60b7d4206b0d3b4c83bff5470_af40f0d0-4293-4b5f-8239-246394fd384a_360x.jpg?v=1726679777",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"28%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"AMBUSH"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-2000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-1500"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/77b7cc4526e24692924680254bcbd045_360x.jpg?v=1735939512",className:"w-100"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"28%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Dolce & Gabbana"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-3500"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-1000"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/d632f8a772c2470da8be747e76d53501_360x.jpg?v=1739234971",className:"w-100"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"18%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Calvin Klein"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-2000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-1400"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/bfe23d6bad284749bdf6a4f3e5bfdecc_360x.jpg?v=1739242743",className:"w-100"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"28%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Salon 1884"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-10000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-6000"})]})]})]})})]})}),(0,ve.jsx)("div",{className:"product-row productRow2 w-100 mt-4",children:(0,ve.jsxs)(mr,{slidesPerView:4,spaceBetween:20,navigation:!0,slidesPerGroup:2,modules:[yr],className:"mySwiper",children:[(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/fa5943bef464474d8ed616fe5a9c1375_fed414a4-c3ad-4168-9126-f8aa11602ba5_360x.jpg?v=1723892115",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"25%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Bench"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"Out Of Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-10000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-7900"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/1816e0b4f7eb414693c2b4ec7fa5c12d_360x.jpg?v=1736473638",className:"w-100"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"22%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"ADORA"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-5600"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-2000"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/3e26b6753d834aaea8982bd7740bdbec_360x.jpg?v=1739571641",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"48%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"EILEEN FISHER"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-6700"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-3400"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/91f70535f80040429e172ae960534758_360x.jpg?v=1735258831",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"38%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Democracy"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-2300"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-1400"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/3a7dc0ed1d284b0b9c50fbc7cde59d30_360x.jpg?v=1736300651",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"28%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"ZENANA"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-9000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-5000"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/a6ba21bf34bf4af7b4fb78b6149afb2d_360x.jpg?v=1734391757",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"28%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"EILEEN FISHER"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-3500"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-1000"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/f2b88a53b57342c0ba96d4b4852168f7_8cf6201c-4b4e-47f1-9aeb-6b19f0705441_360x.jpg?v=1719457261",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"18%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Joseph Ribkoff "}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-20000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-14000"})]})]})]})}),(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"item productItem",children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/b7921b6373ec426ba0010170b842f065_360x.jpg?v=1736822105",className:"w-75"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"28%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"ELAN"}),(0,ve.jsx)("span",{className:"text-success d-block ",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2 ",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-10000"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-6000"})]})]})]})})]})}),(0,ve.jsxs)("div",{className:"d-flex mt-5 mb-4 bannerSec",children:[(0,ve.jsxs)("div",{className:"banner3 position-relative",children:[(0,ve.jsx)("img",{src:"https://www.datocms-assets.com/96845/1729803349-fossil_promo_tile.png",className:"cursor w-100"}),(0,ve.jsxs)("div",{className:"text3-overlay",children:[(0,ve.jsx)("h3",{children:"EXTRO Promo"}),(0,ve.jsx)("p",{children:"Check out the latest offers!"})]})]}),(0,ve.jsxs)("div",{className:"banner3 position-relative",children:[(0,ve.jsx)("img",{src:"https://m.media-amazon.com/images/S/al-na-9d5791cf-3faf/c4b0c238-d2fd-4da9-8219-a44c21a8d36a._CR0,0,1200,628_SX920_QL70_.png",className:"cursor w-100"}),(0,ve.jsxs)("div",{className:"text3-overlay",children:[(0,ve.jsx)("h3",{children:"Guess Factory"}),(0,ve.jsx)("p",{children:"Check out the latest offers!"})]})]})]})]})]})})}),(0,ve.jsxs)("section",{className:"mothers-day-slider",children:[(0,ve.jsx)("div",{className:"slider-header",children:(0,ve.jsxs)("div",{className:"gift-guide-header",children:[(0,ve.jsx)("h2",{children:(0,ve.jsx)("span",{children:"GIFT GUIDE"})}),(0,ve.jsx)("div",{className:"price-range",children:"Gifts From $50"}),(0,ve.jsx)("div",{className:"subheader",children:"Must-Have Items"}),(0,ve.jsx)("button",{className:"shop-now-btn",children:"SHOP NOW"})]})}),(0,ve.jsx)("div",{className:"slider-container",children:(0,ve.jsx)(mr,{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",loop:!0,autoplay:{delay:3e3,disableOnInteraction:!1},coverflowEffect:{rotate:5,stretch:0,depth:100,modifier:2.5,slideShadows:!0},modules:[_r,xr],className:"gift-swiper",children:[{title:"Luxury Spa Set",price:"$65",image:"/path-to-spa-set.jpg",category:"Pampering Gifts"},{title:"Designer Handbag",price:"$120",image:"/path-to-handbag.jpg",category:"Fashion"},{title:"Personalized Jewelry",price:"$85",image:"/path-to-jewelry.jpg",category:"Sentimental"},{title:"Gourmet Gift Basket",price:"$75",image:"/path-to-basket.jpg",category:"Food & Wine"},{title:"Smart Home Device",price:"$99",image:"/path-to-device.jpg",category:"Tech Gadgets"}].map(((e,t)=>(0,ve.jsx)(gr,{children:(0,ve.jsxs)("div",{className:"gift-card",children:[(0,ve.jsx)("div",{className:"category-badge",children:e.category}),(0,ve.jsx)("img",{src:e.image,alt:e.title,className:"gift-image"}),(0,ve.jsxs)("div",{className:"gift-info",children:[(0,ve.jsx)("h3",{children:e.title}),(0,ve.jsx)("div",{className:"price",children:e.price})]})]})},t)))})})]}),(0,ve.jsx)("section",{className:"slider3D-section mb-4",children:(0,ve.jsxs)("div",{className:"container",children:[(0,ve.jsx)("h2",{className:"text-center text-dark mb-4",children:"Explore Our Latest Picks"}),(0,ve.jsx)(mr,{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",loop:!0,autoplay:{delay:3e3,disableOnInteraction:!1},coverflowEffect:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},pagination:!0,modules:[_r,Ar,xr],className:"swiper-3d",children:["https://shop.simon.com/cdn/shop/files/3991f5db9abe465693edd38f1a313bd0_260afd0e-4889-43ce-b9e4-dd63b2957e0c_360x.webp?v=1720733545","https://shop.simon.com/cdn/shop/files/34b38b69b4b546c5ba88e7f6e889a240_360x.jpg?v=1742359473","https://shop.simon.com/cdn/shop/files/64945746cf1b49748019965d96ba74a4_360x.jpg?v=1744051679","https://shop.simon.com/cdn/shop/files/e959cc4139974561b6057e57f4951612_360x.jpg?v=1738886989","https://shop.simon.com/cdn/shop/files/7b19fed9a89d42fc80e6d5f156677686_360x.jpg?v=1741028858"].map(((e,t)=>(0,ve.jsx)(gr,{style:{width:"300px"},children:(0,ve.jsx)("img",{src:e,alt:`slide-${t}`,style:{borderRadius:"10px",width:"100%",height:"auto"}})},t)))})]})}),(0,ve.jsx)("section",{className:"newsLetterSection mt-3 mb-3 d-flex align-items-center",children:(0,ve.jsx)("div",{className:"container",children:(0,ve.jsxs)("div",{className:"row",children:[(0,ve.jsxs)("div",{className:"col-md-6 ",children:[(0,ve.jsx)("p",{className:"text-white mb-1",children:"$20 Discount on your first Order!!!"}),(0,ve.jsx)("h3",{className:"text-white",children:"Visit our Website....."}),(0,ve.jsxs)("p",{className:"text-light",children:["Join our email subscription now to get updates on ",(0,ve.jsx)("br",{})," discounts and promos"]}),(0,ve.jsx)("div",{class:"marg-sm-b30"}),(0,ve.jsx)("h4",{class:"webintern_footer_title h5",children:(0,ve.jsx)("small",{children:"Subscribe Newsletter"})}),(0,ve.jsx)("div",{class:"empty-space marg-lg-b20"}),(0,ve.jsx)("form",{method:"post",children:(0,ve.jsxs)("div",{class:"tt-subscribe",children:[(0,ve.jsx)("input",{type:"text",required:"",placeholder:"Enter your email"}),(0,ve.jsxs)("div",{class:"tt-subscribe-submit",children:[(0,ve.jsx)("i",{class:"fa fa-envelope","aria-hidden":"true"}),(0,ve.jsx)("input",{type:"submit",value:""})]})]})})]}),(0,ve.jsx)("div",{className:"col-md-6 ",children:(0,ve.jsx)("img",{src:Er})})]})})}),!0===i&&(0,ve.jsx)(Ia,{closeAdidas:()=>{r(!1)}})]})},ja=i.p+"static/media/images.b326e48519289b5347f9.png";function Va(e){return Fi({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"},child:[]}]})(e)}function Ga(e){return Fi({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 0 0-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 1 0 0 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 0 0-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 0 0-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 0 0-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 0 0-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 0 1-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 0 1-31.6 31.6z"},child:[]}]})(e)}function Ha(e){return Fi({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"},child:[]}]})(e)}function Wa(e){return Fi({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"},child:[]}]})(e)}function Qa(e){return Fi({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"},child:[]}]})(e)}function qa(e){return Fi({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M352.92 80C288 80 256 144 256 144s-32-64-96.92-64c-52.76 0-94.54 44.14-95.08 96.81-1.1 109.33 86.73 187.08 183 252.42a16 16 0 0 0 18 0c96.26-65.34 184.09-143.09 183-252.42-.54-52.67-42.32-96.81-95.08-96.81z"},child:[]}]})(e)}function Xa(e){return Fi({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M456.69 421.39 362.6 327.3a173.81 173.81 0 0 0 34.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 0 0 327.3 362.6l94.09 94.09a25 25 0 0 0 35.3-35.3zM97.92 222.72a124.8 124.8 0 1 1 124.8 124.8 124.95 124.95 0 0 1-124.8-124.8z"},child:[]}]})(e)}function Ya(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function n(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];clearTimeout(t),t=setTimeout((()=>{e.apply(this,r)}),i)}return n.clear=()=>{clearTimeout(t)},n}const Ka=Ya,Ja=Zs,Za=["addEndListener","appear","children","container","direction","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function $a(e,t,i){var n;const r=function(e,t,i){const n=t.getBoundingClientRect(),r=i&&i.getBoundingClientRect(),s=Ja(t);let a;if(t.fakeTransform)a=t.fakeTransform;else{const e=s.getComputedStyle(t);a=e.getPropertyValue("-webkit-transform")||e.getPropertyValue("transform")}let o=0,l=0;if(a&&"none"!==a&&"string"===typeof a){const e=a.split("(")[1].split(")")[0].split(",");o=parseInt(e[4],10),l=parseInt(e[5],10)}return"left"===e?r?`translateX(${r.right+o-n.left}px)`:`translateX(${s.innerWidth+o-n.left}px)`:"right"===e?r?`translateX(-${n.right-r.left-o}px)`:`translateX(-${n.left+n.width-o}px)`:"up"===e?r?`translateY(${r.bottom+l-n.top}px)`:`translateY(${s.innerHeight+l-n.top}px)`:r?`translateY(-${n.top-r.top+n.height-l}px)`:`translateY(-${n.top+n.height-l}px)`}(e,t,"function"===typeof(n=i)?n():n);r&&(t.style.webkitTransform=r,t.style.transform=r)}const eo=n.forwardRef((function(e,t){const i=Us(),r={enter:i.transitions.easing.easeOut,exit:i.transitions.easing.sharp},s={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{addEndListener:a,appear:o=!0,children:l,container:c,direction:h="down",easing:d=r,in:u,onEnter:p,onEntered:f,onEntering:m,onExit:g,onExited:v,onExiting:y,style:b,timeout:A=s,TransitionComponent:x=Ls}=e,w=(0,Ae.A)(e,Za),S=n.useRef(null),_=yt(l.ref,S,t),E=e=>t=>{e&&(void 0===t?e(S.current):e(S.current,t))},C=E(((e,t)=>{$a(h,e,c),zs(e),p&&p(e,t)})),M=E(((e,t)=>{const n=js({timeout:A,style:b,easing:d},{mode:"enter"});e.style.webkitTransition=i.transitions.create("-webkit-transform",(0,xe.A)({},n)),e.style.transition=i.transitions.create("transform",(0,xe.A)({},n)),e.style.webkitTransform="none",e.style.transform="none",m&&m(e,t)})),T=E(f),I=E(y),P=E((e=>{const t=js({timeout:A,style:b,easing:d},{mode:"exit"});e.style.webkitTransition=i.transitions.create("-webkit-transform",t),e.style.transition=i.transitions.create("transform",t),$a(h,e,c),g&&g(e)})),D=E((e=>{e.style.webkitTransition="",e.style.transition="",v&&v(e)})),R=n.useCallback((()=>{S.current&&$a(h,S.current,c)}),[h,c]);return n.useEffect((()=>{if(u||"down"===h||"right"===h)return;const e=Ka((()=>{S.current&&$a(h,S.current,c)})),t=Ja(S.current);return t.addEventListener("resize",e),()=>{e.clear(),t.removeEventListener("resize",e)}}),[h,u,c]),n.useEffect((()=>{u||R()}),[u,R]),(0,ve.jsx)(x,(0,xe.A)({nodeRef:S,onEnter:C,onEntered:T,onEntering:M,onExit:P,onExited:D,onExiting:I,addEndListener:e=>{a&&a(S.current,e)},appear:o,in:u,timeout:A},w,{children:(e,t)=>n.cloneElement(l,(0,xe.A)({ref:_,style:(0,xe.A)({visibility:"exited"!==e||u?void 0:"hidden"},b,l.props.style)},t))}))})),to=eo,io=n.forwardRef((function(e,t){return(0,ve.jsx)(to,{direction:"up",ref:t,...e})})),no=()=>{const[e,t]=(0,n.useState)(!1),[i,r]=(0,n.useState)(null),[s,a]=(0,n.useState)([]),o=(0,n.useContext)(sU);(0,n.useEffect)((()=>{a(o.countryList)}),[o.countryList]);return(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsxs)(Ti,{className:"countryDrop",onClick:()=>t(!0),children:[(0,ve.jsxs)("div",{className:"info d-flex flex-column",children:[(0,ve.jsx)("span",{className:"label",children:"Your Location"}),(0,ve.jsx)("span",{className:"name",children:""!==o.selectedCountry?o.selectedCountry.length>10?o.selectedCountry.substr(0,10)+"...":o.selectedCountry:"Select Location"})]}),(0,ve.jsx)("span",{className:"ml-auto",children:(0,ve.jsx)(Ha,{})})]}),(0,ve.jsx)(Ta,{open:e,onClose:()=>t(!1),className:"locationModal",TransitionComponent:io,children:(0,ve.jsxs)("div",{className:"locationModalContent",children:[(0,ve.jsx)(Ti,{className:"close_",onClick:()=>t(!1),children:(0,ve.jsx)(ji,{})}),(0,ve.jsx)("h2",{children:"Choose your location"}),(0,ve.jsx)("p",{children:"Enter the address and we will specify the area"}),(0,ve.jsxs)("div",{className:"headerSearch w-100",children:[(0,ve.jsx)("input",{type:"text",placeholder:"Search your area...",onChange:e=>{const t=e.target.value.toLowerCase();if(""!==t){const e=s.filter((e=>e.country.toLowerCase().includes(t)));a(e)}else a(o.countryList)}}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Xa,{})})]}),(0,ve.jsx)("ul",{className:"countryList mt-3",children:0!==(null===s||void 0===s?void 0:s.length)&&(null===s||void 0===s?void 0:s.map(((e,n)=>(0,ve.jsx)("li",{children:(0,ve.jsx)(Ti,{onClick:()=>((e,i)=>{r(e),t(!1),o.setselectedCountry(i)})(n,e.country),className:i===n?"active":"",children:e.country})},n))))})]})})]})},ro=()=>(0,ve.jsxs)("div",{className:"headerSearch d-flex align-items-center",children:[(0,ve.jsx)("div",{className:"imgsearch-cam button-search search-mag-icon",children:(0,ve.jsx)("img",{src:"//shop.simon.com/cdn/shop/t/552/assets/Camera.svg?v=10213076253632790521738165885",alt:"Camera Search"})}),(0,ve.jsx)("input",{type:"text",className:"search-input",placeholder:"Search "}),(0,ve.jsx)(Ti,{className:"search-btn",children:(0,ve.jsx)(Xa,{})})]});function so(e){return Fi({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"},child:[]}]})(e)}function ao(e){return Fi({tag:"svg",attr:{viewBox:"0 0 488 512"},child:[{tag:"path",attr:{d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"},child:[]}]})(e)}function oo(e){return Fi({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"},child:[]}]})(e)}function lo(e){return Fi({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"},child:[]}]})(e)}function co(e){return Fi({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 75.2v361.7c0 24.3-19 43.2-43.2 43.2H43.2C19.3 480 0 461.4 0 436.8V75.2C0 51.1 18.8 32 43.2 32h361.7c24 0 43.1 18.8 43.1 43.2zm-37.3 361.6V75.2c0-3-2.6-5.8-5.8-5.8h-9.3L285.3 144 224 94.1 162.8 144 52.5 69.3h-9.3c-3.2 0-5.8 2.8-5.8 5.8v361.7c0 3 2.6 5.8 5.8 5.8h361.7c3.2.1 5.8-2.7 5.8-5.8zM150.2 186v37H76.7v-37h73.5zm0 74.4v37.3H76.7v-37.3h73.5zm11.1-147.3l54-43.7H96.8l64.5 43.7zm210 72.9v37h-196v-37h196zm0 74.4v37.3h-196v-37.3h196zm-84.6-147.3l64.5-43.7H232.8l53.9 43.7zM371.3 335v37.3h-99.4V335h99.4z"},child:[]}]})(e)}function ho(e){return Fi({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"},child:[]}]})(e)}function uo(e){return Fi({tag:"svg",attr:{viewBox:"0 0 256 512"},child:[{tag:"path",attr:{d:"M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"},child:[]}]})(e)}function po(e){return Fi({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 144v288c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V144c0-26.5 21.5-48 48-48h88l12.3-32.9c7-18.7 24.9-31.1 44.9-31.1h125.5c20 0 37.9 12.4 44.9 31.1L376 96h88c26.5 0 48 21.5 48 48zM376 288c0-66.2-53.8-120-120-120s-120 53.8-120 120 53.8 120 120 120 120-53.8 120-120zm-32 0c0 48.5-39.5 88-88 88s-88-39.5-88-88 39.5-88 88-88 88 39.5 88 88z"},child:[]}]})(e)}function fo(e){return Fi({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(e)}function mo(e){return Fi({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M133.3 33.41L77.89 47.25 34.6 148.3l33.29 22.2 27.46-54.9 17.05 4.9-15.07 150.1H245.2l9.2-87.9.9-8.1h4.5l-5.4-54.1 17.1-4.9 27.4 54.9 33.3-22.2-43.3-101.05-55.4-13.84c-5.5 3.87-12.2 6.21-19.5 7.95-9.4 2.21-20 3.24-30.6 3.24-10.6 0-21.2-1.03-30.6-3.24-7.3-1.74-14-4.07-19.5-7.95zM271.5 192.6l-1.5 14h178.8l-1.5-14zm-3.4 32l-26.7 254h62.7l46.5-216.9h17.6l46.5 216.9h62.7l-26.7-254z"},child:[]}]})(e)}function go(e){return Fi({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M3 7a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 13a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"},child:[]}]})(e)}function vo(e){return Fi({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"},child:[]}]})(e)}const yo=()=>{const[e,t]=(0,n.useState)(!1);return(0,ve.jsx)("nav",{children:(0,ve.jsx)("div",{className:"container",children:(0,ve.jsxs)("div",{className:"row",children:[(0,ve.jsx)("div",{className:"col-sm-7 navPart1",children:(0,ve.jsxs)("div",{className:"catWrapper",children:[(0,ve.jsxs)(Ti,{className:"allCatTab align-items-center",onClick:()=>t(!e),children:[(0,ve.jsx)("span",{className:"icon1 mr-2",children:(0,ve.jsx)(go,{})}),(0,ve.jsx)("span",{className:"text",children:"ALL CATEGORIES"}),(0,ve.jsx)("span",{className:"icon2 ml-2",children:(0,ve.jsx)(ho,{})})]}),(0,ve.jsx)("div",{className:"sidebarNav "+(e?"open":""),children:(0,ve.jsxs)("ul",{children:[(0,ve.jsxs)("li",{children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsxs)(Ti,{children:["Best Seller",(0,ve.jsx)(uo,{className:"ml-auto"})]})}),(0,ve.jsxs)("div",{className:"submenu",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Dresses"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Customer wear"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Most Popular"})})]})]}),(0,ve.jsxs)("li",{children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsxs)(Ti,{children:["WOMEN",(0,ve.jsx)(uo,{className:"ml-auto"})]})}),(0,ve.jsxs)("div",{className:"submenu",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Clothing"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Tops"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"T-Shirts"})})]})]}),(0,ve.jsxs)("li",{children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Ocassion"})}),(0,ve.jsxs)("div",{className:"submenu",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Formal Wear"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Casual Wear"})})]})]}),(0,ve.jsxs)("li",{children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"New Arrival"})}),(0,ve.jsxs)("div",{className:"submenu",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Trending Now"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Latest Fashion"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Limited Edition"})})]})]}),(0,ve.jsxs)("li",{children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Sales&Discounts"})}),(0,ve.jsxs)("div",{className:"submenu ",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Under 50%"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Upto 50% OFF"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Clearance Sale"})})]})]}),(0,ve.jsxs)("li",{children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Seasonal Wear"})}),(0,ve.jsxs)("div",{className:"submenu shadow",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Winter Collection"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Summer Essential"})})]})]}),(0,ve.jsxs)("li",{children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsxs)(Ti,{children:["GIFTS",(0,ve.jsx)(uo,{className:"ml-auto"})]})}),(0,ve.jsxs)("div",{className:"submenu shadow",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Tops"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"T-Shirts"})})]})]})]})})]})}),(0,ve.jsx)("div",{className:"col-sm-9 navPart2 d-flex align-items-center",children:(0,ve.jsxs)("ul",{className:"list list-inline",children:[(0,ve.jsxs)("li",{className:"list-inline-item",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsxs)(Ti,{children:[(0,ve.jsx)("span",{className:"icon2 ml-2",children:(0,ve.jsx)(fo,{})}),"HOME",(0,ve.jsx)("span",{className:"icon2 ml-2",children:(0,ve.jsx)(ho,{})})]})}),(0,ve.jsxs)("div",{className:"submenu shadow",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Dashboard"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Recent Activity"})})]})]}),(0,ve.jsxs)("li",{className:"list-inline-item",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsxs)(Ti,{children:["Products",(0,ve.jsx)("span",{className:"icon2 ml-2",children:(0,ve.jsx)(ho,{})})]})}),(0,ve.jsxs)("div",{className:"submenu shadow",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"New Arrival"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Best Sellers"})})]})]}),(0,ve.jsxs)("li",{className:"list-inline-item",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsxs)(Ti,{children:[(0,ve.jsx)("span",{className:"icon2 ml-2",children:(0,ve.jsx)(mo,{})}),"TryMe"]})}),(0,ve.jsxs)("div",{className:"submenu shadow",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Upload image"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"My Try-On"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Saved Styles"})})]})]}),(0,ve.jsxs)("li",{className:"list-inline-item",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Features"})}),(0,ve.jsxs)("div",{className:"submenu shadow",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"3D Model Viewer"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Online Virtual Tryon"})})]})]}),(0,ve.jsxs)("li",{className:"list-inline-item",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsxs)(Ti,{children:[(0,ve.jsx)("span",{className:"icon2 ml-2",children:(0,ve.jsx)(po,{})}),"BLOG",(0,ve.jsx)("span",{className:"icon2 ml-2",children:(0,ve.jsx)(ho,{})})]})}),(0,ve.jsxs)("div",{className:"submenu shadow",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Latest Trend"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Styling Guideline"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Celebrity Look"})})]})]}),(0,ve.jsxs)("li",{className:"list-inline-item",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Support"})}),(0,ve.jsxs)("div",{className:"submenu shadow",children:[(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"FAQs"})}),(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)(Ti,{children:"Contact Us"})})]})]})]})})]})})})},bo=()=>{const e=(0,n.useContext)(sU),[t,i]=(0,n.useState)(!1),[r,s]=(0,n.useState)(!1);return(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)("div",{className:"simon-tab_wrap spoApp_hide",children:(0,ve.jsx)("div",{className:"simon-tab",children:(0,ve.jsx)("nav",{className:"simon-tab__nav",children:(0,ve.jsxs)("ul",{className:"simon-tab__ul",children:[(0,ve.jsx)("li",{children:(0,ve.jsx)("span",{className:"tab-cta tab-cta__inactive",children:"LUXURY"})}),(0,ve.jsx)("li",{className:"tab-container__divider",children:"|"}),(0,ve.jsx)("li",{children:(0,ve.jsxs)("span",{className:"tab-cta tab-cta__active",children:["PREMIUM OUTLETS",(0,ve.jsx)("sup",{children:"\xae"})]})}),(0,ve.jsx)("li",{className:"tab-container__divider",children:"|"}),(0,ve.jsx)("li",{children:(0,ve.jsxs)("a",{className:"tab-cta tab-cta__inactive",href:"/",children:["SHOP DRAPEFIT",(0,ve.jsx)("sup",{children:"TM"})]})}),(0,ve.jsx)("li",{className:"tab-container__divider",children:"|"}),(0,ve.jsx)("li",{children:(0,ve.jsxs)("span",{className:"tab-cta tab-cta__active",onClick:()=>s(!r),style:{cursor:"pointer"},children:["MEET DRAPEFIT",(0,ve.jsx)(Ti,{className:"circle",children:(0,ve.jsx)(Hi,{})})]})})]})})})}),r&&(0,ve.jsx)("div",{className:"responsive-container-block bigContainer",children:(0,ve.jsxs)("div",{className:"responsive-container-block Container",children:[(0,ve.jsx)("div",{className:"imgContainer",children:(0,ve.jsx)("img",{className:"mainImg",src:"https://th.bing.com/th/id/R.3c1c46a302a0695e110ac4232a0b3c2f?rik=7op6kcODuuKXbg&pid=ImgRaw&r=0",alt:"about us"})}),(0,ve.jsxs)("div",{className:"responsive-container-block textSide",children:[(0,ve.jsx)("p",{className:"text-blk heading",children:"DrapeFit \u2013 Where AR Meets Style"}),(0,ve.jsx)("p",{className:"text-blk subHeading",children:'"DrapFit allows users to virtually try on clothes by generating a 3D model based on uploaded images. Using AI and 3D modeling, it maps garments onto the user\'s body for a realistic fit preview. This enhances shopping confidence, reduces returns, and personalizes fashion recommendations."'}),(0,ve.jsxs)("div",{className:"responsive-cell-block wk-desk-6 wk-ipadp-6 wk-tab-12 wk-mobile-12",children:[(0,ve.jsx)("div",{className:"cardImgContainer",children:(0,ve.jsx)("img",{className:"cardImg",src:"https://th.bing.com/th/id/OIP.4OYThL63EXhXzpeYHtAwfgHaHa?w=183&h=183&c=7&r=0&o=5&dpr=1.5&pid=1.7",alt:"value 1"})}),(0,ve.jsxs)("div",{className:"cardText",children:[(0,ve.jsx)("p",{className:"text-blk cardHeading",children:"User Image Upload"}),(0,ve.jsx)("p",{className:"text-blk cardSubHeading",children:"Users upload images to generate a personalized 3D model."})]})]}),(0,ve.jsxs)("div",{className:"responsive-cell-block wk-desk-6 wk-ipadp-6 wk-tab-12 wk-mobile-12",children:[(0,ve.jsx)("div",{className:"cardImgContainer",children:(0,ve.jsx)("img",{className:"cardImg",src:"https://static.turbosquid.com/Preview/2014/05/17__13_31_50/Female_Head_Wire_1_.jpgb75b44e7-c776-4034-b906-e3c81901e8d1Zoom.jpg",alt:"value 4"})}),(0,ve.jsxs)("div",{className:"cardText",children:[(0,ve.jsx)("p",{className:"text-blk cardHeading",children:" 3D Model Creation"}),(0,ve.jsx)("p",{className:"text-blk cardSubHeading",children:"AI processes the image to create an accurate virtual body representation."})]})]}),(0,ve.jsxs)("div",{className:"responsive-cell-block wk-desk-6 wk-ipadp-6 wk-tab-12 wk-mobile-12",children:[(0,ve.jsx)("div",{className:"cardImgContainer",children:(0,ve.jsx)("img",{className:"cardImg",src:"https://th.bing.com/th/id/OIP.Yzdpn__5PyaX8nqW1JtYTwHaEr?w=232&h=180&c=7&r=0&o=5&dpr=1.5&pid=1.7",alt:"value 4"})}),(0,ve.jsxs)("div",{className:"cardText",children:[(0,ve.jsx)("p",{className:"text-blk cardHeading",children:"Virtual Try-On & Fit Simulation"}),(0,ve.jsx)("p",{className:"text-blk cardSubHeading",children:"Clothes are mapped onto the 3D model for a realistic try-on experience."})]})]}),(0,ve.jsx)("button",{className:"explore",children:"Explore our Website"})]}),(0,ve.jsx)("img",{className:"redDots",src:"https://workik-widget-assets.s3.amazonaws.com/widget-assets/images/cw3.svg",alt:"decorative"})]})}),(0,ve.jsxs)("header",{className:"headerWrapper",children:[(0,ve.jsx)("div",{className:"top-strip bg-purple",children:(0,ve.jsx)("div",{className:"container text-center",children:(0,ve.jsx)("p",{className:"mb-0 mt-0",children:"LUXE DESIGNER FAVORITES"})})}),(0,ve.jsx)("div",{className:"header",children:(0,ve.jsxs)("div",{className:"container d-flex align-items-center justify-content-between",children:[(0,ve.jsx)("div",{className:"logoWrapper",children:(0,ve.jsx)(ka,{to:"/",children:(0,ve.jsx)("img",{src:ja,alt:"DrapeFit Logo"})})}),(0,ve.jsxs)("div",{className:"part2 d-flex align-items-center",children:[0!==e.countryList.length&&(0,ve.jsx)(no,{}),(0,ve.jsx)(ro,{})]}),(0,ve.jsxs)("div",{className:"part3 d-flex align-items-center",children:[(0,ve.jsx)(ka,{to:"/SignIn",children:(0,ve.jsx)(Ti,{className:"circle","aria-label":"User Profile",children:(0,ve.jsx)(Va,{})})}),(0,ve.jsxs)("div",{className:"cartTab d-flex align-items-center ml-3",children:[(0,ve.jsx)("span",{className:"price"}),(0,ve.jsxs)("div",{className:"position-relative ml-1 icon-group",children:[(0,ve.jsx)(Ti,{className:"circle cart-icon","aria-label":"Shopping Cart",children:(0,ve.jsx)(Ga,{})}),(0,ve.jsx)("span",{className:"count",children:"3"}),(0,ve.jsx)(Ti,{className:"circle heart-icon","aria-label":"Wishlist",children:(0,ve.jsx)(qa,{})})]})]})]})]})})]}),(0,ve.jsx)(yo,{menuOpen:t})]})};function Ao(e,t){return function(){return e.apply(t,arguments)}}const{toString:xo}=Object.prototype,{getPrototypeOf:wo}=Object,So=(e=>t=>{const i=xo.call(t);return e[i]||(e[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),_o=e=>(e=e.toLowerCase(),t=>So(t)===e),Eo=e=>t=>typeof t===e,{isArray:Co}=Array,Mo=Eo("undefined");const To=_o("ArrayBuffer");const Io=Eo("string"),Po=Eo("function"),Do=Eo("number"),Ro=e=>null!==e&&"object"===typeof e,Bo=e=>{if("object"!==So(e))return!1;const t=wo(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Lo=_o("Date"),Oo=_o("File"),No=_o("Blob"),ko=_o("FileList"),Fo=_o("URLSearchParams"),[Uo,zo,jo,Vo]=["ReadableStream","Request","Response","Headers"].map(_o);function Go(e,t){let i,n,{allOwnKeys:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),Co(e))for(i=0,n=e.length;i<n;i++)t.call(null,e[i],i,e);else{const n=r?Object.getOwnPropertyNames(e):Object.keys(e),s=n.length;let a;for(i=0;i<s;i++)a=n[i],t.call(null,e[a],a,e)}}function Ho(e,t){t=t.toLowerCase();const i=Object.keys(e);let n,r=i.length;for(;r-- >0;)if(n=i[r],t===n.toLowerCase())return n;return null}const Wo="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,Qo=e=>!Mo(e)&&e!==Wo;const qo=(Xo="undefined"!==typeof Uint8Array&&wo(Uint8Array),e=>Xo&&e instanceof Xo);var Xo;const Yo=_o("HTMLFormElement"),Ko=(e=>{let{hasOwnProperty:t}=e;return(e,i)=>t.call(e,i)})(Object.prototype),Jo=_o("RegExp"),Zo=(e,t)=>{const i=Object.getOwnPropertyDescriptors(e),n={};Go(i,((i,r)=>{let s;!1!==(s=t(i,r,e))&&(n[r]=s||i)})),Object.defineProperties(e,n)},$o="abcdefghijklmnopqrstuvwxyz",el="0123456789",tl={DIGIT:el,ALPHA:$o,ALPHA_DIGIT:$o+$o.toUpperCase()+el};const il=_o("AsyncFunction"),nl=((e,t)=>{return e?setImmediate:t?(i=`axios@${Math.random()}`,n=[],Wo.addEventListener("message",(e=>{let{source:t,data:r}=e;t===Wo&&r===i&&n.length&&n.shift()()}),!1),e=>{n.push(e),Wo.postMessage(i,"*")}):e=>setTimeout(e);var i,n})("function"===typeof setImmediate,Po(Wo.postMessage)),rl="undefined"!==typeof queueMicrotask?queueMicrotask.bind(Wo):"undefined"!==typeof process&&process.nextTick||nl,sl={isArray:Co,isArrayBuffer:To,isBuffer:function(e){return null!==e&&!Mo(e)&&null!==e.constructor&&!Mo(e.constructor)&&Po(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||Po(e.append)&&("formdata"===(t=So(e))||"object"===t&&Po(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&To(e.buffer),t},isString:Io,isNumber:Do,isBoolean:e=>!0===e||!1===e,isObject:Ro,isPlainObject:Bo,isReadableStream:Uo,isRequest:zo,isResponse:jo,isHeaders:Vo,isUndefined:Mo,isDate:Lo,isFile:Oo,isBlob:No,isRegExp:Jo,isFunction:Po,isStream:e=>Ro(e)&&Po(e.pipe),isURLSearchParams:Fo,isTypedArray:qo,isFileList:ko,forEach:Go,merge:function e(){const{caseless:t}=Qo(this)&&this||{},i={},n=(n,r)=>{const s=t&&Ho(i,r)||r;Bo(i[s])&&Bo(n)?i[s]=e(i[s],n):Bo(n)?i[s]=e({},n):Co(n)?i[s]=n.slice():i[s]=n};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Go(arguments[r],n);return i},extend:function(e,t,i){let{allOwnKeys:n}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Go(t,((t,n)=>{i&&Po(t)?e[n]=Ao(t,i):e[n]=t}),{allOwnKeys:n}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,i,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,t,i,n)=>{let r,s,a;const o={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),s=r.length;s-- >0;)a=r[s],n&&!n(a,e,t)||o[a]||(t[a]=e[a],o[a]=!0);e=!1!==i&&wo(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},kindOf:So,kindOfTest:_o,endsWith:(e,t,i)=>{e=String(e),(void 0===i||i>e.length)&&(i=e.length),i-=t.length;const n=e.indexOf(t,i);return-1!==n&&n===i},toArray:e=>{if(!e)return null;if(Co(e))return e;let t=e.length;if(!Do(t))return null;const i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},forEachEntry:(e,t)=>{const i=(e&&e[Symbol.iterator]).call(e);let n;for(;(n=i.next())&&!n.done;){const i=n.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let i;const n=[];for(;null!==(i=e.exec(t));)n.push(i);return n},isHTMLForm:Yo,hasOwnProperty:Ko,hasOwnProp:Ko,reduceDescriptors:Zo,freezeMethods:e=>{Zo(e,((t,i)=>{if(Po(e)&&-1!==["arguments","caller","callee"].indexOf(i))return!1;const n=e[i];Po(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))}))},toObjectSet:(e,t)=>{const i={},n=e=>{e.forEach((e=>{i[e]=!0}))};return Co(e)?n(e):n(String(e).split(t)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,i){return t.toUpperCase()+i})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Ho,global:Wo,isContextDefined:Qo,ALPHABET:tl,generateString:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tl.ALPHA_DIGIT,i="";const{length:n}=t;for(;e--;)i+=t[Math.random()*n|0];return i},isSpecCompliantForm:function(e){return!!(e&&Po(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),i=(e,n)=>{if(Ro(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const r=Co(e)?[]:{};return Go(e,((e,t)=>{const s=i(e,n+1);!Mo(s)&&(r[t]=s)})),t[n]=void 0,r}}return e};return i(e,0)},isAsyncFn:il,isThenable:e=>e&&(Ro(e)||Po(e))&&Po(e.then)&&Po(e.catch),setImmediate:nl,asap:rl};function al(e,t,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}sl.inherits(al,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:sl.toJSONObject(this.config),code:this.code,status:this.status}}});const ol=al.prototype,ll={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{ll[e]={value:e}})),Object.defineProperties(al,ll),Object.defineProperty(ol,"isAxiosError",{value:!0}),al.from=(e,t,i,n,r,s)=>{const a=Object.create(ol);return sl.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),al.call(a,e.message,t,i,n,r),a.cause=e,a.name=e.name,s&&Object.assign(a,s),a};const cl=al;function hl(e){return sl.isPlainObject(e)||sl.isArray(e)}function dl(e){return sl.endsWith(e,"[]")?e.slice(0,-2):e}function ul(e,t,i){return e?e.concat(t).map((function(e,t){return e=dl(e),!i&&t?"["+e+"]":e})).join(i?".":""):t}const pl=sl.toFlatObject(sl,{},null,(function(e){return/^is[A-Z]/.test(e)}));const fl=function(e,t,i){if(!sl.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(i=sl.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!sl.isUndefined(t[e])}))).metaTokens,r=i.visitor||c,s=i.dots,a=i.indexes,o=(i.Blob||"undefined"!==typeof Blob&&Blob)&&sl.isSpecCompliantForm(t);if(!sl.isFunction(r))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(sl.isDate(e))return e.toISOString();if(!o&&sl.isBlob(e))throw new cl("Blob is not supported. Use a Buffer instead.");return sl.isArrayBuffer(e)||sl.isTypedArray(e)?o&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,i,r){let o=e;if(e&&!r&&"object"===typeof e)if(sl.endsWith(i,"{}"))i=n?i:i.slice(0,-2),e=JSON.stringify(e);else if(sl.isArray(e)&&function(e){return sl.isArray(e)&&!e.some(hl)}(e)||(sl.isFileList(e)||sl.endsWith(i,"[]"))&&(o=sl.toArray(e)))return i=dl(i),o.forEach((function(e,n){!sl.isUndefined(e)&&null!==e&&t.append(!0===a?ul([i],n,s):null===a?i:i+"[]",l(e))})),!1;return!!hl(e)||(t.append(ul(r,i,s),l(e)),!1)}const h=[],d=Object.assign(pl,{defaultVisitor:c,convertValue:l,isVisitable:hl});if(!sl.isObject(e))throw new TypeError("data must be an object");return function e(i,n){if(!sl.isUndefined(i)){if(-1!==h.indexOf(i))throw Error("Circular reference detected in "+n.join("."));h.push(i),sl.forEach(i,(function(i,s){!0===(!(sl.isUndefined(i)||null===i)&&r.call(t,i,sl.isString(s)?s.trim():s,n,d))&&e(i,n?n.concat(s):[s])})),h.pop()}}(e),t};function ml(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function gl(e,t){this._pairs=[],e&&fl(e,this,t)}const vl=gl.prototype;vl.append=function(e,t){this._pairs.push([e,t])},vl.toString=function(e){const t=e?function(t){return e.call(this,t,ml)}:ml;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const yl=gl;function bl(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Al(e,t,i){if(!t)return e;const n=i&&i.encode||bl,r=i&&i.serialize;let s;if(s=r?r(t,i):sl.isURLSearchParams(t)?t.toString():new yl(t,i).toString(n),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}const xl=class{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){sl.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},wl={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Sl={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:yl,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},_l="undefined"!==typeof window&&"undefined"!==typeof document,El="object"===typeof navigator&&navigator||void 0,Cl=_l&&(!El||["ReactNative","NativeScript","NS"].indexOf(El.product)<0),Ml="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,Tl=_l&&window.location.href||"http://localhost",Il={...e,...Sl};const Pl=function(e){function t(e,i,n,r){let s=e[r++];if("__proto__"===s)return!0;const a=Number.isFinite(+s),o=r>=e.length;if(s=!s&&sl.isArray(n)?n.length:s,o)return sl.hasOwnProp(n,s)?n[s]=[n[s],i]:n[s]=i,!a;n[s]&&sl.isObject(n[s])||(n[s]=[]);return t(e,i,n[s],r)&&sl.isArray(n[s])&&(n[s]=function(e){const t={},i=Object.keys(e);let n;const r=i.length;let s;for(n=0;n<r;n++)s=i[n],t[s]=e[s];return t}(n[s])),!a}if(sl.isFormData(e)&&sl.isFunction(e.entries)){const i={};return sl.forEachEntry(e,((e,n)=>{t(function(e){return sl.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),n,i,0)})),i}return null};const Dl={transitional:wl,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const i=t.getContentType()||"",n=i.indexOf("application/json")>-1,r=sl.isObject(e);r&&sl.isHTMLForm(e)&&(e=new FormData(e));if(sl.isFormData(e))return n?JSON.stringify(Pl(e)):e;if(sl.isArrayBuffer(e)||sl.isBuffer(e)||sl.isStream(e)||sl.isFile(e)||sl.isBlob(e)||sl.isReadableStream(e))return e;if(sl.isArrayBufferView(e))return e.buffer;if(sl.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(r){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return fl(e,new Il.classes.URLSearchParams,Object.assign({visitor:function(e,t,i,n){return Il.isNode&&sl.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=sl.isFileList(e))||i.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return fl(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||n?(t.setContentType("application/json",!1),function(e,t,i){if(sl.isString(e))try{return(t||JSON.parse)(e),sl.trim(e)}catch(th){if("SyntaxError"!==th.name)throw th}return(i||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Dl.transitional,i=t&&t.forcedJSONParsing,n="json"===this.responseType;if(sl.isResponse(e)||sl.isReadableStream(e))return e;if(e&&sl.isString(e)&&(i&&!this.responseType||n)){const i=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(th){if(i){if("SyntaxError"===th.name)throw cl.from(th,cl.ERR_BAD_RESPONSE,this,null,this.response);throw th}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Il.classes.FormData,Blob:Il.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};sl.forEach(["delete","get","head","post","put","patch"],(e=>{Dl.headers[e]={}}));const Rl=Dl,Bl=sl.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ll=Symbol("internals");function Ol(e){return e&&String(e).trim().toLowerCase()}function Nl(e){return!1===e||null==e?e:sl.isArray(e)?e.map(Nl):String(e)}function kl(e,t,i,n,r){return sl.isFunction(n)?n.call(this,t,i):(r&&(t=i),sl.isString(t)?sl.isString(n)?-1!==t.indexOf(n):sl.isRegExp(n)?n.test(t):void 0:void 0)}class Fl{constructor(e){e&&this.set(e)}set(e,t,i){const n=this;function r(e,t,i){const r=Ol(t);if(!r)throw new Error("header name must be a non-empty string");const s=sl.findKey(n,r);(!s||void 0===n[s]||!0===i||void 0===i&&!1!==n[s])&&(n[s||t]=Nl(e))}const s=(e,t)=>sl.forEach(e,((e,i)=>r(e,i,t)));if(sl.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(sl.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))s((e=>{const t={};let i,n,r;return e&&e.split("\n").forEach((function(e){r=e.indexOf(":"),i=e.substring(0,r).trim().toLowerCase(),n=e.substring(r+1).trim(),!i||t[i]&&Bl[i]||("set-cookie"===i?t[i]?t[i].push(n):t[i]=[n]:t[i]=t[i]?t[i]+", "+n:n)})),t})(e),t);else if(sl.isHeaders(e))for(const[a,o]of e.entries())r(o,a,i);else null!=e&&r(t,e,i);return this}get(e,t){if(e=Ol(e)){const i=sl.findKey(this,e);if(i){const e=this[i];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(e);)t[n[1]]=n[2];return t}(e);if(sl.isFunction(t))return t.call(this,e,i);if(sl.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ol(e)){const i=sl.findKey(this,e);return!(!i||void 0===this[i]||t&&!kl(0,this[i],i,t))}return!1}delete(e,t){const i=this;let n=!1;function r(e){if(e=Ol(e)){const r=sl.findKey(i,e);!r||t&&!kl(0,i[r],r,t)||(delete i[r],n=!0)}}return sl.isArray(e)?e.forEach(r):r(e),n}clear(e){const t=Object.keys(this);let i=t.length,n=!1;for(;i--;){const r=t[i];e&&!kl(0,this[r],r,e,!0)||(delete this[r],n=!0)}return n}normalize(e){const t=this,i={};return sl.forEach(this,((n,r)=>{const s=sl.findKey(i,r);if(s)return t[s]=Nl(n),void delete t[r];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,i)=>t.toUpperCase()+i))}(r):String(r).trim();a!==r&&delete t[r],t[a]=Nl(n),i[a]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return sl.forEach(this,((i,n)=>{null!=i&&!1!==i&&(t[n]=e&&sl.isArray(i)?i.join(", "):i)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,i]=e;return t+": "+i})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return n.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[Ll]=this[Ll]={accessors:{}}).accessors,i=this.prototype;function n(e){const n=Ol(e);t[n]||(!function(e,t){const i=sl.toCamelCase(" "+t);["get","set","has"].forEach((n=>{Object.defineProperty(e,n+i,{value:function(e,i,r){return this[n].call(this,t,e,i,r)},configurable:!0})}))}(i,e),t[n]=!0)}return sl.isArray(e)?e.forEach(n):n(e),this}}Fl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),sl.reduceDescriptors(Fl.prototype,((e,t)=>{let{value:i}=e,n=t[0].toUpperCase()+t.slice(1);return{get:()=>i,set(e){this[n]=e}}})),sl.freezeMethods(Fl);const Ul=Fl;function zl(e,t){const i=this||Rl,n=t||i,r=Ul.from(n.headers);let s=n.data;return sl.forEach(e,(function(e){s=e.call(i,s,r.normalize(),t?t.status:void 0)})),r.normalize(),s}function jl(e){return!(!e||!e.__CANCEL__)}function Vl(e,t,i){cl.call(this,null==e?"canceled":e,cl.ERR_CANCELED,t,i),this.name="CanceledError"}sl.inherits(Vl,cl,{__CANCEL__:!0});const Gl=Vl;function Hl(e,t,i){const n=i.config.validateStatus;i.status&&n&&!n(i.status)?t(new cl("Request failed with status code "+i.status,[cl.ERR_BAD_REQUEST,cl.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}const Wl=function(e,t){e=e||10;const i=new Array(e),n=new Array(e);let r,s=0,a=0;return t=void 0!==t?t:1e3,function(o){const l=Date.now(),c=n[a];r||(r=l),i[s]=o,n[s]=l;let h=a,d=0;for(;h!==s;)d+=i[h++],h%=e;if(s=(s+1)%e,s===a&&(a=(a+1)%e),l-r<t)return;const u=c&&l-c;return u?Math.round(1e3*d/u):void 0}};const Ql=function(e,t){let i,n,r=0,s=1e3/t;const a=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();r=s,i=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-r;for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];t>=s?a(l,e):(i=l,n||(n=setTimeout((()=>{n=null,a(i)}),s-t)))},()=>i&&a(i)]},ql=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=0;const r=Wl(50,250);return Ql((i=>{const s=i.loaded,a=i.lengthComputable?i.total:void 0,o=s-n,l=r(o);n=s;e({loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:l||void 0,estimated:l&&a&&s<=a?(a-s)/l:void 0,event:i,lengthComputable:null!=a,[t?"download":"upload"]:!0})}),i)},Xl=(e,t)=>{const i=null!=e;return[n=>t[0]({lengthComputable:i,total:e,loaded:n}),t[1]]},Yl=e=>function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return sl.asap((()=>e(...i)))},Kl=Il.hasStandardBrowserEnv?function(){const e=Il.navigator&&/(msie|trident)/i.test(Il.navigator.userAgent),t=document.createElement("a");let i;function n(i){let n=i;return e&&(t.setAttribute("href",n),n=t.href),t.setAttribute("href",n),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return i=n(window.location.href),function(e){const t=sl.isString(e)?n(e):e;return t.protocol===i.protocol&&t.host===i.host}}():function(){return!0},Jl=Il.hasStandardBrowserEnv?{write(e,t,i,n,r,s){const a=[e+"="+encodeURIComponent(t)];sl.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),sl.isString(n)&&a.push("path="+n),sl.isString(r)&&a.push("domain="+r),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Zl(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const $l=e=>e instanceof Ul?{...e}:e;function ec(e,t){t=t||{};const i={};function n(e,t,i){return sl.isPlainObject(e)&&sl.isPlainObject(t)?sl.merge.call({caseless:i},e,t):sl.isPlainObject(t)?sl.merge({},t):sl.isArray(t)?t.slice():t}function r(e,t,i){return sl.isUndefined(t)?sl.isUndefined(e)?void 0:n(void 0,e,i):n(e,t,i)}function s(e,t){if(!sl.isUndefined(t))return n(void 0,t)}function a(e,t){return sl.isUndefined(t)?sl.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function o(i,r,s){return s in t?n(i,r):s in e?n(void 0,i):void 0}const l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t)=>r($l(e),$l(t),!0)};return sl.forEach(Object.keys(Object.assign({},e,t)),(function(n){const s=l[n]||r,a=s(e[n],t[n],n);sl.isUndefined(a)&&s!==o||(i[n]=a)})),i}const tc=e=>{const t=ec({},e);let i,{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:a,headers:o,auth:l}=t;if(t.headers=o=Ul.from(o),t.url=Al(Zl(t.baseURL,t.url),e.params,e.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),sl.isFormData(n))if(Il.hasStandardBrowserEnv||Il.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(!1!==(i=o.getContentType())){const[e,...t]=i?i.split(";").map((e=>e.trim())).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}if(Il.hasStandardBrowserEnv&&(r&&sl.isFunction(r)&&(r=r(t)),r||!1!==r&&Kl(t.url))){const e=s&&a&&Jl.read(a);e&&o.set(s,e)}return t},ic="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise((function(t,i){const n=tc(e);let r=n.data;const s=Ul.from(n.headers).normalize();let a,o,l,c,h,{responseType:d,onUploadProgress:u,onDownloadProgress:p}=n;function f(){c&&c(),h&&h(),n.cancelToken&&n.cancelToken.unsubscribe(a),n.signal&&n.signal.removeEventListener("abort",a)}let m=new XMLHttpRequest;function g(){if(!m)return;const n=Ul.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());Hl((function(e){t(e),f()}),(function(e){i(e),f()}),{data:d&&"text"!==d&&"json"!==d?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:n,config:e,request:m}),m=null}m.open(n.method.toUpperCase(),n.url,!0),m.timeout=n.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(g)},m.onabort=function(){m&&(i(new cl("Request aborted",cl.ECONNABORTED,e,m)),m=null)},m.onerror=function(){i(new cl("Network Error",cl.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const r=n.transitional||wl;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),i(new cl(t,r.clarifyTimeoutError?cl.ETIMEDOUT:cl.ECONNABORTED,e,m)),m=null},void 0===r&&s.setContentType(null),"setRequestHeader"in m&&sl.forEach(s.toJSON(),(function(e,t){m.setRequestHeader(t,e)})),sl.isUndefined(n.withCredentials)||(m.withCredentials=!!n.withCredentials),d&&"json"!==d&&(m.responseType=n.responseType),p&&([l,h]=ql(p,!0),m.addEventListener("progress",l)),u&&m.upload&&([o,c]=ql(u),m.upload.addEventListener("progress",o),m.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(a=t=>{m&&(i(!t||t.type?new Gl(null,e,m):t),m.abort(),m=null)},n.cancelToken&&n.cancelToken.subscribe(a),n.signal&&(n.signal.aborted?a():n.signal.addEventListener("abort",a)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);v&&-1===Il.protocols.indexOf(v)?i(new cl("Unsupported protocol "+v+":",cl.ERR_BAD_REQUEST,e)):m.send(r||null)}))},nc=(e,t)=>{let i,n=new AbortController;const r=function(e){if(!i){i=!0,a();const t=e instanceof Error?e:this.reason;n.abort(t instanceof cl?t:new Gl(t instanceof Error?t.message:t))}};let s=t&&setTimeout((()=>{r(new cl(`timeout ${t} of ms exceeded`,cl.ETIMEDOUT))}),t);const a=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach((e=>{e&&(e.removeEventListener?e.removeEventListener("abort",r):e.unsubscribe(r))})),e=null)};e.forEach((e=>e&&e.addEventListener&&e.addEventListener("abort",r)));const{signal:o}=n;return o.unsubscribe=a,[o,()=>{s&&clearTimeout(s),s=null}]},rc=function*(e,t){let i=e.byteLength;if(!t||i<t)return void(yield e);let n,r=0;for(;r<i;)n=r+t,yield e.slice(r,n),r=n},sc=(e,t,i,n,r)=>{const s=async function*(e,t,i){for await(const n of e)yield*rc(ArrayBuffer.isView(n)?n:await i(String(n)),t)}(e,t,r);let a,o=0,l=e=>{a||(a=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await s.next();if(t)return l(),void e.close();let r=n.byteLength;if(i){let e=o+=r;i(e)}e.enqueue(new Uint8Array(n))}catch(KR){throw l(KR),KR}},cancel:e=>(l(e),s.return())},{highWaterMark:2})},ac="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,oc=ac&&"function"===typeof ReadableStream,lc=ac&&("function"===typeof TextEncoder?(cc=new TextEncoder,e=>cc.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var cc;const hc=function(e){try{for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return!!e(...i)}catch(th){return!1}},dc=oc&&hc((()=>{let e=!1;const t=new Request(Il.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),uc=oc&&hc((()=>sl.isReadableStream(new Response("").body))),pc={stream:uc&&(e=>e.body)};var fc;ac&&(fc=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!pc[e]&&(pc[e]=sl.isFunction(fc[e])?t=>t[e]():(t,i)=>{throw new cl(`Response type '${e}' is not supported`,cl.ERR_NOT_SUPPORT,i)})})));const mc=async(e,t)=>{const i=sl.toFiniteNumber(e.getContentLength());return null==i?(async e=>null==e?0:sl.isBlob(e)?e.size:sl.isSpecCompliantForm(e)?(await new Request(e).arrayBuffer()).byteLength:sl.isArrayBufferView(e)||sl.isArrayBuffer(e)?e.byteLength:(sl.isURLSearchParams(e)&&(e+=""),sl.isString(e)?(await lc(e)).byteLength:void 0))(t):i},gc=ac&&(async e=>{let{url:t,method:i,data:n,signal:r,cancelToken:s,timeout:a,onDownloadProgress:o,onUploadProgress:l,responseType:c,headers:h,withCredentials:d="same-origin",fetchOptions:u}=tc(e);c=c?(c+"").toLowerCase():"text";let p,f,[m,g]=r||s||a?nc([r,s],a):[];const v=()=>{!p&&setTimeout((()=>{m&&m.unsubscribe()})),p=!0};let y;try{if(l&&dc&&"get"!==i&&"head"!==i&&0!==(y=await mc(h,n))){let e,i=new Request(t,{method:"POST",body:n,duplex:"half"});if(sl.isFormData(n)&&(e=i.headers.get("content-type"))&&h.setContentType(e),i.body){const[e,t]=Xl(y,ql(Yl(l)));n=sc(i.body,65536,e,t,lc)}}sl.isString(d)||(d=d?"include":"omit");const r="credentials"in Request.prototype;f=new Request(t,{...u,signal:m,method:i.toUpperCase(),headers:h.normalize().toJSON(),body:n,duplex:"half",credentials:r?d:void 0});let s=await fetch(f);const a=uc&&("stream"===c||"response"===c);if(uc&&(o||a)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=s[t]}));const t=sl.toFiniteNumber(s.headers.get("content-length")),[i,n]=o&&Xl(t,ql(Yl(o),!0))||[];s=new Response(sc(s.body,65536,i,(()=>{n&&n(),a&&v()}),lc),e)}c=c||"text";let p=await pc[sl.findKey(pc,c)||"text"](s,e);return!a&&v(),g&&g(),await new Promise(((t,i)=>{Hl(t,i,{data:p,headers:Ul.from(s.headers),status:s.status,statusText:s.statusText,config:e,request:f})}))}catch(KR){if(v(),KR&&"TypeError"===KR.name&&/fetch/i.test(KR.message))throw Object.assign(new cl("Network Error",cl.ERR_NETWORK,e,f),{cause:KR.cause||KR});throw cl.from(KR,KR&&KR.code,e,f)}}),vc={http:null,xhr:ic,fetch:gc};sl.forEach(vc,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(th){}Object.defineProperty(e,"adapterName",{value:t})}}));const yc=e=>`- ${e}`,bc=e=>sl.isFunction(e)||null===e||!1===e,Ac=e=>{e=sl.isArray(e)?e:[e];const{length:t}=e;let i,n;const r={};for(let s=0;s<t;s++){let t;if(i=e[s],n=i,!bc(i)&&(n=vc[(t=String(i)).toLowerCase()],void 0===n))throw new cl(`Unknown adapter '${t}'`);if(n)break;r[t||"#"+s]=n}if(!n){const e=Object.entries(r).map((e=>{let[t,i]=e;return`adapter ${t} `+(!1===i?"is not supported by the environment":"is not available in the build")}));let i=t?e.length>1?"since :\n"+e.map(yc).join("\n"):" "+yc(e[0]):"as no adapter specified";throw new cl("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return n};function xc(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Gl(null,e)}function wc(e){xc(e),e.headers=Ul.from(e.headers),e.data=zl.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Ac(e.adapter||Rl.adapter)(e).then((function(t){return xc(e),t.data=zl.call(e,e.transformResponse,t),t.headers=Ul.from(t.headers),t}),(function(t){return jl(t)||(xc(e),t&&t.response&&(t.response.data=zl.call(e,e.transformResponse,t.response),t.response.headers=Ul.from(t.response.headers))),Promise.reject(t)}))}const Sc="1.7.5",_c={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{_c[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}}));const Ec={};_c.transitional=function(e,t,i){function n(e,t){return"[Axios v1.7.5] Transitional option '"+e+"'"+t+(i?". "+i:"")}return(i,r,s)=>{if(!1===e)throw new cl(n(r," has been removed"+(t?" in "+t:"")),cl.ERR_DEPRECATED);return t&&!Ec[r]&&(Ec[r]=!0,console.warn(n(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,r,s)}};const Cc={assertOptions:function(e,t,i){if("object"!==typeof e)throw new cl("options must be an object",cl.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let r=n.length;for(;r-- >0;){const s=n[r],a=t[s];if(a){const t=e[s],i=void 0===t||a(t,s,e);if(!0!==i)throw new cl("option "+s+" must be "+i,cl.ERR_BAD_OPTION_VALUE)}else if(!0!==i)throw new cl("Unknown option "+s,cl.ERR_BAD_OPTION)}},validators:_c},Mc=Cc.validators;class Tc{constructor(e){this.defaults=e,this.interceptors={request:new xl,response:new xl}}async request(e,t){try{return await this._request(e,t)}catch(KR){if(KR instanceof Error){let t;Error.captureStackTrace?Error.captureStackTrace(t={}):t=new Error;const i=t.stack?t.stack.replace(/^.+\n/,""):"";try{KR.stack?i&&!String(KR.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(KR.stack+="\n"+i):KR.stack=i}catch(th){}}throw KR}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=ec(this.defaults,t);const{transitional:i,paramsSerializer:n,headers:r}=t;void 0!==i&&Cc.assertOptions(i,{silentJSONParsing:Mc.transitional(Mc.boolean),forcedJSONParsing:Mc.transitional(Mc.boolean),clarifyTimeoutError:Mc.transitional(Mc.boolean)},!1),null!=n&&(sl.isFunction(n)?t.paramsSerializer={serialize:n}:Cc.assertOptions(n,{encode:Mc.function,serialize:Mc.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=r&&sl.merge(r.common,r[t.method]);r&&sl.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete r[e]})),t.headers=Ul.concat(s,r);const a=[];let o=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let h,d=0;if(!o){const e=[wc.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,l),h=e.length,c=Promise.resolve(t);d<h;)c=c.then(e[d++],e[d++]);return c}h=a.length;let u=t;for(d=0;d<h;){const e=a[d++],t=a[d++];try{u=e(u)}catch(p){t.call(this,p);break}}try{c=wc.call(this,u)}catch(p){return Promise.reject(p)}for(d=0,h=l.length;d<h;)c=c.then(l[d++],l[d++]);return c}getUri(e){return Al(Zl((e=ec(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}sl.forEach(["delete","get","head","options"],(function(e){Tc.prototype[e]=function(t,i){return this.request(ec(i||{},{method:e,url:t,data:(i||{}).data}))}})),sl.forEach(["post","put","patch"],(function(e){function t(t){return function(i,n,r){return this.request(ec(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:i,data:n}))}}Tc.prototype[e]=t(),Tc.prototype[e+"Form"]=t(!0)}));const Ic=Tc;class Pc{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const i=this;this.promise.then((e=>{if(!i._listeners)return;let t=i._listeners.length;for(;t-- >0;)i._listeners[t](e);i._listeners=null})),this.promise.then=e=>{let t;const n=new Promise((e=>{i.subscribe(e),t=e})).then(e);return n.cancel=function(){i.unsubscribe(t)},n},e((function(e,n,r){i.reason||(i.reason=new Gl(e,n,r),t(i.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;const t=new Pc((function(t){e=t}));return{token:t,cancel:e}}}const Dc=Pc;const Rc={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Rc).forEach((e=>{let[t,i]=e;Rc[i]=t}));const Bc=Rc;const Lc=function e(t){const i=new Ic(t),n=Ao(Ic.prototype.request,i);return sl.extend(n,Ic.prototype,i,{allOwnKeys:!0}),sl.extend(n,i,null,{allOwnKeys:!0}),n.create=function(i){return e(ec(t,i))},n}(Rl);Lc.Axios=Ic,Lc.CanceledError=Gl,Lc.CancelToken=Dc,Lc.isCancel=jl,Lc.VERSION=Sc,Lc.toFormData=fl,Lc.AxiosError=cl,Lc.Cancel=Lc.CanceledError,Lc.all=function(e){return Promise.all(e)},Lc.spread=function(e){return function(t){return e.apply(null,t)}},Lc.isAxiosError=function(e){return sl.isObject(e)&&!0===e.isAxiosError},Lc.mergeConfig=ec,Lc.AxiosHeaders=Ul,Lc.formToJSON=e=>Pl(sl.isHTMLForm(e)?new FormData(e):e),Lc.getAdapter=Ac,Lc.HttpStatusCode=Bc,Lc.default=Lc;const Oc=Lc;function Nc(e){return Fi({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{id:"Badge_Dollar"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M12,21.953c-.895,0-1.545-.743-2.118-1.4a3.671,3.671,0,0,0-1.033-.946,3.8,3.8,0,0,0-1.466-.077,3.012,3.012,0,0,1-2.421-.494,3.014,3.014,0,0,1-.494-2.421,3.82,3.82,0,0,0-.077-1.466,3.671,3.671,0,0,0-.946-1.033c-.655-.573-1.4-1.222-1.4-2.118s.743-1.545,1.4-2.118a3.66,3.66,0,0,0,.946-1.034,3.815,3.815,0,0,0,.077-1.465,3.012,3.012,0,0,1,.494-2.421,3.015,3.015,0,0,1,2.422-.5A3.794,3.794,0,0,0,8.849,4.39a3.666,3.666,0,0,0,1.033-.945c.573-.655,1.223-1.4,2.118-1.4s1.545.742,2.118,1.4a3.66,3.66,0,0,0,1.034.946,3.807,3.807,0,0,0,1.464.077,3.018,3.018,0,0,1,2.422.5,3.012,3.012,0,0,1,.5,2.422,3.81,3.81,0,0,0,.077,1.464,3.66,3.66,0,0,0,.946,1.034c.655.573,1.4,1.223,1.4,2.118s-.743,1.545-1.4,2.118a3.666,3.666,0,0,0-.945,1.033,3.815,3.815,0,0,0-.077,1.465,3.012,3.012,0,0,1-.5,2.422,3.018,3.018,0,0,1-2.421.494,3.818,3.818,0,0,0-1.465.077,3.673,3.673,0,0,0-1.034.946C13.545,21.21,12.9,21.953,12,21.953ZM8.093,18.5a2.952,2.952,0,0,1,1.138.183,4.233,4.233,0,0,1,1.4,1.21c.454.52.924,1.057,1.365,1.057s.911-.537,1.366-1.057a4.225,4.225,0,0,1,1.4-1.21,4.365,4.365,0,0,1,1.908-.152c.672.041,1.366.085,1.653-.2s.245-.982.2-1.653a4.387,4.387,0,0,1,.152-1.909,4.241,4.241,0,0,1,1.209-1.4c.52-.454,1.057-.924,1.057-1.365s-.537-.911-1.057-1.365a4.234,4.234,0,0,1-1.209-1.4,4.381,4.381,0,0,1-.152-1.908c.041-.671.084-1.365-.2-1.653s-.982-.246-1.653-.2a4.384,4.384,0,0,1-1.908-.152,4.234,4.234,0,0,1-1.4-1.209c-.454-.52-.924-1.057-1.365-1.057s-.911.537-1.365,1.057a4.241,4.241,0,0,1-1.4,1.209,4.417,4.417,0,0,1-1.909.152c-.67-.041-1.364-.084-1.653.2s-.244.981-.2,1.652A4.37,4.37,0,0,1,5.314,9.23a4.226,4.226,0,0,1-1.21,1.4c-.52.454-1.057.925-1.057,1.365s.537.911,1.057,1.366a4.238,4.238,0,0,1,1.21,1.4,4.378,4.378,0,0,1,.152,1.91c-.041.672-.084,1.366.2,1.653s.98.245,1.653.2C7.578,18.519,7.838,18.5,8.093,18.5Z"},child:[]},{tag:"path",attr:{d:"M14.5,13.5a2.006,2.006,0,0,1-2,2v1.01A.5.5,0,0,1,12,17a.492.492,0,0,1-.5-.49V15.5h-1.25a.5.5,0,0,1-.5-.5.5.5,0,0,1,.5-.5H12.5a1,1,0,1,0,0-2h-1a2,2,0,0,1,0-4V7.453A.473.473,0,0,1,12,7a.48.48,0,0,1,.5.45V8.5h1.25a.5.5,0,0,1,.5.5.508.508,0,0,1-.5.5H11.5a1,1,0,0,0,0,2h1A2,2,0,0,1,14.5,13.5Z"},child:[]}]}]}]})(e)}function kc(e){return Fi({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"},child:[]}]})(e)}function Fc(e){return Fi({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 15l6 -6"},child:[]},{tag:"circle",attr:{cx:"9.5",cy:"9.5",r:".5",fill:"currentColor"},child:[]},{tag:"circle",attr:{cx:"14.5",cy:"14.5",r:".5",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"},child:[]}]})(e)}function Uc(e){return Fi({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M7 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M17 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M5 17h-2v-4m-1 -8h11v12m-4 0h6m4 0h2v-6h-8m0 -5h5l3 5"},child:[]},{tag:"path",attr:{d:"M3 9l4 0"},child:[]}]})(e)}const zc=()=>(0,ve.jsx)("footer",{children:(0,ve.jsxs)("div",{className:"container",children:[(0,ve.jsxs)("div",{className:"topInfo row",children:[(0,ve.jsxs)("div",{className:"col d-flex align-items-center",children:[(0,ve.jsxs)("span",{children:[(0,ve.jsx)(kc,{})," "]}),(0,ve.jsx)("span",{classname:"ml-2",children:"Newly Products"})]}),(0,ve.jsxs)("div",{className:"col d-flex align-items-center",children:[(0,ve.jsxs)("span",{children:[(0,ve.jsx)(Uc,{})," "]}),(0,ve.jsx)("span",{classname:"ml-2",children:"Free delivery for order over $20"})]}),(0,ve.jsxs)("div",{className:"col d-flex align-items-center",children:[(0,ve.jsxs)("span",{children:[(0,ve.jsx)(Fc,{})," "]}),(0,ve.jsx)("span",{classname:"ml-2",children:"Daily Mega Discounts"})]}),(0,ve.jsxs)("div",{className:"col d-flex align-items-center",children:[(0,ve.jsxs)("span",{children:[(0,ve.jsx)(Nc,{})," "]}),(0,ve.jsx)("span",{classname:"ml-2",children:"Best price for market"})]})]}),(0,ve.jsxs)("div",{className:"row mt-5 linksWrap",children:[(0,ve.jsxs)("div",{className:"col ",children:[(0,ve.jsx)("h5",{children:"Quick Link"}),(0,ve.jsx)("h4",{class:"webintern_footer_title h5"}),(0,ve.jsxs)("ul",{children:[(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"About Us"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Home"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Services"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Email"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Delivery"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Help"})})]})]}),(0,ve.jsxs)("div",{className:"col ",children:[(0,ve.jsx)("h5",{children:"Accounts"}),(0,ve.jsx)("h4",{class:"webintern_footer_title h5"}),(0,ve.jsxs)("ul",{children:[(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"About Us"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Mission"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Social"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Services"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Activate Cards"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Rules"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Contact"})})]})]}),(0,ve.jsxs)("div",{className:"col ",children:[(0,ve.jsx)("h5",{children:"Products"}),(0,ve.jsx)("h4",{class:"webintern_footer_title h5"}),(0,ve.jsxs)("ul",{children:[(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"BrandFlow"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Redeem Code"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Services"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Awards"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Supply"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Return"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"pricing"})})]})]}),(0,ve.jsxs)("div",{className:"col ",children:[(0,ve.jsx)("h5",{children:"Company"}),(0,ve.jsx)("h4",{class:"webintern_footer_title h5"}),(0,ve.jsxs)("ul",{children:[(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Buy a gift card"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"History"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Services"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Return"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Sales"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Delivery&payment"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Email"})})]})]}),(0,ve.jsxs)("div",{className:"col ",children:[(0,ve.jsx)("h5",{children:"Assistance"}),(0,ve.jsx)("h4",{class:"webintern_footer_title h5"}),(0,ve.jsxs)("ul",{children:[(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Contact Us"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"FAQ"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Collections"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Shipping Information"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Sales"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(ka,{to:"#",children:"Size Guide"})})]})]})]}),(0,ve.jsxs)("div",{className:"copyright mt-3 pt-3 pb-3 d-flex",children:[(0,ve.jsx)("p",{className:"mb-0",children:"Copyright 2024. All rights reserved."}),(0,ve.jsxs)("ul",{className:"list list-inline ml-auto mb-0",children:[(0,ve.jsx)("li",{classaName:" list-list-item",children:(0,ve.jsx)(ka,{to:"#",children:(0,ve.jsx)(so,{})})}),(0,ve.jsx)("li",{classaName:" list list-item",children:(0,ve.jsx)(ka,{to:"#",children:(0,ve.jsx)(lo,{})})}),(0,ve.jsx)("li",{classaName:" list list-item",children:(0,ve.jsx)(ka,{to:"#",children:(0,ve.jsx)(oo,{})})}),(0,ve.jsx)("li",{classaName:" list list-item",children:(0,ve.jsx)(ka,{to:"#",children:(0,ve.jsx)(ao,{})})})]})]})]})});function jc(e){return Fi({tag:"svg",attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M7.81825 1.18188C7.64251 1.00615 7.35759 1.00615 7.18185 1.18188L4.18185 4.18188C4.00611 4.35762 4.00611 4.64254 4.18185 4.81828C4.35759 4.99401 4.64251 4.99401 4.81825 4.81828L7.05005 2.58648V9.49996C7.05005 9.74849 7.25152 9.94996 7.50005 9.94996C7.74858 9.94996 7.95005 9.74849 7.95005 9.49996V2.58648L10.1819 4.81828C10.3576 4.99401 10.6425 4.99401 10.8182 4.81828C10.994 4.64254 10.994 4.35762 10.8182 4.18188L7.81825 1.18188ZM2.5 9.99997C2.77614 9.99997 3 10.2238 3 10.5V12C3 12.5538 3.44565 13 3.99635 13H11.0012C11.5529 13 12 12.5528 12 12V10.5C12 10.2238 12.2239 9.99997 12.5 9.99997C12.7761 9.99997 13 10.2238 13 10.5V12C13 13.104 12.1062 14 11.0012 14H3.99635C2.89019 14 2 13.103 2 12V10.5C2 10.2238 2.22386 9.99997 2.5 9.99997Z",fill:"currentColor"},child:[]}]})(e)}function Vc(){return Vc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},Vc.apply(this,arguments)}var Gc=function(e){var t=e.src,i=e.sources,r=e.width,s=e.height,a=e.hasSpacer,o=e.imgAttributes,l=e.isZoomed,c=e.fadeDuration,h=r&&s&&a;return n.createElement("div",{style:{paddingTop:h?s/r*100+"%":null}},i&&i.length>0?n.createElement("picture",null,i.map((function(e,t){return n.createElement(n.Fragment,{key:t},e.srcSet&&n.createElement("source",e))})),n.createElement("img",Vc({},o,{className:"iiz__img "+(o.className||"")+" "+(l?"iiz__img--hidden":"")+" "+(h?"iiz__img--abs":""),style:{transition:"opacity 0ms linear "+(l?c:0)+"ms, visibility 0ms linear "+(l?c:0)+"ms"},src:t,width:r,height:s}))):n.createElement("img",Vc({},o,{className:"iiz__img "+(o.className||"")+" "+(l?"iiz__img--hidden":"")+" "+(h?"iiz__img--abs":""),style:{transition:"opacity 0ms linear "+(l?c:0)+"ms, visibility 0ms linear "+(l?c:0)+"ms"},src:t,width:r,height:s})))};Gc.propTypes={};const Hc=Gc;var Wc=function(e){var t=e.src,i=e.fadeDuration,r=e.top,s=e.left,a=e.isZoomed,o=e.onLoad,l=e.onDragStart,c=e.onDragEnd,h=e.onClose,d=e.onFadeOut;return n.createElement(n.Fragment,null,n.createElement("img",{className:"iiz__zoom-img "+(a?"iiz__zoom-img--visible":""),style:{top:r,left:s,transition:"opacity "+i+"ms linear, visibility "+i+"ms linear"},src:t,onLoad:o,onTouchStart:l,onTouchEnd:c,onMouseDown:l,onMouseUp:c,onTransitionEnd:d,draggable:"false",alt:""}),h&&n.createElement("button",{className:"iiz__btn iiz__close "+(a?"iiz__close--visible":""),style:{transition:"opacity "+i+"ms linear, visibility "+i+"ms linear"},onClick:h,"aria-label":"Zoom Out"}))};Wc.propTypes={};const Qc=Wc;var qc=i(5173),Xc=function(e){var t=e.children,i=(0,n.useState)((function(){var e=document.createElement("div");return e.classList.add("iiz__zoom-portal"),e}))[0];return(0,n.useEffect)((function(){return document.body.appendChild(i),function(){return document.body.removeChild(i)}}),[i]),(0,Ss.createPortal)(t,i)};Xc.propTypes={children:i.n(qc)().element};const Yc=Xc;var Kc=function(e){var t=e.moveType,i=void 0===t?"pan":t,r=e.zoomType,s=void 0===r?"click":r,a=e.src,o=e.sources,l=e.width,c=e.height,h=e.hasSpacer,d=e.imgAttributes,u=void 0===d?{}:d,p=e.zoomSrc,f=e.zoomScale,m=void 0===f?1:f,g=e.zoomPreload,v=e.fadeDuration,y=void 0===v?150:v,b=e.fullscreenOnMobile,A=e.mobileBreakpoint,x=void 0===A?640:A,w=e.hideCloseButton,S=e.hideHint,_=e.className,E=e.afterZoomIn,C=e.afterZoomOut,M=(0,n.useRef)(null),T=(0,n.useRef)(null),I=(0,n.useRef)({}),P=(0,n.useState)(g),D=P[0],R=P[1],B=(0,n.useState)(!1),L=B[0],O=B[1],N=(0,n.useState)(!1),k=N[0],F=N[1],U=(0,n.useState)(!1),z=U[0],j=U[1],V=(0,n.useState)(!1),G=V[0],H=V[1],W=(0,n.useState)(!1),Q=W[0],q=W[1],X=(0,n.useState)(!1),Y=X[0],K=X[1],J=(0,n.useState)(i),Z=J[0],$=J[1],ee=(0,n.useState)(0),te=ee[0],ie=ee[1],ne=(0,n.useState)(0),re=ne[0],se=ne[1],ae=function(e){k?L?w&&de(e):!Q&&fe():(L&&R(!0),T.current?(oe({target:T.current}),pe(e.pageX,e.pageY)):I.current.onLoadCallback=pe.bind(undefined,e.pageX,e.pageY))},oe=function(e){var t=Ae(e.target,m);T.current=e.target,T.current.setAttribute("width",t.width),T.current.setAttribute("height",t.height),I.current.scaledDimensions=t,I.current.bounds=ge(M.current,!1),I.current.ratios=ye(I.current.bounds,t),I.current.onLoadCallback&&(I.current.onLoadCallback(),I.current.onLoadCallback=null)},le=function(e){var t=e.pageX-I.current.offsets.x,i=e.pageY-I.current.offsets.y;t=Math.max(Math.min(t,I.current.bounds.width),0),i=Math.max(Math.min(i,I.current.bounds.height),0),ie(t*-I.current.ratios.x),se(i*-I.current.ratios.y)},ce=(0,n.useCallback)((function(e){e.stopPropagation();var t="number"===typeof e.pageX?e.pageX:e.changedTouches[0].pageX,i="number"===typeof e.pageY?e.pageY:e.changedTouches[0].pageY,n=t-I.current.offsets.x,r=i-I.current.offsets.y;n=Math.max(Math.min(n,0),-1*(I.current.scaledDimensions.width-I.current.bounds.width)),r=Math.max(Math.min(r,0),-1*(I.current.scaledDimensions.height-I.current.bounds.height)),ie(n),se(r)}),[]),he=function(e){if(H(!1),!L){var t=Math.abs(e.pageX-I.current.eventPosition.x),i=Math.abs(e.pageY-I.current.eventPosition.y);q(t>5||i>5)}},de=function(e){!L&&e.target.classList.contains("iiz__close")||(k&&!z&&y?K(!0):ue({},!0)),fe()},ue=function(e,t){(t||"opacity"===e.propertyName&&M.current.contains(e.target))&&((g&&L||!g)&&(T.current=null,I.current=me(),R(!1)),O(!1),j(!1),$(i),K(!1))},pe=function(e,t){F(!0),"drag"===Z?function(e,t){var i=(e-(window.pageXOffset+I.current.bounds.left))*-I.current.ratios.x,n=(t-(window.pageYOffset+I.current.bounds.top))*-I.current.ratios.y;i+=z?(window.innerWidth-I.current.bounds.width)/2:0,n+=z?(window.innerHeight-I.current.bounds.height)/2:0,I.current.bounds=ge(M.current,z),I.current.offsets=ve(0,0,0,0),ce({changedTouches:[{pageX:i,pageY:n}],preventDefault:function(){},stopPropagation:function(){}})}(e,t):function(e,t){I.current.offsets=ve(window.pageXOffset,window.pageYOffset,-I.current.bounds.left,-I.current.bounds.top),le({pageX:e,pageY:t})}(e,t),E&&E()},fe=function(){F(!1),C&&C()},me=function(){return{onLoadCallback:null,bounds:{},offsets:{},ratios:{},eventPosition:{},scaledDimensions:{}}},ge=function(e,t){return t?{width:window.innerWidth,height:window.innerHeight,left:0,top:0}:e.getBoundingClientRect()},ve=function(e,t,i,n){return{x:e-i,y:t-n}},ye=function(e,t){return{x:(t.width-e.width)/e.width,y:(t.height-e.height)/e.height}},be=function(e,t){return e&&window.matchMedia&&window.matchMedia("(max-width: "+t+"px)").matches},Ae=function(e,t){return{width:e.naturalWidth*t,height:e.naturalHeight*t}},xe={src:p||a,fadeDuration:z?0:y,top:re,left:te,isZoomed:k,onLoad:oe,onDragStart:"drag"===Z?function(e){var t="number"===typeof e.pageX?e.pageX:e.changedTouches[0].pageX,i="number"===typeof e.pageY?e.pageY:e.changedTouches[0].pageY;I.current.offsets=ve(t,i,T.current.offsetLeft,T.current.offsetTop),H(!0),L||(I.current.eventPosition={x:e.pageX,y:e.pageY})}:null,onDragEnd:"drag"===Z?he:null,onClose:w||"drag"!==Z?null:de,onFadeOut:Y?ue:null};return(0,n.useEffect)((function(){I.current=me()}),[]),(0,n.useEffect)((function(){be(b,x)&&R(!1)}),[b,x]),(0,n.useEffect)((function(){if(T.current){var e=L?"touchmove":"mousemove";G?T.current.addEventListener(e,ce,{passive:!0}):T.current.removeEventListener(e,ce)}}),[G,L,ce]),n.createElement("figure",{className:"iiz "+("drag"===Z?"iiz--drag":"")+" "+(_||""),style:{width:l},ref:M,onTouchStart:k?null:function(){O(!0),j(be(b,x)),$("drag")},onClick:ae,onMouseEnter:L?null:function(e){R(!0),K(!1),"hover"===s&&!k&&ae(e)},onMouseMove:"drag"!==Z&&k?le:null,onMouseLeave:L?null:function(e){"drag"===Z&&k?he(e):de(e)}},n.createElement(Hc,{src:a,sources:o,width:l,height:c,hasSpacer:h,imgAttributes:u,fadeDuration:y,isZoomed:k}),D&&n.createElement(n.Fragment,null,z?n.createElement(Yc,null,n.createElement(Qc,xe)):n.createElement(Qc,xe)),!S&&!k&&n.createElement("span",{className:"iiz__btn iiz__hint"}))};Kc.propTypes={};const Jc=Kc,Zc=()=>{const[e,t]=(0,n.useState)(1);return(0,ve.jsxs)("div",{className:"quantityDrop d-flex align-items-center mt-3",children:[(0,ve.jsx)(Ti,{onClick:()=>{1==e&&e>0&&t(e-1)},children:(0,ve.jsx)(Wa,{})}),(0,ve.jsx)("input",{type:"text",value:e}),(0,ve.jsx)(Ti,{onClick:()=>{t(e+1)},children:(0,ve.jsx)(Qa,{})})]})},$c=e=>{let{toggleFitQuiz:t}=e;const[i,r]=(0,n.useState)(1),[s,a]=(0,n.useState)("int"),[o,l]=(0,n.useState)(null),[c,h]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[p,f]=(0,n.useState)(null),[m,g]=(0,n.useState)(null),[v,y]=(0,n.useState)(null),[b,A]=(0,n.useState)(!0),x=e=>{h(e),r(3)},w=e=>{u(e),r(4)},S=e=>{f(e),r(5)},_=e=>{g(e),r(6)},E=e=>{y(e),alert(`Submitted! \nSize: ${o}, Fit: ${c}, Body Shape: ${d}, Chest: ${p}, Back: ${m}, Preferred Fit: ${e}`),C()},C=()=>{A(!1),t&&t()};return b?(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)("div",{className:"quiz-overlay",onClick:C}),(0,ve.jsxs)("div",{className:"quiz-container",children:[(0,ve.jsx)("button",{className:"close-btn",onClick:C,children:"\u2716"}),1===i&&(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)("h3",{children:"Take our Fit quiz"}),(0,ve.jsx)("h2",{children:"What dress size do you usually wear?"}),(0,ve.jsx)("div",{className:"tabs",children:["int","us","uk"].map((e=>(0,ve.jsx)("button",{className:"tab-button "+(s===e?"active":""),onClick:()=>(e=>a(e))(e),children:e.toUpperCase()},e)))}),(0,ve.jsx)("div",{className:"size-options",children:{int:["S","M","L","XL"],us:["4","6","8","10"],uk:["8","10","12","14"]}[s].map((e=>(0,ve.jsx)("button",{className:"size-btn "+(o===e?"selected":""),onClick:()=>(e=>{l(e),r(2)})(e),children:e},e)))})]}),2===i&&(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)("h3",{children:"Take our Fit quiz"}),(0,ve.jsx)("h2",{children:"Do you always wear this size?"}),(0,ve.jsx)("button",{className:"option-btn",onClick:()=>x("smaller"),children:"No, I sometimes wear a smaller size"}),(0,ve.jsx)("button",{className:"option-btn",onClick:()=>x("exact"),children:"Yes"}),(0,ve.jsx)("button",{className:"option-btn",onClick:()=>x("bigger"),children:"No, I sometimes wear a bigger size"})]}),3===i&&(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)("h3",{children:"Take our Fit quiz"}),(0,ve.jsx)("h2",{children:"What do you think is most like you?"}),(0,ve.jsxs)("div",{className:"body-shape-options",children:[(0,ve.jsxs)("button",{className:"body-btn",onClick:()=>w("slim"),children:[(0,ve.jsx)("img",{src:"https://cdn.prod.website-files.com/5eca30fd2b50b671e2107b06/5ee757f0fff23db587756365_Body%20Shapes%20Measurements%201.webp",alt:"Slim"}),(0,ve.jsx)("p",{children:"Slim"})]}),(0,ve.jsxs)("button",{className:"body-btn",onClick:()=>w("medium"),children:[(0,ve.jsx)("img",{src:"https://cdn.prod.website-files.com/5eca30fd2b50b671e2107b06/60c8c0248738a135a50409e1_Pear%20Body%20Shape%20Category%20Image.webp",alt:"Medium"}),(0,ve.jsx)("p",{children:"Medium"})]}),(0,ve.jsxs)("button",{className:"body-btn",onClick:()=>w("round"),children:[(0,ve.jsx)("img",{src:"https://cdn.prod.website-files.com/5eca30fd2b50b671e2107b06/5ee9442a0258fa44591cb4bf_Apple%20Body%20Shape%201-p-500.webp",alt:"Round"}),(0,ve.jsx)("p",{children:"Round"})]})]})]}),4===i&&(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)("h3",{children:"Take our Fit quiz"}),(0,ve.jsx)("h2",{children:"How would you describe your chest?"}),(0,ve.jsxs)("div",{className:"body-shape-options",children:[(0,ve.jsxs)("button",{className:"body-btn",onClick:()=>S("slim"),children:[(0,ve.jsx)("img",{src:"slim-chest.png",alt:"Slim"}),(0,ve.jsx)("p",{children:"Slim"})]}),(0,ve.jsxs)("button",{className:"body-btn",onClick:()=>S("medium"),children:[(0,ve.jsx)("img",{src:"average-chest.png",alt:"Medium"}),(0,ve.jsx)("p",{children:"Medium"})]}),(0,ve.jsxs)("button",{className:"body-btn",onClick:()=>S("round"),children:[(0,ve.jsx)("img",{src:"broad-chest.png",alt:"Broad"}),(0,ve.jsx)("p",{children:"Round"})]})]})]}),5===i&&(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)("h3",{children:"Take our Fit quiz"}),(0,ve.jsx)("h2",{children:"How would you describe your back?"}),(0,ve.jsxs)("div",{className:"body-shape-options",children:[(0,ve.jsxs)("button",{className:"body-btn",onClick:()=>_("small"),children:[(0,ve.jsx)("img",{src:"/assets1/back body1.jpg",alt:"Slim"}),(0,ve.jsx)("p",{children:"Slim"})]}),(0,ve.jsxs)("button",{className:"body-btn",onClick:()=>_("medium"),children:[(0,ve.jsx)("img",{src:"/assets1/back body2.jpg",alt:"Medium"}),(0,ve.jsx)("p",{children:"Medium"})]}),(0,ve.jsxs)("button",{className:"body-btn",onClick:()=>_("round"),children:[(0,ve.jsx)("img",{src:"/assets1/back body3.jpg",alt:"Broad"}),(0,ve.jsx)("p",{children:"Round"})]})]})]}),6===i&&(0,ve.jsxs)(ve.Fragment,{children:[(0,ve.jsx)("h3",{children:"Take our Fit quiz"}),(0,ve.jsx)("h2",{children:"What fit would you prefer for this item?"}),(0,ve.jsx)("button",{className:"option-btn",onClick:()=>E("Slim fit"),children:"Slim fit"}),(0,ve.jsx)("button",{className:"option-btn",onClick:()=>E("Regular fit"),children:"Regular fit"}),(0,ve.jsx)("button",{className:"option-btn",onClick:()=>E("Loose fit"),children:"Loose fit"})]}),(0,ve.jsx)("p",{className:"footer-text",children:"Powered by DrapFit"})]})]}):null},eh=globalThis,th=eh.ShadowRoot&&(void 0===eh.ShadyCSS||eh.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ih=Symbol(),nh=new WeakMap;class rh{constructor(e,t,i){if(this._$cssResult$=!0,i!==ih)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(th&&void 0===e){const i=void 0!==t&&1===t.length;i&&(e=nh.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&nh.set(t,e))}return e}toString(){return this.cssText}}const sh=th?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return(e=>new rh("string"==typeof e?e:e+"",void 0,ih))(t)})(e):e,{is:ah,defineProperty:oh,getOwnPropertyDescriptor:lh,getOwnPropertyNames:ch,getOwnPropertySymbols:hh,getPrototypeOf:dh}=Object,uh=globalThis,ph=uh.trustedTypes,fh=ph?ph.emptyScript:"",mh=uh.reactiveElementPolyfillSupport,gh=(e,t)=>e,vh={toAttribute(e,t){switch(t){case Boolean:e=e?fh:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},yh=(e,t)=>!ah(e,t),bh={attribute:!0,type:String,converter:vh,reflect:!1,useDefault:!1,hasChanged:yh};Symbol.metadata??=Symbol("metadata"),uh.litPropertyMetadata??=new WeakMap;class Ah extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bh;if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const i=Symbol(),n=this.getPropertyDescriptor(e,i,t);void 0!==n&&oh(this.prototype,e,n)}}static getPropertyDescriptor(e,t,i){const{get:n,set:r}=lh(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:n,set(t){const s=n?.call(this);r?.call(this,t),this.requestUpdate(e,s,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??bh}static _$Ei(){if(this.hasOwnProperty(gh("elementProperties")))return;const e=dh(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(gh("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(gh("properties"))){const e=this.properties,t=[...ch(e),...hh(e)];for(const i of t)this.createProperty(i,e[i])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,i]of t)this.elementProperties.set(e,i)}this._$Eh=new Map;for(const[t,i]of this.elementProperties){const e=this._$Eu(t,i);void 0!==e&&this._$Eh.set(e,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(sh(e))}else void 0!==e&&t.push(sh(e));return t}static _$Eu(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((e=>e(this)))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(th)e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet));else for(const i of t){const t=document.createElement("style"),n=eh.litNonce;void 0!==n&&t.setAttribute("nonce",n),t.textContent=i.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((e=>e.hostConnected?.()))}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach((e=>e.hostDisconnected?.()))}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$ET(e,t){const i=this.constructor.elementProperties.get(e),n=this.constructor._$Eu(e,i);if(void 0!==n&&!0===i.reflect){const r=(void 0!==i.converter?.toAttribute?i.converter:vh).toAttribute(t,i.type);this._$Em=e,null==r?this.removeAttribute(n):this.setAttribute(n,r),this._$Em=null}}_$AK(e,t){const i=this.constructor,n=i._$Eh.get(e);if(void 0!==n&&this._$Em!==n){const e=i.getPropertyOptions(n),r="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:vh;this._$Em=n,this[n]=r.fromAttribute(t,e.type)??this._$Ej?.get(n)??null,this._$Em=null}}requestUpdate(e,t,i){if(void 0!==e){const n=this.constructor,r=this[e];if(i??=n.getPropertyOptions(e),!((i.hasChanged??yh)(r,t)||i.useDefault&&i.reflect&&r===this._$Ej?.get(e)&&!this.hasAttribute(n._$Eu(e,i))))return;this.C(e,t,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,i,n){let{useDefault:r,reflect:s,wrapped:a}=i;r&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,n??t??this[e]),!0!==a||void 0!==n)||(this._$AL.has(e)||(this.hasUpdated||r||(t=void 0),this._$AL.set(e,t)),!0===s&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,i]of e){const{wrapped:e}=i,n=this[t];!0!==e||this._$AL.has(t)||void 0===n||this.C(t,void 0,i,n)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach((e=>e.hostUpdate?.())),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach((e=>e.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach((e=>this._$ET(e,this[e]))),this._$EM()}updated(e){}firstUpdated(e){}}Ah.elementStyles=[],Ah.shadowRootOptions={mode:"open"},Ah[gh("elementProperties")]=new Map,Ah[gh("finalized")]=new Map,mh?.({ReactiveElement:Ah}),(uh.reactiveElementVersions??=[]).push("2.1.0");const xh={attribute:!0,type:String,converter:vh,reflect:!1,hasChanged:yh};function wh(e){return(t,i)=>"object"==typeof i?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xh,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const{kind:n,metadata:r}=i;let s=globalThis.litPropertyMetadata.get(r);if(void 0===s&&globalThis.litPropertyMetadata.set(r,s=new Map),"setter"===n&&((e=Object.create(e)).wrapped=!0),s.set(i.name,e),"accessor"===n){const{name:n}=i;return{set(i){const r=t.get.call(this);t.set.call(this,i),this.requestUpdate(n,r,e)},init(t){return void 0!==t&&this.C(n,void 0,e,t),t}}}if("setter"===n){const{name:n}=i;return function(i){const r=this[n];t.call(this,i),this.requestUpdate(n,r,e)}}throw Error("Unsupported decorator location: "+n)}(e,t,i):((e,t,i)=>{const n=t.hasOwnProperty(i);return t.constructor.createProperty(i,e),n?Object.getOwnPropertyDescriptor(t,i):void 0})(e,t,i)}const Sh="176",_h=1,Eh=2,Ch=3,Mh=0,Th=1,Ih=2,Ph=100,Dh=101,Rh=102,Bh=200,Lh=201,Oh=202,Nh=203,kh=204,Fh=205,Uh=206,zh=207,jh=208,Vh=209,Gh=210,Hh=211,Wh=212,Qh=213,qh=214,Xh=0,Yh=1,Kh=2,Jh=3,Zh=4,$h=5,ed=6,td=7,id=0,nd=1,rd=2,sd=0,ad=1,od=2,ld=3,cd=4,hd=5,dd=6,ud=7,pd="attached",fd=300,md=301,gd=302,vd=303,yd=304,bd=306,Ad=1e3,xd=1001,wd=1002,Sd=1003,_d=1004,Ed=1005,Cd=1006,Md=1007,Td=1008,Id=1009,Pd=1010,Dd=1011,Rd=1012,Bd=1013,Ld=1014,Od=1015,Nd=1016,kd=1017,Fd=1018,Ud=1020,zd=35902,jd=1021,Vd=1022,Gd=1023,Hd=1026,Wd=1027,Qd=1028,qd=1029,Xd=1030,Yd=1031,Kd=1033,Jd=33776,Zd=33777,$d=33778,eu=33779,tu=35840,iu=35841,nu=35842,ru=35843,su=36196,au=37492,ou=37496,lu=37808,cu=37809,hu=37810,du=37811,uu=37812,pu=37813,fu=37814,mu=37815,gu=37816,vu=37817,yu=37818,bu=37819,Au=37820,xu=37821,wu=36492,Su=36494,_u=36495,Eu=36283,Cu=36284,Mu=36285,Tu=36286,Iu=2200,Pu=2201,Du=2202,Ru=2300,Bu=2301,Lu=2302,Ou=2400,Nu=2401,ku=2402,Fu=2500,Uu="",zu="srgb",ju="srgb-linear",Vu="linear",Gu="srgb",Hu=7680,Wu=512,Qu=513,qu=514,Xu=515,Yu=516,Ku=517,Ju=518,Zu=519,$u=35044,ep="300 es",tp=2e3,ip=2001;class np{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return void 0!==i&&(void 0!==i[e]&&-1!==i[e].indexOf(t))}removeEventListener(e,t){const i=this._listeners;if(void 0===i)return;const n=i[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const i=t[e.type];if(void 0!==i){e.target=this;const t=i.slice(0);for(let i=0,n=t.length;i<n;i++)t[i].call(this,e);e.target=null}}}const rp=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let sp=1234567;const ap=Math.PI/180,op=180/Math.PI;function lp(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(rp[255&e]+rp[e>>8&255]+rp[e>>16&255]+rp[e>>24&255]+"-"+rp[255&t]+rp[t>>8&255]+"-"+rp[t>>16&15|64]+rp[t>>24&255]+"-"+rp[63&i|128]+rp[i>>8&255]+"-"+rp[i>>16&255]+rp[i>>24&255]+rp[255&n]+rp[n>>8&255]+rp[n>>16&255]+rp[n>>24&255]).toLowerCase()}function cp(e,t,i){return Math.max(t,Math.min(i,e))}function hp(e,t){return(e%t+t)%t}function dp(e,t,i){return(1-i)*e+i*t}function up(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function pp(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const fp={DEG2RAD:ap,RAD2DEG:op,generateUUID:lp,clamp:cp,euclideanModulo:hp,mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},lerp:dp,damp:function(e,t,i,n){return dp(e,t,1-Math.exp(-i*n))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(hp(e,2*t)-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(sp=e);let t=sp+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*ap},radToDeg:function(e){return e*op},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,i,n,r){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+n)/2),h=a((t+n)/2),d=s((t-n)/2),u=a((t-n)/2),p=s((n-t)/2),f=a((n-t)/2);switch(r){case"XYX":e.set(o*h,l*d,l*u,o*c);break;case"YZY":e.set(l*u,o*h,l*d,o*c);break;case"ZXZ":e.set(l*d,l*u,o*h,o*c);break;case"XZX":e.set(o*h,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*h,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:pp,denormalize:up};class mp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;mp.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=cp(this.x,e.x,t.x),this.y=cp(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=cp(this.x,e,t),this.y=cp(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(cp(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(cp(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*i-s*n+e.x,this.y=r*n+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class gp{constructor(e,t,i,n,r,s,a,o,l){gp.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,i,n,r,s,a,o,l)}set(e,t,i,n,r,s,a,o,l){const c=this.elements;return c[0]=e,c[1]=n,c[2]=a,c[3]=t,c[4]=r,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],h=i[7],d=i[2],u=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],b=n[7],A=n[2],x=n[5],w=n[8];return r[0]=s*f+a*v+o*A,r[3]=s*m+a*y+o*x,r[6]=s*g+a*b+o*w,r[1]=l*f+c*v+h*A,r[4]=l*m+c*y+h*x,r[7]=l*g+c*b+h*w,r[2]=d*f+u*v+p*A,r[5]=d*m+u*y+p*x,r[8]=d*g+u*b+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-i*r*c+i*a*o+n*r*l-n*s*o}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=c*s-a*l,d=a*o-c*r,u=l*r-s*o,p=t*h+i*d+n*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=h*f,e[1]=(n*l-c*i)*f,e[2]=(a*i-n*s)*f,e[3]=d*f,e[4]=(c*t-n*o)*f,e[5]=(n*r-a*t)*f,e[6]=u*f,e[7]=(i*o-l*t)*f,e[8]=(s*t-i*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-n*l,n*o,-n*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(vp.makeScale(e,t)),this}rotate(e){return this.premultiply(vp.makeRotation(-e)),this}translate(e,t){return this.premultiply(vp.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const vp=new gp;function yp(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function bp(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Ap(){const e=bp("canvas");return e.style.display="block",e}const xp={};function wp(e){e in xp||(xp[e]=!0,console.warn(e))}const Sp=(new gp).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),_p=(new gp).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Ep(){const e={enabled:!0,workingColorSpace:ju,spaces:{},convert:function(e,t,i){return!1!==this.enabled&&t!==i&&t&&i?(this.spaces[t].transfer===Gu&&(e.r=Mp(e.r),e.g=Mp(e.g),e.b=Mp(e.b)),this.spaces[t].primaries!==this.spaces[i].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[i].fromXYZ)),this.spaces[i].transfer===Gu&&(e.r=Tp(e.r),e.g=Tp(e.g),e.b=Tp(e.b)),e):e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Uu?Vu:this.spaces[e].transfer},getLuminanceCoefficients:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,i){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[i].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],n=[.3127,.329];return e.define({[ju]:{primaries:t,whitePoint:n,transfer:Vu,toXYZ:Sp,fromXYZ:_p,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:zu},outputColorSpaceConfig:{drawingBufferColorSpace:zu}},[zu]:{primaries:t,whitePoint:n,transfer:Gu,toXYZ:Sp,fromXYZ:_p,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:zu}}}),e}const Cp=Ep();function Mp(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Tp(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let Ip;class Pp{static getDataURL(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Ip&&(Ip=bp("canvas")),Ip.width=e.width,Ip.height=e.height;const i=Ip.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Ip}return t.toDataURL(i)}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=bp("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let e=0;e<r.length;e++)r[e]=255*Mp(r[e]/255);return i.putImageData(n,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Mp(t[e]/255)):t[e]=Mp(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Dp=0;class Rp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:Dp++}),this.uuid=lp(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(Bp(n[t].image)):e.push(Bp(n[t]))}else e=Bp(n);i.url=e}return t||(e.images[this.uuid]=i),i}}function Bp(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Pp.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Lp=0;class Op extends np{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Op.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Op.DEFAULT_MAPPING,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xd,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:xd,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Cd,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Td,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Gd,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Id,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Op.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Uu;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Lp++}),this.uuid=lp(),this.name="",this.source=new Rp(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new mp(0,0),this.repeat=new mp(1,1),this.center=new mp(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new gp,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isTextureArray=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isTextureArray=e.isTextureArray,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==fd)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ad:e.x=e.x-Math.floor(e.x);break;case xd:e.x=e.x<0?0:1;break;case wd:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Ad:e.y=e.y-Math.floor(e.y);break;case xd:e.y=e.y<0?0:1;break;case wd:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}Op.DEFAULT_IMAGE=null,Op.DEFAULT_MAPPING=fd,Op.DEFAULT_ANISOTROPY=1;class Np{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Np.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*t+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*t+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*t+s[7]*i+s[11]*n+s[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const s=.01,a=.1,o=e.elements,l=o[0],c=o[4],h=o[8],d=o[1],u=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(c-d)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+d)<a&&Math.abs(h+f)<a&&Math.abs(p+m)<a&&Math.abs(l+u+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(u+1)/2,v=(g+1)/2,y=(c+d)/4,b=(h+f)/4,A=(p+m)/4;return e>o&&e>v?e<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(e),n=y/i,r=b/i):o>v?o<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(o),i=y/n,r=A/n):v<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(v),i=b/r,n=A/r),this.set(i,n,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(h-f)/v,this.z=(d-c)/v,this.w=Math.acos((l+u+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=cp(this.x,e.x,t.x),this.y=cp(this.y,e.y,t.y),this.z=cp(this.z,e.z,t.z),this.w=cp(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=cp(this.x,e,t),this.y=cp(this.y,e,t),this.z=cp(this.z,e,t),this.w=cp(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(cp(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class kp extends np{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=i.depth?i.depth:1,this.scissor=new Np(0,0,e,t),this.scissorTest=!1,this.viewport=new Np(0,0,e,t);const n={width:e,height:t,depth:this.depth};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Cd,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,multiview:!1},i);const r=new Op(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];const s=i.count;for(let a=0;a<s;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.textures.length;n<r;n++)this.textures[n].image.width=e,this.textures[n].image.height=t,this.textures[n].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,i=e.textures.length;t<i;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new Rp(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Fp extends kp{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class Up extends Op{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Sd,this.minFilter=Sd,this.wrapR=xd,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class zp extends Op{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Sd,this.minFilter=Sd,this.wrapR=xd,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class jp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,s,a){let o=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const d=r[s+0],u=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===a)return e[t+0]=d,e[t+1]=u,e[t+2]=p,void(e[t+3]=f);if(h!==f||o!==d||l!==u||c!==p){let e=1-a;const t=o*d+l*u+c*p+h*f,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,t*i);e=Math.sin(e*s)/r,a=Math.sin(a*s)/r}const r=a*i;if(o=o*e+d*r,l=l*e+u*r,c=c*e+p*r,h=h*e+f*r,e===1-a){const e=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=e,l*=e,c*=e,h*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,r,s){const a=i[n],o=i[n+1],l=i[n+2],c=i[n+3],h=r[s],d=r[s+1],u=r[s+2],p=r[s+3];return e[t]=a*p+c*h+o*u-l*d,e[t+1]=o*p+c*d+l*h-a*u,e[t+2]=l*p+c*u+a*d-o*h,e[t+3]=c*p-a*h-o*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=e._x,n=e._y,r=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(n/2),h=a(r/2),d=o(i/2),u=o(n/2),p=o(r/2);switch(s){case"XYZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"YXZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"ZXY":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"ZYX":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"YZX":this._x=d*c*h+l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h-d*u*p;break;case"XZY":this._x=d*c*h-l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],h=t[10],d=i+a+h;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(s-n)*e}else if(i>a&&i>h){const e=2*Math.sqrt(1+i-a-h);this._w=(c-o)/e,this._x=.25*e,this._y=(n+s)/e,this._z=(r+l)/e}else if(a>h){const e=2*Math.sqrt(1+a-i-h);this._w=(r-l)/e,this._x=(n+s)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+h-i-a);this._w=(s-n)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(cp(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=i*c+s*a+n*l-r*o,this._y=n*c+s*o+r*a-i*l,this._z=r*c+s*l+i*o-n*a,this._w=s*c-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,n=this._y,r=this._z,s=this._w;let a=s*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=s*h+this._w*d,this._x=i*h+this._x*d,this._y=n*h+this._y*d,this._z=r*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(n*Math.sin(e),n*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Vp.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Hp.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Hp.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,s=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,a=e.z,o=e.w,l=2*(s*n-a*i),c=2*(a*t-r*n),h=2*(r*i-s*t);return this.x=t+o*l+s*h-a*c,this.y=i+o*c+a*l-r*h,this.z=n+o*h+r*c-s*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=cp(this.x,e.x,t.x),this.y=cp(this.y,e.y,t.y),this.z=cp(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=cp(this.x,e,t),this.y=cp(this.y,e,t),this.z=cp(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(cp(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,s=t.x,a=t.y,o=t.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Gp.copy(this).projectOnVector(e),this.sub(Gp)}reflect(e){return this.sub(Gp.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(cp(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Gp=new Vp,Hp=new jp;class Wp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vp(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vp(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(qp.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(qp.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=qp.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i){const n=i.getAttribute("position");if(!0===t&&void 0!==n&&!0!==e.isInstancedMesh)for(let t=0,i=n.count;t<i;t++)!0===e.isMesh?e.getVertexPosition(t,qp):qp.fromBufferAttribute(n,t),qp.applyMatrix4(e.matrixWorld),this.expandByPoint(qp);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Xp.copy(e.boundingBox)):(null===i.boundingBox&&i.computeBoundingBox(),Xp.copy(i.boundingBox)),Xp.applyMatrix4(e.matrixWorld),this.union(Xp)}const n=e.children;for(let r=0,s=n.length;r<s;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,qp),qp.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(tf),nf.subVectors(this.max,tf),Yp.subVectors(e.a,tf),Kp.subVectors(e.b,tf),Jp.subVectors(e.c,tf),Zp.subVectors(Kp,Yp),$p.subVectors(Jp,Kp),ef.subVectors(Yp,Jp);let t=[0,-Zp.z,Zp.y,0,-$p.z,$p.y,0,-ef.z,ef.y,Zp.z,0,-Zp.x,$p.z,0,-$p.x,ef.z,0,-ef.x,-Zp.y,Zp.x,0,-$p.y,$p.x,0,-ef.y,ef.x,0];return!!af(t,Yp,Kp,Jp,nf)&&(t=[1,0,0,0,1,0,0,0,1],!!af(t,Yp,Kp,Jp,nf)&&(rf.crossVectors(Zp,$p),t=[rf.x,rf.y,rf.z],af(t,Yp,Kp,Jp,nf)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,qp).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(qp).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Qp[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Qp[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Qp[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Qp[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Qp[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Qp[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Qp[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Qp[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Qp)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Qp=[new Vp,new Vp,new Vp,new Vp,new Vp,new Vp,new Vp,new Vp],qp=new Vp,Xp=new Wp,Yp=new Vp,Kp=new Vp,Jp=new Vp,Zp=new Vp,$p=new Vp,ef=new Vp,tf=new Vp,nf=new Vp,rf=new Vp,sf=new Vp;function af(e,t,i,n,r){for(let s=0,a=e.length-3;s<=a;s+=3){sf.fromArray(e,s);const a=r.x*Math.abs(sf.x)+r.y*Math.abs(sf.y)+r.z*Math.abs(sf.z),o=t.dot(sf),l=i.dot(sf),c=n.dot(sf);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const of=new Wp,lf=new Vp,cf=new Vp;class hf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vp,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):of.setFromPoints(e).getCenter(i);let n=0;for(let r=0,s=e.length;r<s;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;lf.subVectors(e,this.center);const t=lf.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),i=.5*(e-this.radius);this.center.addScaledVector(lf,i/e),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(cf.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(lf.copy(e.center).add(cf)),this.expandByPoint(lf.copy(e.center).sub(cf))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const df=new Vp,uf=new Vp,pf=new Vp,ff=new Vp,mf=new Vp,gf=new Vp,vf=new Vp;class yf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vp,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vp(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,df)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=df.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(df.copy(this.origin).addScaledVector(this.direction,t),df.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){uf.copy(e).add(t).multiplyScalar(.5),pf.copy(t).sub(e).normalize(),ff.copy(this.origin).sub(uf);const r=.5*e.distanceTo(t),s=-this.direction.dot(pf),a=ff.dot(this.direction),o=-ff.dot(pf),l=ff.lengthSq(),c=Math.abs(1-s*s);let h,d,u,p;if(c>0)if(h=s*o-a,d=s*a-o,p=r*c,h>=0)if(d>=-p)if(d<=p){const e=1/c;h*=e,d*=e,u=h*(h+s*d+2*a)+d*(s*h+d+2*o)+l}else d=r,h=Math.max(0,-(s*d+a)),u=-h*h+d*(d+2*o)+l;else d=-r,h=Math.max(0,-(s*d+a)),u=-h*h+d*(d+2*o)+l;else d<=-p?(h=Math.max(0,-(-s*r+a)),d=h>0?-r:Math.min(Math.max(-r,-o),r),u=-h*h+d*(d+2*o)+l):d<=p?(h=0,d=Math.min(Math.max(-r,-o),r),u=d*(d+2*o)+l):(h=Math.max(0,-(s*r+a)),d=h>0?r:Math.min(Math.max(-r,-o),r),u=-h*h+d*(d+2*o)+l);else d=s>0?-r:r,h=Math.max(0,-(s*d+a)),u=-h*h+d*(d+2*o)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,h),n&&n.copy(uf).addScaledVector(pf,d),u}intersectSphere(e,t){df.subVectors(e.center,this.origin);const i=df.dot(this.direction),n=df.dot(df)-i*i,r=e.radius*e.radius;if(n>r)return null;const s=Math.sqrt(r-n),a=i-s,o=i+s;return o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(i=(e.min.x-d.x)*l,n=(e.max.x-d.x)*l):(i=(e.max.x-d.x)*l,n=(e.min.x-d.x)*l),c>=0?(r=(e.min.y-d.y)*c,s=(e.max.y-d.y)*c):(r=(e.max.y-d.y)*c,s=(e.min.y-d.y)*c),i>s||r>n?null:((r>i||isNaN(i))&&(i=r),(s<n||isNaN(n))&&(n=s),h>=0?(a=(e.min.z-d.z)*h,o=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,o=(e.min.z-d.z)*h),i>o||a>n?null:((a>i||i!==i)&&(i=a),(o<n||n!==n)&&(n=o),n<0?null:this.at(i>=0?i:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,df)}intersectTriangle(e,t,i,n,r){mf.subVectors(t,e),gf.subVectors(i,e),vf.crossVectors(mf,gf);let s,a=this.direction.dot(vf);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}ff.subVectors(this.origin,e);const o=s*this.direction.dot(gf.crossVectors(ff,gf));if(o<0)return null;const l=s*this.direction.dot(mf.cross(ff));if(l<0)return null;if(o+l>a)return null;const c=-s*ff.dot(vf);return c<0?null:this.at(c/a,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class bf{constructor(e,t,i,n,r,s,a,o,l,c,h,d,u,p,f,m){bf.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,i,n,r,s,a,o,l,c,h,d,u,p,f,m)}set(e,t,i,n,r,s,a,o,l,c,h,d,u,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=d,g[3]=u,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new bf).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/Af.setFromMatrixColumn(e,0).length(),r=1/Af.setFromMatrixColumn(e,1).length(),s=1/Af.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,r=e.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){const e=s*c,i=s*h,n=a*c,r=a*h;t[0]=o*c,t[4]=-o*h,t[8]=l,t[1]=i+n*l,t[5]=e-r*l,t[9]=-a*o,t[2]=r-e*l,t[6]=n+i*l,t[10]=s*o}else if("YXZ"===e.order){const e=o*c,i=o*h,n=l*c,r=l*h;t[0]=e+r*a,t[4]=n*a-i,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-a,t[2]=i*a-n,t[6]=r+e*a,t[10]=s*o}else if("ZXY"===e.order){const e=o*c,i=o*h,n=l*c,r=l*h;t[0]=e-r*a,t[4]=-s*h,t[8]=n+i*a,t[1]=i+n*a,t[5]=s*c,t[9]=r-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){const e=s*c,i=s*h,n=a*c,r=a*h;t[0]=o*c,t[4]=n*l-i,t[8]=e*l+r,t[1]=o*h,t[5]=r*l+e,t[9]=i*l-n,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){const e=s*o,i=s*l,n=a*o,r=a*l;t[0]=o*c,t[4]=r-e*h,t[8]=n*h+i,t[1]=h,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=i*h+n,t[10]=e-r*h}else if("XZY"===e.order){const e=s*o,i=s*l,n=a*o,r=a*l;t[0]=o*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=s*c,t[9]=i*h-n,t[2]=n*h-i,t[6]=a*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(wf,e,Sf)}lookAt(e,t,i){const n=this.elements;return Cf.subVectors(e,t),0===Cf.lengthSq()&&(Cf.z=1),Cf.normalize(),_f.crossVectors(i,Cf),0===_f.lengthSq()&&(1===Math.abs(i.z)?Cf.x+=1e-4:Cf.z+=1e-4,Cf.normalize(),_f.crossVectors(i,Cf)),_f.normalize(),Ef.crossVectors(Cf,_f),n[0]=_f.x,n[4]=Ef.x,n[8]=Cf.x,n[1]=_f.y,n[5]=Ef.y,n[9]=Cf.y,n[2]=_f.z,n[6]=Ef.z,n[10]=Cf.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],h=i[5],d=i[9],u=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],A=i[15],x=n[0],w=n[4],S=n[8],_=n[12],E=n[1],C=n[5],M=n[9],T=n[13],I=n[2],P=n[6],D=n[10],R=n[14],B=n[3],L=n[7],O=n[11],N=n[15];return r[0]=s*x+a*E+o*I+l*B,r[4]=s*w+a*C+o*P+l*L,r[8]=s*S+a*M+o*D+l*O,r[12]=s*_+a*T+o*R+l*N,r[1]=c*x+h*E+d*I+u*B,r[5]=c*w+h*C+d*P+u*L,r[9]=c*S+h*M+d*D+u*O,r[13]=c*_+h*T+d*R+u*N,r[2]=p*x+f*E+m*I+g*B,r[6]=p*w+f*C+m*P+g*L,r[10]=p*S+f*M+m*D+g*O,r[14]=p*_+f*T+m*R+g*N,r[3]=v*x+y*E+b*I+A*B,r[7]=v*w+y*C+b*P+A*L,r[11]=v*S+y*M+b*D+A*O,r[15]=v*_+y*T+b*R+A*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],h=e[6],d=e[10],u=e[14];return e[3]*(+r*o*h-n*l*h-r*a*d+i*l*d+n*a*u-i*o*u)+e[7]*(+t*o*u-t*l*d+r*s*d-n*s*u+n*l*c-r*o*c)+e[11]*(+t*l*h-t*a*u-r*s*h+i*s*u+r*a*c-i*l*c)+e[15]*(-n*a*c-t*o*h+t*a*d+n*s*h-i*s*d+i*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=e[9],d=e[10],u=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=h*m*l-f*d*l+f*o*u-a*m*u-h*o*g+a*d*g,y=p*d*l-c*m*l-p*o*u+s*m*u+c*o*g-s*d*g,b=c*f*l-p*h*l+p*a*u-s*f*u-c*a*g+s*h*g,A=p*h*o-c*f*o-p*a*d+s*f*d+c*a*m-s*h*m,x=t*v+i*y+n*b+r*A;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return e[0]=v*w,e[1]=(f*d*r-h*m*r-f*n*u+i*m*u+h*n*g-i*d*g)*w,e[2]=(a*m*r-f*o*r+f*n*l-i*m*l-a*n*g+i*o*g)*w,e[3]=(h*o*r-a*d*r-h*n*l+i*d*l+a*n*u-i*o*u)*w,e[4]=y*w,e[5]=(c*m*r-p*d*r+p*n*u-t*m*u-c*n*g+t*d*g)*w,e[6]=(p*o*r-s*m*r-p*n*l+t*m*l+s*n*g-t*o*g)*w,e[7]=(s*d*r-c*o*r+c*n*l-t*d*l-s*n*u+t*o*u)*w,e[8]=b*w,e[9]=(p*h*r-c*f*r-p*i*u+t*f*u+c*i*g-t*h*g)*w,e[10]=(s*f*r-p*a*r+p*i*l-t*f*l-s*i*g+t*a*g)*w,e[11]=(c*a*r-s*h*r-c*i*l+t*h*l+s*i*u-t*a*u)*w,e[12]=A*w,e[13]=(c*f*n-p*h*n+p*i*d-t*f*d-c*i*m+t*h*m)*w,e[14]=(p*a*n-s*f*n-p*i*o+t*f*o+s*i*m-t*a*m)*w,e[15]=(s*h*n-c*a*n+c*i*o-t*h*o-s*i*d+t*a*d)*w,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,s=e.x,a=e.y,o=e.z,l=r*s,c=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,c*a+i,c*o-n*s,0,l*o-n*a,c*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,s){return this.set(1,i,r,0,e,1,s,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,s=t._y,a=t._z,o=t._w,l=r+r,c=s+s,h=a+a,d=r*l,u=r*c,p=r*h,f=s*c,m=s*h,g=a*h,v=o*l,y=o*c,b=o*h,A=i.x,x=i.y,w=i.z;return n[0]=(1-(f+g))*A,n[1]=(u+b)*A,n[2]=(p-y)*A,n[3]=0,n[4]=(u-b)*x,n[5]=(1-(d+g))*x,n[6]=(m+v)*x,n[7]=0,n[8]=(p+y)*w,n[9]=(m-v)*w,n[10]=(1-(d+f))*w,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=Af.set(n[0],n[1],n[2]).length();const s=Af.set(n[4],n[5],n[6]).length(),a=Af.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],xf.copy(this);const o=1/r,l=1/s,c=1/a;return xf.elements[0]*=o,xf.elements[1]*=o,xf.elements[2]*=o,xf.elements[4]*=l,xf.elements[5]*=l,xf.elements[6]*=l,xf.elements[8]*=c,xf.elements[9]*=c,xf.elements[10]*=c,t.setFromRotationMatrix(xf),i.x=r,i.y=s,i.z=a,this}makePerspective(e,t,i,n,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:tp;const o=this.elements,l=2*r/(t-e),c=2*r/(i-n),h=(t+e)/(t-e),d=(i+n)/(i-n);let u,p;if(a===tp)u=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(a!==ip)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);u=-s/(s-r),p=-s*r/(s-r)}return o[0]=l,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=c,o[9]=d,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,i,n,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:tp;const o=this.elements,l=1/(t-e),c=1/(i-n),h=1/(s-r),d=(t+e)*l,u=(i+n)*c;let p,f;if(a===tp)p=(s+r)*h,f=-2*h;else{if(a!==ip)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=r*h,f=-1*h}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-d,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Af=new Vp,xf=new bf,wf=new Vp(0,0,0),Sf=new Vp(1,1,1),_f=new Vp,Ef=new Vp,Cf=new Vp,Mf=new bf,Tf=new jp;class If{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:If.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=e.elements,r=n[0],s=n[4],a=n[8],o=n[1],l=n[5],c=n[9],h=n[2],d=n[6],u=n[10];switch(t){case"XYZ":this._y=Math.asin(cp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,u),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-cp(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,u),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(cp(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,u),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-cp(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,u),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(cp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,u));break;case"XZY":this._z=Math.asin(-cp(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Mf.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Mf,t,i)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return Tf.setFromEuler(this),this.setFromQuaternion(Tf,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}If.DEFAULT_ORDER="XYZ";class Pf{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let Df=0;const Rf=new Vp,Bf=new jp,Lf=new bf,Of=new Vp,Nf=new Vp,kf=new Vp,Ff=new jp,Uf=new Vp(1,0,0),zf=new Vp(0,1,0),jf=new Vp(0,0,1),Vf={type:"added"},Gf={type:"removed"},Hf={type:"childadded",child:null},Wf={type:"childremoved",child:null};class Qf extends np{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Df++}),this.uuid=lp(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Qf.DEFAULT_UP.clone();const e=new Vp,t=new If,i=new jp,n=new Vp(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new bf},normalMatrix:{value:new gp}}),this.matrix=new bf,this.matrixWorld=new bf,this.matrixAutoUpdate=Qf.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Qf.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Pf,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Bf.setFromAxisAngle(e,t),this.quaternion.multiply(Bf),this}rotateOnWorldAxis(e,t){return Bf.setFromAxisAngle(e,t),this.quaternion.premultiply(Bf),this}rotateX(e){return this.rotateOnAxis(Uf,e)}rotateY(e){return this.rotateOnAxis(zf,e)}rotateZ(e){return this.rotateOnAxis(jf,e)}translateOnAxis(e,t){return Rf.copy(e).applyQuaternion(this.quaternion),this.position.add(Rf.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Uf,e)}translateY(e){return this.translateOnAxis(zf,e)}translateZ(e){return this.translateOnAxis(jf,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Lf.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Of.copy(e):Of.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Nf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Lf.lookAt(Nf,Of,this.up):Lf.lookAt(Of,Nf,this.up),this.quaternion.setFromRotationMatrix(Lf),n&&(Lf.extractRotation(n.matrixWorld),Bf.setFromRotationMatrix(Lf),this.quaternion.premultiply(Bf.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Vf),Hf.child=e,this.dispatchEvent(Hf),Hf.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Gf),Wf.child=e,this.dispatchEvent(Wf),Wf.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Lf.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Lf.multiply(e.parent.matrixWorld)),e.applyMatrix4(Lf),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Vf),Hf.child=e,this.dispatchEvent(Hf),Hf.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getObjectsByProperty(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&i.push(this);const n=this.children;for(let r=0,s=n.length;r<s;r++)n[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Nf,e,kf),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Nf,Ff,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++){t[i].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.geometryInfo=this._geometryInfo.map((e=>({...e,boundingBox:e.boundingBox?{min:e.boundingBox.min.toArray(),max:e.boundingBox.max.toArray()}:void 0,boundingSphere:e.boundingSphere?{radius:e.boundingSphere.radius,center:e.boundingSphere.center.toArray()}:void 0}))),n.instanceInfo=this._instanceInfo.map((e=>({...e}))),n.availableInstanceIds=this._availableInstanceIds.slice(),n.availableGeometryIds=this._availableGeometryIds.slice(),n.nextIndexStart=this._nextIndexStart,n.nextVertexStart=this._nextVertexStart,n.geometryCount=this._geometryCount,n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.matricesTexture=this._matricesTexture.toJSON(e),n.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(n.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(n.boundingSphere={center:this.boundingSphere.center.toArray(),radius:this.boundingSphere.radius}),null!==this.boundingBox&&(n.boundingBox={min:this.boundingBox.min.toArray(),max:this.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const n=i[t];r(e.shapes,n)}else r(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(r(e.materials,this.material[i]));n.material=t}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];n.animations.push(r(e.animations,i))}}if(t){const t=s(e.geometries),n=s(e.materials),r=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),c=s(e.animations),h=s(e.nodes);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=n,i;function s(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let i=0;i<e.children.length;i++){const t=e.children[i];this.add(t.clone())}return this}}Qf.DEFAULT_UP=new Vp(0,1,0),Qf.DEFAULT_MATRIX_AUTO_UPDATE=!0,Qf.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const qf=new Vp,Xf=new Vp,Yf=new Vp,Kf=new Vp,Jf=new Vp,Zf=new Vp,$f=new Vp,em=new Vp,tm=new Vp,im=new Vp,nm=new Np,rm=new Np,sm=new Np;class am{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vp,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Vp,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Vp;this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),qf.subVectors(e,t),n.cross(qf);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){qf.subVectors(n,t),Xf.subVectors(i,t),Yf.subVectors(e,t);const s=qf.dot(qf),a=qf.dot(Xf),o=qf.dot(Yf),l=Xf.dot(Xf),c=Xf.dot(Yf),h=s*l-a*a;if(0===h)return r.set(0,0,0),null;const d=1/h,u=(l*o-a*c)*d,p=(s*c-a*o)*d;return r.set(1-u-p,p,u)}static containsPoint(e,t,i,n){return null!==this.getBarycoord(e,t,i,n,Kf)&&(Kf.x>=0&&Kf.y>=0&&Kf.x+Kf.y<=1)}static getInterpolation(e,t,i,n,r,s,a,o){return null===this.getBarycoord(e,t,i,n,Kf)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,Kf.x),o.addScaledVector(s,Kf.y),o.addScaledVector(a,Kf.z),o)}static getInterpolatedAttribute(e,t,i,n,r,s){return nm.setScalar(0),rm.setScalar(0),sm.setScalar(0),nm.fromBufferAttribute(e,t),rm.fromBufferAttribute(e,i),sm.fromBufferAttribute(e,n),s.setScalar(0),s.addScaledVector(nm,r.x),s.addScaledVector(rm,r.y),s.addScaledVector(sm,r.z),s}static isFrontFacing(e,t,i,n){return qf.subVectors(i,t),Xf.subVectors(e,t),qf.cross(Xf).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return qf.subVectors(this.c,this.b),Xf.subVectors(this.a,this.b),.5*qf.cross(Xf).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return am.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return am.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,n,r){return am.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return am.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return am.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,r=this.c;let s,a;Jf.subVectors(n,i),Zf.subVectors(r,i),em.subVectors(e,i);const o=Jf.dot(em),l=Zf.dot(em);if(o<=0&&l<=0)return t.copy(i);tm.subVectors(e,n);const c=Jf.dot(tm),h=Zf.dot(tm);if(c>=0&&h<=c)return t.copy(n);const d=o*h-c*l;if(d<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(i).addScaledVector(Jf,s);im.subVectors(e,r);const u=Jf.dot(im),p=Zf.dot(im);if(p>=0&&u<=p)return t.copy(r);const f=u*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(i).addScaledVector(Zf,a);const m=c*p-u*h;if(m<=0&&h-c>=0&&u-p>=0)return $f.subVectors(r,n),a=(h-c)/(h-c+(u-p)),t.copy(n).addScaledVector($f,a);const g=1/(m+f+d);return s=f*g,a=d*g,t.copy(i).addScaledVector(Jf,s).addScaledVector(Zf,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const om={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},lm={h:0,s:0,l:0},cm={h:0,s:0,l:0};function hm(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}class dm{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(void 0===t&&void 0===i){const t=e;t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zu;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Cp.toWorkingColorSpace(this,t),this}setRGB(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Cp.workingColorSpace;return this.r=e,this.g=t,this.b=i,Cp.toWorkingColorSpace(this,n),this}setHSL(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Cp.workingColorSpace;if(e=hp(e,1),t=cp(t,0,1),i=cp(i,0,1),0===t)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=hm(r,n,e+1/3),this.g=hm(r,n,e),this.b=hm(r,n,e-1/3)}return Cp.toWorkingColorSpace(this,n),this}setStyle(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zu;function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const s=t[1],a=t[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,i);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,i);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=t[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,i);if(6===r)return this.setHex(parseInt(n,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zu;const i=om[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Mp(e.r),this.g=Mp(e.g),this.b=Mp(e.b),this}copyLinearToSRGB(e){return this.r=Tp(e.r),this.g=Tp(e.g),this.b=Tp(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zu;return Cp.fromWorkingColorSpace(um.copy(this),e),65536*Math.round(cp(255*um.r,0,255))+256*Math.round(cp(255*um.g,0,255))+Math.round(cp(255*um.b,0,255))}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zu;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Cp.workingColorSpace;Cp.fromWorkingColorSpace(um.copy(this),t);const i=um.r,n=um.g,r=um.b,s=Math.max(i,n,r),a=Math.min(i,n,r);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const e=s-a;switch(l=c<=.5?e/(s+a):e/(2-s-a),s){case i:o=(n-r)/e+(n<r?6:0);break;case n:o=(r-i)/e+2;break;case r:o=(i-n)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Cp.workingColorSpace;return Cp.fromWorkingColorSpace(um.copy(this),t),e.r=um.r,e.g=um.g,e.b=um.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zu;Cp.fromWorkingColorSpace(um.copy(this),e);const t=um.r,i=um.g,n=um.b;return e!==zu?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*n)})`}offsetHSL(e,t,i){return this.getHSL(lm),this.setHSL(lm.h+e,lm.s+t,lm.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(lm),e.getHSL(cm);const i=dp(lm.h,cm.h,t),n=dp(lm.s,cm.s,t),r=dp(lm.l,cm.l,t);return this.setHSL(i,n,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,n=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*n,this.g=r[1]*t+r[4]*i+r[7]*n,this.b=r[2]*t+r[5]*i+r[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const um=new dm;dm.NAMES=om;let pm=0;class fm extends np{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:pm++}),this.uuid=lp(),this.name="",this.type="Material",this.blending=1,this.side=Mh,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=Ph,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new dm(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Hu,this.stencilZFail=Hu,this.stencilZPass=Hu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(i.dispersion=this.dispersion),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapRotation&&(i.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),this.side!==Mh&&(i.side=this.side),!0===this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=!0),204!==this.blendSrc&&(i.blendSrc=this.blendSrc),205!==this.blendDst&&(i.blendDst=this.blendDst),this.blendEquation!==Ph&&(i.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(i.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(i.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(i.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),!1===this.colorWrite&&(i.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(i.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(i.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(i.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Hu&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Hu&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Hu&&(i.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(i.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=!0),!0===this.alphaToCoverage&&(i.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=!0),!0===this.forceSinglePass&&(i.forceSinglePass=!0),!0===this.wireframe&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){const t=n(e.textures),r=n(e.images);t.length>0&&(i.textures=t),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class mm extends fm{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new dm(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new If,this.combine=id,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const gm=vm();function vm(){const e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(n[l]=0,n[256|l]=32768,r[l]=24,r[256|l]=24):e<-14?(n[l]=1024>>-e-14,n[256|l]=1024>>-e-14|32768,r[l]=-e-1,r[256|l]=-e-1):e<=15?(n[l]=e+15<<10,n[256|l]=e+15<<10|32768,r[l]=13,r[256|l]=13):e<128?(n[l]=31744,n[256|l]=64512,r[l]=24,r[256|l]=24):(n[l]=31744,n[256|l]=64512,r[l]=13,r[256|l]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,s[l]=e|t}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function ym(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=cp(e,-65504,65504),gm.floatView[0]=e;const t=gm.uint32View[0],i=t>>23&511;return gm.baseTable[i]+((8388607&t)>>gm.shiftTable[i])}function bm(e){const t=e>>10;return gm.uint32View[0]=gm.mantissaTable[gm.offsetTable[t]+(1023&e)]+gm.exponentTable[t],gm.floatView[0]}class Am{static toHalfFloat(e){return ym(e)}static fromHalfFloat(e){return bm(e)}}const xm=new Vp,wm=new mp;let Sm=0;class _m{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Sm++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=$u,this.updateRanges=[],this.gpuType=Od,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)wm.fromBufferAttribute(this,t),wm.applyMatrix3(e),this.setXY(t,wm.x,wm.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)xm.fromBufferAttribute(this,t),xm.applyMatrix3(e),this.setXYZ(t,xm.x,xm.y,xm.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)xm.fromBufferAttribute(this,t),xm.applyMatrix4(e),this.setXYZ(t,xm.x,xm.y,xm.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)xm.fromBufferAttribute(this,t),xm.applyNormalMatrix(e),this.setXYZ(t,xm.x,xm.y,xm.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)xm.fromBufferAttribute(this,t),xm.transformDirection(e),this.setXYZ(t,xm.x,xm.y,xm.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=up(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=pp(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=up(t,this.array)),t}setX(e,t){return this.normalized&&(t=pp(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=up(t,this.array)),t}setY(e,t){return this.normalized&&(t=pp(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=up(t,this.array)),t}setZ(e,t){return this.normalized&&(t=pp(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=up(t,this.array)),t}setW(e,t){return this.normalized&&(t=pp(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=pp(t,this.array),i=pp(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=pp(t,this.array),i=pp(i,this.array),n=pp(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=pp(t,this.array),i=pp(i,this.array),n=pp(n,this.array),r=pp(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==$u&&(e.usage=this.usage),e}}class Em extends _m{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class Cm extends _m{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Mm extends _m{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Tm=0;const Im=new bf,Pm=new Qf,Dm=new Vp,Rm=new Wp,Bm=new Wp,Lm=new Vp;class Om extends np{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Tm++}),this.uuid=lp(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(yp(e)?Cm:Em)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new gp).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Im.makeRotationFromQuaternion(e),this.applyMatrix4(Im),this}rotateX(e){return Im.makeRotationX(e),this.applyMatrix4(Im),this}rotateY(e){return Im.makeRotationY(e),this.applyMatrix4(Im),this}rotateZ(e){return Im.makeRotationZ(e),this.applyMatrix4(Im),this}translate(e,t,i){return Im.makeTranslation(e,t,i),this.applyMatrix4(Im),this}scale(e,t,i){return Im.makeScale(e,t,i),this.applyMatrix4(Im),this}lookAt(e){return Pm.lookAt(e),Pm.updateMatrix(),this.applyMatrix4(Pm.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Dm).negate(),this.translate(Dm.x,Dm.y,Dm.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];t.push(n.x,n.y,n.z||0)}this.setAttribute("position",new Mm(t,3))}else{const i=Math.min(e.length,t.count);for(let n=0;n<i;n++){const i=e[n];t.setXYZ(n,i.x,i.y,i.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Wp);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Vp(-1/0,-1/0,-1/0),new Vp(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){const e=t[i];Rm.setFromBufferAttribute(e),this.morphTargetsRelative?(Lm.addVectors(this.boundingBox.min,Rm.min),this.boundingBox.expandByPoint(Lm),Lm.addVectors(this.boundingBox.max,Rm.max),this.boundingBox.expandByPoint(Lm)):(this.boundingBox.expandByPoint(Rm.min),this.boundingBox.expandByPoint(Rm.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new hf);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Vp,1/0);if(e){const i=this.boundingSphere.center;if(Rm.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const i=t[e];Bm.setFromBufferAttribute(i),this.morphTargetsRelative?(Lm.addVectors(Rm.min,Bm.min),Rm.expandByPoint(Lm),Lm.addVectors(Rm.max,Bm.max),Rm.expandByPoint(Lm)):(Rm.expandByPoint(Bm.min),Rm.expandByPoint(Bm.max))}Rm.getCenter(i);let n=0;for(let t=0,r=e.count;t<r;t++)Lm.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(Lm));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],a=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)Lm.fromBufferAttribute(s,t),a&&(Dm.fromBufferAttribute(e,t),Lm.add(Dm)),n=Math.max(n,i.distanceToSquared(Lm))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.position,n=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new _m(new Float32Array(4*i.count),4));const s=this.getAttribute("tangent"),a=[],o=[];for(let S=0;S<i.count;S++)a[S]=new Vp,o[S]=new Vp;const l=new Vp,c=new Vp,h=new Vp,d=new mp,u=new mp,p=new mp,f=new Vp,m=new Vp;function g(e,t,n){l.fromBufferAttribute(i,e),c.fromBufferAttribute(i,t),h.fromBufferAttribute(i,n),d.fromBufferAttribute(r,e),u.fromBufferAttribute(r,t),p.fromBufferAttribute(r,n),c.sub(l),h.sub(l),u.sub(d),p.sub(d);const s=1/(u.x*p.y-p.x*u.y);isFinite(s)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(h,-u.y).multiplyScalar(s),m.copy(h).multiplyScalar(u.x).addScaledVector(c,-p.x).multiplyScalar(s),a[e].add(f),a[t].add(f),a[n].add(f),o[e].add(m),o[t].add(m),o[n].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let S=0,_=v.length;S<_;++S){const t=v[S],i=t.start;for(let n=i,r=i+t.count;n<r;n+=3)g(e.getX(n+0),e.getX(n+1),e.getX(n+2))}const y=new Vp,b=new Vp,A=new Vp,x=new Vp;function w(e){A.fromBufferAttribute(n,e),x.copy(A);const t=a[e];y.copy(t),y.sub(A.multiplyScalar(A.dot(t))).normalize(),b.crossVectors(x,t);const i=b.dot(o[e])<0?-1:1;s.setXYZW(e,y.x,y.y,y.z,i)}for(let S=0,_=v.length;S<_;++S){const t=v[S],i=t.start;for(let n=i,r=i+t.count;n<r;n+=3)w(e.getX(n+0)),w(e.getX(n+1)),w(e.getX(n+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new _m(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const n=new Vp,r=new Vp,s=new Vp,a=new Vp,o=new Vp,l=new Vp,c=new Vp,h=new Vp;if(e)for(let d=0,u=e.count;d<u;d+=3){const u=e.getX(d+0),p=e.getX(d+1),f=e.getX(d+2);n.fromBufferAttribute(t,u),r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),a.fromBufferAttribute(i,u),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),a.add(c),o.add(c),l.add(c),i.setXYZ(u,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,d=t.count;e<d;e+=3)n.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Lm.fromBufferAttribute(e,t),Lm.normalize(),e.setXYZ(t,Lm.x,Lm.y,Lm.z)}toNonIndexed(){function e(e,t){const i=e.array,n=e.itemSize,r=e.normalized,s=new i.constructor(t.length*n);let a=0,o=0;for(let l=0,c=t.length;l<c;l++){a=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*n;for(let e=0;e<n;e++)s[o++]=i[a++]}return new _m(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Om,i=this.index.array,n=this.attributes;for(const a in n){const r=e(n[a],i);t.setAttribute(a,r)}const r=this.morphAttributes;for(const a in r){const n=[],s=r[a];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],i);n.push(r)}t.morphAttributes[a]=n}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,o=s.length;a<o;a++){const e=s[a];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const o in i){const t=i[o];e.data.attributes[o]=t.toJSON(e.data)}const n={};let r=!1;for(const o in this.morphAttributes){const t=this.morphAttributes[o],i=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];i.push(r.toJSON(e.data))}i.length>0&&(n[o]=i,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone());const n=e.attributes;for(const l in n){const e=n[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],i=r[l];for(let n=0,r=i.length;n<r;n++)e.push(i[n].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let l=0,c=s.length;l<c;l++){const e=s[l];this.addGroup(e.start,e.count,e.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Nm=new bf,km=new yf,Fm=new hf,Um=new Vp,zm=new Vp,jm=new Vp,Vm=new Vp,Gm=new Vp,Hm=new Vp,Wm=new Vp,Qm=new Vp;class qm extends Qf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Om,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mm;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(n,e);const a=this.morphTargetInfluences;if(r&&a){Hm.set(0,0,0);for(let i=0,n=r.length;i<n;i++){const n=a[i],o=r[i];0!==n&&(Gm.fromBufferAttribute(o,e),s?Hm.addScaledVector(Gm,n):Hm.addScaledVector(Gm.sub(t),n))}t.add(Hm)}return t}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0!==n){if(null===i.boundingSphere&&i.computeBoundingSphere(),Fm.copy(i.boundingSphere),Fm.applyMatrix4(r),km.copy(e.ray).recast(e.near),!1===Fm.containsPoint(km.origin)){if(null===km.intersectSphere(Fm,Um))return;if(km.origin.distanceToSquared(Um)>(e.far-e.near)**2)return}Nm.copy(r).invert(),km.copy(e.ray).applyMatrix4(Nm),null!==i.boundingBox&&!1===km.intersectsBox(i.boundingBox)||this._computeIntersections(e,t,km)}}_computeIntersections(e,t,i){let n;const r=this.geometry,s=this.material,a=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,h=r.attributes.normal,d=r.groups,u=r.drawRange;if(null!==a)if(Array.isArray(s))for(let p=0,f=d.length;p<f;p++){const r=d[p],o=s[r.materialIndex];for(let s=Math.max(r.start,u.start),d=Math.min(a.count,Math.min(r.start+r.count,u.start+u.count));s<d;s+=3){n=Xm(this,o,e,i,l,c,h,a.getX(s),a.getX(s+1),a.getX(s+2)),n&&(n.faceIndex=Math.floor(s/3),n.face.materialIndex=r.materialIndex,t.push(n))}}else{for(let r=Math.max(0,u.start),o=Math.min(a.count,u.start+u.count);r<o;r+=3){n=Xm(this,s,e,i,l,c,h,a.getX(r),a.getX(r+1),a.getX(r+2)),n&&(n.faceIndex=Math.floor(r/3),t.push(n))}}else if(void 0!==o)if(Array.isArray(s))for(let p=0,f=d.length;p<f;p++){const r=d[p],a=s[r.materialIndex];for(let s=Math.max(r.start,u.start),d=Math.min(o.count,Math.min(r.start+r.count,u.start+u.count));s<d;s+=3){n=Xm(this,a,e,i,l,c,h,s,s+1,s+2),n&&(n.faceIndex=Math.floor(s/3),n.face.materialIndex=r.materialIndex,t.push(n))}}else{for(let r=Math.max(0,u.start),a=Math.min(o.count,u.start+u.count);r<a;r+=3){n=Xm(this,s,e,i,l,c,h,r,r+1,r+2),n&&(n.faceIndex=Math.floor(r/3),t.push(n))}}}}function Xm(e,t,i,n,r,s,a,o,l,c){e.getVertexPosition(o,zm),e.getVertexPosition(l,jm),e.getVertexPosition(c,Vm);const h=function(e,t,i,n,r,s,a,o){let l;if(l=t.side===Th?n.intersectTriangle(a,s,r,!0,o):n.intersectTriangle(r,s,a,t.side===Mh,o),null===l)return null;Qm.copy(o),Qm.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(Qm);return c<i.near||c>i.far?null:{distance:c,point:Qm.clone(),object:e}}(e,t,i,n,zm,jm,Vm,Wm);if(h){const e=new Vp;am.getBarycoord(Wm,zm,jm,Vm,e),r&&(h.uv=am.getInterpolatedAttribute(r,o,l,c,e,new mp)),s&&(h.uv1=am.getInterpolatedAttribute(s,o,l,c,e,new mp)),a&&(h.normal=am.getInterpolatedAttribute(a,o,l,c,e,new Vp),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const t={a:o,b:l,c:c,normal:new Vp,materialIndex:0};am.getNormal(zm,jm,Vm,t.normal),h.face=t,h.barycoord=e}return h}class Ym extends Om{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],h=[];let d=0,u=0;function p(e,t,i,n,r,s,p,f,m,g,v){const y=s/m,b=p/g,A=s/2,x=p/2,w=f/2,S=m+1,_=g+1;let E=0,C=0;const M=new Vp;for(let a=0;a<_;a++){const s=a*b-x;for(let o=0;o<S;o++){const d=o*y-A;M[e]=d*n,M[t]=s*r,M[i]=w,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[i]=f>0?1:-1,c.push(M.x,M.y,M.z),h.push(o/m),h.push(1-a/g),E+=1}}for(let a=0;a<g;a++)for(let e=0;e<m;e++){const t=d+e+S*a,i=d+e+S*(a+1),n=d+(e+1)+S*(a+1),r=d+(e+1)+S*a;o.push(t,i,r),o.push(i,n,r),C+=6}a.addGroup(u,C,v),u+=C,d+=E}p("z","y","x",-1,-1,i,t,e,s,r,0),p("z","y","x",1,-1,i,t,-e,s,r,1),p("x","z","y",1,1,e,i,t,n,s,2),p("x","z","y",1,-1,e,i,-t,n,s,3),p("x","y","z",1,-1,e,t,i,n,r,4),p("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new Mm(l,3)),this.setAttribute("normal",new Mm(c,3)),this.setAttribute("uv",new Mm(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ym(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Km(e){const t={};for(const i in e){t[i]={};for(const n in e[i]){const r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][n]=null):t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function Jm(e){const t={};for(let i=0;i<e.length;i++){const n=Km(e[i]);for(const e in n)t[e]=n[e]}return t}function Zm(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:Cp.workingColorSpace}const $m={clone:Km,merge:Jm};class eg extends fm{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Km(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const n in this.extensions)!0===this.extensions[n]&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class tg extends Qf{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new bf,this.projectionMatrix=new bf,this.projectionMatrixInverse=new bf,this.coordinateSystem=tp}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const ig=new Vp,ng=new mp,rg=new mp;class sg extends tg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*op*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*ap*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*op*Math.atan(Math.tan(.5*ap*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){ig.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(ig.x,ig.y).multiplyScalar(-e/ig.z),ig.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(ig.x,ig.y).multiplyScalar(-e/ig.z)}getViewSize(e,t){return this.getViewBounds(e,ng,rg),t.subVectors(rg,ng)}setViewOffset(e,t,i,n,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*ap*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;r+=s.offsetX*n/e,t-=s.offsetY*i/a,n*=s.width/e,i*=s.height/a}const a=this.filmOffset;0!==a&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const ag=-90;class og extends Qf{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new sg(ag,1,e,t);n.layers=this.layers,this.add(n);const r=new sg(ag,1,e,t);r.layers=this.layers,this.add(r);const s=new sg(ag,1,e,t);s.layers=this.layers,this.add(s);const a=new sg(ag,1,e,t);a.layers=this.layers,this.add(a);const o=new sg(ag,1,e,t);o.layers=this.layers,this.add(o);const l=new sg(ag,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,n,r,s,a,o]=t;for(const l of t)this.remove(l);if(e===tp)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==ip)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,s,a,o,l,c]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,n),e.render(t,r),e.setRenderTarget(i,1,n),e.render(t,s),e.setRenderTarget(i,2,n),e.render(t,a),e.setRenderTarget(i,3,n),e.render(t,o),e.setRenderTarget(i,4,n),e.render(t,l),i.texture.generateMipmaps=f,e.setRenderTarget(i,5,n),e.render(t,c),e.setRenderTarget(h,d,u),e.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class lg extends Op{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],arguments.length>1&&void 0!==arguments[1]?arguments[1]:md,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0,arguments.length>9?arguments[9]:void 0),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class cg extends Fp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},n=[i,i,i,i,i,i];this.texture=new lg(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Cd}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Ym(5,5,5),r=new eg({name:"CubemapFromEquirect",uniforms:Km(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Th,blending:0});r.uniforms.tEquirect.value=t;const s=new qm(n,r),a=t.minFilter;t.minFilter===Td&&(t.minFilter=Cd);return new og(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,n);e.setRenderTarget(r)}}class hg extends Qf{constructor(){super(),this.isGroup=!0,this.type="Group"}}const dg={type:"move"};class ug{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new hg,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new hg,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vp,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vp),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new hg,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vp,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vp),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const s of e.hand.values()){const e=t.getJointPose(s,i),n=this._getHandJoint(l,s);null!==e&&(n.matrix.fromArray(e.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.matrixWorldNeedsUpdate=!0,n.jointRadius=e.radius),n.visible=null!==e}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=n.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(n=t.getPose(e.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(dg)))}return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const i=new hg;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class pg extends Qf{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new If,this.environmentIntensity=1,this.environmentRotation=new If,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class fg{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=$u,this.updateRanges=[],this.version=0,this.uuid=lp()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=lp()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=lp()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const mg=new Vp;class gg{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)mg.fromBufferAttribute(this,t),mg.applyMatrix4(e),this.setXYZ(t,mg.x,mg.y,mg.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)mg.fromBufferAttribute(this,t),mg.applyNormalMatrix(e),this.setXYZ(t,mg.x,mg.y,mg.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)mg.fromBufferAttribute(this,t),mg.transformDirection(e),this.setXYZ(t,mg.x,mg.y,mg.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=up(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=pp(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=pp(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=pp(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=pp(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=pp(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=up(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=up(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=up(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=up(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=pp(t,this.array),i=pp(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=pp(t,this.array),i=pp(i,this.array),n=pp(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=pp(t,this.array),i=pp(i,this.array),n=pp(n,this.array),r=pp(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new _m(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new gg(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const vg=new Vp,yg=new Np,bg=new Np,Ag=new Vp,xg=new bf,wg=new Vp,Sg=new hf,_g=new bf,Eg=new yf;class Cg extends qm{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=pd,this.bindMatrix=new bf,this.bindMatrixInverse=new bf,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Wp),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,wg),this.boundingBox.expandByPoint(wg)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new hf),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,wg),this.boundingSphere.expandByPoint(wg)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,n=this.matrixWorld;void 0!==i&&(null===this.boundingSphere&&this.computeBoundingSphere(),Sg.copy(this.boundingSphere),Sg.applyMatrix4(n),!1!==e.ray.intersectsSphere(Sg)&&(_g.copy(n).invert(),Eg.copy(e.ray).applyMatrix4(_g),null!==this.boundingBox&&!1===Eg.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,Eg)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Np,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.fromBufferAttribute(t,i);const n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===pd?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,n=this.geometry;yg.fromBufferAttribute(n.attributes.skinIndex,e),bg.fromBufferAttribute(n.attributes.skinWeight,e),vg.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const e=bg.getComponent(r);if(0!==e){const n=yg.getComponent(r);xg.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),t.addScaledVector(Ag.copy(vg).applyMatrix4(xg),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Mg extends Qf{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Tg extends Op{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:Sd,arguments.length>9&&void 0!==arguments[9]?arguments[9]:Sd,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ig=new bf,Pg=new bf;class Dg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=lp(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new bf)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new bf;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,s=e.length;r<s;r++){const n=e[r]?e[r].matrixWorld:Pg;Ig.multiplyMatrices(n,t[r]),Ig.toArray(i,16*r)}null!==n&&(n.needsUpdate=!0)}clone(){return new Dg(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Tg(t,e,e,Gd,Od);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const n=e.bones[i];let r=t[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new Mg),this.bones.push(r),this.boneInverses.push((new bf).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){const r=t[n];e.bones.push(r.uuid);const s=i[n];e.boneInverses.push(s.toArray())}return e}}class Rg extends _m{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Bg=new bf,Lg=new bf,Og=[],Ng=new Wp,kg=new bf,Fg=new qm,Ug=new hf;class zg extends qm{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Rg(new Float32Array(16*i),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<i;n++)this.setMatrixAt(n,kg)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Wp),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Bg),Ng.copy(e.boundingBox).applyMatrix4(Bg),this.boundingBox.union(Ng)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new hf),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Bg),Ug.copy(e.boundingSphere).applyMatrix4(Bg),this.boundingSphere.union(Ug)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const i=t.morphTargetInfluences,n=this.morphTexture.source.data.data,r=e*(i.length+1)+1;for(let s=0;s<i.length;s++)i[s]=n[r+s]}raycast(e,t){const i=this.matrixWorld,n=this.count;if(Fg.geometry=this.geometry,Fg.material=this.material,void 0!==Fg.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Ug.copy(this.boundingSphere),Ug.applyMatrix4(i),!1!==e.ray.intersectsSphere(Ug)))for(let r=0;r<n;r++){this.getMatrixAt(r,Bg),Lg.multiplyMatrices(i,Bg),Fg.matrixWorld=Lg,Fg.raycast(e,Og);for(let e=0,i=Og.length;e<i;e++){const i=Og[e];i.instanceId=r,i.object=this,t.push(i)}Og.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Rg(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const i=t.morphTargetInfluences,n=i.length+1;null===this.morphTexture&&(this.morphTexture=new Tg(new Float32Array(n*this.count),n,this.count,Qd,Od));const r=this.morphTexture.source.data.data;let s=0;for(let l=0;l<i.length;l++)s+=i[l];const a=this.geometry.morphTargetsRelative?1:1-s,o=n*e;r[o]=a,r.set(i,o+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const jg=new Vp,Vg=new Vp,Gg=new gp;class Hg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vp(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=jg.subVectors(i,t).cross(Vg.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(jg),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||Gg.getNormalMatrix(e),n=this.coplanarPoint(jg).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Wg=new hf,Qg=new Vp;class qg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hg,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Hg,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Hg,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Hg,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Hg,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Hg;this.planes=[e,t,i,n,r,s]}set(e,t,i,n,r,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tp;const i=this.planes,n=e.elements,r=n[0],s=n[1],a=n[2],o=n[3],l=n[4],c=n[5],h=n[6],d=n[7],u=n[8],p=n[9],f=n[10],m=n[11],g=n[12],v=n[13],y=n[14],b=n[15];if(i[0].setComponents(o-r,d-l,m-u,b-g).normalize(),i[1].setComponents(o+r,d+l,m+u,b+g).normalize(),i[2].setComponents(o+s,d+c,m+p,b+v).normalize(),i[3].setComponents(o-s,d-c,m-p,b-v).normalize(),i[4].setComponents(o-a,d-h,m-f,b-y).normalize(),t===tp)i[5].setComponents(o+a,d+h,m+f,b+y).normalize();else{if(t!==ip)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);i[5].setComponents(a,h,f,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Wg.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Wg.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Wg)}intersectsSprite(e){return Wg.center.set(0,0,0),Wg.radius=.7071067811865476,Wg.applyMatrix4(e.matrixWorld),this.intersectsSphere(Wg)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++){if(t[r].distanceToPoint(i)<n)return!1}return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(Qg.x=n.normal.x>0?e.max.x:e.min.x,Qg.y=n.normal.y>0?e.max.y:e.min.y,Qg.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Qg)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}class Xg extends fm{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new dm(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Yg=new Vp,Kg=new Vp,Jg=new bf,Zg=new yf,$g=new hf,ev=new Vp,tv=new Vp;class iv extends Qf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Om,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Xg;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)Yg.fromBufferAttribute(t,e-1),Kg.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=Yg.distanceTo(Kg);e.setAttribute("lineDistance",new Mm(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),$g.copy(i.boundingSphere),$g.applyMatrix4(n),$g.radius+=r,!1===e.ray.intersectsSphere($g))return;Jg.copy(n).invert(),Zg.copy(e.ray).applyMatrix4(Jg);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=this.isLineSegments?2:1,c=i.index,h=i.attributes.position;if(null!==c){const i=Math.max(0,s.start),n=Math.min(c.count,s.start+s.count);for(let r=i,s=n-1;r<s;r+=l){const i=c.getX(r),n=c.getX(r+1),s=nv(this,e,Zg,o,i,n,r);s&&t.push(s)}if(this.isLineLoop){const r=c.getX(n-1),s=c.getX(i),a=nv(this,e,Zg,o,r,s,n-1);a&&t.push(a)}}else{const i=Math.max(0,s.start),n=Math.min(h.count,s.start+s.count);for(let r=i,s=n-1;r<s;r+=l){const i=nv(this,e,Zg,o,r,r+1,r);i&&t.push(i)}if(this.isLineLoop){const r=nv(this,e,Zg,o,n-1,i,n-1);r&&t.push(r)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function nv(e,t,i,n,r,s,a){const o=e.geometry.attributes.position;Yg.fromBufferAttribute(o,r),Kg.fromBufferAttribute(o,s);if(i.distanceSqToSegment(Yg,Kg,ev,tv)>n)return;ev.applyMatrix4(e.matrixWorld);const l=t.ray.origin.distanceTo(ev);return l<t.near||l>t.far?void 0:{distance:l,point:tv.clone().applyMatrix4(e.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:e}}const rv=new Vp,sv=new Vp;class av extends iv{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)rv.fromBufferAttribute(t,e),sv.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+rv.distanceTo(sv);e.setAttribute("lineDistance",new Mm(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ov extends iv{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class lv extends fm{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new dm(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const cv=new bf,hv=new yf,dv=new hf,uv=new Vp;class pv extends Qf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Om,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new lv;super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),dv.copy(i.boundingSphere),dv.applyMatrix4(n),dv.radius+=r,!1===e.ray.intersectsSphere(dv))return;cv.copy(n).invert(),hv.copy(e.ray).applyMatrix4(cv);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=i.index,c=i.attributes.position;if(null!==l){for(let i=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);i<r;i++){const r=l.getX(i);uv.fromBufferAttribute(c,r),fv(uv,r,o,n,e,t,this)}}else{for(let i=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);i<r;i++)uv.fromBufferAttribute(c,i),fv(uv,i,o,n,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function fv(e,t,i,n,r,s,a){const o=hv.distanceSqToPoint(e);if(o<i){const i=new Vp;hv.closestPointToPoint(e,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class mv extends Op{constructor(e,t,i,n){super(e,t,i,n,arguments.length>4&&void 0!==arguments[4]?arguments[4]:Cd,arguments.length>5&&void 0!==arguments[5]?arguments[5]:Cd,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0),this.isVideoTexture=!0,this.generateMipmaps=!1;const r=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){r.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class gv extends Op{constructor(e,t,i,n,r,s,a,o,l,c,h,d){super(null,s,a,o,l,c,n,r,h,d),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class vv extends gv{constructor(e,t,i,n,r,s){super(e,t,i,r,s),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=xd,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class yv extends gv{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,md),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class bv extends Op{constructor(e,t,i,n,r,s,a,o,l){super(e,t,i,n,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Av extends Op{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ld,n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Sd,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Sd,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Hd;if(c!==Hd&&c!==Wd)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,n,r,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Rp(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class xv extends Om{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const r=e/2,s=t/2,a=Math.floor(i),o=Math.floor(n),l=a+1,c=o+1,h=e/a,d=t/o,u=[],p=[],f=[],m=[];for(let g=0;g<c;g++){const e=g*d-s;for(let t=0;t<l;t++){const i=t*h-r;p.push(i,-e,0),f.push(0,0,1),m.push(t/a),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let e=0;e<a;e++){const t=e+l*g,i=e+l*(g+1),n=e+1+l*(g+1),r=e+1+l*g;u.push(t,i,r),u.push(i,n,r)}this.setIndex(u),this.setAttribute("position",new Mm(p,3)),this.setAttribute("normal",new Mm(f,3)),this.setAttribute("uv",new Mm(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xv(e.width,e.height,e.widthSegments,e.heightSegments)}}class wv extends Om{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const o=Math.min(s+a,Math.PI);let l=0;const c=[],h=new Vp,d=new Vp,u=[],p=[],f=[],m=[];for(let g=0;g<=i;g++){const u=[],v=g/i;let y=0;0===g&&0===s?y=.5/t:g===i&&o===Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){const o=i/t;h.x=-e*Math.cos(n+o*r)*Math.sin(s+v*a),h.y=e*Math.cos(s+v*a),h.z=e*Math.sin(n+o*r)*Math.sin(s+v*a),p.push(h.x,h.y,h.z),d.copy(h).normalize(),f.push(d.x,d.y,d.z),m.push(o+y,1-v),u.push(l++)}c.push(u)}for(let g=0;g<i;g++)for(let e=0;e<t;e++){const t=c[g][e+1],n=c[g][e],r=c[g+1][e],a=c[g+1][e+1];(0!==g||s>0)&&u.push(t,n,a),(g!==i-1||o<Math.PI)&&u.push(n,r,a)}this.setIndex(u),this.setAttribute("position",new Mm(p,3)),this.setAttribute("normal",new Mm(f,3)),this.setAttribute("uv",new Mm(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wv(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Sv extends fm{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new dm(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dm(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new mp(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new If,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class _v extends Sv{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new mp(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return cp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new dm(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new dm(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new dm(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!==e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!==e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Ev extends fm{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Cv extends fm{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Mv(e,t){return e&&e.constructor!==t?"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function Tv(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Iv(e){const t=e.length,i=new Array(t);for(let n=0;n!==t;++n)i[n]=n;return i.sort((function(t,i){return e[t]-e[i]})),i}function Pv(e,t,i){const n=e.length,r=new e.constructor(n);for(let s=0,a=0;a!==n;++s){const n=i[s]*t;for(let i=0;i!==t;++i)r[a++]=e[n+i]}return r}function Dv(e,t,i,n){let r=1,s=e[0];for(;void 0!==s&&void 0===s[n];)s=e[r++];if(void 0===s)return;let a=s[n];if(void 0!==a)if(Array.isArray(a))do{a=s[n],void 0!==a&&(t.push(s.time),i.push(...a)),s=e[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[n],void 0!==a&&(t.push(s.time),a.toArray(i,i.length)),s=e[r++]}while(void 0!==s);else do{a=s[n],void 0!==a&&(t.push(s.time),i.push(a)),s=e[r++]}while(void 0!==s)}class Rv{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let s;i:{n:if(!(e<n)){for(let s=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(r=n,n=t[++i],e<n)break t}s=t.length;break i}if(e>=r)break e;{const a=t[1];e<a&&(i=2,r=a);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===s)break;if(n=r,r=t[--i-1],e>=r)break t}s=i,i=0}}for(;i<s;){const n=i+s>>>1;e<t[n]?s=n:i=n+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let s=0;s!==n;++s)t[s]=i[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Bv extends Rv{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ou,endingEnd:Ou}}intervalChanged_(e,t,i){const n=this.parameterPositions;let r=e-2,s=e+1,a=n[r],o=n[s];if(void 0===a)switch(this.getSettings_().endingStart){case Nu:r=e,a=2*t-i;break;case ku:r=n.length-2,a=t+n[r]-n[r+1];break;default:r=e,a=i}if(void 0===o)switch(this.getSettings_().endingEnd){case Nu:s=e,o=2*i-t;break;case ku:s=1,o=i+n[1]-n[0];break;default:s=e-1,o=t}const l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,u=this._weightNext,p=(i-t)/(n-t),f=p*p,m=f*p,g=-d*m+2*d*f-d*p,v=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,y=(-1-u)*m+(1.5+u)*f+.5*p,b=u*m-u*f;for(let A=0;A!==a;++A)r[A]=g*s[c+A]+v*s[l+A]+y*s[o+A]+b*s[h+A];return r}}class Lv extends Rv{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(i-t)/(n-t),h=1-c;for(let d=0;d!==a;++d)r[d]=s[l+d]*h+s[o+d]*c;return r}}class Ov extends Rv{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class Nv{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Mv(t,this.TimeBufferType),this.values=Mv(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Mv(e.times,Array),values:Mv(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Ov(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Lv(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Bv(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ru:t=this.InterpolantFactoryMethodDiscrete;break;case Bu:t=this.InterpolantFactoryMethodLinear;break;case Lu:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ru;case this.InterpolantFactoryMethodLinear:return Bu;case this.InterpolantFactoryMethodSmooth:return Lu}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==s&&i[s]>t;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=i.slice(r,s),this.values=this.values.slice(r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==r;a++){const t=i[a];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,t),e=!1;break}if(null!==s&&s>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,t,s),e=!1;break}s=t}if(void 0!==n&&Tv(n))for(let a=0,o=n.length;a!==o;++a){const t=n[a];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),n=this.getInterpolation()===Lu,r=e.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(n)r=!0;else{const e=a*i,n=e-i,s=e+i;for(let a=0;a!==i;++a){const i=t[e+a];if(i!==t[n+a]||i!==t[s+a]){r=!0;break}}}if(r){if(a!==s){e[s]=e[a];const n=a*i,r=s*i;for(let e=0;e!==i;++e)t[r+e]=t[n+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*i,n=s*i,a=0;a!==i;++a)t[n+a]=t[e+a];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=t.slice(0,s*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Nv.prototype.ValueTypeName="",Nv.prototype.TimeBufferType=Float32Array,Nv.prototype.ValueBufferType=Float32Array,Nv.prototype.DefaultInterpolation=Bu;class kv extends Nv{constructor(e,t,i){super(e,t,i)}}kv.prototype.ValueTypeName="bool",kv.prototype.ValueBufferType=Array,kv.prototype.DefaultInterpolation=Ru,kv.prototype.InterpolantFactoryMethodLinear=void 0,kv.prototype.InterpolantFactoryMethodSmooth=void 0;class Fv extends Nv{constructor(e,t,i,n){super(e,t,i,n)}}Fv.prototype.ValueTypeName="color";class Uv extends Nv{constructor(e,t,i,n){super(e,t,i,n)}}Uv.prototype.ValueTypeName="number";class zv extends Rv{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-t)/(n-t);let l=e*a;for(let c=l+a;l!==c;l+=4)jp.slerpFlat(r,0,s,l-a,s,l,o);return r}}class jv extends Nv{constructor(e,t,i,n){super(e,t,i,n)}InterpolantFactoryMethodLinear(e){return new zv(this.times,this.values,this.getValueSize(),e)}}jv.prototype.ValueTypeName="quaternion",jv.prototype.InterpolantFactoryMethodSmooth=void 0;class Vv extends Nv{constructor(e,t,i){super(e,t,i)}}Vv.prototype.ValueTypeName="string",Vv.prototype.ValueBufferType=Array,Vv.prototype.DefaultInterpolation=Ru,Vv.prototype.InterpolantFactoryMethodLinear=void 0,Vv.prototype.InterpolantFactoryMethodSmooth=void 0;class Gv extends Nv{constructor(e,t,i,n){super(e,t,i,n)}}Gv.prototype.ValueTypeName="vector";class Hv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Fu;this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=lp(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)t.push(Wv(i[s]).scale(n));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=i.length;r!==s;++r)t.push(Nv.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const r=t.length,s=[];for(let a=0;a<r;a++){let e=[],o=[];e.push((a+r-1)%r,a,(a+1)%r),o.push(0,1,0);const l=Iv(e);e=Pv(e,1,l),o=Pv(o,1,l),n||0!==e[0]||(e.push(r),o.push(o[0])),s.push(new Uv(".morphTargetInfluences["+t[a].name+"]",e,o).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){const t=e[a],i=t.name.match(r);if(i&&i.length>1){const e=i[1];let r=n[e];r||(n[e]=r=[]),r.push(t)}}const s=[];for(const a in n)s.push(this.CreateFromMorphTargetSequence(a,n[a],t,i));return s}static parseAnimation(e,t){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,n,r){if(0!==i.length){const s=[],a=[];Dv(i,s,a,n),0!==s.length&&r.push(new e(t,s,a))}},n=[],r=e.name||"default",s=e.fps||30,a=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let i;for(i=0;i<e.length;i++)if(e[i].morphTargets)for(let n=0;n<e[i].morphTargets.length;n++)t[e[i].morphTargets[n]]=-1;for(const r in t){const t=[],s=[];for(let n=0;n!==e[i].morphTargets.length;++n){const n=e[i];t.push(n.time),s.push(n.morphTarget===r?1:0)}n.push(new Uv(".morphTargetInfluence["+r+"]",t,s))}o=t.length*s}else{const r=".bones["+t[c].name+"]";i(Gv,r+".position",e,"pos",n),i(jv,r+".quaternion",e,"rot",n),i(Gv,r+".scale",e,"scl",n)}}if(0===n.length)return null;return new this(r,o,n,a)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Wv(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Uv;case"vector":case"vector2":case"vector3":case"vector4":return Gv;case"color":return Fv;case"quaternion":return jv;case"bool":case"boolean":return kv;case"string":return Vv}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];Dv(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Qv={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class qv{constructor(e,t,i){const n=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++,!1===s&&void 0!==n.onStart&&n.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==n.onProgress&&n.onProgress(e,a,o),a===o&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}}const Xv=new qv;class Yv{constructor(e){this.manager=void 0!==e?e:Xv,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise((function(n,r){i.load(e,n,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Yv.DEFAULT_MATERIAL_NAME="__DEFAULT";const Kv={};class Jv extends Error{constructor(e,t){super(e),this.response=t}}class Zv extends Yv{constructor(e){super(e),this.mimeType="",this.responseType=""}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Qv.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==Kv[e])return void Kv[e].push({onLoad:t,onProgress:i,onError:n});Kv[e]=[],Kv[e].push({onLoad:t,onProgress:i,onError:n});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const i=Kv[e],n=t.body.getReader(),r=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(e){!function t(){n.read().then((n=>{let{done:r,value:l}=n;if(r)e.close();else{o+=l.byteLength;const n=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onProgress&&t.onProgress(n)}e.enqueue(l),t()}}),(t=>{e.error(t)}))}()}});return new Response(l)}throw new Jv(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(""===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),i=t&&t[1]?t[1].toLowerCase():void 0,n=new TextDecoder(i);return e.arrayBuffer().then((e=>n.decode(e)))}}})).then((t=>{Qv.add(e,t);const i=Kv[e];delete Kv[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onLoad&&n.onLoad(t)}})).catch((t=>{const i=Kv[e];if(void 0===i)throw this.manager.itemError(e),t;delete Kv[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class $v extends Yv{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Qv.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const a=bp("img");function o(){c(),Qv.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class ey extends Yv{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new Tg,a=new Zv(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,(function(e){let i;try{i=r.parse(e)}catch(a){if(void 0===n)return void console.error(a);n(a)}void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:xd,s.wrapT=void 0!==i.wrapT?i.wrapT:xd,s.magFilter=void 0!==i.magFilter?i.magFilter:Cd,s.minFilter=void 0!==i.minFilter?i.minFilter:Cd,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.colorSpace&&(s.colorSpace=i.colorSpace),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=Td),1===i.mipmapCount&&(s.minFilter=Cd),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,t&&t(s,i)}),i,n),s}}class ty extends Yv{constructor(e){super(e)}load(e,t,i,n){const r=new Op,s=new $v(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),i,n),r}}class iy extends Qf{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new dm(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}class ny extends iy{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Qf.DEFAULT_UP),this.updateMatrix(),this.groundColor=new dm(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const ry=new bf,sy=new Vp,ay=new Vp;class oy{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new mp(512,512),this.mapType=Id,this.map=null,this.mapPass=null,this.matrix=new bf,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new qg,this._frameExtents=new mp(1,1),this._viewportCount=1,this._viewports=[new Np(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;sy.setFromMatrixPosition(e.matrixWorld),t.position.copy(sy),ay.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(ay),t.updateMatrixWorld(),ry.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ry),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(ry)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class ly extends oy{constructor(){super(new sg(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=2*op*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;i===t.fov&&n===t.aspect&&r===t.far||(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class cy extends iy{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Qf.DEFAULT_UP),this.updateMatrix(),this.target=new Qf,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new ly}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const hy=new bf,dy=new Vp,uy=new Vp;class py extends oy{constructor(){super(new sg(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new mp(4,2),this._viewportCount=6,this._viewports=[new Np(2,1,1,1),new Np(0,1,1,1),new Np(3,1,1,1),new Np(1,1,1,1),new Np(3,0,1,1),new Np(1,0,1,1)],this._cubeDirections=[new Vp(1,0,0),new Vp(-1,0,0),new Vp(0,0,1),new Vp(0,0,-1),new Vp(0,1,0),new Vp(0,-1,0)],this._cubeUps=[new Vp(0,1,0),new Vp(0,1,0),new Vp(0,1,0),new Vp(0,1,0),new Vp(0,0,1),new Vp(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),dy.setFromMatrixPosition(e.matrixWorld),i.position.copy(dy),uy.copy(i.position),uy.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(uy),i.updateMatrixWorld(),n.makeTranslation(-dy.x,-dy.y,-dy.z),hy.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(hy)}}class fy extends iy{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new py}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class my extends tg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,s=i+e,a=n+t,o=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class gy extends oy{constructor(){super(new my(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class vy extends iy{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Qf.DEFAULT_UP),this.updateMatrix(),this.target=new Qf,this.shadow=new gy}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class yy{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Vp)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*n),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*i),t.addScaledVector(s[4],i*n*1.092548),t.addScaledVector(s[5],n*r*1.092548),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],i*r*1.092548),t.addScaledVector(s[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*n),t.addScaledVector(s[2],1.023328*r),t.addScaledVector(s[3],1.023328*i),t.addScaledVector(s[4],.858086*i*n),t.addScaledVector(s[5],.858086*n*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],.858086*i*r),t.addScaledVector(s[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+3*n);return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){const i=e.x,n=e.y,r=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-n*n)}}class by extends iy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yy;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Ay{static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class xy extends Yv{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Qv.get(e);if(void 0!==s)return r.manager.itemStart(e),s.then?void s.then((i=>{t&&t(i),r.manager.itemEnd(e)})).catch((e=>{n&&n(e)})):(setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s);const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader;const o=fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){return Qv.add(e,i),t&&t(i),r.manager.itemEnd(e),i})).catch((function(t){n&&n(t),Qv.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)}));Qv.add(e,o),r.manager.itemStart(e)}}class wy extends sg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class Sy{constructor(e,t,i){let n,r,s;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,r=e*n+n;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==n;++e)i[r+e]=i[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(i,r,0,e,n)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-r,t)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let r=i,s=n;r!==s;++r)t[r]=t[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let s=0;s!==r;++s)e[t+s]=e[i+s]}_slerp(e,t,i,n){jp.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){const s=this._workIndex*r;jp.multiplyQuaternionsFlat(e,s,e,t,e,i),jp.slerpFlat(e,t,e,t,e,s,n)}_lerp(e,t,i,n,r){const s=1-n;for(let a=0;a!==r;++a){const r=t+a;e[r]=e[r]*s+e[i+a]*n}}_lerpAdditive(e,t,i,n,r){for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]+e[i+s]*n}}}const _y="\\[\\]\\.:\\/",Ey=new RegExp("["+_y+"]","g"),Cy="[^"+_y+"]",My="[^"+_y.replace("\\.","")+"]",Ty=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Cy)+/(WCOD+)?/.source.replace("WCOD",My)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Cy)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Cy)+"$"),Iy=["material","materials","bones","map"];class Py{constructor(e,t,i){this.path=t,this.parsedPath=i||Py.parseTrackName(t),this.node=Py.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Py.Composite(e,t,i):new Py(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Ey,"")}static parseTrackName(e){const t=Ty.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=i.nodeName.substring(n+1);-1!==Iy.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let n=0;n<e.length;n++){const r=e[n];if(r.name===t||r.uuid===t)return r;const s=i(r.children);if(s)return s}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=Py.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}const s=e[n];if(void 0===s){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?a=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Py.Composite=class{constructor(e,t,i){const n=i||Py.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Py.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Py.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Py.prototype.GetterByBindingType=[Py.prototype._getValue_direct,Py.prototype._getValue_array,Py.prototype._getValue_arrayElement,Py.prototype._getValue_toArray],Py.prototype.SetterByBindingTypeAndVersioning=[[Py.prototype._setValue_direct,Py.prototype._setValue_direct_setNeedsUpdate,Py.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Py.prototype._setValue_array,Py.prototype._setValue_array_setNeedsUpdate,Py.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Py.prototype._setValue_arrayElement,Py.prototype._setValue_arrayElement_setNeedsUpdate,Py.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Py.prototype._setValue_fromArray,Py.prototype._setValue_fromArray_setNeedsUpdate,Py.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Dy{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const r=t.tracks,s=r.length,a=new Array(s),o={endingStart:Ou,endingEnd:Ou};for(let l=0;l!==s;++l){const e=r[l].createInterpolant(null);a[l]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Pu,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.fadeOut(t),this.fadeIn(t),!0===i){const i=this._clip.duration,n=e._clip.duration,r=n/i,s=i/n;e.warp(1,r,t),this.warp(s,1,t)}return this}crossFadeTo(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,r=n.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const n=(e-r)*i;n<0||0===i?t=0:(this._startTime=null,t=i*n)}t*=this._updateTimeScale(e);const s=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(s),t[i].accumulateAdditive(a);else for(let i=0,r=e.length;i!==r;++i)e[i].evaluate(s),t[i].accumulate(n,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,r=this._loopCount;const s=i===Du;if(0===e)return-1===r?n:s&&1===(1&r)?t-n:n;if(i===Iu){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=t||n<0){const i=Math.floor(n/t);n-=t*i,r+=Math.abs(i);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1===(1&r))return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=Nu,n.endingEnd=Nu):(n.endingStart=e?this.zeroSlopeAtStart?Nu:Ou:ku,n.endingEnd=t?this.zeroSlopeAtEnd?Nu:Ou:ku)}_scheduleFading(e,t,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=t,a[1]=r+e,o[1]=i,this}}const Ry=new Float32Array(1);class By extends np{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,s=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let h=0;h!==r;++h){const e=n[h],r=e.name;let l=c[r];if(void 0!==l)++l.referenceCount,s[h]=l;else{if(l=s[h],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,r));continue}const n=t&&t._propertyBindings[h].binding.parsedPath;l=new Sy(Py.create(i,r,n),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,o,r),s[h]=l}a[h].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,r=this._actionsByClip;let s=r[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const e=t[i];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[t];void 0===s&&(s={},n[t]=s),s[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[n],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[r],0===Object.keys(a).length&&delete s[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new Lv(new Float32Array(2),new Float32Array(2),1,Ry),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const n=t||this._root,r=n.uuid;let s="string"===typeof e?Hv.findByName(n,e):e;const a=null!==s?s.uuid:e,o=this._actionsByClip[a];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:Fu),void 0!==o){const e=o.actionByRoot[r];if(void 0!==e&&e.blendMode===i)return e;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new Dy(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(e,t){const i=t||this._root,n=i.uuid,r="string"===typeof e?Hv.findByName(i,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[n]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l){t[l]._update(n,e,r,s)}const a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const e=r.knownActions;for(let i=0,n=e.length;i!==n;++i){const n=e[i];this._deactivateAction(n);const r=n._cacheIndex,s=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,t[r]=s,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const r in i){const e=i[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const n=this._bindingsByRootAndName[t];if(void 0!==n)for(const r in n){const e=n[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}const Ly=new bf;function Oy(e,t){return e.distance-t.distance}function Ny(e,t,i,n){let r=!0;if(e.layers.test(t.layers)){!1===e.raycast(t,i)&&(r=!1)}if(!0===r&&!0===n){const n=e.children;for(let e=0,r=n.length;e<r;e++)Ny(n[e],t,i,!0)}}class ky{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.phi=t,this.theta=i}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=cp(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(cp(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}function Fy(e,t,i,n){const r=function(e){switch(e){case Id:case Pd:return{byteLength:1,components:1};case Rd:case Dd:case Nd:return{byteLength:2,components:1};case kd:case Fd:return{byteLength:2,components:4};case Ld:case Bd:case Od:return{byteLength:4,components:1};case zd:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(n);switch(i){case jd:return e*t;case Qd:case qd:return e*t/r.components*r.byteLength;case Xd:case Yd:return e*t*2/r.components*r.byteLength;case Vd:return e*t*3/r.components*r.byteLength;case Gd:case Kd:return e*t*4/r.components*r.byteLength;case Jd:case Zd:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case $d:case eu:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case iu:case ru:return Math.max(e,16)*Math.max(t,8)/4;case tu:case nu:return Math.max(e,8)*Math.max(t,8)/2;case su:case au:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case ou:case lu:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case cu:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case hu:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case du:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case uu:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case pu:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case fu:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case mu:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case gu:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case vu:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case yu:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case bu:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case Au:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case xu:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case wu:case Su:case _u:return Math.ceil(e/4)*Math.ceil(t/4)*16;case Eu:case Cu:return Math.ceil(e/4)*Math.ceil(t/4)*8;case Mu:case Tu:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Sh}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Sh);const Uy=globalThis,zy=Uy.trustedTypes,jy=zy?zy.createPolicy("lit-html",{createHTML:e=>e}):void 0,Vy="$lit$",Gy=`lit$${Math.random().toFixed(9).slice(2)}$`,Hy="?"+Gy,Wy=`<${Hy}>`,Qy=document,qy=()=>Qy.createComment(""),Xy=e=>null===e||"object"!=typeof e&&"function"!=typeof e,Yy=Array.isArray,Ky=e=>Yy(e)||"function"==typeof e?.[Symbol.iterator],Jy="[ \t\n\f\r]",Zy=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,$y=/-->/g,eb=/>/g,tb=RegExp(`>|${Jy}(?:([^\\s"'>=/]+)(${Jy}*=${Jy}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),ib=/'/g,nb=/"/g,rb=/^(?:script|style|textarea|title)$/i,sb=e=>function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return{_$litType$:e,strings:t,values:n}},ab=sb(1),ob=(sb(2),sb(3),Symbol.for("lit-noChange")),lb=Symbol.for("lit-nothing"),cb=new WeakMap,hb=Qy.createTreeWalker(Qy,129);function db(e,t){if(!Yy(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==jy?jy.createHTML(t):t}const ub=(e,t)=>{const i=e.length-1,n=[];let r,s=2===t?"<svg>":3===t?"<math>":"",a=Zy;for(let o=0;o<i;o++){const t=e[o];let i,l,c=-1,h=0;for(;h<t.length&&(a.lastIndex=h,l=a.exec(t),null!==l);)h=a.lastIndex,a===Zy?"!--"===l[1]?a=$y:void 0!==l[1]?a=eb:void 0!==l[2]?(rb.test(l[2])&&(r=RegExp("</"+l[2],"g")),a=tb):void 0!==l[3]&&(a=tb):a===tb?">"===l[0]?(a=r??Zy,c=-1):void 0===l[1]?c=-2:(c=a.lastIndex-l[2].length,i=l[1],a=void 0===l[3]?tb:'"'===l[3]?nb:ib):a===nb||a===ib?a=tb:a===$y||a===eb?a=Zy:(a=tb,r=void 0);const d=a===tb&&e[o+1].startsWith("/>")?" ":"";s+=a===Zy?t+Wy:c>=0?(n.push(i),t.slice(0,c)+Vy+t.slice(c)+Gy+d):t+Gy+(-2===c?o:d)}return[db(e,s+(e[i]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),n]};class pb{constructor(e,t){let i,{strings:n,_$litType$:r}=e;this.parts=[];let s=0,a=0;const o=n.length-1,l=this.parts,[c,h]=ub(n,r);if(this.el=pb.createElement(c,t),hb.currentNode=this.el.content,2===r||3===r){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(i=hb.nextNode())&&l.length<o;){if(1===i.nodeType){if(i.hasAttributes())for(const e of i.getAttributeNames())if(e.endsWith(Vy)){const t=h[a++],n=i.getAttribute(e).split(Gy),r=/([.?@])?(.*)/.exec(t);l.push({type:1,index:s,name:r[2],strings:n,ctor:"."===r[1]?yb:"?"===r[1]?bb:"@"===r[1]?Ab:vb}),i.removeAttribute(e)}else e.startsWith(Gy)&&(l.push({type:6,index:s}),i.removeAttribute(e));if(rb.test(i.tagName)){const e=i.textContent.split(Gy),t=e.length-1;if(t>0){i.textContent=zy?zy.emptyScript:"";for(let n=0;n<t;n++)i.append(e[n],qy()),hb.nextNode(),l.push({type:2,index:++s});i.append(e[t],qy())}}}else if(8===i.nodeType)if(i.data===Hy)l.push({type:2,index:s});else{let e=-1;for(;-1!==(e=i.data.indexOf(Gy,e+1));)l.push({type:7,index:s}),e+=Gy.length-1}s++}}static createElement(e,t){const i=Qy.createElement("template");return i.innerHTML=e,i}}function fb(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,n=arguments.length>3?arguments[3]:void 0;if(t===ob)return t;let r=void 0!==n?i._$Co?.[n]:i._$Cl;const s=Xy(t)?void 0:t._$litDirective$;return r?.constructor!==s&&(r?._$AO?.(!1),void 0===s?r=void 0:(r=new s(e),r._$AT(e,i,n)),void 0!==n?(i._$Co??=[])[n]=r:i._$Cl=r),void 0!==r&&(t=fb(e,r._$AS(e,t.values),r,n)),t}class mb{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:i}=this._$AD,n=(e?.creationScope??Qy).importNode(t,!0);hb.currentNode=n;let r=hb.nextNode(),s=0,a=0,o=i[0];for(;void 0!==o;){if(s===o.index){let t;2===o.type?t=new gb(r,r.nextSibling,this,e):1===o.type?t=new o.ctor(r,o.name,o.strings,this,e):6===o.type&&(t=new xb(r,this,e)),this._$AV.push(t),o=i[++a]}s!==o?.index&&(r=hb.nextNode(),s++)}return hb.currentNode=Qy,n}p(e){let t=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class gb{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,i,n){this.type=2,this._$AH=lb,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=n,this._$Cv=n?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e){e=fb(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this),Xy(e)?e===lb||null==e||""===e?(this._$AH!==lb&&this._$AR(),this._$AH=lb):e!==this._$AH&&e!==ob&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):Ky(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==lb&&Xy(this._$AH)?this._$AA.nextSibling.data=e:this.T(Qy.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:i}=e,n="number"==typeof i?this._$AC(e):(void 0===i.el&&(i.el=pb.createElement(db(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===n)this._$AH.p(t);else{const e=new mb(n,this),i=e.u(this.options);e.p(t),this.T(i),this._$AH=e}}_$AC(e){let t=cb.get(e.strings);return void 0===t&&cb.set(e.strings,t=new pb(e)),t}k(e){Yy(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,n=0;for(const r of e)n===t.length?t.push(i=new gb(this.O(qy()),this.O(qy()),this,this.options)):i=t[n],i._$AI(r),n++;n<t.length&&(this._$AR(i&&i._$AB.nextSibling,n),t.length=n)}_$AR(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._$AA.nextSibling,t=arguments.length>1?arguments[1]:void 0;for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class vb{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,n,r){this.type=1,this._$AH=lb,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=r,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=lb}_$AI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const r=this.strings;let s=!1;if(void 0===r)e=fb(this,e,t,0),s=!Xy(e)||e!==this._$AH&&e!==ob,s&&(this._$AH=e);else{const n=e;let a,o;for(e=r[0],a=0;a<r.length-1;a++)o=fb(this,n[i+a],t,a),o===ob&&(o=this._$AH[a]),s||=!Xy(o)||o!==this._$AH[a],o===lb?e=lb:e!==lb&&(e+=(o??"")+r[a+1]),this._$AH[a]=o}s&&!n&&this.j(e)}j(e){e===lb?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class yb extends vb{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===lb?void 0:e}}class bb extends vb{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==lb)}}class Ab extends vb{constructor(e,t,i,n,r){super(e,t,i,n,r),this.type=5}_$AI(e){if((e=fb(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,0)??lb)===ob)return;const t=this._$AH,i=e===lb&&t!==lb||e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive,n=e!==lb&&(t===lb||i);i&&this.element.removeEventListener(this.name,this,t),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class xb{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){fb(this,e)}}const wb=Uy.litHtmlPolyfillSupport;wb?.(pb,gb),(Uy.litHtmlVersions??=[]).push("3.3.0");const Sb=(e,t,i)=>{const n=i?.renderBefore??t;let r=n._$litPart$;if(void 0===r){const e=i?.renderBefore??null;n._$litPart$=r=new gb(t.insertBefore(qy(),e),e,void 0,i??{})}return r._$AI(e),r},_b=globalThis;class Eb extends Ah{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Sb(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return ob}}Eb._$litElement$=!0,Eb.finalized=!0,_b.litElementHydrateSupport?.({LitElement:Eb});const Cb=_b.litElementPolyfillSupport;Cb?.({LitElement:Eb});(_b.litElementVersions??=[]).push("4.2.0");const Mb=null!=navigator.xr&&null!=self.XRSession&&null!=navigator.xr.isSessionSupported,Tb=Mb&&null!=self.XRSession.prototype.requestHitTestSource,Ib=null!=self.ResizeObserver,Pb=null!=self.IntersectionObserver,Db=Tb,Rb=((()=>{const e=navigator.userAgent||navigator.vendor||self.opera;let t=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)})(),/\bCrOS\b/.test(navigator.userAgent),/android/i.test(navigator.userAgent)),Bb=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,Lb=(/Safari\//.test(navigator.userAgent),/firefox/i.test(navigator.userAgent)),Ob=/OculusBrowser/.test(navigator.userAgent),Nb=(Bb&&/CriOS\//.test(navigator.userAgent),Rb&&!Lb&&!Ob),kb=Boolean(window.webkit&&window.webkit.messageHandlers),Fb=(()=>{if(Bb){if(kb)return Boolean(/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent));{const e=document.createElement("a");return Boolean(e.relList&&e.relList.supports&&e.relList.supports("ar"))}}return!1})(),Ub=e=>e&&"null"!==e?jb(e):null,zb=()=>{if(Db)return;const e=[];throw Mb||e.push("WebXR Device API"),Tb||e.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${e.join(", ")}`)},jb=e=>new URL(e,window.location.toString()).toString(),Vb=(e,t)=>{let i=null;return function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];null!=i&&self.clearTimeout(i),i=self.setTimeout((()=>{i=null,e(...r)}),t)}},Gb=(e,t,i)=>Math.max(t,Math.min(i,e)),Hb=(()=>{const e=new RegExp("[?&]model-viewer-debug-mode(&|$)");return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(e)})();var Wb=function(e,t,i,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,i,a):r(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a};const Qb=Symbol("currentEnvironmentMap"),qb=Symbol("currentBackground"),Xb=Symbol("updateEnvironment"),Yb=Symbol("cancelEnvironmentUpdate"),Kb=ab`
<style>
:host {
  display: block;
  position: relative;
  contain: strict;
  width: 300px;
  height: 150px;
}

.container {
  position: relative;
  overflow: hidden;
}

.userInput {
  width: 100%;
  height: 100%;
  display: none;
  position: relative;
  outline-offset: -1px;
  outline-width: 1px;
}

canvas {
  position: absolute;
  display: none;
  pointer-events: none;
  /* NOTE(cdata): Chrome 76 and below apparently have a bug
   * that causes our canvas not to display pixels unless it is
   * on its own render layer
   * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
   */
  transform: translateZ(0);
}

.show {
  display: block;
}

/* Adapted from HTML5 Boilerplate
 *
 * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
.screen-reader-only {
  border: 0;
  left: 0;
  top: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  white-space: nowrap;
  width: 1px;
  pointer-events: none;
}

.slot {
  position: absolute;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.slot > * {
  pointer-events: initial;
}

.annotation-wrapper ::slotted(*) {
  opacity: var(--max-hotspot-opacity, 1);
  transition: opacity 0.3s;
}

.pointer-tumbling .annotation-wrapper ::slotted(*) {
  pointer-events: none;
}

.annotation-wrapper ::slotted(*) {
  pointer-events: initial;
}

.annotation-wrapper.hide ::slotted(*) {
  opacity: var(--min-hotspot-opacity, 0.25);
}

.slot.poster {
  display: none;
  background-color: inherit;
}

.slot.poster.show {
  display: inherit;
}

.slot.poster > * {
  pointer-events: initial;
}

.slot.poster:not(.show) > * {
  pointer-events: none;
}

#default-poster {
  width: 100%;
  height: 100%;
  /* The default poster is a <button> so we need to set display
   * to prevent it from being affected by text-align: */
  display: block;
  position: absolute;
  border: none;
  padding: 0;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: #fff0;
}

#default-progress-bar {
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

#default-progress-bar > .bar {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--progress-bar-height, 5px);
  background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
  transition: transform 0.09s;
  transform-origin: top left;
  transform: scaleX(0);
  overflow: hidden;
}

#default-progress-bar > .bar.hide {
  transition: opacity 0.3s 1s;
  opacity: 0;
}

.centered {
  align-items: center;
  justify-content: center;
}

.cover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.slot.interaction-prompt {
  display: var(--interaction-prompt-display, flex);
  overflow: hidden;
  opacity: 0;
  will-change: opacity;
  transition: opacity 0.3s;
}

.slot.interaction-prompt.visible {
  opacity: 1;
}

.animated-container {
  will-change: transform, opacity;
  opacity: 0;
  transition: opacity 0.3s;
}

.slot.interaction-prompt > * {
  pointer-events: none;
}

.slot.ar-button {
  -moz-user-select: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  display: var(--ar-button-display, block);
}

.slot.ar-button:not(.enabled) {
  display: none;
}

.fab {
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  width: 40px;
  height: 40px;
  cursor: pointer;
  background-color: #fff;
  box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
  border-radius: 100px;
}

.fab > * {
  opacity: 0.87;
}

#default-ar-button {
  position: absolute;
  bottom: 16px;
  right: 16px;
  transform: scale(var(--ar-button-scale, 1));
  transform-origin: bottom right;
}

.slot.pan-target {
  display: block;
  position: absolute;
  width: 0;
  height: 0;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
  background-color: transparent;
  opacity: 0;
  transition: opacity 0.3s;
}

#default-pan-target {
  width: 6px;
  height: 6px;
  border-radius: 6px;
  border: 1px solid white;
  box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.8);
}

.slot.default {
  pointer-events: none;
}

.slot.progress-bar {
  pointer-events: none;
}

.slot.exit-webxr-ar-button {
  pointer-events: none;
}

.slot.exit-webxr-ar-button:not(.enabled) {
  display: none;
}

#default-exit-webxr-ar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: env(safe-area-inset-top, 16px);
  right: 16px;
  width: 40px;
  height: 40px;
  box-sizing: border-box;
}

#default-exit-webxr-ar-button > svg {
  fill: #fff;
}
</style>
<div class="container">
  <div class="userInput" tabindex="0" role="img"
      aria-label="3D model">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>

  </div>

  <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
  <div class="slot poster">
    <slot name="poster">
      <button type="button" id="default-poster" aria-hidden="true" aria-label="Loading 3D model"></button>
    </slot>
  </div>

  <div class="slot ar-button">
    <slot name="ar-button">
      <a id="default-ar-button" part="default-ar-button" class="fab"
          tabindex="2"
          role="button"
          href="javascript:void(0);"
          aria-label="View in your space">
        ${ab`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`}
      </a>
    </slot>
  </div>

  <div class="slot pan-target">
    <slot name="pan-target">
      <div id="default-pan-target">
      </div>
    </slot>
  </div>

  <div class="slot interaction-prompt cover centered">
    <div id="prompt" class="animated-container">
      <slot name="interaction-prompt" aria-hidden="true">
        ${ab`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`}
      </slot>
    </div>
  </div>

  <div id="finger0" class="animated-container cover">
    <slot name="finger0" aria-hidden="true">
    </slot>
  </div>
  <div id="finger1" class="animated-container cover">
    <slot name="finger1" aria-hidden="true">
    </slot>
  </div>

  <div class="slot default">
    <slot></slot>

    <div class="slot progress-bar">
      <slot name="progress-bar">
        <div id="default-progress-bar" aria-hidden="true">
          <div class="bar" part="default-progress-bar"></div>
        </div>
      </slot>
    </div>

    <div class="slot exit-webxr-ar-button">
      <slot name="exit-webxr-ar-button">
        <a id="default-exit-webxr-ar-button" part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true">
          ${ab`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`}
        </a>
      </slot>
    </div>
  </div>
</div>
<div class="screen-reader-only" role="region" aria-label="Live announcements">
  <span id="status" role="status"></span>
</div>`;var Jb=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!==typeof WebAssembly)return{supported:!1};var i,n=WebAssembly.validate(e)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",r=WebAssembly.instantiate(s(n),{}).then((function(e){(i=e.instance).exports.__wasm_call_ctors()}));function s(e){for(var i=new Uint8Array(e.length),n=0;n<e.length;++n){var r=e.charCodeAt(n);i[n]=r>96?r-97:r>64?r-39:r+4}var s=0;for(n=0;n<e.length;++n)i[s++]=i[n]<60?t[i[n]]:64*(i[n]-60)+i[++n];return i.buffer.slice(0,s)}function a(e,t,n,r,s,a){var o=i.exports.sbrk,l=n+3&-4,c=o(l*r),h=o(s.length),d=new Uint8Array(i.exports.memory.buffer);d.set(s,h);var u=e(c,n,r,h,s.length);if(0==u&&a&&a(c,l,r),t.set(d.subarray(c,c+n*r)),o(c-o(0)),0!=u)throw new Error("Malformed buffer data: "+u)}var o={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},c=[],h=0;function d(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var i=e.data;t.pending-=i.count,t.requests[i.id][i.action](i.value),delete t.requests[i.id]},t}function u(e){for(var t="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(s(n))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+a.toString()+p.toString(),i=new Blob([t],{type:"text/javascript"}),r=URL.createObjectURL(i),o=0;o<e;++o)c[o]=d(r);URL.revokeObjectURL(r)}function p(e){r.then((function(){var t=e.data;try{var n=new Uint8Array(t.count*t.size);a(i.exports[t.mode],n,t.count,t.size,t.source,i.exports[t.filter]),self.postMessage({id:t.id,count:t.count,action:"resolve",value:n},[n.buffer])}catch(r){self.postMessage({id:t.id,count:t.count,action:"reject",value:r})}}))}return{ready:r,supported:!0,useWorkers:function(e){u(e)},decodeVertexBuffer:function(e,t,n,r,s){a(i.exports.meshopt_decodeVertexBuffer,e,t,n,r,i.exports[o[s]])},decodeIndexBuffer:function(e,t,n,r){a(i.exports.meshopt_decodeIndexBuffer,e,t,n,r)},decodeIndexSequence:function(e,t,n,r){a(i.exports.meshopt_decodeIndexSequence,e,t,n,r)},decodeGltfBuffer:function(e,t,n,r,s,c){a(i.exports[l[s]],e,t,n,r,i.exports[o[c]])},decodeGltfBufferAsync:function(e,t,n,s,d){return c.length>0?function(e,t,i,n,r){for(var s=c[0],a=1;a<c.length;++a)c[a].pending<s.pending&&(s=c[a]);return new Promise((function(a,o){var l=new Uint8Array(i),c=h++;s.pending+=e,s.requests[c]={resolve:a,reject:o},s.object.postMessage({id:c,count:e,size:t,source:l,mode:n,filter:r},[l.buffer])}))}(e,t,n,l[s],o[d]):r.then((function(){var r=new Uint8Array(e*t);return a(i.exports[l[s]],r,e,t,n,i.exports[o[d]]),r}))}}}();const Zb=new WeakMap;function $b(){let e,t;function i(e,t,i,n,r,s){const a=s.num_components(),o=i.num_points()*a,l=o*r.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),h=e._malloc(l);t.GetAttributeDataArrayForAllPoints(i,s,c,l,h);const d=new r(e.HEAPF32.buffer,h,o).slice();return e._free(h),{name:n,array:d,itemSize:a}}onmessage=function(n){const r=n.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const n=r.buffer,s=r.taskConfig;t.then((e=>{const t=e.draco,a=new t.Decoder;try{const e=function(e,t,n,r){const s=r.attributeIDs,a=r.attributeTypes;let o,l;const c=t.GetEncodedGeometryType(n);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,l=t.DecodeArrayToMesh(n,n.byteLength,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,l=t.DecodeArrayToPointCloud(n,n.byteLength,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const h={index:null,attributes:[]};for(const d in s){const n=self[a[d]];let l,c;if(r.useUniqueIDs)c=s[d],l=t.GetAttributeByUniqueId(o,c);else{if(c=t.GetAttributeId(o,e[s[d]]),-1===c)continue;l=t.GetAttribute(o,c)}const u=i(e,t,o,d,n,l);"color"===d&&(u.vertexColorSpace=r.vertexColorSpace),h.attributes.push(u)}c===e.TRIANGULAR_MESH&&(h.index=function(e,t,i){const n=i.num_faces(),r=3*n,s=4*r,a=e._malloc(s);t.GetTrianglesUInt32Array(i,s,a);const o=new Uint32Array(e.HEAPF32.buffer,a,r).slice();return e._free(a),{array:o,itemSize:1}}(e,t,o));return e.destroy(o),h}(t,a,new Int8Array(n),s),o=e.attributes.map((e=>e.array.buffer));e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:e},o)}catch(o){console.error(o),self.postMessage({type:"error",id:r.id,error:o.message})}finally{t.destroy(a)}}))}}}function eA(e,t){if(0===t)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(2===t||1===t){let i=e.getIndex();if(null===i){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),i=e.getIndex()}const n=i.count-2,r=[];if(2===t)for(let e=1;e<=n;e++)r.push(i.getX(0)),r.push(i.getX(e)),r.push(i.getX(e+1));else for(let e=0;e<n;e++)e%2===0?(r.push(i.getX(e)),r.push(i.getX(e+1)),r.push(i.getX(e+2))):(r.push(i.getX(e+2)),r.push(i.getX(e+1)),r.push(i.getX(e)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class tA extends Yv{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new oA(e)})),this.register((function(e){return new lA(e)})),this.register((function(e){return new vA(e)})),this.register((function(e){return new yA(e)})),this.register((function(e){return new bA(e)})),this.register((function(e){return new hA(e)})),this.register((function(e){return new dA(e)})),this.register((function(e){return new uA(e)})),this.register((function(e){return new pA(e)})),this.register((function(e){return new aA(e)})),this.register((function(e){return new fA(e)})),this.register((function(e){return new cA(e)})),this.register((function(e){return new gA(e)})),this.register((function(e){return new mA(e)})),this.register((function(e){return new rA(e)})),this.register((function(e){return new AA(e)})),this.register((function(e){return new xA(e)}))}load(e,t,i,n){const r=this;let s;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){const t=Ay.extractUrlBase(e);s=Ay.resolveURL(t,this.path)}else s=Ay.extractUrlBase(e);this.manager.itemStart(e);const a=function(t){n?n(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},o=new Zv(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(i){try{r.parse(i,s,(function(i){t(i),r.manager.itemEnd(e)}),a)}catch(th){a(th)}}),i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let r;const s={},a={},o=new TextDecoder;if("string"===typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer){if(o.decode(new Uint8Array(e,0,4))===wA){try{s[nA.KHR_BINARY_GLTF]=new EA(e)}catch(c){return void(n&&n(c))}r=JSON.parse(s[nA.KHR_BINARY_GLTF].content)}else r=JSON.parse(o.decode(e))}else r=e;if(void 0===r.asset||r.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new JA(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const e=this.pluginCallbacks[h](l);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[e.name]=e,s[e.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const e=r.extensionsUsed[h],t=r.extensionsRequired||[];switch(e){case nA.KHR_MATERIALS_UNLIT:s[e]=new sA;break;case nA.KHR_DRACO_MESH_COMPRESSION:s[e]=new CA(r,this.dracoLoader);break;case nA.KHR_TEXTURE_TRANSFORM:s[e]=new MA;break;case nA.KHR_MESH_QUANTIZATION:s[e]=new TA;break;default:t.indexOf(e)>=0&&void 0===a[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(s),l.setPlugins(a),l.parse(i,n)}parseAsync(e,t){const i=this;return new Promise((function(n,r){i.parse(e,t,n,r)}))}}function iA(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const nA={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class rA{constructor(e){this.parser=e,this.name=nA.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const n=t[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const r=t.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let a;const o=new dm(16777215);void 0!==s.color&&o.setRGB(s.color[0],s.color[1],s.color[2],ju);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new vy(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new fy(o),a.distance=l;break;case"spot":a=new cy(o),a.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),WA(a,s),void 0!==s.intensity&&(a.intensity=s.intensity),a.name=t.createUniqueName(s.name||"light_"+e),n=Promise.resolve(a),t.cache.add(i,n),n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,n=i.json.nodes[e],r=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return i._getNodeRef(t.cache,r,e)}))}}class sA{constructor(){this.name=nA.KHR_MATERIALS_UNLIT}getMaterialType(){return mm}extendParams(e,t,i){const n=[];e.color=new dm(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],ju),e.opacity=t[3]}void 0!==r.baseColorTexture&&n.push(i.assignTexture(e,"map",r.baseColorTexture,zu))}return Promise.all(n)}}class aA{constructor(e){this.parser=e,this.name=nA.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class oA{constructor(e){this.parser=e,this.name=nA.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?_v:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&r.push(i.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(r.push(i.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new mp(e,e)}return Promise.all(r)}}class lA{constructor(e){this.parser=e,this.name=nA.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?_v:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return t.dispersion=void 0!==n.dispersion?n.dispersion:0,Promise.resolve()}}class cA{constructor(e){this.parser=e,this.name=nA.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?_v:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(i.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(i.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class hA{constructor(e){this.parser=e,this.name=nA.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?_v:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new dm(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=n.extensions[this.name];if(void 0!==s.sheenColorFactor){const e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],ju)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&r.push(i.assignTexture(t,"sheenColorMap",s.sheenColorTexture,zu)),void 0!==s.sheenRoughnessTexture&&r.push(i.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class dA{constructor(e){this.parser=e,this.name=nA.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?_v:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(i.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class uA{constructor(e){this.parser=e,this.name=nA.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?_v:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&r.push(i.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const a=s.attenuationColor||[1,1,1];return t.attenuationColor=(new dm).setRGB(a[0],a[1],a[2],ju),Promise.all(r)}}class pA{constructor(e){this.parser=e,this.name=nA.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?_v:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class fA{constructor(e){this.parser=e,this.name=nA.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?_v:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&r.push(i.assignTexture(t,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return t.specularColor=(new dm).setRGB(a[0],a[1],a[2],ju),void 0!==s.specularColorTexture&&r.push(i.assignTexture(t,"specularColorMap",s.specularColorTexture,zu)),Promise.all(r)}}class mA{constructor(e){this.parser=e,this.name=nA.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?_v:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&r.push(i.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(r)}}class gA{constructor(e){this.parser=e,this.name=nA.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?_v:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&r.push(i.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(r)}}class vA{constructor(e){this.parser=e,this.name=nA.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,s)}}class yA{constructor(e){this.parser=e,this.name=nA.EXT_TEXTURE_WEBP}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],a=n.images[s.source];let o=i.textureLoader;if(a.uri){const e=i.options.manager.getHandler(a.uri);null!==e&&(o=e)}return i.loadTextureImage(e,s.source,o)}}class bA{constructor(e){this.parser=e,this.name=nA.EXT_TEXTURE_AVIF}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],a=n.images[s.source];let o=i.textureLoader;if(a.uri){const e=i.options.manager.getHandler(a.uri);null!==e&&(o=e)}return i.loadTextureImage(e,s.source,o)}}class AA{constructor(e){this.name=nA.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const e=i.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(t){const i=e.byteOffset||0,n=e.byteLength||0,s=e.count,a=e.byteStride,o=new Uint8Array(t,i,n);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,a,o,e.mode,e.filter).then((function(e){return e.buffer})):r.ready.then((function(){const t=new ArrayBuffer(s*a);return r.decodeGltfBuffer(new Uint8Array(t),s,a,o,e.mode,e.filter),t}))}))}return null}}class xA{constructor(e){this.name=nA.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const n=t.meshes[i.mesh];for(const o of n.primitives)if(o.mode!==RA.TRIANGLES&&o.mode!==RA.TRIANGLE_STRIP&&o.mode!==RA.TRIANGLE_FAN&&void 0!==o.mode)return null;const r=i.extensions[this.name].attributes,s=[],a={};for(const o in r)s.push(this.parser.getDependency("accessor",r[o]).then((e=>(a[o]=e,a[o]))));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then((e=>{const t=e.pop(),i=t.isGroup?t.children:[t],n=e[0].count,r=[];for(const s of i){const e=new bf,t=new Vp,i=new jp,o=new Vp(1,1,1),l=new zg(s.geometry,s.material,n);for(let r=0;r<n;r++)a.TRANSLATION&&t.fromBufferAttribute(a.TRANSLATION,r),a.ROTATION&&i.fromBufferAttribute(a.ROTATION,r),a.SCALE&&o.fromBufferAttribute(a.SCALE,r),l.setMatrixAt(r,e.compose(t,i,o));for(const n in a)if("_COLOR_0"===n){const e=a[n];l.instanceColor=new Rg(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==n&&"ROTATION"!==n&&"SCALE"!==n&&s.geometry.setAttribute(n,a[n]);Qf.prototype.copy.call(l,s),this.parser.assignFinalMaterial(l),r.push(l)}return t.isGroup?(t.clear(),t.add(...r),t):r[0]})))}}const wA="glTF",SA=1313821514,_A=5130562;class EA{constructor(e){this.name=nA.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==wA)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,r=new DataView(e,12);let s=0;for(;s<n;){const t=r.getUint32(s,!0);s+=4;const n=r.getUint32(s,!0);if(s+=4,n===SA){const n=new Uint8Array(e,12+s,t);this.content=i.decode(n)}else if(n===_A){const i=12+s;this.body=e.slice(i,i+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class CA{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=nA.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},o={},l={};for(const c in s){const e=kA[c]||c.toLowerCase();a[e]=s[c]}for(const c in e.attributes){const t=kA[c]||c.toLowerCase();if(void 0!==s[c]){const n=i.accessors[e.attributes[c]],r=BA[n.componentType];l[t]=r.name,o[t]=!0===n.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t,i){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const i=e.attributes[t],n=o[t];void 0!==n&&(i.normalized=n)}t(e)}),a,l,ju,i)}))}))}}class MA{constructor(){this.name=nA.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class TA{constructor(){this.name=nA.KHR_MESH_QUANTIZATION}}class IA extends Rv{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n*3+n;for(let s=0;s!==n;s++)t[s]=i[r+s];return t}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,c=n-t,h=(i-t)/c,d=h*h,u=d*h,p=e*l,f=p-l,m=-2*u+3*d,g=u-d,v=1-m,y=g-d+h;for(let b=0;b!==a;b++){const e=s[f+b+a],t=s[f+b+o]*c,i=s[p+b+a],n=s[p+b]*c;r[b]=v*e+y*t+m*i+g*n}return r}}const PA=new jp;class DA extends IA{interpolate_(e,t,i,n){const r=super.interpolate_(e,t,i,n);return PA.fromArray(r).normalize().toArray(r),r}}const RA={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},BA={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},LA={9728:Sd,9729:Cd,9984:_d,9985:Md,9986:Ed,9987:Td},OA={33071:xd,33648:wd,10497:Ad},NA={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},kA={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},FA={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},UA={CUBICSPLINE:void 0,LINEAR:Bu,STEP:Ru},zA="OPAQUE",jA="MASK",VA="BLEND";function GA(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new Sv({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Mh})),e.DefaultMaterial}function HA(e,t,i){for(const n in i.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=i.extensions[n])}function WA(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function QA(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,n=i.length;t<n;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function qA(e){let t;const i=e.extensions&&e.extensions[nA.KHR_DRACO_MESH_COMPRESSION];if(t=i?"draco:"+i.bufferView+":"+i.indices+":"+XA(i.attributes):e.indices+":"+XA(e.attributes)+":"+e.mode,void 0!==e.targets)for(let n=0,r=e.targets.length;n<r;n++)t+=":"+XA(e.targets[n]);return t}function XA(e){let t="";const i=Object.keys(e).sort();for(let n=0,r=i.length;n<r;n++)t+=i[n]+":"+e[i[n]]+";";return t}function YA(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const KA=new bf;class JA{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new iA,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=-1,r=!1,s=-1;if("undefined"!==typeof navigator){const e=navigator.userAgent;i=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);n=i&&t?parseInt(t[1],10):-1,r=e.indexOf("Firefox")>-1,s=r?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"===typeof createImageBitmap||i&&n<17||r&&s<98?this.textureLoader=new ty(this.options.manager):this.textureLoader=new xy(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Zv(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(t){const s={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:i,userData:{}};return HA(r,s,n),WA(s,n),Promise.all(i._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){for(const e of s.scenes)e.updateMatrixWorld();e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const i=t[n].joints;for(let t=0,n=i.length;t<n;t++)e[i[t]].isBone=!0}for(let n=0,r=e.length;n<r;n++){const t=e[n];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(i[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),r=(e,t)=>{const i=this.associations.get(e);null!=i&&this.associations.set(t,i);for(const[n,s]of e.children.entries())r(s,t.children[n])};return r(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const r=e(t[n]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)})),!n)throw new Error("Unknown type: "+e)}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return i.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[nA.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,r){i.load(Ay.resolveURL(t.uri,n.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const i=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+i)}))}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse){const e=NA[n.type],t=BA[n.componentType],i=!0===n.normalized,r=new t(n.count*e);return Promise.resolve(new _m(r,e,i))}const r=[];return void 0!==n.bufferView?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),void 0!==n.sparse&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then((function(e){const r=e[0],s=NA[n.type],a=BA[n.componentType],o=a.BYTES_PER_ELEMENT,l=o*s,c=n.byteOffset||0,h=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,d=!0===n.normalized;let u,p;if(h&&h!==l){const e=Math.floor(c/h),i="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let l=t.cache.get(i);l||(u=new a(r,e*h,n.count*h/o),l=new fg(u,h/o),t.cache.add(i,l)),p=new gg(l,s,c%h/o,d)}else u=null===r?new a(n.count*s):new a(r,c,n.count*s),p=new _m(u,s,d);if(void 0!==n.sparse){const t=NA.SCALAR,i=BA[n.sparse.indices.componentType],o=n.sparse.indices.byteOffset||0,l=n.sparse.values.byteOffset||0,c=new i(e[1],o,n.sparse.count*t),h=new a(e[2],l,n.sparse.count*s);null!==r&&(p=new _m(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let e=0,n=c.length;e<n;e++){const t=c[e];if(p.setX(t,h[e*s]),s>=2&&p.setY(t,h[e*s+1]),s>=3&&p.setZ(t,h[e*s+2]),s>=4&&p.setW(t,h[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=d}return p}))}loadTexture(e){const t=this.json,i=this.options,n=t.textures[e].source,r=t.images[n];let s=this.textureLoader;if(r.uri){const e=i.manager.getHandler(r.uri);null!==e&&(s=e)}return this.loadTextureImage(e,n,s)}loadTextureImage(e,t,i){const n=this,r=this.json,s=r.textures[e],a=r.images[t],o=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(t,i).then((function(t){t.flipY=!1,t.name=s.name||a.name||"",""===t.name&&"string"===typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);const i=(r.samplers||{})[s.sampler]||{};return t.magFilter=LA[i.magFilter]||Cd,t.minFilter=LA[i.minFilter]||Td,t.wrapS=OA[i.wrapS]||Ad,t.wrapT=OA[i.wrapT]||Ad,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==Sd&&t.minFilter!==Cd,n.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[o]=l,l}loadImageSource(e,t){const i=this,n=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const s=n.images[e],a=self.URL||self.webkitURL;let o=s.uri||"",l=!1;if(void 0!==s.bufferView)o=i.getDependency("bufferView",s.bufferView).then((function(e){l=!0;const t=new Blob([e],{type:s.mimeType});return o=a.createObjectURL(t),o}));else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(o).then((function(e){return new Promise((function(i,n){let s=i;!0===t.isImageBitmapLoader&&(s=function(e){const t=new Op(e);t.needsUpdate=!0,i(t)}),t.load(Ay.resolveURL(e,r.path),s,void 0,n)}))})).then((function(e){var t;return!0===l&&a.revokeObjectURL(o),WA(e,s),e.userData.mimeType=s.mimeType||((t=s.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=c,c}assignTexture(e,t,i,n){const r=this;return this.getDependency("texture",i.index).then((function(s){if(!s)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((s=s.clone()).channel=i.texCoord),r.extensions[nA.KHR_TEXTURE_TRANSFORM]){const e=void 0!==i.extensions?i.extensions[nA.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(s);s=r.extensions[nA.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),r.associations.set(s,t)}}return void 0!==n&&(s.colorSpace=n),e[t]=s,s}))}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new lv,fm.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,t.sizeAttenuation=!1,this.cache.add(e,t)),i=t}else if(e.isLine){const e="LineBasicMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new Xg,fm.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,this.cache.add(e,t)),i=t}if(n||r||s){let e="ClonedMaterial:"+i.uuid+":";n&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=i.clone(),r&&(t.vertexColors=!0),s&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}e.material=i}getMaterialType(){return Sv}loadMaterial(e){const t=this,i=this.json,n=this.extensions,r=i.materials[e];let s;const a={},o=[];if((r.extensions||{})[nA.KHR_MATERIALS_UNLIT]){const e=n[nA.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),o.push(e.extendParams(a,r,t))}else{const i=r.pbrMetallicRoughness||{};if(a.color=new dm(1,1,1),a.opacity=1,Array.isArray(i.baseColorFactor)){const e=i.baseColorFactor;a.color.setRGB(e[0],e[1],e[2],ju),a.opacity=e[3]}void 0!==i.baseColorTexture&&o.push(t.assignTexture(a,"map",i.baseColorTexture,zu)),a.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,a.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(o.push(t.assignTexture(a,"metalnessMap",i.metallicRoughnessTexture)),o.push(t.assignTexture(a,"roughnessMap",i.metallicRoughnessTexture))),s=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),o.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===r.doubleSided&&(a.side=Ih);const l=r.alphaMode||zA;if(l===VA?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,l===jA&&(a.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==mm&&(o.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new mp(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;a.normalScale.set(e,e)}if(void 0!==r.occlusionTexture&&s!==mm&&(o.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(a.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==mm){const e=r.emissiveFactor;a.emissive=(new dm).setRGB(e[0],e[1],e[2],ju)}return void 0!==r.emissiveTexture&&s!==mm&&o.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,zu)),Promise.all(o).then((function(){const i=new s(a);return r.name&&(i.name=r.name),WA(i,r),t.associations.set(i,{materials:e}),r.extensions&&HA(n,i,r),i}))}createUniqueName(e){const t=Py.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function r(e){return i[nA.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(i){return ZA(i,e,t)}))}const s=[];for(let a=0,o=e.length;a<o;a++){const i=e[a],o=qA(i),l=n[o];if(l)s.push(l.promise);else{let e;e=i.extensions&&i.extensions[nA.KHR_DRACO_MESH_COMPRESSION]?r(i):ZA(new Om,i,t),n[o]={primitive:i,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,i=this.json,n=this.extensions,r=i.meshes[e],s=r.primitives,a=[];for(let o=0,l=s.length;o<l;o++){const e=void 0===s[o].material?GA(this.cache):this.getDependency("material",s[o].material);a.push(e)}return a.push(t.loadGeometries(s)),Promise.all(a).then((function(i){const a=i.slice(0,i.length-1),o=i[i.length-1],l=[];for(let h=0,d=o.length;h<d;h++){const i=o[h],c=s[h];let d;const u=a[h];if(c.mode===RA.TRIANGLES||c.mode===RA.TRIANGLE_STRIP||c.mode===RA.TRIANGLE_FAN||void 0===c.mode)d=!0===r.isSkinnedMesh?new Cg(i,u):new qm(i,u),!0===d.isSkinnedMesh&&d.normalizeSkinWeights(),c.mode===RA.TRIANGLE_STRIP?d.geometry=eA(d.geometry,1):c.mode===RA.TRIANGLE_FAN&&(d.geometry=eA(d.geometry,2));else if(c.mode===RA.LINES)d=new av(i,u);else if(c.mode===RA.LINE_STRIP)d=new iv(i,u);else if(c.mode===RA.LINE_LOOP)d=new ov(i,u);else{if(c.mode!==RA.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);d=new pv(i,u)}Object.keys(d.geometry.morphAttributes).length>0&&QA(d,r),d.name=t.createUniqueName(r.name||"mesh_"+e),WA(d,r),c.extensions&&HA(n,d,c),t.assignFinalMaterial(d),l.push(d)}for(let n=0,r=l.length;n<r;n++)t.associations.set(l[n],{meshes:e,primitives:n});if(1===l.length)return r.extensions&&HA(n,l[0],r),l[0];const c=new hg;r.extensions&&HA(n,c,r),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c}))}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(n)return"perspective"===i.type?t=new sg(fp.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(t=new my(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),WA(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,r=t.joints.length;n<r;n++)i.push(this._loadNodeShallow(t.joints[n]));return void 0!==t.inverseBindMatrices?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then((function(e){const i=e.pop(),n=e,r=[],s=[];for(let a=0,o=n.length;a<o;a++){const e=n[a];if(e){r.push(e);const t=new bf;null!==i&&t.fromArray(i.array,16*a),s.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}return new Dg(r,s)}))}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],r=n.name?n.name:"animation_"+e,s=[],a=[],o=[],l=[],c=[];for(let h=0,d=n.channels.length;h<d;h++){const e=n.channels[h],t=n.samplers[e.sampler],i=e.target,r=i.node,d=void 0!==n.parameters?n.parameters[t.input]:t.input,u=void 0!==n.parameters?n.parameters[t.output]:t.output;void 0!==i.node&&(s.push(this.getDependency("node",r)),a.push(this.getDependency("accessor",d)),o.push(this.getDependency("accessor",u)),l.push(t),c.push(i))}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c)]).then((function(e){const t=e[0],n=e[1],s=e[2],a=e[3],o=e[4],l=[];for(let r=0,c=t.length;r<c;r++){const e=t[r],c=n[r],h=s[r],d=a[r],u=o[r];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const p=i._createAnimationTracks(e,c,h,d,u);if(p)for(let t=0;t<p.length;t++)l.push(p[t])}return new Hv(r,void 0,l)}))}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then((function(e){const t=i._getNodeRef(i.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,i=n.weights.length;t<i;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this,i=this.json.nodes[e],n=t._loadNodeShallow(e),r=[],s=i.children||[];for(let o=0,l=s.length;o<l;o++)r.push(t.getDependency("node",s[o]));const a=void 0===i.skin?Promise.resolve(null):t.getDependency("skin",i.skin);return Promise.all([n,Promise.all(r),a]).then((function(e){const t=e[0],i=e[1],n=e[2];null!==n&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(n,KA)}));for(let r=0,s=i.length;r<s;r++)t.add(i[r]);return t}))}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const r=t.nodes[e],s=r.name?n.createUniqueName(r.name):"",a=[],o=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return o&&a.push(o),void 0!==r.camera&&a.push(n.getDependency("camera",r.camera).then((function(e){return n._getNodeRef(n.cameraCache,r.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(t){let a;if(a=!0===r.isBone?new Mg:t.length>1?new hg:1===t.length?t[0]:new Qf,a!==t[0])for(let e=0,i=t.length;e<i;e++)a.add(t[e]);if(r.name&&(a.userData.name=r.name,a.name=s),WA(a,r),r.extensions&&HA(i,a,r),void 0!==r.matrix){const e=new bf;e.fromArray(r.matrix),a.applyMatrix4(e)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return n.associations.has(a)||n.associations.set(a,{}),n.associations.get(a).nodes=e,a})),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,r=new hg;i.name&&(r.name=n.createUniqueName(i.name)),WA(r,i),i.extensions&&HA(t,r,i);const s=i.nodes||[],a=[];for(let o=0,l=s.length;o<l;o++)a.push(n.getDependency("node",s[o]));return Promise.all(a).then((function(e){for(let t=0,i=e.length;t<i;t++)r.add(e[t]);return n.associations=(e=>{const t=new Map;for(const[i,r]of n.associations)(i instanceof fm||i instanceof Op)&&t.set(i,r);return e.traverse((e=>{const i=n.associations.get(e);null!=i&&t.set(e,i)})),t})(r),r}))}_createAnimationTracks(e,t,i,n,r){const s=[],a=e.name?e.name:e.uuid,o=[];let l;switch(FA[r.path]===FA.weights?e.traverse((function(e){e.morphTargetInfluences&&o.push(e.name?e.name:e.uuid)})):o.push(a),FA[r.path]){case FA.weights:l=Uv;break;case FA.rotation:l=jv;break;case FA.translation:case FA.scale:l=Gv;break;default:if(1===i.itemSize)l=Uv;else l=Gv}const c=void 0!==n.interpolation?UA[n.interpolation]:Bu,h=this._getArrayFromAccessor(i);for(let d=0,u=o.length;d<u;d++){const e=new l(o[d]+"."+FA[r.path],t.array,h,c);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(e),s.push(e)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=YA(t.constructor),i=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n++)i[n]=t[n]*e;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof jv?DA:IA)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function ZA(e,t,i){const n=t.attributes,r=[];function s(t,n){return i.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const a in n){const t=kA[a]||a.toLowerCase();t in e.attributes||r.push(s(n[a],t))}if(void 0!==t.indices&&!e.index){const n=i.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(n)}return Cp.workingColorSpace!==ju&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Cp.workingColorSpace}" not supported.`),WA(e,t),function(e,t,i){const n=t.attributes,r=new Wp;if(void 0===n.POSITION)return;{const e=i.json.accessors[n.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new Vp(t[0],t[1],t[2]),new Vp(s[0],s[1],s[2])),e.normalized){const t=YA(BA[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new Vp,t=new Vp;for(let n=0,r=s.length;n<r;n++){const r=s[n];if(void 0!==r.POSITION){const n=i.json.accessors[r.POSITION],s=n.min,a=n.max;if(void 0!==s&&void 0!==a){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(a[2]))),n.normalized){const e=YA(BA[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const a=new hf;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=a}(e,t,i),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,i){let n=!1,r=!1,s=!1;for(let c=0,h=t.length;c<h;c++){const e=t[c];if(void 0!==e.POSITION&&(n=!0),void 0!==e.NORMAL&&(r=!0),void 0!==e.COLOR_0&&(s=!0),n&&r&&s)break}if(!n&&!r&&!s)return Promise.resolve(e);const a=[],o=[],l=[];for(let c=0,h=t.length;c<h;c++){const h=t[c];if(n){const t=void 0!==h.POSITION?i.getDependency("accessor",h.POSITION):e.attributes.position;a.push(t)}if(r){const t=void 0!==h.NORMAL?i.getDependency("accessor",h.NORMAL):e.attributes.normal;o.push(t)}if(s){const t=void 0!==h.COLOR_0?i.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then((function(t){const i=t[0],a=t[1],o=t[2];return n&&(e.morphAttributes.position=i),r&&(e.morphAttributes.normal=a),s&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,i):e}))}class $A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0,this.workerCreator=null}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:t,msg:i,transfer:n}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(i,n)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((i=>{const n=this._getIdleWorker();-1!==n?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=i,this.workers[n].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const ex=2,tx=0,ix=1,nx=10,rx=9,sx=15,ax=16,ox=22,lx=37,cx=43,hx=76,dx=83,ux=97,px=100,fx=103,mx=109,gx=165,vx=166,yx=1000066e3;class bx{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Ax{constructor(e,t,i,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const i=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,n)}}new Uint8Array([0]);const xx=[171,75,84,88,32,50,48,187,13,10,26,10];function wx(e){return(new TextDecoder).decode(e)}let Sx,_x,Ex;const Cx={env:{emscripten_notify_memory_growth:function(e){Ex=new Uint8Array(_x.exports.memory.buffer)}}};class Mx{init(){return Sx||(Sx="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Tx).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,Cx))).then(this._init):WebAssembly.instantiate(Buffer.from(Tx,"base64"),Cx).then(this._init),Sx)}_init(e){_x=e.instance,Cx.env.emscripten_notify_memory_growth(0)}decode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!_x)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,n=_x.exports.malloc(i);Ex.set(e,n),t=t||Number(_x.exports.ZSTD_findDecompressedSize(n,i));const r=_x.exports.malloc(t),s=_x.exports.ZSTD_decompress(r,t,n,i),a=Ex.slice(r,r+s);return _x.exports.free(n),_x.exports.free(r),a}}const Tx="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",Ix="display-p3",Px="display-p3-linear",Dx=new WeakMap;let Rx,Bx=0;class Lx extends Yv{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new $A,this.workerSourceURL="",this.workerConfig=null,"undefined"!==typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new Zv(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new Zv(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const n=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,n]).then((e=>{let[t,i]=e;const n=Lx.BasisWorker.toString(),r=["/* constants */","let _EngineFormat = "+JSON.stringify(Lx.EngineFormat),"let _EngineType = "+JSON.stringify(Lx.EngineType),"let _TranscoderFormat = "+JSON.stringify(Lx.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Lx.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r])),this.transcoderBinary=i,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),Bx>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Bx++}return this.transcoderPending}load(e,t,i,n){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new Zv(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{this.parse(e,t,n)}),i,n)}parse(e,t,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(Dx.has(e)){return Dx.get(e).promise.then(t).catch(i)}this._createTexture(e).then((e=>t?t(e):null)).catch(i)}_createTextureFrom(e,t){const{type:i,error:n,data:{faces:r,width:s,height:a,format:o,type:l,dfdFlags:c}}=e;if("error"===i)return Promise.reject(n);let h;if(6===t.faceCount)h=new yv(r,o,l);else{const e=r[0].mipmaps;h=t.layerCount>1?new vv(e,s,a,t.layerCount,o,l):new gv(e,s,a,o,l)}return h.minFilter=1===r[0].mipmaps.length?Cd:Td,h.magFilter=Cd,h.generateMipmaps=!1,h.needsUpdate=!0,h.colorSpace=Fx(t),h.premultiplyAlpha=!!(1&c),h}async _createTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,xx.length);if(t[0]!==xx[0]||t[1]!==xx[1]||t[2]!==xx[2]||t[3]!==xx[3]||t[4]!==xx[4]||t[5]!==xx[5]||t[6]!==xx[6]||t[7]!==xx[7]||t[8]!==xx[8]||t[9]!==xx[9]||t[10]!==xx[10]||t[11]!==xx[11])throw new Error("Missing KTX 2.0 identifier.");const i=new bx,n=17*Uint32Array.BYTES_PER_ELEMENT,r=new Ax(e,xx.length,n,!0);i.vkFormat=r._nextUint32(),i.typeSize=r._nextUint32(),i.pixelWidth=r._nextUint32(),i.pixelHeight=r._nextUint32(),i.pixelDepth=r._nextUint32(),i.layerCount=r._nextUint32(),i.faceCount=r._nextUint32();const s=r._nextUint32();i.supercompressionScheme=r._nextUint32();const a=r._nextUint32(),o=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),h=r._nextUint64(),d=r._nextUint64(),u=new Ax(e,xx.length+n,3*s*8,!0);for(let B=0;B<s;B++)i.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});const p=new Ax(e,a,o,!0),f={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},m=(f.descriptorBlockSize/4-6)/4;for(let B=0;B<m;B++){const e={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=p._nextInt32(),e.sampleUpper=p._nextInt32()):(e.sampleLower=p._nextUint32(),e.sampleUpper=p._nextUint32()),f.samples[B]=e}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(f);const g=new Ax(e,l,c,!0);for(;g._offset<c;){const e=g._nextUint32(),t=g._scan(e),n=wx(t);if(i.keyValue[n]=g._nextUint8Array(e-t.byteLength-1),n.match(/^ktx/i)){const e=wx(i.keyValue[n]);i.keyValue[n]=e.substring(0,e.lastIndexOf("\0"))}g._skip(e%4?4-e%4:0)}if(d<=0)return i;const v=new Ax(e,h,d,!0),y=v._nextUint16(),b=v._nextUint16(),A=v._nextUint32(),x=v._nextUint32(),w=v._nextUint32(),S=v._nextUint32(),_=[];for(let B=0;B<s;B++)_.push({imageFlags:v._nextUint32(),rgbSliceByteOffset:v._nextUint32(),rgbSliceByteLength:v._nextUint32(),alphaSliceByteOffset:v._nextUint32(),alphaSliceByteLength:v._nextUint32()});const E=h+v._offset,C=E+A,M=C+x,T=M+w,I=new Uint8Array(e.buffer,e.byteOffset+E,A),P=new Uint8Array(e.buffer,e.byteOffset+C,x),D=new Uint8Array(e.buffer,e.byteOffset+M,w),R=new Uint8Array(e.buffer,e.byteOffset+T,S);return i.globalData={endpointCount:y,selectorCount:b,imageDescs:_,endpointsData:I,selectorsData:P,tablesData:D,extendedData:R},i}(new Uint8Array(e)),n=i.vkFormat===yx&&167===i.dataFormatDescriptor[0].colorModel;if(!(0===i.vkFormat||n&&!this.workerConfig.astcHDRSupported))return async function(e){const{vkFormat:t}=e;if(void 0===Nx[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let i;2===e.supercompressionScheme&&(Rx||(Rx=new Promise((async e=>{const t=new Mx;await t.init(),e(t)}))),i=await Rx);const n=[];for(let s=0;s<e.levels.length;s++){const r=Math.max(1,e.pixelWidth>>s),a=Math.max(1,e.pixelHeight>>s),o=e.pixelDepth?Math.max(1,e.pixelDepth>>s):0,l=e.levels[s];let c,h;if(0===e.supercompressionScheme)c=l.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");c=i.decode(l.levelData,l.uncompressedByteLength)}h=kx[t]===Od?new Float32Array(c.buffer,c.byteOffset,c.byteLength/Float32Array.BYTES_PER_ELEMENT):kx[t]===Nd?new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT):c,n.push({data:h,width:r,height:a,depth:o})}let r;if(Ox.has(Nx[t]))r=0===e.pixelDepth?new Tg(n[0].data,e.pixelWidth,e.pixelHeight):new zp(n[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new gv(n,e.pixelWidth,e.pixelHeight),r.minFilter=1===n.length?Cd:Td,r.magFilter=Cd}return r.mipmaps=n,r.type=kx[t],r.format=Nx[t],r.colorSpace=Fx(e),r.needsUpdate=!0,Promise.resolve(r)}(i);const r=t,s=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:r},[e]))).then((e=>this._createTextureFrom(e.data,i)));return Dx.set(e,{promise:s}),s}dispose(){this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Bx--}}Lx.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},Lx.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},Lx.EngineFormat={RGBAFormat:Gd,RGBA_ASTC_4x4_Format:lu,RGB_BPTC_UNSIGNED_Format:_u,RGBA_BPTC_Format:wu,RGBA_ETC2_EAC_Format:ou,RGBA_PVRTC_4BPPV1_Format:nu,RGBA_S3TC_DXT5_Format:eu,RGB_ETC1_Format:su,RGB_ETC2_Format:au,RGB_PVRTC_4BPPV1_Format:tu,RGBA_S3TC_DXT1_Format:Zd},Lx.EngineType={UnsignedByteType:Id,HalfFloatType:Nd,FloatType:Od},Lx.BasisWorker=function(){let e,t,i;const n=_EngineFormat,r=_EngineType,s=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",(function(n){const s=n.data;switch(s.type){case"init":e=s.config,o=s.transcoderBinary,t=new Promise((e=>{i={wasmBinary:o,onRuntimeInitialized:e},BASIS(i)})).then((()=>{i.initializeBasis(),void 0===i.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{faces:t,buffers:n,width:o,height:d,hasAlpha:u,format:p,type:f,dfdFlags:m}=function(t){const n=new i.KTX2File(new Uint8Array(t));function s(){n.close(),n.delete()}if(!n.isValid())throw s(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");let o;if(n.isUASTC())o=a.UASTC;else if(n.isETC1S())o=a.ETC1S;else{if(!n.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");o=a.UASTC_HDR}const d=n.getWidth(),u=n.getHeight(),p=n.getLayers()||1,f=n.getLevels(),m=n.getFaces(),g=n.getHasAlpha(),v=n.getDFDFlags(),{transcoderFormat:y,engineFormat:b,engineType:A}=function(t,i,n,r){const s=l[t];for(let a=0;a<s.length;a++){const o=s[a];if(o.if&&!e[o.if])continue;if(!o.basisFormat.includes(t))continue;if(r&&o.transcoderFormat.length<2)continue;if(o.needsPowerOfTwo&&(!c(i)||!c(n)))continue;return{transcoderFormat:o.transcoderFormat[r?1:0],engineFormat:o.engineFormat[r?1:0],engineType:o.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(o,d,u,g);if(!d||!u||!f)throw s(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!n.startTranscoding())throw s(),new Error("THREE.KTX2Loader: .startTranscoding failed");const x=[],w=[];for(let e=0;e<m;e++){const t=[];for(let i=0;i<f;i++){const a=[];let o,l;for(let t=0;t<p;t++){const c=n.getImageLevelInfo(i,t,e);0!==e||0!==i||0!==t||c.origWidth%4===0&&c.origHeight%4===0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),f>1?(o=c.origWidth,l=c.origHeight):(o=c.width,l=c.height);let h=new Uint8Array(n.getImageTranscodedSizeInBytes(i,t,0,y));const d=n.transcodeImage(h,i,t,e,y,0,-1,-1);if(A===r.HalfFloatType&&(h=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!d)throw s(),new Error("THREE.KTX2Loader: .transcodeImage failed.");a.push(h)}const c=h(a);t.push({data:c,width:o,height:l}),w.push(c.buffer)}x.push({mipmaps:t,width:d,height:u,format:b,type:A})}return s(),{faces:x,buffers:w,width:d,height:u,hasAlpha:g,dfdFlags:v,format:b,type:A}}(s.buffer);self.postMessage({type:"transcode",id:s.id,data:{faces:t,width:o,height:d,hasAlpha:u,format:p,type:f,dfdFlags:m}},n)}catch(t){console.error(t),self.postMessage({type:"error",id:s.id,error:t.message})}}))}var o}));const o=[{if:"astcSupported",basisFormat:[a.UASTC],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],engineType:[r.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],engineType:[r.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[s.BC1,s.BC3],engineFormat:[n.RGBA_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],engineType:[r.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],engineType:[r.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[s.ETC1],engineFormat:[n.RGB_ETC1_Format],engineType:[r.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],engineType:[r.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[a.UASTC_HDR],transcoderFormat:[s.BC6H],engineFormat:[n.RGB_BPTC_UNSIGNED_Format],engineType:[r.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[s.RGBA32,s.RGBA32],engineFormat:[n.RGBAFormat,n.RGBAFormat],engineType:[r.UnsignedByteType,r.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[a.UASTC_HDR],transcoderFormat:[s.RGBA_HALF],engineFormat:[n.RGBAFormat],engineType:[r.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],l={[a.ETC1S]:o.filter((e=>e.basisFormat.includes(a.ETC1S))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[a.UASTC]:o.filter((e=>e.basisFormat.includes(a.UASTC))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[a.UASTC_HDR]:o.filter((e=>e.basisFormat.includes(a.UASTC_HDR))).sort(((e,t)=>e.priorityHDR-t.priorityHDR))};function c(e){return e<=2||0===(e&e-1)&&0!==e}function h(e){if(1===e.length)return e[0];let t=0;for(let r=0;r<e.length;r++){t+=e[r].byteLength}const i=new Uint8Array(t);let n=0;for(let r=0;r<e.length;r++){const t=e[r];i.set(t,n),n+=t.byteLength}return i}};const Ox=new Set([Gd,Xd,Qd]),Nx={[mx]:Gd,[ux]:Gd,[lx]:Gd,[cx]:Gd,[fx]:Xd,[dx]:Xd,[ax]:Xd,[ox]:Xd,[px]:Qd,[hx]:Qd,[sx]:Qd,[rx]:Qd,[yx]:lu,[vx]:uu,[gx]:uu},kx={[mx]:Od,[ux]:Nd,[lx]:Id,[cx]:Id,[fx]:Od,[dx]:Nd,[ax]:Id,[ox]:Id,[px]:Od,[hx]:Nd,[sx]:Id,[rx]:Id,[yx]:Nd,[vx]:Id,[gx]:Id};function Fx(e){const t=e.dataFormatDescriptor[0];return t.colorPrimaries===ix?t.transferFunction===ex?zu:ju:t.colorPrimaries===nx?t.transferFunction===ex?Ix:Px:(t.colorPrimaries===tx||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),Uu)}var Ux,zx;const jx=Symbol("retainerCount"),Vx=Symbol("recentlyUsed"),Gx=Symbol("evict"),Hx=Symbol("evictionThreshold"),Wx=Symbol("cache");class Qx{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;this[Ux]=new Map,this[zx]=[],this[Wx]=e,this[Hx]=t}set evictionThreshold(e){this[Hx]=e,this[Gx]()}get evictionThreshold(){return this[Hx]}get cache(){return this[Wx]}retainerCount(e){return this[jx].get(e)||0}reset(){this[jx].clear(),this[Vx]=[]}retain(e){this[jx].has(e)||this[jx].set(e,0),this[jx].set(e,this[jx].get(e)+1);const t=this[Vx].indexOf(e);-1!==t&&this[Vx].splice(t,1),this[Vx].unshift(e),this[Gx]()}release(e){this[jx].has(e)&&this[jx].set(e,Math.max(this[jx].get(e)-1,0)),this[Gx]()}[(Ux=jx,zx=Vx,Gx)](){if(!(this[Vx].length<this[Hx]))for(let e=this[Vx].length-1;e>=this[Hx];--e){const t=this[Vx][e];0===this[jx].get(t)&&(this[Wx].delete(t),this[Vx].splice(e,1))}}}const qx=e=>{const t=new Map;for(const i of e.mappings)for(const e of i.variants)t.set(e,{material:null,gltfMaterialIndex:i.material});return t};class Xx{constructor(e){this.parser=e,this.name="KHR_materials_variants"}afterRoot(e){const t=this.parser,i=t.json;if(void 0===i.extensions||void 0===i.extensions[this.name])return null;const n=(e=>{const t=[],i=new Set;for(const n of e){let e=n,r=0;for(;i.has(e);)e=n+"."+ ++r;i.add(e),t.push(e)}return t})((i.extensions[this.name].variants||[]).map((e=>e.name)));for(const r of e.scenes)r.traverse((e=>{const n=e;if(!n.material)return;const r=t.associations.get(n);if(null==r||null==r.meshes||null==r.primitives)return;const s=i.meshes[r.meshes].primitives[r.primitives].extensions;s&&s[this.name]&&(n.userData.variantMaterials=qx(s[this.name]))}));return e.userData.variants=n,Promise.resolve()}}var Yx,Kx;Op.DEFAULT_ANISOTROPY=4;const Jx=new Map,Zx=new Map;let $x;const ew=new class extends Yv{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){const r=new Zv(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{this.parse(e,t,n)}),i,n)}parse(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};this.decodeDracoFile(e,t,null,null,zu,i).catch(i)}decodeDracoFile(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ju,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>{};const a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(e,a).then(t).catch(s)}decodeGeometry(e,t){const i=JSON.stringify(t);if(Zb.has(e)){const t=Zb.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const r=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(r,s).then((i=>(n=i,new Promise(((i,s)=>{n._callbacks[r]={resolve:i,reject:s},n.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return a.catch((()=>!0)).then((()=>{n&&r&&this._releaseTask(n,r)})),Zb.set(e,{key:i,promise:a}),a}_createGeometry(e){const t=new Om;e.index&&t.setIndex(new _m(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i],r=n.name,s=n.array,a=n.itemSize,o=new _m(s,a);"color"===r&&(this._assignVertexColorSpace(o,n.vertexColorSpace),o.normalized=s instanceof Float32Array===!1),t.setAttribute(r,o)}return t}_assignVertexColorSpace(e,t){if(t!==zu)return;const i=new dm;for(let n=0,r=e.count;n<r;n++)i.fromBufferAttribute(e,n),Cp.toWorkingColorSpace(i,zu),e.setXYZ(n,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new Zv(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise(((t,n)=>{i.load(e,t,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!==typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const i=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const n=$b.toString(),r=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const i=t.data;switch(i.type){case"decode":e._callbacks[i.id].resolve(i);break;case"error":e._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};let tw;const iw=new Lx;let nw,rw;const sw=Symbol("loader"),aw=Symbol("evictionPolicy"),ow=Symbol("GLTFInstance");class lw extends np{static setDRACODecoderLocation(e){$x=e,ew.setDecoderPath(e)}static getDRACODecoderLocation(){return $x}static setKTX2TranscoderLocation(e){tw=e,iw.setTranscoderPath(e)}static getKTX2TranscoderLocation(){return tw}static setMeshoptDecoderLocation(e){var t;nw!==e&&(nw=e,rw=(t=e,new Promise(((e,i)=>{const n=document.createElement("script");document.body.appendChild(n),n.onload=e,n.onerror=i,n.async=!0,n.src=t}))).then((()=>Jb.ready)).then((()=>Jb)))}static getMeshoptDecoderLocation(){return nw}static initializeKTX2Loader(e){iw.detectSupport(e)}static get cache(){return Jx}static clearCache(){Jx.forEach(((e,t)=>{this.delete(t)})),this[aw].reset()}static has(e){return Jx.has(e)}static async delete(e){if(!this.has(e))return;const t=Jx.get(e);Zx.delete(e),Jx.delete(e);(await t).dispose()}static hasFinishedLoading(e){return!!Zx.get(e)}constructor(e){super(),this[Kx]=(new tA).register((e=>new Xx(e))),this[ow]=e,this[sw].setDRACOLoader(ew),this[sw].setKTX2Loader(iw)}get[(Yx=aw,Kx=sw,aw)](){return this.constructor[aw]}async preload(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};if(this[sw].setWithCredentials(t.withCredentials),this.dispatchEvent({type:"preload",element:t,src:e}),!Jx.has(e)){null!=rw&&this[sw].setMeshoptDecoder(await rw);const t=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const n=e=>{const t=e.loaded/e.total;i(Math.max(0,Math.min(1,isFinite(t)?t:1)))};return new Promise(((i,r)=>{t.load(e,i,n,r)}))}(e,this[sw],(e=>{i(.8*e)})),n=this[ow],r=t.then((e=>n.prepare(e))).then((e=>(i(.9),new n(e)))).catch((e=>(console.error(e),new n)));Jx.set(e,r)}await Jx.get(e),Zx.set(e,!0),i&&i(1)}async load(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};await this.preload(e,t,i);const n=await Jx.get(e),r=await n.clone();return this[aw].retain(e),r.dispose=()=>{this[aw].release(e)},r}}lw[Yx]=new Qx(lw);class cw extends Qf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createElement("div");super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new mp(.5,.5),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&null!==e.element.parentNode&&e.element.remove()}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const hw=new Vp,dw=new bf,uw=new bf,pw=new Vp,fw=new Vp;class mw{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this;let i,n,r,s;const a={objects:new WeakMap},o=void 0!==e.element?e.element:document.createElement("div");function l(e){e.isCSS2DObject&&(e.element.style.display="none");for(let t=0,i=e.children.length;t<i;t++)l(e.children[t])}function c(e,i,n){if(!1!==e.visible){if(e.isCSS2DObject){hw.setFromMatrixPosition(e.matrixWorld),hw.applyMatrix4(uw);const l=hw.z>=-1&&hw.z<=1&&!0===e.layers.test(n.layers),c=e.element;c.style.display=!0===l?"":"none",!0===l&&(e.onBeforeRender(t,i,n),c.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(hw.x*r+r)+"px,"+(-hw.y*s+s)+"px)",c.parentNode!==o&&o.appendChild(c),e.onAfterRender(t,i,n));const d={distanceToCameraSquared:h(n,e)};a.objects.set(e,d)}for(let t=0,r=e.children.length;t<r;t++)c(e.children[t],i,n)}else l(e)}function h(e,t){return pw.setFromMatrixPosition(e.matrixWorld),fw.setFromMatrixPosition(t.matrixWorld),pw.distanceToSquared(fw)}o.style.overflow="hidden",this.domElement=o,this.getSize=function(){return{width:i,height:n}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),dw.copy(t.matrixWorldInverse),uw.multiplyMatrices(t.projectionMatrix,dw),c(e,e,t),function(e){const t=function(e){const t=[];return e.traverseVisible((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return a.objects.get(e).distanceToCameraSquared-a.objects.get(t).distanceToCameraSquared})),i=t.length;for(let n=0,r=t.length;n<r;n++)t[n].element.style.zIndex=i-n}(e)},this.setSize=function(e,t){i=e,n=t,r=i/2,s=n/2,o.style.width=e+"px",o.style.height=t+"px"}}}function gw(e,t,i){let n=i;const r=new Vp;return e.updateWorldMatrix(!0,!0),e.traverseVisible((e=>{const{geometry:i}=e;if(void 0!==i){const{position:s}=i.attributes;if(void 0!==s)for(let i=0,a=s.count;i<a;i++)e.isMesh?e.getVertexPosition(i,r):r.fromBufferAttribute(s,i),e.isSkinnedMesh||r.applyMatrix4(e.matrixWorld),n=t(n,r)}})),n}const vw={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class yw{constructor(){this.textureUtils=null,this.pluginCallbacks=[],this.register((function(e){return new Jw(e)})),this.register((function(e){return new Zw(e)})),this.register((function(e){return new iS(e)})),this.register((function(e){return new nS(e)})),this.register((function(e){return new rS(e)})),this.register((function(e){return new sS(e)})),this.register((function(e){return new $w(e)})),this.register((function(e){return new eS(e)})),this.register((function(e){return new tS(e)})),this.register((function(e){return new aS(e)})),this.register((function(e){return new oS(e)})),this.register((function(e){return new lS(e)})),this.register((function(e){return new cS(e)})),this.register((function(e){return new hS(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}setTextureUtils(e){return this.textureUtils=e,this}parse(e,t,i,n){const r=new Kw,s=[];for(let a=0,o=this.pluginCallbacks.length;a<o;a++)s.push(this.pluginCallbacks[a](r));r.setPlugins(s),r.setTextureUtils(this.textureUtils),r.writeAsync(e,t,n).catch(i)}parseAsync(e,t){const i=this;return new Promise((function(n,r){i.parse(e,n,r,t)}))}}const bw=0,Aw=1,xw=2,ww=3,Sw=4,_w=5120,Ew=5121,Cw=5122,Mw=5123,Tw=5124,Iw=5125,Pw=5126,Dw=34962,Rw=34963,Bw=9728,Lw=9729,Ow=9984,Nw=9985,kw=9986,Fw=9987,Uw=33071,zw=33648,jw=10497,Vw="KHR_mesh_quantization",Gw={};Gw[1003]=Bw,Gw[1004]=Ow,Gw[1005]=kw,Gw[1006]=Lw,Gw[1007]=Nw,Gw[1008]=Fw,Gw[1001]=Uw,Gw[1e3]=jw,Gw[1002]=zw;const Hw={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Ww=new dm;function Qw(e,t){return e.length===t.length&&e.every((function(e,i){return e===t[i]}))}function qw(e){return 4*Math.ceil(e/4)}function Xw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=qw(e.byteLength);if(i!==e.byteLength){const n=new Uint8Array(i);if(n.set(new Uint8Array(e)),0!==t)for(let r=e.byteLength;r<i;r++)n[r]=t;return n.buffer}return e}function Yw(){return"undefined"===typeof document&&"undefined"!==typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}class Kw{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+Sh}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.textureUtils=null}setPlugins(e){this.plugins=e}setTextureUtils(e){this.textureUtils=e}async writeAsync(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),await this.processInputAsync(e),await Promise.all(this.pending);const n=this,r=n.buffers,s=n.json;i=n.options;const a=n.extensionsUsed,o=n.extensionsRequired,l=new Blob(r,{type:"application/octet-stream"}),c=Object.keys(a),h=Object.keys(o);if(c.length>0&&(s.extensionsUsed=c),h.length>0&&(s.extensionsRequired=h),s.buffers&&s.buffers.length>0&&(s.buffers[0].byteLength=l.size),!0===i.binary){const e=new FileReader;e.readAsArrayBuffer(l),e.onloadend=function(){const i=Xw(e.result),n=new DataView(new ArrayBuffer(8));n.setUint32(0,i.byteLength,!0),n.setUint32(4,5130562,!0);const r=Xw((a=JSON.stringify(s),(new TextEncoder).encode(a).buffer),32);var a;const o=new DataView(new ArrayBuffer(8));o.setUint32(0,r.byteLength,!0),o.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),c=new DataView(l);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0);const h=12+o.byteLength+r.byteLength+n.byteLength+i.byteLength;c.setUint32(8,h,!0);const d=new Blob([l,o,r,n,i],{type:"application/octet-stream"}),u=new FileReader;u.readAsArrayBuffer(d),u.onloadend=function(){t(u.result)}}}else if(s.buffers&&s.buffers.length>0){const e=new FileReader;e.readAsDataURL(l),e.onloadend=function(){const i=e.result;s.buffers[0].uri=i,t(s)}}else t(s)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const i=this.options,n=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&r.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in r.gltfExtensions)t.extensions[e]=r.gltfExtensions[e],n[e]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new Vp;for(let i=0,n=e.count;i<n;i++)if(Math.abs(t.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),n=new Vp;for(let r=0,s=i.count;r<s;r++)n.fromBufferAttribute(i,r),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),i.setXYZ(r,n.x,n.y,n.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const n={};0===t.offset.x&&0===t.offset.y||(n.offset=t.offset.toArray(),i=!0),0!==t.rotation&&(n.rotation=t.rotation,i=!0),1===t.repeat.x&&1===t.repeat.y||(n.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}async buildMetalRoughTextureAsync(e,t){if(e===t)return e;function i(e){return e.colorSpace===zu?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}e instanceof gv&&(e=await this.decompressTextureAsync(e)),t instanceof gv&&(t=await this.decompressTextureAsync(t));const n=e?e.image:null,r=t?t.image:null,s=Math.max(n?n.width:0,r?r.width:0),a=Math.max(n?n.height:0,r?r.height:0),o=Yw();o.width=s,o.height=a;const l=o.getContext("2d",{willReadFrequently:!0});l.fillStyle="#00ffff",l.fillRect(0,0,s,a);const c=l.getImageData(0,0,s,a);if(n){l.drawImage(n,0,0,s,a);const t=i(e),r=l.getImageData(0,0,s,a).data;for(let e=2;e<r.length;e+=4)c.data[e]=256*t(r[e]/256)}if(r){l.drawImage(r,0,0,s,a);const e=i(t),n=l.getImageData(0,0,s,a).data;for(let t=1;t<n.length;t+=4)c.data[t]=256*e(n[t]/256)}l.putImageData(c,0,0);const h=(e||t).clone();return h.source=new Rp(o),h.colorSpace=Uu,h.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),h}async decompressTextureAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;if(null===this.textureUtils)throw new Error("THREE.GLTFExporter: setTextureUtils() must be called to process compressed textures.");return await this.textureUtils.decompress(e,t)}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,n,r){const s=this.json;let a;switch(s.bufferViews||(s.bufferViews=[]),t){case _w:case Ew:a=1;break;case Cw:case Mw:a=2;break;default:a=4}let o=e.itemSize*a;r===Dw&&(o=4*Math.ceil(o/4));const l=qw(n*o),c=new DataView(new ArrayBuffer(l));let h=0;for(let u=i;u<i+n;u++){for(let i=0;i<e.itemSize;i++){let n;e.itemSize>4?n=e.array[u*e.itemSize+i]:(0===i?n=e.getX(u):1===i?n=e.getY(u):2===i?n=e.getZ(u):3===i&&(n=e.getW(u)),!0===e.normalized&&(n=fp.normalize(n,e.array))),t===Pw?c.setFloat32(h,n,!0):t===Tw?c.setInt32(h,n,!0):t===Iw?c.setUint32(h,n,!0):t===Cw?c.setInt16(h,n,!0):t===Mw?c.setUint16(h,n,!0):t===_w?c.setInt8(h,n):t===Ew&&c.setUint8(h,n),h+=a}h%o!==0&&(h+=o-h%o)}const d={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};void 0!==r&&(d.target=r),r===Dw&&(d.byteStride=o),this.byteOffset+=l,s.bufferViews.push(d);return{id:s.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise((function(n){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const e=Xw(r.result),s={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,n(i.bufferViews.push(s)-1)}}))}processAccessor(e,t,i,n){const r=this.json;let s;if(e.array.constructor===Float32Array)s=Pw;else if(e.array.constructor===Int32Array)s=Tw;else if(e.array.constructor===Uint32Array)s=Iw;else if(e.array.constructor===Int16Array)s=Cw;else if(e.array.constructor===Uint16Array)s=Mw;else if(e.array.constructor===Int8Array)s=_w;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);s=Ew}if(void 0===i&&(i=0),void 0!==n&&n!==1/0||(n=e.count),0===n)return null;const a=function(e,t,i){const n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=t;r<t+i;r++)for(let t=0;t<e.itemSize;t++){let i;e.itemSize>4?i=e.array[r*e.itemSize+t]:(0===t?i=e.getX(r):1===t?i=e.getY(r):2===t?i=e.getZ(r):3===t&&(i=e.getW(r)),!0===e.normalized&&(i=fp.normalize(i,e.array))),n.min[t]=Math.min(n.min[t],i),n.max[t]=Math.max(n.max[t],i)}return n}(e,i,n);let o;void 0!==t&&(o=e===t.index?Rw:Dw);const l=this.processBufferView(e,s,i,n,o),c={bufferView:l.id,byteOffset:l.byteOffset,componentType:s,count:n,max:a.max,min:a.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(c)-1}processImage(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png";if(null!==e){const r=this,s=r.cache,a=r.json,o=r.options,l=r.pending;s.images.has(e)||s.images.set(e,{});const c=s.images.get(e),h=n+":flipY/"+i.toString();if(void 0!==c[h])return c[h];a.images||(a.images=[]);const d={mimeType:n},u=Yw();u.width=Math.min(e.width,o.maxTextureSize),u.height=Math.min(e.height,o.maxTextureSize);const p=u.getContext("2d",{willReadFrequently:!0});if(!0===i&&(p.translate(0,u.height),p.scale(1,-1)),void 0!==e.data){t!==Gd&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>o.maxTextureSize||e.height>o.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const i=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<i.length;t+=4)i[t+0]=e.data[t+0],i[t+1]=e.data[t+1],i[t+2]=e.data[t+2],i[t+3]=e.data[t+3];p.putImageData(new ImageData(i,e.width,e.height),0,0)}else{if(!("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");p.drawImage(e,0,0,u.width,u.height)}!0===o.binary?l.push(function(e,t){if(void 0!==e.toBlob)return new Promise((i=>e.toBlob(i,t)));let i;return"image/jpeg"===t?i=.92:"image/webp"===t&&(i=.8),e.convertToBlob({type:t,quality:i})}(u,n).then((e=>r.processBufferViewImage(e))).then((e=>{d.bufferView=e}))):d.uri=Pp.getDataURL(u,n);const f=a.images.push(d)-1;return c[h]=f,f}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:Gw[e.magFilter],minFilter:Gw[e.minFilter],wrapS:Gw[e.wrapS],wrapT:Gw[e.wrapT]};return t.samplers.push(i)-1}async processTextureAsync(e){const t=this.options,i=this.cache,n=this.json;if(i.textures.has(e))return i.textures.get(e);n.textures||(n.textures=[]),e instanceof gv&&(e=await this.decompressTextureAsync(e,t.maxTextureSize));let r=e.userData.mimeType;"image/webp"===r&&(r="image/png");const s={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,r)};e.name&&(s.name=e.name),await this._invokeAllAsync((async function(t){t.writeTexture&&await t.writeTexture(e,s)}));const a=n.textures.push(s)-1;return i.textures.set(e,a),a}async processMaterialAsync(e){const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const n={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);if(Qw(r,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=0,n.pbrMetallicRoughness.roughnessFactor=1),e.metalnessMap||e.roughnessMap){const t=await this.buildMetalRoughTextureAsync(e.metalnessMap,e.roughnessMap),i={index:await this.processTextureAsync(t),texCoord:t.channel};this.applyTextureTransform(i,t),n.pbrMetallicRoughness.metallicRoughnessTexture=i}if(e.map){const t={index:await this.processTextureAsync(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),n.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(n.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:await this.processTextureAsync(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),n.emissiveTexture=t}}if(e.normalMap){const t={index:await this.processTextureAsync(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),n.normalTexture=t}if(e.aoMap){const t={index:await this.processTextureAsync(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),n.occlusionTexture=t}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===Ih&&(n.doubleSided=!0),""!==e.name&&(n.name=e.name),this.serializeUserData(e,n),await this._invokeAllAsync((async function(t){t.writeMaterialAsync&&await t.writeMaterialAsync(e,n)}));const s=i.materials.push(n)-1;return t.materials.set(e,s),s}async processMeshAsync(e){const t=this.cache,i=this.json,n=[e.geometry.uuid];if(Array.isArray(e.material))for(let b=0,A=e.material.length;b<A;b++)n.push(e.material[b].uuid);else n.push(e.material.uuid);const r=n.join(":");if(t.meshes.has(r))return t.meshes.get(r);const s=e.geometry;let a;a=e.isLineSegments?Aw:e.isLineLoop?xw:e.isLine?ww:e.isPoints?bw:e.material.wireframe?Aw:Sw;const o={},l={},c=[],h=[],d={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},u=s.getAttribute("normal");void 0===u||this.isNormalizedNormalAttribute(u)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.setAttribute("normal",this.createNormalizedNormalAttribute(u)));let p=null;for(let b in s.attributes){if("morph"===b.slice(0,5))continue;const e=s.attributes[b];b=d[b]||b.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(b)||(b="_"+b),t.attributes.has(this.getUID(e))){l[b]=t.attributes.get(this.getUID(e));continue}p=null;const i=e.array;"JOINTS_0"!==b||i instanceof Uint16Array||i instanceof Uint8Array?(i instanceof Uint32Array||i instanceof Int32Array)&&!b.startsWith("_")&&(console.warn(`GLTFExporter: Attribute "${b}" converted to type FLOAT.`),p=yw.Utils.toFloat32BufferAttribute(e)):(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new _m(new Uint16Array(i),e.itemSize,e.normalized));const n=this.processAccessor(p||e,s);null!==n&&(b.startsWith("_")||this.detectMeshQuantization(b,e),l[b]=n,t.attributes.set(this.getUID(e),n))}if(void 0!==u&&s.setAttribute("normal",u),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const i=[],n=[],r={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)r[e.morphTargetDictionary[t]]=t;for(let a=0;a<e.morphTargetInfluences.length;++a){const o={};let l=!1;for(const e in s.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}const i=s.morphAttributes[e][a],n=e.toUpperCase(),r=s.attributes[e];if(t.attributes.has(this.getUID(i,!0))){o[n]=t.attributes.get(this.getUID(i,!0));continue}const c=i.clone();if(!s.morphTargetsRelative)for(let e=0,t=i.count;e<t;e++)for(let n=0;n<i.itemSize;n++)0===n&&c.setX(e,i.getX(e)-r.getX(e)),1===n&&c.setY(e,i.getY(e)-r.getY(e)),2===n&&c.setZ(e,i.getZ(e)-r.getZ(e)),3===n&&c.setW(e,i.getW(e)-r.getW(e));o[n]=this.processAccessor(c,s),t.attributes.set(this.getUID(r,!0),o[n])}h.push(o),i.push(e.morphTargetInfluences[a]),void 0!==e.morphTargetDictionary&&n.push(r[a])}o.weights=i,n.length>0&&(o.extras={},o.extras.targetNames=n)}const f=Array.isArray(e.material);if(f&&0===s.groups.length)return null;let m=!1;if(f&&null===s.index){const e=[];for(let t=0,i=s.attributes.position.count;t<i;t++)e[t]=t;s.setIndex(e),m=!0}const g=f?e.material:[e.material],v=f?s.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let b=0,A=v.length;b<A;b++){const e={mode:a,attributes:l};if(this.serializeUserData(s,e),h.length>0&&(e.targets=h),null!==s.index){let i=this.getUID(s.index);void 0===v[b].start&&void 0===v[b].count||(i+=":"+v[b].start+":"+v[b].count),t.attributes.has(i)?e.indices=t.attributes.get(i):(e.indices=this.processAccessor(s.index,s,v[b].start,v[b].count),t.attributes.set(i,e.indices)),null===e.indices&&delete e.indices}const i=await this.processMaterialAsync(g[v[b].materialIndex]);null!==i&&(e.material=i),c.push(e)}!0===m&&s.setIndex(null),o.primitives=c,i.meshes||(i.meshes=[]),await this._invokeAllAsync((function(t){t.writeMesh&&t.writeMesh(e,o)}));const y=i.meshes.push(o)-1;return t.meshes.set(r,y),y}detectMeshQuantization(e,t){if(this.extensionsUsed[Vw])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const n=e.split("_",1)[0];vw[n]&&vw[n].includes(i)&&(this.extensionsUsed[Vw]=!0,this.extensionsRequired[Vw]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,n={type:i?"orthographic":"perspective"};return i?n.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:fp.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){const i=this.json,n=this.nodeMap;i.animations||(i.animations=[]);const r=(e=yw.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,s=[],a=[];for(let o=0;o<r.length;++o){const e=r[o],i=Py.parseTrackName(e.name);let l=Py.findNode(t,i.nodeName);const c=Hw[i.propertyName];if("bones"===i.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(i.objectIndex):void 0),!l||!c){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',e.name);continue}const h=1;let d,u=e.values.length/e.times.length;c===Hw.morphTargetInfluences&&(u/=l.morphTargetInfluences.length),!0===e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(d="CUBICSPLINE",u/=3):d=e.getInterpolation()===Ru?"STEP":"LINEAR",a.push({input:this.processAccessor(new _m(e.times,h)),output:this.processAccessor(new _m(e.values,u)),interpolation:d}),s.push({sampler:a.length-1,target:{node:n.get(l),path:c}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:s}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,n=t.nodes[i.get(e)],r=e.skeleton;if(void 0===r)return null;const s=e.skeleton.bones[0];if(void 0===s)return null;const a=[],o=new Float32Array(16*r.bones.length),l=new bf;for(let c=0;c<r.bones.length;++c)a.push(i.get(r.bones[c])),l.copy(r.boneInverses[c]),l.multiply(e.bindMatrix).toArray(o,16*c);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new _m(o,16)),joints:a,skeleton:i.get(s)});return n.skin=t.skins.length-1}async processNodeAsync(e){const t=this.json,i=this.options,n=this.nodeMap;t.nodes||(t.nodes=[]);const r={};if(i.trs){const t=e.quaternion.toArray(),i=e.position.toArray(),n=e.scale.toArray();Qw(t,[0,0,0,1])||(r.rotation=t),Qw(i,[0,0,0])||(r.translation=i),Qw(n,[1,1,1])||(r.scale=n)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Qw(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(r.matrix=e.matrix.elements);if(""!==e.name&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const t=await this.processMeshAsync(e);null!==t&&(r.mesh=t)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let n=0,r=e.children.length;n<r;n++){const r=e.children[n];if(r.visible||!1===i.onlyVisible){const e=await this.processNodeAsync(r);null!==e&&t.push(e)}}t.length>0&&(r.children=t)}await this._invokeAllAsync((function(t){t.writeNode&&t.writeNode(e,r)}));const s=t.nodes.push(r)-1;return n.set(e,s),s}async processSceneAsync(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const n={};""!==e.name&&(n.name=e.name),t.scenes.push(n);const r=[];for(let s=0,a=e.children.length;s<a;s++){const t=e.children[s];if(t.visible||!1===i.onlyVisible){const e=await this.processNodeAsync(t);null!==e&&r.push(e)}}r.length>0&&(n.nodes=r),this.serializeUserData(e,n)}async processObjectsAsync(e){const t=new pg;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);await this.processSceneAsync(t)}async processInputAsync(e){const t=this.options;e=e instanceof Array?e:[e],await this._invokeAllAsync((function(t){t.beforeParse&&t.beforeParse(e)}));const i=[];for(let n=0;n<e.length;n++)e[n]instanceof pg?await this.processSceneAsync(e[n]):i.push(e[n]);i.length>0&&await this.processObjectsAsync(i);for(let n=0;n<this.skins.length;++n)this.processSkin(this.skins[n]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);await this._invokeAllAsync((function(t){t.afterParse&&t.afterParse(e)}))}async _invokeAllAsync(e){for(let t=0,i=this.plugins.length;t<i;t++)await e(this.plugins[t])}}class Jw{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const i=this.writer,n=i.json,r=i.extensionsUsed,s={};e.name&&(s.name=e.name),s.color=e.color.toArray(),s.intensity=e.intensity,e.isDirectionalLight?s.type="directional":e.isPointLight?(s.type="point",e.distance>0&&(s.range=e.distance)):e.isSpotLight&&(s.type="spot",e.distance>0&&(s.range=e.distance),s.spot={},s.spot.innerConeAngle=(1-e.penumbra)*e.angle,s.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},r[this.name]=!0);const a=n.extensions[this.name].lights;a.push(s),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class Zw{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}async writeMaterialAsync(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class $w{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:await i.processTextureAsync(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(t,e.clearcoatMap),r.clearcoatTexture=t}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:await i.processTextureAsync(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(t,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:await i.processTextureAsync(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};1!==e.clearcoatNormalScale.x&&(t.scale=e.clearcoatNormalScale.x),i.applyTextureTransform(t,e.clearcoatNormalMap),r.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class eS{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.dispersion)return;const i=this.writer.extensionsUsed,n={};n.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class tS{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:await i.processTextureAsync(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(t,e.iridescenceMap),r.iridescenceTexture=t}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:await i.processTextureAsync(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(t,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class iS{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const t={index:await i.processTextureAsync(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(t,e.transmissionMap),r.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class nS{constructor(e){this.writer=e,this.name="KHR_materials_volume"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const t={index:await i.processTextureAsync(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(t,e.thicknessMap),r.thicknessTexture=t}e.attenuationDistance!==1/0&&(r.attenuationDistance=e.attenuationDistance),r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class rS{constructor(e){this.writer=e,this.name="KHR_materials_ior"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const i=this.writer.extensionsUsed,n={};n.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class sS{constructor(e){this.writer=e,this.name="KHR_materials_specular"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(Ww)&&!e.specularIntensityMap&&!e.specularColorMap)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.specularIntensityMap){const t={index:await i.processTextureAsync(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(t,e.specularIntensityMap),r.specularTexture=t}if(e.specularColorMap){const t={index:await i.processTextureAsync(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(t,e.specularColorMap),r.specularColorTexture=t}r.specularFactor=e.specularIntensity,r.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class aS{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.sheenRoughnessMap){const t={index:await i.processTextureAsync(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(t,e.sheenRoughnessMap),r.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:await i.processTextureAsync(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(t,e.sheenColorMap),r.sheenColorTexture=t}r.sheenRoughnessFactor=e.sheenRoughness,r.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class oS{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.anisotropyMap){const t={index:await i.processTextureAsync(e.anisotropyMap)};i.applyTextureTransform(t,e.anisotropyMap),r.anisotropyTexture=t}r.anisotropyStrength=e.anisotropy,r.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class lS{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const i=this.writer.extensionsUsed,n={};n.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class cS{constructor(e){this.writer=e,this.name="EXT_materials_bump"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.bumpMap){const t={index:await i.processTextureAsync(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(t,e.bumpMap),r.bumpTexture=t}r.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class hS{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const i=this.writer,n=e,r=new Float32Array(3*n.count),s=new Float32Array(4*n.count),a=new Float32Array(3*n.count),o=new bf,l=new Vp,c=new jp,h=new Vp;for(let u=0;u<n.count;u++)n.getMatrixAt(u,o),o.decompose(l,c,h),l.toArray(r,3*u),c.toArray(s,4*u),h.toArray(a,3*u);const d={TRANSLATION:i.processAccessor(new _m(r,3)),ROTATION:i.processAccessor(new _m(s,4)),SCALE:i.processAccessor(new _m(a,3))};n.instanceColor&&(d._COLOR_0=i.processAccessor(n.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:d},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}}yw.Utils={insertKeyframe:function(e,t){const i=.001,n=e.getValueSize(),r=new e.TimeBufferType(e.times.length+1),s=new e.ValueBufferType(e.values.length+n),a=e.createInterpolant(new e.ValueBufferType(n));let o;if(0===e.times.length){r[0]=t;for(let e=0;e<n;e++)s[e]=0;o=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<i)return 0;r[0]=t,r.set(e.times,1),s.set(a.evaluate(t),0),s.set(e.values,n),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<i)return e.times.length-1;r[r.length-1]=t,r.set(e.times,0),s.set(e.values,0),s.set(a.evaluate(t),e.values.length),o=r.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<i)return l;if(e.times[l]<t&&e.times[l+1]>t){r.set(e.times.slice(0,l+1),0),r[l+1]=t,r.set(e.times.slice(l+1),l+2),s.set(e.values.slice(0,(l+1)*n),0),s.set(a.evaluate(t),(l+1)*n),s.set(e.values.slice((l+1)*n),(l+2)*n),o=l+1;break}}return e.times=r,e.values=s,o},mergeMorphTargetTracks:function(e,t){const i=[],n={},r=e.tracks;for(let s=0;s<r.length;++s){let e=r[s];const a=Py.parseTrackName(e.name),o=Py.findNode(t,a.nodeName);if("morphTargetInfluences"!==a.propertyName||void 0===a.propertyIndex){i.push(e);continue}if(e.createInterpolant!==e.InterpolantFactoryMethodDiscrete&&e.createInterpolant!==e.InterpolantFactoryMethodLinear){if(e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),e=e.clone(),e.setInterpolation(Bu)}const l=o.morphTargetInfluences.length,c=o.morphTargetDictionary[a.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let h;if(void 0===n[o.uuid]){h=e.clone();const t=new h.ValueBufferType(l*h.times.length);for(let e=0;e<h.times.length;e++)t[e*l+c]=h.values[e];h.name=(a.nodeName||"")+".morphTargetInfluences",h.values=t,n[o.uuid]=h,i.push(h);continue}const d=e.createInterpolant(new e.ValueBufferType(1));h=n[o.uuid];for(let t=0;t<h.times.length;t++)h.values[t*l+c]=d.evaluate(h.times[t]);for(let t=0;t<e.times.length;t++){const i=this.insertKeyframe(h,e.times[t]);h.values[i*l+c]=e.values[t]}}return e.tracks=i,e},toFloat32BufferAttribute:function(e){const t=new _m(new Float32Array(e.count*e.itemSize),e.itemSize,!1);if(!e.normalized&&!e.isInterleavedBufferAttribute)return t.array.set(e.array),t;for(let i=0,n=e.count;i<n;i++)for(let r=0;r<e.itemSize;r++)t.setComponent(i,r,e.getComponent(i,r));return t}};const dS=e=>void 0!==e.material&&e.userData&&e.userData.variantMaterials&&!!Array.from(e.userData.variantMaterials.values()).filter((e=>uS(e.material))),uS=e=>e&&e.isMaterial&&!Array.isArray(e);class pS{constructor(e){this.writer=e,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(e){const t=new Set,i=e=>{if(!dS(e))return;const i=e.userData.variantMaterials,n=e.userData.variantData;for(const[r,s]of n){const e=i.get(s.index);e&&uS(e.material)&&t.add(r)}};if(Array.isArray(e))for(const n of e)n.traverse(i);else e.traverse(i);t.forEach((e=>this.variantNames.push(e)))}async writeMesh(e,t){if(!dS(e))return;const i=e.userData,n=i.variantMaterials,r=i.variantData,s=new Map,a=new Map,o=Array.from(r.values()).sort(((e,t)=>e.index-t.index));for(const[h,d]of o.entries())a.set(d.index,h);for(const h of r.values()){const e=n.get(h.index);if(!e||!uS(e.material))continue;const t=await this.writer.processMaterialAsync(e.material);s.has(t)||s.set(t,{material:t,variants:[]}),s.get(t).variants.push(a.get(h.index))}const l=Array.from(s.values()).map((e=>e.variants.sort(((e,t)=>e-t))&&e)).sort(((e,t)=>e.material-t.material));if(0===l.length)return;const c=uS(i.originalMaterial)?await this.writer.processMaterialAsync(i.originalMaterial):-1;for(const h of t.primitives)c>=0&&(h.material=c),h.extensions=h.extensions||{},h.extensions[this.name]={mappings:l}}afterParse(){if(0===this.variantNames.length)return;const e=this.writer.json;e.extensions=e.extensions||{};const t=this.variantNames.map((e=>({name:e})));e.extensions[this.name]={variants:t},this.writer.extensionsUsed[this.name]=!0}}function fS(){let e=null,t=!1,i=null,n=null;function r(t,s){i(t,s),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function mS(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);const n=t.get(i);n&&(e.deleteBuffer(n.buffer),t.delete(i))},update:function(i,n){if(i.isInterleavedBufferAttribute&&(i=i.data),i.isGLBufferAttribute){const e=t.get(i);return void((!e||e.version<i.version)&&t.set(i,{buffer:i.buffer,type:i.type,bytesPerElement:i.elementSize,version:i.version}))}const r=t.get(i);if(void 0===r)t.set(i,function(t,i){const n=t.array,r=t.usage,s=n.byteLength,a=e.createBuffer();let o;if(e.bindBuffer(i,a),e.bufferData(i,n,r),t.onUploadCallback(),n instanceof Float32Array)o=e.FLOAT;else if(n instanceof Uint16Array)o=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(n instanceof Int16Array)o=e.SHORT;else if(n instanceof Uint32Array)o=e.UNSIGNED_INT;else if(n instanceof Int32Array)o=e.INT;else if(n instanceof Int8Array)o=e.BYTE;else if(n instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(n instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+n);o=e.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version,size:s}}(i,n));else if(r.version<i.version){if(r.size!==i.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,i,n){const r=i.array,s=i.updateRanges;if(e.bindBuffer(n,t),0===s.length)e.bufferSubData(n,0,r);else{s.sort(((e,t)=>e.start-t.start));let t=0;for(let e=1;e<s.length;e++){const i=s[t],n=s[e];n.start<=i.start+i.count+1?i.count=Math.max(i.count,n.start+n.count-i.start):(++t,s[t]=n)}s.length=t+1;for(let i=0,a=s.length;i<a;i++){const t=s[i];e.bufferSubData(n,t.start*r.BYTES_PER_ELEMENT,r,t.start,t.count)}i.clearUpdateRanges()}i.onUploadCallback()}(r.buffer,i,n),r.version=i.version}}}}const gS={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},vS={common:{diffuse:{value:new dm(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new gp},alphaMap:{value:null},alphaMapTransform:{value:new gp},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new gp}},envmap:{envMap:{value:null},envMapRotation:{value:new gp},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new gp}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new gp}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new gp},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new gp},normalScale:{value:new mp(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new gp},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new gp}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new gp}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new gp}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new dm(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new dm(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new gp},alphaTest:{value:0},uvTransform:{value:new gp}},sprite:{diffuse:{value:new dm(16777215)},opacity:{value:1},center:{value:new mp(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new gp},alphaMap:{value:null},alphaMapTransform:{value:new gp},alphaTest:{value:0}}},yS={basic:{uniforms:Jm([vS.common,vS.specularmap,vS.envmap,vS.aomap,vS.lightmap,vS.fog]),vertexShader:gS.meshbasic_vert,fragmentShader:gS.meshbasic_frag},lambert:{uniforms:Jm([vS.common,vS.specularmap,vS.envmap,vS.aomap,vS.lightmap,vS.emissivemap,vS.bumpmap,vS.normalmap,vS.displacementmap,vS.fog,vS.lights,{emissive:{value:new dm(0)}}]),vertexShader:gS.meshlambert_vert,fragmentShader:gS.meshlambert_frag},phong:{uniforms:Jm([vS.common,vS.specularmap,vS.envmap,vS.aomap,vS.lightmap,vS.emissivemap,vS.bumpmap,vS.normalmap,vS.displacementmap,vS.fog,vS.lights,{emissive:{value:new dm(0)},specular:{value:new dm(1118481)},shininess:{value:30}}]),vertexShader:gS.meshphong_vert,fragmentShader:gS.meshphong_frag},standard:{uniforms:Jm([vS.common,vS.envmap,vS.aomap,vS.lightmap,vS.emissivemap,vS.bumpmap,vS.normalmap,vS.displacementmap,vS.roughnessmap,vS.metalnessmap,vS.fog,vS.lights,{emissive:{value:new dm(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:gS.meshphysical_vert,fragmentShader:gS.meshphysical_frag},toon:{uniforms:Jm([vS.common,vS.aomap,vS.lightmap,vS.emissivemap,vS.bumpmap,vS.normalmap,vS.displacementmap,vS.gradientmap,vS.fog,vS.lights,{emissive:{value:new dm(0)}}]),vertexShader:gS.meshtoon_vert,fragmentShader:gS.meshtoon_frag},matcap:{uniforms:Jm([vS.common,vS.bumpmap,vS.normalmap,vS.displacementmap,vS.fog,{matcap:{value:null}}]),vertexShader:gS.meshmatcap_vert,fragmentShader:gS.meshmatcap_frag},points:{uniforms:Jm([vS.points,vS.fog]),vertexShader:gS.points_vert,fragmentShader:gS.points_frag},dashed:{uniforms:Jm([vS.common,vS.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:gS.linedashed_vert,fragmentShader:gS.linedashed_frag},depth:{uniforms:Jm([vS.common,vS.displacementmap]),vertexShader:gS.depth_vert,fragmentShader:gS.depth_frag},normal:{uniforms:Jm([vS.common,vS.bumpmap,vS.normalmap,vS.displacementmap,{opacity:{value:1}}]),vertexShader:gS.meshnormal_vert,fragmentShader:gS.meshnormal_frag},sprite:{uniforms:Jm([vS.sprite,vS.fog]),vertexShader:gS.sprite_vert,fragmentShader:gS.sprite_frag},background:{uniforms:{uvTransform:{value:new gp},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:gS.background_vert,fragmentShader:gS.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new gp}},vertexShader:gS.backgroundCube_vert,fragmentShader:gS.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:gS.cube_vert,fragmentShader:gS.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:gS.equirect_vert,fragmentShader:gS.equirect_frag},distanceRGBA:{uniforms:Jm([vS.common,vS.displacementmap,{referencePosition:{value:new Vp},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:gS.distanceRGBA_vert,fragmentShader:gS.distanceRGBA_frag},shadow:{uniforms:Jm([vS.lights,vS.fog,{color:{value:new dm(0)},opacity:{value:1}}]),vertexShader:gS.shadow_vert,fragmentShader:gS.shadow_frag}};yS.physical={uniforms:Jm([yS.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new gp},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new gp},clearcoatNormalScale:{value:new mp(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new gp},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new gp},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new gp},sheen:{value:0},sheenColor:{value:new dm(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new gp},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new gp},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new gp},transmissionSamplerSize:{value:new mp},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new gp},attenuationDistance:{value:0},attenuationColor:{value:new dm(0)},specularColor:{value:new dm(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new gp},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new gp},anisotropyVector:{value:new mp},anisotropyMap:{value:null},anisotropyMapTransform:{value:new gp}}]),vertexShader:gS.meshphysical_vert,fragmentShader:gS.meshphysical_frag};const bS={r:0,b:0,g:0},AS=new If,xS=new bf;function wS(e,t,i,n,r,s,a){const o=new dm(0);let l,c,h=!0===s?0:1,d=null,u=0,p=null;function f(e){let n=!0===e.isScene?e.background:null;if(n&&n.isTexture){n=(e.backgroundBlurriness>0?i:t).get(n)}return n}function m(t,i){t.getRGB(bS,Zm(e)),n.buffers.color.setClear(bS.r,bS.g,bS.b,i,a)}return{getClearColor:function(){return o},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;o.set(e),h=t,m(o,h)},getClearAlpha:function(){return h},setClearAlpha:function(e){h=e,m(o,h)},render:function(t){let i=!1;const r=f(t);null===r?m(o,h):r&&r.isColor&&(m(r,1),i=!0);const s=e.xr.getEnvironmentBlendMode();"additive"===s?n.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===s&&n.buffers.color.setClear(0,0,0,0,a),(e.autoClear||i)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,i){const n=f(i);n&&(n.isCubeTexture||n.mapping===bd)?(void 0===c&&(c=new qm(new Ym(1,1,1),new eg({name:"BackgroundCubeMaterial",uniforms:Km(yS.backgroundCube.uniforms),vertexShader:yS.backgroundCube.vertexShader,fragmentShader:yS.backgroundCube.fragmentShader,side:Th,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),AS.copy(i.backgroundRotation),AS.x*=-1,AS.y*=-1,AS.z*=-1,n.isCubeTexture&&!1===n.isRenderTargetTexture&&(AS.y*=-1,AS.z*=-1),c.material.uniforms.envMap.value=n,c.material.uniforms.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=i.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=i.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(xS.makeRotationFromEuler(AS)),c.material.toneMapped=Cp.getTransfer(n.colorSpace)!==Gu,d===n&&u===n.version&&p===e.toneMapping||(c.material.needsUpdate=!0,d=n,u=n.version,p=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):n&&n.isTexture&&(void 0===l&&(l=new qm(new xv(2,2),new eg({name:"BackgroundMaterial",uniforms:Km(yS.background.uniforms),vertexShader:yS.background.vertexShader,fragmentShader:yS.background.fragmentShader,side:Mh,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=n,l.material.uniforms.backgroundIntensity.value=i.backgroundIntensity,l.material.toneMapped=Cp.getTransfer(n.colorSpace)!==Gu,!0===n.matrixAutoUpdate&&n.updateMatrix(),l.material.uniforms.uvTransform.value.copy(n.matrix),d===n&&u===n.version&&p===e.toneMapping||(l.material.needsUpdate=!0,d=n,u=n.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function SS(e,t){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),n={},r=c(null);let s=r,a=!1;function o(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],n=[],r=[];for(let s=0;s<i;s++)t[s]=0,n[s]=0,r[s]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function h(){const e=s.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function d(e){u(e,0)}function u(t,i){const n=s.newAttributes,r=s.enabledAttributes,a=s.attributeDivisors;n[t]=1,0===r[t]&&(e.enableVertexAttribArray(t),r[t]=1),a[t]!==i&&(e.vertexAttribDivisor(t,i),a[t]=i)}function p(){const t=s.newAttributes,i=s.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function f(t,i,n,r,s,a,o){!0===o?e.vertexAttribIPointer(t,i,n,s,a):e.vertexAttribPointer(t,i,n,r,s,a)}function m(){g(),a=!0,s!==r&&(s=r,o(s.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(i,r,l,m,g){let v=!1;const y=function(t,i,r){const s=!0===r.wireframe;let a=n[t.id];void 0===a&&(a={},n[t.id]=a);let o=a[i.id];void 0===o&&(o={},a[i.id]=o);let l=o[s];void 0===l&&(l=c(e.createVertexArray()),o[s]=l);return l}(m,l,r);s!==y&&(s=y,o(s.object)),v=function(e,t,i,n){const r=s.attributes,a=t.attributes;let o=0;const l=i.getAttributes();for(const s in l){if(l[s].location>=0){const t=r[s];let i=a[s];if(void 0===i&&("instanceMatrix"===s&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===s&&e.instanceColor&&(i=e.instanceColor)),void 0===t)return!0;if(t.attribute!==i)return!0;if(i&&t.data!==i.data)return!0;o++}}return s.attributesNum!==o||s.index!==n}(i,m,l,g),v&&function(e,t,i,n){const r={},a=t.attributes;let o=0;const l=i.getAttributes();for(const s in l){if(l[s].location>=0){let t=a[s];void 0===t&&("instanceMatrix"===s&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===s&&e.instanceColor&&(t=e.instanceColor));const i={};i.attribute=t,t&&t.data&&(i.data=t.data),r[s]=i,o++}}s.attributes=r,s.attributesNum=o,s.index=n}(i,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||a)&&(a=!1,function(i,n,r,s){h();const a=s.attributes,o=r.getAttributes(),l=n.defaultAttributeValues;for(const c in o){const n=o[c];if(n.location>=0){let r=a[c];if(void 0===r&&("instanceMatrix"===c&&i.instanceMatrix&&(r=i.instanceMatrix),"instanceColor"===c&&i.instanceColor&&(r=i.instanceColor)),void 0!==r){const a=r.normalized,o=r.itemSize,l=t.get(r);if(void 0===l)continue;const c=l.buffer,h=l.type,p=l.bytesPerElement,m=h===e.INT||h===e.UNSIGNED_INT||r.gpuType===Bd;if(r.isInterleavedBufferAttribute){const t=r.data,l=t.stride,g=r.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<n.locationSize;e++)u(n.location+e,t.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<n.locationSize;e++)d(n.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<n.locationSize;e++)f(n.location+e,o/n.locationSize,h,a,l*p,(g+o/n.locationSize*e)*p,m)}else{if(r.isInstancedBufferAttribute){for(let e=0;e<n.locationSize;e++)u(n.location+e,r.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<n.locationSize;e++)d(n.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<n.locationSize;e++)f(n.location+e,o/n.locationSize,h,a,o*p,o/n.locationSize*e*p,m)}}else if(void 0!==l){const t=l[c];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(n.location,t);break;case 3:e.vertexAttrib3fv(n.location,t);break;case 4:e.vertexAttrib4fv(n.location,t);break;default:e.vertexAttrib1fv(n.location,t)}}}}p()}(i,r,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in n){const t=n[e];for(const e in t){const i=t[e];for(const e in i)l(i[e].object),delete i[e];delete t[e]}delete n[e]}},releaseStatesOfGeometry:function(e){if(void 0===n[e.id])return;const t=n[e.id];for(const i in t){const e=t[i];for(const t in e)l(e[t].object),delete e[t];delete t[i]}delete n[e.id]},releaseStatesOfProgram:function(e){for(const t in n){const i=n[t];if(void 0===i[e.id])continue;const r=i[e.id];for(const e in r)l(r[e].object),delete r[e];delete i[e.id]}},initAttributes:h,enableAttribute:d,disableUnusedAttributes:p}}function _S(e,t,i){let n;function r(t,r,s){0!==s&&(e.drawArraysInstanced(n,t,r,s),i.update(r,n,s))}this.setMode=function(e){n=e},this.render=function(t,r){e.drawArrays(n,t,r),i.update(r,n,1)},this.renderInstances=r,this.renderMultiDraw=function(e,r,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,e,0,r,0,s);let a=0;for(let t=0;t<s;t++)a+=r[t];i.update(a,n,1)},this.renderMultiDrawInstances=function(e,s,a,o){if(0===a)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)r(e[t],s[t],o[t]);else{l.multiDrawArraysInstancedWEBGL(n,e,0,s,0,o,0,a);let t=0;for(let e=0;e<a;e++)t+=s[e]*o[e];i.update(t,n,1)}}}function ES(e,t,i,n){let r;function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a=void 0!==i.precision?i.precision:"highp";const o=s(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=!0===i.logarithmicDepthBuffer,c=!0===i.reverseDepthBuffer&&t.has("EXT_clip_control"),h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const i=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:s,textureFormatReadable:function(t){return t===Gd||n.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(i){const r=i===Nd&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(i!==Id&&n.convert(i)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&i!==Od&&!r)},precision:a,logarithmicDepthBuffer:l,reverseDepthBuffer:c,maxTextures:h,maxVertexTextures:d,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:d>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function CS(e){const t=this;let i=null,n=0,r=!1,s=!1;const a=new Hg,o=new gp,l={value:null,needsUpdate:!1};function c(e,i,n,r){const s=null!==e?e.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const t=n+4*s,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let i=0,l=n;i!==s;++i,l+=4)a.copy(e[i]).applyMatrix4(r,o),a.normal.toArray(c,l),c[l+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const i=0!==e.length||t||0!==n||r;return r=t,n=e.length,i},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){i=c(e,t,0)},this.setState=function(a,o,h){const d=a.clippingPlanes,u=a.clipIntersection,p=a.clipShadows,f=e.get(a);if(!r||null===d||0===d.length||s&&!p)s?c(null):function(){l.value!==i&&(l.value=i,l.needsUpdate=n>0);t.numPlanes=n,t.numIntersection=0}();else{const e=s?0:n,t=4*e;let r=f.clippingState||null;l.value=r,r=c(d,o,t,h);for(let n=0;n!==t;++n)r[n]=i[n];f.clippingState=r,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=e}}}function MS(e){let t=new WeakMap;function i(e,t){return t===vd?e.mapping=md:t===yd&&(e.mapping=gd),e}function n(e){const i=e.target;i.removeEventListener("dispose",n);const r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===vd||s===yd){if(t.has(r)){return i(t.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=new cg(s.height);return a.fromEquirectangularTexture(e,r),t.set(r,a),r.addEventListener("dispose",n),i(a.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}const TS=[.125,.215,.35,.446,.526,.582],IS=20,PS=new my,DS=new dm;let RS=null,BS=0,LS=0,OS=!1;const NS=(1+Math.sqrt(5))/2,kS=1/NS,FS=[new Vp(-NS,kS,0),new Vp(NS,kS,0),new Vp(-kS,0,NS),new Vp(kS,0,NS),new Vp(0,NS,-kS),new Vp(0,NS,kS),new Vp(-1,1,-1),new Vp(1,1,-1),new Vp(-1,1,1),new Vp(1,1,1)],US=new Vp;class zS{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{size:s=256,position:a=US}=r;RS=this._renderer.getRenderTarget(),BS=this._renderer.getActiveCubeFace(),LS=this._renderer.getActiveMipmapLevel(),OS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(s);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,i,n,o,a),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=HS(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=GS(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(RS,BS,LS),this._renderer.xr.enabled=OS,e.scissorTest=!1,VS(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===md||e.mapping===gd?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),RS=this._renderer.getRenderTarget(),BS=this._renderer.getActiveCubeFace(),LS=this._renderer.getActiveMipmapLevel(),OS=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Cd,minFilter:Cd,generateMipmaps:!1,type:Nd,format:Gd,colorSpace:ju,depthBuffer:!1},n=jS(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=jS(e,t,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],i=[],n=[];let r=e;const s=e-4+1+TS.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);i.push(s);let o=1/s;a>e-4?o=TS[a-e+4-1]:0===a&&(o=0),n.push(o);const l=1/(s-2),c=-l,h=1+l,d=[c,c,h,c,h,h,c,c,h,h,c,h],u=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*u),y=new Float32Array(m*p*u),b=new Float32Array(g*p*u);for(let e=0;e<u;e++){const t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];v.set(n,f*p*e),y.set(d,m*p*e);const r=[e,e,e,e,e,e];b.set(r,g*p*e)}const A=new Om;A.setAttribute("position",new _m(v,f)),A.setAttribute("uv",new _m(y,m)),A.setAttribute("faceIndex",new _m(b,g)),t.push(A),r>4&&r--}return{lodPlanes:t,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(e,t,i){const n=new Float32Array(IS),r=new Vp(0,1,0),s=new eg({name:"SphericalGaussianBlur",defines:{n:IS,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:WS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s}(n,e,t)}return n}_compileMaterial(e){const t=new qm(this._lodPlanes[0],e);this._renderer.compile(t,PS)}_sceneToCubeUV(e,t,i,n,r){const s=new sg(90,1,t,i),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,h=l.toneMapping;l.getClearColor(DS),l.toneMapping=sd,l.autoClear=!1;const d=new mm({name:"PMREM.Background",side:Th,depthWrite:!1,depthTest:!1}),u=new qm(new Ym,d);let p=!1;const f=e.background;f?f.isColor&&(d.color.copy(f),e.background=null,p=!0):(d.color.copy(DS),p=!0);for(let m=0;m<6;m++){const t=m%3;0===t?(s.up.set(0,a[m],0),s.position.set(r.x,r.y,r.z),s.lookAt(r.x+o[m],r.y,r.z)):1===t?(s.up.set(0,0,a[m]),s.position.set(r.x,r.y,r.z),s.lookAt(r.x,r.y+o[m],r.z)):(s.up.set(0,a[m],0),s.position.set(r.x,r.y,r.z),s.lookAt(r.x,r.y,r.z+o[m]));const i=this._cubeSize;VS(n,t*i,m>2?i:0,i,i),l.setRenderTarget(n),p&&l.render(u,s),l.render(e,s)}u.geometry.dispose(),u.material.dispose(),l.toneMapping=h,l.autoClear=c,e.background=f}_textureToCubeUV(e,t){const i=this._renderer,n=e.mapping===md||e.mapping===gd;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=HS()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=GS());const r=n?this._cubemapMaterial:this._equirectMaterial,s=new qm(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const a=this._cubeSize;VS(t,0,0,3*a,2*a),i.setRenderTarget(t),i.render(s,PS)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const n=this._lodPlanes.length;for(let r=1;r<n;r++){const t=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),i=FS[(n-r-1)%FS.length];this._blur(e,r-1,r,t,i)}t.autoClear=i}_blur(e,t,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,n,"latitudinal",r),this._halfBlur(s,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new qm(this._lodPlanes[n],l),h=l.uniforms,d=this._sizeLods[i]-1,u=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,p=r/u,f=isFinite(r)?1+Math.floor(3*p):IS;f>IS&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let b=0;b<IS;++b){const e=b/p,t=Math.exp(-e*e/2);m.push(t),0===b?g+=t:b<f&&(g+=2*t)}for(let b=0;b<m.length;b++)m[b]=m[b]/g;h.envMap.value=e.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a);const{_lodMax:v}=this;h.dTheta.value=u,h.mipInt.value=v-i;const y=this._sizeLods[n];VS(t,3*y*(n>v-4?n-v+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(c,PS)}}function jS(e,t,i){const n=new Fp(e,t,i);return n.texture.mapping=bd,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function VS(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function GS(){return new eg({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:WS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function HS(){return new eg({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:WS(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function WS(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function QS(e){let t=new WeakMap,i=null;function n(e){const i=e.target;i.removeEventListener("dispose",n);const r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,a=s===vd||s===yd,o=s===md||s===gd;if(a||o){let s=t.get(r);const l=void 0!==s?s.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===i&&(i=new zS(e)),s=a?i.fromEquirectangular(r,s):i.fromCubemap(r,s),s.texture.pmremVersion=r.pmremVersion,t.set(r,s),s.texture;if(void 0!==s)return s.texture;{const l=r.image;return a&&l&&l.height>0||o&&l&&function(e){let t=0;const i=6;for(let n=0;n<i;n++)void 0!==e[n]&&t++;return t===i}(l)?(null===i&&(i=new zS(e)),s=a?i.fromEquirectangular(r):i.fromCubemap(r),s.texture.pmremVersion=r.pmremVersion,t.set(r,s),r.addEventListener("dispose",n),s.texture):null}}}return r},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function qS(e){const t={};function i(i){if(void 0!==t[i])return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(e){const t=i(e);return null===t&&wp("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function XS(e,t,i,n){const r={},s=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const i in o.attributes)t.remove(o.attributes[i]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(t.remove(l),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(e){const i=[],n=e.index,r=e.attributes.position;let a=0;if(null!==n){const e=n.array;a=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],r=e[t+1],s=e[t+2];i.push(n,r,r,s,s,n)}}else{if(void 0===r)return;{const e=r.array;a=r.version;for(let t=0,n=e.length/3-1;t<n;t+=3){const e=t+0,n=t+1,r=t+2;i.push(e,n,n,r,r,e)}}}const o=new(yp(i)?Cm:Em)(i,1);o.version=a;const l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",a),r[t.id]=!0,i.memory.geometries++),t},update:function(i){const n=i.attributes;for(const r in n)t.update(n[r],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=s.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&o(e)}else o(e);return s.get(e)}}}function YS(e,t,i){let n,r,s;function a(t,a,o){0!==o&&(e.drawElementsInstanced(n,a,r,t*s,o),i.update(a,n,o))}this.setMode=function(e){n=e},this.setIndex=function(e){r=e.type,s=e.bytesPerElement},this.render=function(t,a){e.drawElements(n,a,r,t*s),i.update(a,n,1)},this.renderInstances=a,this.renderMultiDraw=function(e,s,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,s,0,r,e,0,a);let o=0;for(let t=0;t<a;t++)o+=s[t];i.update(o,n,1)},this.renderMultiDrawInstances=function(e,o,l,c){if(0===l)return;const h=t.get("WEBGL_multi_draw");if(null===h)for(let t=0;t<e.length;t++)a(e[t]/s,o[t],c[t]);else{h.multiDrawElementsInstancedWEBGL(n,o,0,r,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=o[e]*c[e];i.update(t,n,1)}}}function KS(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(i,n,r){switch(t.calls++,n){case e.TRIANGLES:t.triangles+=r*(i/3);break;case e.LINES:t.lines+=r*(i/2);break;case e.LINE_STRIP:t.lines+=r*(i-1);break;case e.LINE_LOOP:t.lines+=r*i;break;case e.POINTS:t.points+=r*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function JS(e,t,i){const n=new WeakMap,r=new Np;return{update:function(s,a,o){const l=s.morphTargetInfluences,c=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=void 0!==c?c.length:0;let d=n.get(a);if(void 0===d||d.count!==h){void 0!==d&&d.texture.dispose();const u=void 0!==a.morphAttributes.position,p=void 0!==a.morphAttributes.normal,f=void 0!==a.morphAttributes.color,m=a.morphAttributes.position||[],g=a.morphAttributes.normal||[],v=a.morphAttributes.color||[];let y=0;!0===u&&(y=1),!0===p&&(y=2),!0===f&&(y=3);let b=a.attributes.position.count*y,A=1;b>t.maxTextureSize&&(A=Math.ceil(b/t.maxTextureSize),b=t.maxTextureSize);const x=new Float32Array(b*A*4*h),w=new Up(x,b,A,h);w.type=Od,w.needsUpdate=!0;const S=4*y;for(let E=0;E<h;E++){const C=m[E],M=g[E],T=v[E],I=b*A*4*E;for(let P=0;P<C.count;P++){const D=P*S;!0===u&&(r.fromBufferAttribute(C,P),x[I+D+0]=r.x,x[I+D+1]=r.y,x[I+D+2]=r.z,x[I+D+3]=0),!0===p&&(r.fromBufferAttribute(M,P),x[I+D+4]=r.x,x[I+D+5]=r.y,x[I+D+6]=r.z,x[I+D+7]=0),!0===f&&(r.fromBufferAttribute(T,P),x[I+D+8]=r.x,x[I+D+9]=r.y,x[I+D+10]=r.z,x[I+D+11]=4===T.itemSize?r.w:1)}}function _(){w.dispose(),n.delete(a),a.removeEventListener("dispose",_)}d={count:h,texture:w,size:new mp(b,A)},n.set(a,d),a.addEventListener("dispose",_)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)o.getUniforms().setValue(e,"morphTexture",s.morphTexture,i);else{let R=0;for(let L=0;L<l.length;L++)R+=l[L];const B=a.morphTargetsRelative?1:1-R;o.getUniforms().setValue(e,"morphTargetBaseInfluence",B),o.getUniforms().setValue(e,"morphTargetInfluences",l)}o.getUniforms().setValue(e,"morphTargetsTexture",d.texture,i),o.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}}}function ZS(e,t,i,n){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(a){const o=n.render.frame,l=a.geometry,c=t.get(a,l);if(r.get(c)!==o&&(t.update(c),r.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),r.get(a)!==o&&(i.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&i.update(a.instanceColor,e.ARRAY_BUFFER),r.set(a,o))),a.isSkinnedMesh){const e=a.skeleton;r.get(e)!==o&&(e.update(),r.set(e,o))}return c},dispose:function(){r=new WeakMap}}}const $S=new Op,e_=new Av(1,1),t_=new Up,i_=new zp,n_=new lg,r_=[],s_=[],a_=new Float32Array(16),o_=new Float32Array(9),l_=new Float32Array(4);function c_(e,t,i){const n=e[0];if(n<=0||n>0)return e;const r=t*i;let s=r_[r];if(void 0===s&&(s=new Float32Array(r),r_[r]=s),0!==t){n.toArray(s,0);for(let n=1,r=0;n!==t;++n)r+=i,e[n].toArray(s,r)}return s}function h_(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function d_(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function u_(e,t){let i=s_[t];void 0===i&&(i=new Int32Array(t),s_[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function p_(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function f_(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(h_(i,t))return;e.uniform2fv(this.addr,t),d_(i,t)}}function m_(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(h_(i,t))return;e.uniform3fv(this.addr,t),d_(i,t)}}function g_(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(h_(i,t))return;e.uniform4fv(this.addr,t),d_(i,t)}}function v_(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(h_(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),d_(i,t)}else{if(h_(i,n))return;l_.set(n),e.uniformMatrix2fv(this.addr,!1,l_),d_(i,n)}}function y_(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(h_(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),d_(i,t)}else{if(h_(i,n))return;o_.set(n),e.uniformMatrix3fv(this.addr,!1,o_),d_(i,n)}}function b_(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(h_(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),d_(i,t)}else{if(h_(i,n))return;a_.set(n),e.uniformMatrix4fv(this.addr,!1,a_),d_(i,n)}}function A_(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function x_(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(h_(i,t))return;e.uniform2iv(this.addr,t),d_(i,t)}}function w_(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(h_(i,t))return;e.uniform3iv(this.addr,t),d_(i,t)}}function S_(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(h_(i,t))return;e.uniform4iv(this.addr,t),d_(i,t)}}function __(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function E_(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(h_(i,t))return;e.uniform2uiv(this.addr,t),d_(i,t)}}function C_(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(h_(i,t))return;e.uniform3uiv(this.addr,t),d_(i,t)}}function M_(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(h_(i,t))return;e.uniform4uiv(this.addr,t),d_(i,t)}}function T_(e,t,i){const n=this.cache,r=i.allocateTextureUnit();let s;n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),this.type===e.SAMPLER_2D_SHADOW?(e_.compareFunction=Xu,s=e_):s=$S,i.setTexture2D(t||s,r)}function I_(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||i_,r)}function P_(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||n_,r)}function D_(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||t_,r)}function R_(e,t){e.uniform1fv(this.addr,t)}function B_(e,t){const i=c_(t,this.size,2);e.uniform2fv(this.addr,i)}function L_(e,t){const i=c_(t,this.size,3);e.uniform3fv(this.addr,i)}function O_(e,t){const i=c_(t,this.size,4);e.uniform4fv(this.addr,i)}function N_(e,t){const i=c_(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function k_(e,t){const i=c_(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function F_(e,t){const i=c_(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function U_(e,t){e.uniform1iv(this.addr,t)}function z_(e,t){e.uniform2iv(this.addr,t)}function j_(e,t){e.uniform3iv(this.addr,t)}function V_(e,t){e.uniform4iv(this.addr,t)}function G_(e,t){e.uniform1uiv(this.addr,t)}function H_(e,t){e.uniform2uiv(this.addr,t)}function W_(e,t){e.uniform3uiv(this.addr,t)}function Q_(e,t){e.uniform4uiv(this.addr,t)}function q_(e,t,i){const n=this.cache,r=t.length,s=u_(i,r);h_(n,s)||(e.uniform1iv(this.addr,s),d_(n,s));for(let a=0;a!==r;++a)i.setTexture2D(t[a]||$S,s[a])}function X_(e,t,i){const n=this.cache,r=t.length,s=u_(i,r);h_(n,s)||(e.uniform1iv(this.addr,s),d_(n,s));for(let a=0;a!==r;++a)i.setTexture3D(t[a]||i_,s[a])}function Y_(e,t,i){const n=this.cache,r=t.length,s=u_(i,r);h_(n,s)||(e.uniform1iv(this.addr,s),d_(n,s));for(let a=0;a!==r;++a)i.setTextureCube(t[a]||n_,s[a])}function K_(e,t,i){const n=this.cache,r=t.length,s=u_(i,r);h_(n,s)||(e.uniform1iv(this.addr,s),d_(n,s));for(let a=0;a!==r;++a)i.setTexture2DArray(t[a]||t_,s[a])}class J_{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return p_;case 35664:return f_;case 35665:return m_;case 35666:return g_;case 35674:return v_;case 35675:return y_;case 35676:return b_;case 5124:case 35670:return A_;case 35667:case 35671:return x_;case 35668:case 35672:return w_;case 35669:case 35673:return S_;case 5125:return __;case 36294:return E_;case 36295:return C_;case 36296:return M_;case 35678:case 36198:case 36298:case 36306:case 35682:return T_;case 35679:case 36299:case 36307:return I_;case 35680:case 36300:case 36308:case 36293:return P_;case 36289:case 36303:case 36311:case 36292:return D_}}(t.type)}}class Z_{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return R_;case 35664:return B_;case 35665:return L_;case 35666:return O_;case 35674:return N_;case 35675:return k_;case 35676:return F_;case 5124:case 35670:return U_;case 35667:case 35671:return z_;case 35668:case 35672:return j_;case 35669:case 35673:return V_;case 5125:return G_;case 36294:return H_;case 36295:return W_;case 36296:return Q_;case 35678:case 36198:case 36298:case 36306:case 35682:return q_;case 35679:case 36299:case 36307:return X_;case 35680:case 36300:case 36308:case 36293:return Y_;case 36289:case 36303:case 36311:case 36292:return K_}}(t.type)}}class $_{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(e,t[s.id],i)}}}const eE=/(\w+)(\])?(\[|\.)?/g;function tE(e,t){e.seq.push(t),e.map[t.id]=t}function iE(e,t,i){const n=e.name,r=n.length;for(eE.lastIndex=0;;){const s=eE.exec(n),a=eE.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){tE(i,void 0===c?new J_(o,e,t):new Z_(o,e,t));break}{let e=i.map[o];void 0===e&&(e=new $_(o),tE(i,e)),i=e}}}class nE{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const i=e.getActiveUniform(t,n);iE(i,e.getUniformLocation(t,i.name),this)}}setValue(e,t,i,n){const r=this.map[t];void 0!==r&&r.setValue(e,i,n)}setOptional(e,t,i){const n=t[i];void 0!==n&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,s=t.length;r!==s;++r){const s=t[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,n)}}static seqWithValue(e,t){const i=[];for(let n=0,r=e.length;n!==r;++n){const r=e[n];r.id in t&&i.push(r)}return i}}function rE(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}const sE=37297;let aE=0;const oE=new gp;function lE(e,t,i){const n=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(n&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const n=parseInt(s[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const i=e.split("\n"),n=[],r=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=r;a<s;a++){const e=a+1;n.push(`${e===t?">":" "} ${e}: ${i[a]}`)}return n.join("\n")}(e.getShaderSource(t),n)}return r}function cE(e,t){const i=function(e){Cp._getMatrix(oE,Cp.workingColorSpace,e);const t=`mat3( ${oE.elements.map((e=>e.toFixed(4)))} )`;switch(Cp.getTransfer(e)){case Vu:return[t,"LinearTransferOETF"];case Gu:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}(t);return[`vec4 ${e}( vec4 value ) {`,`\treturn ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join("\n")}function hE(e,t){let i;switch(t){case ad:i="Linear";break;case od:i="Reinhard";break;case ld:i="Cineon";break;case cd:i="ACESFilmic";break;case dd:i="AgX";break;case ud:i="Neutral";break;case hd:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const dE=new Vp;function uE(){Cp.getLuminanceCoefficients(dE);return["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${dE.x.toFixed(4)}, ${dE.y.toFixed(4)}, ${dE.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function pE(e){return""!==e}function fE(e,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function mE(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const gE=/^[ \t]*#include +<([\w\d./]+)>/gm;function vE(e){return e.replace(gE,bE)}const yE=new Map;function bE(e,t){let i=gS[t];if(void 0===i){const e=yE.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");i=gS[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return vE(i)}const AE=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function xE(e){return e.replace(AE,wE)}function wE(e,t,i,n){let r="";for(let s=parseInt(t);s<parseInt(i);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function SE(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function _E(e,t,i,n){const r=e.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===_h?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Eh?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Ch&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case md:case gd:t="ENVMAP_TYPE_CUBE";break;case bd:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),h=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===gd&&(t="ENVMAP_MODE_REFRACTION");return t}(i),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case id:t="ENVMAP_BLENDING_MULTIPLY";break;case nd:t="ENVMAP_BLENDING_MIX";break;case rd:t="ENVMAP_BLENDING_ADD"}return t}(i),u=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const i=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),p=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(pE).join("\n")}(i),f=function(e){const t=[];for(const i in e){const n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(s),m=r.createProgram();let g,v,y=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(g=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(pE).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(pE).join("\n"),v.length>0&&(v+="\n")):(g=[SE(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(pE).join("\n"),v=[SE(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+d:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==sd?"#define TONE_MAPPING":"",i.toneMapping!==sd?gS.tonemapping_pars_fragment:"",i.toneMapping!==sd?hE("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",gS.colorspace_pars_fragment,cE("linearToOutputTexel",i.outputColorSpace),uE(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(pE).join("\n")),a=vE(a),a=fE(a,i),a=mE(a,i),o=vE(o),o=fE(o,i),o=mE(o,i),a=xE(a),o=xE(o),!0!==i.isRawShaderMaterial&&(y="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",i.glslVersion===ep?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===ep?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+g+a,A=y+v+o,x=rE(r,r.VERTEX_SHADER,b),w=rE(r,r.FRAGMENT_SHADER,A);function S(t){if(e.debug.checkShaderErrors){const i=r.getProgramInfoLog(m).trim(),n=r.getShaderInfoLog(x).trim(),s=r.getShaderInfoLog(w).trim();let a=!0,o=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(a=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(r,m,x,w);else{const e=lE(r,x,"vertex"),n=lE(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+i+"\n"+e+"\n"+n)}else""!==i?console.warn("THREE.WebGLProgram: Program Info Log:",i):""!==n&&""!==s||(o=!1);o&&(t.diagnostics={runnable:a,programLog:i,vertexShader:{log:n,prefix:g},fragmentShader:{log:s,prefix:v}})}r.deleteShader(x),r.deleteShader(w),_=new nE(r,m),E=function(e,t){const i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const n=e.getActiveAttrib(t,r),s=n.name;let a=1;n.type===e.FLOAT_MAT2&&(a=2),n.type===e.FLOAT_MAT3&&(a=3),n.type===e.FLOAT_MAT4&&(a=4),i[s]={type:n.type,location:e.getAttribLocation(t,s),locationSize:a}}return i}(r,m)}let _,E;r.attachShader(m,x),r.attachShader(m,w),void 0!==i.index0AttributeName?r.bindAttribLocation(m,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===_&&S(this),_},this.getAttributes=function(){return void 0===E&&S(this),E};let C=!1===i.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===C&&(C=r.getProgramParameter(m,sE)),C},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=aE++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=w,this}let EE=0;class CE{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new ME(e),t.set(e,i)),i}}class ME{constructor(e){this.id=EE++,this.code=e,this.usedTimes=0}}function TE(e,t,i,n,r,s,a){const o=new Pf,l=new CE,c=new Set,h=[],d=r.logarithmicDepthBuffer,u=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(s,o,h,g,v){const y=g.fog,b=v.geometry,A=s.isMeshStandardMaterial?g.environment:null,x=(s.isMeshStandardMaterial?i:t).get(s.envMap||A),w=x&&x.mapping===bd?x.image.height:null,S=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const _=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,E=void 0!==_?_.length:0;let C,M,T,I,P=0;if(void 0!==b.morphAttributes.position&&(P=1),void 0!==b.morphAttributes.normal&&(P=2),void 0!==b.morphAttributes.color&&(P=3),S){const e=yS[S];C=e.vertexShader,M=e.fragmentShader}else C=s.vertexShader,M=s.fragmentShader,l.update(s),T=l.getVertexShaderID(s),I=l.getFragmentShaderID(s);const D=e.getRenderTarget(),R=e.state.buffers.depth.getReversed(),B=!0===v.isInstancedMesh,L=!0===v.isBatchedMesh,O=!!s.map,N=!!s.matcap,k=!!x,F=!!s.aoMap,U=!!s.lightMap,z=!!s.bumpMap,j=!!s.normalMap,V=!!s.displacementMap,G=!!s.emissiveMap,H=!!s.metalnessMap,W=!!s.roughnessMap,Q=s.anisotropy>0,q=s.clearcoat>0,X=s.dispersion>0,Y=s.iridescence>0,K=s.sheen>0,J=s.transmission>0,Z=Q&&!!s.anisotropyMap,$=q&&!!s.clearcoatMap,ee=q&&!!s.clearcoatNormalMap,te=q&&!!s.clearcoatRoughnessMap,ie=Y&&!!s.iridescenceMap,ne=Y&&!!s.iridescenceThicknessMap,re=K&&!!s.sheenColorMap,se=K&&!!s.sheenRoughnessMap,ae=!!s.specularMap,oe=!!s.specularColorMap,le=!!s.specularIntensityMap,ce=J&&!!s.transmissionMap,he=J&&!!s.thicknessMap,de=!!s.gradientMap,ue=!!s.alphaMap,pe=s.alphaTest>0,fe=!!s.alphaHash,me=!!s.extensions;let ge=sd;s.toneMapped&&(null!==D&&!0!==D.isXRRenderTarget||(ge=e.toneMapping));const ve={shaderID:S,shaderType:s.type,shaderName:s.name,vertexShader:C,fragmentShader:M,defines:s.defines,customVertexShaderID:T,customFragmentShaderID:I,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,batching:L,batchingColor:L&&null!==v._colorsTexture,instancing:B,instancingColor:B&&null!==v.instanceColor,instancingMorph:B&&null!==v.morphTexture,supportsVertexTextures:u,outputColorSpace:null===D?e.outputColorSpace:!0===D.isXRRenderTarget?D.texture.colorSpace:ju,alphaToCoverage:!!s.alphaToCoverage,map:O,matcap:N,envMap:k,envMapMode:k&&x.mapping,envMapCubeUVHeight:w,aoMap:F,lightMap:U,bumpMap:z,normalMap:j,displacementMap:u&&V,emissiveMap:G,normalMapObjectSpace:j&&1===s.normalMapType,normalMapTangentSpace:j&&0===s.normalMapType,metalnessMap:H,roughnessMap:W,anisotropy:Q,anisotropyMap:Z,clearcoat:q,clearcoatMap:$,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,dispersion:X,iridescence:Y,iridescenceMap:ie,iridescenceThicknessMap:ne,sheen:K,sheenColorMap:re,sheenRoughnessMap:se,specularMap:ae,specularColorMap:oe,specularIntensityMap:le,transmission:J,transmissionMap:ce,thicknessMap:he,gradientMap:de,opaque:!1===s.transparent&&1===s.blending&&!1===s.alphaToCoverage,alphaMap:ue,alphaTest:pe,alphaHash:fe,combine:s.combine,mapUv:O&&m(s.map.channel),aoMapUv:F&&m(s.aoMap.channel),lightMapUv:U&&m(s.lightMap.channel),bumpMapUv:z&&m(s.bumpMap.channel),normalMapUv:j&&m(s.normalMap.channel),displacementMapUv:V&&m(s.displacementMap.channel),emissiveMapUv:G&&m(s.emissiveMap.channel),metalnessMapUv:H&&m(s.metalnessMap.channel),roughnessMapUv:W&&m(s.roughnessMap.channel),anisotropyMapUv:Z&&m(s.anisotropyMap.channel),clearcoatMapUv:$&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:ee&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:ie&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:ne&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:re&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:se&&m(s.sheenRoughnessMap.channel),specularMapUv:ae&&m(s.specularMap.channel),specularColorMapUv:oe&&m(s.specularColorMap.channel),specularIntensityMapUv:le&&m(s.specularIntensityMap.channel),transmissionMapUv:ce&&m(s.transmissionMap.channel),thicknessMapUv:he&&m(s.thicknessMap.channel),alphaMapUv:ue&&m(s.alphaMap.channel),vertexTangents:!!b.attributes.tangent&&(j||Q),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!b.attributes.uv&&(O||ue),fog:!!y,useFog:!0===s.fog,fogExp2:!!y&&y.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:d,reverseDepthBuffer:R,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:E,morphTextureStride:P,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge,decodeVideoTexture:O&&!0===s.map.isVideoTexture&&Cp.getTransfer(s.map.colorSpace)===Gu,decodeVideoTextureEmissive:G&&!0===s.emissiveMap.isVideoTexture&&Cp.getTransfer(s.emissiveMap.colorSpace)===Gu,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===Ih,flipSided:s.side===Th,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:me&&!0===s.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(me&&!0===s.extensions.multiDraw||L)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return ve.vertexUv1s=c.has(1),ve.vertexUv2s=c.has(2),ve.vertexUv3s=c.has(3),c.clear(),ve},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.customVertexShaderID),i.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(i,t),function(e,t){o.disableAll(),t.supportsVertexTextures&&o.enable(0);t.instancing&&o.enable(1);t.instancingColor&&o.enable(2);t.instancingMorph&&o.enable(3);t.matcap&&o.enable(4);t.envMap&&o.enable(5);t.normalMapObjectSpace&&o.enable(6);t.normalMapTangentSpace&&o.enable(7);t.clearcoat&&o.enable(8);t.iridescence&&o.enable(9);t.alphaTest&&o.enable(10);t.vertexColors&&o.enable(11);t.vertexAlphas&&o.enable(12);t.vertexUv1s&&o.enable(13);t.vertexUv2s&&o.enable(14);t.vertexUv3s&&o.enable(15);t.vertexTangents&&o.enable(16);t.anisotropy&&o.enable(17);t.alphaHash&&o.enable(18);t.batching&&o.enable(19);t.dispersion&&o.enable(20);t.batchingColor&&o.enable(21);e.push(o.mask),o.disableAll(),t.fog&&o.enable(0);t.useFog&&o.enable(1);t.flatShading&&o.enable(2);t.logarithmicDepthBuffer&&o.enable(3);t.reverseDepthBuffer&&o.enable(4);t.skinning&&o.enable(5);t.morphTargets&&o.enable(6);t.morphNormals&&o.enable(7);t.morphColors&&o.enable(8);t.premultipliedAlpha&&o.enable(9);t.shadowMapEnabled&&o.enable(10);t.doubleSided&&o.enable(11);t.flipSided&&o.enable(12);t.useDepthPacking&&o.enable(13);t.dithering&&o.enable(14);t.transmission&&o.enable(15);t.sheen&&o.enable(16);t.opaque&&o.enable(17);t.pointsUvs&&o.enable(18);t.decodeVideoTexture&&o.enable(19);t.decodeVideoTextureEmissive&&o.enable(20);t.alphaToCoverage&&o.enable(21);e.push(o.mask)}(i,t),i.push(e.outputColorSpace)),i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=f[e.type];let i;if(t){const e=yS[t];i=$m.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let n;for(let e=0,r=h.length;e<r;e++){const t=h[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new _E(e,i,t,s),h.push(n)),n},releaseProgram:function(e){if(0===--e.usedTimes){const t=h.indexOf(e);h[t]=h[h.length-1],h.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:h,dispose:function(){l.dispose()}}}function IE(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function PE(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function DE(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function RE(){const e=[];let t=0;const i=[],n=[],r=[];function s(i,n,r,s,a,o){let l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:a,group:o},e[t]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){t=0,i.length=0,n.length=0,r.length=0},push:function(e,t,a,o,l,c){const h=s(e,t,a,o,l,c);a.transmission>0?n.push(h):!0===a.transparent?r.push(h):i.push(h)},unshift:function(e,t,a,o,l,c){const h=s(e,t,a,o,l,c);a.transmission>0?n.unshift(h):!0===a.transparent?r.unshift(h):i.unshift(h)},finish:function(){for(let i=t,n=e.length;i<n;i++){const t=e[i];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){i.length>1&&i.sort(e||PE),n.length>1&&n.sort(t||DE),r.length>1&&r.sort(t||DE)}}}function BE(){let e=new WeakMap;return{get:function(t,i){const n=e.get(t);let r;return void 0===n?(r=new RE,e.set(t,[r])):i>=n.length?(r=new RE,n.push(r)):r=n[i],r},dispose:function(){e=new WeakMap}}}function LE(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new Vp,color:new dm};break;case"SpotLight":i={position:new Vp,direction:new Vp,color:new dm,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vp,color:new dm,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vp,skyColor:new dm,groundColor:new dm};break;case"RectAreaLight":i={color:new dm,position:new Vp,halfWidth:new Vp,halfHeight:new Vp}}return e[t.id]=i,i}}}let OE=0;function NE(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function kE(e){const t=new LE,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mp};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mp,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let o=0;o<9;o++)n.probe.push(new Vp);const r=new Vp,s=new bf,a=new bf;return{setup:function(r){let s=0,a=0,o=0;for(let e=0;e<9;e++)n.probe[e].set(0,0,0);let l=0,c=0,h=0,d=0,u=0,p=0,f=0,m=0,g=0,v=0,y=0;r.sort(NE);for(let e=0,A=r.length;e<A;e++){const b=r[e],A=b.color,x=b.intensity,w=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)s+=A.r*x,a+=A.g*x,o+=A.b*x;else if(b.isLightProbe){for(let e=0;e<9;e++)n.probe[e].addScaledVector(b.sh.coefficients[e],x);y++}else if(b.isDirectionalLight){const e=t.get(b);if(e.color.copy(b.color).multiplyScalar(b.intensity),b.castShadow){const e=b.shadow,t=i.get(b);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,n.directionalShadow[l]=t,n.directionalShadowMap[l]=S,n.directionalShadowMatrix[l]=b.shadow.matrix,p++}n.directional[l]=e,l++}else if(b.isSpotLight){const e=t.get(b);e.position.setFromMatrixPosition(b.matrixWorld),e.color.copy(A).multiplyScalar(x),e.distance=w,e.coneCos=Math.cos(b.angle),e.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),e.decay=b.decay,n.spot[h]=e;const r=b.shadow;if(b.map&&(n.spotLightMap[g]=b.map,g++,r.updateMatrices(b),b.castShadow&&v++),n.spotLightMatrix[h]=r.matrix,b.castShadow){const e=i.get(b);e.shadowIntensity=r.intensity,e.shadowBias=r.bias,e.shadowNormalBias=r.normalBias,e.shadowRadius=r.radius,e.shadowMapSize=r.mapSize,n.spotShadow[h]=e,n.spotShadowMap[h]=S,m++}h++}else if(b.isRectAreaLight){const e=t.get(b);e.color.copy(A).multiplyScalar(x),e.halfWidth.set(.5*b.width,0,0),e.halfHeight.set(0,.5*b.height,0),n.rectArea[d]=e,d++}else if(b.isPointLight){const e=t.get(b);if(e.color.copy(b.color).multiplyScalar(b.intensity),e.distance=b.distance,e.decay=b.decay,b.castShadow){const e=b.shadow,t=i.get(b);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,n.pointShadow[c]=t,n.pointShadowMap[c]=S,n.pointShadowMatrix[c]=b.shadow.matrix,f++}n.point[c]=e,c++}else if(b.isHemisphereLight){const e=t.get(b);e.skyColor.copy(b.color).multiplyScalar(x),e.groundColor.copy(b.groundColor).multiplyScalar(x),n.hemi[u]=e,u++}}d>0&&(!0===e.has("OES_texture_float_linear")?(n.rectAreaLTC1=vS.LTC_FLOAT_1,n.rectAreaLTC2=vS.LTC_FLOAT_2):(n.rectAreaLTC1=vS.LTC_HALF_1,n.rectAreaLTC2=vS.LTC_HALF_2)),n.ambient[0]=s,n.ambient[1]=a,n.ambient[2]=o;const b=n.hash;b.directionalLength===l&&b.pointLength===c&&b.spotLength===h&&b.rectAreaLength===d&&b.hemiLength===u&&b.numDirectionalShadows===p&&b.numPointShadows===f&&b.numSpotShadows===m&&b.numSpotMaps===g&&b.numLightProbes===y||(n.directional.length=l,n.spot.length=h,n.rectArea.length=d,n.point.length=c,n.hemi.length=u,n.directionalShadow.length=p,n.directionalShadowMap.length=p,n.pointShadow.length=f,n.pointShadowMap.length=f,n.spotShadow.length=m,n.spotShadowMap.length=m,n.directionalShadowMatrix.length=p,n.pointShadowMatrix.length=f,n.spotLightMatrix.length=m+g-v,n.spotLightMap.length=g,n.numSpotLightShadowsWithMaps=v,n.numLightProbes=y,b.directionalLength=l,b.pointLength=c,b.spotLength=h,b.rectAreaLength=d,b.hemiLength=u,b.numDirectionalShadows=p,b.numPointShadows=f,b.numSpotShadows=m,b.numSpotMaps=g,b.numLightProbes=y,n.version=OE++)},setupView:function(e,t){let i=0,o=0,l=0,c=0,h=0;const d=t.matrixWorldInverse;for(let u=0,p=e.length;u<p;u++){const t=e[u];if(t.isDirectionalLight){const e=n.directional[i];e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(d),i++}else if(t.isSpotLight){const e=n.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(d),l++}else if(t.isRectAreaLight){const e=n.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),a.identity(),s.copy(t.matrixWorld),s.premultiply(d),a.extractRotation(s),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(t.isPointLight){const e=n.point[o];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),o++}else if(t.isHemisphereLight){const e=n.hemi[h];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(d),h++}}},state:n}}function FE(e){const t=new kE(e),i=[],n=[];const r={lightsArray:i,shadowsArray:n,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){r.camera=e,i.length=0,n.length=0},state:r,setupLights:function(){t.setup(i)},setupLightsView:function(e){t.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){n.push(e)}}}function UE(e){let t=new WeakMap;return{get:function(i){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=t.get(i);let s;return void 0===r?(s=new FE(e),t.set(i,[s])):n>=r.length?(s=new FE(e),r.push(s)):s=r[n],s},dispose:function(){t=new WeakMap}}}function zE(e,t,i){let n=new qg;const r=new mp,s=new mp,a=new Np,o=new Ev({depthPacking:3201}),l=new Cv,c={},h=i.maxTextureSize,d={[Mh]:Th,[Th]:Mh,[Ih]:Ih},u=new eg({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new mp},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=u.clone();p.defines.HORIZONTAL_PASS=1;const f=new Om;f.setAttribute("position",new _m(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new qm(f,u),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_h;let v=this.type;function y(i,n){const s=t.update(m);u.defines.VSM_SAMPLES!==i.blurSamples&&(u.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,u.needsUpdate=!0,p.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new Fp(r.x,r.y)),u.uniforms.shadow_pass.value=i.map.texture,u.uniforms.resolution.value=i.mapSize,u.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,s,u,m,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,s,p,m,null)}function b(t,i,n,r){let s=null;const a=!0===n.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)s=a;else if(s=!0===n.isPointLight?l:o,e.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0||!0===i.alphaToCoverage){const e=s.uuid,t=i.uuid;let n=c[e];void 0===n&&(n={},c[e]=n);let r=n[t];void 0===r&&(r=s.clone(),n[t]=r,i.addEventListener("dispose",x)),s=r}if(s.visible=i.visible,s.wireframe=i.wireframe,s.side=r===Ch?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:d[i.side],s.alphaMap=i.alphaMap,s.alphaTest=!0===i.alphaToCoverage?.5:i.alphaTest,s.map=i.map,s.clipShadows=i.clipShadows,s.clippingPlanes=i.clippingPlanes,s.clipIntersection=i.clipIntersection,s.displacementMap=i.displacementMap,s.displacementScale=i.displacementScale,s.displacementBias=i.displacementBias,s.wireframeLinewidth=i.wireframeLinewidth,s.linewidth=i.linewidth,!0===n.isPointLight&&!0===s.isMeshDistanceMaterial){e.properties.get(s).light=n}return s}function A(i,r,s,a,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&o===Ch)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=t.update(i),l=i.material;if(Array.isArray(l)){const t=n.groups;for(let c=0,h=t.length;c<h;c++){const h=t[c],d=l[h.materialIndex];if(d&&d.visible){const t=b(i,d,a,o);i.onBeforeShadow(e,i,r,s,n,t,h),e.renderBufferDirect(s,null,n,t,i,h),i.onAfterShadow(e,i,r,s,n,t,h)}}}else if(l.visible){const t=b(i,l,a,o);i.onBeforeShadow(e,i,r,s,n,t,null),e.renderBufferDirect(s,null,n,t,i,null),i.onAfterShadow(e,i,r,s,n,t,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)A(l[e],r,s,a,o)}function x(e){e.target.removeEventListener("dispose",x);for(const t in c){const i=c[t],n=e.target.uuid;if(n in i){i[n].dispose(),delete i[n]}}}this.render=function(t,i,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),u=e.state;u.setBlending(0),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);const p=v!==Ch&&this.type===Ch,f=v===Ch&&this.type!==Ch;for(let m=0,g=t.length;m<g;m++){const l=t[m],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const d=c.getFrameExtents();if(r.multiply(d),s.copy(c.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/d.x),r.x=s.x*d.x,c.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/d.y),r.y=s.y*d.y,c.mapSize.y=s.y)),null===c.map||!0===p||!0===f){const e=this.type!==Ch?{minFilter:Sd,magFilter:Sd}:{};null!==c.map&&c.map.dispose(),c.map=new Fp(r.x,r.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const g=c.getViewportCount();for(let e=0;e<g;e++){const t=c.getViewport(e);a.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),u.viewport(a),c.updateMatrices(l,e),n=c.getFrustum(),A(i,o,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===Ch&&y(c,o),c.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,d)}}const jE={[Xh]:1,[Kh]:6,[Zh]:7,[Jh]:5,[Yh]:0,[ed]:2,[td]:4,[$h]:3};function VE(e,t){const i=new function(){let t=!1;const i=new Np;let n=null;const r=new Np(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,s,a,o){!0===o&&(t*=a,n*=a,s*=a),i.set(t,n,s,a),!1===r.equals(i)&&(e.clearColor(t,n,s,a),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},n=new function(){let i=!1,n=!1,r=null,s=null,a=null;return{setReversed:function(e){if(n!==e){const i=t.get("EXT_clip_control");e?i.clipControlEXT(i.LOWER_LEFT_EXT,i.ZERO_TO_ONE_EXT):i.clipControlEXT(i.LOWER_LEFT_EXT,i.NEGATIVE_ONE_TO_ONE_EXT),n=e;const r=a;a=null,this.setClear(r)}},getReversed:function(){return n},setTest:function(t){t?z(e.DEPTH_TEST):j(e.DEPTH_TEST)},setMask:function(t){r===t||i||(e.depthMask(t),r=t)},setFunc:function(t){if(n&&(t=jE[t]),s!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}s=t}},setLocked:function(e){i=e},setClear:function(t){a!==t&&(n&&(t=1-t),e.clearDepth(t),a=t)},reset:function(){i=!1,r=null,s=null,a=null,n=!1}}},r=new function(){let t=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(i){t||(i?z(e.STENCIL_TEST):j(e.STENCIL_TEST))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,a){n===t&&r===i&&s===a||(e.stencilFunc(t,i,a),n=t,r=i,s=a)},setOp:function(t,i,n){a===t&&o===i&&l===n||(e.stencilOp(t,i,n),a=t,o=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,c=null}}},s=new WeakMap,a=new WeakMap;let o={},l={},c=new WeakMap,h=[],d=null,u=!1,p=null,f=null,m=null,g=null,v=null,y=null,b=null,A=new dm(0,0,0),x=0,w=!1,S=null,_=null,E=null,C=null,M=null;const T=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let I=!1,P=0;const D=e.getParameter(e.VERSION);-1!==D.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(D)[1]),I=P>=1):-1!==D.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(D)[1]),I=P>=2);let R=null,B={};const L=e.getParameter(e.SCISSOR_BOX),O=e.getParameter(e.VIEWPORT),N=(new Np).fromArray(L),k=(new Np).fromArray(O);function F(t,i,n,r){const s=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<n;o++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(i,0,e.RGBA,1,1,r,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage2D(i+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s);return a}const U={};function z(t){!0!==o[t]&&(e.enable(t),o[t]=!0)}function j(t){!1!==o[t]&&(e.disable(t),o[t]=!1)}U[e.TEXTURE_2D]=F(e.TEXTURE_2D,e.TEXTURE_2D,1),U[e.TEXTURE_CUBE_MAP]=F(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),U[e.TEXTURE_2D_ARRAY]=F(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),U[e.TEXTURE_3D]=F(e.TEXTURE_3D,e.TEXTURE_3D,1,1),i.setClear(0,0,0,1),n.setClear(1),r.setClear(0),z(e.DEPTH_TEST),n.setFunc(3),W(!1),Q(1),z(e.CULL_FACE),H(0);const V={[Ph]:e.FUNC_ADD,[Dh]:e.FUNC_SUBTRACT,[Rh]:e.FUNC_REVERSE_SUBTRACT};V[103]=e.MIN,V[104]=e.MAX;const G={[Bh]:e.ZERO,[Lh]:e.ONE,[Oh]:e.SRC_COLOR,[kh]:e.SRC_ALPHA,[Gh]:e.SRC_ALPHA_SATURATE,[jh]:e.DST_COLOR,[Uh]:e.DST_ALPHA,[Nh]:e.ONE_MINUS_SRC_COLOR,[Fh]:e.ONE_MINUS_SRC_ALPHA,[Vh]:e.ONE_MINUS_DST_COLOR,[zh]:e.ONE_MINUS_DST_ALPHA,[Hh]:e.CONSTANT_COLOR,[Wh]:e.ONE_MINUS_CONSTANT_COLOR,[Qh]:e.CONSTANT_ALPHA,[qh]:e.ONE_MINUS_CONSTANT_ALPHA};function H(t,i,n,r,s,a,o,l,c,h){if(0!==t){if(!1===u&&(z(e.BLEND),u=!0),5===t)s=s||i,a=a||n,o=o||r,i===f&&s===v||(e.blendEquationSeparate(V[i],V[s]),f=i,v=s),n===m&&r===g&&a===y&&o===b||(e.blendFuncSeparate(G[n],G[r],G[a],G[o]),m=n,g=r,y=a,b=o),!1!==l.equals(A)&&c===x||(e.blendColor(l.r,l.g,l.b,c),A.copy(l),x=c),p=t,w=!1;else if(t!==p||h!==w){if(f===Ph&&v===Ph||(e.blendEquation(e.FUNC_ADD),f=Ph,v=Ph),h)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,g=null,y=null,b=null,A.set(0,0,0),x=0,p=t,w=h}}else!0===u&&(j(e.BLEND),u=!1)}function W(t){S!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),S=t)}function Q(t){0!==t?(z(e.CULL_FACE),t!==_&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):j(e.CULL_FACE),_=t}function q(t,i,n){t?(z(e.POLYGON_OFFSET_FILL),C===i&&M===n||(e.polygonOffset(i,n),C=i,M=n)):j(e.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:n,stencil:r},enable:z,disable:j,bindFramebuffer:function(t,i){return l[t]!==i&&(e.bindFramebuffer(t,i),l[t]=i,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=i),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=i),!0)},drawBuffers:function(t,i){let n=h,r=!1;if(t){n=c.get(i),void 0===n&&(n=[],c.set(i,n));const s=t.textures;if(n.length!==s.length||n[0]!==e.COLOR_ATTACHMENT0){for(let t=0,i=s.length;t<i;t++)n[t]=e.COLOR_ATTACHMENT0+t;n.length=s.length,r=!0}}else n[0]!==e.BACK&&(n[0]=e.BACK,r=!0);r&&e.drawBuffers(n)},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:H,setMaterial:function(t,s){t.side===Ih?j(e.CULL_FACE):z(e.CULL_FACE);let a=t.side===Th;s&&(a=!a),W(a),1===t.blending&&!1===t.transparent?H(0):H(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),n.setFunc(t.depthFunc),n.setTest(t.depthTest),n.setMask(t.depthWrite),i.setMask(t.colorWrite);const o=t.stencilWrite;r.setTest(o),o&&(r.setMask(t.stencilWriteMask),r.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),r.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?z(e.SAMPLE_ALPHA_TO_COVERAGE):j(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:Q,setLineWidth:function(t){t!==E&&(I&&e.lineWidth(t),E=t)},setPolygonOffset:q,setScissorTest:function(t){t?z(e.SCISSOR_TEST):j(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+T-1),R!==t&&(e.activeTexture(t),R=t)},bindTexture:function(t,i,n){void 0===n&&(n=null===R?e.TEXTURE0+T-1:R);let r=B[n];void 0===r&&(r={type:void 0,texture:void 0},B[n]=r),r.type===t&&r.texture===i||(R!==n&&(e.activeTexture(n),R=n),e.bindTexture(t,i||U[t]),r.type=t,r.texture=i)},unbindTexture:function(){const t=B[R];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,i){let n=a.get(i);void 0===n&&(n=new WeakMap,a.set(i,n));let r=n.get(t);void 0===r&&(r=e.getUniformBlockIndex(i,t.name),n.set(t,r))},uniformBlockBinding:function(t,i){const n=a.get(i).get(t);s.get(i)!==n&&(e.uniformBlockBinding(i,n,t.__bindingPointIndex),s.set(i,n))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===N.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),N.copy(t))},viewport:function(t){!1===k.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),k.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),n.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),o={},R=null,B={},l={},c=new WeakMap,h=[],d=null,u=!1,p=null,f=null,m=null,g=null,v=null,y=null,b=null,A=new dm(0,0,0),x=0,w=!1,S=null,_=null,E=null,C=null,M=null,N.set(0,0,e.canvas.width,e.canvas.height),k.set(0,0,e.canvas.width,e.canvas.height),i.reset(),n.reset(),r.reset()}}}function GE(e,t,i,n,r,s,a){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new mp,h=new WeakMap;let d;const u=new WeakMap;let p=!1;try{p="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(KR){}function f(e,t){return p?new OffscreenCanvas(e,t):bp("canvas")}function m(e,t,i){let n=1;const r=V(e);if((r.width>i||r.height>i)&&(n=i/Math.max(r.width,r.height)),n<1){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof VideoFrame&&e instanceof VideoFrame){const i=Math.floor(n*r.width),s=Math.floor(n*r.height);void 0===d&&(d=f(i,s));const a=t?f(i,s):d;a.width=i,a.height=s;return a.getContext("2d").drawImage(e,0,0,i,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+i+"x"+s+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),e}return e}function g(e){return e.generateMipmaps}function v(t){e.generateMipmap(t)}function y(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function b(i,n,r,s){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=n;if(n===e.RED&&(r===e.FLOAT&&(o=e.R32F),r===e.HALF_FLOAT&&(o=e.R16F),r===e.UNSIGNED_BYTE&&(o=e.R8)),n===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.R8UI),r===e.UNSIGNED_SHORT&&(o=e.R16UI),r===e.UNSIGNED_INT&&(o=e.R32UI),r===e.BYTE&&(o=e.R8I),r===e.SHORT&&(o=e.R16I),r===e.INT&&(o=e.R32I)),n===e.RG&&(r===e.FLOAT&&(o=e.RG32F),r===e.HALF_FLOAT&&(o=e.RG16F),r===e.UNSIGNED_BYTE&&(o=e.RG8)),n===e.RG_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RG8UI),r===e.UNSIGNED_SHORT&&(o=e.RG16UI),r===e.UNSIGNED_INT&&(o=e.RG32UI),r===e.BYTE&&(o=e.RG8I),r===e.SHORT&&(o=e.RG16I),r===e.INT&&(o=e.RG32I)),n===e.RGB_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RGB8UI),r===e.UNSIGNED_SHORT&&(o=e.RGB16UI),r===e.UNSIGNED_INT&&(o=e.RGB32UI),r===e.BYTE&&(o=e.RGB8I),r===e.SHORT&&(o=e.RGB16I),r===e.INT&&(o=e.RGB32I)),n===e.RGBA_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RGBA8UI),r===e.UNSIGNED_SHORT&&(o=e.RGBA16UI),r===e.UNSIGNED_INT&&(o=e.RGBA32UI),r===e.BYTE&&(o=e.RGBA8I),r===e.SHORT&&(o=e.RGBA16I),r===e.INT&&(o=e.RGBA32I)),n===e.RGB&&r===e.UNSIGNED_INT_5_9_9_9_REV&&(o=e.RGB9_E5),n===e.RGBA){const t=a?Vu:Cp.getTransfer(s);r===e.FLOAT&&(o=e.RGBA32F),r===e.HALF_FLOAT&&(o=e.RGBA16F),r===e.UNSIGNED_BYTE&&(o=t===Gu?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return o!==e.R16F&&o!==e.R32F&&o!==e.RG16F&&o!==e.RG32F&&o!==e.RGBA16F&&o!==e.RGBA32F||t.get("EXT_color_buffer_float"),o}function A(t,i){let n;return t?null===i||i===Ld||i===Ud?n=e.DEPTH24_STENCIL8:i===Od?n=e.DEPTH32F_STENCIL8:i===Rd&&(n=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===i||i===Ld||i===Ud?n=e.DEPTH_COMPONENT24:i===Od?n=e.DEPTH_COMPONENT32F:i===Rd&&(n=e.DEPTH_COMPONENT16),n}function x(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==Sd&&e.minFilter!==Cd?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function w(e){const t=e.target;t.removeEventListener("dispose",w),function(e){const t=n.get(e);if(void 0===t.__webglInit)return;const i=e.source,r=u.get(i);if(r){const n=r[t.__cacheKey];n.usedTimes--,0===n.usedTimes&&_(e),0===Object.keys(r).length&&u.delete(i)}n.remove(e)}(t),t.isVideoTexture&&h.delete(t)}function S(t){const i=t.target;i.removeEventListener("dispose",S),function(t){const i=n.get(t);t.depthTexture&&(t.depthTexture.dispose(),n.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let n=0;n<6;n++){if(Array.isArray(i.__webglFramebuffer[n]))for(let t=0;t<i.__webglFramebuffer[n].length;t++)e.deleteFramebuffer(i.__webglFramebuffer[n][t]);else e.deleteFramebuffer(i.__webglFramebuffer[n]);i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[n])}else{if(Array.isArray(i.__webglFramebuffer))for(let t=0;t<i.__webglFramebuffer.length;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let t=0;t<i.__webglColorRenderbuffer.length;t++)i.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(i.__webglColorRenderbuffer[t]);i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}const r=t.textures;for(let s=0,o=r.length;s<o;s++){const t=n.get(r[s]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),a.memory.textures--),n.remove(r[s])}n.remove(t)}(i)}function _(t){const i=n.get(t);e.deleteTexture(i.__webglTexture);const r=t.source;delete u.get(r)[i.__cacheKey],a.memory.textures--}let E=0;function C(t,r){const s=n.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;h.get(e)!==t&&(h.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void R(s,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+r)}const M={[Ad]:e.REPEAT,[xd]:e.CLAMP_TO_EDGE,[wd]:e.MIRRORED_REPEAT},T={[Sd]:e.NEAREST,[_d]:e.NEAREST_MIPMAP_NEAREST,[Ed]:e.NEAREST_MIPMAP_LINEAR,[Cd]:e.LINEAR,[Md]:e.LINEAR_MIPMAP_NEAREST,[Td]:e.LINEAR_MIPMAP_LINEAR},I={[Wu]:e.NEVER,[Zu]:e.ALWAYS,[Qu]:e.LESS,[Xu]:e.LEQUAL,[qu]:e.EQUAL,[Ju]:e.GEQUAL,[Yu]:e.GREATER,[Ku]:e.NOTEQUAL};function P(i,s){if(s.type!==Od||!1!==t.has("OES_texture_float_linear")||s.magFilter!==Cd&&s.magFilter!==Md&&s.magFilter!==Ed&&s.magFilter!==Td&&s.minFilter!==Cd&&s.minFilter!==Md&&s.minFilter!==Ed&&s.minFilter!==Td||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(i,e.TEXTURE_WRAP_S,M[s.wrapS]),e.texParameteri(i,e.TEXTURE_WRAP_T,M[s.wrapT]),i!==e.TEXTURE_3D&&i!==e.TEXTURE_2D_ARRAY||e.texParameteri(i,e.TEXTURE_WRAP_R,M[s.wrapR]),e.texParameteri(i,e.TEXTURE_MAG_FILTER,T[s.magFilter]),e.texParameteri(i,e.TEXTURE_MIN_FILTER,T[s.minFilter]),s.compareFunction&&(e.texParameteri(i,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(i,e.TEXTURE_COMPARE_FUNC,I[s.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(s.magFilter===Sd)return;if(s.minFilter!==Ed&&s.minFilter!==Td)return;if(s.type===Od&&!1===t.has("OES_texture_float_linear"))return;if(s.anisotropy>1||n.get(s).__currentAnisotropy){const a=t.get("EXT_texture_filter_anisotropic");e.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy}}}function D(t,i){let n=!1;void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",w));const r=i.source;let s=u.get(r);void 0===s&&(s={},u.set(r,s));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(i);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,n=!0),s[o].usedTimes++;const r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&_(i)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return n}function R(t,a,o){let l=e.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),a.isData3DTexture&&(l=e.TEXTURE_3D);const c=D(t,a),h=a.source;i.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const d=n.get(h);if(h.version!==d.__version||!0===c){i.activeTexture(e.TEXTURE0+o);const t=Cp.getPrimaries(Cp.workingColorSpace),n=a.colorSpace===Uu?null:Cp.getPrimaries(a.colorSpace),u=a.colorSpace===Uu||t===n?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,u);let p=m(a.image,!1,r.maxTextureSize);p=j(a,p);const f=s.convert(a.format,a.colorSpace),y=s.convert(a.type);let w,S=b(a.internalFormat,f,y,a.colorSpace,a.isVideoTexture);P(l,a);const _=a.mipmaps,E=!0!==a.isVideoTexture,C=void 0===d.__version||!0===c,M=h.dataReady,T=x(a,p);if(a.isDepthTexture)S=A(a.format===Wd,a.type),C&&(E?i.texStorage2D(e.TEXTURE_2D,1,S,p.width,p.height):i.texImage2D(e.TEXTURE_2D,0,S,p.width,p.height,0,f,y,null));else if(a.isDataTexture)if(_.length>0){E&&C&&i.texStorage2D(e.TEXTURE_2D,T,S,_[0].width,_[0].height);for(let t=0,n=_.length;t<n;t++)w=_[t],E?M&&i.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,f,y,w.data):i.texImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,f,y,w.data);a.generateMipmaps=!1}else E?(C&&i.texStorage2D(e.TEXTURE_2D,T,S,p.width,p.height),M&&i.texSubImage2D(e.TEXTURE_2D,0,0,0,p.width,p.height,f,y,p.data)):i.texImage2D(e.TEXTURE_2D,0,S,p.width,p.height,0,f,y,p.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){E&&C&&i.texStorage3D(e.TEXTURE_2D_ARRAY,T,S,_[0].width,_[0].height,p.depth);for(let t=0,n=_.length;t<n;t++)if(w=_[t],a.format!==Gd)if(null!==f)if(E){if(M)if(a.layerUpdates.size>0){const n=Fy(w.width,w.height,a.format,a.type);for(const r of a.layerUpdates){const s=w.data.subarray(r*n/w.data.BYTES_PER_ELEMENT,(r+1)*n/w.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,r,w.width,w.height,1,f,s)}a.clearLayerUpdates()}else i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,p.depth,f,w.data)}else i.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,S,w.width,w.height,p.depth,0,w.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else E?M&&i.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,p.depth,f,y,w.data):i.texImage3D(e.TEXTURE_2D_ARRAY,t,S,w.width,w.height,p.depth,0,f,y,w.data)}else{E&&C&&i.texStorage2D(e.TEXTURE_2D,T,S,_[0].width,_[0].height);for(let t=0,n=_.length;t<n;t++)w=_[t],a.format!==Gd?null!==f?E?M&&i.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,f,w.data):i.compressedTexImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?M&&i.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,f,y,w.data):i.texImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,f,y,w.data)}else if(a.isDataArrayTexture)if(E){if(C&&i.texStorage3D(e.TEXTURE_2D_ARRAY,T,S,p.width,p.height,p.depth),M)if(a.layerUpdates.size>0){const t=Fy(p.width,p.height,a.format,a.type);for(const n of a.layerUpdates){const r=p.data.subarray(n*t/p.data.BYTES_PER_ELEMENT,(n+1)*t/p.data.BYTES_PER_ELEMENT);i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,n,p.width,p.height,1,f,y,r)}a.clearLayerUpdates()}else i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,y,p.data)}else i.texImage3D(e.TEXTURE_2D_ARRAY,0,S,p.width,p.height,p.depth,0,f,y,p.data);else if(a.isData3DTexture)E?(C&&i.texStorage3D(e.TEXTURE_3D,T,S,p.width,p.height,p.depth),M&&i.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,y,p.data)):i.texImage3D(e.TEXTURE_3D,0,S,p.width,p.height,p.depth,0,f,y,p.data);else if(a.isFramebufferTexture){if(C)if(E)i.texStorage2D(e.TEXTURE_2D,T,S,p.width,p.height);else{let t=p.width,n=p.height;for(let r=0;r<T;r++)i.texImage2D(e.TEXTURE_2D,r,S,t,n,0,f,y,null),t>>=1,n>>=1}}else if(_.length>0){if(E&&C){const t=V(_[0]);i.texStorage2D(e.TEXTURE_2D,T,S,t.width,t.height)}for(let t=0,n=_.length;t<n;t++)w=_[t],E?M&&i.texSubImage2D(e.TEXTURE_2D,t,0,0,f,y,w):i.texImage2D(e.TEXTURE_2D,t,S,f,y,w);a.generateMipmaps=!1}else if(E){if(C){const t=V(p);i.texStorage2D(e.TEXTURE_2D,T,S,t.width,t.height)}M&&i.texSubImage2D(e.TEXTURE_2D,0,0,0,f,y,p)}else i.texImage2D(e.TEXTURE_2D,0,S,f,y,p);g(a)&&v(l),d.__version=h.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}function B(t,r,a,l,c,h){const d=s.convert(a.format,a.colorSpace),u=s.convert(a.type),p=b(a.internalFormat,d,u,a.colorSpace),f=n.get(r),m=n.get(a);if(m.__renderTarget=r,!f.__hasExternalTextures){const t=Math.max(1,r.width>>h),n=Math.max(1,r.height>>h);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?i.texImage3D(c,h,p,t,n,r.depth,0,d,u,null):i.texImage2D(c,h,p,t,n,0,d,u,null)}i.bindFramebuffer(e.FRAMEBUFFER,t),z(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,c,m.__webglTexture,0,U(r)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,c,m.__webglTexture,h),i.bindFramebuffer(e.FRAMEBUFFER,null)}function L(t,i,n){if(e.bindRenderbuffer(e.RENDERBUFFER,t),i.depthBuffer){const r=i.depthTexture,s=r&&r.isDepthTexture?r.type:null,a=A(i.stencilBuffer,s),l=i.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=U(i);z(i)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,a,i.width,i.height):n?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,a,i.width,i.height):e.renderbufferStorage(e.RENDERBUFFER,a,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=i.textures;for(let r=0;r<t.length;r++){const a=t[r],l=s.convert(a.format,a.colorSpace),c=s.convert(a.type),h=b(a.internalFormat,l,c,a.colorSpace),d=U(i);n&&!1===z(i)?e.renderbufferStorageMultisample(e.RENDERBUFFER,d,h,i.width,i.height):z(i)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,d,h,i.width,i.height):e.renderbufferStorage(e.RENDERBUFFER,h,i.width,i.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function O(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const s=n.get(r.depthTexture);s.__renderTarget=r,s.__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),C(r.depthTexture,0);const a=s.__webglTexture,l=U(r);if(r.depthTexture.format===Hd)z(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(r.depthTexture.format!==Wd)throw new Error("Unknown depthTexture format");z(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}function N(t){const r=n.get(t),s=!0===t.isWebGLCubeRenderTarget;if(r.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(r.__depthDisposeCallback&&r.__depthDisposeCallback(),e){const t=()=>{delete r.__boundDepthTexture,delete r.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),r.__depthDisposeCallback=t}r.__boundDepthTexture=e}if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");const e=t.texture.mipmaps;e&&e.length>0?O(r.__webglFramebuffer[0],t):O(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)if(i.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[n]),void 0===r.__webglDepthbuffer[n])r.__webglDepthbuffer[n]=e.createRenderbuffer(),L(r.__webglDepthbuffer[n],t,!1);else{const i=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,s=r.__webglDepthbuffer[n];e.bindRenderbuffer(e.RENDERBUFFER,s),e.framebufferRenderbuffer(e.FRAMEBUFFER,i,e.RENDERBUFFER,s)}}else{const n=t.texture.mipmaps;if(n&&n.length>0?i.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[0]):i.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),void 0===r.__webglDepthbuffer)r.__webglDepthbuffer=e.createRenderbuffer(),L(r.__webglDepthbuffer,t,!1);else{const i=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,n=r.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,n),e.framebufferRenderbuffer(e.FRAMEBUFFER,i,e.RENDERBUFFER,n)}}i.bindFramebuffer(e.FRAMEBUFFER,null)}const k=[],F=[];function U(e){return Math.min(r.maxSamples,e.samples)}function z(e){const i=n.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function j(e,t){const i=e.colorSpace,n=e.format,r=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||i!==ju&&i!==Uu&&(Cp.getTransfer(i)===Gu?n===Gd&&r===Id||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),t}function V(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!==typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){const e=E;return e>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),E+=1,e},this.resetTextureUnits=function(){E=0},this.setTexture2D=C,this.setTexture2DArray=function(t,r){const s=n.get(t);t.version>0&&s.__version!==t.version?R(s,t,r):i.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const s=n.get(t);t.version>0&&s.__version!==t.version?R(s,t,r):i.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,a){const o=n.get(t);t.version>0&&o.__version!==t.version?function(t,a,o){if(6!==a.image.length)return;const l=D(t,a),c=a.source;i.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const h=n.get(c);if(c.version!==h.__version||!0===l){i.activeTexture(e.TEXTURE0+o);const t=Cp.getPrimaries(Cp.workingColorSpace),n=a.colorSpace===Uu?null:Cp.getPrimaries(a.colorSpace),d=a.colorSpace===Uu||t===n?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const u=a.isCompressedTexture||a.image[0].isCompressedTexture,p=a.image[0]&&a.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=u||p?p?a.image[e].image:a.image[e]:m(a.image[e],!0,r.maxCubemapSize),f[e]=j(a,f[e]);const y=f[0],A=s.convert(a.format,a.colorSpace),w=s.convert(a.type),S=b(a.internalFormat,A,w,a.colorSpace),_=!0!==a.isVideoTexture,E=void 0===h.__version||!0===l,C=c.dataReady;let M,T=x(a,y);if(P(e.TEXTURE_CUBE_MAP,a),u){_&&E&&i.texStorage2D(e.TEXTURE_CUBE_MAP,T,S,y.width,y.height);for(let t=0;t<6;t++){M=f[t].mipmaps;for(let n=0;n<M.length;n++){const r=M[n];a.format!==Gd?null!==A?_?C&&i.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,0,0,r.width,r.height,A,r.data):i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,S,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_?C&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,0,0,r.width,r.height,A,w,r.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n,S,r.width,r.height,0,A,w,r.data)}}}else{if(M=a.mipmaps,_&&E){M.length>0&&T++;const t=V(f[0]);i.texStorage2D(e.TEXTURE_CUBE_MAP,T,S,t.width,t.height)}for(let t=0;t<6;t++)if(p){_?C&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,A,w,f[t].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S,f[t].width,f[t].height,0,A,w,f[t].data);for(let n=0;n<M.length;n++){const r=M[n].image[t].image;_?C&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,0,0,r.width,r.height,A,w,r.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,S,r.width,r.height,0,A,w,r.data)}}else{_?C&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,A,w,f[t]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S,A,w,f[t]);for(let n=0;n<M.length;n++){const r=M[n];_?C&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,0,0,A,w,r.image[t]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,n+1,S,A,w,r.image[t])}}}g(a)&&v(e.TEXTURE_CUBE_MAP),h.__version=c.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}(o,t,a):i.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+a)},this.rebindTextures=function(t,i,r){const s=n.get(t);void 0!==i&&B(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&N(t)},this.setupRenderTarget=function(t){const r=t.texture,o=n.get(t),l=n.get(r);t.addEventListener("dispose",S);const c=t.textures,h=!0===t.isWebGLCubeRenderTarget,d=c.length>1;if(d||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=r.version,a.memory.textures++),h){o.__webglFramebuffer=[];for(let t=0;t<6;t++)if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer[t]=[];for(let i=0;i<r.mipmaps.length;i++)o.__webglFramebuffer[t][i]=e.createFramebuffer()}else o.__webglFramebuffer[t]=e.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer=[];for(let t=0;t<r.mipmaps.length;t++)o.__webglFramebuffer[t]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(d)for(let t=0,i=c.length;t<i;t++){const i=n.get(c[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),a.memory.textures++)}if(t.samples>0&&!1===z(t)){o.__webglMultisampledFramebuffer=e.createFramebuffer(),o.__webglColorRenderbuffer=[],i.bindFramebuffer(e.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let i=0;i<c.length;i++){const n=c[i];o.__webglColorRenderbuffer[i]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o.__webglColorRenderbuffer[i]);const r=s.convert(n.format,n.colorSpace),a=s.convert(n.type),l=b(n.internalFormat,r,a,n.colorSpace,!0===t.isXRRenderTarget),h=U(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,h,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.RENDERBUFFER,o.__webglColorRenderbuffer[i])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(o.__webglDepthRenderbuffer=e.createRenderbuffer(),L(o.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(e.FRAMEBUFFER,null)}}if(h){i.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),P(e.TEXTURE_CUBE_MAP,r);for(let i=0;i<6;i++)if(r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)B(o.__webglFramebuffer[i][n],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+i,n);else B(o.__webglFramebuffer[i],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0);g(r)&&v(e.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(d){for(let r=0,s=c.length;r<s;r++){const s=c[r],a=n.get(s);i.bindTexture(e.TEXTURE_2D,a.__webglTexture),P(e.TEXTURE_2D,s),B(o.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+r,e.TEXTURE_2D,0),g(s)&&v(e.TEXTURE_2D)}i.unbindTexture()}else{let n=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(n=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),i.bindTexture(n,l.__webglTexture),P(n,r),r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)B(o.__webglFramebuffer[i],t,r,e.COLOR_ATTACHMENT0,n,i);else B(o.__webglFramebuffer,t,r,e.COLOR_ATTACHMENT0,n,0);g(r)&&v(n),i.unbindTexture()}t.depthBuffer&&N(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let r=0,s=t.length;r<s;r++){const s=t[r];if(g(s)){const t=y(e),r=n.get(s).__webglTexture;i.bindTexture(t,r),v(t),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===z(t)){const r=t.textures,s=t.width,a=t.height;let o=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,h=n.get(t),d=r.length>1;if(d)for(let t=0;t<r.length;t++)i.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),i.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);i.bindFramebuffer(e.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer);const u=t.texture.mipmaps;u&&u.length>0?i.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglFramebuffer[0]):i.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let i=0;i<r.length;i++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),d){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,h.__webglColorRenderbuffer[i]);const t=n.get(r[i]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,a,0,0,s,a,o,e.NEAREST),!0===l&&(k.length=0,F.length=0,k.push(e.COLOR_ATTACHMENT0+i),t.depthBuffer&&!1===t.resolveDepthBuffer&&(k.push(c),F.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,F)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,k))}if(i.bindFramebuffer(e.READ_FRAMEBUFFER,null),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<r.length;t++){i.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,h.__webglColorRenderbuffer[t]);const s=n.get(r[t]).__webglTexture;i.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}i.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const i=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[i])}},this.setupDepthRenderbuffer=N,this.setupFrameBufferTexture=B,this.useMultisampledRTT=z}function HE(e,t){return{convert:function(i){let n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Uu;const s=Cp.getTransfer(r);if(i===Id)return e.UNSIGNED_BYTE;if(i===kd)return e.UNSIGNED_SHORT_4_4_4_4;if(i===Fd)return e.UNSIGNED_SHORT_5_5_5_1;if(i===zd)return e.UNSIGNED_INT_5_9_9_9_REV;if(i===Pd)return e.BYTE;if(i===Dd)return e.SHORT;if(i===Rd)return e.UNSIGNED_SHORT;if(i===Bd)return e.INT;if(i===Ld)return e.UNSIGNED_INT;if(i===Od)return e.FLOAT;if(i===Nd)return e.HALF_FLOAT;if(i===jd)return e.ALPHA;if(i===Vd)return e.RGB;if(i===Gd)return e.RGBA;if(i===Hd)return e.DEPTH_COMPONENT;if(i===Wd)return e.DEPTH_STENCIL;if(i===Qd)return e.RED;if(i===qd)return e.RED_INTEGER;if(i===Xd)return e.RG;if(i===Yd)return e.RG_INTEGER;if(i===Kd)return e.RGBA_INTEGER;if(i===Jd||i===Zd||i===$d||i===eu)if(s===Gu){if(n=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===n)return null;if(i===Jd)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Zd)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===$d)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===eu)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(i===Jd)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Zd)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===$d)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===eu)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===tu||i===iu||i===nu||i===ru){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(i===tu)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===iu)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===nu)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===ru)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===su||i===au||i===ou){if(n=t.get("WEBGL_compressed_texture_etc"),null===n)return null;if(i===su||i===au)return s===Gu?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(i===ou)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}if(i===lu||i===cu||i===hu||i===du||i===uu||i===pu||i===fu||i===mu||i===gu||i===vu||i===yu||i===bu||i===Au||i===xu){if(n=t.get("WEBGL_compressed_texture_astc"),null===n)return null;if(i===lu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===cu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===hu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===du)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===uu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===pu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===fu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===mu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===gu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===vu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===yu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===bu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Au)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===xu)return s===Gu?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===wu||i===Su||i===_u){if(n=t.get("EXT_texture_compression_bptc"),null===n)return null;if(i===wu)return s===Gu?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===Su)return n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===_u)return n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(i===Eu||i===Cu||i===Mu||i===Tu){if(n=t.get("EXT_texture_compression_rgtc"),null===n)return null;if(i===wu)return n.COMPRESSED_RED_RGTC1_EXT;if(i===Cu)return n.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Mu)return n.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===Tu)return n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===Ud?e.UNSIGNED_INT_24_8:void 0!==e[i]?e[i]:null}}}class WE{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(null===this.texture){const n=new Op;e.properties.get(n).__webglTexture=t.texture,t.depthNear===i.depthNear&&t.depthFar===i.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=n}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,i=new eg({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new qm(new xv(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class QE extends np{constructor(e,t){super();const i=this;let n=null,r=1,s=null,a="local-floor",o=1,l=null,c=null,h=null,d=null,u=null,p=null;const f=new WE,m=t.getContextAttributes();let g=null,v=null;const y=[],b=[],A=new mp;let x=null;const w=new sg;w.viewport=new Np;const S=new sg;S.viewport=new Np;const _=[w,S],E=new wy;let C=null,M=null;function T(e){const t=b.indexOf(e.inputSource);if(-1===t)return;const i=y[t];void 0!==i&&(i.update(e.inputSource,e.frame,l||s),i.dispatchEvent({type:e.type,data:e.inputSource}))}function I(){n.removeEventListener("select",T),n.removeEventListener("selectstart",T),n.removeEventListener("selectend",T),n.removeEventListener("squeeze",T),n.removeEventListener("squeezestart",T),n.removeEventListener("squeezeend",T),n.removeEventListener("end",I),n.removeEventListener("inputsourceschange",P);for(let e=0;e<y.length;e++){const t=b[e];null!==t&&(b[e]=null,y[e].disconnect(t))}C=null,M=null,f.reset(),e.setRenderTarget(g),u=null,d=null,h=null,n=null,v=null,O.stop(),i.isPresenting=!1,e.setPixelRatio(x),e.setSize(A.width,A.height,!1),i.dispatchEvent({type:"sessionend"})}function P(e){for(let t=0;t<e.removed.length;t++){const i=e.removed[t],n=b.indexOf(i);n>=0&&(b[n]=null,y[n].disconnect(i))}for(let t=0;t<e.added.length;t++){const i=e.added[t];let n=b.indexOf(i);if(-1===n){for(let e=0;e<y.length;e++){if(e>=b.length){b.push(i),n=e;break}if(null===b[e]){b[e]=i,n=e;break}}if(-1===n)break}const r=y[n];r&&r.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=y[e];return void 0===t&&(t=new ug,y[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=y[e];return void 0===t&&(t=new ug,y[e]=t),t.getGripSpace()},this.getHand=function(e){let t=y[e];return void 0===t&&(t=new ug,y[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:u},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(c){if(n=c,null!==n){g=e.getRenderTarget(),n.addEventListener("select",T),n.addEventListener("selectstart",T),n.addEventListener("selectend",T),n.addEventListener("squeeze",T),n.addEventListener("squeezestart",T),n.addEventListener("squeezeend",T),n.addEventListener("end",I),n.addEventListener("inputsourceschange",P),!0!==m.xrCompatible&&await t.makeXRCompatible(),x=e.getPixelRatio(),e.getSize(A);if("undefined"!==typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype){let i=null,s=null,a=null;m.depth&&(a=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,i=m.stencil?Wd:Hd,s=m.stencil?Ud:Ld);const o={colorFormat:t.RGBA8,depthFormat:a,scaleFactor:r};h=new XRWebGLBinding(n,t),d=h.createProjectionLayer(o),n.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),v=new Fp(d.textureWidth,d.textureHeight,{format:Gd,type:Id,depthTexture:new Av(d.textureWidth,d.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}else{const i={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(n,t,i),n.updateRenderState({baseLayer:u}),e.setPixelRatio(1),e.setSize(u.framebufferWidth,u.framebufferHeight,!1),v=new Fp(u.framebufferWidth,u.framebufferHeight,{format:Gd,type:Id,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil,resolveDepthBuffer:!1===u.ignoreDepthValues,resolveStencilBuffer:!1===u.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await n.requestReferenceSpace(a),O.setContext(n),O.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==n)return n.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const D=new Vp,R=new Vp;function B(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===n)return;let t=e.near,i=e.far;null!==f.texture&&(f.depthNear>0&&(t=f.depthNear),f.depthFar>0&&(i=f.depthFar)),E.near=S.near=w.near=t,E.far=S.far=w.far=i,C===E.near&&M===E.far||(n.updateRenderState({depthNear:E.near,depthFar:E.far}),C=E.near,M=E.far),w.layers.mask=2|e.layers.mask,S.layers.mask=4|e.layers.mask,E.layers.mask=w.layers.mask|S.layers.mask;const r=e.parent,s=E.cameras;B(E,r);for(let n=0;n<s.length;n++)B(s[n],r);2===s.length?function(e,t,i){D.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(i.matrixWorld);const n=D.distanceTo(R),r=t.projectionMatrix.elements,s=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],d=(s[8]+1)/s[0],u=a*h,p=a*d,f=n/(-h+d),m=f*-h;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===r[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=a+f,i=o+f,r=u-m,s=p+(n-m),h=l*o/i*t,d=c*o/i*t;e.projectionMatrix.makePerspective(r,s,h,d,t,i),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(E,w,S):E.projectionMatrix.copy(w.projectionMatrix),function(e,t,i){null===i?e.matrix.copy(t.matrixWorld):(e.matrix.copy(i.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*op*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,E,r)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==d||null!==u)return o},this.setFoveation=function(e){o=e,null!==d&&(d.fixedFoveation=e),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(E)};let L=null;const O=new fS;O.setAnimationLoop((function(t,r){if(c=r.getViewerPose(l||s),p=r,null!==c){const t=c.views;null!==u&&(e.setRenderTargetFramebuffer(v,u.framebuffer),e.setRenderTarget(v));let i=!1;t.length!==E.cameras.length&&(E.cameras.length=0,i=!0);for(let n=0;n<t.length;n++){const r=t[n];let s=null;if(null!==u)s=u.getViewport(r);else{const t=h.getViewSubImage(d,r);s=t.viewport,0===n&&(e.setRenderTargetTextures(v,t.colorTexture,t.depthStencilTexture),e.setRenderTarget(v))}let a=_[n];void 0===a&&(a=new sg,a.layers.enable(n),a.viewport=new Np,_[n]=a),a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(r.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===n&&(E.matrix.copy(a.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),!0===i&&E.cameras.push(a)}const r=n.enabledFeatures;if(r&&r.includes("depth-sensing")&&"gpu-optimized"==n.depthUsage&&h){const i=h.getDepthInformation(t[0]);i&&i.isValid&&i.texture&&f.init(e,i,n.renderState)}}for(let e=0;e<y.length;e++){const t=b[e],i=y[e];null!==t&&void 0!==i&&i.update(t,r,l||s)}L&&L(t,r),r.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:r}),p=null})),this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}}const qE=new If,XE=new bf;function YE(e,t){function i(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function n(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map,i(n.map,e.mapTransform)),n.alphaMap&&(e.alphaMap.value=n.alphaMap,i(n.alphaMap,e.alphaMapTransform)),n.bumpMap&&(e.bumpMap.value=n.bumpMap,i(n.bumpMap,e.bumpMapTransform),e.bumpScale.value=n.bumpScale,n.side===Th&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,i(n.normalMap,e.normalMapTransform),e.normalScale.value.copy(n.normalScale),n.side===Th&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,i(n.displacementMap,e.displacementMapTransform),e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap,i(n.emissiveMap,e.emissiveMapTransform)),n.specularMap&&(e.specularMap.value=n.specularMap,i(n.specularMap,e.specularMapTransform)),n.alphaTest>0&&(e.alphaTest.value=n.alphaTest);const r=t.get(n),s=r.envMap,a=r.envMapRotation;s&&(e.envMap.value=s,qE.copy(a),qE.x*=-1,qE.y*=-1,qE.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(qE.y*=-1,qE.z*=-1),e.envMapRotation.value.setFromMatrix4(XE.makeRotationFromEuler(qE)),e.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,e.reflectivity.value=n.reflectivity,e.ior.value=n.ior,e.refractionRatio.value=n.refractionRatio),n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity,i(n.lightMap,e.lightMapTransform)),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity,i(n.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,i){i.color.getRGB(t.fogColor.value,Zm(e)),i.isFog?(t.fogNear.value=i.near,t.fogFar.value=i.far):i.isFogExp2&&(t.fogDensity.value=i.density)},refreshMaterialUniforms:function(e,r,s,a,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?n(e,r):r.isMeshToonMaterial?(n(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(n(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(n(e,r),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,i(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,i(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,i(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,i(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,i(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,i(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,i(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===Th&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,i(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,i(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,i(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,i(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,i(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,i(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,i(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,o)):r.isMeshMatcapMaterial?(n(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?n(e,r):r.isMeshDistanceMaterial?(n(e,r),function(e,i){const n=t.get(i).light;e.referencePosition.value.setFromMatrixPosition(n.matrixWorld),e.nearDistance.value=n.shadow.camera.near,e.farDistance.value=n.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?n(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,i(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map,i(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,i(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,s,a):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,i(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,i(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function KE(e,t,i,n){let r={},s={},a=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,i,n){const r=e.value,s=t+"_"+i;if(void 0===n[s])return n[s]="number"===typeof r||"boolean"===typeof r?r:r.clone(),!0;{const e=n[s];if("number"===typeof r||"boolean"===typeof r){if(e!==r)return n[s]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"===typeof e||"boolean"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function h(t){const i=t.target;i.removeEventListener("dispose",h);const n=a.indexOf(i.__bindingPointIndex);a.splice(n,1),e.deleteBuffer(r[i.id]),delete r[i.id],delete s[i.id]}return{bind:function(e,t){const i=t.program;n.uniformBlockBinding(e,i)},update:function(i,d){let u=r[i.id];void 0===u&&(!function(e){const t=e.uniforms;let i=0;const n=16;for(let s=0,a=t.length;s<a;s++){const e=Array.isArray(t[s])?t[s]:[t[s]];for(let t=0,r=e.length;t<r;t++){const r=e[t],s=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=s.length;e<t;e++){const t=c(s[e]),a=i%n,o=a%t.boundary,l=a+o;i+=o,0!==l&&n-l<t.storage&&(i+=n-l),r.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=i,i+=t.storage}}}const r=i%n;r>0&&(i+=n-r);e.__size=i,e.__cache={}}(i),u=function(t){const i=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=i;const n=e.createBuffer(),r=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,n),e.bufferData(e.UNIFORM_BUFFER,r,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,i,n),n}(i),r[i.id]=u,i.addEventListener("dispose",h));const p=d.program;n.updateUBOMapping(i,p);const f=t.render.frame;s[i.id]!==f&&(!function(t){const i=r[t.id],n=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,i);for(let r=0,a=n.length;r<a;r++){const t=Array.isArray(n[r])?n[r]:[n[r]];for(let i=0,n=t.length;i<n;i++){const n=t[i];if(!0===l(n,r,i,s)){const t=n.__offset,i=Array.isArray(n.value)?n.value:[n.value];let r=0;for(let s=0;s<i.length;s++){const a=i[s],o=c(a);"number"===typeof a||"boolean"===typeof a?(n.__data[0]=a,e.bufferSubData(e.UNIFORM_BUFFER,t+r,n.__data)):a.isMatrix3?(n.__data[0]=a.elements[0],n.__data[1]=a.elements[1],n.__data[2]=a.elements[2],n.__data[3]=0,n.__data[4]=a.elements[3],n.__data[5]=a.elements[4],n.__data[6]=a.elements[5],n.__data[7]=0,n.__data[8]=a.elements[6],n.__data[9]=a.elements[7],n.__data[10]=a.elements[8],n.__data[11]=0):(a.toArray(n.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,n.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(i),s[i.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);a=[],r={},s={}}}}class JE{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:t=Ap(),context:i=null,depth:n=!0,stencil:r=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:d=!1}=e;let u;if(this.isWebGLRenderer=!0,null!==i){if("undefined"!==typeof WebGLRenderingContext&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");u=i.getContextAttributes().alpha}else u=s;const p=new Uint32Array(4),f=new Int32Array(4);let m=null,g=null;const v=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=sd,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const b=this;let A=!1;this._outputColorSpace=zu;let x=0,w=0,S=null,_=-1,E=null;const C=new Np,M=new Np;let T=null;const I=new dm(0);let P=0,D=t.width,R=t.height,B=1,L=null,O=null;const N=new Np(0,0,D,R),k=new Np(0,0,D,R);let F=!1;const U=new qg;let z=!1,j=!1;const V=new bf,G=new bf,H=new Vp,W=new Np,Q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let q=!1;function X(){return null===S?B:1}let Y,K,J,Z,$,ee,te,ie,ne,re,se,ae,oe,le,ce,he,de,ue,pe,fe,me,ge,ve,ye,be=i;function Ae(e,i){return t.getContext(e,i)}try{const e={alpha:!0,depth:n,stencil:r,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Sh}`),t.addEventListener("webglcontextlost",Se,!1),t.addEventListener("webglcontextrestored",_e,!1),t.addEventListener("webglcontextcreationerror",Ee,!1),null===be){const t="webgl2";if(be=Ae(t,e),null===be)throw Ae(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Ge){throw console.error("THREE.WebGLRenderer: "+Ge.message),Ge}function xe(){Y=new qS(be),Y.init(),ge=new HE(be,Y),K=new ES(be,Y,e,ge),J=new VE(be,Y),K.reverseDepthBuffer&&d&&J.buffers.depth.setReversed(!0),Z=new KS(be),$=new IE,ee=new GE(be,Y,J,$,K,ge,Z),te=new MS(b),ie=new QS(b),ne=new mS(be),ve=new SS(be,ne),re=new XS(be,ne,Z,ve),se=new ZS(be,re,ne,Z),pe=new JS(be,K,ee),he=new CS($),ae=new TE(b,te,ie,Y,K,ve,he),oe=new YE(b,$),le=new BE,ce=new UE(Y),ue=new wS(b,te,ie,J,se,u,o),de=new zE(b,se,K),ye=new KE(be,Z,K,J),fe=new _S(be,Y,Z),me=new YS(be,Y,Z),Z.programs=ae.programs,b.capabilities=K,b.extensions=Y,b.properties=$,b.renderLists=le,b.shadowMap=de,b.state=J,b.info=Z}xe();const we=new QE(b,be);function Se(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),A=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),A=!1;const e=Z.autoReset,t=de.enabled,i=de.autoUpdate,n=de.needsUpdate,r=de.type;xe(),Z.autoReset=e,de.enabled=t,de.autoUpdate=i,de.needsUpdate=n,de.type=r}function Ee(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ce(e){const t=e.target;t.removeEventListener("dispose",Ce),function(e){(function(e){const t=$.get(e).programs;void 0!==t&&(t.forEach((function(e){ae.releaseProgram(e)})),e.isShaderMaterial&&ae.releaseShaderCache(e))})(e),$.remove(e)}(t)}function Me(e,t,i){!0===e.transparent&&e.side===Ih&&!1===e.forceSinglePass?(e.side=Th,e.needsUpdate=!0,ke(e,t,i),e.side=Mh,e.needsUpdate=!0,ke(e,t,i),e.side=Ih):ke(e,t,i)}this.xr=we,this.getContext=function(){return be},this.getContextAttributes=function(){return be.getContextAttributes()},this.forceContextLoss=function(){const e=Y.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Y.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(e){void 0!==e&&(B=e,this.setSize(D,R,!1))},this.getSize=function(e){return e.set(D,R)},this.setSize=function(e,i){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];we.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(D=e,R=i,t.width=Math.floor(e*B),t.height=Math.floor(i*B),!0===n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return e.set(D*B,R*B).floor()},this.setDrawingBufferSize=function(e,i,n){D=e,R=i,B=n,t.width=Math.floor(e*n),t.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return e.copy(C)},this.getViewport=function(e){return e.copy(N)},this.setViewport=function(e,t,i,n){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,i,n),J.viewport(C.copy(N).multiplyScalar(B).round())},this.getScissor=function(e){return e.copy(k)},this.setScissor=function(e,t,i,n){e.isVector4?k.set(e.x,e.y,e.z,e.w):k.set(e,t,i,n),J.scissor(M.copy(k).multiplyScalar(B).round())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){J.setScissorTest(F=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){O=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor(...arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha(...arguments)},this.clear=function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let e=!1;if(null!==S){const t=S.texture.format;e=t===Kd||t===Yd||t===qd}if(e){const e=S.texture.type,t=e===Id||e===Ld||e===Rd||e===Ud||e===kd||e===Fd,i=ue.getClearColor(),n=ue.getClearAlpha(),r=i.r,s=i.g,a=i.b;t?(p[0]=r,p[1]=s,p[2]=a,p[3]=n,be.clearBufferuiv(be.COLOR,0,p)):(f[0]=r,f[1]=s,f[2]=a,f[3]=n,be.clearBufferiv(be.COLOR,0,f))}else i|=be.COLOR_BUFFER_BIT}e&&(i|=be.DEPTH_BUFFER_BIT),t&&(i|=be.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),be.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Se,!1),t.removeEventListener("webglcontextrestored",_e,!1),t.removeEventListener("webglcontextcreationerror",Ee,!1),ue.dispose(),le.dispose(),ce.dispose(),$.dispose(),te.dispose(),ie.dispose(),se.dispose(),ve.dispose(),ye.dispose(),ae.dispose(),we.dispose(),we.removeEventListener("sessionstart",Ie),we.removeEventListener("sessionend",Pe),De.stop()},this.renderBufferDirect=function(e,t,i,n,r,s){null===t&&(t=Q);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(e,t,i,n,r){!0!==t.isScene&&(t=Q);ee.resetTextureUnits();const s=t.fog,a=n.isMeshStandardMaterial?t.environment:null,o=null===S?b.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:ju,l=(n.isMeshStandardMaterial?ie:te).get(n.envMap||a),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!i.attributes.tangent&&(!!n.normalMap||n.anisotropy>0),d=!!i.morphAttributes.position,u=!!i.morphAttributes.normal,p=!!i.morphAttributes.color;let f=sd;n.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(f=b.toneMapping));const m=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,v=void 0!==m?m.length:0,y=$.get(n),A=g.state.lights;if(!0===z&&(!0===j||e!==E)){const t=e===E&&n.id===_;he.setState(n,e,t)}let x=!1;n.version===y.__version?y.needsLights&&y.lightsStateVersion!==A.state.version||y.outputColorSpace!==o||r.isBatchedMesh&&!1===y.batching?x=!0:r.isBatchedMesh||!0!==y.batching?r.isBatchedMesh&&!0===y.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===y.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===y.instancing?x=!0:r.isInstancedMesh||!0!==y.instancing?r.isSkinnedMesh&&!1===y.skinning?x=!0:r.isSkinnedMesh||!0!==y.skinning?r.isInstancedMesh&&!0===y.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===y.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===y.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===y.instancingMorph&&null!==r.morphTexture||y.envMap!==l||!0===n.fog&&y.fog!==s?x=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===he.numPlanes&&y.numIntersection===he.numIntersection?(y.vertexAlphas!==c||y.vertexTangents!==h||y.morphTargets!==d||y.morphNormals!==u||y.morphColors!==p||y.toneMapping!==f||y.morphTargetsCount!==v)&&(x=!0):x=!0:x=!0:x=!0:x=!0:(x=!0,y.__version=n.version);let w=y.currentProgram;!0===x&&(w=ke(n,t,r));let C=!1,M=!1,T=!1;const I=w.getUniforms(),P=y.uniforms;J.useProgram(w.program)&&(C=!0,M=!0,T=!0);n.id!==_&&(_=n.id,M=!0);if(C||E!==e){J.buffers.depth.getReversed()?(V.copy(e.projectionMatrix),function(e){const t=e.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}(V),function(e){const t=e.elements;-1===t[11]?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=1-t[14])}(V),I.setValue(be,"projectionMatrix",V)):I.setValue(be,"projectionMatrix",e.projectionMatrix),I.setValue(be,"viewMatrix",e.matrixWorldInverse);const t=I.map.cameraPosition;void 0!==t&&t.setValue(be,H.setFromMatrixPosition(e.matrixWorld)),K.logarithmicDepthBuffer&&I.setValue(be,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&I.setValue(be,"isOrthographic",!0===e.isOrthographicCamera),E!==e&&(E=e,M=!0,T=!0)}if(r.isSkinnedMesh){I.setOptional(be,r,"bindMatrix"),I.setOptional(be,r,"bindMatrixInverse");const e=r.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),I.setValue(be,"boneTexture",e.boneTexture,ee))}r.isBatchedMesh&&(I.setOptional(be,r,"batchingTexture"),I.setValue(be,"batchingTexture",r._matricesTexture,ee),I.setOptional(be,r,"batchingIdTexture"),I.setValue(be,"batchingIdTexture",r._indirectTexture,ee),I.setOptional(be,r,"batchingColorTexture"),null!==r._colorsTexture&&I.setValue(be,"batchingColorTexture",r._colorsTexture,ee));const D=i.morphAttributes;void 0===D.position&&void 0===D.normal&&void 0===D.color||pe.update(r,i,w);(M||y.receiveShadow!==r.receiveShadow)&&(y.receiveShadow=r.receiveShadow,I.setValue(be,"receiveShadow",r.receiveShadow));n.isMeshGouraudMaterial&&null!==n.envMap&&(P.envMap.value=l,P.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);n.isMeshStandardMaterial&&null===n.envMap&&null!==t.environment&&(P.envMapIntensity.value=t.environmentIntensity);M&&(I.setValue(be,"toneMappingExposure",b.toneMappingExposure),y.needsLights&&(O=T,(L=P).ambientLightColor.needsUpdate=O,L.lightProbe.needsUpdate=O,L.directionalLights.needsUpdate=O,L.directionalLightShadows.needsUpdate=O,L.pointLights.needsUpdate=O,L.pointLightShadows.needsUpdate=O,L.spotLights.needsUpdate=O,L.spotLightShadows.needsUpdate=O,L.rectAreaLights.needsUpdate=O,L.hemisphereLights.needsUpdate=O),s&&!0===n.fog&&oe.refreshFogUniforms(P,s),oe.refreshMaterialUniforms(P,n,B,R,g.state.transmissionRenderTarget[e.id]),nE.upload(be,Fe(y),P,ee));var L,O;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(nE.upload(be,Fe(y),P,ee),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&I.setValue(be,"center",r.center);if(I.setValue(be,"modelViewMatrix",r.modelViewMatrix),I.setValue(be,"normalMatrix",r.normalMatrix),I.setValue(be,"modelMatrix",r.matrixWorld),n.isShaderMaterial||n.isRawShaderMaterial){const e=n.uniformsGroups;for(let t=0,i=e.length;t<i;t++){const i=e[t];ye.update(i,w),ye.bind(i,w)}}return w}(e,t,i,n,r);J.setMaterial(n,a);let l=i.index,c=1;if(!0===n.wireframe){if(l=re.getWireframeAttribute(i),void 0===l)return;c=2}const h=i.drawRange,d=i.attributes.position;let u=h.start*c,p=(h.start+h.count)*c;null!==s&&(u=Math.max(u,s.start*c),p=Math.min(p,(s.start+s.count)*c)),null!==l?(u=Math.max(u,0),p=Math.min(p,l.count)):void 0!==d&&null!==d&&(u=Math.max(u,0),p=Math.min(p,d.count));const f=p-u;if(f<0||f===1/0)return;let m;ve.setup(r,n,o,i,l);let v=fe;if(null!==l&&(m=ne.get(l),v=me,v.setIndex(m)),r.isMesh)!0===n.wireframe?(J.setLineWidth(n.wireframeLinewidth*X()),v.setMode(be.LINES)):v.setMode(be.TRIANGLES);else if(r.isLine){let e=n.linewidth;void 0===e&&(e=1),J.setLineWidth(e*X()),r.isLineSegments?v.setMode(be.LINES):r.isLineLoop?v.setMode(be.LINE_LOOP):v.setMode(be.LINE_STRIP)}else r.isPoints?v.setMode(be.POINTS):r.isSprite&&v.setMode(be.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)wp("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if(Y.get("WEBGL_multi_draw"))v.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const e=r._multiDrawStarts,t=r._multiDrawCounts,i=r._multiDrawCount,s=l?ne.get(l).bytesPerElement:1,a=$.get(n).currentProgram.getUniforms();for(let n=0;n<i;n++)a.setValue(be,"_gl_DrawID",n),v.render(e[n]/s,t[n])}else if(r.isInstancedMesh)v.renderInstances(u,f,r.count);else if(i.isInstancedBufferGeometry){const e=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,t=Math.min(i.instanceCount,e);v.renderInstances(u,f,t)}else v.render(u,f)},this.compile=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===i&&(i=e),g=ce.get(i),g.init(t),y.push(g),i.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),e!==i&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),g.setupLights();const n=new Set;return e.traverse((function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const s=t[r];Me(s,i,e),n.add(s)}else Me(t,i,e),n.add(t)})),g=y.pop(),n},this.compileAsync=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=this.compile(e,t,i);return new Promise((t=>{function i(){n.forEach((function(e){$.get(e).currentProgram.isReady()&&n.delete(e)})),0!==n.size?setTimeout(i,10):t(e)}null!==Y.get("KHR_parallel_shader_compile")?i():setTimeout(i,10)}))};let Te=null;function Ie(){De.stop()}function Pe(){De.start()}const De=new fS;function Re(e,t,i,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)g.pushLight(e),e.castShadow&&g.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){n&&W.setFromMatrixPosition(e.matrixWorld).applyMatrix4(G);const t=se.update(e),r=e.material;r.visible&&m.push(e,t,r,i,W.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||U.intersectsObject(e))){const t=se.update(e),r=e.material;if(n&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),W.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),W.copy(t.boundingSphere.center)),W.applyMatrix4(e.matrixWorld).applyMatrix4(G)),Array.isArray(r)){const n=t.groups;for(let s=0,a=n.length;s<a;s++){const a=n[s],o=r[a.materialIndex];o&&o.visible&&m.push(e,t,o,i,W.z,a)}}else r.visible&&m.push(e,t,r,i,W.z,null)}const r=e.children;for(let s=0,a=r.length;s<a;s++)Re(r[s],t,i,n)}function Be(e,t,i,n){const r=e.opaque,s=e.transmissive,a=e.transparent;g.setupLightsView(i),!0===z&&he.setGlobalState(b.clippingPlanes,i),n&&J.viewport(C.copy(n)),r.length>0&&Oe(r,t,i),s.length>0&&Oe(s,t,i),a.length>0&&Oe(a,t,i),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1)}function Le(e,t,i,n){if(null!==(!0===i.isScene?i.overrideMaterial:null))return;void 0===g.state.transmissionRenderTarget[n.id]&&(g.state.transmissionRenderTarget[n.id]=new Fp(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")||Y.has("EXT_color_buffer_float")?Nd:Id,minFilter:Td,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Cp.workingColorSpace}));const s=g.state.transmissionRenderTarget[n.id],a=n.viewport||C;s.setSize(a.z*b.transmissionResolutionScale,a.w*b.transmissionResolutionScale);const o=b.getRenderTarget();b.setRenderTarget(s),b.getClearColor(I),P=b.getClearAlpha(),P<1&&b.setClearColor(16777215,.5),b.clear(),q&&ue.render(i);const l=b.toneMapping;b.toneMapping=sd;const c=n.viewport;if(void 0!==n.viewport&&(n.viewport=void 0),g.setupLightsView(n),!0===z&&he.setGlobalState(b.clippingPlanes,n),Oe(e,i,n),ee.updateMultisampleRenderTarget(s),ee.updateRenderTargetMipmap(s),!1===Y.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=s.material,c=s.group;if(l.side===Ih&&a.layers.test(n.layers)){const t=l.side;l.side=Th,l.needsUpdate=!0,Ne(a,i,n,o,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(ee.updateMultisampleRenderTarget(s),ee.updateRenderTargetMipmap(s))}b.setRenderTarget(o),b.setClearColor(I,P),void 0!==c&&(n.viewport=c),b.toneMapping=l}function Oe(e,t,i){const n=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=s.object,o=s.geometry,l=s.group;let c=s.material;!0===c.allowOverride&&null!==n&&(c=n),a.layers.test(i.layers)&&Ne(a,t,i,o,c,l)}}function Ne(e,t,i,n,r,s){e.onBeforeRender(b,t,i,n,r,s),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(b,t,i,n,e,s),!0===r.transparent&&r.side===Ih&&!1===r.forceSinglePass?(r.side=Th,r.needsUpdate=!0,b.renderBufferDirect(i,t,n,r,e,s),r.side=Mh,r.needsUpdate=!0,b.renderBufferDirect(i,t,n,r,e,s),r.side=Ih):b.renderBufferDirect(i,t,n,r,e,s),e.onAfterRender(b,t,i,n,r,s)}function ke(e,t,i){!0!==t.isScene&&(t=Q);const n=$.get(e),r=g.state.lights,s=g.state.shadowsArray,a=r.state.version,o=ae.getParameters(e,r.state,s,t,i),l=ae.getProgramCacheKey(o);let c=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=(e.isMeshStandardMaterial?ie:te).get(e.envMap||n.environment),n.envMapRotation=null!==n.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Ce),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===a)return Ue(e,o),h}else o.uniforms=ae.getUniforms(e),e.onBeforeCompile(o,b),h=ae.acquireProgram(o,l),c.set(l,h),n.uniforms=o.uniforms;const d=n.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=he.uniform),Ue(e,o),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=a,n.needsLights&&(d.ambientLightColor.value=r.state.ambient,d.lightProbe.value=r.state.probe,d.directionalLights.value=r.state.directional,d.directionalLightShadows.value=r.state.directionalShadow,d.spotLights.value=r.state.spot,d.spotLightShadows.value=r.state.spotShadow,d.rectAreaLights.value=r.state.rectArea,d.ltc_1.value=r.state.rectAreaLTC1,d.ltc_2.value=r.state.rectAreaLTC2,d.pointLights.value=r.state.point,d.pointLightShadows.value=r.state.pointShadow,d.hemisphereLights.value=r.state.hemi,d.directionalShadowMap.value=r.state.directionalShadowMap,d.directionalShadowMatrix.value=r.state.directionalShadowMatrix,d.spotShadowMap.value=r.state.spotShadowMap,d.spotLightMatrix.value=r.state.spotLightMatrix,d.spotLightMap.value=r.state.spotLightMap,d.pointShadowMap.value=r.state.pointShadowMap,d.pointShadowMatrix.value=r.state.pointShadowMatrix),n.currentProgram=h,n.uniformsList=null,h}function Fe(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=nE.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ue(e,t){const i=$.get(e);i.outputColorSpace=t.outputColorSpace,i.batching=t.batching,i.batchingColor=t.batchingColor,i.instancing=t.instancing,i.instancingColor=t.instancingColor,i.instancingMorph=t.instancingMorph,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphColors=t.morphColors,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents,i.toneMapping=t.toneMapping}De.setAnimationLoop((function(e){Te&&Te(e)})),"undefined"!==typeof self&&De.setContext(self),this.setAnimationLoop=function(e){Te=e,we.setAnimationLoop(e),null===e?De.stop():De.start()},we.addEventListener("sessionstart",Ie),we.addEventListener("sessionend",Pe),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===A)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===we.enabled&&!0===we.isPresenting&&(!0===we.cameraAutoUpdate&&we.updateCamera(t),t=we.getCamera()),!0===e.isScene&&e.onBeforeRender(b,e,t,S),g=ce.get(e,y.length),g.init(t),y.push(g),G.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(G),j=this.localClippingEnabled,z=he.init(this.clippingPlanes,j),m=le.get(e,v.length),m.init(),v.push(m),!0===we.enabled&&!0===we.isPresenting){const e=b.xr.getDepthSensingMesh();null!==e&&Re(e,t,-1/0,b.sortObjects)}Re(e,t,0,b.sortObjects),m.finish(),!0===b.sortObjects&&m.sort(L,O),q=!1===we.enabled||!1===we.isPresenting||!1===we.hasDepthSensing(),q&&ue.addToRenderList(m,e),this.info.render.frame++,!0===z&&he.beginShadows();const i=g.state.shadowsArray;de.render(i,e,t),!0===z&&he.endShadows(),!0===this.info.autoReset&&this.info.reset();const n=m.opaque,r=m.transmissive;if(g.setupLights(),t.isArrayCamera){const i=t.cameras;if(r.length>0)for(let t=0,s=i.length;t<s;t++){Le(n,r,e,i[t])}q&&ue.render(e);for(let t=0,n=i.length;t<n;t++){const n=i[t];Be(m,e,n,n.viewport)}}else r.length>0&&Le(n,r,e,t),q&&ue.render(e),Be(m,e,t);null!==S&&0===w&&(ee.updateMultisampleRenderTarget(S),ee.updateRenderTargetMipmap(S)),!0===e.isScene&&e.onAfterRender(b,e,t),ve.resetDefaultState(),_=-1,E=null,y.pop(),y.length>0?(g=y[y.length-1],!0===z&&he.setGlobalState(b.clippingPlanes,g.state.camera)):g=null,v.pop(),m=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(e,t,i){const n=$.get(e);n.__autoAllocateDepthBuffer=!1===e.resolveDepthBuffer,!1===n.__autoAllocateDepthBuffer&&(n.__useRenderToTexture=!1),$.get(e.texture).__webglTexture=t,$.get(e.depthTexture).__webglTexture=n.__autoAllocateDepthBuffer?void 0:i,n.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(e,t){const i=$.get(e);i.__webglFramebuffer=t,i.__useDefaultFramebuffer=void 0===t};const ze=be.createFramebuffer();this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;S=e,x=t,w=i;let n=!0,r=null,s=!1,a=!1;if(e){const o=$.get(e);if(void 0!==o.__useDefaultFramebuffer)J.bindFramebuffer(be.FRAMEBUFFER,null),n=!1;else if(void 0===o.__webglFramebuffer)ee.setupRenderTarget(e);else if(o.__hasExternalTextures)ee.rebindTextures(e,$.get(e.texture).__webglTexture,$.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(o.__boundDepthTexture!==t){if(null!==t&&$.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ee.setupDepthRenderbuffer(e)}}const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const c=$.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(c[t])?c[t][i]:c[t],s=!0):r=e.samples>0&&!1===ee.useMultisampledRTT(e)?$.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[i]:c,C.copy(e.viewport),M.copy(e.scissor),T=e.scissorTest}else C.copy(N).multiplyScalar(B).floor(),M.copy(k).multiplyScalar(B).floor(),T=F;0!==i&&(r=ze);if(J.bindFramebuffer(be.FRAMEBUFFER,r)&&n&&J.drawBuffers(e,r),J.viewport(C),J.scissor(M),J.setScissorTest(T),s){const n=$.get(e.texture);be.framebufferTexture2D(be.FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_CUBE_MAP_POSITIVE_X+t,n.__webglTexture,i)}else if(a){const n=$.get(e.texture),r=t;be.framebufferTextureLayer(be.FRAMEBUFFER,be.COLOR_ATTACHMENT0,n.__webglTexture,i,r)}else if(null!==e&&0!==i){const t=$.get(e.texture);be.framebufferTexture2D(be.FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_2D,t.__webglTexture,i)}_=-1},this.readRenderTargetPixels=function(e,t,i,n,r,s,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=$.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){J.bindFramebuffer(be.FRAMEBUFFER,o);try{const a=e.texture,o=a.format,l=a.type;if(!K.textureFormatReadable(o))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!K.textureTypeReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r&&be.readPixels(t,i,n,r,ge.convert(o),ge.convert(l),s)}finally{const e=null!==S?$.get(S).__webglFramebuffer:null;J.bindFramebuffer(be.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,i,n,r,s,a){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=$.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){if(t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r){J.bindFramebuffer(be.FRAMEBUFFER,o);const a=e.texture,l=a.format,c=a.type;if(!K.textureFormatReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!K.textureTypeReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const h=be.createBuffer();be.bindBuffer(be.PIXEL_PACK_BUFFER,h),be.bufferData(be.PIXEL_PACK_BUFFER,s.byteLength,be.STREAM_READ),be.readPixels(t,i,n,r,ge.convert(l),ge.convert(c),0);const d=null!==S?$.get(S).__webglFramebuffer:null;J.bindFramebuffer(be.FRAMEBUFFER,d);const u=be.fenceSync(be.SYNC_GPU_COMMANDS_COMPLETE,0);return be.flush(),await function(e,t,i){return new Promise((function(n,r){setTimeout((function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:n()}}),i)}))}(be,u,4),be.bindBuffer(be.PIXEL_PACK_BUFFER,h),be.getBufferSubData(be.PIXEL_PACK_BUFFER,0,s),be.deleteBuffer(h),be.deleteSync(u),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),s=Math.floor(e.image.height*n),a=null!==t?t.x:0,o=null!==t?t.y:0;ee.setTexture2D(e,0),be.copyTexSubImage2D(be.TEXTURE_2D,i,0,0,a,o,r,s),J.unbindTexture()};const je=be.createFramebuffer(),Ve=be.createFramebuffer();this.copyTextureToTexture=function(e,t){let i,n,r,s,a,o,l,c,h,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;null===f&&(0!==p?(wp("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),f=p,p=0):f=0);const m=e.isCompressedTexture?e.mipmaps[f]:e.image;if(null!==d)i=d.max.x-d.min.x,n=d.max.y-d.min.y,r=d.isBox3?d.max.z-d.min.z:1,s=d.min.x,a=d.min.y,o=d.isBox3?d.min.z:0;else{const t=Math.pow(2,-p);i=Math.floor(m.width*t),n=Math.floor(m.height*t),r=e.isDataArrayTexture?m.depth:e.isData3DTexture?Math.floor(m.depth*t):1,s=0,a=0,o=0}null!==u?(l=u.x,c=u.y,h=u.z):(l=0,c=0,h=0);const g=ge.convert(t.format),v=ge.convert(t.type);let y;t.isData3DTexture?(ee.setTexture3D(t,0),y=be.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(ee.setTexture2DArray(t,0),y=be.TEXTURE_2D_ARRAY):(ee.setTexture2D(t,0),y=be.TEXTURE_2D),be.pixelStorei(be.UNPACK_FLIP_Y_WEBGL,t.flipY),be.pixelStorei(be.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),be.pixelStorei(be.UNPACK_ALIGNMENT,t.unpackAlignment);const b=be.getParameter(be.UNPACK_ROW_LENGTH),A=be.getParameter(be.UNPACK_IMAGE_HEIGHT),x=be.getParameter(be.UNPACK_SKIP_PIXELS),w=be.getParameter(be.UNPACK_SKIP_ROWS),S=be.getParameter(be.UNPACK_SKIP_IMAGES);be.pixelStorei(be.UNPACK_ROW_LENGTH,m.width),be.pixelStorei(be.UNPACK_IMAGE_HEIGHT,m.height),be.pixelStorei(be.UNPACK_SKIP_PIXELS,s),be.pixelStorei(be.UNPACK_SKIP_ROWS,a),be.pixelStorei(be.UNPACK_SKIP_IMAGES,o);const _=e.isDataArrayTexture||e.isData3DTexture,E=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const d=$.get(e),u=$.get(t),m=$.get(d.__renderTarget),g=$.get(u.__renderTarget);J.bindFramebuffer(be.READ_FRAMEBUFFER,m.__webglFramebuffer),J.bindFramebuffer(be.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let v=0;v<r;v++)_&&(be.framebufferTextureLayer(be.READ_FRAMEBUFFER,be.COLOR_ATTACHMENT0,$.get(e).__webglTexture,p,o+v),be.framebufferTextureLayer(be.DRAW_FRAMEBUFFER,be.COLOR_ATTACHMENT0,$.get(t).__webglTexture,f,h+v)),be.blitFramebuffer(s,a,i,n,l,c,i,n,be.DEPTH_BUFFER_BIT,be.NEAREST);J.bindFramebuffer(be.READ_FRAMEBUFFER,null),J.bindFramebuffer(be.DRAW_FRAMEBUFFER,null)}else if(0!==p||e.isRenderTargetTexture||$.has(e)){const d=$.get(e),u=$.get(t);J.bindFramebuffer(be.READ_FRAMEBUFFER,je),J.bindFramebuffer(be.DRAW_FRAMEBUFFER,Ve);for(let e=0;e<r;e++)_?be.framebufferTextureLayer(be.READ_FRAMEBUFFER,be.COLOR_ATTACHMENT0,d.__webglTexture,p,o+e):be.framebufferTexture2D(be.READ_FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_2D,d.__webglTexture,p),E?be.framebufferTextureLayer(be.DRAW_FRAMEBUFFER,be.COLOR_ATTACHMENT0,u.__webglTexture,f,h+e):be.framebufferTexture2D(be.DRAW_FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_2D,u.__webglTexture,f),0!==p?be.blitFramebuffer(s,a,i,n,l,c,i,n,be.COLOR_BUFFER_BIT,be.NEAREST):E?be.copyTexSubImage3D(y,f,l,c,h+e,s,a,i,n):be.copyTexSubImage2D(y,f,l,c,s,a,i,n);J.bindFramebuffer(be.READ_FRAMEBUFFER,null),J.bindFramebuffer(be.DRAW_FRAMEBUFFER,null)}else E?e.isDataTexture||e.isData3DTexture?be.texSubImage3D(y,f,l,c,h,i,n,r,g,v,m.data):t.isCompressedArrayTexture?be.compressedTexSubImage3D(y,f,l,c,h,i,n,r,g,m.data):be.texSubImage3D(y,f,l,c,h,i,n,r,g,v,m):e.isDataTexture?be.texSubImage2D(be.TEXTURE_2D,f,l,c,i,n,g,v,m.data):e.isCompressedTexture?be.compressedTexSubImage2D(be.TEXTURE_2D,f,l,c,m.width,m.height,g,m.data):be.texSubImage2D(be.TEXTURE_2D,f,l,c,i,n,g,v,m);be.pixelStorei(be.UNPACK_ROW_LENGTH,b),be.pixelStorei(be.UNPACK_IMAGE_HEIGHT,A),be.pixelStorei(be.UNPACK_SKIP_PIXELS,x),be.pixelStorei(be.UNPACK_SKIP_ROWS,w),be.pixelStorei(be.UNPACK_SKIP_IMAGES,S),0===f&&t.generateMipmaps&&be.generateMipmap(y),J.unbindTexture()},this.copyTextureToTexture3D=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return wp('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(e,t,i,n,r)},this.initRenderTarget=function(e){void 0===$.get(e).__webglFramebuffer&&ee.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?ee.setTextureCube(e,0):e.isData3DTexture?ee.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?ee.setTexture2DArray(e,0):ee.setTexture2D(e,0),J.unbindTexture()},this.resetState=function(){x=0,w=0,S=null,J.reset(),ve.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return tp}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Cp._getDrawingBufferColorSpace(e),t.unpackColorSpace=Cp._getUnpackColorSpace()}}class ZE{constructor(e,t,i,n,r){this.xrLight=e,this.renderer=t,this.lightProbe=i,this.xrWebGLBinding=null,this.estimationStartCallback=r,this.frameCallback=this.onXRFrame.bind(this);const s=t.xr.getSession();if(n&&"XRWebGLBinding"in window){const i=new cg(16);e.environment=i.texture;const n=t.getContext();switch(s.preferredReflectionFormat){case"srgba8":n.getExtension("EXT_sRGB");break;case"rgba16f":n.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(s,n),this.lightProbe.addEventListener("reflectionchange",(()=>{this.updateReflection()}))}s.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const i=t.getLightEstimate(this.lightProbe);if(i){this.xrLight.lightProbe.sh.fromArray(i.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const e=Math.max(1,Math.max(i.primaryLightIntensity.x,Math.max(i.primaryLightIntensity.y,i.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(i.primaryLightIntensity.x/e,i.primaryLightIntensity.y/e,i.primaryLightIntensity.z/e),this.xrLight.directionalLight.intensity=e,this.xrLight.directionalLight.position.copy(i.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class $E extends hg{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(),this.lightProbe=new by,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new vy,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let i=null,n=!1;e.xr.addEventListener("sessionstart",(()=>{const r=e.xr.getSession();"requestLightProbe"in r&&r.requestLightProbe({reflectionFormat:r.preferredReflectionFormat}).then((r=>{i=new ZE(this,e,r,t,(()=>{n=!0,this.dispatchEvent({type:"estimationstart"})}))}))})),e.xr.addEventListener("sessionend",(()=>{i&&(i.dispose(),i=null),n&&this.dispatchEvent({type:"estimationend"})})),this.dispose=()=>{i&&(i.dispose(),i=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}class eC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,t,i,n){const r=2e-4*this.naturalFrequency;if(null==e||0===n)return t;if(e===t&&0===this.velocity)return t;if(i<0)return e;const s=e-t,a=this.velocity+this.naturalFrequency*s,o=s+i*a,l=Math.exp(-this.naturalFrequency*i),c=(a-this.naturalFrequency*o)*l,h=-this.naturalFrequency*(c+a*l);return Math.abs(c)<r*Math.abs(n)&&h*s>=0?(this.velocity=0,t):(this.velocity=c,t+o*l)}}const tC=.2,iC=Math.PI/24,nC=new mp,rC=(e,t,i)=>{let n=t>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let r=0;r<=12;++r)e.push(t+.17*Math.cos(n),i+.17*Math.sin(n),0,t+tC*Math.cos(n),i+tC*Math.sin(n),0),n+=iC};class sC extends qm{constructor(e,t){const i=new Om,n=[],r=[],{size:s,boundingBox:a}=e,o=s.x/2,l=("back"===t?s.y:s.z)/2;rC(r,o,l),rC(r,-o,l),rC(r,-o,-l),rC(r,o,-l);const c=r.length/3;for(let u=0;u<c-2;u+=2)n.push(u,u+1,u+3,u,u+3,u+2);const h=c-2;n.push(h,h+1,1,h,1,0),i.setAttribute("position",new Mm(r,3)),i.setIndex(n),super(i),this.side=t;const d=this.material;switch(d.side=Ih,d.transparent=!0,d.opacity=0,this.goalOpacity=0,this.opacityDamper=new eC,this.hitPlane=new qm(new xv(2*(o+tC),2*(l+tC))),this.hitPlane.visible=!1,this.hitPlane.material.side=Ih,this.add(this.hitPlane),this.hitBox=new qm(new Ym(s.x+.4,s.y+tC,s.z+.4)),this.hitBox.visible=!1,this.hitBox.material.side=Ih,this.add(this.hitBox),a.getCenter(this.position),t){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=a.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=a.min.z,this.position.z=this.shadowHeight}e.target.add(this),this.hitBox.position.y=(s.y+tC)/2+a.min.y,e.target.add(this.hitBox),this.offsetHeight=0}getHit(e,t,i){nC.set(t,-i),this.hitPlane.visible=!0;const n=e.positionAndNormalFromPoint(nC,this.hitPlane);return this.hitPlane.visible=!1,null==n?null:n.position}getExpandedHit(e,t,i){this.hitPlane.scale.set(1e3,1e3,1e3),this.hitPlane.updateMatrixWorld();const n=this.getHit(e,t,i);return this.hitPlane.scale.set(1,1,1),n}controllerIntersection(e,t){this.hitBox.visible=!0;const i=e.hitFromController(t,this.hitBox);return this.hitBox.visible=!1,i}set offsetHeight(e){e-=.001,"back"===this.side?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return"back"===this.side?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.goalOpacity=e?.75:0}updateOpacity(e){const t=this.material;t.opacity=this.opacityDamper.update(t.opacity,this.goalOpacity,e,1),this.visible=t.opacity>0}dispose(){const{geometry:e,material:t}=this.hitPlane;e.dispose(),t.dispose(),this.hitBox.geometry.dispose(),this.hitBox.material.dispose(),this.geometry.dispose(),this.material.dispose(),this.hitBox.removeFromParent(),this.removeFromParent()}}const aC=(e,t)=>({type:"number",number:e,unit:t}),oC=(()=>{const e={};return t=>{const i=t;if(i in e)return e[i];const n=[];let r=0;for(;t;){if(++r>1e3){t="";break}const e=lC(t),i=e.nodes[0];if(null==i||0===i.terms.length)break;n.push(i),t=e.remainingInput}return e[i]=n}})(),lC=(()=>{const e=/^(\-\-|[a-z\u0240-\uffff])/i,t=/^([\*\+\/]|[\-]\s)/i,i=/^[\),]/;return n=>{const r=[];for(;n.length&&(n=n.trim(),!i.test(n));)if("("===n[0]){const{nodes:e,remainingInput:t}=uC(n);n=t,r.push({type:"function",name:{type:"ident",value:"calc"},arguments:e})}else if(e.test(n)){const e=cC(n),t=e.nodes[0];if("("===(n=e.remainingInput)[0]){const{nodes:e,remainingInput:i}=uC(n);r.push({type:"function",name:t,arguments:e}),n=i}else r.push(t)}else if(t.test(n))r.push({type:"operator",value:n[0]}),n=n.slice(1);else{const{nodes:e,remainingInput:t}="#"===n[0]?dC(n):hC(n);if(0===e.length)break;r.push(e[0]),n=t}return{nodes:[{type:"expression",terms:r}],remainingInput:n}}})(),cC=(()=>{const e=/[^a-z0-9_\-\u0240-\uffff]/i;return t=>{const i=t.match(e);return{nodes:[{type:"ident",value:null==i?t:t.substr(0,i.index)}],remainingInput:null==i?"":t.substr(i.index)}}})(),hC=(()=>{const e=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,t=/^[a-z%]+/i,i=/^(m|mm|cm|rad|deg|[%])$/;return n=>{const r=n.match(e),s=null==r?"0":r[0],a=(n=null==s?n:n.slice(s.length)).match(t);let o=null!=a&&""!==a[0]?a[0]:null;const l=null==a?n:n.slice(o.length);return null==o||i.test(o)||(o=null),{nodes:[{type:"number",number:parseFloat(s)||0,unit:o}],remainingInput:l}}})(),dC=(()=>{const e=/^[a-f0-9]*/i;return t=>{const i=(t=t.slice(1).trim()).match(e);return{nodes:null==i?[]:[{type:"hex",value:i[0]}],remainingInput:null==i?t:t.slice(i[0].length)}}})(),uC=e=>{const t=[];for(e=e.slice(1).trim();e.length;){const i=lC(e);if(t.push(i.nodes[0]),","===(e=i.remainingInput.trim())[0])e=e.slice(1).trim();else if(")"===e[0]){e=e.slice(1);break}}return{nodes:t,remainingInput:e}},pC=Symbol("visitedTypes");class fC{constructor(e){this[pC]=e}walk(e,t){const i=e.slice();for(;i.length;){const e=i.shift();switch(this[pC].indexOf(e.type)>-1&&t(e),e.type){case"expression":i.unshift(...e.terms);break;case"function":i.unshift(e.name,...e.arguments)}}}}const mC=Object.freeze({type:"number",number:0,unit:null}),gC=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,{number:i,unit:n}=e;if(isFinite(i)){if("rad"===e.unit||null==e.unit)return e}else i=t,n="rad";return{type:"number",number:("deg"===n&&null!=i?i:0)*Math.PI/180,unit:"rad"}},vC=function(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,{number:n,unit:r}=e;if(isFinite(n)){if("m"===e.unit)return e}else n=i,r="m";switch(r){default:t=1;break;case"cm":t=.01;break;case"mm":t=.001}return{type:"number",number:t*n,unit:"m"}},yC=(()=>{const e=e=>e,t={rad:e,deg:gC,m:e,mm:vC,cm:vC};return function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mC;isFinite(e.number)||(e.number=i.number,e.unit=i.unit);const{unit:n}=e;if(null==n)return e;const r=t[n];return null==r?i:r(e)}})();var bC,AC,xC;const wC=Symbol("evaluate"),SC=Symbol("lastValue");class _C{constructor(){this[bC]=null}static evaluatableFor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mC;if(e instanceof _C)return e;if("number"===e.type)return"%"===e.unit?new MC(e,t):e;switch(e.name.value){case"calc":return new RC(e,t);case"env":return new IC(e)}return mC}static evaluate(e){return e instanceof _C?e.evaluate():e}static isConstant(e){return!(e instanceof _C)||e.isConstant}static applyIntrinsics(e,t){const{basis:i,keywords:n}=t,{auto:r}=n;return i.map(((t,i)=>{const s=null==r[i]?t:r[i];let a=e[i]?e[i]:s;if("ident"===a.type){const e=a.value;e in n&&(a=n[e][i])}return null!=a&&"ident"!==a.type||(a=s),"%"===a.unit?aC(a.number/100*t.number,t.unit):(a=yC(a,t),a.unit!==t.unit?t:a)}))}get isConstant(){return!1}evaluate(){return this.isConstant&&null!=this[SC]||(this[SC]=this[wC]()),this[SC]}}bC=SC;const EC=Symbol("percentage"),CC=Symbol("basis");class MC extends _C{constructor(e,t){super(),this[EC]=e,this[CC]=t}get isConstant(){return!0}[wC](){return aC(this[EC].number/100*this[CC].number,this[CC].unit)}}const TC=Symbol("identNode");class IC extends _C{constructor(e){super(),this[AC]=null;const t=e.arguments.length?e.arguments[0].terms[0]:null;null!=t&&"ident"===t.type&&(this[TC]=t)}get isConstant(){return!1}[(AC=TC,wC)](){if(null!=this[TC]&&"window-scroll-y"===this[TC].value){return{type:"number",number:window.pageYOffset/(Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight)||0,unit:null}}return mC}}const PC=/[\*\/]/,DC=Symbol("evaluator");class RC extends _C{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mC;if(super(),this[xC]=null,1!==e.arguments.length)return;const i=e.arguments[0].terms.slice(),n=[];for(;i.length;){const e=i.shift();if(n.length>0){const i=n[n.length-1];if("operator"===i.type&&PC.test(i.value)){const i=n.pop(),r=n.pop();if(null==r)return;n.push(new NC(i,_C.evaluatableFor(r,t),_C.evaluatableFor(e,t)));continue}}n.push("operator"===e.type?e:_C.evaluatableFor(e,t))}for(;n.length>2;){const[e,i,r]=n.splice(0,3);if("operator"!==i.type)return;n.unshift(new NC(i,_C.evaluatableFor(e,t),_C.evaluatableFor(r,t)))}1===n.length&&(this[DC]=n[0])}get isConstant(){return null==this[DC]||_C.isConstant(this[DC])}[(xC=DC,wC)](){return null!=this[DC]?_C.evaluate(this[DC]):mC}}const BC=Symbol("operator"),LC=Symbol("left"),OC=Symbol("right");class NC extends _C{constructor(e,t,i){super(),this[BC]=e,this[LC]=t,this[OC]=i}get isConstant(){return _C.isConstant(this[LC])&&_C.isConstant(this[OC])}[wC](){const e=yC(_C.evaluate(this[LC])),t=yC(_C.evaluate(this[OC])),{number:i,unit:n}=e,{number:r,unit:s}=t;if(null!=s&&null!=n&&s!=n)return mC;const a=n||s;let o;switch(this[BC].value){case"+":o=i+r;break;case"-":o=i-r;break;case"/":o=i/r;break;case"*":o=i*r;break;default:return mC}return{type:"number",number:o,unit:a}}}const kC=Symbol("evaluatables"),FC=Symbol("intrinsics");class UC extends _C{constructor(e,t){super(),this[FC]=t;const i=e[0],n=null!=i?i.terms:[];this[kC]=t.basis.map(((e,t)=>{const i=n[t];return null==i?{type:"ident",value:"auto"}:"ident"===i.type?i:_C.evaluatableFor(i,e)}))}get isConstant(){for(const e of this[kC])if(!_C.isConstant(e))return!1;return!0}[wC](){const e=this[kC].map((e=>_C.evaluate(e)));return _C.applyIntrinsics(e,this[FC]).map((e=>e.number))}}var zC,jC,VC,GC;const HC=Symbol("instances"),WC=Symbol("activateListener"),QC=Symbol("deactivateListener"),qC=Symbol("notifyInstances"),XC=Symbol("notify"),YC=Symbol("callback");class KC{static[qC](){for(const e of KC[HC])e[XC]()}static[(zC=HC,WC)](){window.addEventListener("scroll",this[qC],{passive:!0})}static[QC](){window.removeEventListener("scroll",this[qC])}constructor(e){this[YC]=e}observe(){0===KC[HC].size&&KC[WC](),KC[HC].add(this)}disconnect(){KC[HC].delete(this),0===KC[HC].size&&KC[QC]()}[XC](){this[YC]()}}KC[zC]=new Set;const JC=Symbol("computeStyleCallback"),ZC=Symbol("astWalker"),$C=Symbol("dependencies"),eM=Symbol("onScroll");class tM{constructor(e){this[jC]={},this[VC]=new fC(["function"]),this[GC]=()=>{this[JC]({relatedState:"window-scroll"})},this[JC]=e}observeEffectsFor(e){const t={},i=this[$C];this[ZC].walk(e,(e=>{const{name:n}=e,r=e.arguments[0].terms[0];if("env"===n.value&&null!=r&&"ident"===r.type&&"window-scroll-y"===r.value)if(null==t["window-scroll"]){const e="window-scroll"in i?i["window-scroll"]:new KC(this[eM]);e.observe(),delete i["window-scroll"],t["window-scroll"]=e}}));for(const n in i){i[n].disconnect()}this[$C]=t}dispose(){for(const e in this[$C]){this[$C][e].disconnect()}}}jC=$C,VC=ZC,GC=eM;const iM=e=>{const t=e.observeEffects||!1,i=e.intrinsics instanceof Function?e.intrinsics:()=>e.intrinsics;return(n,r)=>{const s=n.updated,a=n.connectedCallback,o=n.disconnectedCallback,l=Symbol(`${r}StyleEffector`),c=Symbol(`${r}StyleEvaluator`),h=Symbol(`${r}UpdateEvaluator`),d=Symbol(`${r}EvaluateAndSync`);Object.defineProperties(n,{[l]:{value:null,writable:!0},[c]:{value:null,writable:!0},[h]:{value:function(){const e=oC(this[r]);this[c]=new UC(e,i(this)),null==this[l]&&t&&(this[l]=new tM((()=>this[d]()))),null!=this[l]&&this[l].observeEffectsFor(e)}},[d]:{value:function(){if(null==this[c])return;const t=this[c].evaluate();this[e.updateHandler](t)}},updated:{value:function(e){e.has(r)&&(this[h](),this[d]()),s.call(this,e)}},connectedCallback:{value:function(){a.call(this),this.requestUpdate(r,this[r])}},disconnectedCallback:{value:function(){o.call(this),null!=this[l]&&(this[l].dispose(),this[l]=null)}}})}},nM=e=>e<.5?2*e*e:(4-2*e)*e-1,rM=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:nM;return n=>e+(t-e)*i(n)},sM=e=>{const t=[],i=[];let n=e.initialValue;for(let r=0;r<e.keyframes.length;++r){const s=e.keyframes[r],{value:a,frames:o}=s,l=s.ease||nM,c=rM(n,a,l);t.push(c),i.push(o),n=a}return((e,t)=>{const i=t.map((n=0,e=>n+=e));var n;return t=>{t=Gb(t,0,1),t*=i[i.length-1];const n=i.findIndex((e=>e>=t)),r=n<1?0:i[n-1],s=i[n];return e[n]((t-r)/(s-r))}})(t,i)};var aM=function(e,t,i,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,i,a):r(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a};const oM=sM({initialValue:0,keyframes:[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]}),lM=sM({initialValue:0,keyframes:[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]}),cM="0deg 75deg 105%",hM=["front","right","back","left"],dM=["upper-","","lower-"],uM="auto",pM="basic",fM="wiggle",mM="none",gM=()=>({basis:[gC(aC(30,"deg"))],keywords:{auto:[null]}}),vM=()=>({basis:[gC(aC(12,"deg"))],keywords:{auto:[null]}}),yM=(()=>{const e=oC(cM)[0].terms,t=yC(e[0]),i=yC(e[1]);return e=>{const n=e[eR].idealCameraDistance();return{basis:[t,i,aC(n,"m")],keywords:{auto:[null,null,aC(105,"%")]}}}})(),bM=e=>{const t=2.2*e[eR].boundingSphere.radius;return{basis:[aC(-1/0,"rad"),aC(0,"rad"),aC(t,"m")],keywords:{auto:[null,null,null]}}},AM=e=>{const t=yM(e),i=new UC([],t).evaluate()[2];return{basis:[aC(1/0,"rad"),aC(Math.PI,"rad"),aC(i,"m")],keywords:{auto:[null,null,null]}}},xM=e=>{const t=e[eR].boundingBox.getCenter(new Vp);return{basis:[aC(t.x,"m"),aC(t.y,"m"),aC(t.z,"m")],keywords:{auto:[null,null,null]}}},wM=Math.PI/2,SM=Math.PI/3,_M=wM/2,EM=2*Math.PI,CM=Symbol("controls"),MM=Symbol("panElement"),TM=Symbol("promptElement"),IM=Symbol("promptAnimatedContainer"),PM=Symbol("fingerAnimatedContainers"),DM=Symbol("deferInteractionPrompt"),RM=Symbol("updateAria"),BM=Symbol("a11y"),LM=Symbol("updateA11y"),OM=Symbol("updateCameraForRadius"),NM=Symbol("cancelPrompts"),kM=Symbol("onChange"),FM=Symbol("onPointerChange"),UM=Symbol("waitingToPromptUser"),zM=Symbol("userHasInteracted"),jM=Symbol("promptElementVisibleTime"),VM=Symbol("lastPromptOffset"),GM=Symbol("cancellationSource"),HM=Symbol("lastSpherical"),WM=Symbol("jumpCamera"),QM=Symbol("initialized"),qM=Symbol("maintainThetaPhi"),XM=Symbol("syncCameraOrbit"),YM=Symbol("syncFieldOfView"),KM=Symbol("syncCameraTarget"),JM=Symbol("syncMinCameraOrbit"),ZM=Symbol("syncMaxCameraOrbit"),$M=Symbol("syncMinFieldOfView"),eT=Symbol("syncMaxFieldOfView"),tT=new mp,iT=new Vp,nT=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:0,maximumPolarAngle:Math.PI,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,touchAction:"none"}),rT=Math.PI/8,sT=.04,aT={USER_INTERACTION:"user-interaction",NONE:"none",AUTOMATIC:"automatic"};class oT extends np{constructor(e,t,i){super(),this.camera=e,this.element=t,this.scene=i,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.inputSensitivity=1,this.changeSource=aT.NONE,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserPointing=!1,this.enablePan=!0,this.enableTap=!0,this.panProjection=new gp,this.panPerPixel=0,this.spherical=new ky,this.goalSpherical=new ky,this.thetaDamper=new eC,this.phiDamper=new eC,this.radiusDamper=new eC,this.logFov=Math.log(nT.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new eC,this.touchMode=null,this.pointers=[],this.startTime=0,this.startPointerPosition={clientX:0,clientY:0},this.lastSeparation=0,this.touchDecided=!1,this.onContext=e=>{if(this.enablePan)e.preventDefault();else for(const t of this.pointers)this.onPointerUp(new PointerEvent("pointercancel",Object.assign(Object.assign({},this.startPointerPosition),{pointerId:t.id})))},this.touchModeZoom=(e,t)=>{if(!this._disableZoom){const e=this.twoTouchDistance(this.pointers[0],this.pointers[1]),t=sT*this.zoomSensitivity*(this.lastSeparation-e)*50/this.scene.height;this.lastSeparation=e,this.userAdjustOrbit(0,0,t)}this.panPerPixel>0&&this.movePan(e,t)},this.disableScroll=e=>{e.preventDefault()},this.touchModeRotate=(e,t)=>{const{touchAction:i}=this._options;if(!this.touchDecided&&"none"!==i){this.touchDecided=!0;const n=Math.abs(e),r=Math.abs(t);if(this.changeSource===aT.USER_INTERACTION&&("pan-y"===i&&r>n||"pan-x"===i&&n>r))return void(this.touchMode=null);this.element.addEventListener("touchmove",this.disableScroll,{passive:!1})}this.handleSinglePointerMove(e,t)},this.onPointerDown=e=>{if(this.pointers.length>2)return;const{element:t}=this;0===this.pointers.length&&(t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.touchMode=null,this.touchDecided=!1,this.startPointerPosition.clientX=e.clientX,this.startPointerPosition.clientY=e.clientY,this.startTime=performance.now());try{t.setPointerCapture(e.pointerId)}catch(Ux){}this.pointers.push({clientX:e.clientX,clientY:e.clientY,id:e.pointerId}),this.isUserPointing=!1,"touch"===e.pointerType?(this.changeSource=e.altKey?aT.AUTOMATIC:aT.USER_INTERACTION,this.onTouchChange(e)):(this.changeSource=aT.USER_INTERACTION,this.onMouseDown(e)),this.changeSource===aT.USER_INTERACTION&&this.dispatchEvent({type:"user-interaction"})},this.onPointerMove=e=>{const t=this.pointers.find((t=>t.id===e.pointerId));if(null==t)return;if("mouse"===e.pointerType&&0===e.buttons)return void this.onPointerUp(e);const i=this.pointers.length,n=(e.clientX-t.clientX)/i,r=(e.clientY-t.clientY)/i;0===n&&0===r||(t.clientX=e.clientX,t.clientY=e.clientY,"touch"===e.pointerType?(this.changeSource=e.altKey?aT.AUTOMATIC:aT.USER_INTERACTION,null!==this.touchMode&&this.touchMode(n,r)):(this.changeSource=aT.USER_INTERACTION,this.panPerPixel>0?this.movePan(n,r):this.handleSinglePointerMove(n,r)))},this.onPointerUp=e=>{const{element:t}=this,i=this.pointers.findIndex((t=>t.id===e.pointerId));-1!==i&&this.pointers.splice(i,1),this.panPerPixel>0&&!e.altKey&&this.resetRadius(),0===this.pointers.length?(t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),t.removeEventListener("touchmove",this.disableScroll),this.enablePan&&this.enableTap&&this.recenter(e)):null!==this.touchMode&&this.onTouchChange(e),this.scene.element[MM].style.opacity=0,t.style.cursor="grab",this.panPerPixel=0,this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end"})},this.onWheel=e=>{this.changeSource=aT.USER_INTERACTION;const t=e.deltaY*(1==e.deltaMode?18:1)*sT*this.zoomSensitivity/30;this.userAdjustOrbit(0,0,t),e.preventDefault(),this.dispatchEvent({type:"user-interaction"})},this.onKeyDown=e=>{const{changeSource:t}=this;this.changeSource=aT.USER_INTERACTION;(e.shiftKey&&this.enablePan?this.panKeyCodeHandler(e):this.orbitZoomKeyCodeHandler(e))?(e.preventDefault(),this.dispatchEvent({type:"user-interaction"})):this.changeSource=t},this._options=Object.assign({},nT),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(!1===this._interactionEnabled){const{element:e}=this;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointercancel",this.onPointerUp),this._disableZoom||e.addEventListener("wheel",this.onWheel),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("touchmove",(()=>{}),{passive:!1}),e.addEventListener("contextmenu",this.onContext),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(!0===this._interactionEnabled){const{element:e}=this;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointercancel",this.onPointerUp),e.removeEventListener("wheel",this.onWheel),e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("contextmenu",this.onContext),e.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(e){this._disableZoom!=e&&(this._disableZoom=e,!0===e?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ky).copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(e){Object.assign(this._options,e),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(e,t){this.camera.far=0===t?2:t,this.camera.near=Math.max(e,this.camera.far/1e3),this.camera.updateProjectionMatrix()}updateAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setOrbit(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.goalSpherical.theta,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.goalSpherical.phi,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.goalSpherical.radius;const{minimumAzimuthalAngle:n,maximumAzimuthalAngle:r,minimumPolarAngle:s,maximumPolarAngle:a,minimumRadius:o,maximumRadius:l}=this._options,{theta:c,phi:h,radius:d}=this.goalSpherical,u=Gb(e,n,r);isFinite(n)||isFinite(r)||(this.spherical.theta=this.wrapAngle(this.spherical.theta-u)+u);const p=Gb(t,s,a),f=Gb(i,o,l);return(u!==c||p!==h||f!==d)&&(!!(isFinite(u)&&isFinite(p)&&isFinite(f))&&(this.goalSpherical.theta=u,this.goalSpherical.phi=p,this.goalSpherical.radius=f,this.goalSpherical.makeSafe(),!0))}setRadius(e){this.goalSpherical.radius=e,this.setOrbit()}setFieldOfView(e){const{minimumFieldOfView:t,maximumFieldOfView:i}=this._options;e=Gb(e,t,i),this.goalLogFov=Math.log(e)}setDamperDecayTime(e){this.thetaDamper.setDecayTime(e),this.phiDamper.setDecayTime(e),this.radiusDamper.setDecayTime(e),this.fovDamper.setDecayTime(e)}adjustOrbit(e,t,i){const{theta:n,phi:r,radius:s}=this.goalSpherical,{minimumRadius:a,maximumRadius:o,minimumFieldOfView:l,maximumFieldOfView:c}=this._options,h=this.spherical.theta-n,d=Math.PI-.001,u=n-Gb(e,-d-h,d-h),p=r-t,f=0===i?0:((i>0?o:a)-s)/(Math.log(i>0?c:l)-this.goalLogFov),m=s+i*(isFinite(f)?f:2*(o-a));if(this.setOrbit(u,p,m),0!==i){const e=this.goalLogFov+i;this.setFieldOfView(Math.exp(e))}}jumpToGoal(){this.update(0,1e4)}update(e,t){if(this.isStationary())return!1;const{maximumPolarAngle:i,maximumRadius:n}=this._options,r=this.spherical.theta-this.goalSpherical.theta;return Math.abs(r)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=2*Math.sign(r)*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,t,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,t,i),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,t,n),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,t,1),this.moveCamera(),!0}updateTouchActionStyle(){const{style:e}=this.element;if(this._interactionEnabled){const{touchAction:t}=this._options;this._disableZoom&&"none"!==t?e.touchAction="manipulation":e.touchAction=t}else e.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new If(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix())}userAdjustOrbit(e,t,i){this.adjustOrbit(e*this.orbitSensitivity*this.inputSensitivity,t*this.orbitSensitivity*this.inputSensitivity,i*this.inputSensitivity)}wrapAngle(e){const t=(e+Math.PI)/(2*Math.PI);return 2*(t-Math.floor(t))*Math.PI-Math.PI}pixelLengthToSphericalAngle(e){return 2*Math.PI*e/this.scene.height}twoTouchDistance(e,t){const{clientX:i,clientY:n}=e,{clientX:r,clientY:s}=t,a=r-i,o=s-n;return Math.sqrt(a*a+o*o)}handleSinglePointerMove(e,t){const i=this.pixelLengthToSphericalAngle(e),n=this.pixelLengthToSphericalAngle(t);!1===this.isUserPointing&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start"})),this.userAdjustOrbit(i,n,0)}initializePan(){const{theta:e,phi:t}=this.spherical,i=e-this.scene.yaw;this.panPerPixel=.018*this.panSensitivity/this.scene.height,this.panProjection.set(-Math.cos(i),-Math.cos(t)*Math.sin(i),0,0,Math.sin(t),0,Math.sin(i),-Math.cos(t)*Math.cos(i),0)}movePan(e,t){const{scene:i}=this,n=iT.set(e,t,0).multiplyScalar(this.inputSensitivity),r=this.spherical.radius*Math.exp(this.logFov)*this.panPerPixel;n.multiplyScalar(r);const s=i.getTarget();s.add(n.applyMatrix3(this.panProjection)),i.boundingSphere.clampPoint(s,s),i.setTarget(s.x,s.y,s.z)}recenter(e){if(performance.now()>this.startTime+300||Math.abs(e.clientX-this.startPointerPosition.clientX)>2||Math.abs(e.clientY-this.startPointerPosition.clientY)>2)return;const{scene:t}=this,i=t.positionAndNormalFromPoint(t.getNDC(e.clientX,e.clientY));if(null==i){const{cameraTarget:e}=t.element;t.element.cameraTarget="",t.element.cameraTarget=e,this.userAdjustOrbit(0,0,1)}else t.target.worldToLocal(i.position),t.setTarget(i.position.x,i.position.y,i.position.z)}resetRadius(){const{scene:e}=this,t=e.positionAndNormalFromPoint(tT.set(0,0));if(null==t)return;e.target.worldToLocal(t.position);const i=e.getTarget(),{theta:n,phi:r}=this.spherical,s=n-e.yaw,a=iT.set(Math.sin(r)*Math.sin(s),Math.cos(r),Math.sin(r)*Math.cos(s)),o=a.dot(t.position.sub(i));i.add(a.multiplyScalar(o)),e.setTarget(i.x,i.y,i.z),this.setOrbit(void 0,void 0,this.goalSpherical.radius-o)}onTouchChange(e){if(1===this.pointers.length)this.touchMode=this.touchModeRotate;else{if(this._disableZoom)return this.touchMode=null,void this.element.removeEventListener("touchmove",this.disableScroll);this.touchMode=this.touchDecided&&null===this.touchMode?null:this.touchModeZoom,this.touchDecided=!0,this.element.addEventListener("touchmove",this.disableScroll,{passive:!1}),this.lastSeparation=this.twoTouchDistance(this.pointers[0],this.pointers[1]),this.enablePan&&null!=this.touchMode&&(this.initializePan(),e.altKey||(this.scene.element[MM].style.opacity=1))}}onMouseDown(e){this.panPerPixel=0,this.enablePan&&(2===e.button||e.ctrlKey||e.metaKey||e.shiftKey)&&(this.initializePan(),this.scene.element[MM].style.opacity=1),this.element.style.cursor="grabbing"}orbitZoomKeyCodeHandler(e){let t=!0;switch(e.key){case"PageUp":this.userAdjustOrbit(0,0,sT*this.zoomSensitivity);break;case"PageDown":this.userAdjustOrbit(0,0,-.04*this.zoomSensitivity);break;case"ArrowUp":this.userAdjustOrbit(0,-rT,0);break;case"ArrowDown":this.userAdjustOrbit(0,rT,0);break;case"ArrowLeft":this.userAdjustOrbit(-rT,0,0);break;case"ArrowRight":this.userAdjustOrbit(rT,0,0);break;default:t=!1}return t}panKeyCodeHandler(e){this.initializePan();let t=!0;switch(e.key){case"ArrowUp":this.movePan(0,-10);break;case"ArrowDown":this.movePan(0,10);break;case"ArrowLeft":this.movePan(-10,0);break;case"ArrowRight":this.movePan(10,0);break;default:t=!1}return t}}const lT=150,cT="not-presenting",hT="session-started",dT="object-placed",uT="failed",pT="tracking",fT="not-tracking",mT=new Vp,gT=new jp,vT=new bf,yT=new Vp,bT=new sg(45,1,.1,100),AT=(new Om).setFromPoints([new Vp(0,0,0),new Vp(0,0,-1)]),xT=new Ym;class wT extends np{constructor(e){super(),this.renderer=e,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.xrMode=null,this.controller1=null,this.controller2=null,this.selectedController=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new Vp,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new Vp,this.relativeOrientation=new jp,this.scaleLine=new iv(AT),this.firstRatio=0,this.lastAngle=0,this.goalPosition=new Vp,this.goalYaw=0,this.goalScale=1,this.xDamper=new eC,this.yDamper=new eC,this.zDamper=new eC,this.yawDamper=new eC,this.pitchDamper=new eC,this.rollDamper=new eC,this.scaleDamper=new eC,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onControllerSelectStart=e=>{const t=this.presentedScene,i=e.target;if(null!=this.placementBox.controllerIntersection(t,i))null!=this.selectedController&&(this.selectedController.userData.line.visible=!1,t.canScale&&(this.isTwoFingering=!0,this.firstRatio=this.controllerSeparation()/t.pivot.scale.x,this.scaleLine.visible=!0)),i.attach(t.pivot),this.selectedController=i,t.setShadowIntensity(.01);else{const e=i===this.controller1?this.controller2:this.controller1;this.relativeOrientation.copy(i.quaternion).invert().multiply(t.pivot.getWorldQuaternion(gT)),e.userData.turning=!1,i.userData.turning=!0,i.userData.line.visible=!1}},this.onControllerSelectEnd=e=>{const t=e.target;if(t.userData.turning=!1,t.userData.line.visible=!0,this.isTwoFingering=!1,this.scaleLine.visible=!1,null!=this.selectedController&&this.selectedController!=t)return;const i=this.presentedScene;i.attach(i.pivot),this.selectedController=null,this.goalYaw=Math.atan2(i.pivot.matrix.elements[8],i.pivot.matrix.elements[10]),this.goalPosition.x=i.pivot.position.x,this.goalPosition.z=i.pivot.position.z},this.onUpdateScene=()=>{null!=this.placementBox&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new sC(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=e=>{const t=this.transientHitTestSource;if(null==t)return;const i=this.frame.getHitTestResultsForTransientInput(t),n=this.presentedScene,r=this.placementBox;if(1===i.length){this.inputSource=e.inputSource;const{axes:t}=this.inputSource.gamepad,i=r.getHit(this.presentedScene,t[0],t[1]);r.show=!0,null!=i?(this.isTranslating=!0,this.lastDragPosition.copy(i)):!1===this.placeOnWall&&(this.isRotating=!0,this.lastAngle=1.5*t[0])}else if(2===i.length){r.show=!0,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(i);this.firstRatio=e/n.pivot.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=e.threeRenderer,this.threeRenderer.xr.enabled=!0}async resolveARSession(){zb();const e=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:[],optionalFeatures:["hit-test","dom-overlay","light-estimation"],domOverlay:this.overlay?{root:this.overlay}:void 0});return this.threeRenderer.xr.setReferenceSpaceType("local"),await this.threeRenderer.xr.setSession(e),this.threeRenderer.xr.cameraAutoUpdate=!1,e}get presentedScene(){return this._presentedScene}async supportsPresentation(){try{return zb(),await navigator.xr.isSessionSupported("immersive-ar")}catch(e){return console.warn("Request to present in WebXR denied:"),console.warn(e),console.warn("Falling back to next ar-mode"),!1}}async present(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isPresenting&&console.warn("Cannot present while a model is already presenting");let i=new Promise(((e,t)=>{requestAnimationFrame((()=>e()))}));e.setHotspotsVisibility(!1),e.queueRender(),await i,this._presentedScene=e,this.overlay=e.element.shadowRoot.querySelector("div.default"),!0===t&&(this.xrLight=new $E(this.threeRenderer),this.xrLight.addEventListener("estimationstart",(()=>{if(!this.isPresenting||null==this.xrLight)return;const e=this.presentedScene;e.add(this.xrLight),e.environment=this.xrLight.environment})));const n=await this.resolveARSession();n.addEventListener("end",(()=>{this.postSessionCleanup()}),{once:!0});const r=e.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");r.classList.add("enabled"),r.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=r;const s=await n.requestReferenceSpace("viewer");this.xrMode=n.interactionMode,this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=e.yaw,this.goalYaw=e.yaw,this.goalScale=1,e.setBackground(null),this.oldShadowIntensity=e.shadowIntensity,e.setShadowIntensity(.01),this.oldTarget.copy(e.getTarget()),e.element.addEventListener("load",this.onUpdateScene);const a=20*Math.PI/180,o=!0===this.placeOnWall?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(a),z:-Math.cos(a)});n.requestHitTestSource({space:s,offsetRay:o}).then((e=>{this.initialHitSource=e})),"screen-space"!==this.xrMode&&(this.setupControllers(),this.xDamper.setDecayTime(lT),this.yDamper.setDecayTime(lT),this.zDamper.setDecayTime(lT),this.yawDamper.setDecayTime(lT),this.pitchDamper.setDecayTime(lT),this.rollDamper.setDecayTime(lT)),this.currentSession=n,this.placementBox=new sC(e,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:hT})}setupControllers(){this.controller1=this.threeRenderer.xr.getController(0),this.controller1.addEventListener("selectstart",this.onControllerSelectStart),this.controller1.addEventListener("selectend",this.onControllerSelectEnd),this.controller2=this.threeRenderer.xr.getController(1),this.controller2.addEventListener("selectstart",this.onControllerSelectStart),this.controller2.addEventListener("selectend",this.onControllerSelectEnd);const e=this.presentedScene;if(e.add(this.controller1),e.add(this.controller2),!this.controller1.userData.line){const t=new iv(AT);t.name="line",t.scale.z=5,this.controller1.userData.turning=!1,this.controller1.userData.line=t,this.controller1.add(t),this.controller2.userData.turning=!1;const i=t.clone();this.controller2.userData.line=i,this.controller2.add(i),this.scaleLine.name="scale line",this.scaleLine.visible=!1,this.controller1.add(this.scaleLine);const{size:n}=e,r=.1/Math.max(n.x,n.y,n.z),s=new qm(xT);s.name="box",s.scale.copy(n).multiplyScalar(r),s.visible=!1,this.controller1.userData.box=s,e.add(s);const a=s.clone();this.controller2.userData.box=a,e.add(a)}}hover(e){if("screen-space"===this.xrMode||this.selectedController==e)return!1;const t=this.presentedScene,i=this.placementBox.controllerIntersection(t,e);return e.userData.box.visible=(null==i||e.userData.turning)&&!this.isTwoFingering,e.userData.line.scale.z=null==i?5:i.distance,null!=i}controllerSeparation(){return this.controller1.position.distanceTo(this.controller2.position)}async stopPresenting(){if(!this.isPresenting)return;const e=new Promise((e=>{this.resolveCleanup=e}));try{await this.currentSession.end(),await e}catch(t){console.warn("Error while trying to end WebXR AR session"),console.warn(t),this.postSessionCleanup()}}get isPresenting(){return null!=this.presentedScene}get target(){return this.oldTarget}updateTarget(){const e=this.presentedScene;if(null!=e){const t=e.getTarget();this.oldTarget.copy(t),this.placeOnWall?t.z=e.boundingBox.min.z:t.y=e.boundingBox.min.y,e.setTarget(t.x,t.y,t.z)}}postSessionCleanup(){const e=this.currentSession;null!=e&&(e.removeEventListener("selectstart",this.onSelectStart),e.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);const t=this.presentedScene;if(this._presentedScene=null,null!=t){const{element:e}=t;null!=this.xrLight&&(t.remove(this.xrLight),this.xrLight.dispose(),this.xrLight=null),t.add(t.pivot),t.pivot.quaternion.set(0,0,0,1),t.pivot.position.set(0,0,0),t.pivot.scale.set(1,1,1),t.setShadowOffset(0);const i=this.turntableRotation;null!=i&&(t.yaw=i);const n=this.oldShadowIntensity;null!=n&&t.setShadowIntensity(n),t.setEnvironmentAndSkybox(e[Qb],e[qb]);const r=this.oldTarget;t.setTarget(r.x,r.y,r.z),t.xrCamera=null,t.element.removeEventListener("load",this.onUpdateScene),t.orientHotspots(0);const{width:s,height:a}=e.getBoundingClientRect();t.setSize(s,a),requestAnimationFrame((()=>{t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:aT.NONE}}))}))}this.renderer.height=0;const i=this.exitWebXRButtonContainer;null!=i&&(i.classList.remove("enabled"),i.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);const n=this.transientHitTestSource;null!=n&&(n.cancel(),this.transientHitTestSource=null);const r=this.initialHitSource;null!=r&&(r.cancel(),this.initialHitSource=null),null!=this.placementBox&&(this.placementBox.dispose(),this.placementBox=null),"screen-space"!==this.xrMode&&(null!=this.controller1&&(this.controller1.userData.turning=!1,this.controller1.userData.box.visible=!1,this.controller1.userData.line.visible=!0,this.controller1.removeEventListener("selectstart",this.onControllerSelectStart),this.controller1.removeEventListener("selectend",this.onControllerSelectEnd),this.controller1.removeFromParent(),this.controller1=null),null!=this.controller2&&(this.controller2.userData.turning=!1,this.controller2.userData.box.visible=!1,this.controller2.userData.line.visible=!0,this.controller2.removeEventListener("selectstart",this.onControllerSelectStart),this.controller2.removeEventListener("selectend",this.onControllerSelectEnd),this.controller2.removeFromParent(),this.controller2=null),this.selectedController=null,this.scaleLine.visible=!1),this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.inputSource=null,this.overlay=null,null!=this.resolveCleanup&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:cT})}updateView(e){const t=this.presentedScene,i=this.threeRenderer.xr;i.updateCamera(bT),t.xrCamera=i.getCamera();const{elements:n}=t.getCamera().matrixWorld;if(t.orientHotspots(Math.atan2(n[1],n[5])),this.initialized||(this.placeInitially(),this.initialized=!0),e.requestViewportScale&&e.recommendedViewportScale){const t=e.recommendedViewportScale;e.requestViewportScale(Math.max(t,.25))}const r=i.getBaseLayer();if(null!=r){const t=r instanceof XRWebGLLayer?r.getViewport(e):i.getBinding().getViewSubImage(r,e).viewport;this.threeRenderer.setViewport(t.x,t.y,t.width,t.height)}}placeInitially(){const e=this.presentedScene,{pivot:t,element:i}=e,{position:n}=t,r=e.getCamera(),{width:s,height:a}=this.overlay.getBoundingClientRect();e.setSize(s,a),r.projectionMatrixInverse.copy(r.projectionMatrix).invert();const{theta:o}=i.getCameraOrbit(),l=r.getWorldDirection(mT);e.yaw=Math.atan2(-l.x,-l.z)-o,this.goalYaw=e.yaw;const c=Math.max(1,2*e.boundingSphere.radius);n.copy(r.position).add(l.multiplyScalar(c)),this.updateTarget();const h=e.getTarget();if(n.add(h).sub(this.oldTarget),this.goalPosition.copy(n),e.setHotspotsVisibility(!0),"screen-space"===this.xrMode){const{session:e}=this.frame;e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd),e.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then((e=>{this.transientHitTestSource=e}))}}getTouchLocation(){const{axes:e}=this.inputSource.gamepad;let t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return null!=t&&(mT.copy(t).sub(this.presentedScene.getCamera().position),mT.length()>10)?null:t}getHitPoint(e){const t=this.threeRenderer.xr.getReferenceSpace(),i=e.getPose(t);if(null==i)return null;const n=vT.fromArray(i.transform.matrix);return!0===this.placeOnWall&&(this.goalYaw=Math.atan2(n.elements[4],n.elements[6])),n.elements[5]>.75!==this.placeOnWall?yT.setFromMatrixPosition(n):null}moveToFloor(e){const t=this.initialHitSource;if(null==t)return;const i=e.getHitTestResults(t);if(0==i.length)return;const n=i[0],r=this.getHitPoint(n);null!=r&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(r):this.goalPosition.y=r.y),t.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:dT}))}fingerPolar(e){const t=e[0].inputSource.gamepad.axes,i=e[1].inputSource.gamepad.axes,n=i[0]-t[0],r=i[1]-t[1],s=Math.atan2(r,n);let a=this.lastAngle-s;return a>Math.PI?a-=2*Math.PI:a<-Math.PI&&(a+=2*Math.PI),this.lastAngle=s,{separation:Math.sqrt(n*n+r*r),deltaYaw:a}}setScale(e){const t=e/this.firstRatio;this.goalScale=Math.abs(t-1)<.2?1:t}processInput(e){const t=this.transientHitTestSource;if(null==t)return;if(!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const i=e.getHitTestResultsForTransientInput(t),n=this.presentedScene,r=n.pivot.scale.x;if(this.isTwoFingering)if(i.length<2)this.isTwoFingering=!1;else{const{separation:e,deltaYaw:t}=this.fingerPolar(i);!1===this.placeOnWall&&(this.goalYaw+=t),n.canScale&&this.setScale(e)}else if(2!==i.length)if(this.isRotating){const e=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=e-this.lastAngle,this.lastAngle=e}else this.isTranslating&&i.forEach((e=>{if(e.inputSource!==this.inputSource)return;let t=null;if(e.results.length>0&&(t=this.getHitPoint(e.results[0])),null==t&&(t=this.getTouchLocation()),null!=t){if(this.goalPosition.sub(this.lastDragPosition),!1===this.placeOnWall){const e=t.y-this.lastDragPosition.y;if(e<0){this.placementBox.offsetHeight=e/r,this.presentedScene.setShadowOffset(e);const i=mT.copy(n.getCamera().position),s=-e/(i.y-t.y);i.multiplyScalar(s),t.multiplyScalar(1-s).add(i)}}this.goalPosition.add(t),this.lastDragPosition.copy(t)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:e}=this.fingerPolar(i);this.firstRatio=e/r}}moveScene(e){const t=this.presentedScene,{pivot:i}=t,n=this.placementBox;if(n.updateOpacity(e),this.controller1&&(this.controller1.userData.turning&&(i.quaternion.copy(this.controller1.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller2&&i.quaternion.premultiply(gT.copy(this.controller2.quaternion).invert())),this.controller1.userData.box.position.copy(this.controller1.position),i.getWorldQuaternion(this.controller1.userData.box.quaternion)),this.controller2&&(this.controller2.userData.turning&&(i.quaternion.copy(this.controller2.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller1&&i.quaternion.premultiply(gT.copy(this.controller1.quaternion).invert())),this.controller2.userData.box.position.copy(this.controller2.position),i.getWorldQuaternion(this.controller2.userData.box.quaternion)),this.controller1&&this.controller2&&this.isTwoFingering){const e=this.controllerSeparation();this.setScale(e),this.scaleLine.scale.z=-e,this.scaleLine.lookAt(this.controller2.position)}const r=t.pivot.scale.x;if(this.goalScale!==r){const i=this.scaleDamper.update(r,this.goalScale,e,1);t.pivot.scale.set(i,i,i)}if(i.parent!==t)return;const{position:s}=i,a=t.boundingSphere.radius,o=this.goalPosition;let l=aT.NONE;if(!o.equals(s)){l=aT.USER_INTERACTION;let{x:i,y:r,z:c}=s;if(i=this.xDamper.update(i,o.x,e,a),r=this.yDamper.update(r,o.y,e,a),c=this.zDamper.update(c,o.z,e,a),s.set(i,r,c),"screen-space"===this.xrMode&&!this.isTranslating){const e=o.y-r;this.placementComplete&&!1===this.placeOnWall?(n.offsetHeight=e/t.pivot.scale.x,t.setShadowOffset(e)):0===e&&(this.placementComplete=!0,n.show=!1,t.setShadowIntensity(.8))}"screen-space"!==this.xrMode&&o.equals(s)&&t.setShadowIntensity(.8)}t.updateTarget(e),gT.setFromAxisAngle(mT.set(0,1,0),this.goalYaw);const c=t.pivot.quaternion.angleTo(gT),h=c-this.yawDamper.update(c,0,e,Math.PI);t.pivot.quaternion.rotateTowards(gT,h),t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:l}}))}onWebXRFrame(e,t){if("screen-space"!==this.xrMode){const e=this.hover(this.controller1),t=this.hover(this.controller2);this.placementBox.show=(e||t)&&!this.isTwoFingering}this.frame=t,++this.frames;const i=this.threeRenderer.xr.getReferenceSpace(),n=t.getViewerPose(i);null==n&&!0===this.tracking&&this.frames>30&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:fT}));const r=this.presentedScene;if(null==n||null==r||!r.element.loaded)return void this.threeRenderer.clear();!1===this.tracking&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:pT}));let s=!0;for(const a of n.views){if(this.updateView(a),s){this.moveToFloor(t),this.processInput(t);const i=e-this.lastTick;this.moveScene(i),this.renderer.preRender(r,e,i),this.lastTick=e,r.renderShadow(this.threeRenderer)}this.threeRenderer.render(r,r.getCamera()),s=!1}}}function ST(e){const t=new Map,i=new Map,n=e.clone();return _T(e,n,(function(e,n){t.set(n,e),i.set(e,n)})),n.traverse((function(e){if(!e.isSkinnedMesh)return;const n=e,r=t.get(e),s=r.skeleton.bones;n.skeleton=r.skeleton.clone(),n.bindMatrix.copy(r.bindMatrix),n.skeleton.bones=s.map((function(e){return i.get(e)})),n.bind(n.skeleton,n.bindMatrix)})),n}function _T(e,t,i){i(e,t);for(let n=0;n<e.children.length;n++)_T(e.children[n],t.children[n],i)}const ET=Symbol("prepared"),CT=Symbol("prepare"),MT=Symbol("preparedGLTF"),TT=Symbol("clone");class IT{static prepare(e){if(null==e.scene)throw new Error("Model does not have a scene");if(e[ET])return e;const t=this[CT](e);return t[ET]=!0,t}static[CT](e){const{scene:t}=e,i=[t];return Object.assign(Object.assign({},e),{scene:t,scenes:i})}get parser(){return this[MT].parser}get animations(){return this[MT].animations}get scene(){return this[MT].scene}get scenes(){return this[MT].scenes}get cameras(){return this[MT].cameras}get asset(){return this[MT].asset}get userData(){return this[MT].userData}constructor(e){this[MT]=e}clone(){return new(0,this.constructor)(this[TT]())}dispose(){this.scenes.forEach((e=>{e.traverse((e=>{const t=e;if(!t.material)return;(Array.isArray(t.material)?t.material:[t.material]).forEach((e=>{for(const t in e){const i=e[t];if(i instanceof Op){const e=i.source.data;null!=e.close&&e.close(),i.dispose()}}e.dispose()})),t.geometry.dispose()}))}))}[TT](){const e=this[MT],t=ST(this.scene);PT(t,this.scene);const i=[t],n=e.userData?Object.assign({},e.userData):{};return Object.assign(Object.assign({},e),{scene:t,scenes:i,userData:n})}}const PT=(e,t)=>{DT(e,t,((e,t)=>{void 0!==t.userData.variantMaterials&&(e.userData.variantMaterials=new Map(t.userData.variantMaterials)),void 0!==t.userData.variantData&&(e.userData.variantData=t.userData.variantData),void 0!==t.userData.originalMaterial&&(e.userData.originalMaterial=t.userData.originalMaterial)}))},DT=(e,t,i)=>{i(e,t);for(let n=0;n<e.children.length;n++)DT(e.children[n],t.children[n],i)},RT=Symbol("threeGLTF"),BT=Symbol("gltf"),LT=Symbol("gltfElementMap"),OT=Symbol("threeObjectMap"),NT=Symbol("parallelTraverseThreeScene"),kT=Symbol("correlateOriginalThreeGLTF"),FT=Symbol("correlateCloneThreeGLTF");class UT{static from(e,t){return null!=t?this[FT](e,t):this[kT](e)}static[kT](e){const t=e.parser.json,i=e.parser.associations,n=new Map,r={name:"Default"},s={type:"materials",index:-1};for(const a of i.keys())a instanceof fm&&null==i.get(a)&&(s.index<0&&(null==t.materials&&(t.materials=[]),s.index=t.materials.length,t.materials.push(r)),a.name=r.name,i.set(a,{materials:s.index}));for(const[a,o]of i){o&&(a.userData=a.userData||{},a.userData.associations=o);for(const e in o)if(null!=e&&"primitives"!==e){const i=e,r=(t[i]||[])[o[i]];if(null==r)continue;let s=n.get(r);null==s&&(s=new Set,n.set(r,s)),s.add(a)}}return new UT(e,t,i,n)}static[FT](e,t){const i=t.threeGLTF,n=t.gltf,r=JSON.parse(JSON.stringify(n)),s=new Map,a=new Map;for(let o=0;o<i.scenes.length;o++)this[NT](i.scenes[o],e.scenes[o],((e,i)=>{const n=t.threeObjectMap.get(e);if(null!=n)for(const t in n)if(null!=t&&"primitives"!==t){const e=t,o=n[e],l=r[e][o],c=s.get(i)||{};c[e]=o,s.set(i,c);const h=a.get(l)||new Set;h.add(i),a.set(l,h)}}));return new UT(e,r,s,a)}static[NT](e,t,i){const n=(e,t)=>{if(i(e,t),e.isObject3D){const r=e,s=t;if(r.material)if(Array.isArray(r.material))for(let e=0;e<r.material.length;++e)i(r.material[e],s.material[e]);else i(r.material,s.material);for(let i=0;i<e.children.length;++i)n(e.children[i],t.children[i])}};n(e,t)}get threeGLTF(){return this[RT]}get gltf(){return this[BT]}get gltfElementMap(){return this[LT]}get threeObjectMap(){return this[OT]}constructor(e,t,i,n){this[RT]=e,this[BT]=t,this[LT]=n,this[OT]=i}}const zT=Symbol("correlatedSceneGraph");class jT extends IT{static[CT](e){const t=super[CT](e);null==t[zT]&&(t[zT]=UT.from(t));const{scene:i}=t,n=new hf(void 0,1/0);return i.traverse((e=>{e.renderOrder=1e3,e.frustumCulled=!1,e.name||(e.name=e.uuid);const i=e;if(i.material){const{geometry:e}=i;i.castShadow=!0,i.isSkinnedMesh&&(e.boundingSphere=n,e.boundingBox=null);const r=i.material;if(!0===r.isMeshBasicMaterial&&(r.toneMapped=!1),r.shadowSide=Mh,r.aoMap){const{gltf:i,threeObjectMap:n}=t[zT],s=n.get(r);if(null!=i.materials&&null!=s&&null!=s.materials){const t=i.materials[s.materials];t.occlusionTexture&&0===t.occlusionTexture.texCoord&&null!=e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv)}}}})),t}get correlatedSceneGraph(){return this[MT][zT]}[TT](){const e=super[TT](),t=new Map;return e.scene.traverse((e=>{const i=e;if(i.material){const e=i.material;if(null!=e){if(t.has(e.uuid))return void(i.material=t.get(e.uuid));i.material=e.clone(),t.set(e.uuid,i.material)}}const n=e;void 0!==n.target&&n.add(n.target)})),e[zT]=UT.from(e,this.correlatedSceneGraph),e}}const VT=(e,t,i)=>{let n;switch(e){case Id:n=new Uint8ClampedArray(t*i*4);break;case Nd:n=new Uint16Array(t*i*4);break;case Ld:n=new Uint32Array(t*i*4);break;case Pd:n=new Int8Array(t*i*4);break;case Dd:n=new Int16Array(t*i*4);break;case Bd:n=new Int32Array(t*i*4);break;case Od:n=new Float32Array(t*i*4);break;default:throw new Error("Unsupported data type")}return n};let GT;class HT{constructor(e){var t,i,n,r,s,a,o,l,c,h,d,u,p,f,m,g;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(th){throw this._renderer.setRenderTarget(null),th}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const v={format:Gd,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:void 0!==(null===(t=e.renderTargetOptions)||void 0===t?void 0:t.anisotropy)?null===(i=e.renderTargetOptions)||void 0===i?void 0:i.anisotropy:1,generateMipmaps:void 0!==(null===(n=e.renderTargetOptions)||void 0===n?void 0:n.generateMipmaps)&&(null===(r=e.renderTargetOptions)||void 0===r?void 0:r.generateMipmaps),magFilter:void 0!==(null===(s=e.renderTargetOptions)||void 0===s?void 0:s.magFilter)?null===(a=e.renderTargetOptions)||void 0===a?void 0:a.magFilter:Cd,minFilter:void 0!==(null===(o=e.renderTargetOptions)||void 0===o?void 0:o.minFilter)?null===(l=e.renderTargetOptions)||void 0===l?void 0:l.minFilter:Cd,samples:void 0!==(null===(c=e.renderTargetOptions)||void 0===c?void 0:c.samples)?null===(h=e.renderTargetOptions)||void 0===h?void 0:h.samples:void 0,wrapS:void 0!==(null===(d=e.renderTargetOptions)||void 0===d?void 0:d.wrapS)?null===(u=e.renderTargetOptions)||void 0===u?void 0:u.wrapS:xd,wrapT:void 0!==(null===(p=e.renderTargetOptions)||void 0===p?void 0:p.wrapT)?null===(f=e.renderTargetOptions)||void 0===f?void 0:f.wrapT:xd};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=HT.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new pg,this._camera=new my,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,t,i,n)=>{if(void 0!==GT)return GT;const r=new Fp(1,1,n);t.setRenderTarget(r);const s=new qm(new xv,new mm({color:16777215}));t.render(s,i),t.setRenderTarget(null);const a=VT(e,r.width,r.height);return t.readRenderTargetPixels(r,0,0,r.width,r.height,a),r.dispose(),s.geometry.dispose(),s.material.dispose(),GT=0!==a[0],GT})(this._type,this._renderer,this._camera,v)){let e;if(this._type===Nd)e=this._renderer.extensions.has("EXT_color_buffer_float")?Od:void 0;void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Od}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new qm(new xv,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Fp(this.width,this.height,v),this._renderTarget.texture.mapping=void 0!==(null===(m=e.renderTargetOptions)||void 0===m?void 0:m.mapping)?null===(g=e.renderTargetOptions)||void 0===g?void 0:g.mapping:fd}static instantiateRenderer(){const e=new JE;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=VT(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new Tg(this.toArray(),this.width,this.height,Gd,this._type,(null===e||void 0===e?void 0:e.mapping)||fd,(null===e||void 0===e?void 0:e.wrapS)||xd,(null===e||void 0===e?void 0:e.wrapT)||xd,(null===e||void 0===e?void 0:e.magFilter)||Cd,(null===e||void 0===e?void 0:e.minFilter)||Cd,(null===e||void 0===e?void 0:e.anisotropy)||1,ju);return t.generateMipmaps=void 0!==(null===e||void 0===e?void 0:e.generateMipmaps)&&(null===e||void 0===e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof eg&&Object.values(this.material.uniforms).forEach((e=>{e.value instanceof Op&&e.value.dispose()})),Object.values(this.material).forEach((e=>{e instanceof Op&&e.dispose()})),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class WT extends eg{constructor(e){let{gamma:t,offsetHdr:i,offsetSdr:n,gainMapMin:r,gainMapMax:s,maxDisplayBoost:a,hdrCapacityMin:o,hdrCapacityMax:l,sdr:c,gainMap:h}=e;super({name:"GainMapDecoderMaterial",vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\n// min half float value\n#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )\n// max half float value\n#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )\n\nuniform sampler2D sdr;\nuniform sampler2D gainMap;\nuniform vec3 gamma;\nuniform vec3 offsetHdr;\nuniform vec3 offsetSdr;\nuniform vec3 gainMapMin;\nuniform vec3 gainMapMax;\nuniform float weightFactor;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec3 rgb = texture2D( sdr, vUv ).rgb;\n  vec3 recovery = texture2D( gainMap, vUv ).rgb;\n  vec3 logRecovery = pow( recovery, gamma );\n  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;\n  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;\n  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));\n  gl_FragColor = vec4( clampedHdrColor , 1.0 );\n}\n",uniforms:{sdr:{value:c},gainMap:{value:h},gamma:{value:new Vp(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:(new Vp).fromArray(i)},offsetSdr:{value:(new Vp).fromArray(n)},gainMapMin:{value:(new Vp).fromArray(r)},gainMapMax:{value:(new Vp).fromArray(s)},weightFactor:{value:(Math.log2(a)-o)/(l-o)}},blending:0,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=o,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class QT extends Error{}class qT extends Error{}const XT=(e,t,i)=>{const n=new RegExp(`${t}="([^"]*)"`,"i").exec(e);if(n)return n[1];const r=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(r){const e=r[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map((e=>e.replace(/<\/?rdf:li>/g,""))):r[1].trim()}if(void 0!==i)return i;throw new Error(`Can't find ${t} in gainmap metadata`)};class YT{constructor(e){this.options={debug:!(!e||void 0===e.debug)&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise(((t,i)=>{const n=this.options.debug,r=new DataView(e.buffer);if(65496!==r.getUint16(0))return void i(new Error("Not a valid jpeg"));const s=r.byteLength;let a,o=2,l=0;for(;o<s;){if(++l>250)return void i(new Error(`Found no marker after ${l} loops \ud83d\ude35`));if(255!==r.getUint8(o))return void i(new Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${r.getUint8(o).toString(16)}`));if(a=r.getUint8(o+1),n&&console.log(`Marker: ${a.toString(16)}`),226===a){n&&console.log("Found APP2 marker (0xffe2)");const e=o+4;if(1297106432===r.getUint32(e)){const n=e+4;let s;if(18761===r.getUint16(n))s=!1;else{if(19789!==r.getUint16(n))return void i(new Error("No valid endianness marker found in TIFF header"));s=!0}if(42!==r.getUint16(n+2,!s))return void i(new Error("Not valid TIFF data! (no 0x002A marker)"));const a=r.getUint32(n+4,!s);if(a<8)return void i(new Error("Not valid TIFF data! (First offset less than 8)"));const o=n+a,l=r.getUint16(o,!s),c=o+2;let h=0;for(let e=c;e<c+12*l;e+=12)45057===r.getUint16(e,!s)&&(h=r.getUint32(e+8,!s));const d=o+2+12*l+4,u=[];for(let e=d;e<d+16*h;e+=16){const t={MPType:r.getUint32(e,!s),size:r.getUint32(e+4,!s),dataOffset:r.getUint32(e+8,!s),dependantImages:r.getUint32(e+12,!s),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=n+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,u.push(t)}if(this.options.extractNonFII&&u.length){const e=new Blob([r]),i=[];for(const t of u){if(t.isFII&&!this.options.extractFII)continue;const n=e.slice(t.start,t.end+1,"image/jpeg");i.push(n)}t(i)}}}o+=2+r.getUint16(o+2)}}))}}const KT=async e=>{const t=(e=>{let t;t="undefined"!==typeof TextDecoder?(new TextDecoder).decode(e):e.toString();let i=t.indexOf("<x:xmpmeta");for(;-1!==i;){const e=t.indexOf("x:xmpmeta>",i),n=t.slice(i,e+10);try{const e=XT(n,"hdrgm:GainMapMin","0"),t=XT(n,"hdrgm:GainMapMax"),i=XT(n,"hdrgm:Gamma","1"),r=XT(n,"hdrgm:OffsetSDR","0.015625"),s=XT(n,"hdrgm:OffsetHDR","0.015625"),a=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(n),o=a?a[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(n);if(!l)throw new Error("Incomplete gainmap metadata");const c=l[1];return{gainMapMin:Array.isArray(e)?e.map((e=>parseFloat(e))):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map((e=>parseFloat(e))):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(i)?i.map((e=>parseFloat(e))):[parseFloat(i),parseFloat(i),parseFloat(i)],offsetSdr:Array.isArray(r)?r.map((e=>parseFloat(e))):[parseFloat(r),parseFloat(r),parseFloat(r)],offsetHdr:Array.isArray(s)?s.map((e=>parseFloat(e))):[parseFloat(s),parseFloat(s),parseFloat(s)],hdrCapacityMin:parseFloat(o),hdrCapacityMax:parseFloat(c)}}catch(th){}i=t.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new qT("Gain map XMP metadata not found");const i=new YT({extractFII:!0,extractNonFII:!0}),n=await i.extract(e);if(2!==n.length)throw new QT("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:t}},JT=e=>new Promise(((t,i)=>{const n=document.createElement("img");n.onload=()=>{t(n)},n.onerror=e=>{i(e)},n.src=URL.createObjectURL(e)}));class ZT extends Yv{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new qv}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new WT({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Op,sdr:new Op});return new HT({width:16,height:16,type:Nd,colorSpace:ju,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,i,n){const r=n?new Blob([n],{type:"image/jpeg"}):void 0,s=new Blob([i],{type:"image/jpeg"});let a,o,l=!1;if("undefined"===typeof createImageBitmap){const e=await Promise.all([r?JT(r):Promise.resolve(void 0),JT(s)]);o=e[0],a=e[1],l=!0}else{const e=await Promise.all([r?createImageBitmap(r,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:"flipY"})]);o=e[0],a=e[1]}const c=new Op(o||new ImageData(2,2),fd,xd,xd,Cd,1008,Gd,Id,1,ju);c.flipY=l,c.needsUpdate=!0;const h=new Op(a,fd,xd,xd,Cd,1008,Gd,Id,1,zu);h.flipY=l,h.needsUpdate=!0,e.width=a.width,e.height=a.height,e.material.gainMap=c,e.material.sdr=h,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class $T extends ZT{load(e,t,i,n){const r=this.prepareQuadRenderer(),s=new Zv(this._internalLoadingManager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(this.withCredentials),this.manager.itemStart(e),s.load(e,(async i=>{if("string"===typeof i)throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const s=new Uint8Array(i);let a,o,l;try{const e=await KT(s);a=e.sdr,o=e.gainMap,l=e.metadata}catch(th){if(!(th instanceof qT||th instanceof QT))throw th;console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),l={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},a=s}try{await this.render(r,l,a,o)}catch(c){return this.manager.itemError(e),"function"===typeof n&&n(c),void r.disposeOnDemandRenderer()}"function"===typeof t&&t(r),this.manager.itemEnd(e),r.disposeOnDemandRenderer()}),i,(t=>{this.manager.itemError(e),"function"===typeof n&&n(t)})),r}}class eI extends ey{constructor(e){super(e),this.type=Nd}parse(e){const t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},i=function(e,t,i){t=t||1024;let n=e.pos,r=-1,s=0,a="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(r=o.indexOf("\n"))&&s<t&&n<e.byteLength;)a+=o,s+=o.length,n+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<r&&(!1!==i&&(e.pos+=s+r+1),a+o.slice(0,r))},n=function(e,t,i,n){const r=e[t+3],s=Math.pow(2,r-128)/255;i[n+0]=e[t+0]*s,i[n+1]=e[t+1]*s,i[n+2]=e[t+2]*s,i[n+3]=1},r=function(e,t,i,n){const r=e[t+3],s=Math.pow(2,r-128)/255;i[n+0]=Am.toHalfFloat(Math.min(e[t+0]*s,65504)),i[n+1]=Am.toHalfFloat(Math.min(e[t+1]*s,65504)),i[n+2]=Am.toHalfFloat(Math.min(e[t+2]*s,65504)),i[n+3]=Am.toHalfFloat(1)},s=new Uint8Array(e);s.pos=0;const a=function(e){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;for((e.pos>=e.byteLength||!(l=i(e)))&&t(1,"no header found"),(c=l.match(/^#\?(\S+)/))||t(3,"bad initial token"),o.valid|=1,o.programtype=c[1],o.string+=l+"\n";l=i(e),!1!==l;)if(o.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(n))&&(o.gamma=parseFloat(c[1])),(c=l.match(r))&&(o.exposure=parseFloat(c[1])),(c=l.match(s))&&(o.valid|=2,o.format=c[1]),(c=l.match(a))&&(o.valid|=4,o.height=parseInt(c[1],10),o.width=parseInt(c[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=l+"\n";return 2&o.valid||t(3,"missing format specifier"),4&o.valid||t(3,"missing image size specifier"),o}(s),o=a.width,l=a.height,c=function(e,i,n){const r=i;if(r<8||r>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);r!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");const s=new Uint8Array(4*i*n);s.length||t(4,"unable to allocate buffer space");let a=0,o=0;const l=4*r,c=new Uint8Array(4),h=new Uint8Array(l);let d=n;for(;d>0&&o<e.byteLength;){o+4>e.byteLength&&t(1),c[0]=e[o++],c[1]=e[o++],c[2]=e[o++],c[3]=e[o++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==r||t(3,"bad rgbe scanline format");let i,n=0;for(;n<l&&o<e.byteLength;){i=e[o++];const r=i>128;if(r&&(i-=128),(0===i||n+i>l)&&t(3,"bad scanline data"),r){const t=e[o++];for(let e=0;e<i;e++)h[n++]=t}else h.set(e.subarray(o,o+i),n),n+=i,o+=i}const u=r;for(let e=0;e<u;e++){let t=0;s[a]=h[e+t],t+=r,s[a+1]=h[e+t],t+=r,s[a+2]=h[e+t],t+=r,s[a+3]=h[e+t],a+=4}d--}return s}(s.subarray(s.pos),o,l);let h,d,u;switch(this.type){case Od:u=c.length/4;const e=new Float32Array(4*u);for(let i=0;i<u;i++)n(c,4*i,e,4*i);h=e,d=Od;break;case Nd:u=c.length/4;const t=new Uint16Array(4*u);for(let i=0;i<u;i++)r(c,4*i,t,4*i);h=t,d=Nd;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:o,height:l,data:h,header:a.string,gamma:a.gamma,exposure:a.exposure,type:d}}setDataType(e){return this.type=e,this}load(e,t,i,n){return super.load(e,(function(e,i){switch(e.type){case Od:case Nd:e.colorSpace=ju,e.minFilter=Cd,e.magFilter=Cd,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,i)}),i,n)}}const tI={topLight:{intensity:500,position:[.418,16.199,.3]},room:{position:[-.757,13.219,.717],scale:[31.713,28.305,28.591]},boxes:[{position:[-10.906,2.009,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,.857,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:50,position:[-16.116,14.37,8.208],scale:[.1,2.428,2.739]},{intensity:50,position:[-16.109,18.021,-8.207],scale:[.1,2.425,2.751]},{intensity:17,position:[14.904,12.198,-1.832],scale:[.15,4.265,6.331]},{intensity:43,position:[-.462,8.89,14.52],scale:[4.38,5.441,.088]},{intensity:20,position:[3.235,11.486,-12.541],scale:[2.5,2,.1]},{intensity:100,position:[0,20,0],scale:[1,.1,1]}]},iI={topLight:{intensity:400,position:[.5,14,.5]},room:{position:[0,13.2,0],scale:[31.5,28.5,31.5]},boxes:[{position:[-10.906,-1,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,-.16,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:80,position:[-14,10,8],scale:[.1,2.5,2.5]},{intensity:80,position:[-14,14,-4],scale:[.1,2.5,2.5]},{intensity:23,position:[14,12,0],scale:[.1,5,5]},{intensity:16,position:[0,9,14],scale:[5,5,.1]},{intensity:80,position:[7,8,-14],scale:[2.5,2.5,.1]},{intensity:80,position:[-7,16,-14],scale:[2.5,2.5,.1]},{intensity:1,position:[0,20,0],scale:[.1,.1,.1]}]};class nI extends pg{constructor(e){super(),this.position.y=-3.5;const t=new Ym;t.deleteAttribute("uv");const i=new Sv({metalness:0,side:Th}),n=new Sv({metalness:0}),r="legacy"==e?tI:iI,s=new fy(16777215,r.topLight.intensity,28,2);s.position.set(...r.topLight.position),this.add(s);const a=new qm(t,i);a.position.set(...r.room.position),a.scale.set(...r.room.scale),this.add(a);for(const o of r.boxes){const e=new qm(t,n);e.position.set(...o.position),e.rotation.set(0,o.rotation,0),e.scale.set(...o.scale),this.add(e)}for(const o of r.lights){const e=new qm(t,this.createAreaLightMaterial(o.intensity));e.position.set(...o.position),e.scale.set(...o.scale),this.add(e)}}createAreaLightMaterial(e){const t=new mm;return t.color.setScalar(e),t}}const rI=20,sI=/\.hdr(\.js)?$/;class aI{constructor(e){this.threeRenderer=e,this.lottieLoaderUrl="",this._ldrLoader=null,this._imageLoader=null,this._hdrLoader=null,this._lottieLoader=null,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}ldrLoader(e){return null==this._ldrLoader&&(this._ldrLoader=new ty),this._ldrLoader.setWithCredentials(e),this._ldrLoader}imageLoader(e){return null==this._imageLoader&&(this._imageLoader=new $T(this.threeRenderer)),this._imageLoader.setWithCredentials(e),this._imageLoader}hdrLoader(e){return null==this._hdrLoader&&(this._hdrLoader=new eI,this._hdrLoader.setDataType(Nd)),this._hdrLoader.setWithCredentials(e),this._hdrLoader}async getLottieLoader(e){if(null==this._lottieLoader){const{LottieLoader:e}=await import(this.lottieLoaderUrl);this._lottieLoader=new e}return this._lottieLoader.setWithCredentials(e),this._lottieLoader}async loadImage(e,t){const i=await new Promise(((i,n)=>this.ldrLoader(t).load(e,i,(()=>{}),n)));return i.name=e,i.flipY=!1,i}async loadLottie(e,t,i){const n=await this.getLottieLoader(i);n.setQuality(t);const r=await new Promise(((t,i)=>n.load(e,t,(()=>{}),i)));return r.name=e,r}async loadEquirect(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};try{const n=sI.test(e),r=n?this.hdrLoader(t):this.imageLoader(t),s=await new Promise(((t,n)=>r.load(e,(e=>{const{renderTarget:i}=e;if(null!=i){const{texture:n}=i;e.dispose(!1),t(n)}else t(e)}),(e=>{i(e.loaded/e.total*.9)}),n)));return i(1),s.name=e,s.mapping=vd,n||(s.colorSpace=zu),s}finally{i&&i(1)}}async generateEnvironmentMapAndSkybox(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r="legacy"!==t;"legacy"!==t&&"neutral"!==t||(t=null),t=Ub(t);let s,a=Promise.resolve(null);e&&(a=this.loadEquirectFromUrl(e,n,i)),s=t?this.loadEquirectFromUrl(t,n,i):e?this.loadEquirectFromUrl(e,n,i):r?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap();const[o,l]=await Promise.all([s,a]);if(null==o)throw new Error("Failed to load environment map.");return{environmentMap:o,skybox:l}}async loadEquirectFromUrl(e,t,i){if(!this.skyboxCache.has(e)){const n=this.loadEquirect(e,t,i);this.skyboxCache.set(e,n)}return this.skyboxCache.get(e)}async GenerateEnvironmentMap(e,t){await function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((t=>setTimeout(t,e)))}();const i=this.threeRenderer,n=new cg(256,{generateMipmaps:!1,type:Nd,format:Gd,colorSpace:ju,depthBuffer:!0}),r=new og(.1,100,n),s=r.renderTarget.texture;s.name=t;const a=i.outputColorSpace,o=i.toneMapping;return i.toneMapping=sd,i.outputColorSpace=ju,r.update(i,e),this.blurCubemap(n,.04),i.toneMapping=o,i.outputColorSpace=a,s}async loadGeneratedEnvironmentMap(){return null==this.generatedEnvironmentMap&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new nI("legacy"),"legacy")),this.generatedEnvironmentMap}async loadGeneratedEnvironmentMapAlt(){return null==this.generatedEnvironmentMapAlt&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new nI("neutral"),"neutral")),this.generatedEnvironmentMapAlt}blurCubemap(e,t){if(null==this.blurMaterial){this.blurMaterial=this.getBlurShader(rI);const e=new Ym,t=new qm(e,this.blurMaterial);this.blurScene=new pg,this.blurScene.add(t)}const i=e.clone();this.halfblur(e,i,t,"latitudinal"),this.halfblur(i,e,t,"longitudinal")}halfblur(e,t,i,n){const r=e.width,s=isFinite(i)?Math.PI/(2*r):2*Math.PI/39,a=i/s,o=isFinite(i)?1+Math.floor(3*a):rI;o>rI&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${o} samples when the maximum is set to 20`);const l=[];let c=0;for(let d=0;d<rI;++d){const e=d/a,t=Math.exp(-e*e/2);l.push(t),0==d?c+=t:d<o&&(c+=2*t)}for(let d=0;d<l.length;d++)l[d]=l[d]/c;const h=this.blurMaterial.uniforms;h.envMap.value=e.texture,h.samples.value=o,h.weights.value=l,h.latitudinal.value="latitudinal"===n,h.dTheta.value=s;new og(.1,100,t).update(this.threeRenderer,this.blurScene)}getBlurShader(e){const t=new Float32Array(e),i=new Vp(0,1,0);return new eg({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:i}},vertexShader:"\n      \n      varying vec3 vOutputDirection;\n  \n      void main() {\n  \n        vOutputDirection = vec3( position );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  \n      }\n    ",fragmentShader:"\n        varying vec3 vOutputDirection;\n  \n        uniform samplerCube envMap;\n        uniform int samples;\n        uniform float weights[ n ];\n        uniform bool latitudinal;\n        uniform float dTheta;\n        uniform vec3 poleAxis;\n  \n        vec3 getSample( float theta, vec3 axis ) {\n  \n          float cosTheta = cos( theta );\n          // Rodrigues' axis-angle rotation\n          vec3 sampleDirection = vOutputDirection * cosTheta\n            + cross( axis, vOutputDirection ) * sin( theta )\n            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n  \n          return vec3( textureCube( envMap, sampleDirection ) );\n  \n        }\n  \n        void main() {\n  \n          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n  \n          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n  \n            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n  \n          }\n  \n          axis = normalize( axis );\n  \n          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n  \n          for ( int i = 1; i < n; i++ ) {\n  \n            if ( i >= samples ) {\n  \n              break;\n  \n            }\n  \n            float theta = dTheta * float( i );\n            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n  \n          }\n        }\n      ",blending:0,depthTest:!1,depthWrite:!1,side:Th})}async dispose(){for(const[,e]of this.skyboxCache){(await e).dispose()}null!=this.generatedEnvironmentMap&&((await this.generatedEnvironmentMap).dispose(),this.generatedEnvironmentMap=null),null!=this.generatedEnvironmentMapAlt&&((await this.generatedEnvironmentMapAlt).dispose(),this.generatedEnvironmentMapAlt=null),null!=this.blurMaterial&&this.blurMaterial.dispose()}}const oI=[1,.79,.62,.5,.4,.31,.25],lI="high-performance";class cI extends np{static get singleton(){return this._singleton||(this._singleton=new cI({powerPreference:(self.ModelViewerElement||{}).powerPreference||lI,debug:Hb()})),this._singleton}static resetSingleton(){const e=this._singleton.dispose();for(const t of e)t.disconnectedCallback();this._singleton=new cI({powerPreference:(self.ModelViewerElement||{}).powerPreference||lI,debug:Hb()});for(const t of e)t.connectedCallback()}get canRender(){return null!=this.threeRenderer}get scaleFactor(){return oI[this.scaleStep]}set minScale(e){let t=1;for(;t<oI.length&&!(oI[t]<e);)++t;this.lastStep=t-1}constructor(e){super(),this.loader=new lw(jT),this.width=0,this.height=0,this.dpr=1,this.scenes=new Set,this.multipleScenesVisible=!1,this.lastTick=performance.now(),this.renderedLastFrame=!1,this.scaleStep=0,this.lastStep=3,this.avgFrameDuration=50,this.onWebGLContextLost=e=>{this.dispatchEvent({type:"contextlost",sourceEvent:e})},this.onWebGLContextRestored=()=>{var e;null===(e=this.textureUtils)||void 0===e||e.dispose(),this.textureUtils=new aI(this.threeRenderer);for(const t of this.scenes)t.element[Xb]()},this.dpr=window.devicePixelRatio,this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas",this.canvas3D.classList.add("show");try{this.threeRenderer=new JE({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:e.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.setPixelRatio(1),this.threeRenderer.debug={checkShaderErrors:!!e.debug,onShaderError:null},this.threeRenderer.toneMapping=ud}catch(t){console.warn(t)}this.arRenderer=new wT(this),this.textureUtils=this.canRender?new aI(this.threeRenderer):null,lw.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize()}registerScene(e){this.scenes.add(e),e.forceRescale();const t=new mp;this.threeRenderer.getSize(t),e.canvas.width=t.x,e.canvas.height=t.y,this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop(((e,t)=>this.render(e,t)))}unregisterScene(e){this.scenes.delete(e),this.canvas3D.parentElement===e.canvas.parentElement&&e.canvas.parentElement.removeChild(this.canvas3D),this.canRender&&0===this.scenes.size&&this.threeRenderer.setAnimationLoop(null)}displayCanvas(e){return e.element.modelIsVisible&&!this.multipleScenesVisible?this.canvas3D:e.element[$D]}countVisibleScenes(){const{canvas3D:e}=this;let t=0,i=null;for(const r of this.scenes){const{element:n}=r;n.modelIsVisible&&null==r.externalRenderer&&++t,e.parentElement===r.canvas.parentElement&&(i=r)}const n=t>1;if(null!=i){const t=n&&!this.multipleScenesVisible,r=!i.element.modelIsVisible;if(t||r){const{width:t,height:n}=this.sceneSize(i);this.copyPixels(i,t,n),e.parentElement.removeChild(e)}}this.multipleScenesVisible=n}updateRendererSize(){var e;const t=window.devicePixelRatio;if(t!==this.dpr)for(const r of this.scenes){const{element:e}=r;e[zD](e.getBoundingClientRect())}let i=0,n=0;for(const r of this.scenes)i=Math.max(i,r.width),n=Math.max(n,r.height);if(i!==this.width||n!==this.height||t!==this.dpr){this.width=i,this.height=n,this.dpr=t,i=Math.ceil(i*t),n=Math.ceil(n*t),this.canRender&&this.threeRenderer.setSize(i,n,!1);for(const t of this.scenes){const{canvas:r}=t;r.width=i,r.height=n,t.forceRescale(),null===(e=t.effectRenderer)||void 0===e||e.setSize(i,n)}}}updateRendererScale(e){const t=this.scaleStep;this.avgFrameDuration+=Gb(.2*(e-this.avgFrameDuration),-5,5),this.avgFrameDuration>60?++this.scaleStep:this.avgFrameDuration<40&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),t!==this.scaleStep&&(this.avgFrameDuration=50)}shouldRender(e){if(e.shouldRender())e.scaleStep!=this.scaleStep&&(e.scaleStep=this.scaleStep,this.rescaleCanvas(e));else{if(0==e.scaleStep)return!1;e.scaleStep=0,this.rescaleCanvas(e)}return!0}rescaleCanvas(e){const t=oI[e.scaleStep],i=Math.ceil(this.width/t),n=Math.ceil(this.height/t),{style:r}=e.canvas;r.width=`${i}px`,r.height=`${n}px`,this.canvas3D.style.width=`${i}px`,this.canvas3D.style.height=`${n}px`;const s=this.dpr*t,a=t<1?"GPU throttling":this.dpr!==window.devicePixelRatio?"No meta viewport tag":"";e.element.dispatchEvent(new CustomEvent("render-scale",{detail:{reportedDpr:window.devicePixelRatio,renderedDpr:s,minimumDpr:this.dpr*oI[this.lastStep],pixelWidth:Math.ceil(e.width*s),pixelHeight:Math.ceil(e.height*s),reason:a}}))}sceneSize(e){const{dpr:t}=this,i=oI[e.scaleStep];return{width:Math.min(Math.ceil(e.width*i*t),this.canvas3D.width),height:Math.min(Math.ceil(e.height*i*t),this.canvas3D.height)}}copyPixels(e,t,i){const n=e.context;null!=n?(n.clearRect(0,0,t,i),n.drawImage(this.canvas3D,0,0,t,i,0,0,t,i),e.canvas.classList.add("show")):console.log("could not acquire 2d context")}orderedScenes(){const e=[];for(const t of[!1,!0])for(const i of this.scenes)i.element.modelIsVisible===t&&e.push(i);return e}get isPresenting(){return this.arRenderer.isPresenting}preRender(e,t,i){const{element:n,exposure:r,toneMapping:s}=e;n[iR](t,i);const a="number"===typeof r&&!Number.isNaN(r),o=n.environmentImage,l=n.skyboxImage,c=s===ud&&("neutral"===o||"legacy"===o||!o&&!l);this.threeRenderer.toneMappingExposure=(a?r:1)*(c?1.3:1)}render(e,t){if(null!=t)return void this.arRenderer.onWebXRFrame(e,t);const i=e-this.lastTick;if(this.lastTick=e,!this.canRender||this.isPresenting)return;this.countVisibleScenes(),this.updateRendererSize(),this.renderedLastFrame&&(this.updateRendererScale(i),this.renderedLastFrame=!1);const{canvas3D:n}=this;for(const r of this.orderedScenes()){const{element:t}=r;if(!t.loaded||!t.modelIsVisible&&r.renderCount>0)continue;if(this.preRender(r,e,i),!this.shouldRender(r))continue;if(null!=r.externalRenderer){const e=r.getCamera();e.updateMatrix();const{matrix:t,projectionMatrix:i}=e,n=t.elements.slice(),s=r.getTarget();n[12]+=s.x,n[13]+=s.y,n[14]+=s.z,r.externalRenderer.render({viewMatrix:n,projectionMatrix:i.elements});continue}if(!t.modelIsVisible&&!this.multipleScenesVisible)for(const e of this.scenes)e.element.modelIsVisible&&e.queueRender();const{width:s,height:a}=this.sceneSize(r);r.renderShadow(this.threeRenderer),this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.ceil(this.height*this.dpr)-a,s,a),null!=r.effectRenderer?r.effectRenderer.render(i):(this.threeRenderer.autoClear=!0,this.threeRenderer.toneMapping=r.toneMapping,this.threeRenderer.render(r,r.camera)),this.multipleScenesVisible||!r.element.modelIsVisible&&0===r.renderCount?this.copyPixels(r,s,a):n.parentElement!==r.canvas.parentElement&&(r.canvas.parentElement.appendChild(n),r.canvas.classList.remove("show")),r.hasRendered(),++r.renderCount,this.renderedLastFrame=!0}}dispose(){null!=this.textureUtils&&this.textureUtils.dispose(),null!=this.threeRenderer&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;const e=[];for(const t of this.scenes)e.push(t.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),e}}const hI=Symbol("correlatedObjects"),dI=Symbol("onUpdate");class uI{constructor(e,t){this[dI]=e,this[hI]=t}}const pI=new mm,fI=new xv(2,2);let mI=0;const gI=Symbol("threeTexture"),vI=Symbol("threeTextures");Symbol("applyTexture");class yI extends uI{get[gI](){var e;return null===(e=this[hI])||void 0===e?void 0:e.values().next().value}get[vI](){return this[hI]}constructor(e,t){super(e,new Set(t?[t]:[])),this[gI].image.src||(this[gI].image.src=t.name?t.name:"adhoc_image"+mI++),this[gI].image.name||(this[gI].image.name=t&&t.image&&t.image.src?t.image.src.split("/").pop():"adhoc_image")}get name(){return this[gI].image.name||""}get uri(){return this[gI].image.src}get bufferView(){return this[gI].image.bufferView}get element(){const e=this[gI];if(e&&(e.isCanvasTexture||e.isVideoTexture))return e.image}get animation(){const e=this[gI];if(e&&e.isCanvasTexture&&e.animation)return e.animation}get type(){return null!=this.uri?"external":"embedded"}set name(e){for(const t of this[vI])t.image.name=e}update(){const e=this[gI];e&&e.isCanvasTexture&&!e.animation&&(this[gI].needsUpdate=!0,this[dI]())}async createThumbnail(e,t){const i=new pg;pI.map=this[gI];const n=new qm(fI,pI);i.add(n);const r=new my(-1,1,1,-1,0,1),{threeRenderer:s}=cI.singleton,a=new Fp(e,t);s.setRenderTarget(a),s.render(i,r),s.setRenderTarget(null);const o=new Uint8Array(e*t*4);s.readRenderTargetPixels(a,0,0,e,t,o),PD.width=e,PD.height=t;const l=PD.getContext("2d"),c=l.createImageData(e,t);return c.data.set(o),l.putImageData(c,0,0),new Promise((async(e,t)=>{PD.toBlob((i=>{if(!i)return t("Failed to capture thumbnail.");e(URL.createObjectURL(i))}),"image/png")}))}}var bI,AI;!function(e){e[e.Nearest=9728]="Nearest",e[e.Linear=9729]="Linear",e[e.NearestMipmapNearest=9984]="NearestMipmapNearest",e[e.LinearMipmapNearest=9985]="LinearMipmapNearest",e[e.NearestMipmapLinear=9986]="NearestMipmapLinear",e[e.LinearMipmapLinear=9987]="LinearMipmapLinear"}(bI||(bI={})),function(e){e[e.ClampToEdge=33071]="ClampToEdge",e[e.MirroredRepeat=33648]="MirroredRepeat",e[e.Repeat=10497]="Repeat"}(AI||(AI={}));const xI=new Map([[AI.Repeat,Ad],[AI.ClampToEdge,xd],[AI.MirroredRepeat,wd]]),wI=new Map([[Ad,AI.Repeat],[xd,AI.ClampToEdge],[wd,AI.MirroredRepeat]]),SI=new Map([[bI.Nearest,Sd],[bI.Linear,Cd],[bI.NearestMipmapNearest,_d],[bI.LinearMipmapNearest,Md],[bI.NearestMipmapLinear,Ed],[bI.LinearMipmapLinear,Td]]),_I=new Map([[Sd,bI.Nearest],[Cd,bI.Linear],[_d,bI.NearestMipmapNearest],[Md,bI.LinearMipmapNearest],[Ed,bI.NearestMipmapLinear],[Td,bI.LinearMipmapLinear]]),EI=new Map([[bI.Nearest,Sd],[bI.Linear,Cd]]),CI=new Map([[Sd,bI.Nearest],[Cd,bI.Linear]]),MI=e=>_I.has(e),TI=e=>CI.has(e),II=e=>wI.has(e),PI=Symbol("threeTexture"),DI=Symbol("threeTextures"),RI=Symbol("setProperty");class BI extends uI{get[PI](){var e;return null===(e=this[hI])||void 0===e?void 0:e.values().next().value}get[DI](){return this[hI]}constructor(e,t){super(e,new Set(t?[t]:[]))}get name(){return this[PI].name||""}get minFilter(){return _I.get(this[PI].minFilter)}get magFilter(){return CI.get(this[PI].magFilter)}get wrapS(){return wI.get(this[PI].wrapS)}get wrapT(){return wI.get(this[PI].wrapT)}get rotation(){return this[PI].rotation}get scale(){return dR(this[PI].repeat)}get offset(){return dR(this[PI].offset)}setMinFilter(e){this[RI]("minFilter",SI.get(e))}setMagFilter(e){this[RI]("magFilter",EI.get(e))}setWrapS(e){this[RI]("wrapS",xI.get(e))}setWrapT(e){this[RI]("wrapT",xI.get(e))}setRotation(e){null==e&&(e=0),this[RI]("rotation",e)}setScale(e){null==e&&(e={u:1,v:1}),this[RI]("repeat",new mp(e.u,e.v))}setOffset(e){null==e&&(e={u:0,v:0}),this[RI]("offset",new mp(e.u,e.v))}[RI](e,t){if(((e,t)=>{switch(e){case"minFilter":return MI(t);case"magFilter":return TI(t);case"wrapS":case"wrapT":return II(t);case"rotation":case"repeat":case"offset":return!0;default:throw new Error(`Cannot configure property "${e}" on Sampler`)}})(e,t))for(const i of this[DI])i[e]=t,i.needsUpdate=!0;this[dI]()}}const LI=Symbol("image"),OI=Symbol("sampler"),NI=Symbol("threeTexture");class kI extends uI{get[NI](){var e;return null===(e=this[hI])||void 0===e?void 0:e.values().next().value}constructor(e,t){super(e,new Set(t?[t]:[])),this[OI]=new BI(e,t),this[LI]=new yI(e,t)}get name(){return this[NI].name||""}set name(e){for(const t of this[hI])t.name=e}get sampler(){return this[OI]}get source(){return this[LI]}}var FI,UI,zI;const jI=Symbol("texture"),VI=Symbol("transform"),GI=Symbol("materials"),HI=Symbol("usage"),WI=Symbol("onUpdate"),QI=Symbol("activeVideo");var qI;!function(e){e[e.Base=0]="Base",e[e.MetallicRoughness=1]="MetallicRoughness",e[e.Normal=2]="Normal",e[e.Occlusion=3]="Occlusion",e[e.Emissive=4]="Emissive",e[e.Clearcoat=5]="Clearcoat",e[e.ClearcoatRoughness=6]="ClearcoatRoughness",e[e.ClearcoatNormal=7]="ClearcoatNormal",e[e.SheenColor=8]="SheenColor",e[e.SheenRoughness=9]="SheenRoughness",e[e.Transmission=10]="Transmission",e[e.Thickness=11]="Thickness",e[e.Specular=12]="Specular",e[e.SpecularColor=13]="SpecularColor",e[e.Iridescence=14]="Iridescence",e[e.IridescenceThickness=15]="IridescenceThickness",e[e.Anisotropy=16]="Anisotropy"}(qI||(qI={}));class XI{constructor(e,t,i,n){this[FI]=null,this[UI]={rotation:0,scale:new mp(1,1),offset:new mp(0,0)},this[zI]=!1,i&&(this[VI].rotation=i.rotation,this[VI].scale.copy(i.repeat),this[VI].offset.copy(i.offset),this[jI]=new kI(e,i)),this[WI]=e,this[GI]=n,this[HI]=t}get texture(){return this[jI]}setTexture(e){var t,i;const n=null!=e?e.source[gI]:null,r=null===(t=this[jI])||void 0===t?void 0:t.source[gI];if(null!=r&&r.isVideoTexture?this[QI]=!1:(null===(i=this[jI])||void 0===i?void 0:i.source.animation)&&this[jI].source.animation.removeEventListener("enterFrame",this[WI]),this[jI]=e,null!=n&&n.isVideoTexture){const e=n.image;if(this[QI]=!0,null!=e.requestVideoFrameCallback){const t=()=>{this[QI]&&(this[WI](),e.requestVideoFrameCallback(t))};e.requestVideoFrameCallback(t)}else{const e=()=>{this[QI]&&(this[WI](),requestAnimationFrame(e))};requestAnimationFrame(e)}}else null!=(null===e||void 0===e?void 0:e.source.animation)&&e.source.animation.addEventListener("enterFrame",this[WI]);let s=zu;if(this[GI])for(const a of this[GI]){switch(this[HI]){case qI.Base:a.map=n;break;case qI.MetallicRoughness:s=ju,a.metalnessMap=n,a.roughnessMap=n;break;case qI.Normal:s=ju,a.normalMap=n;break;case qI.Occlusion:s=ju,a.aoMap=n;break;case qI.Emissive:a.emissiveMap=n;break;case qI.Clearcoat:a.clearcoatMap=n;break;case qI.ClearcoatRoughness:a.clearcoatRoughnessMap=n;break;case qI.ClearcoatNormal:a.clearcoatNormalMap=n;break;case qI.SheenColor:a.sheenColorMap=n;break;case qI.SheenRoughness:a.sheenRoughnessMap=n;break;case qI.Transmission:a.transmissionMap=n;break;case qI.Thickness:a.thicknessMap=n;break;case qI.Specular:a.specularIntensityMap=n;break;case qI.SpecularColor:a.specularColorMap=n;break;case qI.Iridescence:a.iridescenceMap=n;break;case qI.IridescenceThickness:a.iridescenceThicknessMap=n;break;case qI.Anisotropy:a.anisotropyMap=n}a.needsUpdate=!0}n&&(n.colorSpace=s,n.rotation=this[VI].rotation,n.repeat=this[VI].scale,n.offset=this[VI].offset),this[WI]()}}FI=jI,UI=VI,zI=QI;const YI=Symbol("threeMaterial"),KI=Symbol("threeMaterials"),JI=Symbol("baseColorTexture"),ZI=Symbol("metallicRoughnessTexture");class $I extends uI{get[KI](){return this[hI]}get[YI](){var e;return null===(e=this[hI])||void 0===e?void 0:e.values().next().value}constructor(e,t){super(e,t);const{map:i,metalnessMap:n}=t.values().next().value;this[JI]=new XI(e,qI.Base,i,t),this[ZI]=new XI(e,qI.MetallicRoughness,n,t)}get baseColorFactor(){const e=[0,0,0,this[YI].opacity];return this[YI].color.toArray(e),e}get metallicFactor(){return this[YI].metalness}get roughnessFactor(){return this[YI].roughness}get baseColorTexture(){return this[JI]}get metallicRoughnessTexture(){return this[ZI]}setBaseColorFactor(e){const t=new dm;e instanceof Array?t.fromArray(e):t.set(e);for(const i of this[KI])i.color.set(t),e instanceof Array&&e.length>3?i.opacity=e[3]:(e=[0,0,0,i.opacity],t.toArray(e));this[dI]()}setMetallicFactor(e){for(const t of this[KI])t.metalness=e;this[dI]()}setRoughnessFactor(e){for(const t of this[KI])t.roughness=e;this[dI]()}}var eP,tP;const iP=Symbol("pbrMetallicRoughness"),nP=Symbol("normalTexture"),rP=Symbol("occlusionTexture"),sP=Symbol("emissiveTexture"),aP=Symbol("backingThreeMaterial"),oP=Symbol("applyAlphaCutoff"),lP=Symbol("getAlphaMode"),cP=Symbol("lazyLoadGLTFInfo"),hP=Symbol("initialize"),dP=Symbol("getLoadedMaterial"),uP=Symbol("ensureMaterialIsLoaded"),pP=Symbol("gltfIndex"),fP=Symbol("setActive"),mP=Symbol("variantIndices"),gP=Symbol("isActive"),vP=Symbol("modelVariants"),yP=Symbol("name"),bP=Symbol("pbrTextures");class AP extends uI{get[(eP=mP,tP=bP,aP)](){return this[hI].values().next().value}constructor(e,t,i,n,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;super(e,r),this[eP]=new Set,this[tP]=new Map,this[pP]=t,this[gP]=i,this[vP]=n,this[yP]=s,null==a?this[hP]():this[cP]=a}[hP](){const e=this[dI],t=this[hI];this[iP]=new $I(e,t);const{normalMap:i,aoMap:n,emissiveMap:r}=t.values().next().value;this[nP]=new XI(e,qI.Normal,i,t),this[rP]=new XI(e,qI.Occlusion,n,t),this[sP]=new XI(e,qI.Emissive,r,t);const s=i=>{this[bP].set(i,new XI(e,i,null,t))};s(qI.Clearcoat),s(qI.ClearcoatRoughness),s(qI.ClearcoatNormal),s(qI.SheenColor),s(qI.SheenRoughness),s(qI.Transmission),s(qI.Thickness),s(qI.Specular),s(qI.SpecularColor),s(qI.Iridescence),s(qI.IridescenceThickness),s(qI.Anisotropy)}async[dP](){if(null!=this[cP]){const e=await this[cP].doLazyLoad();return this[hP](),this[cP]=void 0,this.ensureLoaded=async()=>{},e}return null}colorFromRgb(e){const t=new dm;return e instanceof Array?t.fromArray(e):t.set(e),t}[uP](){if(null!=this[cP])throw new Error(`Material "${this.name}" has not been loaded, call 'await\n    myMaterial.ensureLoaded()' before using an unloaded material.`)}async ensureLoaded(){await this[dP]()}get isLoaded(){return null==this[cP]}get isActive(){return this[gP]}[fP](e){this[gP]=e}get name(){return this[yP]||""}set name(e){if(this[yP]=e,null!=this[hI])for(const t of this[hI])t.name=e}get pbrMetallicRoughness(){return this[uP](),this[iP]}get normalTexture(){return this[uP](),this[nP]}get occlusionTexture(){return this[uP](),this[rP]}get emissiveTexture(){return this[uP](),this[sP]}get emissiveFactor(){return this[uP](),this[aP].emissive.toArray()}get index(){return this[pP]}hasVariant(e){const t=this[vP].get(e);return null!=t&&this[mP].has(t.index)}setEmissiveFactor(e){this[uP]();const t=this.colorFromRgb(e);for(const i of this[hI])i.emissive.set(t);this[dI]()}[lP](){return this[aP].transparent?"BLEND":this[aP].alphaTest>0?"MASK":"OPAQUE"}[oP](){this[uP]();for(const e of this[hI])"MASK"===this[lP]()?void 0==e.alphaTest&&(e.alphaTest=.5):e.alphaTest=void 0,e.needsUpdate=!0}setAlphaCutoff(e){this[uP]();for(const t of this[hI])t.alphaTest=e,t.needsUpdate=!0;this[oP](),this[dI]()}getAlphaCutoff(){return this[uP](),this[aP].alphaTest}setDoubleSided(e){this[uP]();for(const t of this[hI])t.side=e?Ih:Mh,t.needsUpdate=!0;this[dI]()}getDoubleSided(){return this[uP](),this[aP].side==Ih}setAlphaMode(e){this[uP]();const t=(e,t)=>{e.transparent=t,e.depthWrite=!t};for(const i of this[hI])t(i,"BLEND"===e),i.alphaTest="MASK"===e?.5:void 0,i.needsUpdate=!0;this[dI]()}getAlphaMode(){return this[uP](),this[lP]()}get emissiveStrength(){return this[uP](),this[aP].emissiveIntensity}setEmissiveStrength(e){this[uP]();for(const t of this[hI])t.emissiveIntensity=e;this[dI]()}get clearcoatFactor(){return this[uP](),this[aP].clearcoat}get clearcoatRoughnessFactor(){return this[uP](),this[aP].clearcoatRoughness}get clearcoatTexture(){return this[uP](),this[bP].get(qI.Clearcoat)}get clearcoatRoughnessTexture(){return this[uP](),this[bP].get(qI.ClearcoatRoughness)}get clearcoatNormalTexture(){return this[uP](),this[bP].get(qI.ClearcoatNormal)}get clearcoatNormalScale(){return this[uP](),this[aP].clearcoatNormalScale.x}setClearcoatFactor(e){this[uP]();for(const t of this[hI])t.clearcoat=e;this[dI]()}setClearcoatRoughnessFactor(e){this[uP]();for(const t of this[hI])t.clearcoatRoughness=e;this[dI]()}setClearcoatNormalScale(e){this[uP]();for(const t of this[hI])t.clearcoatNormalScale=new mp(e,e);this[dI]()}get ior(){return this[uP](),this[aP].ior}setIor(e){this[uP]();for(const t of this[hI])t.ior=e;this[dI]()}get sheenColorFactor(){return this[uP](),this[aP].sheenColor.toArray()}get sheenColorTexture(){return this[uP](),this[bP].get(qI.SheenColor)}get sheenRoughnessFactor(){return this[uP](),this[aP].sheenRoughness}get sheenRoughnessTexture(){return this[uP](),this[bP].get(qI.SheenRoughness)}setSheenColorFactor(e){this[uP]();const t=this.colorFromRgb(e);for(const i of this[hI])i.sheenColor.set(t),i.sheen=1;this[dI]()}setSheenRoughnessFactor(e){this[uP]();for(const t of this[hI])t.sheenRoughness=e,t.sheen=1;this[dI]()}get transmissionFactor(){return this[uP](),this[aP].transmission}get transmissionTexture(){return this[uP](),this[bP].get(qI.Transmission)}setTransmissionFactor(e){this[uP]();for(const t of this[hI])t.transmission=e;this[dI]()}get thicknessFactor(){return this[uP](),this[aP].thickness}get thicknessTexture(){return this[uP](),this[bP].get(qI.Thickness)}get attenuationDistance(){return this[uP](),this[aP].attenuationDistance}get attenuationColor(){return this[uP](),this[aP].attenuationColor.toArray()}setThicknessFactor(e){this[uP]();for(const t of this[hI])t.thickness=e;this[dI]()}setAttenuationDistance(e){this[uP]();for(const t of this[hI])t.attenuationDistance=e;this[dI]()}setAttenuationColor(e){this[uP]();const t=this.colorFromRgb(e);for(const i of this[hI])i.attenuationColor.set(t);this[dI]()}get specularFactor(){return this[uP](),this[aP].specularIntensity}get specularTexture(){return this[uP](),this[bP].get(qI.Specular)}get specularColorFactor(){return this[uP](),this[aP].specularColor.toArray()}get specularColorTexture(){return this[uP](),this[bP].get(qI.SheenColor)}setSpecularFactor(e){this[uP]();for(const t of this[hI])t.specularIntensity=e;this[dI]()}setSpecularColorFactor(e){this[uP]();const t=this.colorFromRgb(e);for(const i of this[hI])i.specularColor.set(t);this[dI]()}get iridescenceFactor(){return this[uP](),this[aP].iridescence}get iridescenceTexture(){return this[uP](),this[bP].get(qI.Iridescence)}get iridescenceIor(){return this[uP](),this[aP].iridescenceIOR}get iridescenceThicknessMinimum(){return this[uP](),this[aP].iridescenceThicknessRange[0]}get iridescenceThicknessMaximum(){return this[uP](),this[aP].iridescenceThicknessRange[1]}get iridescenceThicknessTexture(){return this[uP](),this[bP].get(qI.IridescenceThickness)}setIridescenceFactor(e){this[uP]();for(const t of this[hI])t.iridescence=e;this[dI]()}setIridescenceIor(e){this[uP]();for(const t of this[hI])t.iridescenceIOR=e;this[dI]()}setIridescenceThicknessMinimum(e){this[uP]();for(const t of this[hI])t.iridescenceThicknessRange[0]=e;this[dI]()}setIridescenceThicknessMaximum(e){this[uP]();for(const t of this[hI])t.iridescenceThicknessRange[1]=e;this[dI]()}get anisotropyStrength(){return this[uP](),this[aP].anisotropy}get anisotropyRotation(){return this[uP](),this[aP].anisotropyRotation}get anisotropyTexture(){return this[uP](),this[bP].get(qI.Anisotropy)}setAnisotropyStrength(e){this[uP]();for(const t of this[hI])t.anisotropy=e;this[dI]()}setAnisotropyRotation(e){this[uP]();for(const t of this[hI])t.anisotropyRotation=e;this[dI]()}}class xP{constructor(e){this.name="",this.children=new Array,this.name=e}}class wP extends xP{constructor(e,t,i,n){super(e.name),this.materials=new Map,this.variantToMaterialMap=new Map,this.initialMaterialIdx=0,this.activeMaterialIdx=0,this.mesh=e;const{gltf:r,threeGLTF:s,threeObjectMap:a}=n;this.parser=s.parser,this.modelVariants=i,this.mesh.userData.variantData=i;const o=a.get(e.material);null!=o.materials?this.initialMaterialIdx=this.activeMaterialIdx=o.materials:console.error(`Primitive (${e.name}) missing initial material reference.`);const l=e.userData.associations||{};if(null==l.meshes)return void console.error("Mesh is missing primitive index association");const c=((r.meshes||[])[l.meshes].primitives||[])[l.primitives];if(null!=c){if(null!=c.material)this.materials.set(c.material,t[c.material]);else{const e=t.findIndex((e=>"Default"===e.name));e>=0?this.materials.set(e,t[e]):console.warn("gltfPrimitive has no material!")}if(c.extensions&&c.extensions.KHR_materials_variants){const e=c.extensions.KHR_materials_variants,n=s.parser.json.extensions.KHR_materials_variants.variants;for(const r of e.mappings){const e=t[r.material];this.materials.set(r.material,e);for(const t of r.variants){const{name:r}=n[t];this.variantToMaterialMap.set(t,e),e[mP].add(t),i.has(r)||i.set(r,{name:r,index:t})}}}}else console.error("Mesh primitive definition is missing.")}async setActiveMaterial(e){const t=this.materials.get(e);if(e!==this.activeMaterialIdx){const i=t[hI],n=await t[dP]();this.mesh.material=null!=n?n:i.values().next().value,this.parser.assignFinalMaterial(this.mesh),i.add(this.mesh.material),this.activeMaterialIdx=e}return this.mesh.material}getActiveMaterial(){return this.materials.get(this.activeMaterialIdx)}getMaterial(e){return this.materials.get(e)}async enableVariant(e){if(null==e)return this.setActiveMaterial(this.initialMaterialIdx);if(null!=this.variantToMaterialMap&&this.modelVariants.has(e)){const t=this.modelVariants.get(e);return this.enableVariantHelper(t.index)}return null}async enableVariantHelper(e){if(null!=this.variantToMaterialMap&&null!=e){const t=this.variantToMaterialMap.get(e);if(null!=t)return this.setActiveMaterial(t.index)}return null}async instantiateVariants(){if(null!=this.variantToMaterialMap)for(const e of this.variantToMaterialMap.keys()){const t=this.mesh.userData.variantMaterials.get(e);if(null!=t.material)continue;const i=await this.enableVariantHelper(e);null!=i&&(t.material=i)}}get variantInfo(){return this.variantToMaterialMap}addVariant(e,t){if(!this.ensureVariantIsUnused(t))return!1;this.modelVariants.has(t)||this.modelVariants.set(t,{name:t,index:this.modelVariants.size});const i=this.modelVariants.get(t).index;return e[mP].add(i),this.variantToMaterialMap.set(i,e),this.materials.set(e.index,e),this.updateVariantUserData(i,e),!0}deleteVariant(e){if(this.variantInfo.has(e)){this.variantInfo.delete(e);const t=this.mesh.userData.variantMaterials;null!=t&&t.delete(e)}}updateVariantUserData(e,t){t[mP].add(e),this.mesh.userData.variantData=this.modelVariants,this.mesh.userData.variantMaterials=this.mesh.userData.variantMaterials||new Map;this.mesh.userData.variantMaterials.set(e,{material:t[hI].values().next().value,gltfMaterialIndex:t.index})}ensureVariantIsUnused(e){const t=this.modelVariants.get(e);return null==t||!this.variantInfo.has(t.index)||(console.warn(`Primitive cannot add variant '${e}' for this material, it already exists.`),!1)}}var SP,_P,EP,CP,MP,TP;const IP=Symbol("materials"),PP=Symbol("hierarchy"),DP=Symbol("roots"),RP=Symbol("primitives"),BP=(Symbol("loadVariant"),Symbol("prepareVariantsForExport")),LP=Symbol("switchVariant"),OP=Symbol("materialFromPoint"),NP=Symbol("nodeFromPoint"),kP=Symbol("nodeFromIndex"),FP=Symbol("variantData"),UP=Symbol("availableVariants"),zP=Symbol("modelOnUpdate"),jP=Symbol("cloneMaterial");class VP{constructor(e,t,i,n){this.gltf=e,this.gltfElementMap=t,this.mapKey=i,this.doLazyLoad=n}}class GP{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};this[SP]=new Array,this[_P]=new Array,this[EP]=new Array,this[CP]=new Array,this[MP]=()=>{},this[TP]=new Map,this[zP]=t;const{gltf:i,threeGLTF:n,gltfElementMap:r}=e;for(const[o,l]of i.materials.entries()){const e=r.get(l);if(null!=e)this[IP].push(new AP(t,o,!0,this[FP],e,l.name));else{const e=(i.materials||[])[o],s=new Set;r.set(e,s);const a=async()=>{const e=await n.parser.getDependency("material",o);return s.add(e),e};this[IP].push(new AP(t,o,!1,this[FP],s,l.name,new VP(i,r,e,a)))}}const s=new Map,a=new Array;for(const o of n.scene.children)a.push(o);for(;a.length>0;){const t=a.pop();let i=null;t instanceof qm?(i=new wP(t,this.materials,this[FP],e),this[RP].push(i)):i=new xP(t.name);const n=s.get(t);null!=n?n.children.push(i):this[DP].push(i),this[PP].push(i);for(const e of t.children)a.push(e),s.set(t,i)}}get materials(){return this[IP]}[(SP=IP,_P=PP,EP=DP,CP=RP,MP=zP,TP=FP,UP)](){const e=Array.from(this[FP].values());return e.sort(((e,t)=>e.index-t.index)),e.map((e=>e.name))}getMaterialByName(e){const t=this[IP].filter((t=>t.name===e));return t.length>0?t[0]:null}[kP](e,t){const i=this[PP].find((i=>{if(i instanceof wP){const{meshes:n,primitives:r}=i.mesh.userData.associations;if(n==e&&r==t)return!0}return!1}));return null==i?null:i}[NP](e){return this[PP].find((t=>{if(t instanceof wP){if(t.mesh===e.object)return!0}return!1}))}[OP](e){return this[NP](e).getActiveMaterial()}async[LP](e){for(const t of this[RP])await t.enableVariant(e);for(const t of this.materials)t[fP](!1);for(const t of this[RP])this.materials[t.getActiveMaterial().index][fP](!0)}async[BP](){const e=new Array;for(const t of this[RP])e.push(t.instantiateVariants());await Promise.all(e)}[jP](e,t){const i=this.materials[e];i.isLoaded||console.error("Cloning an unloaded material,\n           call 'material.ensureLoaded() before cloning the material.");const n=i[hI],r=new Set;for(const[a,o]of n.entries()){const e=o.clone();e.name=t+(n.size>1?"_inst"+a:""),r.add(e)}const s=new AP(this[zP],this[IP].length,!1,this[FP],r,t);return this[IP].push(s),s}createMaterialInstanceForVariant(e,t,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=null;for(const s of this[RP]){const n=this[FP].get(i);null!=n&&s.variantInfo.has(n.index)||null!=s.getMaterial(e)&&(this.hasVariant(i)||this.createVariant(i),null==r&&(r=this[jP](e,t)),s.addVariant(r,i))}if(n&&null!=r){r[fP](!0),this.materials[e][fP](!1);for(const e of this[RP])e.enableVariant(i)}return r}createVariant(e){this[FP].has(e)?console.warn(`Variant '${e}'' already exists`):this[FP].set(e,{name:e,index:this[FP].size})}hasVariant(e){return this[FP].has(e)}setMaterialToVariant(e,t){if(null!=this[UP]().find((e=>e===t)))if(e<0||e>=this.materials.length)console.error("setMaterialToVariant(): materialIndex is out of bounds.");else for(const i of this[RP]){const n=i.getMaterial(e);null!=n&&i.addVariant(n,t)}else console.warn(`Can't add material to '${t}', the variant does not exist.'`)}updateVariantName(e,t){const i=this[FP].get(e);null!=i&&(i.name=t,this[FP].set(t,i),this[FP].delete(e))}deleteVariant(e){const t=this[FP].get(e);if(null!=t){for(const i of this.materials)i.hasVariant(e)&&i[mP].delete(t.index);for(const e of this[RP])e.deleteVariant(t.index);this[FP].delete(e)}}}var HP=function(e,t,i,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,i,a):r(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a};const WP=Symbol("currentGLTF"),QP=Symbol("originalGltfJson"),qP=Symbol("model"),XP=Symbol("getOnUpdateMethod"),YP=Symbol("buildTexture");class KP extends qm{constructor(){super(void 0,new mm({depthWrite:!1})),this.height=0,this.radius=0,this.resolution=0,this.userData.noHit=!0}get map(){return this.material.map}set map(e){this.material.map=e}isUsable(){return this.height>0&&this.radius>0&&null!=this.geometry&&null!=this.map}updateGeometry(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.height,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.radius,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:128;e==this.height&&t==this.radius&&i==this.resolution||(this.height=e,this.radius=t,this.resolution=i,e>0&&t>0&&(this.geometry.dispose(),this.geometry=function(e,t,i){const n=new wv(t,2*i,i);n.scale(1,1,-1);const r=n.getAttribute("position"),s=new Vp;for(let a=0;a<r.count;++a)if(s.fromBufferAttribute(r,a),s.y<0){const t=3*-e/2,i=s.y<t?-e/s.y:1-s.y*s.y/(3*t*t);s.multiplyScalar(i),s.toArray(r.array,3*a)}return r.needsUpdate=!0,n}(e,t,i)))}}const JP=new Vp,ZP=new Vp,$P=new Vp,eD=new gp,tD=new am,iD=new jp;class nD extends cw{constructor(e){super(document.createElement("div")),this.normal=new Vp(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=e.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(e.position),this.updateNormal(e.normal),this.surface=e.surface}get facingCamera(){return!this.element.classList.contains("hide")}show(){this.facingCamera&&this.initialized||this.updateVisibility(!0)}hide(){!this.facingCamera&&this.initialized||this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,0===this.referenceCount}updatePosition(e){if(null==e)return;const t=oC(e)[0].terms;for(let i=0;i<3;++i)this.position.setComponent(i,yC(t[i]).number);this.updateMatrixWorld()}updateNormal(e){if(null==e)return;const t=oC(e)[0].terms;for(let i=0;i<3;++i)this.normal.setComponent(i,t[i].number)}updateSurface(){const{mesh:e,tri:t,bary:i}=this;if(null==e||null==t||null==i)return;e.getVertexPosition(t.x,JP),e.getVertexPosition(t.y,ZP),e.getVertexPosition(t.z,$P),JP.toArray(eD.elements,0),ZP.toArray(eD.elements,3),$P.toArray(eD.elements,6),this.position.copy(i).applyMatrix3(eD);const n=this.parent;n.worldToLocal(e.localToWorld(this.position)),tD.set(JP,ZP,$P),tD.getNormal(this.normal).transformDirection(e.matrixWorld);const r=n.parent;iD.setFromAxisAngle(JP.set(0,1,0),-r.rotation.y),this.normal.applyQuaternion(iD)}orient(e){this.pivot.style.transform=`rotate(${e}rad)`}updateVisibility(e){this.element.classList.toggle("hide",!e),this.slot.assignedNodes().forEach((t=>{if(t.nodeType!==Node.ELEMENT_NODE)return;const i=t,n=i.dataset.visibilityAttribute;if(null!=n){const t=`data-${n}`;i.toggleAttribute(t,e)}i.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:e}}))})),this.initialized=!0}}const rD={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"},sD={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"};Math.PI,Math.PI;function aD(e,t,i){return(1-i)*e+i*t}class oD extends Qf{constructor(e,t,i){super(),this.camera=new my,this.renderTarget=null,this.renderTargetBlur=null,this.depthMaterial=new Ev,this.horizontalBlurMaterial=new eg(rD),this.verticalBlurMaterial=new eg(sD),this.intensity=0,this.softness=1,this.boundingBox=new Wp,this.size=new Vp,this.maxDimension=0,this.isAnimated=!1,this.needsUpdate=!1;const{camera:n}=this;n.rotation.x=Math.PI/2,n.left=-.5,n.right=.5,n.bottom=-.5,n.top=.5,this.add(n);const r=new xv,s=new mm({opacity:1,transparent:!0,side:Th});this.floor=new qm(r,s),this.floor.userData.noHit=!0,n.add(this.floor),this.blurPlane=new qm(r),this.blurPlane.visible=!1,n.add(this.blurPlane),e.target.add(this),this.depthMaterial.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * opacity );")},this.depthMaterial.side=Ih,this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1,this.setScene(e,t,i)}setScene(e,t,i){const{boundingBox:n,size:r,rotation:s,position:a}=this;if(this.isAnimated=e.animationNames.length>0,this.boundingBox.copy(e.boundingBox),this.size.copy(e.size),this.maxDimension=Math.max(r.x,r.y,r.z)*(this.isAnimated?2:1),this.boundingBox.getCenter(a),"back"===i){const{min:e,max:t}=n;[e.y,e.z]=[e.z,e.y],[t.y,t.z]=[t.z,t.y],[r.y,r.z]=[r.z,r.y],s.x=Math.PI/2,s.y=Math.PI}else s.x=0,s.y=0;if(this.isAnimated){const e=n.min.y,t=n.max.y;r.y=this.maxDimension,n.expandByVector(r.subScalar(this.maxDimension).multiplyScalar(-.5)),n.min.y=e,n.max.y=t,r.set(this.maxDimension,t-e,this.maxDimension)}"bottom"===i?a.y=n.min.y:a.z=n.min.y,this.setSoftness(t)}setSoftness(e){this.softness=e;const{size:t,camera:i}=this,n=this.isAnimated?2:1,r=n*Math.pow(2,9-3*e);this.setMapSize(r);const s=t.y/2,a=t.y*n;i.near=0,i.far=aD(a,s,e),this.depthMaterial.opacity=1/e,i.updateProjectionMatrix(),this.setIntensity(this.intensity),this.setOffset(0)}setMapSize(e){const{size:t}=this;this.isAnimated&&(e*=2);const i=Math.floor(t.x>t.z?e:e*t.x/t.z),n=Math.floor(t.x>t.z?e*t.z/t.x:e),r=10+i,s=10+n;if(null==this.renderTarget||this.renderTarget.width===r&&this.renderTarget.height===s||(this.renderTarget.dispose(),this.renderTarget=null,this.renderTargetBlur.dispose(),this.renderTargetBlur=null),null==this.renderTarget){const e={format:Gd};this.renderTarget=new Fp(r,s,e),this.renderTargetBlur=new Fp(r,s,e),this.floor.material.map=this.renderTarget.texture}this.camera.scale.set(t.x*(1+10/i),t.z*(1+10/n),1),this.needsUpdate=!0}setIntensity(e){this.intensity=e,e>0?(this.visible=!0,this.floor.visible=!0,this.floor.material.opacity=e*aD(.3,1,this.softness*this.softness)):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.intensity}setOffset(e){this.floor.position.z=-e+this.gap()}gap(){return.001*this.maxDimension}render(e,t){t.overrideMaterial=this.depthMaterial;const i=e.getClearAlpha();e.setClearAlpha(0),this.floor.visible=!1;const n=e.xr.enabled;e.xr.enabled=!1;const r=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.render(t,this.camera),t.overrideMaterial=null,this.floor.visible=!0,this.blurShadow(e),e.xr.enabled=n,e.setRenderTarget(r),e.setClearAlpha(i)}blurShadow(e){const{camera:t,horizontalBlurMaterial:i,verticalBlurMaterial:n,renderTarget:r,renderTargetBlur:s,blurPlane:a}=this;a.visible=!0,a.material=i,i.uniforms.h.value=1/this.renderTarget.width,i.uniforms.tDiffuse.value=this.renderTarget.texture,e.setRenderTarget(s),e.render(a,t),a.material=n,n.uniforms.v.value=1/this.renderTarget.height,n.uniforms.tDiffuse.value=this.renderTargetBlur.texture,e.setRenderTarget(r),e.render(a,t),a.visible=!1}dispose(){null!=this.renderTarget&&this.renderTarget.dispose(),null!=this.renderTargetBlur&&this.renderTargetBlur.dispose(),this.depthMaterial.dispose(),this.horizontalBlurMaterial.dispose(),this.verticalBlurMaterial.dispose(),this.floor.material.dispose(),this.floor.geometry.dispose(),this.blurPlane.geometry.dispose(),this.removeFromParent()}}const lD=new Vp,cD=new Vp,hD=new Vp,dD=new class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new yf(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new Pf,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return Ly.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Ly),this}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Ny(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(Oy),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let n=0,r=e.length;n<r;n++)Ny(e[n],this,i,t);return i.sort(Oy),i}},uD=new Vp,pD=new mp;class fD extends pg{constructor(e){let{canvas:t,element:i,width:n,height:r}=e;super(),this.annotationRenderer=new mw,this.effectRenderer=null,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.scaleStep=0,this.renderCount=0,this.externalRenderer=null,this.appendedAnimations=[],this.markedAnimations=[],this.camera=new sg(45,1,.1,100),this.xrCamera=null,this.url=null,this.pivot=new Qf,this.target=new Qf,this.animationNames=[],this.boundingBox=new Wp,this.boundingSphere=new hf,this.size=new Vp,this.idealAspect=0,this.framedFoVDeg=0,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.bakedShadows=new Set,this.exposure=1,this.toneMapping=ud,this.canScale=!0,this.isDirty=!1,this.goalTarget=new Vp,this.targetDamperX=new eC,this.targetDamperY=new eC,this.targetDamperZ=new eC,this._currentGLTF=null,this._model=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.groundedSkybox=new KP,this.name="ModelScene",this.element=i,this.canvas=t,this.camera=new sg(45,1,.1,100),this.camera.name="MainCamera",this.add(this.pivot),this.pivot.name="Pivot",this.pivot.add(this.target),this.setSize(n,r),this.target.name="Target",this.mixer=new By(this.target);const{domElement:s}=this.annotationRenderer,{style:a}=s;a.display="none",a.pointerEvents="none",a.position="absolute",a.top="0",this.element.shadowRoot.querySelector(".default").appendChild(s),this.schemaElement.setAttribute("type","application/ld+json")}get context(){return this.canvas.getContext("2d")}getCamera(){return null!=this.xrCamera?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}forceRescale(){this.scaleStep=-1,this.queueRender()}async setObject(e){this.reset(),this._model=e,this.target.add(e),await this.setupScene()}async setSource(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};if(!e||e===this.url)return void i(1);if(this.reset(),this.url=e,null!=this.externalRenderer){const e=await this.externalRenderer.load(i);return this.boundingSphere.radius=e.framedRadius,void(this.idealAspect=e.fieldOfViewAspect)}null!=this.cancelPendingSourceChange&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null);try{t=await new Promise((async(t,n)=>{this.cancelPendingSourceChange=()=>n();try{t(await this.element[sR].loader.load(e,this.element,i))}catch(r){n(r)}}))}catch(a){if(null==a)return;throw a}this.cancelPendingSourceChange=null,this.reset(),this.url=e,this._currentGLTF=t,null!=t&&(this._model=t.scene,this.target.add(t.scene));const{animations:n}=t,r=new Map,s=[];for(const o of n)r.set(o.name,o),s.push(o.name);this.animations=n,this.animationsByName=r,this.animationNames=s,await this.setupScene()}async setupScene(){this.applyTransform(),this.updateBoundingBox(),await this.updateFraming(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity),this.setGroundedSkybox()}reset(){this.url=null,this.renderCount=0,this.queueRender(),null!=this.shadow&&this.shadow.setIntensity(0),this.bakedShadows.clear();const{_model:e}=this;null!=e&&(e.removeFromParent(),this._model=null);const t=this._currentGLTF;null!=t&&(t.dispose(),this._currentGLTF=null),null!=this.currentAnimationAction&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}dispose(){this.reset(),null!=this.shadow&&(this.shadow.dispose(),this.shadow=null),this.element[WP]=null,this.element[QP]=null,this.element[qP]=null}get currentGLTF(){return this._currentGLTF}setSize(e,t){if(this.width!==e||this.height!==t){if(this.width=Math.max(e,1),this.height=Math.max(t,1),this.annotationRenderer.setSize(e,t),this.aspect=this.width/this.height,null!=this.externalRenderer){const i=window.devicePixelRatio;this.externalRenderer.resize(e*i,t*i)}this.queueRender()}}markBakedShadow(e){e.userData.noHit=!0,this.bakedShadows.add(e)}unmarkBakedShadow(e){e.userData.noHit=!1,e.visible=!0,this.bakedShadows.delete(e),this.boundingBox.expandByObject(e)}findBakedShadows(e){const t=new Wp;e.traverse((e=>{const i=e;if(!i.material)return;if(!i.material.transparent)return;t.setFromObject(i);const n=t.getSize(uD),r=Math.min(n.x,n.y,n.z);Math.max(n.x,n.y,n.z)<100*r||this.markBakedShadow(i)}))}checkBakedShadows(){const{min:e,max:t}=this.boundingBox,i=new Wp;this.boundingBox.getSize(this.size);for(const n of this.bakedShadows)i.setFromObject(n),i.min.y<e.y+this.size.y/100&&i.min.x<=e.x&&i.max.x>=t.x&&i.min.z<=e.z&&i.max.z>=t.z||i.min.z<e.z+this.size.z/100&&i.min.x<=e.x&&i.max.x>=t.x&&i.min.y<=e.y&&i.max.y>=t.y||this.unmarkBakedShadow(n)}applyTransform(){const{model:e}=this;if(null==e)return;const t=oC(this.element.orientation)[0].terms,i=yC(t[0]).number,n=yC(t[1]).number,r=yC(t[2]).number;e.quaternion.setFromEuler(new If(n,r,i,"YXZ"));const s=oC(this.element.scale)[0].terms;e.scale.set(s[0].number,s[1].number,s[2].number)}updateBoundingBox(){const{model:e}=this;if(null==e)return;this.target.remove(e),this.findBakedShadows(e);const t=(e,t)=>e.expandByPoint(t);this.setBakedShadowVisibility(!1),this.boundingBox=gw(e,t,new Wp),this.boundingBox.isEmpty()&&(this.setBakedShadowVisibility(!0),this.bakedShadows.forEach((e=>this.unmarkBakedShadow(e))),this.boundingBox=gw(e,t,new Wp)),this.checkBakedShadows(),this.setBakedShadowVisibility(),this.boundingBox.getSize(this.size),this.target.add(e)}async updateFraming(){const{model:e}=this;if(null==e)return;this.target.remove(e),this.setBakedShadowVisibility(!1);const{center:t}=this.boundingSphere;this.element.requestUpdate("cameraTarget"),await this.element.updateComplete,t.copy(this.getTarget());this.boundingSphere.radius=Math.sqrt(gw(e,((e,i)=>Math.max(e,t.distanceToSquared(i))),0));this.idealAspect=gw(e,((e,i)=>{i.sub(t);const n=Math.sqrt(i.x*i.x+i.z*i.z);return Math.max(e,n/(this.idealCameraDistance()-Math.abs(i.y)))}),0)/Math.tan(this.framedFoVDeg/2*Math.PI/180),this.setBakedShadowVisibility(),this.target.add(e)}setBakedShadowVisibility(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.shadowIntensity<=0;for(const t of this.bakedShadows)t.visible=e}idealCameraDistance(){const e=this.framedFoVDeg/2*Math.PI/180;return this.boundingSphere.radius/Math.sin(e)}adjustedFoV(e){const t=Math.tan(e/2*Math.PI/180)*Math.max(1,this.idealAspect/this.aspect);return 2*Math.atan(t)*180/Math.PI}getNDC(e,t){if(null!=this.xrCamera)pD.set(e/window.screen.width,t/window.screen.height);else{const i=this.element.getBoundingClientRect();pD.set((e-i.x)/this.width,(t-i.y)/this.height)}return pD.multiplyScalar(2).subScalar(1),pD.y*=-1,pD}getSize(){return{width:this.width,height:this.height}}setEnvironmentAndSkybox(e,t){this.element[sR].arRenderer.presentedScene!==this&&(this.environment=e,this.setBackground(t),this.queueRender())}setBackground(e){this.groundedSkybox.map=e,this.groundedSkybox.isUsable()?(this.target.add(this.groundedSkybox),this.background=null):(this.target.remove(this.groundedSkybox),this.background=e)}farRadius(){return this.boundingSphere.radius*(null!=this.groundedSkybox.parent?10:1)}setGroundedSkybox(){const e=oC(this.element.skyboxHeight)[0].terms[0],t=yC(e).number,i=10*this.boundingSphere.radius;this.groundedSkybox.updateGeometry(t,i),this.groundedSkybox.position.y=t-(this.shadow?2*this.shadow.gap():0),this.setBackground(this.groundedSkybox.map)}setTarget(e,t,i){this.goalTarget.set(-e,-t,-i)}setTargetDamperDecayTime(e){this.targetDamperX.setDecayTime(e),this.targetDamperY.setDecayTime(e),this.targetDamperZ.setDecayTime(e)}getTarget(){return this.goalTarget.clone().multiplyScalar(-1)}getDynamicTarget(){return this.target.position.clone().multiplyScalar(-1)}jumpToGoal(){this.updateTarget(1e4)}updateTarget(e){const t=this.goalTarget,i=this.target.position;if(t.equals(i))return!1;{const n=this.boundingSphere.radius/10;let{x:r,y:s,z:a}=i;return r=this.targetDamperX.update(r,t.x,e,n),s=this.targetDamperY.update(s,t.y,e,n),a=this.targetDamperZ.update(a,t.z,e,n),this.groundedSkybox.position.x=-r,this.groundedSkybox.position.z=-a,this.target.position.set(r,s,a),this.target.updateMatrixWorld(),this.queueRender(),!0}}pointTowards(e,t){const{x:i,z:n}=this.position;this.yaw=Math.atan2(e-i,t-n)}get model(){return this._model}set yaw(e){this.pivot.rotation.y=e,this.groundedSkybox.rotation.y=-e,this.queueRender()}get yaw(){return this.pivot.rotation.y}set animationTime(e){this.mixer.setTime(e),this.queueShadowRender()}get animationTime(){if(null!=this.currentAnimationAction){const e=Math.max(this.currentAnimationAction._loopCount,0);return this.currentAnimationAction.loop===Du&&1===(1&e)?this.duration-this.currentAnimationAction.time:this.currentAnimationAction.time}return 0}set animationTimeScale(e){this.mixer.timeScale=e}get animationTimeScale(){return this.mixer.timeScale}get duration(){return null!=this.currentAnimationAction&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return null!=this.currentAnimationAction}playAnimation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pu,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if(null==this._currentGLTF)return;const{animations:r}=this;if(null==r||0===r.length)return;let s=null;if(null!=e&&(s=this.animationsByName.get(e),null==s)){const t=parseInt(e);!isNaN(t)&&t>=0&&t<r.length&&(s=r[t])}null==s&&(s=r[0]);try{const{currentAnimationAction:e}=this,r=this.mixer.clipAction(s,this);r.timeScale!=this.element.timeScale&&(r.timeScale=this.element.timeScale),this.currentAnimationAction=r,this.element.paused?this.mixer.stopAllAction():(r.paused=!1,null!=e&&r!==e?r.crossFadeFrom(e,t,!1):this.animationTimeScale>0&&this.animationTime==this.duration&&(this.animationTime=0)),r.setLoop(i,n),r.enabled=!0,r.clampWhenFinished=!0,r.play()}catch(a){console.error(a)}}appendAnimation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pu,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9&&void 0!==arguments[9]&&arguments[9];if(null==this._currentGLTF||e===this.element.animationName)return;const{animations:h}=this;if(null==h||0===h.length)return;let d=null;if(e&&(d=this.animationsByName.get(e)),null!=d){"string"===typeof i?isNaN(i)?(i=1/0,console.warn("Invalid repetitionCount value, repetitionCount is set to Infinity")):i=Math.max(parseInt(i),1):"number"===typeof i&&i<1&&(i=1),1===i&&t!==Iu&&(t=Iu),"string"===typeof n&&(isNaN(n)?(n=1,console.warn("Invalid weight value, weight is set to 1")):n=parseFloat(n)),"string"===typeof r&&(isNaN(r)?(r=1,console.warn("Invalid timeScale value, timeScale is set to 1")):r=parseFloat(r)),"string"===typeof s&&("true"===s.toLowerCase().trim()?s=!0:"false"===s.toLowerCase().trim()?s=!1:isNaN(s)?(s=!1,console.warn("Invalid fade value, fade is set to false")):s=parseFloat(s)),"string"===typeof a&&("true"===a.toLowerCase().trim()?a=!0:"false"===a.toLowerCase().trim()?a=!1:isNaN(a)?(a=!1,console.warn("Invalid warp value, warp is set to false")):a=parseFloat(a)),"string"===typeof l&&(isNaN(l)||(l=parseFloat(l)));try{const h=this.mixer.existingAction(d)||this.mixer.clipAction(d,this),u=h.timeScale;c&&this.appendedAnimations.includes(e)&&(this.markedAnimations.map((e=>e.name)).includes(e)||this.markedAnimations.push({name:e,loopMode:t,repetitionCount:i})),"number"===typeof l&&(h.time=Math.min(Math.max(l,0),d.duration)),"boolean"===typeof s&&s?h.fadeIn(1.25):"number"===typeof s?h.fadeIn(Math.max(s,0)):n>=0&&(h.weight=Math.min(Math.max(n,0),1)),"boolean"===typeof a&&a?h.warp(o?u:0,r,1.25):"number"===typeof a?h.warp(o?u:0,r,Math.max(a,0)):h.timeScale=r,h.isRunning()||(h.time==d.duration&&h.stop(),h.setLoop(t,i),h.paused=!1,h.enabled=!0,h.clampWhenFinished=!0,h.play()),this.appendedAnimations.includes(e)||this.element[eR].appendedAnimations.push(e)}catch(u){console.error(u)}}}detachAnimation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null==this._currentGLTF||e===this.element.animationName)return;const{animations:i}=this;if(null==i||0===i.length)return;let n=null;if(e&&(n=this.animationsByName.get(e)),null!=n){"string"===typeof t&&("true"===t.toLowerCase().trim()?t=!0:"false"===t.toLowerCase().trim()?t=!1:isNaN(t)?(t=!0,console.warn("Invalid fade value, fade is set to true")):t=parseFloat(t));try{const i=this.mixer.existingAction(n)||this.mixer.clipAction(n,this);"boolean"===typeof t&&t?i.fadeOut(1.5):"number"===typeof t?i.fadeOut(Math.max(t,0)):i.stop();const r=this.element[eR].appendedAnimations.filter((t=>t!==e));this.element[eR].appendedAnimations=r}catch(r){console.error(r)}}}updateAnimationLoop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pu,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;if(null==this._currentGLTF||e===this.element.animationName)return;const{animations:n}=this;if(null==n||0===n.length)return;let r=null;if(e&&(r=this.animationsByName.get(e)),null!=r)try{const e=this.mixer.existingAction(r)||this.mixer.clipAction(r,this);e.stop(),e.setLoop(t,i),e.play()}catch(s){console.error(s)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(e){this.mixer.update(e),this.queueShadowRender()}subscribeMixerEvent(e,t){this.mixer.addEventListener(e,t)}updateShadow(){const e=this.shadow;if(null!=e){const t="wall"===this.element.arPlacement?"back":"bottom";e.setScene(this,this.shadowSoftness,t),e.needsUpdate=!0}}renderShadow(e){const t=this.shadow;null!=t&&1==t.needsUpdate&&(t.render(e,this),t.needsUpdate=!1)}queueShadowRender(){null!=this.shadow&&(this.shadow.needsUpdate=!0)}setShadowIntensity(e){if(this.shadowIntensity=e,null!=this._currentGLTF&&(this.setBakedShadowVisibility(),!(e<=0&&null==this.shadow))){if(null==this.shadow){const e="wall"===this.element.arPlacement?"back":"bottom";this.shadow=new oD(this,this.shadowSoftness,e)}this.shadow.setIntensity(e)}}setShadowSoftness(e){this.shadowSoftness=e;const t=this.shadow;null!=t&&t.setSoftness(e)}setShadowOffset(e){const t=this.shadow;null!=t&&t.setOffset(e)}getHit(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return dD.intersectObject(e,!0).find((e=>e.object.visible&&!e.object.userData.noHit))}hitFromController(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return dD.setFromXRController(e),this.getHit(t)}hitFromPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return dD.setFromCamera(e,this.getCamera()),this.getHit(t)}positionAndNormalFromPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;var i;const n=this.hitFromPoint(e,t);if(null==n)return null;return{position:n.point,normal:null!=n.face?n.face.normal.clone().applyNormalMatrix((new gp).getNormalMatrix(n.object.matrixWorld)):dD.ray.direction.clone().multiplyScalar(-1),uv:null!==(i=n.uv)&&void 0!==i?i:null}}surfaceFromPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;const i=this.element.model;if(null==i)return null;const n=this.hitFromPoint(e,t);if(null==n||null==n.face)return null;const r=i[NP](n),{meshes:s,primitives:a}=r.mesh.userData.associations,o=new Vp,l=new Vp,c=new Vp,{a:h,b:d,c:u}=n.face,p=n.object;p.getVertexPosition(h,o),p.getVertexPosition(d,l),p.getVertexPosition(u,c);const f=new am(o,l,c),m=new Vp;return f.getBarycoord(p.worldToLocal(n.point),m),`${s} ${a} ${h} ${d} ${u} ${m.x.toFixed(3)} ${m.y.toFixed(3)} ${m.z.toFixed(3)}`}addHotspot(e){this.target.add(e),this.annotationRenderer.domElement.appendChild(e.element),this.updateSurfaceHotspot(e)}removeHotspot(e){this.target.remove(e)}forHotspots(e){const{children:t}=this.target;for(let i=0,n=t.length;i<n;i++){const n=t[i];n instanceof nD&&e(n)}}updateSurfaceHotspot(e){if(null==e.surface||null==this.element.model)return;const t=oC(e.surface)[0].terms;if(8!=t.length)return void console.warn(e.surface+" does not have exactly 8 numbers.");const i=this.element.model[kP](t[0].number,t[1].number);if(null==i)return void console.warn(e.surface+" does not match a node/primitive in this glTF! Skipping this hotspot.");const n=i.mesh.geometry.attributes.position.count,r=new Vp(t[2].number,t[3].number,t[4].number);if(r.x>=n||r.y>=n||r.z>=n)return void console.warn(e.surface+" vertex indices out of range in this glTF! Skipping this hotspot.");const s=new Vp(t[5].number,t[6].number,t[7].number);e.mesh=i.mesh,e.tri=r,e.bary=s,e.updateSurface()}animateSurfaceHotspots(){this.element.paused||this.forHotspots((e=>{e.updateSurface()}))}updateHotspotsVisibility(e){this.forHotspots((t=>{lD.copy(e),cD.setFromMatrixPosition(t.matrixWorld),lD.sub(cD),hD.copy(t.normal).transformDirection(this.target.matrixWorld),lD.dot(hD)<0?t.hide():t.show()}))}orientHotspots(e){this.forHotspots((t=>{t.orient(e)}))}setHotspotsVisibility(e){this.forHotspots((t=>{t.visible=e}))}updateSchema(e){var t;const{schemaElement:i,element:n}=this,{alt:r,poster:s,iosSrc:a}=n;if(null!=e){const n=[{"@type":"MediaObject",contentUrl:e,encodingFormat:"gltf"===(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())?"model/gltf+json":"model/gltf-binary"}];a&&n.push({"@type":"MediaObject",contentUrl:a,encodingFormat:"model/vnd.usdz+zip"});const o={"@context":"http://schema.org/","@type":"3DModel",image:null!==s&&void 0!==s?s:void 0,name:null!==r&&void 0!==r?r:void 0,encoding:n};i.textContent=JSON.stringify(o),document.head.appendChild(i)}else null!=i.parentElement&&i.parentElement.removeChild(i)}}class mD extends EventTarget{constructor(){super(...arguments),this.ongoingActivities=new Set,this.totalProgress=0}get ongoingActivityCount(){return this.ongoingActivities.size}beginActivity(e){const t={progress:0,completed:!1};return this.ongoingActivities.add(t),1===this.ongoingActivityCount&&this.announceTotalProgress(t,0,e),i=>{let n;return n=Math.max(Gb(i,0,1),t.progress),n!==t.progress&&this.announceTotalProgress(t,n,e),t.progress}}announceTotalProgress(e,t,i){let n=0,r=0;1==t&&(e.completed=!0);for(const o of this.ongoingActivities){const{progress:e}=o;n+=1-e,o.completed&&r++}const s=e.progress;e.progress=t,this.totalProgress+=(t-s)*(1-this.totalProgress)/n;const a=r===this.ongoingActivityCount?1:this.totalProgress;this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:a,reason:i}})),r===this.ongoingActivityCount&&(this.totalProgress=0,this.ongoingActivities.clear())}}var gD,vD,yD,bD,AD,xD,wD,SD,_D,ED,CD,MD,TD,ID=function(e,t,i,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,i,a):r(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a};const PD=document.createElement("canvas"),DD=Symbol("fallbackResizeHandler"),RD=Symbol("defaultAriaLabel"),BD=Symbol("resizeObserver"),LD=Symbol("clearModelTimeout"),OD=Symbol("onContextLost"),ND=Symbol("loaded"),kD=Symbol("status"),FD=Symbol("onFocus"),UD=Symbol("onBlur"),zD=Symbol("updateSize"),jD=Symbol("intersectionObserver"),VD=Symbol("isElementInViewport"),GD=Symbol("announceModelVisibility"),HD=Symbol("ariaLabel"),WD=Symbol("altDefaulted"),QD=Symbol("statusElement"),qD=Symbol("updateStatus"),XD=Symbol("loadedTime"),YD=Symbol("updateSource"),KD=Symbol("markLoaded"),JD=Symbol("container"),ZD=Symbol("input"),$D=Symbol("canvas"),eR=Symbol("scene"),tR=Symbol("needsRender"),iR=Symbol("tick"),nR=Symbol("onModelLoad"),rR=Symbol("onResize"),sR=Symbol("renderer"),aR=Symbol("progressTracker"),oR=Symbol("getLoaded"),lR=Symbol("getModelIsVisible"),cR=Symbol("shouldAttemptPreload"),hR=e=>({x:e.x,y:e.y,z:e.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),dR=e=>({u:e.x,v:e.y,toString(){return`${this.u} ${this.v}`}});class uR extends Ah{static get is(){return"model-viewer"}static set modelCacheSize(e){lw[aw].evictionThreshold=e}static get modelCacheSize(){return lw[aw].evictionThreshold}static set minimumRenderScale(e){e>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),e<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),cI.singleton.minScale=e}static get minimumRenderScale(){return cI.singleton.minScale}get loaded(){return this[oR]()}get[(gD=VD,vD=ND,yD=XD,bD=kD,AD=LD,xD=DD,wD=GD,SD=BD,_D=jD,ED=aR,sR)](){return cI.singleton}get modelIsVisible(){return this[lR]()}constructor(){super(),this.alt=null,this.src=null,this.withCredentials=!1,this.generateSchema=!1,this[gD]=!1,this[vD]=!1,this[yD]=0,this[bD]="",this[AD]=null,this[xD]=Vb((()=>{const e=this.getBoundingClientRect();this[zD](e)}),50),this[wD]=Vb((e=>{const t=this.modelIsVisible;t!==e&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:t}}))}),0),this[SD]=null,this[_D]=null,this[ED]=new mD,this[CD]=()=>{this[QD].textContent=this[kD]},this[MD]=()=>{this[QD].textContent=""},this[TD]=e=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:e.sourceEvent}}))},this.attachShadow({mode:"open"});const e=this.shadowRoot;let t,i;if((e=>{Sb(Kb,e)})(e),this[JD]=e.querySelector(".container"),this[ZD]=e.querySelector(".userInput"),this[$D]=e.querySelector("canvas"),this[QD]=e.querySelector("#status"),this[RD]=this[ZD].getAttribute("aria-label"),this.isConnected){const e=this.getBoundingClientRect();t=e.width,i=e.height}else t=300,i=150;this[eR]=new fD({canvas:this[$D],element:this,width:t,height:i}),Promise.resolve().then((()=>{this[zD](this.getBoundingClientRect())})),Ib&&(this[BD]=new ResizeObserver((e=>{if(!this[sR].isPresenting)for(let t of e)t.target===this&&this[zD](t.contentRect)}))),Pb?this[jD]=new IntersectionObserver((e=>{for(let t of e)if(t.target===this){const e=this.modelIsVisible;this[VD]=t.isIntersecting,this[GD](e),this[VD]&&!this.loaded&&this[YD]()}}),{root:null,rootMargin:"0px",threshold:1e-5}):this[VD]=!0}connectedCallback(){super.connectedCallback&&super.connectedCallback(),Ib?this[BD].observe(this):self.addEventListener("resize",this[DD]),Pb&&this[jD].observe(this),this.addEventListener("focus",this[FD]),this.addEventListener("blur",this[UD]);const e=this[sR];e.addEventListener("contextlost",this[OD]),e.registerScene(this[eR]),null!=this[LD]&&(self.clearTimeout(this[LD]),this[LD]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),Ib?this[BD].unobserve(this):self.removeEventListener("resize",this[DD]),Pb&&this[jD].unobserve(this),this.removeEventListener("focus",this[FD]),this.removeEventListener("blur",this[UD]);const e=this[sR];e.removeEventListener("contextlost",this[OD]),e.unregisterScene(this[eR]),this[LD]=self.setTimeout((()=>{this[eR].dispose(),this[LD]=null}),10)}updated(e){super.updated(e),e.has("src")&&(null==this.src?(this[ND]=!1,this[XD]=0,this[eR].reset()):this.src!==this[eR].url&&(this[ND]=!1,this[XD]=0,this[YD]())),e.has("alt")&&this[ZD].setAttribute("aria-label",this[HD]),e.has("generateSchema")&&(this.generateSchema?this[eR].updateSchema(this.src):this[eR].updateSchema(null))}toDataURL(e,t){return this[sR].displayCanvas(this[eR]).toDataURL(e,t)}async toBlob(e){const t=e?e.mimeType:void 0,i=e?e.qualityArgument:void 0,n=e?e.idealAspect:void 0,{width:r,height:s,idealAspect:a,aspect:o}=this[eR],{dpr:l,scaleFactor:c}=this[sR];let h=r*c*l,d=s*c*l,u=0,p=0;if(!0===n)if(a>o){const e=d;d=Math.round(h/a),p=(e-d)/2}else{const e=h;h=Math.round(d*a),u=(e-h)/2}PD.width=h,PD.height=d;try{return new Promise((async(e,n)=>{PD.getContext("2d").drawImage(this[sR].displayCanvas(this[eR]),u,p,h,d,0,0,h,d),PD.toBlob((t=>{if(!t)return n(new Error("Unable to retrieve canvas blob"));e(t)}),t,i)}))}finally{this[zD]({width:r,height:s})}}registerEffectComposer(e){e.setRenderer(this[sR].threeRenderer),e.setMainCamera(this[eR].getCamera()),e.setMainScene(this[eR]),this[eR].effectRenderer=e}unregisterEffectComposer(){this[eR].effectRenderer=null}registerRenderer(e){this[eR].externalRenderer=e}unregisterRenderer(){this[eR].externalRenderer=null}get[HD](){return this[WD]}get[WD](){return null==this.alt||"null"===this.alt?this[RD]:this.alt}[oR](){return this[ND]}[lR](){return this.loaded&&this[VD]}[cR](){return!!this.src&&this[VD]}[zD](e){let{width:t,height:i}=e;0!==t&&0!==i&&(this[JD].style.width=`${t}px`,this[JD].style.height=`${i}px`,this[rR]({width:t,height:i}))}[iR](e,t){var i;null===(i=this[eR].effectRenderer)||void 0===i||i.beforeRender(e,t)}[KD](){this[ND]||(this[ND]=!0,this[XD]=performance.now())}[tR](){this[eR].queueRender()}[nR](){}[qD](e){this[kD]=e;const t=this.getRootNode();null!=t&&t.activeElement===this&&this[QD].textContent!=e&&(this[QD].textContent=e)}[(CD=FD,MD=UD,rR)](e){this[eR].setSize(e.width,e.height)}async[(TD=OD,YD)](){const e=this[eR];if(this.loaded||!this[cR]()||this.src===e.url)return;this.generateSchema&&e.updateSchema(this.src),this[qD]("Loading"),e.stopAnimation();const t=this[aR].beginActivity("model-load"),i=this.src;try{const n=e.setSource(i,(e=>t(.95*Gb(e,0,1)))),r=this[Xb]();await Promise.all([n,r]),this[KD](),this[nR](),this.updateComplete.then((()=>{this.dispatchEvent(new CustomEvent("before-render"))})),await new Promise((e=>{requestAnimationFrame((()=>{requestAnimationFrame((()=>{this.dispatchEvent(new CustomEvent("load",{detail:{url:i}})),e()}))}))}))}catch(n){this.dispatchEvent(new CustomEvent("error",{detail:{type:"loadfailure",sourceError:n}}))}finally{t(1)}}}ID([wh({type:String})],uR.prototype,"alt",void 0),ID([wh({type:String})],uR.prototype,"src",void 0),ID([wh({type:Boolean,attribute:"with-credentials"})],uR.prototype,"withCredentials",void 0),ID([wh({type:Boolean,attribute:"generate-schema"})],uR.prototype,"generateSchema",void 0);var pR=function(e,t,i,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,i,a):r(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a};const fR=Symbol("changeAnimation"),mR=Symbol("appendAnimation"),gR=Symbol("detachAnimation"),vR=Symbol("paused"),yR={repetitions:1/0,pingpong:!1},bR={pingpong:!1,repetitions:null,weight:1,timeScale:1,fade:!1,warp:!1,relativeWarp:!0,time:null},AR={fade:!0},xR=Symbol("hotspotMap"),wR=Symbol("mutationCallback"),SR=Symbol("observer"),_R=Symbol("addHotspot"),ER=Symbol("removeHotspot"),CR=new bf;var MR=Uint8Array,TR=Uint16Array,IR=Int32Array,PR=new MR([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),DR=new MR([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),RR=new MR([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),BR=function(e,t){for(var i=new TR(31),n=0;n<31;++n)i[n]=t+=1<<e[n-1];var r=new IR(i[30]);for(n=1;n<30;++n)for(var s=i[n];s<i[n+1];++s)r[s]=s-i[n]<<5|n;return{b:i,r:r}},LR=BR(PR,2),OR=LR.b,NR=LR.r;OR[28]=258,NR[258]=28;for(var kR=BR(DR,0),FR=(kR.b,kR.r),UR=new TR(32768),zR=0;zR<32768;++zR){var jR=(43690&zR)>>1|(21845&zR)<<1;jR=(61680&(jR=(52428&jR)>>2|(13107&jR)<<2))>>4|(3855&jR)<<4,UR[zR]=((65280&jR)>>8|(255&jR)<<8)>>1}var VR=function(e,t,i){for(var n=e.length,r=0,s=new TR(t);r<n;++r)e[r]&&++s[e[r]-1];var a,o=new TR(t);for(r=1;r<t;++r)o[r]=o[r-1]+s[r-1]<<1;if(i){a=new TR(1<<t);var l=15-t;for(r=0;r<n;++r)if(e[r])for(var c=r<<4|e[r],h=t-e[r],d=o[e[r]-1]++<<h,u=d|(1<<h)-1;d<=u;++d)a[UR[d]>>l]=c}else for(a=new TR(n),r=0;r<n;++r)e[r]&&(a[r]=UR[o[e[r]-1]++]>>15-e[r]);return a},GR=new MR(288);for(zR=0;zR<144;++zR)GR[zR]=8;for(zR=144;zR<256;++zR)GR[zR]=9;for(zR=256;zR<280;++zR)GR[zR]=7;for(zR=280;zR<288;++zR)GR[zR]=8;var HR=new MR(32);for(zR=0;zR<32;++zR)HR[zR]=5;var WR=VR(GR,9,0),QR=VR(HR,5,0),qR=function(e){return(e+7)/8|0},XR=function(e,t,i){return(null==t||t<0)&&(t=0),(null==i||i>e.length)&&(i=e.length),new MR(e.subarray(t,i))},YR=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],KR=function(e,t,i){var n=new Error(t||YR[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,KR),!i)throw n;return n},JR=function(e,t,i){i<<=7&t;var n=t/8|0;e[n]|=i,e[n+1]|=i>>8},ZR=function(e,t,i){i<<=7&t;var n=t/8|0;e[n]|=i,e[n+1]|=i>>8,e[n+2]|=i>>16},$R=function(e,t){for(var i=[],n=0;n<e.length;++n)e[n]&&i.push({s:n,f:e[n]});var r=i.length,s=i.slice();if(!r)return{t:aB,l:0};if(1==r){var a=new MR(i[0].s+1);return a[i[0].s]=1,{t:a,l:1}}i.sort((function(e,t){return e.f-t.f})),i.push({s:-1,f:25001});var o=i[0],l=i[1],c=0,h=1,d=2;for(i[0]={s:-1,f:o.f+l.f,l:o,r:l};h!=r-1;)o=i[i[c].f<i[d].f?c++:d++],l=i[c!=h&&i[c].f<i[d].f?c++:d++],i[h++]={s:-1,f:o.f+l.f,l:o,r:l};var u=s[0].s;for(n=1;n<r;++n)s[n].s>u&&(u=s[n].s);var p=new TR(u+1),f=eB(i[h-1],p,0);if(f>t){n=0;var m=0,g=f-t,v=1<<g;for(s.sort((function(e,t){return p[t.s]-p[e.s]||e.f-t.f}));n<r;++n){var y=s[n].s;if(!(p[y]>t))break;m+=v-(1<<f-p[y]),p[y]=t}for(m>>=g;m>0;){var b=s[n].s;p[b]<t?m-=1<<t-p[b]++-1:++n}for(;n>=0&&m;--n){var A=s[n].s;p[A]==t&&(--p[A],++m)}f=t}return{t:new MR(p),l:f}},eB=function(e,t,i){return-1==e.s?Math.max(eB(e.l,t,i+1),eB(e.r,t,i+1)):t[e.s]=i},tB=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new TR(++t),n=0,r=e[0],s=1,a=function(e){i[n++]=e},o=1;o<=t;++o)if(e[o]==r&&o!=t)++s;else{if(!r&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(r),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(r);s=1,r=e[o]}return{c:i.subarray(0,n),n:t}},iB=function(e,t){for(var i=0,n=0;n<t.length;++n)i+=e[n]*t[n];return i},nB=function(e,t,i){var n=i.length,r=qR(t+2);e[r]=255&n,e[r+1]=n>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(var s=0;s<n;++s)e[r+s+4]=i[s];return 8*(r+4+n)},rB=function(e,t,i,n,r,s,a,o,l,c,h){JR(t,h++,i),++r[256];for(var d=$R(r,15),u=d.t,p=d.l,f=$R(s,15),m=f.t,g=f.l,v=tB(u),y=v.c,b=v.n,A=tB(m),x=A.c,w=A.n,S=new TR(19),_=0;_<y.length;++_)++S[31&y[_]];for(_=0;_<x.length;++_)++S[31&x[_]];for(var E=$R(S,7),C=E.t,M=E.l,T=19;T>4&&!C[RR[T-1]];--T);var I,P,D,R,B=c+5<<3,L=iB(r,GR)+iB(s,HR)+a,O=iB(r,u)+iB(s,m)+a+14+3*T+iB(S,C)+2*S[16]+3*S[17]+7*S[18];if(l>=0&&B<=L&&B<=O)return nB(t,h,e.subarray(l,l+c));if(JR(t,h,1+(O<L)),h+=2,O<L){I=VR(u,p,0),P=u,D=VR(m,g,0),R=m;var N=VR(C,M,0);JR(t,h,b-257),JR(t,h+5,w-1),JR(t,h+10,T-4),h+=14;for(_=0;_<T;++_)JR(t,h+3*_,C[RR[_]]);h+=3*T;for(var k=[y,x],F=0;F<2;++F){var U=k[F];for(_=0;_<U.length;++_){var z=31&U[_];JR(t,h,N[z]),h+=C[z],z>15&&(JR(t,h,U[_]>>5&127),h+=U[_]>>12)}}}else I=WR,P=GR,D=QR,R=HR;for(_=0;_<o;++_){var j=n[_];if(j>255){ZR(t,h,I[(z=j>>18&31)+257]),h+=P[z+257],z>7&&(JR(t,h,j>>23&31),h+=PR[z]);var V=31&j;ZR(t,h,D[V]),h+=R[V],V>3&&(ZR(t,h,j>>5&8191),h+=DR[V])}else ZR(t,h,I[j]),h+=P[j]}return ZR(t,h,I[256]),h+P[256]},sB=new IR([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),aB=new MR(0),oB=function(e,t,i,n,r,s){var a=s.z||e.length,o=new MR(n+a+5*(1+Math.ceil(a/7e3))+r),l=o.subarray(n,o.length-r),c=s.l,h=7&(s.r||0);if(t){h&&(l[0]=s.r>>3);for(var d=sB[t-1],u=d>>13,p=8191&d,f=(1<<i)-1,m=s.p||new TR(32768),g=s.h||new TR(f+1),v=Math.ceil(i/3),y=2*v,b=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<y)&f},A=new IR(25e3),x=new TR(288),w=new TR(32),S=0,_=0,E=s.i||0,C=0,M=s.w||0,T=0;E+2<a;++E){var I=b(E),P=32767&E,D=g[I];if(m[P]=D,g[I]=P,M<=E){var R=a-E;if((S>7e3||C>24576)&&(R>423||!c)){h=rB(e,l,0,A,x,w,_,C,T,E-T,h),C=S=_=0,T=E;for(var B=0;B<286;++B)x[B]=0;for(B=0;B<30;++B)w[B]=0}var L=2,O=0,N=p,k=P-D&32767;if(R>2&&I==b(E-k))for(var F=Math.min(u,R)-1,U=Math.min(32767,E),z=Math.min(258,R);k<=U&&--N&&P!=D;){if(e[E+L]==e[E+L-k]){for(var j=0;j<z&&e[E+j]==e[E+j-k];++j);if(j>L){if(L=j,O=k,j>F)break;var V=Math.min(k,j-2),G=0;for(B=0;B<V;++B){var H=E-k+B&32767,W=H-m[H]&32767;W>G&&(G=W,D=H)}}}k+=(P=D)-(D=m[P])&32767}if(O){A[C++]=268435456|NR[L]<<18|FR[O];var Q=31&NR[L],q=31&FR[O];_+=PR[Q]+DR[q],++x[257+Q],++w[q],M=E+L,++S}else A[C++]=e[E],++x[e[E]]}}for(E=Math.max(E,M);E<a;++E)A[C++]=e[E],++x[e[E]];h=rB(e,l,c,A,x,w,_,C,T,E-T,h),c||(s.r=7&h|l[h/8|0]<<3,h-=7,s.h=g,s.p=m,s.i=E,s.w=M)}else{for(E=s.w||0;E<a+c;E+=65535){var X=E+65535;X>=a&&(l[h/8|0]=c,X=a),h=nB(l,h+1,e.subarray(E,X))}s.i=a}return XR(o,0,n+qR(h)+r)},lB=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var i=t,n=9;--n;)i=(1&i&&-306674912)^i>>>1;e[t]=i}return e}(),cB=function(){var e=-1;return{p:function(t){for(var i=e,n=0;n<t.length;++n)i=lB[255&i^t[n]]^i>>>8;e=i},d:function(){return~e}}},hB=function(e,t,i,n,r){if(!r&&(r={l:1},t.dictionary)){var s=t.dictionary.subarray(-32768),a=new MR(s.length+e.length);a.set(s),a.set(e,s.length),e=a,r.w=s.length}return oB(e,null==t.level?6:t.level,null==t.mem?r.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,i,n,r)},dB=function(e,t){var i={};for(var n in e)i[n]=e[n];for(var n in t)i[n]=t[n];return i},uB=function(e,t,i){for(;i;++t)e[t]=i,i>>>=8};function pB(e,t){return hB(e,t||{},0,0)}var fB=function(e,t,i,n){for(var r in e){var s=e[r],a=t+r,o=n;Array.isArray(s)&&(o=dB(n,s[1]),s=s[0]),s instanceof MR?i[a]=[s,o]:(i[a+="/"]=[new MR(0),o],fB(s,a,i,n))}},mB="undefined"!=typeof TextEncoder&&new TextEncoder,gB="undefined"!=typeof TextDecoder&&new TextDecoder;try{gB.decode(aB,{stream:!0}),1}catch(th){}function vB(e,t){if(t){for(var i=new MR(e.length),n=0;n<e.length;++n)i[n]=e.charCodeAt(n);return i}if(mB)return mB.encode(e);var r=e.length,s=new MR(e.length+(e.length>>1)),a=0,o=function(e){s[a++]=e};for(n=0;n<r;++n){if(a+5>s.length){var l=new MR(a+8+(r-n<<1));l.set(s),s=l}var c=e.charCodeAt(n);c<128||t?o(c):c<2048?(o(192|c>>6),o(128|63&c)):c>55295&&c<57344?(o(240|(c=65536+(1047552&c)|1023&e.charCodeAt(++n))>>18),o(128|c>>12&63),o(128|c>>6&63),o(128|63&c)):(o(224|c>>12),o(128|c>>6&63),o(128|63&c))}return XR(s,0,a)}var yB=function(e){var t=0;if(e)for(var i in e){var n=e[i].length;n>65535&&KR(9),t+=n+4}return t},bB=function(e,t,i,n,r,s,a,o){var l=n.length,c=i.extra,h=o&&o.length,d=yB(c);uB(e,t,null!=a?33639248:67324752),t+=4,null!=a&&(e[t++]=20,e[t++]=i.os),e[t]=20,t+=2,e[t++]=i.flag<<1|(s<0&&8),e[t++]=r&&8,e[t++]=255&i.compression,e[t++]=i.compression>>8;var u=new Date(null==i.mtime?Date.now():i.mtime),p=u.getFullYear()-1980;if((p<0||p>119)&&KR(10),uB(e,t,p<<25|u.getMonth()+1<<21|u.getDate()<<16|u.getHours()<<11|u.getMinutes()<<5|u.getSeconds()>>1),t+=4,-1!=s&&(uB(e,t,i.crc),uB(e,t+4,s<0?-s-2:s),uB(e,t+8,i.size)),uB(e,t+12,l),uB(e,t+14,d),t+=16,null!=a&&(uB(e,t,h),uB(e,t+6,i.attrs),uB(e,t+10,a),t+=14),e.set(n,t),t+=l,d)for(var f in c){var m=c[f],g=m.length;uB(e,t,+f),uB(e,t+2,g),e.set(m,t+4),t+=4+g}return h&&(e.set(o,t),t+=h),t},AB=function(e,t,i,n,r){uB(e,t,101010256),uB(e,t+8,i),uB(e,t+10,i),uB(e,t+12,n),uB(e,t+16,r)};"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;class xB{constructor(){this.textureUtils=null}setTextureUtils(e){this.textureUtils=e}parse(e,t,i,n){this.parseAsync(e,n).then(t).catch(i)}async parseAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},includeAnchoringProperties:!0,quickLookCompatible:!1,maxTextureSize:1024},t);const i={},n="model.usda";i[n]=null;let r=_B();r+=function(e){const t=!0===e.includeAnchoringProperties?`\n\t\ttoken preliminary:anchoring:type = "${e.ar.anchoring.type}"\n\t\ttoken preliminary:planeAnchoring:alignment = "${e.ar.planeAnchoring.alignment}"\n\t`:"";return`def Xform "Root"\n{\n\tdef Scope "Scenes" (\n\t\tkind = "sceneLibrary"\n\t)\n\t{\n\t\tdef Xform "Scene" (\n\t\t\tcustomData = {\n\t\t\t\tbool preliminary_collidesWithEnvironment = 0\n\t\t\t\tstring sceneName = "Scene"\n\t\t\t}\n\t\t\tsceneName = "Scene"\n\t\t)\n\t\t{${t}\n`}(t);const s={},a={};e.traverseVisible((e=>{if(e.isMesh){const t=e.geometry,n=e.material;if(n.isMeshStandardMaterial){const a="geometries/Geometry_"+t.id+".usda";if(!(a in i)){const e=function(e){const t=function(e){const t="Geometry",i=e.attributes,n=i.position.count;return`\n\tdef Mesh "${t}"\n\t{\n\t\tint[] faceVertexCounts = [${function(e){const t=null!==e.index?e.index.count:e.attributes.position.count;return Array(t/3).fill(3).join(", ")}(e)}]\n\t\tint[] faceVertexIndices = [${function(e){const t=e.index,i=[];if(null!==t)for(let n=0;n<t.count;n++)i.push(t.getX(n));else{const t=e.attributes.position.count;for(let e=0;e<t;e++)i.push(e)}return i.join(", ")}(e)}]\n\t\tnormal3f[] normals = [${MB(i.normal,n)}] (\n\t\t\tinterpolation = "vertex"\n\t\t)\n\t\tpoint3f[] points = [${MB(i.position,n)}]\n${function(e){let t="";for(let n=0;n<4;n++){const i=n>0?n:"",r=e["uv"+i];void 0!==r&&(t+=`\n\t\ttexCoord2f[] primvars:st${i} = [${TB(r)}] (\n\t\t\tinterpolation = "vertex"\n\t\t)`)}const i=e.color;if(void 0!==i){t+=`\n\tcolor3f[] primvars:displayColor = [${MB(i,i.count)}] (\n\t\tinterpolation = "vertex"\n\t\t)`}return t}(i)}\n\t\tuniform token subdivisionScheme = "none"\n\t}\n`}(e);return`\ndef "Geometry"\n{\n${t}\n}\n`}(t);i[a]=function(e){let t=_B();return t+=e,vB(t)}(e)}n.uuid in s||(s[n.uuid]=n),r+=function(e,t,i){const n="Object_"+e.id,r=EB(e.matrixWorld);e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e);return`def Xform "${n}" (\n\tprepend references = @./geometries/Geometry_${t.id}.usda@</Geometry>\n\tprepend apiSchemas = ["MaterialBindingAPI"]\n)\n{\n\tmatrix4d xformOp:transform = ${r}\n\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\trel material:binding = </Materials/Material_${i.id}>\n}\n\n`}(e,t,s[n.uuid])}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",e)}else e.isCamera&&(r+=function(e){const t=e.name?e.name:"Camera_"+e.id,i=EB(e.matrixWorld);e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e);return e.isOrthographicCamera?`def Camera "${t}"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ${i}\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\t\t\tfloat2 clippingRange = (${e.near.toPrecision(SB)}, ${e.far.toPrecision(SB)})\n\t\t\tfloat horizontalAperture = ${(10*(Math.abs(e.left)+Math.abs(e.right))).toPrecision(SB)}\n\t\t\tfloat verticalAperture = ${(10*(Math.abs(e.top)+Math.abs(e.bottom))).toPrecision(SB)}\n\t\t\ttoken projection = "orthographic"\n\t\t}\n\n\t`:`def Camera "${t}"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ${i}\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\n\t\t\tfloat2 clippingRange = (${e.near.toPrecision(SB)}, ${e.far.toPrecision(SB)})\n\t\t\tfloat focalLength = ${e.getFocalLength().toPrecision(SB)}\n\t\t\tfloat focusDistance = ${e.focus.toPrecision(SB)}\n\t\t\tfloat horizontalAperture = ${e.getFilmWidth().toPrecision(SB)}\n\t\t\ttoken projection = "perspective"\n\t\t\tfloat verticalAperture = ${e.getFilmHeight().toPrecision(SB)}\n\t\t}\n\n\t`}(e))})),r+="\n\t\t}\n\t}\n}\n\n",r+=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=[];for(const r in e){const s=e[r];n.push(IB(s,t,i))}return`def "Materials"\n{\n${n.join("")}\n}\n\n`}(s,a,t.quickLookCompatible),i[n]=vB(r),r=null;for(const l in a){let e=a[l];if(!0===e.isCompressedTexture){if(null===this.textureUtils)throw new Error("THREE.USDZExporter: setTextureUtils() must be called to process compressed textures.");e=await this.textureUtils.decompress(e)}const n=wB(e.image,e.flipY,t.maxTextureSize),r=await new Promise((e=>n.toBlob(e,"image/png",1)));i[`textures/Texture_${l}.png`]=new Uint8Array(await r.arrayBuffer())}let o=0;for(const l in i){const e=i[l];o+=34+l.length;const t=63&o;if(4!==t){const n=new Uint8Array(64-t);i[l]=[e,{extra:{12345:n}}]}o=e.length}return function(e,t){t||(t={});var i={},n=[];fB(e,"",i,t);var r=0,s=0;for(var a in i){var o=i[a],l=o[0],c=o[1],h=0==c.level?0:8,d=(S=vB(a)).length,u=c.comment,p=u&&vB(u),f=p&&p.length,m=yB(c.extra);d>65535&&KR(11);var g=h?pB(l,c):l,v=g.length,y=cB();y.p(l),n.push(dB(c,{size:l.length,crc:y.d(),c:g,f:S,m:p,u:d!=a.length||p&&u.length!=f,o:r,compression:h})),r+=30+d+m+v,s+=76+2*(d+m)+(f||0)+v}for(var b=new MR(s+22),A=r,x=s-r,w=0;w<n.length;++w){var S=n[w];bB(b,S.o,S,S.f,S.u,S.c.length);var _=30+S.f.length+yB(S.extra);b.set(S.c,S.o+_),bB(b,r,S,S.f,S.u,S.c.length,S.o,S.m),r+=16+_+(S.m?S.m.length:0)}return AB(b,r,n.length,x,A),b}(i,{level:0})}}function wB(e,t,i){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const n=i/Math.max(e.width,e.height),r=document.createElement("canvas");r.width=e.width*Math.min(1,n),r.height=e.height*Math.min(1,n);const s=r.getContext("2d");return!0===t&&(s.translate(0,r.height),s.scale(1,-1)),s.drawImage(e,0,0,r.width,r.height),r}throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const SB=7;function _B(){return'#usda 1.0\n(\n\tcustomLayerData = {\n\t\tstring creator = "Three.js USDZExporter"\n\t}\n\tdefaultPrim = "Root"\n\tmetersPerUnit = 1\n\tupAxis = "Y"\n)\n\n'}function EB(e){const t=e.elements;return`( ${CB(t,0)}, ${CB(t,4)}, ${CB(t,8)}, ${CB(t,12)} )`}function CB(e,t){return`(${e[t+0]}, ${e[t+1]}, ${e[t+2]}, ${e[t+3]})`}function MB(e,t){if(void 0===e)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");const i=[];for(let n=0;n<e.count;n++){const t=e.getX(n),r=e.getY(n),s=e.getZ(n);i.push(`(${t.toPrecision(SB)}, ${r.toPrecision(SB)}, ${s.toPrecision(SB)})`)}return i.join(", ")}function TB(e){const t=[];for(let i=0;i<e.count;i++){const n=e.getX(i),r=e.getY(i);t.push(`(${n.toPrecision(SB)}, ${1-r.toPrecision(SB)})`)}return t.join(", ")}function IB(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n="\t\t\t",r=[],s=[];function a(n,r,s){const a=n.source.id+"_"+n.flipY;t[a]=n;const o=n.channel>0?"st"+n.channel:"st",l={1e3:"repeat",1001:"clamp",1002:"mirror"},c=n.repeat.clone(),h=n.offset.clone(),d=n.rotation,u=Math.sin(d),p=Math.cos(d);return h.y=1-h.y-c.y,i?(h.x=h.x/c.x,h.y=h.y/c.y,h.x+=u/c.x,h.y+=p-1):(h.x+=u*c.x,h.y+=(1-p)*c.y),`\n\t\tdef Shader "PrimvarReader_${r}"\n\t\t{\n\t\t\tuniform token info:id = "UsdPrimvarReader_float2"\n\t\t\tfloat2 inputs:fallback = (0.0, 0.0)\n\t\t\ttoken inputs:varname = "${o}"\n\t\t\tfloat2 outputs:result\n\t\t}\n\n\t\tdef Shader "Transform2d_${r}"\n\t\t{\n\t\t\tuniform token info:id = "UsdTransform2d"\n\t\t\ttoken inputs:in.connect = </Materials/Material_${e.id}/PrimvarReader_${r}.outputs:result>\n\t\t\tfloat inputs:rotation = ${(d*(180/Math.PI)).toFixed(SB)}\n\t\t\tfloat2 inputs:scale = ${DB(c)}\n\t\t\tfloat2 inputs:translation = ${DB(h)}\n\t\t\tfloat2 outputs:result\n\t\t}\n\n\t\tdef Shader "Texture_${n.id}_${r}"\n\t\t{\n\t\t\tuniform token info:id = "UsdUVTexture"\n\t\t\tasset inputs:file = @textures/Texture_${a}.png@\n\t\t\tfloat2 inputs:st.connect = </Materials/Material_${e.id}/Transform2d_${r}.outputs:result>\n\t\t\t${void 0!==s?"float4 inputs:scale = "+function(e){return`(${e.r}, ${e.g}, ${e.b}, 1.0)`}(s):""}\n\t\t\ttoken inputs:sourceColorSpace = "${n.colorSpace===Uu?"raw":"sRGB"}"\n\t\t\ttoken inputs:wrapS = "${l[n.wrapS]}"\n\t\t\ttoken inputs:wrapT = "${l[n.wrapT]}"\n\t\t\tfloat outputs:r\n\t\t\tfloat outputs:g\n\t\t\tfloat outputs:b\n\t\t\tfloat3 outputs:rgb\n\t\t\t${e.transparent||e.alphaTest>0?"float outputs:a":""}\n\t\t}`}return e.side===Ih&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",e),null!==e.map?(r.push(`${n}color3f inputs:diffuseColor.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:rgb>`),e.transparent?r.push(`${n}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:a>`):e.alphaTest>0&&(r.push(`${n}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.map.id}_diffuse.outputs:a>`),r.push(`${n}float inputs:opacityThreshold = ${e.alphaTest}`)),s.push(a(e.map,"diffuse",e.color))):r.push(`${n}color3f inputs:diffuseColor = ${PB(e.color)}`),null!==e.emissiveMap?(r.push(`${n}color3f inputs:emissiveColor.connect = </Materials/Material_${e.id}/Texture_${e.emissiveMap.id}_emissive.outputs:rgb>`),s.push(a(e.emissiveMap,"emissive",new dm(e.emissive.r*e.emissiveIntensity,e.emissive.g*e.emissiveIntensity,e.emissive.b*e.emissiveIntensity)))):e.emissive.getHex()>0&&r.push(`${n}color3f inputs:emissiveColor = ${PB(e.emissive)}`),null!==e.normalMap&&(r.push(`${n}normal3f inputs:normal.connect = </Materials/Material_${e.id}/Texture_${e.normalMap.id}_normal.outputs:rgb>`),s.push(a(e.normalMap,"normal"))),null!==e.aoMap&&(r.push(`${n}float inputs:occlusion.connect = </Materials/Material_${e.id}/Texture_${e.aoMap.id}_occlusion.outputs:r>`),s.push(a(e.aoMap,"occlusion",new dm(e.aoMapIntensity,e.aoMapIntensity,e.aoMapIntensity)))),null!==e.roughnessMap?(r.push(`${n}float inputs:roughness.connect = </Materials/Material_${e.id}/Texture_${e.roughnessMap.id}_roughness.outputs:g>`),s.push(a(e.roughnessMap,"roughness",new dm(e.roughness,e.roughness,e.roughness)))):r.push(`${n}float inputs:roughness = ${e.roughness}`),null!==e.metalnessMap?(r.push(`${n}float inputs:metallic.connect = </Materials/Material_${e.id}/Texture_${e.metalnessMap.id}_metallic.outputs:b>`),s.push(a(e.metalnessMap,"metallic",new dm(e.metalness,e.metalness,e.metalness)))):r.push(`${n}float inputs:metallic = ${e.metalness}`),null!==e.alphaMap?(r.push(`${n}float inputs:opacity.connect = </Materials/Material_${e.id}/Texture_${e.alphaMap.id}_opacity.outputs:r>`),r.push(`${n}float inputs:opacityThreshold = 0.0001`),s.push(a(e.alphaMap,"opacity"))):r.push(`${n}float inputs:opacity = ${e.opacity}`),e.isMeshPhysicalMaterial&&(null!==e.clearcoatMap?(r.push(`${n}float inputs:clearcoat.connect = </Materials/Material_${e.id}/Texture_${e.clearcoatMap.id}_clearcoat.outputs:r>`),s.push(a(e.clearcoatMap,"clearcoat",new dm(e.clearcoat,e.clearcoat,e.clearcoat)))):r.push(`${n}float inputs:clearcoat = ${e.clearcoat}`),null!==e.clearcoatRoughnessMap?(r.push(`${n}float inputs:clearcoatRoughness.connect = </Materials/Material_${e.id}/Texture_${e.clearcoatRoughnessMap.id}_clearcoatRoughness.outputs:g>`),s.push(a(e.clearcoatRoughnessMap,"clearcoatRoughness",new dm(e.clearcoatRoughness,e.clearcoatRoughness,e.clearcoatRoughness)))):r.push(`${n}float inputs:clearcoatRoughness = ${e.clearcoatRoughness}`),r.push(`${n}float inputs:ior = ${e.ior}`)),`\n\tdef Material "Material_${e.id}"\n\t{\n\t\tdef Shader "PreviewSurface"\n\t\t{\n\t\t\tuniform token info:id = "UsdPreviewSurface"\n${r.join("\n")}\n\t\t\tint inputs:useSpecularWorkflow = 0\n\t\t\ttoken outputs:surface\n\t\t}\n\n\t\ttoken outputs:surface.connect = </Materials/Material_${e.id}/PreviewSurface.outputs:surface>\n\n${s.join("\n")}\n\n\t}\n`}function PB(e){return`(${e.r}, ${e.g}, ${e.b})`}function DB(e){return`(${e.x}, ${e.y})`}var RB=function(e,t,i,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,i,a):r(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a};let BB=!1,LB=!1;const OB="#model-viewer-no-ar-fallback",NB=(kB=["quick-look","scene-viewer","webxr","none"],e=>{try{const t=oC(e),i=(t.length?t[0].terms:[]).filter((e=>e&&"ident"===e.type)).map((e=>e.value)).filter((e=>kB.indexOf(e)>-1));return new Set(i)}catch(t){}return new Set});var kB;const FB="quick-look",UB="scene-viewer",zB="webxr",jB="none",VB=Symbol("arButtonContainer"),GB=Symbol("enterARWithWebXR"),HB=Symbol("openSceneViewer"),WB=Symbol("openIOSARQuickLook"),QB=Symbol("canActivateAR"),qB=Symbol("arMode"),XB=Symbol("arModes"),YB=Symbol("arAnchor"),KB=Symbol("preload"),JB=Symbol("onARButtonContainerClick"),ZB=Symbol("onARStatus"),$B=Symbol("onARTracking"),eL=Symbol("onARTap"),tL=Symbol("selectARMode"),iL=Symbol("triggerLoad");var nL=function(e,t,i,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,i,a):r(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a};const rL="auto",sL="auto",aL="eager",oL=Symbol("defaultProgressBarElement"),lL=Symbol("posterContainerElement"),cL=Symbol("defaultPosterElement"),hL=Symbol("shouldDismissPoster"),dL=Symbol("hidePoster"),uL=Symbol("modelIsRevealed"),pL=Symbol("updateProgressBar"),fL=Symbol("ariaLabelCallToAction"),mL=Symbol("onProgress");var gL=function(e,t,i,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,i,a):r(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a};const vL=Math.PI/32,yL={basis:[gC(aC(vL,"rad"))],keywords:{auto:[null]}},bL=Symbol("autoRotateStartTime"),AL=Symbol("radiansPerSecond"),xL=Symbol("syncRotationRate"),wL=Symbol("onCameraChange"),SL=(e=>{var t,i,n;class r extends e{constructor(){super(...arguments),this[t]=new Map,this[i]=e=>{e.forEach((e=>{e instanceof MutationRecord&&"childList"!==e.type||(e.addedNodes.forEach((e=>{this[_R](e)})),e.removedNodes.forEach((e=>{this[ER](e)})),this[tR]())}))},this[n]=new MutationObserver(this[wR])}connectedCallback(){super.connectedCallback();for(let t=0;t<this.children.length;++t)this[_R](this.children[t]);const{ShadyDOM:e}=self;null==e?this[SR].observe(this,{childList:!0}):this[SR]=e.observeChildren(this,this[wR])}disconnectedCallback(){super.disconnectedCallback();const{ShadyDOM:e}=self;null==e?this[SR].disconnect():e.unobserveChildren(this[SR])}[(t=xR,i=wR,n=SR,nR)](){super[nR]();const e=this[eR];e.forHotspots((t=>{e.updateSurfaceHotspot(t)}))}[iR](e,t){super[iR](e,t);const i=this[eR],{annotationRenderer:n}=i,r=i.getCamera();i.shouldRender()&&(i.animateSurfaceHotspots(),i.updateHotspotsVisibility(r.position),n.domElement.style.display="",n.render(i,r))}updateHotspot(e){const t=this[xR].get(e.name);null!=t&&(t.updatePosition(e.position),t.updateNormal(e.normal),t.surface=e.surface,this[eR].updateSurfaceHotspot(t),this[tR]())}queryHotspot(e){const t=this[xR].get(e);if(null==t)return null;const i=hR(t.position),n=hR(t.normal),r=t.facingCamera,s=this[eR],a=s.getCamera(),o=new Vp;o.setFromMatrixPosition(t.matrixWorld),o.project(a);const l=s.width/2,c=s.height/2;o.x=o.x*l+l,o.y=-o.y*c+c;const h=hR(new Vp(o.x,o.y,o.z));return Number.isFinite(h.x)&&Number.isFinite(h.y)?{position:i,normal:n,canvasPosition:h,facingCamera:r}:null}positionAndNormalFromPoint(e,t){const i=this[eR],n=i.getNDC(e,t),r=i.positionAndNormalFromPoint(n);if(null==r)return null;CR.copy(i.target.matrixWorld).invert();const s=hR(r.position.applyMatrix4(CR)),a=hR(r.normal.transformDirection(CR));let o=null;return null!=r.uv&&(o=dR(r.uv)),{position:s,normal:a,uv:o}}surfaceFromPoint(e,t){const i=this[eR],n=i.getNDC(e,t);return i.surfaceFromPoint(n)}[_R](e){if(!(e instanceof HTMLElement&&0===e.slot.indexOf("hotspot")))return;let t=this[xR].get(e.slot);null!=t?t.increment():(t=new nD({name:e.slot,position:e.dataset.position,normal:e.dataset.normal,surface:e.dataset.surface}),this[xR].set(e.slot,t),this[eR].addHotspot(t)),this[eR].queueRender()}[ER](e){if(!(e instanceof HTMLElement))return;const t=this[xR].get(e.slot);t&&(t.decrement()&&(this[eR].removeHotspot(t),this[xR].delete(e.slot)),this[eR].queueRender())}}return r})((e=>{var t,i,n;class r extends e{constructor(){super(...arguments),this[t]=void 0,this[i]=null,this[n]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[qP]}get availableVariants(){return this.model?this.model[UP]():[]}get originalGltfJson(){return this[QP]}[(t=qP,i=WP,n=QP,XP)](){return()=>{this[tR]()}}[YP](e){return e.colorSpace=zu,e.wrapS=Ad,e.wrapT=Ad,new kI(this[XP](),e)}async createTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";const{textureUtils:i}=this[sR],n=await i.loadImage(e,this.withCredentials);return n.userData.mimeType=t,this[YP](n)}async createLottieTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const{textureUtils:i}=this[sR],n=await i.loadLottie(e,t,this.withCredentials);return this[YP](n)}createVideoTexture(e){const t=document.createElement("video");t.crossOrigin=this.withCredentials?"use-credentials":"anonymous",t.src=e,t.muted=!0,t.playsInline=!0,t.loop=!0,t.play();const i=new mv(t);return this[YP](i)}createCanvasTexture(){const e=document.createElement("canvas"),t=new bv(e);return this[YP](t)}async updated(e){if(super.updated(e),e.has("variantName")){const e=this[aR].beginActivity("variant-update");e(.1);const t=this[qP],{variantName:i}=this;null!=t&&(await t[LP](i),this[tR](),this.dispatchEvent(new CustomEvent("variant-applied"))),e(1)}if(e.has("orientation")||e.has("scale")){if(!this.loaded)return;const e=this[eR];e.applyTransform(),e.updateBoundingBox(),e.updateShadow(),this[sR].arRenderer.onUpdateScene(),this[tR]()}}[nR](){super[nR]();const{currentGLTF:e}=this[eR];if(null!=e){const{correlatedSceneGraph:t}=e;null!=t&&e!==this[WP]&&(this[qP]=new GP(t,this[XP]()),this[QP]=JSON.parse(JSON.stringify(t.gltf))),"variants"in e.userData&&this.requestUpdate("variantName")}this[WP]=e}async exportScene(e){const t=this[eR];return new Promise((async(i,n)=>{const r={binary:!0,onlyVisible:!0,maxTextureSize:1/0,includeCustomExtensions:!1,forceIndices:!1};Object.assign(r,e),r.animations=t.animations,r.truncateDrawRange=!0;const s=t.shadow;let a=!1;null!=s&&(a=s.visible,s.visible=!1),await this[qP][BP]();(new yw).register((e=>new pS(e))).parse(t.model,(e=>i(new Blob([r.binary?e:JSON.stringify(e)],{type:r.binary?"application/octet-stream":"application/json"}))),(()=>n("glTF export failed")),r),null!=s&&(s.visible=a)}))}materialFromPoint(e,t){const i=this[qP];if(null==i)return null;const n=this[eR],r=n.getNDC(e,t),s=n.hitFromPoint(r);return null==s||null==s.face?null:i[OP](s)}}return HP([wh({type:String,attribute:"variant-name"})],r.prototype,"variantName",void 0),HP([wh({type:String,attribute:"orientation"})],r.prototype,"orientation",void 0),HP([wh({type:String,attribute:"scale"})],r.prototype,"scale",void 0),r})((e=>{var t,i,n;class r extends e{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=3e3,this.rotationPerSecond="auto",this[t]=performance.now(),this[i]=0,this[n]=e=>{this.autoRotate&&"user-interaction"===e.detail.source&&(this[bL]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[wL]),this[bL]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[wL]),this[bL]=performance.now()}updated(e){super.updated(e),e.has("autoRotate")&&(this[bL]=performance.now())}[(t=bL,i=AL,xL)](e){this[AL]=e[0]}[iR](e,t){if(super[iR](e,t),!this.autoRotate||!this[lR]()||this[sR].isPresenting)return;const i=Math.min(t,e-this[bL]-this.autoRotateDelay);i>0&&(this[eR].yaw=this.turntableRotation+this[AL]*i*.001)}get turntableRotation(){return this[eR].yaw}resetTurntableRotation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this[eR].yaw=e}}return n=wL,gL([wh({type:Boolean,attribute:"auto-rotate"})],r.prototype,"autoRotate",void 0),gL([wh({type:Number,attribute:"auto-rotate-delay"})],r.prototype,"autoRotateDelay",void 0),gL([iM({intrinsics:yL,updateHandler:xL}),wh({type:String,attribute:"rotation-per-second"})],r.prototype,"rotationPerSecond",void 0),r})((e=>{var t,i,n;class r extends e{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=0,this.shadowSoftness=1,this.exposure=1,this.toneMapping="auto",this.skyboxHeight="0",this[t]=null,this[i]=null,this[n]=null}updated(e){super.updated(e),e.has("shadowIntensity")&&(this[eR].setShadowIntensity(.5*this.shadowIntensity),this[tR]()),e.has("shadowSoftness")&&(this[eR].setShadowSoftness(this.shadowSoftness),this[tR]()),e.has("exposure")&&(this[eR].exposure=this.exposure,this[tR]()),e.has("toneMapping")&&(this[eR].toneMapping="aces"===this.toneMapping?cd:"agx"===this.toneMapping?dd:"reinhard"===this.toneMapping?od:"cineon"===this.toneMapping?ld:"linear"===this.toneMapping?ad:"none"===this.toneMapping?sd:ud,this[tR]()),(e.has("environmentImage")||e.has("skyboxImage"))&&this[cR]()&&this[Xb](),e.has("skyboxHeight")&&(this[eR].setGroundedSkybox(),this[tR]())}hasBakedShadow(){return this[eR].bakedShadows.size>0}async[(t=Qb,i=qb,n=Yb,Xb)](){const{skyboxImage:e,environmentImage:t}=this;null!=this[Yb]&&(this[Yb](),this[Yb]=null);const{textureUtils:i}=this[sR];if(null==i)return;const n=this[aR].beginActivity("environment-update");try{const{environmentMap:r,skybox:s}=await i.generateEnvironmentMapAndSkybox(Ub(e),t,(e=>n(Gb(e,0,1))),this.withCredentials);this[Qb]!==r&&(this[Qb]=r,this.dispatchEvent(new CustomEvent("environment-change"))),this[qb]=null!=s?s.name===r.name?r:s:null,this[eR].setEnvironmentAndSkybox(this[Qb],this[qb])}catch(r){if(r instanceof Error)throw this[eR].setEnvironmentAndSkybox(null,null),r}finally{n(1)}}}return Wb([wh({type:String,attribute:"environment-image"})],r.prototype,"environmentImage",void 0),Wb([wh({type:String,attribute:"skybox-image"})],r.prototype,"skyboxImage",void 0),Wb([wh({type:Number,attribute:"shadow-intensity"})],r.prototype,"shadowIntensity",void 0),Wb([wh({type:Number,attribute:"shadow-softness"})],r.prototype,"shadowSoftness",void 0),Wb([wh({type:Number})],r.prototype,"exposure",void 0),Wb([wh({type:String,attribute:"tone-mapping"})],r.prototype,"toneMapping",void 0),Wb([wh({type:String,attribute:"skybox-height"})],r.prototype,"skyboxHeight",void 0),r})((e=>{var t,i,n,r,s,a,o,l,c,h,d,u,p,f,m,g,v,y;class b extends e{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit=cM,this.cameraTarget="auto auto auto",this.fieldOfView="auto",this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=3e3,this.interactionPrompt=uM,this.interactionPromptStyle=fM,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.touchAction=mM,this.disableZoom=!1,this.disablePan=!1,this.disableTap=!1,this.interpolationDecay=50,this.a11y=null,this[t]=this.shadowRoot.querySelector(".interaction-prompt"),this[i]=this.shadowRoot.querySelector("#prompt"),this[n]=[this.shadowRoot.querySelector("#finger0"),this.shadowRoot.querySelector("#finger1")],this[r]=this.shadowRoot.querySelector(".pan-target"),this[s]=0,this[a]=1/0,this[o]=!1,this[l]=!1,this[c]=aT.AUTOMATIC,this[h]=new oT(this[eR].camera,this[ZD],this[eR]),this[d]=new ky,this[u]=!1,this[p]=!1,this[f]=!1,this[m]={},this[g]=()=>{const e=this[CM].changeSource;this[GM]=e,e===aT.USER_INTERACTION&&(this[zM]=!0,this[DM]())},this[v]=()=>{this[RM](),this[tR]();const e=this[CM].changeSource;this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:e}}))},this[y]=e=>{this[JD].classList.toggle("pointer-tumbling","pointer-change-start"===e.type)}}get inputSensitivity(){return this[CM].inputSensitivity}set inputSensitivity(e){this[CM].inputSensitivity=e}getCameraOrbit(){const{theta:e,phi:t,radius:i}=this[HM];return{theta:e,phi:t,radius:i,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return hR(this[sR].isPresenting?this[sR].arRenderer.target:this[eR].getDynamicTarget())}getFieldOfView(){return this[CM].getFieldOfView()}getMinimumFieldOfView(){return this[CM].options.minimumFieldOfView}getMaximumFieldOfView(){return this[CM].options.maximumFieldOfView}getIdealAspect(){return this[eR].idealAspect}jumpCameraToGoal(){this[WM]=!0,this.requestUpdate(WM,!1)}resetInteractionPrompt(){this[VM]=0,this[jM]=1/0,this[zM]=!1,this[UM]=this.interactionPrompt===uM&&this.cameraControls}zoom(e){const t=new WheelEvent("wheel",{deltaY:-30*e});this[ZD].dispatchEvent(t)}connectedCallback(){super.connectedCallback(),this[CM].addEventListener("user-interaction",this[NM]),this[CM].addEventListener("pointer-change-start",this[FM]),this[CM].addEventListener("pointer-change-end",this[FM])}disconnectedCallback(){super.disconnectedCallback(),this[CM].removeEventListener("user-interaction",this[NM]),this[CM].removeEventListener("pointer-change-start",this[FM]),this[CM].removeEventListener("pointer-change-end",this[FM])}updated(e){super.updated(e);const t=this[CM],i=this[eR];if(e.has("cameraControls")&&(this.cameraControls?(t.enableInteraction(),this.interactionPrompt===uM&&(this[UM]=!0)):(t.disableInteraction(),this[DM]()),this[ZD].setAttribute("aria-label",this[HD])),e.has("disableZoom")&&(t.disableZoom=this.disableZoom),e.has("disablePan")&&(t.enablePan=!this.disablePan),e.has("disableTap")&&(t.enableTap=!this.disableTap),(e.has("interactionPrompt")||e.has("cameraControls")||e.has("src"))&&(this.interactionPrompt===uM&&this.cameraControls&&!this[zM]?this[UM]=!0:this[DM]()),e.has("interactionPromptStyle")&&(this[IM].style.opacity=this.interactionPromptStyle==pM?"1":"0"),e.has("touchAction")){const e=this.touchAction;t.applyOptions({touchAction:e}),t.updateTouchActionStyle()}e.has("orbitSensitivity")&&(t.orbitSensitivity=this.orbitSensitivity),e.has("zoomSensitivity")&&(t.zoomSensitivity=this.zoomSensitivity),e.has("panSensitivity")&&(t.panSensitivity=this.panSensitivity),e.has("interpolationDecay")&&(t.setDamperDecayTime(this.interpolationDecay),i.setTargetDamperDecayTime(this.interpolationDecay)),e.has("a11y")&&this[LM](),!0===this[WM]&&Promise.resolve().then((()=>{t.jumpToGoal(),i.jumpToGoal(),this[kM](),this[WM]=!1}))}async updateFraming(){const e=this[eR],t=e.adjustedFoV(e.framedFoVDeg);await e.updateFraming();const i=e.adjustedFoV(e.framedFoVDeg),n=this[CM].getFieldOfView()/t;this[CM].setFieldOfView(i*n),this[qM]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),this.requestUpdate("cameraOrbit"),await this.updateComplete}interact(e,t,i){const n=this[ZD],r=this[PM];if("1"===r[0].style.opacity)return void console.warn("interact() failed because an existing interaction is running.");const s=new Array;s.push({x:sM(t.x),y:sM(t.y)});const a=[{x:s[0].x(0),y:s[0].y(0)}];null!=i&&(s.push({x:sM(i.x),y:sM(i.y)}),a.push({x:s[1].x(0),y:s[1].y(0)}));let o=performance.now();const{width:l,height:c}=this[eR],h=this.getBoundingClientRect(),d=e=>{for(const[t,i]of a.entries()){const{style:s}=r[t];s.transform=`translateX(${l*i.x}px) translateY(${c*i.y}px)`,"pointerdown"===e?s.opacity="1":"pointerup"===e&&(s.opacity="0");const a={pointerId:t-5678,pointerType:"touch",target:n,clientX:l*i.x+h.x,clientY:c*i.y+h.y,altKey:!0};n.dispatchEvent(new PointerEvent(e,a))}},u=()=>{const t=this[GM];if(t!==aT.AUTOMATIC||!n.isConnected){for(const e of this[PM])e.style.opacity="0";return d("pointercancel"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:t}})),void document.removeEventListener("visibilitychange",p)}const i=Math.min(1,(performance.now()-o)/e);for(const[e,n]of a.entries())n.x=s[e].x(i),n.y=s[e].y(i);d("pointermove"),i<1?requestAnimationFrame(u):(d("pointerup"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:aT.AUTOMATIC}})),document.removeEventListener("visibilitychange",p))},p=()=>{let e=0;"hidden"===document.visibilityState?e=performance.now()-o:o=performance.now()-e};document.addEventListener("visibilitychange",p),d("pointerdown"),this[GM]=aT.AUTOMATIC,requestAnimationFrame(u)}[(t=TM,i=IM,n=PM,r=MM,s=VM,a=jM,o=zM,l=UM,c=GM,h=CM,d=HM,u=WM,p=QM,f=qM,m=BM,YM)](e){const t=this[CM],i=this[eR];i.framedFoVDeg=180*e[0]/Math.PI,t.changeSource=aT.NONE,t.setFieldOfView(i.adjustedFoV(i.framedFoVDeg)),this[NM]()}[XM](e){const t=this[CM];if(this[qM]){const{theta:t,phi:i}=this.getCameraOrbit();e[0]=t,e[1]=i,this[qM]=!1}t.changeSource=aT.NONE,t.setOrbit(e[0],e[1],e[2]),this[NM]()}[JM](e){this[CM].applyOptions({minimumAzimuthalAngle:e[0],minimumPolarAngle:e[1],minimumRadius:e[2]}),this.jumpCameraToGoal()}[ZM](e){this[CM].applyOptions({maximumAzimuthalAngle:e[0],maximumPolarAngle:e[1],maximumRadius:e[2]}),this[OM](e[2]),this.jumpCameraToGoal()}[$M](e){this[CM].applyOptions({minimumFieldOfView:180*e[0]/Math.PI}),this.jumpCameraToGoal()}[eT](e){const t=this[eR].adjustedFoV(180*e[0]/Math.PI);this[CM].applyOptions({maximumFieldOfView:t}),this.jumpCameraToGoal()}[KM](e){const[t,i,n]=e;this[sR].arRenderer.isPresenting||this[eR].setTarget(t,i,n),this[CM].changeSource=aT.NONE,this[sR].arRenderer.updateTarget(),this[NM]()}[iR](e,t){if(super[iR](e,t),this[sR].isPresenting||!this[lR]())return;const i=this[CM],n=this[eR],r=performance.now();if(this[UM]&&this.loaded&&r>this[XD]+this.interactionPromptThreshold&&(this[UM]=!1,this[jM]=r,this[TM].classList.add("visible")),isFinite(this[jM])&&this.interactionPromptStyle===fM){const e=(r-this[jM])/5e3%1,t=oM(e),s=lM(e);if(this[IM].style.opacity=`${s}`,t!==this[VM]){const e=t*n.width*.05,r=(t-this[VM])*Math.PI/16;this[IM].style.transform=`translateX(${e}px)`,i.changeSource=aT.AUTOMATIC,i.adjustOrbit(r,0,0),this[VM]=t}}const s=i.update(e,t),a=n.updateTarget(t);(s||a)&&this[kM]()}[DM](){this[UM]=!1,this[TM].classList.remove("visible"),this[jM]=1/0}[OM](e){const t=Math.max(this[eR].farRadius(),e),i=Math.abs(2*t);this[CM].updateNearFar(0,i)}[RM](){const{theta:e,phi:t}=this[CM].getCameraSpherical(this[HM]),i=(4+Math.floor((e%EM+_M)/wM))%4,n=Math.floor(t/SM),r=`${dM[n]}${hM[i]}`,s=r;s in this[BM]?this[qD](this[BM][s]):this[qD](`View from stage ${r}`)}get[HD](){let e=". Use mouse, touch or arrow keys to move.";return"interaction-prompt"in this[BM]&&(e=`. ${this[BM]["interaction-prompt"]}`),super[HD].replace(/\.$/,"")+(this.cameraControls?e:"")}async[rR](e){const t=this[CM],i=this[eR],n=i.adjustedFoV(i.framedFoVDeg);super[rR](e);const r=i.adjustedFoV(i.framedFoVDeg)/n,s=t.getFieldOfView()*(isFinite(r)?r:1);t.updateAspect(this[eR].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),await this.updateComplete,this[CM].setFieldOfView(s),this.jumpCameraToGoal()}[nR](){super[nR](),this[QM]?this[qM]=!0:this[QM]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}[(g=NM,v=kM,y=FM,LM)](){if("string"===typeof this.a11y)if(this.a11y.startsWith("{"))try{this[BM]=JSON.parse(this.a11y)}catch(e){console.warn("Error parsing a11y JSON:",e)}else this.a11y.length>0?console.warn("Error not supported format, should be a JSON string:",this.a11y):this[BM]={};else"object"===typeof this.a11y&&null!=this.a11y?this[BM]=Object.assign({},this.a11y):this[BM]={};this[ZD].setAttribute("aria-label",this[HD])}}return aM([wh({type:Boolean,attribute:"camera-controls"})],b.prototype,"cameraControls",void 0),aM([iM({intrinsics:yM,observeEffects:!0,updateHandler:XM}),wh({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],b.prototype,"cameraOrbit",void 0),aM([iM({intrinsics:xM,observeEffects:!0,updateHandler:KM}),wh({type:String,attribute:"camera-target",hasChanged:()=>!0})],b.prototype,"cameraTarget",void 0),aM([iM({intrinsics:gM,observeEffects:!0,updateHandler:YM}),wh({type:String,attribute:"field-of-view",hasChanged:()=>!0})],b.prototype,"fieldOfView",void 0),aM([iM({intrinsics:bM,updateHandler:JM}),wh({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],b.prototype,"minCameraOrbit",void 0),aM([iM({intrinsics:AM,updateHandler:ZM}),wh({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],b.prototype,"maxCameraOrbit",void 0),aM([iM({intrinsics:vM,updateHandler:$M}),wh({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],b.prototype,"minFieldOfView",void 0),aM([iM({intrinsics:gM,updateHandler:eT}),wh({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],b.prototype,"maxFieldOfView",void 0),aM([wh({type:Number,attribute:"interaction-prompt-threshold"})],b.prototype,"interactionPromptThreshold",void 0),aM([wh({type:String,attribute:"interaction-prompt"})],b.prototype,"interactionPrompt",void 0),aM([wh({type:String,attribute:"interaction-prompt-style"})],b.prototype,"interactionPromptStyle",void 0),aM([wh({type:Number,attribute:"orbit-sensitivity"})],b.prototype,"orbitSensitivity",void 0),aM([wh({type:Number,attribute:"zoom-sensitivity"})],b.prototype,"zoomSensitivity",void 0),aM([wh({type:Number,attribute:"pan-sensitivity"})],b.prototype,"panSensitivity",void 0),aM([wh({type:String,attribute:"touch-action"})],b.prototype,"touchAction",void 0),aM([wh({type:Boolean,attribute:"disable-zoom"})],b.prototype,"disableZoom",void 0),aM([wh({type:Boolean,attribute:"disable-pan"})],b.prototype,"disablePan",void 0),aM([wh({type:Boolean,attribute:"disable-tap"})],b.prototype,"disableTap",void 0),aM([wh({type:Number,attribute:"interpolation-decay"})],b.prototype,"interpolationDecay",void 0),aM([wh()],b.prototype,"a11y",void 0),b})((e=>{var t,i,n,r,s,a,o,l,c,h;class d extends e{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arUsdzMaxTextureSize="auto",this.arPlacement="floor",this.arModes="webxr scene-viewer quick-look",this.iosSrc=null,this.xrEnvironment=!1,this[t]=!1,this[i]=this.shadowRoot.querySelector(".ar-button"),this[n]=document.createElement("a"),this[r]=new Set,this[s]=jB,this[a]=!1,this[o]=e=>{e.preventDefault(),this.activateAR()},this[l]=e=>{let{status:t}=e;t!==cT&&this[sR].arRenderer.presentedScene!==this[eR]||(this.setAttribute("ar-status",t),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:t}})),t===cT?this.removeAttribute("ar-tracking"):t===hT&&this.setAttribute("ar-tracking",pT))},this[c]=e=>{let{status:t}=e;this.setAttribute("ar-tracking",t),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:t}}))},this[h]=e=>{"_apple_ar_quicklook_button_tapped"==e.data&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[qB]!==jB}connectedCallback(){super.connectedCallback(),this[sR].arRenderer.addEventListener("status",this[ZB]),this.setAttribute("ar-status",cT),this[sR].arRenderer.addEventListener("tracking",this[$B]),this[YB].addEventListener("message",this[eL])}disconnectedCallback(){super.disconnectedCallback(),this[sR].arRenderer.removeEventListener("status",this[ZB]),this[sR].arRenderer.removeEventListener("tracking",this[$B]),this[YB].removeEventListener("message",this[eL])}update(e){super.update(e),e.has("arScale")&&(this[eR].canScale="fixed"!==this.arScale),e.has("arPlacement")&&(this[eR].updateShadow(),this[tR]()),e.has("arModes")&&(this[XB]=NB(this.arModes)),(e.has("ar")||e.has("arModes")||e.has("src")||e.has("iosSrc")||e.has("arUsdzMaxTextureSize"))&&this[tL]()}async activateAR(){switch(this[qB]){case FB:await this[WB]();break;case zB:await this[GB]();break;case UB:this[HB]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities")}}async[(t=QB,i=VB,n=YB,r=XB,s=qB,a=KB,o=JB,l=ZB,c=$B,h=eL,tL)](){var e;let t=jB;if(this.ar){if(null!=this.src)for(const i of this[XB]){if("webxr"===i&&Db&&!BB&&await this[sR].arRenderer.supportsPresentation()){t=zB;break}if("scene-viewer"===i&&!LB&&(Nb||navigator.userAgentData&&navigator.userAgentData.getHighEntropyValues&&(null===(e=(await navigator.userAgentData.getHighEntropyValues(["formFactor"])).formFactor)||void 0===e?void 0:e.includes("XR")))){t=UB;break}if("quick-look"===i&&Fb){t=FB;break}}t===jB&&null!=this.iosSrc&&Fb&&(t=FB)}if(t!==jB)this[VB].classList.add("enabled"),this[VB].addEventListener("click",this[JB]);else if(this[VB].classList.contains("enabled")){this[VB].removeEventListener("click",this[JB]),this[VB].classList.remove("enabled");const e=uT;this.setAttribute("ar-status",e),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:e}}))}this[qB]=t}async[GB](){console.log("Attempting to present in AR with WebXR..."),await this[iL]();try{this[VB].removeEventListener("click",this[JB]);const{arRenderer:e}=this[sR];e.placeOnWall="wall"===this.arPlacement,await e.present(this[eR],this.xrEnvironment)}catch(e){console.warn("Error while trying to present in AR with WebXR"),console.error(e),await this[sR].arRenderer.stopPresenting(),BB=!0,console.warn("Falling back to next ar-mode"),await this[tL](),this.activateAR()}finally{this[tL]()}}async[iL](){this.loaded||(this[KB]=!0,this[YD](),await function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((n=>{e.addEventListener(t,(function r(s){i&&!i(s)||(n(s),e.removeEventListener(t,r))}))}))}(this,"load"),this[KB]=!1)}[cR](){return super[cR]()||this[KB]}[HB](){const e=self.location.toString(),t=new URL(e),i=new URL(this.src,e);i.hash&&(i.hash="");const n=new URLSearchParams(i.search);if(t.hash=OB,n.set("mode","ar_preferred"),n.has("disable_occlusion")||n.set("disable_occlusion","true"),"fixed"===this.arScale&&n.set("resizable","false"),"wall"===this.arPlacement&&n.set("enable_vertical_placement","true"),n.has("sound")){const t=new URL(n.get("sound"),e);n.set("sound",t.toString())}if(n.has("link")){const t=new URL(n.get("link"),e);n.set("link",t.toString())}const r=`intent://arvr.google.com/scene-viewer/1.2?${n.toString()+"&file="+encodeURIComponent(i.toString())}#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(t.toString())};end;`;self.addEventListener("hashchange",(()=>{self.location.hash===OB&&(LB=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[tL]())}),{once:!0}),this[YB].setAttribute("href",r),console.log("Attempting to present in AR with Scene Viewer..."),this[YB].click()}async[WB](){const e=!this.iosSrc;this[VB].classList.remove("enabled");const t=e?await this.prepareUSDZ():this.iosSrc,i=new URL(t,self.location.toString());if(e){const e=self.location.toString(),t=new URL(e),n=new URL(this.src,t);n.hash&&(i.hash=n.hash)}"fixed"===this.arScale&&(i.hash&&(i.hash+="&"),i.hash+="allowsContentScaling=0");const n=this[YB];n.setAttribute("rel","ar");const r=document.createElement("img");n.appendChild(r),n.setAttribute("href",i.toString()),e&&n.setAttribute("download","model.usdz"),n.style.display="none",n.isConnected||this.shadowRoot.appendChild(n),console.log("Attempting to present in AR with Quick Look..."),n.click(),n.removeChild(r),e&&URL.revokeObjectURL(t),this[VB].classList.add("enabled")}async prepareUSDZ(){const e=this[aR].beginActivity("usdz-conversion");await this[iL]();const{model:t,shadow:i,target:n}=this[eR];if(null==t)return"";let r=!1;null!=i&&(r=i.visible,i.visible=!1),e(.2);const s=new xB;n.remove(t),t.position.copy(n.position),t.updateWorldMatrix(!1,!0);const a=await s.parseAsync(t,{maxTextureSize:isNaN(this.arUsdzMaxTextureSize)?1/0:Math.max(parseInt(this.arUsdzMaxTextureSize),16)});t.position.set(0,0,0),n.add(t);const o=new Blob([a],{type:"model/vnd.usdz+zip"}),l=URL.createObjectURL(o);return e(1),null!=i&&(i.visible=r),l}}return RB([wh({type:Boolean,attribute:"ar"})],d.prototype,"ar",void 0),RB([wh({type:String,attribute:"ar-scale"})],d.prototype,"arScale",void 0),RB([wh({type:String,attribute:"ar-usdz-max-texture-size"})],d.prototype,"arUsdzMaxTextureSize",void 0),RB([wh({type:String,attribute:"ar-placement"})],d.prototype,"arPlacement",void 0),RB([wh({type:String,attribute:"ar-modes"})],d.prototype,"arModes",void 0),RB([wh({type:String,attribute:"ios-src"})],d.prototype,"iosSrc",void 0),RB([wh({type:Boolean,attribute:"xr-environment"})],d.prototype,"xrEnvironment",void 0),d})((e=>{var t,i,n,r,s,a,o,l;class c extends e{static set dracoDecoderLocation(e){lw.setDRACODecoderLocation(e)}static get dracoDecoderLocation(){return lw.getDRACODecoderLocation()}static set ktx2TranscoderLocation(e){lw.setKTX2TranscoderLocation(e)}static get ktx2TranscoderLocation(){return lw.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(e){lw.setMeshoptDecoderLocation(e)}static get meshoptDecoderLocation(){return lw.getMeshoptDecoderLocation()}static set lottieLoaderLocation(e){cI.singleton.textureUtils.lottieLoaderUrl=e}static get lottieLoaderLocation(){return cI.singleton.textureUtils.lottieLoaderUrl}static mapURLs(e){cI.singleton.loader[sw].manager.setURLModifier(e)}dismissPoster(){this.loaded?this[dL]():(this[hL]=!0,this[YD]())}showPoster(){const e=this[lL];if(e.classList.contains("show"))return;e.classList.add("show"),this[ZD].classList.remove("show");const t=this[cL];t.removeAttribute("tabindex"),t.removeAttribute("aria-hidden");const i=this.modelIsVisible;this[uL]=!1,this[GD](i)}getDimensions(){return hR(this[eR].size)}getBoundingBoxCenter(){return hR(this[eR].boundingBox.getCenter(new Vp))}constructor(){super(...arguments),this.poster=null,this.reveal=rL,this.loading=sL,this[t]=!1,this[i]=!1,this[n]=this.shadowRoot.querySelector(".slot.poster"),this[r]=this.shadowRoot.querySelector("#default-poster"),this[s]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[a]=this[cL].getAttribute("aria-label"),this[o]=((e,t)=>{let i=null;const n=function(){null==i&&(e(...arguments),i=self.setTimeout((()=>i=null),t))};return n.flush=()=>{null!=i&&(self.clearTimeout(i),i=null)},n})((e=>{const t=this[oL].parentNode;requestAnimationFrame((()=>{this[oL].style.transform=`scaleX(${e})`,0===e&&(t.removeChild(this[oL]),t.appendChild(this[oL])),this[oL].classList.toggle("hide",1===e)}))}),100),this[l]=e=>{const t=e.detail.totalProgress,i=e.detail.reason;1===t&&(this[pL].flush(),this.loaded&&(this[hL]||this.reveal===rL)&&this[dL]()),this[pL](t),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:t,reason:i}}))};const e=self.ModelViewerElement||{},c=e.dracoDecoderLocation||"https://www.gstatic.com/draco/versioned/decoders/1.5.6/";lw.setDRACODecoderLocation(c);const h=e.ktx2TranscoderLocation||"https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";lw.setKTX2TranscoderLocation(h),e.meshoptDecoderLocation&&lw.setMeshoptDecoderLocation(e.meshoptDecoderLocation);const d=e.lottieLoaderLocation||"https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/loaders/LottieLoader.js";cI.singleton.textureUtils.lottieLoaderUrl=d}connectedCallback(){super.connectedCallback(),this.loaded||this.showPoster(),this[aR].addEventListener("progress",this[mL])}disconnectedCallback(){super.disconnectedCallback(),this[aR].removeEventListener("progress",this[mL])}async updated(e){super.updated(e),e.has("poster")&&null!=this.poster&&(this[cL].style.backgroundImage=`url(${this.poster})`),e.has("alt")&&this[cL].setAttribute("aria-label",this[WD]),(e.has("reveal")||e.has("loading"))&&this[YD]()}[(t=uL,i=hL,n=lL,r=cL,s=oL,a=fL,o=pL,l=mL,cR)](){return!!this.src&&(this[hL]||this.loading===aL||this.reveal===rL&&this[VD])}[dL](){this[hL]=!1;const e=this[lL];if(!e.classList.contains("show"))return;e.classList.remove("show"),this[ZD].classList.add("show");const t=this.modelIsVisible;this[uL]=!0,this[GD](t);const i=this.getRootNode();i&&i.activeElement===this&&this[ZD].focus();const n=this[cL];n.setAttribute("aria-hidden","true"),n.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))}[lR](){return super[lR]()&&this[uL]}}return nL([wh({type:String})],c.prototype,"poster",void 0),nL([wh({type:String})],c.prototype,"reveal",void 0),nL([wh({type:String})],c.prototype,"loading",void 0),c})((e=>{var t;class i extends e{constructor(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];super(i),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[t]=!0,this[eR].subscribeMixerEvent("loop",(e=>{const t=e.action._loopCount,i=e.action._clip.name,n=e.action._clip.uuid,r=this[eR].markedAnimations.find((e=>e.name===i));if(r){this[eR].updateAnimationLoop(r.name,r.loopMode,r.repetitionCount);const e=this[eR].markedAnimations.filter((e=>e.name!==i));this[eR].markedAnimations=e}this.dispatchEvent(new CustomEvent("loop",{detail:{count:t,name:i,uuid:n}}))})),this[eR].subscribeMixerEvent("finished",(e=>{if(this[eR].appendedAnimations.includes(e.action._clip.name)){const t=this[eR].appendedAnimations.filter((t=>t!==e.action._clip.name));this[eR].appendedAnimations=t}else this[vR]=!0;this.dispatchEvent(new CustomEvent("finished"))}))}get availableAnimations(){return this.loaded?this[eR].animationNames:[]}get duration(){return this[eR].duration}get paused(){return this[vR]}get currentTime(){return this[eR].animationTime}get appendedAnimations(){return this[eR].appendedAnimations}set currentTime(e){this[eR].animationTime=e,this[tR]()}get timeScale(){return this[eR].animationTimeScale}set timeScale(e){this[eR].animationTimeScale=e}pause(){this[vR]||(this[vR]=!0,this.dispatchEvent(new CustomEvent("pause")))}play(e){this.availableAnimations.length>0&&(this[vR]=!1,this[fR](e),this.dispatchEvent(new CustomEvent("play")))}appendAnimation(e,t){this.availableAnimations.length>0&&(this[vR]=!1,this[mR](e,t),this.dispatchEvent(new CustomEvent("append-animation")))}detachAnimation(e,t){this.availableAnimations.length>0&&(this[vR]=!1,this[gR](e,t),this.dispatchEvent(new CustomEvent("detach-animation")))}[(t=vR,nR)](){super[nR](),this[vR]=!0,null!=this.animationName&&this[fR](),this.autoplay&&this.play()}[iR](e,t){super[iR](e,t),this[vR]||!this[lR]()&&!this[sR].isPresenting||(this[eR].updateAnimation(t/1e3),this[tR]())}updated(e){super.updated(e),e.has("autoplay")&&this.autoplay&&this.play(),e.has("animationName")&&this[fR]()}[fR](){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yR;var t;const i=null!==(t=e.repetitions)&&void 0!==t?t:1/0,n=e.pingpong?Du:1===i?Iu:Pu;this[eR].playAnimation(this.animationName,this.animationCrossfadeDuration/1e3,n,i),this[vR]&&(this[eR].updateAnimation(0),this[tR]())}[mR](){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bR;var i;const n=null!==(i=t.repetitions)&&void 0!==i?i:1/0,r=t.pingpong?Du:1===n?Iu:Pu,s=!!t.repetitions||"pingpong"in t;this[eR].appendAnimation(e||this.animationName,r,n,t.weight,t.timeScale,t.fade,t.warp,t.relativeWarp,t.time,s),this[vR]&&(this[eR].updateAnimation(0),this[tR]())}[gR](){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AR;this[eR].detachAnimation(e||this.animationName,t.fade),this[vR]&&(this[eR].updateAnimation(0),this[tR]())}}return pR([wh({type:Boolean})],i.prototype,"autoplay",void 0),pR([wh({type:String,attribute:"animation-name"})],i.prototype,"animationName",void 0),pR([wh({type:Number,attribute:"animation-crossfade-duration"})],i.prototype,"animationCrossfadeDuration",void 0),i})(uR))))))));function _L(e){let{src:t="/model/untitled.glb",alt:i="3D Model",style:n={}}=e;return(0,ve.jsx)("model-viewer",{src:t,alt:i,"camera-controls":!0,ar:!0,style:{width:"100%",height:"400px",...n},"ios-src":t,loading:"lazy",exposure:"1"})}function EL(e){let{imageFile:t}=e;const i=(0,n.useRef)(),[r,s]=(0,n.useState)();return(0,n.useEffect)((()=>{const e=new pg,t=new sg(45,1,.1,100);t.position.set(0,1.5,3);const n=new ny(16777215,4473924,1);e.add(n);const r=new JE({antialias:!0,alpha:!0});r.setSize(400,400),i.current.appendChild(r.domElement),s(r);(new tA).load("/model/model1.glb",(n=>{var s;const a=n.scene;e.add(a),r.render(e,t),i.current.userData.faceMat=null===(s=a.getObjectByName("FaceMaterial"))||void 0===s?void 0:s.material}));const a=()=>{requestAnimationFrame(a),r.render(e,t)};return a(),()=>{i.current.removeChild(r.domElement),r.dispose()}}),[]),(0,n.useEffect)((()=>{var e,n;if(!r||!t)return;const s=null===(e=i.current)||void 0===e||null===(n=e.userData)||void 0===n?void 0:n.faceMat;if(!s)return;const a=URL.createObjectURL(t);(new ty).load(a,(e=>{s.map=e,s.needsUpdate=!0,URL.revokeObjectURL(a)}))}),[t,r]),(0,ve.jsx)("div",{ref:i})}customElements.define("model-viewer",SL);const CL=()=>{const[e,t]=(0,n.useState)(0),[i,r]=(0,n.useState)(!1),[s,a]=(0,n.useState)(!1),[o,l]=(0,n.useState)(null),c=(0,n.useRef)(),h=(0,n.useRef)(),d=(0,n.useRef)(null),u=(0,n.useContext)(sU),p=($(),["https://shop.simon.com/cdn/shop/files/d48f2ae0a8be4fe6834a534bd0614ee6_86891f94-4da6-4906-b9d1-efc117eec1aa_360x.jpg?v=1720843419","https://shop.simon.com/cdn/shop/files/6c8e8280cf7f4102909e1eeba017ac59_e19eecbe-c436-4c25-a208-6aae5dcbe6be_360x.jpg?v=1720843419","https://shop.simon.com/cdn/shop/files/cd6f5452da504fa7b951141a96e3e61a_88918b0d-8418-462e-ad5e-79993a52ae52_360x.jpg?v=1720843419"]),f=()=>{r((e=>!e))};return(0,ve.jsx)(ve.Fragment,{children:(0,ve.jsxs)(Ta,{open:!0,className:"productModal",onClose:()=>u.setisOpenProductModal(!1),maxWidth:"lg",fullWidth:!0,children:[(0,ve.jsx)("input",{type:"file",accept:"image/*",ref:d,onChange:e=>{const t=e.target.files[0];if(t){if(!["image/jpeg","image/png"].includes(t.type))return void alert("\u274c Invalid file type! Please upload a JPEG or PNG image.");console.log("Selected file:",t);const e=new FileReader;e.onload=()=>{console.log("Image preview URL:",e.result),alert("\u2705 Image uploaded successfully!")},e.readAsDataURL(t)}},style:{display:"none"}}),(0,ve.jsx)(Ti,{className:"close_",onClick:()=>u.setisOpenProductModal(!1),children:(0,ve.jsx)(ji,{size:24})}),(0,ve.jsx)("h2",{className:"mb-1 px-3 pt-3",children:"Women's Ultimate365 Jacket"}),(0,ve.jsxs)("div",{className:"d-flex align-items-center px-3",children:[(0,ve.jsxs)("span",{className:"mr-2",children:["Brand: ",(0,ve.jsx)("b",{children:"Adidas"})]}),(0,ve.jsx)(ss,{value:5,readOnly:!0})]}),(0,ve.jsx)("hr",{}),(0,ve.jsxs)("div",{className:"row mt-2 productDetailModal px-3 pb-4",children:[(0,ve.jsxs)("div",{className:"col-md-5",children:[(0,ve.jsxs)("div",{className:"productZoom mb-3 position-relative",children:[(0,ve.jsx)("div",{className:"badge badge-primary",children:"20%"}),(0,ve.jsx)(mr,{slidesPerView:1,modules:[yr],className:"zoomSliderBig",ref:c,children:p.map(((e,t)=>(0,ve.jsx)(gr,{children:(0,ve.jsx)(Jc,{src:e,zoomType:"hover",zoomScale:1.2,zoomPreload:!0,className:"rounded"})},t)))})]}),(0,ve.jsx)(mr,{slidesPerView:3,spaceBetween:10,modules:[yr],className:"zoomSliderThumbs",ref:h,children:p.map(((i,n)=>(0,ve.jsx)(gr,{children:(0,ve.jsx)("div",{className:"item "+(e===n?"item-active":""),children:(0,ve.jsx)("img",{src:i,onClick:()=>{return t(e=n),void c.current.swiper.slideTo(e);var e},className:"w-100 cursor-pointer rounded",style:{border:e===n?"2px solid #007bff":"1px solid #ddd"}})})},n)))})]}),(0,ve.jsxs)("div",{className:"col-md-7",children:[(0,ve.jsxs)("div",{className:"d-flex align-items-center mb-3 info",children:[(0,ve.jsx)("span",{className:"oldPrice mr-2 text-muted",style:{fontSize:18},children:"Rs\xa01000.00"}),(0,ve.jsx)("span",{className:"netPrice text-danger",style:{fontSize:20,fontWeight:700},children:"Rs\xa0790.00"})]}),(0,ve.jsx)("span",{className:"badge bg-success",children:"IN\xa0STOCK"}),(0,ve.jsx)("p",{className:"mt-3",children:"Quick product description here\u2026"}),(0,ve.jsxs)("div",{className:"d-flex align-items-center mt-4",children:[(0,ve.jsx)(Zc,{}),(0,ve.jsx)(Ti,{className:"btn-blue btn-lg ml-3",children:"Add to Cart"})]}),(0,ve.jsxs)("div",{className:"d-flex align-items-center mt-4 actions",children:[(0,ve.jsxs)(Ti,{variant:"outlined",className:"btn-round btn-sml",children:[(0,ve.jsx)(Vi,{})," Wishlist"]}),(0,ve.jsxs)(Ti,{variant:"outlined",className:"btn-round btn-sml ml-3",onClick:f,children:[(0,ve.jsx)(co,{})," Questionnaire"]}),(0,ve.jsxs)(Ti,{variant:"outlined",className:"btn-round btn-sml ml-3",onClick:()=>{d.current.click()},children:[(0,ve.jsx)(jc,{})," Upload Image"]}),(0,ve.jsx)(Ti,{variant:"outlined",className:"btn-round btn-sml ml-3",onClick:()=>{a((e=>!e))},children:"3D Model"})]}),i&&(0,ve.jsx)($c,{toggleFitQuiz:f}),s&&(0,ve.jsx)("div",{className:"mt-4",children:(0,ve.jsx)(_L,{src:"/model/untitled.glb"})}),o&&(0,ve.jsx)("div",{className:"mt-4",children:(0,ve.jsx)(EL,{modelPath:"/model/model1.glb"})})]})]})]})})};const ML=n.createContext(void 0);function TL(){return n.useContext(ML)}var IL=i(3174);const PL=["ownerState"],DL=["variants"],RL=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function BL(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const LL=(0,Re.A)(),OL=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function NL(e){let{defaultTheme:t,theme:i,themeId:n}=e;return r=i,0===Object.keys(r).length?t:i[n]||i;var r}function kL(e){return e?(t,i)=>i[e]:null}function FL(e,t){let{ownerState:i}=t,n=(0,Ae.A)(t,PL);const r="function"===typeof e?e((0,xe.A)({ownerState:i},n)):e;if(Array.isArray(r))return r.flatMap((e=>FL(e,(0,xe.A)({ownerState:i},n))));if(r&&"object"===typeof r&&Array.isArray(r.variants)){const{variants:e=[]}=r;let t=(0,Ae.A)(r,DL);return e.forEach((e=>{let r=!0;"function"===typeof e.props?r=e.props((0,xe.A)({ownerState:i},n,i)):Object.keys(e.props).forEach((t=>{(null==i?void 0:i[t])!==e.props[t]&&n[t]!==e.props[t]&&(r=!1)})),r&&(Array.isArray(t)||(t=[t]),t.push("function"===typeof e.style?e.style((0,xe.A)({ownerState:i},n,i)):e.style))})),t}return r}const UL=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:i=LL,rootShouldForwardProp:n=BL,slotShouldForwardProp:r=BL}=e,s=e=>(0,De.A)((0,xe.A)({},e,{theme:NL((0,xe.A)({},e,{defaultTheme:i,themeId:t}))}));return s.__mui_systemSx=!0,function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,IL.internal_processStyles)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:o,slot:l,skipVariantsResolver:c,skipSx:h,overridesResolver:d=kL(OL(l))}=a,u=(0,Ae.A)(a,RL),p=void 0!==c?c:l&&"Root"!==l&&"root"!==l||!1,f=h||!1;let m=BL;"Root"===l||"root"===l?m=n:l?m=r:function(e){return"string"===typeof e&&e.charCodeAt(0)>96}(e)&&(m=void 0);const g=(0,IL.default)(e,(0,xe.A)({shouldForwardProp:m,label:undefined},u)),v=e=>"function"===typeof e&&e.__emotion_real!==e||(0,Ie.Q)(e)?n=>FL(e,(0,xe.A)({},n,{theme:NL({theme:n.theme,defaultTheme:i,themeId:t})})):e,y=function(n){let r=v(n);for(var a=arguments.length,l=new Array(a>1?a-1:0),c=1;c<a;c++)l[c-1]=arguments[c];const h=l?l.map(v):[];o&&d&&h.push((e=>{const n=NL((0,xe.A)({},e,{defaultTheme:i,themeId:t}));if(!n.components||!n.components[o]||!n.components[o].styleOverrides)return null;const r=n.components[o].styleOverrides,s={};return Object.entries(r).forEach((t=>{let[i,r]=t;s[i]=FL(r,(0,xe.A)({},e,{theme:n}))})),d(e,s)})),o&&!p&&h.push((e=>{var n;const r=NL((0,xe.A)({},e,{defaultTheme:i,themeId:t}));return FL({variants:null==r||null==(n=r.components)||null==(n=n[o])?void 0:n.variants},(0,xe.A)({},e,{theme:r}))})),f||h.push(s);const u=h.length-l.length;if(Array.isArray(n)&&u>0){const e=new Array(u).fill("");r=[...n,...e],r.raw=[...n.raw,...e]}const m=g(r,...h);return e.muiName&&(m.muiName=e.muiName),m};return g.withConfig&&(y.withConfig=g.withConfig),y}}(),zL=UL;function jL(e){let{props:t,name:i,defaultTheme:n,themeId:r}=e,s=Fs(n);r&&(s=s[r]||s);const a=function(e){const{theme:t,name:i,props:n}=e;return t&&t.components&&t.components[i]&&t.components[i].defaultProps?_e(t.components[i].defaultProps,n):n}({theme:s,name:i,props:t});return a}var VL=i(8698),GL=i(9751),HL=i(8604);const WL=["component","direction","spacing","divider","children","className","useFlexGap"],QL=(0,Re.A)(),qL=zL("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root});function XL(e){return jL({props:e,name:"MuiStack",defaultTheme:QL})}function YL(e,t){const i=n.Children.toArray(e).filter(Boolean);return i.reduce(((e,r,s)=>(e.push(r),s<i.length-1&&e.push(n.cloneElement(t,{key:`separator-${s}`})),e)),[])}const KL=e=>{let{ownerState:t,theme:i}=e,n=(0,xe.A)({display:"flex",flexDirection:"column"},(0,GL.NI)({theme:i},(0,GL.kW)({values:t.direction,breakpoints:i.breakpoints.values}),(e=>({flexDirection:e}))));if(t.spacing){const e=(0,HL.LX)(i),r=Object.keys(i.breakpoints.values).reduce(((e,i)=>(("object"===typeof t.spacing&&null!=t.spacing[i]||"object"===typeof t.direction&&null!=t.direction[i])&&(e[i]=!0),e)),{}),s=(0,GL.kW)({values:t.direction,base:r}),a=(0,GL.kW)({values:t.spacing,base:r});"object"===typeof s&&Object.keys(s).forEach(((e,t,i)=>{if(!s[e]){const n=t>0?s[i[t-1]]:"column";s[e]=n}}));const o=(i,n)=>{return t.useFlexGap?{gap:(0,HL._W)(e,i)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${r=n?s[n]:t.direction,{row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[r]}`]:(0,HL._W)(e,i)}};var r};n=(0,Ie.A)(n,(0,GL.NI)({theme:i},a,o))}return n=(0,GL.iZ)(i.breakpoints,n),n};const JL=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:t=qL,useThemeProps:i=XL,componentName:r="MuiStack"}=e,s=t(KL),a=n.forwardRef((function(e,t){const n=i(e),a=(0,VL.A)(n),{component:o="div",direction:l="column",spacing:c=0,divider:h,children:d,className:u,useFlexGap:p=!1}=a,f=(0,Ae.A)(a,WL),m={direction:l,spacing:c,useFlexGap:p},g=Ee({root:["root"]},(e=>Yt(r,e)),{});return(0,ve.jsx)(s,(0,xe.A)({as:o,ownerState:m,ref:t,className:Se(g.root,u)},f,{children:h?YL(d,h):d}))}));return a}({createStyledComponent:ut("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root}),useThemeProps:e=>mt({props:e,name:"MuiStack"})}),ZL=JL;function $L(e){return Yt("MuiTypography",e)}Kt("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const eO=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],tO=ut("span",{name:"MuiTypography",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.variant&&t[i.variant],"inherit"!==i.align&&t[`align${vi(i.align)}`],i.noWrap&&t.noWrap,i.gutterBottom&&t.gutterBottom,i.paragraph&&t.paragraph]}})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({margin:0},"inherit"===i.variant&&{font:"inherit"},"inherit"!==i.variant&&t.typography[i.variant],"inherit"!==i.align&&{textAlign:i.align},i.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},i.gutterBottom&&{marginBottom:"0.35em"},i.paragraph&&{marginBottom:16})})),iO={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},nO={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},rO=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiTypography"}),n=(e=>nO[e]||e)(i.color),r=(0,VL.A)((0,xe.A)({},i,{color:n})),{align:s="inherit",className:a,component:o,gutterBottom:l=!1,noWrap:c=!1,paragraph:h=!1,variant:d="body1",variantMapping:u=iO}=r,p=(0,Ae.A)(r,eO),f=(0,xe.A)({},r,{align:s,color:n,className:a,component:o,gutterBottom:l,noWrap:c,paragraph:h,variant:d,variantMapping:u}),m=o||(h?"p":u[d]||iO[d])||"span",g=(e=>{const{align:t,gutterBottom:i,noWrap:n,paragraph:r,variant:s,classes:a}=e;return Ee({root:["root",s,"inherit"!==e.align&&`align${vi(t)}`,i&&"gutterBottom",n&&"noWrap",r&&"paragraph"]},$L,a)})(f);return(0,ve.jsx)(tO,(0,xe.A)({as:m,ref:t,ownerState:f,className:Se(g.root,a)},p))})),sO=rO;function aO(e){return Yt("MuiFormControlLabel",e)}const oO=Kt("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]);function lO(e){let{props:t,states:i,muiFormControl:n}=e;return i.reduce(((e,i)=>(e[i]=t[i],n&&"undefined"===typeof t[i]&&(e[i]=n[i]),e)),{})}const cO=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],hO=ut("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[{[`& .${oO.label}`]:t.label},t.root,t[`labelPlacement${vi(i.labelPlacement)}`]]}})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${oO.disabled}`]:{cursor:"default"}},"start"===i.labelPlacement&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},"top"===i.labelPlacement&&{flexDirection:"column-reverse",marginLeft:16},"bottom"===i.labelPlacement&&{flexDirection:"column",marginLeft:16},{[`& .${oO.label}`]:{[`&.${oO.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})})),dO=ut("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})((e=>{let{theme:t}=e;return{[`&.${oO.error}`]:{color:(t.vars||t).palette.error.main}}})),uO=n.forwardRef((function(e,t){var i,r;const s=mt({props:e,name:"MuiFormControlLabel"}),{className:a,componentsProps:o={},control:l,disabled:c,disableTypography:h,label:d,labelPlacement:u="end",required:p,slotProps:f={}}=s,m=(0,Ae.A)(s,cO),g=TL(),v=null!=(i=null!=c?c:l.props.disabled)?i:null==g?void 0:g.disabled,y=null!=p?p:l.props.required,b={disabled:v,required:y};["checked","name","onChange","value","inputRef"].forEach((e=>{"undefined"===typeof l.props[e]&&"undefined"!==typeof s[e]&&(b[e]=s[e])}));const A=lO({props:s,muiFormControl:g,states:["error"]}),x=(0,xe.A)({},s,{disabled:v,labelPlacement:u,required:y,error:A.error}),w=(e=>{const{classes:t,disabled:i,labelPlacement:n,error:r,required:s}=e;return Ee({root:["root",i&&"disabled",`labelPlacement${vi(n)}`,r&&"error",s&&"required"],label:["label",i&&"disabled"],asterisk:["asterisk",r&&"error"]},aO,t)})(x),S=null!=(r=f.typography)?r:o.typography;let _=d;return null==_||_.type===sO||h||(_=(0,ve.jsx)(sO,(0,xe.A)({component:"span"},S,{className:Se(w.label,null==S?void 0:S.className),children:_}))),(0,ve.jsxs)(hO,(0,xe.A)({className:Se(w.root,a),ownerState:x,ref:t},m,{children:[n.cloneElement(l,b),y?(0,ve.jsxs)(ZL,{display:"block",children:[_,(0,ve.jsxs)(dO,{ownerState:x,"aria-hidden":!0,className:w.asterisk,children:["\u2009","*"]})]}):_]}))})),pO=uO;function fO(e){return Yt("PrivateSwitchBase",e)}Kt("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const mO=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],gO=ut(gi)((e=>{let{ownerState:t}=e;return(0,xe.A)({padding:9,borderRadius:"50%"},"start"===t.edge&&{marginLeft:"small"===t.size?-3:-12},"end"===t.edge&&{marginRight:"small"===t.size?-3:-12})})),vO=ut("input",{shouldForwardProp:dt})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),yO=n.forwardRef((function(e,t){const{autoFocus:i,checked:n,checkedIcon:r,className:s,defaultChecked:a,disabled:o,disableFocusRipple:l=!1,edge:c=!1,icon:h,id:d,inputProps:u,inputRef:p,name:f,onBlur:m,onChange:g,onFocus:v,readOnly:y,required:b=!1,tabIndex:A,type:x,value:w}=e,S=(0,Ae.A)(e,mO),[_,E]=Or({controlled:n,default:Boolean(a),name:"SwitchBase",state:"checked"}),C=TL();let M=o;C&&"undefined"===typeof M&&(M=C.disabled);const T="checkbox"===x||"radio"===x,I=(0,xe.A)({},e,{checked:_,disabled:M,disableFocusRipple:l,edge:c}),P=(e=>{const{classes:t,checked:i,disabled:n,edge:r}=e;return Ee({root:["root",i&&"checked",n&&"disabled",r&&`edge${vi(r)}`],input:["input"]},fO,t)})(I);return(0,ve.jsxs)(gO,(0,xe.A)({component:"span",className:Se(P.root,s),centerRipple:!0,focusRipple:!l,disabled:M,tabIndex:null,role:void 0,onFocus:e=>{v&&v(e),C&&C.onFocus&&C.onFocus(e)},onBlur:e=>{m&&m(e),C&&C.onBlur&&C.onBlur(e)},ownerState:I,ref:t},S,{children:[(0,ve.jsx)(vO,(0,xe.A)({autoFocus:i,checked:n,defaultChecked:a,className:P.input,disabled:M,id:T?d:void 0,name:f,onChange:e=>{if(e.nativeEvent.defaultPrevented)return;const t=e.target.checked;E(t),g&&g(e,t)},readOnly:y,ref:p,required:b,ownerState:I,tabIndex:A,type:x},"checkbox"===x&&void 0===w?{}:{value:w},u)),_?r:h]}))})),bO=yO,AO=jr((0,ve.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),xO=jr((0,ve.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),wO=jr((0,ve.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function SO(e){return Yt("MuiCheckbox",e)}const _O=Kt("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),EO=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],CO=ut(bO,{shouldForwardProp:e=>dt(e)||"classes"===e,name:"MuiCheckbox",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.indeterminate&&t.indeterminate,t[`size${vi(i.size)}`],"default"!==i.color&&t[`color${vi(i.color)}`]]}})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({color:(t.vars||t).palette.text.secondary},!i.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${"default"===i.color?t.vars.palette.action.activeChannel:t.vars.palette[i.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ce.X4)("default"===i.color?t.palette.action.active:t.palette[i.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==i.color&&{[`&.${_O.checked}, &.${_O.indeterminate}`]:{color:(t.vars||t).palette[i.color].main},[`&.${_O.disabled}`]:{color:(t.vars||t).palette.action.disabled}})})),MO=(0,ve.jsx)(xO,{}),TO=(0,ve.jsx)(AO,{}),IO=(0,ve.jsx)(wO,{}),PO=n.forwardRef((function(e,t){var i,r;const s=mt({props:e,name:"MuiCheckbox"}),{checkedIcon:a=MO,color:o="primary",icon:l=TO,indeterminate:c=!1,indeterminateIcon:h=IO,inputProps:d,size:u="medium",className:p}=s,f=(0,Ae.A)(s,EO),m=c?h:l,g=c?h:a,v=(0,xe.A)({},s,{color:o,indeterminate:c,size:u}),y=(e=>{const{classes:t,indeterminate:i,color:n,size:r}=e,s=Ee({root:["root",i&&"indeterminate",`color${vi(n)}`,`size${vi(r)}`]},SO,t);return(0,xe.A)({},t,s)})(v);return(0,ve.jsx)(CO,(0,xe.A)({type:"checkbox",inputProps:(0,xe.A)({"data-indeterminate":c},d),icon:n.cloneElement(m,{fontSize:null!=(i=m.props.fontSize)?i:u}),checkedIcon:n.cloneElement(g,{fontSize:null!=(r=g.props.fontSize)?r:u}),ownerState:v,ref:t,className:Se(y.root,p)},f,{classes:y}))})),DO=PO;var RO=i(1123);const BO=()=>{const[e,t]=(0,n.useState)([500,6e4]),[i,r]=(0,n.useState)(0);return(0,ve.jsx)(ve.Fragment,{children:(0,ve.jsxs)("div",{className:"sidebar",children:[(0,ve.jsxs)("div",{className:"filterbox",children:[(0,ve.jsx)("h6",{children:"PRODUCT CATEGORIES"}),(0,ve.jsx)("div",{className:"scroll",children:(0,ve.jsxs)("ul",{children:[(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"New Arrival"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Women"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Ocassions"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Gifts"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Sale"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Best Sellers"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Discounts"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Tops"})})]})})]}),(0,ve.jsxs)("div",{className:"filterbox",children:[(0,ve.jsx)("h6",{children:"FILTER BY PRICE"}),(0,ve.jsx)(RO.A,{value:e,onInput:t,min:200,max:6e4,step:5}),(0,ve.jsxs)("div",{className:"d-flex pt-2 pb-2 priceRange mt-3",children:[(0,ve.jsxs)("span",{children:["Low: ",(0,ve.jsxs)("strong",{className:"text-light",children:["Rs",e[0]]})]}),(0,ve.jsxs)("span",{className:"ml-auto",children:["High: ",(0,ve.jsxs)("strong",{className:"text-light",children:["Rs",e[1]]})]})]})]}),(0,ve.jsxs)("div",{className:"filterbox",children:[(0,ve.jsx)("h6",{children:"PRODUCT STATUS"}),(0,ve.jsx)("div",{className:"scroll",children:(0,ve.jsxs)("ul",{children:[(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"In Stock"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"On Sale"})})]})})]}),(0,ve.jsxs)("div",{className:"filterbox",children:[(0,ve.jsx)("h6",{children:"BRANDS"}),(0,ve.jsx)("div",{className:"scroll",children:(0,ve.jsxs)("ul",{children:[(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Adidas"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Fossils"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Nike"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Vera bradely"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"NuLoom"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"HUGE boss"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"A&M"})}),(0,ve.jsx)("li",{children:(0,ve.jsx)(pO,{className:"w-100",control:(0,ve.jsx)(DO,{defaultChecked:!0}),label:"Guess Factory"})})]})})]}),(0,ve.jsx)(ka,{to:"#",children:(0,ve.jsx)("img",{src:"https://shop.simon.com/cdn/shop/files/e9b6b6086a3041a0b882afda4b1e9d47_360x.jpg?v=1736822105",className:"w-100"})})]})})};function LO(e){return Fi({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none"},child:[{tag:"path",attr:{d:"M4 4H8V8H4V4Z",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M4 10H8V14H4V10Z",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M8 16H4V20H8V16Z",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M10 4H14V8H10V4Z",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M14 10H10V14H14V10Z",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M10 16H14V20H10V16Z",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M20 4H16V8H20V4Z",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M16 10H20V14H16V10Z",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M20 16H16V20H20V16Z",fill:"currentColor"},child:[]}]})(e)}i(805);const OO=ys;const NO=n.createContext({});function kO(e){return Yt("MuiList",e)}Kt("MuiList",["root","padding","dense","subheader"]);const FO=["children","className","component","dense","disablePadding","subheader"],UO=ut("ul",{name:"MuiList",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,!i.disablePadding&&t.padding,i.dense&&t.dense,i.subheader&&t.subheader]}})((e=>{let{ownerState:t}=e;return(0,xe.A)({listStyle:"none",margin:0,padding:0,position:"relative"},!t.disablePadding&&{paddingTop:8,paddingBottom:8},t.subheader&&{paddingTop:0})})),zO=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiList"}),{children:r,className:s,component:a="ul",dense:o=!1,disablePadding:l=!1,subheader:c}=i,h=(0,Ae.A)(i,FO),d=n.useMemo((()=>({dense:o})),[o]),u=(0,xe.A)({},i,{component:a,dense:o,disablePadding:l}),p=(e=>{const{classes:t,disablePadding:i,dense:n,subheader:r}=e;return Ee({root:["root",!i&&"padding",n&&"dense",r&&"subheader"]},kO,t)})(u);return(0,ve.jsx)(NO.Provider,{value:d,children:(0,ve.jsxs)(UO,(0,xe.A)({as:a,className:Se(p.root,s),ref:t,ownerState:u},h,{children:[c,r]}))})})),jO=zO,VO=$s,GO=bt,HO=["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"];function WO(e,t,i){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:i?null:e.firstChild}function QO(e,t,i){return e===t?i?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:i?null:e.lastChild}function qO(e,t){if(void 0===t)return!0;let i=e.innerText;return void 0===i&&(i=e.textContent),i=i.trim().toLowerCase(),0!==i.length&&(t.repeating?i[0]===t.keys[0]:0===i.indexOf(t.keys.join("")))}function XO(e,t,i,n,r,s){let a=!1,o=r(e,t,!!t&&i);for(;o;){if(o===e.firstChild){if(a)return!1;a=!0}const t=!n&&(o.disabled||"true"===o.getAttribute("aria-disabled"));if(o.hasAttribute("tabindex")&&qO(o,s)&&!t)return o.focus(),!0;o=r(e,o,i)}return!1}const YO=n.forwardRef((function(e,t){const{actions:i,autoFocus:r=!1,autoFocusItem:s=!1,children:a,className:o,disabledItemsFocusable:l=!1,disableListWrap:c=!1,onKeyDown:h,variant:d="selectedMenu"}=e,u=(0,Ae.A)(e,HO),p=n.useRef(null),f=n.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});GO((()=>{r&&p.current.focus()}),[r]),n.useImperativeHandle(i,(()=>({adjustStyleForScrollbar:(e,t)=>{let{direction:i}=t;const n=!p.current.style.width;if(e.clientHeight<p.current.clientHeight&&n){const t=`${VO(OO(e))}px`;p.current.style["rtl"===i?"paddingLeft":"paddingRight"]=t,p.current.style.width=`calc(100% + ${t})`}return p.current}})),[]);const m=yt(p,t);let g=-1;n.Children.forEach(a,((e,t)=>{n.isValidElement(e)?(e.props.disabled||("selectedMenu"===d&&e.props.selected||-1===g)&&(g=t),g===t&&(e.props.disabled||e.props.muiSkipListHighlight||e.type.muiSkipListHighlight)&&(g+=1,g>=a.length&&(g=-1))):g===t&&(g+=1,g>=a.length&&(g=-1))}));const v=n.Children.map(a,((e,t)=>{if(t===g){const t={};return s&&(t.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===d&&(t.tabIndex=0),n.cloneElement(e,t)}return e}));return(0,ve.jsx)(jO,(0,xe.A)({role:"menu",ref:m,className:o,onKeyDown:e=>{const t=p.current,i=e.key,n=OO(t).activeElement;if("ArrowDown"===i)e.preventDefault(),XO(t,n,c,l,WO);else if("ArrowUp"===i)e.preventDefault(),XO(t,n,c,l,QO);else if("Home"===i)e.preventDefault(),XO(t,null,c,l,WO);else if("End"===i)e.preventDefault(),XO(t,null,c,l,QO);else if(1===i.length){const r=f.current,s=i.toLowerCase(),a=performance.now();r.keys.length>0&&(a-r.lastTime>500?(r.keys=[],r.repeating=!0,r.previousKeyMatched=!0):r.repeating&&s!==r.keys[0]&&(r.repeating=!1)),r.lastTime=a,r.keys.push(s);const o=n&&!r.repeating&&qO(n,r);r.previousKeyMatched&&(o||XO(t,n,!1,l,WO,r))?e.preventDefault():r.previousKeyMatched=!1}h&&h(e)},tabIndex:r?0:-1},u,{children:v}))})),KO=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function JO(e){return`scale(${e}, ${e**2})`}const ZO={entering:{opacity:1,transform:JO(1)},entered:{opacity:1,transform:"none"}},$O="undefined"!==typeof navigator&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),eN=n.forwardRef((function(e,t){const{addEndListener:i,appear:r=!0,children:s,easing:a,in:o,onEnter:l,onEntered:c,onEntering:h,onExit:d,onExited:u,onExiting:p,style:f,timeout:m="auto",TransitionComponent:g=Ls}=e,v=(0,Ae.A)(e,KO),y=Et(),b=n.useRef(),A=Us(),x=n.useRef(null),w=yt(x,s.ref,t),S=e=>t=>{if(e){const i=x.current;void 0===t?e(i):e(i,t)}},_=S(h),E=S(((e,t)=>{zs(e);const{duration:i,delay:n,easing:r}=js({style:f,timeout:m,easing:a},{mode:"enter"});let s;"auto"===m?(s=A.transitions.getAutoHeightDuration(e.clientHeight),b.current=s):s=i,e.style.transition=[A.transitions.create("opacity",{duration:s,delay:n}),A.transitions.create("transform",{duration:$O?s:.666*s,delay:n,easing:r})].join(","),l&&l(e,t)})),C=S(c),M=S(p),T=S((e=>{const{duration:t,delay:i,easing:n}=js({style:f,timeout:m,easing:a},{mode:"exit"});let r;"auto"===m?(r=A.transitions.getAutoHeightDuration(e.clientHeight),b.current=r):r=t,e.style.transition=[A.transitions.create("opacity",{duration:r,delay:i}),A.transitions.create("transform",{duration:$O?r:.666*r,delay:$O?i:i||.333*r,easing:n})].join(","),e.style.opacity=0,e.style.transform=JO(.75),d&&d(e)})),I=S(u);return(0,ve.jsx)(g,(0,xe.A)({appear:r,in:o,nodeRef:x,onEnter:E,onEntered:C,onEntering:_,onExit:T,onExited:I,onExiting:M,addEndListener:e=>{"auto"===m&&y.start(b.current||0,e),i&&i(x.current,e)},timeout:"auto"===m?null:m},v,{children:(e,t)=>n.cloneElement(s,(0,xe.A)({style:(0,xe.A)({opacity:0,transform:JO(.75),visibility:"exited"!==e||o?void 0:"hidden"},ZO[e],f,s.props.style),ref:w},t))}))}));eN.muiSupportAuto=!0;const tN=eN;function iN(e){return Yt("MuiPopover",e)}Kt("MuiPopover",["root","paper"]);const nN=["onEntering"],rN=["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","className","container","elevation","marginThreshold","open","PaperProps","slots","slotProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps","disableScrollLock"],sN=["slotProps"];function aN(e,t){let i=0;return"number"===typeof t?i=t:"center"===t?i=e.height/2:"bottom"===t&&(i=e.height),i}function oN(e,t){let i=0;return"number"===typeof t?i=t:"center"===t?i=e.width/2:"right"===t&&(i=e.width),i}function lN(e){return[e.horizontal,e.vertical].map((e=>"number"===typeof e?`${e}px`:e)).join(" ")}function cN(e){return"function"===typeof e?e():e}const hN=ut(ua,{name:"MuiPopover",slot:"Root",overridesResolver:(e,t)=>t.root})({}),dN=ut(ya,{name:"MuiPopover",slot:"Paper",overridesResolver:(e,t)=>t.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),uN=n.forwardRef((function(e,t){var i,r,s;const a=mt({props:e,name:"MuiPopover"}),{action:o,anchorEl:l,anchorOrigin:c={vertical:"top",horizontal:"left"},anchorPosition:h,anchorReference:d="anchorEl",children:u,className:p,container:f,elevation:m=8,marginThreshold:g=16,open:v,PaperProps:y={},slots:b,slotProps:A,transformOrigin:x={vertical:"top",horizontal:"left"},TransitionComponent:w=tN,transitionDuration:S="auto",TransitionProps:{onEntering:_}={},disableScrollLock:E=!1}=a,C=(0,Ae.A)(a.TransitionProps,nN),M=(0,Ae.A)(a,rN),T=null!=(i=null==A?void 0:A.paper)?i:y,I=n.useRef(),P=yt(I,T.ref),D=(0,xe.A)({},a,{anchorOrigin:c,anchorReference:d,elevation:m,marginThreshold:g,externalPaperSlotProps:T,transformOrigin:x,TransitionComponent:w,transitionDuration:S,TransitionProps:C}),R=(e=>{const{classes:t}=e;return Ee({root:["root"],paper:["paper"]},iN,t)})(D),B=n.useCallback((()=>{if("anchorPosition"===d)return h;const e=cN(l),t=(e&&1===e.nodeType?e:OO(I.current).body).getBoundingClientRect();return{top:t.top+aN(t,c.vertical),left:t.left+oN(t,c.horizontal)}}),[l,c.horizontal,c.vertical,h,d]),L=n.useCallback((e=>({vertical:aN(e,x.vertical),horizontal:oN(e,x.horizontal)})),[x.horizontal,x.vertical]),O=n.useCallback((e=>{const t={width:e.offsetWidth,height:e.offsetHeight},i=L(t);if("none"===d)return{top:null,left:null,transformOrigin:lN(i)};const n=B();let r=n.top-i.vertical,s=n.left-i.horizontal;const a=r+t.height,o=s+t.width,c=Ja(cN(l)),h=c.innerHeight-g,u=c.innerWidth-g;if(null!==g&&r<g){const e=r-g;r-=e,i.vertical+=e}else if(null!==g&&a>h){const e=a-h;r-=e,i.vertical+=e}if(null!==g&&s<g){const e=s-g;s-=e,i.horizontal+=e}else if(o>u){const e=o-u;s-=e,i.horizontal+=e}return{top:`${Math.round(r)}px`,left:`${Math.round(s)}px`,transformOrigin:lN(i)}}),[l,d,B,L,g]),[N,k]=n.useState(v),F=n.useCallback((()=>{const e=I.current;if(!e)return;const t=O(e);null!==t.top&&(e.style.top=t.top),null!==t.left&&(e.style.left=t.left),e.style.transformOrigin=t.transformOrigin,k(!0)}),[O]);n.useEffect((()=>(E&&window.addEventListener("scroll",F),()=>window.removeEventListener("scroll",F))),[l,E,F]);n.useEffect((()=>{v&&F()})),n.useImperativeHandle(o,(()=>v?{updatePosition:()=>{F()}}:null),[v,F]),n.useEffect((()=>{if(!v)return;const e=Ka((()=>{F()})),t=Ja(l);return t.addEventListener("resize",e),()=>{e.clear(),t.removeEventListener("resize",e)}}),[l,v,F]);let U=S;"auto"!==S||w.muiSupportAuto||(U=void 0);const z=f||(l?OO(cN(l)).body:void 0),j=null!=(r=null==b?void 0:b.root)?r:hN,V=null!=(s=null==b?void 0:b.paper)?s:dN,G=vs({elementType:V,externalSlotProps:(0,xe.A)({},T,{style:N?T.style:(0,xe.A)({},T.style,{opacity:0})}),additionalProps:{elevation:m,ref:P},ownerState:D,className:Se(R.paper,null==T?void 0:T.className)}),H=vs({elementType:j,externalSlotProps:(null==A?void 0:A.root)||{},externalForwardedProps:M,additionalProps:{ref:t,slotProps:{backdrop:{invisible:!0}},container:z,open:v},ownerState:D,className:Se(R.root,p)}),{slotProps:W}=H,Q=(0,Ae.A)(H,sN);return(0,ve.jsx)(j,(0,xe.A)({},Q,!hs(j)&&{slotProps:W,disableScrollLock:E},{children:(0,ve.jsx)(w,(0,xe.A)({appear:!0,in:v,onEntering:(e,t)=>{_&&_(e,t),F()},onExited:()=>{k(!1)},timeout:U},C,{children:(0,ve.jsx)(V,(0,xe.A)({},G,{children:u}))}))}))})),pN=uN;function fN(e){return Yt("MuiMenu",e)}Kt("MuiMenu",["root","paper","list"]);const mN=["onEntering"],gN=["autoFocus","children","className","disableAutoFocusItem","MenuListProps","onClose","open","PaperProps","PopoverClasses","transitionDuration","TransitionProps","variant","slots","slotProps"],vN={vertical:"top",horizontal:"right"},yN={vertical:"top",horizontal:"left"},bN=ut(pN,{shouldForwardProp:e=>dt(e)||"classes"===e,name:"MuiMenu",slot:"Root",overridesResolver:(e,t)=>t.root})({}),AN=ut(dN,{name:"MuiMenu",slot:"Paper",overridesResolver:(e,t)=>t.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),xN=ut(YO,{name:"MuiMenu",slot:"List",overridesResolver:(e,t)=>t.list})({outline:0}),wN=n.forwardRef((function(e,t){var i,r;const s=mt({props:e,name:"MuiMenu"}),{autoFocus:a=!0,children:o,className:l,disableAutoFocusItem:c=!1,MenuListProps:h={},onClose:d,open:u,PaperProps:p={},PopoverClasses:f,transitionDuration:m="auto",TransitionProps:{onEntering:g}={},variant:v="selectedMenu",slots:y={},slotProps:b={}}=s,A=(0,Ae.A)(s.TransitionProps,mN),x=(0,Ae.A)(s,gN),w=Ir(),S=(0,xe.A)({},s,{autoFocus:a,disableAutoFocusItem:c,MenuListProps:h,onEntering:g,PaperProps:p,transitionDuration:m,TransitionProps:A,variant:v}),_=(e=>{const{classes:t}=e;return Ee({root:["root"],paper:["paper"],list:["list"]},fN,t)})(S),E=a&&!c&&u,C=n.useRef(null);let M=-1;n.Children.map(o,((e,t)=>{n.isValidElement(e)&&(e.props.disabled||("selectedMenu"===v&&e.props.selected||-1===M)&&(M=t))}));const T=null!=(i=y.paper)?i:AN,I=null!=(r=b.paper)?r:p,P=vs({elementType:y.root,externalSlotProps:b.root,ownerState:S,className:[_.root,l]}),D=vs({elementType:T,externalSlotProps:I,ownerState:S,className:_.paper});return(0,ve.jsx)(bN,(0,xe.A)({onClose:d,anchorOrigin:{vertical:"bottom",horizontal:w?"right":"left"},transformOrigin:w?vN:yN,slots:{paper:T,root:y.root},slotProps:{root:P,paper:D},open:u,ref:t,transitionDuration:m,TransitionProps:(0,xe.A)({onEntering:(e,t)=>{C.current&&C.current.adjustStyleForScrollbar(e,{direction:w?"rtl":"ltr"}),g&&g(e,t)}},A),ownerState:S},x,{classes:f,children:(0,ve.jsx)(xN,(0,xe.A)({onKeyDown:e=>{"Tab"===e.key&&(e.preventDefault(),d&&d(e,"tabKeyDown"))},actions:C,autoFocus:a&&(-1===M||c),autoFocusItem:E,variant:v},h,{className:Se(_.list,h.className),children:o}))}))})),SN=wN;const _N=Kt("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]);const EN=Kt("MuiListItemIcon",["root","alignItemsFlexStart"]);const CN=Kt("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]);function MN(e){return Yt("MuiMenuItem",e)}const TN=Kt("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),IN=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],PN=ut(gi,{shouldForwardProp:e=>dt(e)||"classes"===e,name:"MuiMenuItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.dense&&t.dense,i.divider&&t.divider,!i.disableGutters&&t.gutters]}})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!i.disableGutters&&{paddingLeft:16,paddingRight:16},i.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${TN.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,Ce.X4)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${TN.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,Ce.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${TN.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,Ce.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,Ce.X4)(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${TN.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${TN.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${_N.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${_N.inset}`]:{marginLeft:52},[`& .${CN.root}`]:{marginTop:0,marginBottom:0},[`& .${CN.inset}`]:{paddingLeft:36},[`& .${EN.root}`]:{minWidth:36}},!i.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},i.dense&&(0,xe.A)({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${EN.root} svg`]:{fontSize:"1.25rem"}}))})),DN=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiMenuItem"}),{autoFocus:r=!1,component:s="li",dense:a=!1,divider:o=!1,disableGutters:l=!1,focusVisibleClassName:c,role:h="menuitem",tabIndex:d,className:u}=i,p=(0,Ae.A)(i,IN),f=n.useContext(NO),m=n.useMemo((()=>({dense:a||f.dense||!1,disableGutters:l})),[f.dense,a,l]),g=n.useRef(null);GO((()=>{r&&g.current&&g.current.focus()}),[r]);const v=(0,xe.A)({},i,{dense:m.dense,divider:o,disableGutters:l}),y=(e=>{const{disabled:t,dense:i,divider:n,disableGutters:r,selected:s,classes:a}=e,o=Ee({root:["root",i&&"dense",t&&"disabled",!r&&"gutters",n&&"divider",s&&"selected"]},MN,a);return(0,xe.A)({},a,o)})(i),b=yt(g,t);let A;return i.disabled||(A=void 0!==d?d:-1),(0,ve.jsx)(NO.Provider,{value:m,children:(0,ve.jsx)(PN,(0,xe.A)({ref:b,role:h,tabIndex:A,component:s,focusVisibleClassName:Se(y.focusVisible,c),className:Se(y.root,u)},p,{ownerState:v,classes:y}))})})),RN=DN,BN=e=>{const t=(0,n.useContext)(sU);return(0,ve.jsxs)("div",{className:`productItem ${e.itemView}`,children:[(0,ve.jsxs)("div",{className:"imgWrapper",children:[(0,ve.jsx)("img",{src:"https://cdn.shopify.com/\u2026jpg",className:"w-100",alt:"Product"}),(0,ve.jsx)("span",{className:"badge badge-primary",children:"28%"}),(0,ve.jsxs)("div",{className:"actions",children:[(0,ve.jsx)(Ti,{onClick:()=>(e.id,void t.setisOpenProductModal(!0)),children:(0,ve.jsx)(as,{})}),(0,ve.jsx)(Ti,{children:(0,ve.jsx)(Wi,{})})]})]}),(0,ve.jsxs)("div",{className:"info",children:[(0,ve.jsx)("h5",{children:"Women's ultimate365 tour frostguard"}),(0,ve.jsx)("span",{className:"text-success d-block",children:"In Stock"}),(0,ve.jsx)(ss,{className:"mt-2 mb-2",name:"read-only",value:5,readOnly:!0,size:"small",precision:.5}),(0,ve.jsxs)("div",{className:"d-flex",children:[(0,ve.jsx)("span",{className:"oldPrice",children:"Rs-1000.00"}),(0,ve.jsx)("span",{className:"netPrice text-danger ml-2",children:"Rs-790.00"})]})]})]})};function LN(e){return Yt("MuiPagination",e)}Kt("MuiPagination",["root","ul","outlined","text"]);const ON=["boundaryCount","componentName","count","defaultPage","disabled","hideNextButton","hidePrevButton","onChange","page","showFirstButton","showLastButton","siblingCount"];function NN(e){return Yt("MuiPaginationItem",e)}const kN=Kt("MuiPaginationItem",["root","page","sizeSmall","sizeLarge","text","textPrimary","textSecondary","outlined","outlinedPrimary","outlinedSecondary","rounded","ellipsis","firstLast","previousNext","focusVisible","disabled","selected","icon","colorPrimary","colorSecondary"]),FN=jr((0,ve.jsx)("path",{d:"M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"}),"FirstPage"),UN=jr((0,ve.jsx)("path",{d:"M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}),"LastPage"),zN=jr((0,ve.jsx)("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"NavigateBefore"),jN=jr((0,ve.jsx)("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"NavigateNext"),VN=["className","color","component","components","disabled","page","selected","shape","size","slots","type","variant"],GN=(e,t)=>{const{ownerState:i}=e;return[t.root,t[i.variant],t[`size${vi(i.size)}`],"text"===i.variant&&t[`text${vi(i.color)}`],"outlined"===i.variant&&t[`outlined${vi(i.color)}`],"rounded"===i.shape&&t.rounded,"page"===i.type&&t.page,("start-ellipsis"===i.type||"end-ellipsis"===i.type)&&t.ellipsis,("previous"===i.type||"next"===i.type)&&t.previousNext,("first"===i.type||"last"===i.type)&&t.firstLast]},HN=ut("div",{name:"MuiPaginationItem",slot:"Root",overridesResolver:GN})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({},t.typography.body2,{borderRadius:16,textAlign:"center",boxSizing:"border-box",minWidth:32,padding:"0 6px",margin:"0 3px",color:(t.vars||t).palette.text.primary,height:"auto",[`&.${kN.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},"small"===i.size&&{minWidth:26,borderRadius:13,margin:"0 1px",padding:"0 4px"},"large"===i.size&&{minWidth:40,borderRadius:20,padding:"0 10px",fontSize:t.typography.pxToRem(15)})})),WN=ut(gi,{name:"MuiPaginationItem",slot:"Root",overridesResolver:GN})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({},t.typography.body2,{borderRadius:16,textAlign:"center",boxSizing:"border-box",minWidth:32,height:32,padding:"0 6px",margin:"0 3px",color:(t.vars||t).palette.text.primary,[`&.${kN.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${kN.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},transition:t.transitions.create(["color","background-color"],{duration:t.transitions.duration.short}),"&:hover":{backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${kN.selected}`]:{backgroundColor:(t.vars||t).palette.action.selected,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,Ce.X4)(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(t.vars||t).palette.action.selected}},[`&.${kN.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,Ce.X4)(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)},[`&.${kN.disabled}`]:{opacity:1,color:(t.vars||t).palette.action.disabled,backgroundColor:(t.vars||t).palette.action.selected}}},"small"===i.size&&{minWidth:26,height:26,borderRadius:13,margin:"0 1px",padding:"0 4px"},"large"===i.size&&{minWidth:40,height:40,borderRadius:20,padding:"0 10px",fontSize:t.typography.pxToRem(15)},"rounded"===i.shape&&{borderRadius:(t.vars||t).shape.borderRadius})}),(e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({},"text"===i.variant&&{[`&.${kN.selected}`]:(0,xe.A)({},"standard"!==i.color&&{color:(t.vars||t).palette[i.color].contrastText,backgroundColor:(t.vars||t).palette[i.color].main,"&:hover":{backgroundColor:(t.vars||t).palette[i.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[i.color].main}},[`&.${kN.focusVisible}`]:{backgroundColor:(t.vars||t).palette[i.color].dark}},{[`&.${kN.disabled}`]:{color:(t.vars||t).palette.action.disabled}})},"outlined"===i.variant&&{border:t.vars?`1px solid rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:"1px solid "+("light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"),[`&.${kN.selected}`]:(0,xe.A)({},"standard"!==i.color&&{color:(t.vars||t).palette[i.color].main,border:`1px solid ${t.vars?`rgba(${t.vars.palette[i.color].mainChannel} / 0.5)`:(0,Ce.X4)(t.palette[i.color].main,.5)}`,backgroundColor:t.vars?`rgba(${t.vars.palette[i.color].mainChannel} / ${t.vars.palette.action.activatedOpacity})`:(0,Ce.X4)(t.palette[i.color].main,t.palette.action.activatedOpacity),"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[i.color].mainChannel} / calc(${t.vars.palette.action.activatedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,Ce.X4)(t.palette[i.color].main,t.palette.action.activatedOpacity+t.palette.action.focusOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${kN.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[i.color].mainChannel} / calc(${t.vars.palette.action.activatedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,Ce.X4)(t.palette[i.color].main,t.palette.action.activatedOpacity+t.palette.action.focusOpacity)}},{[`&.${kN.disabled}`]:{borderColor:(t.vars||t).palette.action.disabledBackground,color:(t.vars||t).palette.action.disabled}})})})),QN=ut("div",{name:"MuiPaginationItem",slot:"Icon",overridesResolver:(e,t)=>t.icon})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({fontSize:t.typography.pxToRem(20),margin:"0 -8px"},"small"===i.size&&{fontSize:t.typography.pxToRem(18)},"large"===i.size&&{fontSize:t.typography.pxToRem(22)})})),qN=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiPaginationItem"}),{className:n,color:r="standard",component:s,components:a={},disabled:o=!1,page:l,selected:c=!1,shape:h="circular",size:d="medium",slots:u={},type:p="page",variant:f="text"}=i,m=(0,Ae.A)(i,VN),g=(0,xe.A)({},i,{color:r,disabled:o,selected:c,shape:h,size:d,type:p,variant:f}),v=Ir(),y=(e=>{const{classes:t,color:i,disabled:n,selected:r,size:s,shape:a,type:o,variant:l}=e;return Ee({root:["root",`size${vi(s)}`,l,a,"standard"!==i&&`color${vi(i)}`,"standard"!==i&&`${l}${vi(i)}`,n&&"disabled",r&&"selected",{page:"page",first:"firstLast",last:"firstLast","start-ellipsis":"ellipsis","end-ellipsis":"ellipsis",previous:"previousNext",next:"previousNext"}[o]],icon:["icon"]},NN,t)})(g),b=(v?{previous:u.next||a.next||jN,next:u.previous||a.previous||zN,last:u.first||a.first||FN,first:u.last||a.last||UN}:{previous:u.previous||a.previous||zN,next:u.next||a.next||jN,first:u.first||a.first||FN,last:u.last||a.last||UN})[p];return"start-ellipsis"===p||"end-ellipsis"===p?(0,ve.jsx)(HN,{ref:t,ownerState:g,className:Se(y.root,n),children:"\u2026"}):(0,ve.jsxs)(WN,(0,xe.A)({ref:t,ownerState:g,component:s,disabled:o,className:Se(y.root,n)},m,{children:["page"===p&&l,b?(0,ve.jsx)(QN,{as:b,ownerState:g,className:y.icon}):null]}))})),XN=qN,YN=["boundaryCount","className","color","count","defaultPage","disabled","getItemAriaLabel","hideNextButton","hidePrevButton","onChange","page","renderItem","shape","showFirstButton","showLastButton","siblingCount","size","variant"],KN=ut("nav",{name:"MuiPagination",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,t[i.variant]]}})({}),JN=ut("ul",{name:"MuiPagination",slot:"Ul",overridesResolver:(e,t)=>t.ul})({display:"flex",flexWrap:"wrap",alignItems:"center",padding:0,margin:0,listStyle:"none"});function ZN(e,t,i){return"page"===e?`${i?"":"Go to "}page ${t}`:`Go to ${e} page`}const $N=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiPagination"}),{boundaryCount:n=1,className:r,color:s="standard",count:a=1,defaultPage:o=1,disabled:l=!1,getItemAriaLabel:c=ZN,hideNextButton:h=!1,hidePrevButton:d=!1,renderItem:u=e=>(0,ve.jsx)(XN,(0,xe.A)({},e)),shape:p="circular",showFirstButton:f=!1,showLastButton:m=!1,siblingCount:g=1,size:v="medium",variant:y="text"}=i,b=(0,Ae.A)(i,YN),{items:A}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{boundaryCount:t=1,componentName:i="usePagination",count:n=1,defaultPage:r=1,disabled:s=!1,hideNextButton:a=!1,hidePrevButton:o=!1,onChange:l,page:c,showFirstButton:h=!1,showLastButton:d=!1,siblingCount:u=1}=e,p=(0,Ae.A)(e,ON),[f,m]=Lr({controlled:c,default:r,name:i,state:"page"}),g=(e,t)=>{c||m(t),l&&l(e,t)},v=(e,t)=>{const i=t-e+1;return Array.from({length:i},((t,i)=>e+i))},y=v(1,Math.min(t,n)),b=v(Math.max(n-t+1,t+1),n),A=Math.max(Math.min(f-u,n-t-2*u-1),t+2),x=Math.min(Math.max(f+u,t+2*u+2),b.length>0?b[0]-2:n-1),w=[...h?["first"]:[],...o?[]:["previous"],...y,...A>t+2?["start-ellipsis"]:t+1<n-t?[t+1]:[],...v(A,x),...x<n-t-1?["end-ellipsis"]:n-t>t?[n-t]:[],...b,...a?[]:["next"],...d?["last"]:[]],S=e=>{switch(e){case"first":return 1;case"previous":return f-1;case"next":return f+1;case"last":return n;default:return null}},_=w.map((e=>"number"===typeof e?{onClick:t=>{g(t,e)},type:"page",page:e,selected:e===f,disabled:s,"aria-current":e===f?"true":void 0}:{onClick:t=>{g(t,S(e))},type:e,page:S(e),selected:!1,disabled:s||-1===e.indexOf("ellipsis")&&("next"===e||"last"===e?f>=n:f<=1)}));return(0,xe.A)({items:_},p)}((0,xe.A)({},i,{componentName:"Pagination"})),x=(0,xe.A)({},i,{boundaryCount:n,color:s,count:a,defaultPage:o,disabled:l,getItemAriaLabel:c,hideNextButton:h,hidePrevButton:d,renderItem:u,shape:p,showFirstButton:f,showLastButton:m,siblingCount:g,size:v,variant:y}),w=(e=>{const{classes:t,variant:i}=e;return Ee({root:["root",i],ul:["ul"]},LN,t)})(x);return(0,ve.jsx)(KN,(0,xe.A)({"aria-label":"pagination navigation",className:Se(w.root,r),ownerState:x,ref:t},b,{children:(0,ve.jsx)(JN,{className:w.ul,ownerState:x,children:A.map(((e,t)=>(0,ve.jsx)("li",{children:u((0,xe.A)({},e,{color:s,"aria-label":c(e.type,e.page,e.selected),shape:p,size:v,variant:y}))},t)))})}))})),ek=$N,tk=()=>{const[e,t]=(0,n.useState)(null),[i,r]=(0,n.useState)("four"),s=Boolean(e),a=()=>{t(null)};return(0,ve.jsx)("section",{className:"product-Listing-Page",children:(0,ve.jsx)("div",{className:"container",children:(0,ve.jsxs)("div",{className:"productListing d-flex",children:[(0,ve.jsx)(BO,{}),(0,ve.jsxs)("div",{className:"content-right",children:[(0,ve.jsx)(n.Suspense,{fallback:(0,ve.jsx)("div",{children:"Loading 3D Model..."}),children:(0,ve.jsx)(ls.default,{scene:"https://prod.spline.design/3N7GoFyozF2msMrF/scene.splinecode",className:"w-100",style:{width:"100%",height:"500px",borderRadius:"8px"}})}),(0,ve.jsxs)("div",{className:"showBy mt-3 mb-3 d-flex align-items-center",children:[(0,ve.jsxs)("div",{className:"btnWrapper d-flex align-items-center gap-2",children:[(0,ve.jsx)(Ti,{className:"one"===i&&"act",onClick:()=>r("one"),children:(0,ve.jsx)(Gi,{})}),(0,ve.jsx)(Ti,{className:"two"===i&&"act",onClick:()=>r("two"),children:(0,ve.jsx)(vo,{})}),(0,ve.jsx)(Ti,{className:"three"===i&&"act",onClick:()=>r("three"),children:(0,ve.jsx)(LO,{})}),(0,ve.jsx)(Ti,{className:"four"===i&&"act",onClick:()=>r("four"),children:(0,ve.jsx)(os,{})})]}),(0,ve.jsxs)("div",{className:"ml-auto showByFilter",children:[(0,ve.jsxs)(Ti,{id:"filter-button","aria-controls":s?"filter-menu":void 0,"aria-haspopup":"true","aria-expanded":s?"true":void 0,onClick:e=>{t(e.currentTarget)},children:["Show 9 ",(0,ve.jsx)(Ha,{})]}),(0,ve.jsxs)(SN,{className:"w-100 showPerPageDropDown",id:"filter-menu",anchorEl:e,open:s,onClose:a,MenuListProps:{"aria-labelledby":"filter-button"},children:[(0,ve.jsx)(RN,{onClick:a,children:"10"}),(0,ve.jsx)(RN,{onClick:a,children:"20"}),(0,ve.jsx)(RN,{onClick:a,children:"30"}),(0,ve.jsx)(RN,{onClick:a,children:"40"}),(0,ve.jsx)(RN,{onClick:a,children:"50"})]})]})]}),(0,ve.jsxs)("div",{className:"productListing",children:[(0,ve.jsx)(BN,{itemView:i}),(0,ve.jsx)(BN,{itemView:i}),(0,ve.jsx)(BN,{itemView:i}),(0,ve.jsx)(BN,{itemView:i}),(0,ve.jsx)(BN,{itemView:i}),(0,ve.jsx)(BN,{itemView:i}),(0,ve.jsx)(BN,{itemView:i}),(0,ve.jsx)(BN,{itemView:i}),(0,ve.jsx)(BN,{itemView:i})]}),(0,ve.jsx)("div",{className:"d-flex align-items-center justify-content-center mt-5",children:(0,ve.jsx)(ek,{count:10,color:"primary",size:"large"})})]})]})})})},ik=["onChange","maxRows","minRows","style","value"];function nk(e){return parseInt(e,10)||0}const rk={visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"};const sk=n.forwardRef((function(e,t){const{onChange:i,maxRows:r,minRows:s=1,style:a,value:o}=e,l=(0,Ae.A)(e,ik),{current:c}=n.useRef(null!=o),h=n.useRef(null),d=vt(t,h),u=n.useRef(null),p=n.useRef(null),f=n.useCallback((()=>{const t=h.current,i=Zs(t).getComputedStyle(t);if("0px"===i.width)return{outerHeightStyle:0,overflowing:!1};const n=p.current;n.style.width=i.width,n.value=t.value||e.placeholder||"x","\n"===n.value.slice(-1)&&(n.value+=" ");const a=i.boxSizing,o=nk(i.paddingBottom)+nk(i.paddingTop),l=nk(i.borderBottomWidth)+nk(i.borderTopWidth),c=n.scrollHeight;n.value="x";const d=n.scrollHeight;let u=c;s&&(u=Math.max(Number(s)*d,u)),r&&(u=Math.min(Number(r)*d,u)),u=Math.max(u,d);return{outerHeightStyle:u+("border-box"===a?o+l:0),overflowing:Math.abs(u-c)<=1}}),[r,s,e.placeholder]),m=n.useCallback((()=>{const e=f();if(void 0===(t=e)||null===t||0===Object.keys(t).length||0===t.outerHeightStyle&&!t.overflowing)return;var t;const i=e.outerHeightStyle,n=h.current;u.current!==i&&(u.current=i,n.style.height=`${i}px`),n.style.overflow=e.overflowing?"hidden":""}),[f]);bt((()=>{const e=()=>{m()};let t;const i=Ya(e),n=h.current,r=Zs(n);let s;return r.addEventListener("resize",i),"undefined"!==typeof ResizeObserver&&(s=new ResizeObserver(e),s.observe(n)),()=>{i.clear(),cancelAnimationFrame(t),r.removeEventListener("resize",i),s&&s.disconnect()}}),[f,m]),bt((()=>{m()}));return(0,ve.jsxs)(n.Fragment,{children:[(0,ve.jsx)("textarea",(0,xe.A)({value:o,onChange:e=>{c||m(),i&&i(e)},ref:d,rows:s,style:a},l)),(0,ve.jsx)("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:p,tabIndex:-1,style:(0,xe.A)({},rk,a,{paddingTop:0,paddingBottom:0})})]})})),ak=sk;var ok=i(869);const lk=function(e){let{styles:t,themeId:i,defaultTheme:n={}}=e;const r=Fs(n),s="function"===typeof t?t(i&&r[i]||r):t;return(0,ve.jsx)(ok.A,{styles:s})};const ck=function(e){return(0,ve.jsx)(lk,(0,xe.A)({},e,{defaultTheme:lt,themeId:ct}))};function hk(e){return null!=e&&!(Array.isArray(e)&&0===e.length)}function dk(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&(hk(e.value)&&""!==e.value||t&&hk(e.defaultValue)&&""!==e.defaultValue)}function uk(e){return Yt("MuiInputBase",e)}const pk=Kt("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]),fk=["aria-describedby","autoComplete","autoFocus","className","color","components","componentsProps","defaultValue","disabled","disableInjectingGlobalStyles","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","maxRows","minRows","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","size","slotProps","slots","startAdornment","type","value"],mk=(e,t)=>{const{ownerState:i}=e;return[t.root,i.formControl&&t.formControl,i.startAdornment&&t.adornedStart,i.endAdornment&&t.adornedEnd,i.error&&t.error,"small"===i.size&&t.sizeSmall,i.multiline&&t.multiline,i.color&&t[`color${vi(i.color)}`],i.fullWidth&&t.fullWidth,i.hiddenLabel&&t.hiddenLabel]},gk=(e,t)=>{const{ownerState:i}=e;return[t.input,"small"===i.size&&t.inputSizeSmall,i.multiline&&t.inputMultiline,"search"===i.type&&t.inputTypeSearch,i.startAdornment&&t.inputAdornedStart,i.endAdornment&&t.inputAdornedEnd,i.hiddenLabel&&t.inputHiddenLabel]},vk=ut("div",{name:"MuiInputBase",slot:"Root",overridesResolver:mk})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({},t.typography.body1,{color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${pk.disabled}`]:{color:(t.vars||t).palette.text.disabled,cursor:"default"}},i.multiline&&(0,xe.A)({padding:"4px 0 5px"},"small"===i.size&&{paddingTop:1}),i.fullWidth&&{width:"100%"})})),yk=ut("input",{name:"MuiInputBase",slot:"Input",overridesResolver:gk})((e=>{let{theme:t,ownerState:i}=e;const n="light"===t.palette.mode,r=(0,xe.A)({color:"currentColor"},t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:n?.42:.5},{transition:t.transitions.create("opacity",{duration:t.transitions.duration.shorter})}),s={opacity:"0 !important"},a=t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:n?.42:.5};return(0,xe.A)({font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":r,"&::-moz-placeholder":r,"&:-ms-input-placeholder":r,"&::-ms-input-placeholder":r,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${pk.formControl} &`]:{"&::-webkit-input-placeholder":s,"&::-moz-placeholder":s,"&:-ms-input-placeholder":s,"&::-ms-input-placeholder":s,"&:focus::-webkit-input-placeholder":a,"&:focus::-moz-placeholder":a,"&:focus:-ms-input-placeholder":a,"&:focus::-ms-input-placeholder":a},[`&.${pk.disabled}`]:{opacity:1,WebkitTextFillColor:(t.vars||t).palette.text.disabled},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},"small"===i.size&&{paddingTop:1},i.multiline&&{height:"auto",resize:"none",padding:0,paddingTop:0},"search"===i.type&&{MozAppearance:"textfield"})})),bk=(0,ve.jsx)(ck,{styles:{"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}}),Ak=n.forwardRef((function(e,t){var i;const r=mt({props:e,name:"MuiInputBase"}),{"aria-describedby":s,autoComplete:a,autoFocus:o,className:l,components:c={},componentsProps:h={},defaultValue:d,disabled:u,disableInjectingGlobalStyles:p,endAdornment:f,fullWidth:m=!1,id:g,inputComponent:v="input",inputProps:y={},inputRef:b,maxRows:A,minRows:x,multiline:w=!1,name:S,onBlur:_,onChange:E,onClick:C,onFocus:M,onKeyDown:T,onKeyUp:I,placeholder:P,readOnly:D,renderSuffix:R,rows:B,slotProps:L={},slots:O={},startAdornment:N,type:k="text",value:F}=r,U=(0,Ae.A)(r,fk),z=null!=y.value?y.value:F,{current:j}=n.useRef(null!=z),V=n.useRef(),G=n.useCallback((e=>{0}),[]),H=yt(V,b,y.ref,G),[W,Q]=n.useState(!1),q=TL();const X=lO({props:r,muiFormControl:q,states:["color","disabled","error","hiddenLabel","size","required","filled"]});X.focused=q?q.focused:W,n.useEffect((()=>{!q&&u&&W&&(Q(!1),_&&_())}),[q,u,W,_]);const Y=q&&q.onFilled,K=q&&q.onEmpty,J=n.useCallback((e=>{dk(e)?Y&&Y():K&&K()}),[Y,K]);GO((()=>{j&&J({value:z})}),[z,J,j]);n.useEffect((()=>{J(V.current)}),[]);let Z=v,$=y;w&&"input"===Z&&($=B?(0,xe.A)({type:void 0,minRows:B,maxRows:B},$):(0,xe.A)({type:void 0,maxRows:A,minRows:x},$),Z=ak);n.useEffect((()=>{q&&q.setAdornedStart(Boolean(N))}),[q,N]);const ee=(0,xe.A)({},r,{color:X.color||"primary",disabled:X.disabled,endAdornment:f,error:X.error,focused:X.focused,formControl:q,fullWidth:m,hiddenLabel:X.hiddenLabel,multiline:w,size:X.size,startAdornment:N,type:k}),te=(e=>{const{classes:t,color:i,disabled:n,error:r,endAdornment:s,focused:a,formControl:o,fullWidth:l,hiddenLabel:c,multiline:h,readOnly:d,size:u,startAdornment:p,type:f}=e;return Ee({root:["root",`color${vi(i)}`,n&&"disabled",r&&"error",l&&"fullWidth",a&&"focused",o&&"formControl",u&&"medium"!==u&&`size${vi(u)}`,h&&"multiline",p&&"adornedStart",s&&"adornedEnd",c&&"hiddenLabel",d&&"readOnly"],input:["input",n&&"disabled","search"===f&&"inputTypeSearch",h&&"inputMultiline","small"===u&&"inputSizeSmall",c&&"inputHiddenLabel",p&&"inputAdornedStart",s&&"inputAdornedEnd",d&&"readOnly"]},uk,t)})(ee),ie=O.root||c.Root||vk,ne=L.root||h.root||{},re=O.input||c.Input||yk;return $=(0,xe.A)({},$,null!=(i=L.input)?i:h.input),(0,ve.jsxs)(n.Fragment,{children:[!p&&bk,(0,ve.jsxs)(ie,(0,xe.A)({},ne,!hs(ie)&&{ownerState:(0,xe.A)({},ee,ne.ownerState)},{ref:t,onClick:e=>{V.current&&e.currentTarget===e.target&&V.current.focus(),C&&C(e)}},U,{className:Se(te.root,ne.className,l,D&&"MuiInputBase-readOnly"),children:[N,(0,ve.jsx)(ML.Provider,{value:null,children:(0,ve.jsx)(re,(0,xe.A)({ownerState:ee,"aria-invalid":X.error,"aria-describedby":s,autoComplete:a,autoFocus:o,defaultValue:d,disabled:X.disabled,id:g,onAnimationStart:e=>{J("mui-auto-fill-cancel"===e.animationName?V.current:{value:"x"})},name:S,placeholder:P,readOnly:D,required:X.required,rows:B,value:z,onKeyDown:T,onKeyUp:I,type:k},$,!hs(re)&&{as:Z,ownerState:(0,xe.A)({},ee,$.ownerState)},{ref:H,className:Se(te.input,$.className,D&&"MuiInputBase-readOnly"),onBlur:e=>{_&&_(e),y.onBlur&&y.onBlur(e),q&&q.onBlur?q.onBlur(e):Q(!1)},onChange:function(e){if(!j){const t=e.target||V.current;if(null==t)throw new Error((0,Te.A)(1));J({value:t.value})}for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];y.onChange&&y.onChange(e,...i),E&&E(e,...i)},onFocus:e=>{X.disabled?e.stopPropagation():(M&&M(e),y.onFocus&&y.onFocus(e),q&&q.onFocus?q.onFocus(e):Q(!0))}}))}),f,R?R((0,xe.A)({},X,{startAdornment:N})):null]}))]})})),xk=Ak;function wk(e){return Yt("MuiInput",e)}const Sk=(0,xe.A)({},pk,Kt("MuiInput",["root","underline","input"])),_k=["disableUnderline","components","componentsProps","fullWidth","inputComponent","multiline","slotProps","slots","type"],Ek=ut(vk,{shouldForwardProp:e=>dt(e)||"classes"===e,name:"MuiInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[...mk(e,t),!i.disableUnderline&&t.underline]}})((e=>{let{theme:t,ownerState:i}=e;let n="light"===t.palette.mode?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(n=`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`),(0,xe.A)({position:"relative"},i.formControl&&{"label + &":{marginTop:16}},!i.disableUnderline&&{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[i.color].main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Sk.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Sk.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${n}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Sk.disabled}, .${Sk.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${n}`}},[`&.${Sk.disabled}:before`]:{borderBottomStyle:"dotted"}})})),Ck=ut(yk,{name:"MuiInput",slot:"Input",overridesResolver:gk})({}),Mk=n.forwardRef((function(e,t){var i,n,r,s;const a=mt({props:e,name:"MuiInput"}),{disableUnderline:o,components:l={},componentsProps:c,fullWidth:h=!1,inputComponent:d="input",multiline:u=!1,slotProps:p,slots:f={},type:m="text"}=a,g=(0,Ae.A)(a,_k),v=(e=>{const{classes:t,disableUnderline:i}=e,n=Ee({root:["root",!i&&"underline"],input:["input"]},wk,t);return(0,xe.A)({},t,n)})(a),y={root:{ownerState:{disableUnderline:o}}},b=(null!=p?p:c)?(0,Ie.A)(null!=p?p:c,y):y,A=null!=(i=null!=(n=f.root)?n:l.Root)?i:Ek,x=null!=(r=null!=(s=f.input)?s:l.Input)?r:Ck;return(0,ve.jsx)(xk,(0,xe.A)({slots:{root:A,input:x},slotProps:b,fullWidth:h,inputComponent:d,multiline:u,ref:t,type:m},g,{classes:v}))}));Mk.muiName="Input";const Tk=Mk;function Ik(e){return Yt("MuiFilledInput",e)}const Pk=(0,xe.A)({},pk,Kt("MuiFilledInput",["root","underline","input"])),Dk=["disableUnderline","components","componentsProps","fullWidth","hiddenLabel","inputComponent","multiline","slotProps","slots","type"],Rk=ut(vk,{shouldForwardProp:e=>dt(e)||"classes"===e,name:"MuiFilledInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[...mk(e,t),!i.disableUnderline&&t.underline]}})((e=>{let{theme:t,ownerState:i}=e;var n;const r="light"===t.palette.mode,s=r?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",a=r?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",o=r?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",l=r?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return(0,xe.A)({position:"relative",backgroundColor:t.vars?t.vars.palette.FilledInput.bg:a,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:o,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:a}},[`&.${Pk.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:a},[`&.${Pk.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:l}},!i.disableUnderline&&{"&::after":{borderBottom:`2px solid ${null==(n=(t.vars||t).palette[i.color||"primary"])?void 0:n.main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Pk.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Pk.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`:s}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Pk.disabled}, .${Pk.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${Pk.disabled}:before`]:{borderBottomStyle:"dotted"}},i.startAdornment&&{paddingLeft:12},i.endAdornment&&{paddingRight:12},i.multiline&&(0,xe.A)({padding:"25px 12px 8px"},"small"===i.size&&{paddingTop:21,paddingBottom:4},i.hiddenLabel&&{paddingTop:16,paddingBottom:17},i.hiddenLabel&&"small"===i.size&&{paddingTop:8,paddingBottom:9}))})),Bk=ut(yk,{name:"MuiFilledInput",slot:"Input",overridesResolver:gk})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},"small"===i.size&&{paddingTop:21,paddingBottom:4},i.hiddenLabel&&{paddingTop:16,paddingBottom:17},i.startAdornment&&{paddingLeft:0},i.endAdornment&&{paddingRight:0},i.hiddenLabel&&"small"===i.size&&{paddingTop:8,paddingBottom:9},i.multiline&&{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0})})),Lk=n.forwardRef((function(e,t){var i,n,r,s;const a=mt({props:e,name:"MuiFilledInput"}),{components:o={},componentsProps:l,fullWidth:c=!1,inputComponent:h="input",multiline:d=!1,slotProps:u,slots:p={},type:f="text"}=a,m=(0,Ae.A)(a,Dk),g=(0,xe.A)({},a,{fullWidth:c,inputComponent:h,multiline:d,type:f}),v=(e=>{const{classes:t,disableUnderline:i}=e,n=Ee({root:["root",!i&&"underline"],input:["input"]},Ik,t);return(0,xe.A)({},t,n)})(a),y={root:{ownerState:g},input:{ownerState:g}},b=(null!=u?u:l)?(0,Ie.A)(y,null!=u?u:l):y,A=null!=(i=null!=(n=p.root)?n:o.Root)?i:Rk,x=null!=(r=null!=(s=p.input)?s:o.Input)?r:Bk;return(0,ve.jsx)(xk,(0,xe.A)({slots:{root:A,input:x},componentsProps:b,fullWidth:c,inputComponent:h,multiline:d,ref:t,type:f},m,{classes:v}))}));Lk.muiName="Input";const Ok=Lk;var Nk;const kk=["children","classes","className","label","notched"],Fk=ut("fieldset",{shouldForwardProp:dt})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),Uk=ut("legend",{shouldForwardProp:dt})((e=>{let{ownerState:t,theme:i}=e;return(0,xe.A)({float:"unset",width:"auto",overflow:"hidden"},!t.withLabel&&{padding:0,lineHeight:"11px",transition:i.transitions.create("width",{duration:150,easing:i.transitions.easing.easeOut})},t.withLabel&&(0,xe.A)({display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:i.transitions.create("max-width",{duration:50,easing:i.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}},t.notched&&{maxWidth:"100%",transition:i.transitions.create("max-width",{duration:100,easing:i.transitions.easing.easeOut,delay:50})}))}));function zk(e){return Yt("MuiOutlinedInput",e)}const jk=(0,xe.A)({},pk,Kt("MuiOutlinedInput",["root","notchedOutline","input"])),Vk=["components","fullWidth","inputComponent","label","multiline","notched","slots","type"],Gk=ut(vk,{shouldForwardProp:e=>dt(e)||"classes"===e,name:"MuiOutlinedInput",slot:"Root",overridesResolver:mk})((e=>{let{theme:t,ownerState:i}=e;const n="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return(0,xe.A)({position:"relative",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${jk.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},"@media (hover: none)":{[`&:hover .${jk.notchedOutline}`]:{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:n}},[`&.${jk.focused} .${jk.notchedOutline}`]:{borderColor:(t.vars||t).palette[i.color].main,borderWidth:2},[`&.${jk.error} .${jk.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},[`&.${jk.disabled} .${jk.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled}},i.startAdornment&&{paddingLeft:14},i.endAdornment&&{paddingRight:14},i.multiline&&(0,xe.A)({padding:"16.5px 14px"},"small"===i.size&&{padding:"8.5px 14px"}))})),Hk=ut((function(e){const{className:t,label:i,notched:n}=e,r=(0,Ae.A)(e,kk),s=null!=i&&""!==i,a=(0,xe.A)({},e,{notched:n,withLabel:s});return(0,ve.jsx)(Fk,(0,xe.A)({"aria-hidden":!0,className:t,ownerState:a},r,{children:(0,ve.jsx)(Uk,{ownerState:a,children:s?(0,ve.jsx)("span",{children:i}):Nk||(Nk=(0,ve.jsx)("span",{className:"notranslate",children:"\u200b"}))})}))}),{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(e,t)=>t.notchedOutline})((e=>{let{theme:t}=e;const i="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:i}})),Wk=ut(yk,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:gk})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({padding:"16.5px 14px"},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},"small"===i.size&&{padding:"8.5px 14px"},i.multiline&&{padding:0},i.startAdornment&&{paddingLeft:0},i.endAdornment&&{paddingRight:0})})),Qk=n.forwardRef((function(e,t){var i,r,s,a,o;const l=mt({props:e,name:"MuiOutlinedInput"}),{components:c={},fullWidth:h=!1,inputComponent:d="input",label:u,multiline:p=!1,notched:f,slots:m={},type:g="text"}=l,v=(0,Ae.A)(l,Vk),y=(e=>{const{classes:t}=e,i=Ee({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},zk,t);return(0,xe.A)({},t,i)})(l),b=TL(),A=lO({props:l,muiFormControl:b,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),x=(0,xe.A)({},l,{color:A.color||"primary",disabled:A.disabled,error:A.error,focused:A.focused,formControl:b,fullWidth:h,hiddenLabel:A.hiddenLabel,multiline:p,size:A.size,type:g}),w=null!=(i=null!=(r=m.root)?r:c.Root)?i:Gk,S=null!=(s=null!=(a=m.input)?a:c.Input)?s:Wk;return(0,ve.jsx)(xk,(0,xe.A)({slots:{root:w,input:S},renderSuffix:e=>(0,ve.jsx)(Hk,{ownerState:x,className:y.notchedOutline,label:null!=u&&""!==u&&A.required?o||(o=(0,ve.jsxs)(n.Fragment,{children:[u,"\u2009","*"]})):u,notched:"undefined"!==typeof f?f:Boolean(e.startAdornment||e.filled||e.focused)}),fullWidth:h,inputComponent:d,multiline:p,ref:t,type:g},v,{classes:(0,xe.A)({},y,{notchedOutline:null})}))}));Qk.muiName="Input";const qk=Qk;function Xk(e){return Yt("MuiFormLabel",e)}const Yk=Kt("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),Kk=["children","className","color","component","disabled","error","filled","focused","required"],Jk=ut("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:i}=e;return(0,xe.A)({},t.root,"secondary"===i.color&&t.colorSecondary,i.filled&&t.filled)}})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({color:(t.vars||t).palette.text.secondary},t.typography.body1,{lineHeight:"1.4375em",padding:0,position:"relative",[`&.${Yk.focused}`]:{color:(t.vars||t).palette[i.color].main},[`&.${Yk.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${Yk.error}`]:{color:(t.vars||t).palette.error.main}})})),Zk=ut("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})((e=>{let{theme:t}=e;return{[`&.${Yk.error}`]:{color:(t.vars||t).palette.error.main}}})),$k=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiFormLabel"}),{children:n,className:r,component:s="label"}=i,a=(0,Ae.A)(i,Kk),o=lO({props:i,muiFormControl:TL(),states:["color","required","focused","disabled","error","filled"]}),l=(0,xe.A)({},i,{color:o.color||"primary",component:s,disabled:o.disabled,error:o.error,filled:o.filled,focused:o.focused,required:o.required}),c=(e=>{const{classes:t,color:i,focused:n,disabled:r,error:s,filled:a,required:o}=e;return Ee({root:["root",`color${vi(i)}`,r&&"disabled",s&&"error",a&&"filled",n&&"focused",o&&"required"],asterisk:["asterisk",s&&"error"]},Xk,t)})(l);return(0,ve.jsxs)(Jk,(0,xe.A)({as:s,ownerState:l,className:Se(c.root,r),ref:t},a,{children:[n,o.required&&(0,ve.jsxs)(Zk,{ownerState:l,"aria-hidden":!0,className:c.asterisk,children:["\u2009","*"]})]}))})),eF=$k;function tF(e){return Yt("MuiInputLabel",e)}Kt("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const iF=["disableAnimation","margin","shrink","variant","className"],nF=ut(eF,{shouldForwardProp:e=>dt(e)||"classes"===e,name:"MuiInputLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[{[`& .${Yk.asterisk}`]:t.asterisk},t.root,i.formControl&&t.formControl,"small"===i.size&&t.sizeSmall,i.shrink&&t.shrink,!i.disableAnimation&&t.animated,i.focused&&t.focused,t[i.variant]]}})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},i.formControl&&{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"},"small"===i.size&&{transform:"translate(0, 17px) scale(1)"},i.shrink&&{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"},!i.disableAnimation&&{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})},"filled"===i.variant&&(0,xe.A)({zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===i.size&&{transform:"translate(12px, 13px) scale(1)"},i.shrink&&(0,xe.A)({userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"},"small"===i.size&&{transform:"translate(12px, 4px) scale(0.75)"})),"outlined"===i.variant&&(0,xe.A)({zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===i.size&&{transform:"translate(14px, 9px) scale(1)"},i.shrink&&{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}))})),rF=n.forwardRef((function(e,t){const i=mt({name:"MuiInputLabel",props:e}),{disableAnimation:n=!1,shrink:r,className:s}=i,a=(0,Ae.A)(i,iF),o=TL();let l=r;"undefined"===typeof l&&o&&(l=o.filled||o.focused||o.adornedStart);const c=lO({props:i,muiFormControl:o,states:["size","variant","required","focused"]}),h=(0,xe.A)({},i,{disableAnimation:n,formControl:o,shrink:l,size:c.size,variant:c.variant,required:c.required,focused:c.focused}),d=(e=>{const{classes:t,formControl:i,size:n,shrink:r,disableAnimation:s,variant:a,required:o}=e,l=Ee({root:["root",i&&"formControl",!s&&"animated",r&&"shrink",n&&"normal"!==n&&`size${vi(n)}`,a],asterisk:[o&&"asterisk"]},tF,t);return(0,xe.A)({},t,l)})(h);return(0,ve.jsx)(nF,(0,xe.A)({"data-shrink":l,ownerState:h,ref:t,className:Se(d.root,s)},a,{classes:d}))})),sF=rF;const aF=function(e,t){var i,r;return n.isValidElement(e)&&-1!==t.indexOf(null!=(i=e.type.muiName)?i:null==(r=e.type)||null==(r=r._payload)||null==(r=r.value)?void 0:r.muiName)};function oF(e){return Yt("MuiFormControl",e)}Kt("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const lF=["children","className","color","component","disabled","error","focused","fullWidth","hiddenLabel","margin","required","size","variant"],cF=ut("div",{name:"MuiFormControl",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:i}=e;return(0,xe.A)({},t.root,t[`margin${vi(i.margin)}`],i.fullWidth&&t.fullWidth)}})((e=>{let{ownerState:t}=e;return(0,xe.A)({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top"},"normal"===t.margin&&{marginTop:16,marginBottom:8},"dense"===t.margin&&{marginTop:8,marginBottom:4},t.fullWidth&&{width:"100%"})})),hF=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiFormControl"}),{children:r,className:s,color:a="primary",component:o="div",disabled:l=!1,error:c=!1,focused:h,fullWidth:d=!1,hiddenLabel:u=!1,margin:p="none",required:f=!1,size:m="medium",variant:g="outlined"}=i,v=(0,Ae.A)(i,lF),y=(0,xe.A)({},i,{color:a,component:o,disabled:l,error:c,fullWidth:d,hiddenLabel:u,margin:p,required:f,size:m,variant:g}),b=(e=>{const{classes:t,margin:i,fullWidth:n}=e;return Ee({root:["root","none"!==i&&`margin${vi(i)}`,n&&"fullWidth"]},oF,t)})(y),[A,x]=n.useState((()=>{let e=!1;return r&&n.Children.forEach(r,(t=>{if(!aF(t,["Input","Select"]))return;const i=aF(t,["Select"])?t.props.input:t;i&&i.props.startAdornment&&(e=!0)})),e})),[w,S]=n.useState((()=>{let e=!1;return r&&n.Children.forEach(r,(t=>{aF(t,["Input","Select"])&&(dk(t.props,!0)||dk(t.props.inputProps,!0))&&(e=!0)})),e})),[_,E]=n.useState(!1);l&&_&&E(!1);const C=void 0===h||l?_:h;let M;const T=n.useMemo((()=>({adornedStart:A,setAdornedStart:x,color:a,disabled:l,error:c,filled:w,focused:C,fullWidth:d,hiddenLabel:u,size:m,onBlur:()=>{E(!1)},onEmpty:()=>{S(!1)},onFilled:()=>{S(!0)},onFocus:()=>{E(!0)},registerEffect:M,required:f,variant:g})),[A,a,l,c,w,C,d,u,M,f,m,g]);return(0,ve.jsx)(ML.Provider,{value:T,children:(0,ve.jsx)(cF,(0,xe.A)({as:o,ownerState:y,className:Se(b.root,s),ref:t},v,{children:r}))})})),dF=hF;function uF(e){return Yt("MuiFormHelperText",e)}const pF=Kt("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var fF;const mF=["children","className","component","disabled","error","filled","focused","margin","required","variant"],gF=ut("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.size&&t[`size${vi(i.size)}`],i.contained&&t.contained,i.filled&&t.filled]}})((e=>{let{theme:t,ownerState:i}=e;return(0,xe.A)({color:(t.vars||t).palette.text.secondary},t.typography.caption,{textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${pF.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${pF.error}`]:{color:(t.vars||t).palette.error.main}},"small"===i.size&&{marginTop:4},i.contained&&{marginLeft:14,marginRight:14})})),vF=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiFormHelperText"}),{children:n,className:r,component:s="p"}=i,a=(0,Ae.A)(i,mF),o=lO({props:i,muiFormControl:TL(),states:["variant","size","disabled","error","filled","focused","required"]}),l=(0,xe.A)({},i,{component:s,contained:"filled"===o.variant||"outlined"===o.variant,variant:o.variant,size:o.size,disabled:o.disabled,error:o.error,filled:o.filled,focused:o.focused,required:o.required}),c=(e=>{const{classes:t,contained:i,size:n,disabled:r,error:s,filled:a,focused:o,required:l}=e;return Ee({root:["root",r&&"disabled",s&&"error",n&&`size${vi(n)}`,i&&"contained",o&&"focused",a&&"filled",l&&"required"]},uF,t)})(l);return(0,ve.jsx)(gF,(0,xe.A)({as:s,ownerState:l,className:Se(c.root,r),ref:t},a,{children:" "===n?fF||(fF=(0,ve.jsx)("span",{className:"notranslate",children:"\u200b"})):n}))})),yF=vF;function bF(e){return Yt("MuiNativeSelect",e)}const AF=Kt("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),xF=["className","disabled","error","IconComponent","inputRef","variant"],wF=e=>{let{ownerState:t,theme:i}=e;return(0,xe.A)({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":(0,xe.A)({},i.vars?{backgroundColor:`rgba(${i.vars.palette.common.onBackgroundChannel} / 0.05)`}:{backgroundColor:"light"===i.palette.mode?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)"},{borderRadius:0}),"&::-ms-expand":{display:"none"},[`&.${AF.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(i.vars||i).palette.background.paper},"&&&":{paddingRight:24,minWidth:16}},"filled"===t.variant&&{"&&&":{paddingRight:32}},"outlined"===t.variant&&{borderRadius:(i.vars||i).shape.borderRadius,"&:focus":{borderRadius:(i.vars||i).shape.borderRadius},"&&&":{paddingRight:32}})},SF=ut("select",{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:dt,overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.select,t[i.variant],i.error&&t.error,{[`&.${AF.multiple}`]:t.multiple}]}})(wF),_F=e=>{let{ownerState:t,theme:i}=e;return(0,xe.A)({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(i.vars||i).palette.action.active,[`&.${AF.disabled}`]:{color:(i.vars||i).palette.action.disabled}},t.open&&{transform:"rotate(180deg)"},"filled"===t.variant&&{right:7},"outlined"===t.variant&&{right:7})},EF=ut("svg",{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.icon,i.variant&&t[`icon${vi(i.variant)}`],i.open&&t.iconOpen]}})(_F),CF=n.forwardRef((function(e,t){const{className:i,disabled:r,error:s,IconComponent:a,inputRef:o,variant:l="standard"}=e,c=(0,Ae.A)(e,xF),h=(0,xe.A)({},e,{disabled:r,variant:l,error:s}),d=(e=>{const{classes:t,variant:i,disabled:n,multiple:r,open:s,error:a}=e;return Ee({select:["select",i,n&&"disabled",r&&"multiple",a&&"error"],icon:["icon",`icon${vi(i)}`,s&&"iconOpen",n&&"disabled"]},bF,t)})(h);return(0,ve.jsxs)(n.Fragment,{children:[(0,ve.jsx)(SF,(0,xe.A)({ownerState:h,className:Se(d.select,i),disabled:r,ref:o||t},c)),e.multiple?null:(0,ve.jsx)(EF,{as:a,ownerState:h,className:d.icon})]})})),MF=CF;function TF(e){return Yt("MuiSelect",e)}const IF=Kt("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var PF;const DF=["aria-describedby","aria-label","autoFocus","autoWidth","children","className","defaultOpen","defaultValue","disabled","displayEmpty","error","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"],RF=ut("div",{name:"MuiSelect",slot:"Select",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[{[`&.${IF.select}`]:t.select},{[`&.${IF.select}`]:t[i.variant]},{[`&.${IF.error}`]:t.error},{[`&.${IF.multiple}`]:t.multiple}]}})(wF,{[`&.${IF.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),BF=ut("svg",{name:"MuiSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.icon,i.variant&&t[`icon${vi(i.variant)}`],i.open&&t.iconOpen]}})(_F),LF=ut("input",{shouldForwardProp:e=>ht(e)&&"classes"!==e,name:"MuiSelect",slot:"NativeInput",overridesResolver:(e,t)=>t.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function OF(e,t){return"object"===typeof t&&null!==t?e===t:String(e)===String(t)}function NF(e){return null==e||"string"===typeof e&&!e.trim()}const kF=n.forwardRef((function(e,t){var i;const{"aria-describedby":r,"aria-label":s,autoFocus:a,autoWidth:o,children:l,className:c,defaultOpen:h,defaultValue:d,disabled:u,displayEmpty:p,error:f=!1,IconComponent:m,inputRef:g,labelId:v,MenuProps:y={},multiple:b,name:A,onBlur:x,onChange:w,onClose:S,onFocus:_,onOpen:E,open:C,readOnly:M,renderValue:T,SelectDisplayProps:I={},tabIndex:P,value:D,variant:R="standard"}=e,B=(0,Ae.A)(e,DF),[L,O]=Or({controlled:D,default:d,name:"Select"}),[N,k]=Or({controlled:C,default:h,name:"Select"}),F=n.useRef(null),U=n.useRef(null),[z,j]=n.useState(null),{current:V}=n.useRef(null!=C),[G,H]=n.useState(),W=yt(t,g),Q=n.useCallback((e=>{U.current=e,e&&j(e)}),[]),q=null==z?void 0:z.parentNode;n.useImperativeHandle(W,(()=>({focus:()=>{U.current.focus()},node:F.current,value:L})),[L]),n.useEffect((()=>{h&&N&&z&&!V&&(H(o?null:q.clientWidth),U.current.focus())}),[z,o]),n.useEffect((()=>{a&&U.current.focus()}),[a]),n.useEffect((()=>{if(!v)return;const e=OO(U.current).getElementById(v);if(e){const t=()=>{getSelection().isCollapsed&&U.current.focus()};return e.addEventListener("click",t),()=>{e.removeEventListener("click",t)}}}),[v]);const X=(e,t)=>{e?E&&E(t):S&&S(t),V||(H(o?null:q.clientWidth),k(e))},Y=n.Children.toArray(l),K=e=>t=>{let i;if(t.currentTarget.hasAttribute("tabindex")){if(b){i=Array.isArray(L)?L.slice():[];const t=L.indexOf(e.props.value);-1===t?i.push(e.props.value):i.splice(t,1)}else i=e.props.value;if(e.props.onClick&&e.props.onClick(t),L!==i&&(O(i),w)){const n=t.nativeEvent||t,r=new n.constructor(n.type,n);Object.defineProperty(r,"target",{writable:!0,value:{value:i,name:A}}),w(r,e)}b||X(!1,t)}},J=null!==z&&N;let Z,$;delete B["aria-invalid"];const ee=[];let te=!1,ie=!1;(dk({value:L})||p)&&(T?Z=T(L):te=!0);const ne=Y.map((e=>{if(!n.isValidElement(e))return null;let t;if(b){if(!Array.isArray(L))throw new Error((0,Te.A)(2));t=L.some((t=>OF(t,e.props.value))),t&&te&&ee.push(e.props.children)}else t=OF(L,e.props.value),t&&te&&($=e.props.children);return t&&(ie=!0),n.cloneElement(e,{"aria-selected":t?"true":"false",onClick:K(e),onKeyUp:t=>{" "===t.key&&t.preventDefault(),e.props.onKeyUp&&e.props.onKeyUp(t)},role:"option",selected:t,value:void 0,"data-value":e.props.value})}));te&&(Z=b?0===ee.length?null:ee.reduce(((e,t,i)=>(e.push(t),i<ee.length-1&&e.push(", "),e)),[]):$);let re,se=G;!o&&V&&z&&(se=q.clientWidth),re="undefined"!==typeof P?P:u?null:0;const ae=I.id||(A?`mui-component-select-${A}`:void 0),oe=(0,xe.A)({},e,{variant:R,value:L,open:J,error:f}),le=(e=>{const{classes:t,variant:i,disabled:n,multiple:r,open:s,error:a}=e;return Ee({select:["select",i,n&&"disabled",r&&"multiple",a&&"error"],icon:["icon",`icon${vi(i)}`,s&&"iconOpen",n&&"disabled"],nativeInput:["nativeInput"]},TF,t)})(oe),ce=(0,xe.A)({},y.PaperProps,null==(i=y.slotProps)?void 0:i.paper),he=Rr();return(0,ve.jsxs)(n.Fragment,{children:[(0,ve.jsx)(RF,(0,xe.A)({ref:Q,tabIndex:re,role:"combobox","aria-controls":he,"aria-disabled":u?"true":void 0,"aria-expanded":J?"true":"false","aria-haspopup":"listbox","aria-label":s,"aria-labelledby":[v,ae].filter(Boolean).join(" ")||void 0,"aria-describedby":r,onKeyDown:e=>{if(!M){-1!==[" ","ArrowUp","ArrowDown","Enter"].indexOf(e.key)&&(e.preventDefault(),X(!0,e))}},onMouseDown:u||M?null:e=>{0===e.button&&(e.preventDefault(),U.current.focus(),X(!0,e))},onBlur:e=>{!J&&x&&(Object.defineProperty(e,"target",{writable:!0,value:{value:L,name:A}}),x(e))},onFocus:_},I,{ownerState:oe,className:Se(I.className,le.select,c),id:ae,children:NF(Z)?PF||(PF=(0,ve.jsx)("span",{className:"notranslate",children:"\u200b"})):Z})),(0,ve.jsx)(LF,(0,xe.A)({"aria-invalid":f,value:Array.isArray(L)?L.join(","):L,name:A,ref:F,"aria-hidden":!0,onChange:e=>{const t=Y.find((t=>t.props.value===e.target.value));void 0!==t&&(O(t.props.value),w&&w(e,t))},tabIndex:-1,disabled:u,className:le.nativeInput,autoFocus:a,ownerState:oe},B)),(0,ve.jsx)(BF,{as:m,className:le.icon,ownerState:oe}),(0,ve.jsx)(SN,(0,xe.A)({id:`menu-${A||""}`,anchorEl:q,open:J,onClose:e=>{X(!1,e)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},y,{MenuListProps:(0,xe.A)({"aria-labelledby":v,role:"listbox","aria-multiselectable":b?"true":void 0,disableListWrap:!0,id:he},y.MenuListProps),slotProps:(0,xe.A)({},y.slotProps,{paper:(0,xe.A)({},ce,{style:(0,xe.A)({minWidth:se},null!=ce?ce.style:null)})}),children:ne}))]})})),FF=kF,UF=jr((0,ve.jsx)("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),zF=["autoWidth","children","classes","className","defaultOpen","displayEmpty","IconComponent","id","input","inputProps","label","labelId","MenuProps","multiple","native","onClose","onOpen","open","renderValue","SelectDisplayProps","variant"],jF=["root"],VF={name:"MuiSelect",overridesResolver:(e,t)=>t.root,shouldForwardProp:e=>dt(e)&&"variant"!==e,slot:"Root"},GF=ut(Tk,VF)(""),HF=ut(qk,VF)(""),WF=ut(Ok,VF)(""),QF=n.forwardRef((function(e,t){const i=mt({name:"MuiSelect",props:e}),{autoWidth:r=!1,children:s,classes:a={},className:o,defaultOpen:l=!1,displayEmpty:c=!1,IconComponent:h=UF,id:d,input:u,inputProps:p,label:f,labelId:m,MenuProps:g,multiple:v=!1,native:y=!1,onClose:b,onOpen:A,open:x,renderValue:w,SelectDisplayProps:S,variant:_="outlined"}=i,E=(0,Ae.A)(i,zF),C=y?MF:FF,M=lO({props:i,muiFormControl:TL(),states:["variant","error"]}),T=M.variant||_,I=(0,xe.A)({},i,{variant:T,classes:a}),P=(e=>{const{classes:t}=e;return t})(I),D=(0,Ae.A)(P,jF),R=u||{standard:(0,ve.jsx)(GF,{ownerState:I}),outlined:(0,ve.jsx)(HF,{label:f,ownerState:I}),filled:(0,ve.jsx)(WF,{ownerState:I})}[T],B=yt(t,R.ref);return(0,ve.jsx)(n.Fragment,{children:n.cloneElement(R,(0,xe.A)({inputComponent:C,inputProps:(0,xe.A)({children:s,error:M.error,IconComponent:h,variant:T,type:void 0,multiple:v},y?{id:d}:{autoWidth:r,defaultOpen:l,displayEmpty:c,labelId:m,MenuProps:g,onClose:b,onOpen:A,open:x,renderValue:w,SelectDisplayProps:(0,xe.A)({id:d},S)},p,{classes:p?(0,Ie.A)(D,p.classes):D},u?u.props.inputProps:{})},(v&&y||c)&&"outlined"===T?{notched:!0}:{},{ref:B,className:Se(R.props.className,o,P.root)},!u&&{variant:T},E))})}));QF.muiName="Select";const qF=QF;function XF(e){return Yt("MuiTextField",e)}Kt("MuiTextField",["root"]);const YF=["autoComplete","autoFocus","children","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","id","InputLabelProps","inputProps","InputProps","inputRef","label","maxRows","minRows","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","select","SelectProps","type","value","variant"],KF={standard:Tk,filled:Ok,outlined:qk},JF=ut(dF,{name:"MuiTextField",slot:"Root",overridesResolver:(e,t)=>t.root})({}),ZF=n.forwardRef((function(e,t){const i=mt({props:e,name:"MuiTextField"}),{autoComplete:n,autoFocus:r=!1,children:s,className:a,color:o="primary",defaultValue:l,disabled:c=!1,error:h=!1,FormHelperTextProps:d,fullWidth:u=!1,helperText:p,id:f,InputLabelProps:m,inputProps:g,InputProps:v,inputRef:y,label:b,maxRows:A,minRows:x,multiline:w=!1,name:S,onBlur:_,onChange:E,onFocus:C,placeholder:M,required:T=!1,rows:I,select:P=!1,SelectProps:D,type:R,value:B,variant:L="outlined"}=i,O=(0,Ae.A)(i,YF),N=(0,xe.A)({},i,{autoFocus:r,color:o,disabled:c,error:h,fullWidth:u,multiline:w,required:T,select:P,variant:L}),k=(e=>{const{classes:t}=e;return Ee({root:["root"]},XF,t)})(N);const F={};"outlined"===L&&(m&&"undefined"!==typeof m.shrink&&(F.notched=m.shrink),F.label=b),P&&(D&&D.native||(F.id=void 0),F["aria-describedby"]=void 0);const U=Rr(f),z=p&&U?`${U}-helper-text`:void 0,j=b&&U?`${U}-label`:void 0,V=KF[L],G=(0,ve.jsx)(V,(0,xe.A)({"aria-describedby":z,autoComplete:n,autoFocus:r,defaultValue:l,fullWidth:u,multiline:w,name:S,rows:I,maxRows:A,minRows:x,type:R,value:B,id:U,inputRef:y,onBlur:_,onChange:E,onFocus:C,placeholder:M,inputProps:g},F,v));return(0,ve.jsxs)(JF,(0,xe.A)({className:Se(k.root,a),disabled:c,error:h,fullWidth:u,ref:t,required:T,color:o,variant:L,ownerState:N},O,{children:[null!=b&&""!==b&&(0,ve.jsx)(sF,(0,xe.A)({htmlFor:U,id:j},m,{children:b})),P?(0,ve.jsx)(qF,(0,xe.A)({"aria-describedby":z,id:U,labelId:j,value:B,input:G},D,{children:s})):G,p&&(0,ve.jsx)(yF,(0,xe.A)({id:z},d,{children:p}))]}))})),$F=ZF,eU=n.lazy((()=>Promise.resolve().then(i.bind(i,1906)))),tU=()=>{const e=(0,n.useContext)(sU);return(0,n.useEffect)((()=>{e.setisHeaderFooterShow(!1)}),[]),(0,ve.jsxs)("div",{className:"signin-container",children:[(0,ve.jsx)("div",{className:"spline-container",children:(0,ve.jsx)(n.Suspense,{fallback:(0,ve.jsx)("div",{children:"Loading..."}),children:(0,ve.jsx)(eU,{scene:"https://prod.spline.design/wyRxJz95lK-xYZvU/scene.splinecode"})})}),(0,ve.jsxs)("div",{className:"signin-form",children:[(0,ve.jsx)("h1",{children:"Welcome to Drape Fit"}),(0,ve.jsx)("p",{children:"Sign in to continue"}),(0,ve.jsxs)("div",{className:"input-container",children:[(0,ve.jsx)($F,{placeholder:"Enter your email",type:"email",required:!0,fullWidth:!0,variant:"outlined",className:"custom-input",InputProps:{style:{color:"white",fontSize:"1.7rem"}}}),(0,ve.jsx)($F,{placeholder:"Enter your password",type:"password",required:!0,fullWidth:!0,variant:"outlined",className:"custom-input",InputProps:{style:{color:"white",fontSize:"1.7rem"}}})]}),(0,ve.jsxs)("div",{className:"checkbox-container",children:[(0,ve.jsx)("input",{type:"checkbox",id:"remember-me"}),(0,ve.jsx)("label",{htmlFor:"remember-me",children:"Remember me"})]}),(0,ve.jsx)(Ti,{variant:"contained",fullWidth:!0,className:"login-btn",children:"Login"}),(0,ve.jsx)("br",{}),(0,ve.jsx)(Ti,{variant:"contained",className:"google-btn",id:"googleLogin",children:"Login with Google"}),(0,ve.jsx)("br",{}),(0,ve.jsxs)("p",{className:"signup-link",children:["Not Registered? ",(0,ve.jsx)(ka,{to:"/SignUp",children:"Sign Up"})]})]})]})},iU=n.lazy((()=>Promise.resolve().then(i.bind(i,1906)))),nU=()=>{const e=(0,n.useContext)(sU),[t,i]=(0,n.useState)(!1),[r,s]=(0,n.useState)(""),[a,o]=(0,n.useState)({name:"",email:"",password:"",confirmPassword:""});(0,n.useEffect)((()=>{e.setisHeaderFooterShow(!1)}),[]);const l=e=>{o((t=>({...t,[e.target.name]:e.target.value}))),s("")};return(0,ve.jsxs)("div",{className:"signin-container",children:[(0,ve.jsx)("div",{className:"spline-container",children:(0,ve.jsx)(n.Suspense,{fallback:(0,ve.jsx)("div",{children:"Loading 3D Model..."}),children:(0,ve.jsx)(iU,{scene:"https://prod.spline.design/wyRxJz95lK-xYZvU/scene.splinecode"})})}),(0,ve.jsxs)("div",{className:"signin-form",children:[(0,ve.jsx)("h1",{children:"Welcome to Drape Fit"}),(0,ve.jsx)("p",{children:"Create an Account"}),(0,ve.jsxs)("div",{className:"input-container",children:[(0,ve.jsx)($F,{name:"name",value:a.name,onChange:l,placeholder:"Enter your name",required:!0,fullWidth:!0,variant:"outlined",className:"custom-input",InputProps:{style:{color:"white",fontSize:"1.7rem"}}}),(0,ve.jsx)($F,{name:"email",value:a.email,onChange:l,placeholder:"Enter your email",type:"email",required:!0,fullWidth:!0,variant:"outlined",className:"custom-input",InputProps:{style:{color:"white",fontSize:"1.7rem"}}}),(0,ve.jsx)($F,{name:"password",value:a.password,onChange:l,placeholder:"Enter your password",type:"password",required:!0,fullWidth:!0,variant:"outlined",className:"custom-input",InputProps:{style:{color:"white",fontSize:"1.7rem"}}}),(0,ve.jsx)($F,{name:"confirmPassword",value:a.confirmPassword,onChange:l,placeholder:"Confirm password",type:"password",required:!0,fullWidth:!0,variant:"outlined",className:"custom-input",InputProps:{style:{color:"white",fontSize:"1.7rem"}}})]}),r&&(0,ve.jsx)("p",{style:{color:"red",fontSize:"1.5rem"},children:r}),(0,ve.jsx)("br",{}),(0,ve.jsx)(Ti,{variant:"contained",fullWidth:!0,className:"login-btn",onClick:async()=>{const t=(()=>{const{name:e,email:t,password:i,confirmPassword:n}=a;return e.trim()?/^\S+@\S+\.\S+$/.test(t)?i.length<6?"Password must be at least 6 characters.":i!==n?"Passwords do not match.":"":"Enter a valid email.":"Name is required."})();if(t)s(t);else{i(!0);try{const t=await Oc.post("http://localhost:5000/api/auth/signup",{name:a.name,email:a.email,password:a.password});alert(t.data.message),e.setIsLogin(!0)}catch(t){var n,r;s((null===(n=t.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.error)||"Signup failed!")}finally{i(!1)}}},disabled:t||!a.email||!a.password,children:t?"Signing Up...":"Sign Up"}),(0,ve.jsx)("br",{}),(0,ve.jsx)(Ti,{variant:"contained",className:"google-btn",id:"googleLogin",children:"Login with Google"}),(0,ve.jsx)("br",{}),(0,ve.jsxs)("p",{className:"signup-link",children:["Already have an Account? ",(0,ve.jsx)(ka,{to:"/SignIn",children:"Sign In"})]})]})]})};const rU=function(){const[e,t]=(0,n.useState)(null),[i,r]=(0,n.useState)("");return(0,ve.jsxs)("div",{style:{padding:"20px"},children:[(0,ve.jsx)("h2",{children:"Upload an Image"}),(0,ve.jsx)("input",{type:"file",onChange:e=>{t(e.target.files[0])}}),(0,ve.jsx)("button",{onClick:async()=>{if(!e)return alert("Please select a file first.");const t=new FormData;t.append("file",e);try{const e=await Oc.post("/api/upload",t,{headers:{"Content-Type":"multipart/form-data"}});console.log("File uploaded:",e.data),r(e.data.path)}catch(i){console.error("Upload failed:",i)}},children:"Upload"}),i&&(0,ve.jsxs)("div",{style:{marginTop:"20px"},children:[(0,ve.jsx)("h3",{children:"Uploaded Image:"}),(0,ve.jsx)("img",{src:i,alt:"Uploaded",style:{width:"300px"}})]})]})},sU=(0,n.createContext)();function aU(){const e=$(),[t,i]=(0,n.useState)([]),[r,s]=(0,n.useState)(""),[a,o]=(0,n.useState)(!1),[l,c]=(0,n.useState)(!0),[h,d]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1),[f,m]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(!document.querySelector('script[src*="spline-viewer.js"]')){const e=document.createElement("script");e.type="module",e.src="https://unpkg.com/@splinetool/viewer@1.9.69/build/spline-viewer.js",e.async=!0,document.body.appendChild(e)}}),[]),(0,n.useEffect)((()=>{g("https://countriesnow.space/api/v0.1/countries/")}),[]),(0,n.useEffect)((()=>{localStorage.getItem("authToken")&&d(!0)}),[]);const g=async e=>{try{const t=await Oc.get(e);i(t.data.data)}catch(t){console.error("Error fetching countries:",t)}},v=()=>{m(!f)},y={countryList:t,setselectedCountry:s,selectedCountry:r,setisOpenProductModal:o,isOpenProductModal:a,isHeaderFooterShow:l,setisHeaderFooterShow:c,isLogin:h,setIsLogin:d,isLoading:u,setIsLoading:p,handleLogin:async e=>{try{const t=await Oc.post("/api/login",e);localStorage.setItem("authToken",t.data.token),d(!0)}catch(t){console.error("Login failed:",t)}},toggleFitQuiz:v,navigate:e};return(0,ve.jsxs)(sU.Provider,{value:y,children:[l&&(0,ve.jsx)(bo,{}),(0,ve.jsxs)(me,{children:[(0,ve.jsx)(pe,{path:"/",element:(0,ve.jsx)(za,{})}),(0,ve.jsx)(pe,{path:"/cat/:id",element:(0,ve.jsx)(tk,{})}),(0,ve.jsx)(pe,{path:"/signIn",element:(0,ve.jsx)(tU,{})}),(0,ve.jsx)(pe,{path:"/signUp",element:(0,ve.jsx)(nU,{})}),(0,ve.jsx)(pe,{path:"/fitquiz",element:(0,ve.jsx)($c,{})}),(0,ve.jsx)(pe,{path:"/upload",element:(0,ve.jsx)(rU,{})})," "]}),a&&(0,ve.jsx)(CL,{}),l&&(0,ve.jsx)(zc,{}),f&&(0,ve.jsxs)("div",{className:"fitquiz-modal",children:[(0,ve.jsx)("div",{className:"fitquiz-overlay",onClick:v}),(0,ve.jsxs)("div",{className:"fitquiz-content",children:[(0,ve.jsx)($c,{toggleFitQuiz:v}),(0,ve.jsx)("button",{className:"close-fitquiz",onClick:v,children:"\u2716"})]})]})]})}const oU=function(){return(0,ve.jsx)(aU,{})};s.createRoot(document.getElementById("root")).render((0,ve.jsx)(La,{children:(0,ve.jsx)(oU,{})}))})()})();
//# sourceMappingURL=main.a855357c.js.map